<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niederwieser Performance Manager</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'in': 'fade-in 0.3s ease-out',
                        'out': 'fade-out 0.3s ease-out',
                    },
                    keyframes: {
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        'fade-out': {
                            '0%': { opacity: '1', transform: 'translateY(0)' },
                            '100%': { opacity: '0', transform: 'translateY(10px)' },
                        }
                    }
                }
            }
        };
    </script>

    <style>
        body { -webkit-font-smoothing: antialiased; }
        /* Custom Scrollbar for better visibility */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        /* Zusätzliche Flex-Anpassung für die gleich hohe Spalte */
        .equal-height-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem; /* 6 */
            align-items: stretch;
        }
        
        /* PDF Print Styles */
        @media print {
            .no-print { display: none !important; }
            .break-inside-avoid { page-break-inside: avoid; break-inside: avoid; }
            body { background: white !important; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
        
        /* PDF Mode Styles - Optimiert für html2pdf mit langen Texten */
        .pdf-mode {
            background: white !important;
            max-width: 190mm !important;
            margin: 0 auto !important;
            padding: 10mm !important;
        }
        .pdf-mode * {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        .pdf-mode .no-print { 
            display: none !important; 
        }
        .pdf-mode .pdf-only { 
            display: block !important; 
        }
        .pdf-only { 
            display: none; 
        }
        .pdf-mode .break-inside-avoid { 
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        /* === KRITISCH: Robuste Seitenumbrüche für arbeitsrechtliche Dokumente === */
        .pdf-mode .pdf-section {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
            max-height: 250mm; /* Sicherheitslimit pro Sektion */
            overflow: visible !important;
        }
        .pdf-mode .pdf-text-block {
            page-break-inside: auto !important; /* Lange Texte dürfen umbrechen */
            break-inside: auto !important;
            orphans: 3; /* Min 3 Zeilen vor Umbruch */
            widows: 3; /* Min 3 Zeilen nach Umbruch */
        }
        .pdf-mode .pdf-keep-together {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        /* Remove backgrounds and shadows */
        .pdf-mode [class*="bg-slate"],
        .pdf-mode [class*="bg-blue"],
        .pdf-mode [class*="bg-purple"],
        .pdf-mode [class*="bg-indigo"] {
            background: transparent !important;
        }
        .pdf-mode [class*="shadow"] {
            box-shadow: none !important;
        }
        .pdf-mode [class*="rounded"] {
            border-radius: 4px !important;
        }
        
        /* Table styles */
        .pdf-mode table {
            border-collapse: collapse !important;
            width: 100% !important;
            margin: 8px 0 !important;
        }
        .pdf-mode th {
            background-color: #f8fafc !important;
            font-weight: 700 !important;
            font-size: 11px !important;
            padding: 6px 4px !important;
            border: 1px solid #cbd5e1 !important;
            text-align: left !important;
        }
        .pdf-mode td {
            padding: 6px 4px !important;
            border: 1px solid #cbd5e1 !important;
            font-size: 10px !important;
            vertical-align: top !important; /* Top statt middle für lange Texte */
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            max-width: 300px; /* Verhindert überlange Zellen */
        }
        .pdf-mode tbody tr {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        /* Lange Textfelder in Tabellen dürfen umbrechen */
        .pdf-mode td.pdf-text-cell {
            page-break-inside: auto !important;
            break-inside: auto !important;
        }
        
        /* Headers and spacing */
        .pdf-mode h1 { font-size: 24px !important; margin-bottom: 4px !important; }
        .pdf-mode h2 { font-size: 18px !important; margin-bottom: 8px !important; page-break-after: avoid !important; }
        .pdf-mode h3 { font-size: 14px !important; margin-bottom: 6px !important; page-break-after: avoid !important; }
        .pdf-mode h4 { font-size: 12px !important; margin-bottom: 4px !important; }
        .pdf-mode p { font-size: 11px !important; line-height: 1.4 !important; }
        .pdf-mode label { font-size: 10px !important; }
        
        /* Section spacing */
        .pdf-mode > div {
            margin-bottom: 12px !important;
            padding: 8px !important;
            border: 1px solid #e2e8f0 !important;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-900">
    
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            BookOpen, Users, Target, Award, ChevronRight, 
            X, Zap, Heart, Scale, Brain, TrendingUp, Clock, MessageCircle, 
            Briefcase, Lightbulb, ShieldAlert, CheckCircle2, AlertCircle,
            ClipboardList, CalendarCheck, Calculator, Info, RotateCcw, Trophy, PlusCircle, XCircle,
            Download, Loader2, Trash2, FileText, Edit2, Eye, UserPlus, Play, LogOut, Mail, Lock, Link,
            Building2, ArrowLeft, RefreshCw, Calendar, User, HelpCircle, Send, Sparkles, Copy
        } from 'https://esm.sh/lucide-react@0.292.0';

        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyCxQ9qLHls7RAUWmOkOSAg1E9-wzfRIAYc",
            authDomain: "performance-manager-b0967.firebaseapp.com",
            projectId: "performance-manager-b0967",
            storageBucket: "performance-manager-b0967.firebasestorage.app",
            messagingSenderId: "191493540566",
            appId: "1:191493540566:web:a64b78148c01a8fc089777",
            measurementId: "G-BHVYQBQR9C"
        };

        // Firebase initialisieren
        let firebaseApp = null;
        let auth = null;
        let db = null;
        
        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            console.log("Firebase erfolgreich initialisiert");
        } catch (error) {
            console.error("Firebase Initialisierungsfehler:", error);
        }

        // ============================================
        // HR ADMIN CONFIGURATION
        // ============================================
        const HR_ADMIN_EMAILS = ['d.andrisani@niederwiesergroup.com'];
        const isUserHRAdmin = (email) => email && HR_ADMIN_EMAILS.includes(email.toLowerCase());

        // ============================================
        // LOGIN VIEW COMPONENT
        // ============================================
        const LoginView = ({ lang, onLoginSuccess }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const t = {
                de: {
                    loginTitle: 'Anmelden',
                    registerTitle: 'Registrieren',
                    email: 'E-Mail-Adresse',
                    password: 'Passwort',
                    confirmPassword: 'Passwort bestätigen',
                    loginBtn: 'Anmelden',
                    registerBtn: 'Registrieren',
                    noAccount: 'Noch kein Konto?',
                    hasAccount: 'Bereits ein Konto?',
                    registerLink: 'Jetzt registrieren',
                    loginLink: 'Jetzt anmelden',
                    teamAccess: 'Team-Zugang',
                    teamDesc: 'Melden Sie sich an, um Ihr Team zu verwalten und Performance Reviews durchzuführen.',
                    passwordMismatch: 'Passwörter stimmen nicht überein',
                    errorAuth: 'Authentifizierungsfehler. Bitte überprüfen Sie Ihre Eingaben.',
                    errorEmail: 'E-Mail-Adresse bereits registriert',
                    errorWeak: 'Passwort zu schwach (min. 6 Zeichen)',
                    errorInvalid: 'Ungültige E-Mail oder falsches Passwort'
                },
                it: {
                    loginTitle: 'Accedi',
                    registerTitle: 'Registrati',
                    email: 'Indirizzo email',
                    password: 'Password',
                    confirmPassword: 'Conferma password',
                    loginBtn: 'Accedi',
                    registerBtn: 'Registrati',
                    noAccount: 'Non hai un account?',
                    hasAccount: 'Hai già un account?',
                    registerLink: 'Registrati ora',
                    loginLink: 'Accedi ora',
                    teamAccess: 'Accesso Team',
                    teamDesc: 'Accedi per gestire il tuo team e condurre Performance Reviews.',
                    passwordMismatch: 'Le password non corrispondono',
                    errorAuth: 'Errore di autenticazione. Verifica i tuoi dati.',
                    errorEmail: 'Email già registrata',
                    errorWeak: 'Password troppo debole (min. 6 caratteri)',
                    errorInvalid: 'Email non valida o password errata'
                },
                en: {
                    loginTitle: 'Sign In',
                    registerTitle: 'Register',
                    email: 'Email Address',
                    password: 'Password',
                    confirmPassword: 'Confirm Password',
                    loginBtn: 'Sign In',
                    registerBtn: 'Register',
                    noAccount: 'No account yet?',
                    hasAccount: 'Already have an account?',
                    registerLink: 'Register now',
                    loginLink: 'Sign in now',
                    teamAccess: 'Team Access',
                    teamDesc: 'Sign in to manage your team and conduct Performance Reviews.',
                    passwordMismatch: 'Passwords do not match',
                    errorAuth: 'Authentication error. Please check your inputs.',
                    errorEmail: 'Email address already registered',
                    errorWeak: 'Password too weak (min. 6 characters)',
                    errorInvalid: 'Invalid email or wrong password'
                }
            };

            const txt = t[lang] || t.de;

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                if (!isLogin && password !== confirmPassword) {
                    setError(txt.passwordMismatch);
                    setLoading(false);
                    return;
                }

                try {
                    if (isLogin) {
                        await auth.signInWithEmailAndPassword(email, password);
                    } else {
                        await auth.createUserWithEmailAndPassword(email, password);
                    }
                    if (onLoginSuccess) onLoginSuccess();
                } catch (err) {
                    console.error('Auth error:', err);
                    if (err.code === 'auth/email-already-in-use') {
                        setError(txt.errorEmail);
                    } else if (err.code === 'auth/weak-password') {
                        setError(txt.errorWeak);
                    } else if (err.code === 'auth/invalid-credential' || err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found') {
                        setError(txt.errorInvalid);
                    } else {
                        setError(txt.errorAuth);
                    }
                }
                setLoading(false);
            };

            return React.createElement('div', { className: 'min-h-[60vh] flex items-center justify-center' },
                React.createElement('div', { className: 'bg-white p-8 rounded-2xl shadow-xl border border-slate-200 w-full max-w-md' },
                    // Header
                    React.createElement('div', { className: 'text-center mb-8' },
                        React.createElement('div', { className: 'w-16 h-16 bg-[#243186] rounded-full flex items-center justify-center mx-auto mb-4' },
                            React.createElement(Users, { size: 32, className: 'text-white' })
                        ),
                        React.createElement('h2', { className: 'text-2xl font-bold', style: { color: '#243186' } },
                            txt.teamAccess
                        ),
                        React.createElement('p', { className: 'text-slate-500 mt-2 text-sm' },
                            txt.teamDesc
                        )
                    ),

                    // Tabs
                    React.createElement('div', { className: 'flex bg-slate-100 rounded-lg p-1 mb-6' },
                        React.createElement('button', {
                            onClick: () => { setIsLogin(true); setError(''); },
                            className: `flex-1 py-2.5 rounded-md text-sm font-medium transition-all ${isLogin ? 'bg-[#6EBD84] text-white shadow' : 'text-slate-600 hover:text-slate-900'}`
                        }, txt.loginTitle),
                        React.createElement('button', {
                            onClick: () => { setIsLogin(false); setError(''); },
                            className: `flex-1 py-2.5 rounded-md text-sm font-medium transition-all ${!isLogin ? 'bg-[#6EBD84] text-white shadow' : 'text-slate-600 hover:text-slate-900'}`
                        }, txt.registerTitle)
                    ),

                    // Error Message
                    error && React.createElement('div', { className: 'bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm' },
                        error
                    ),

                    // Form
                    React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
                        // Email
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, txt.email),
                            React.createElement('div', { className: 'relative' },
                                React.createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' },
                                    React.createElement(Mail, { size: 18, className: 'text-slate-400' })
                                ),
                                React.createElement('input', {
                                    type: 'email',
                                    value: email,
                                    onChange: (e) => setEmail(e.target.value),
                                    required: true,
                                    className: 'w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none transition-all',
                                    placeholder: 'name@firma.de'
                                })
                            )
                        ),

                        // Password
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, txt.password),
                            React.createElement('div', { className: 'relative' },
                                React.createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' },
                                    React.createElement(Lock, { size: 18, className: 'text-slate-400' })
                                ),
                                React.createElement('input', {
                                    type: 'password',
                                    value: password,
                                    onChange: (e) => setPassword(e.target.value),
                                    required: true,
                                    minLength: 6,
                                    className: 'w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none transition-all',
                                    placeholder: '••••••••'
                                })
                            )
                        ),

                        // Confirm Password (nur bei Registrierung)
                        !isLogin && React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, txt.confirmPassword),
                            React.createElement('div', { className: 'relative' },
                                React.createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' },
                                    React.createElement(Lock, { size: 18, className: 'text-slate-400' })
                                ),
                                React.createElement('input', {
                                    type: 'password',
                                    value: confirmPassword,
                                    onChange: (e) => setConfirmPassword(e.target.value),
                                    required: true,
                                    minLength: 6,
                                    className: 'w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none transition-all',
                                    placeholder: '••••••••'
                                })
                            )
                        ),

                        // Submit Button
                        React.createElement('button', {
                            type: 'submit',
                            disabled: loading,
                            className: 'w-full bg-[#243186] text-white py-3 rounded-lg font-medium hover:bg-[#1a2460] transition-colors flex items-center justify-center gap-2 disabled:opacity-50'
                        },
                            loading ? React.createElement(Loader2, { size: 20, className: 'animate-spin' }) : null,
                            isLogin ? txt.loginBtn : txt.registerBtn
                        )
                    )
                )
            );
        };

        const { createElement: e } = React;

        // === MULTILINGUAL TEXT HELPER ===
        // Verwendung: getText(lang, 'German text', 'Italian text', 'English text')
        const getText = (lang, de, it, en) => {
          if (lang === 'en') return en || de;
          if (lang === 'it') return it || de;
          return de;
        };

        // === GPS SIMULATOR CONSTANTS ===
        const BARS_RANGES = [
          { min: 131, score: 5, label: "Herausragend (>130%)" },
          { min: 111, max: 130, score: 4, label: "Übertroffen (111-130%)" },
          { min: 90, max: 110, score: 3, label: "Baseline (90-110%)" },
          { min: 70, max: 89, score: 2, label: "Teilweise (70-89%)" },
          { min: 0, max: 69, score: 1, label: "Nicht erreicht (<70%)" },
        ];

        const RATINGS = [
          { min: 4.51, max: 5.00, label: "Outstanding (5)", color: "bg-green-600", desc: "Top Bonus / Gehaltssprung" },
          { min: 3.51, max: 4.50, label: "Exceeds Expectations (4)", color: "bg-emerald-500", desc: "Basis-Bonus / Gehaltserhöhung" },
          { min: 2.51, max: 3.50, label: "Meets Expectations (3)", color: "bg-blue-600", desc: "Standard-Runde / Kein Bonus" },
          { min: 1.51, max: 2.50, label: "Needs Improvement (2)", color: "bg-orange-500", desc: "Enge Führung / PIP" },
          { min: 0.00, max: 1.50, label: "Does Not Meet (1)", color: "bg-red-600", desc: "Sofortige Eskalation" },
        ];

        const getBarsScore = (percentage) => {
          const range = BARS_RANGES.find(r => percentage >= r.min && (r.max === undefined || percentage <= r.max));
          return range ? range.score : 1;
        };

        const getRating = (score) => {
          return RATINGS.find(r => score >= r.min && score <= r.max) || RATINGS[RATINGS.length - 1];
        };


        // --- UI TEXT (German and Italian) ---
        const UI_TEXT = {
            de: {
                title: "Performance Manager",
                welcome: "Willkommen",
                intro: "Dies ist Ihr interaktiver Guide für das ",
                introBold: "Niederwieser Performance Review",
                introEnd: ". Hier finden Sie alle Verhaltensanker, Definitionen und Beispiele, um Leistungen objektiv einzuschätzen.",
                strategyTitle: "Strategie & Vision",
                strategySubtitle: "Die Transformation im Fokus",
                strategyDesc: "Unsere Kernwerte Fast, Fair & Personal sind der Kompass zur Strategie 2035. Mit dem Performance Review schaffen wir die Transparenz, individuelle Ergebnisse (WAS) und Kompetenzen (WIE) objektiv zu bewerten, um alle Anstrengungen auf das gemeinsame Ziel zu bündeln: die Entwicklung zum ",
                strategyBold: "Smartest Solution Provider",
                strategyEnd: ".",
                barsTitle: "Wie funktioniert BARS?",
                barsDesc: "Behaviorally Anchored Rating Scales: Wir bewerten Verhalten, nicht Persönlichkeit. Nutzen Sie den Guide, um den Unterschied zwischen \"Standard\" (3) und \"Role Model\" (5) zu verstehen.",
                btnCompetencies: "Kompetenzen ansehen",
                coreComp: "Kern-Kompetenzen (Für Alle)",
                leadComp: "Leadership-Kompetenzen (Führungskräfte)",
                back: "← Zurück zur Übersicht",
                selectScore: "Wählen Sie einen Score",
                example: "Praktisches Beispiel",
                dashboard: "Dashboard",
                competencies: "Kompetenzen",
                simulator: "GPS Simulator",
                gpsExplainer: "GPS Formel",
                formular: "Beurteilungsformular",
                zielvereinbarung: "Zielvereinbarung",
                level1: "Erfüllt nicht",
                level2: "Verbesserungsbedarf",
                level3: "Baseline (Standard)",
                level4: "Übertrifft Erwartungen",
                level5: "Herausragend / Role Model",
                // GPS Simulator Texte
                gpsSimTitle: "GPS Simulator: Berechnung testen",
                gpsSimDesc: "Testen Sie die Formel, indem Sie WAS (Ziele) und WIE (Kompetenzen) bewerten.",
                wasSection: "WAS: Ziele erreichen",
                wasPercent: "50% der GPS",
                wasScoreLabel: "WAS Score",
                goalName: "Ziel",
                goalWeight: "Gewicht (%)",
                goalAchievement: "Erreichung (%)",
                addGoal: "Ziel hinzufügen",
                removeGoal: "Entfernen",
                competencyWeight: "Gewicht",
                totalWeight: "Gesamtgewicht",
                shouldBe100: "sollte 100% sein",
                wieCore: "WIE: Kern-Kompetenzen",
                wieLeadership: "WIE: Leadership-Kompetenzen",
                score: "Score",
                addLeadership: "Leadership-Kompetenzen hinzufügen",
                leadershipActive: "Aktiviert (Führungskraft)",
                leadershipOptional: "Optional",
                globalPerformanceScore: "Global Performance Score",
                theMath: "The Math: Berechnung",
                wasGoals: "WAS (Ziele)",
                wieCompetencies: "WIE (Kompetenzen)",
                wieCore2: "WIE (Kern)",
                wieLeader: "WIE (Lead)",
                gpsTotal: "GPS TOTAL",
                resetSimulator: "Simulator zurücksetzen",
                // GPS Erklärungsseite
                gpsExplainerTitle: "Der Global Performance Score (GPS)",
                gpsExplainerSubtitle: "So funktioniert unsere Performance-Bewertung",
                gpsIntroTitle: "Unser ausgewogener Ansatz",
                gpsIntroText: "Der Annual Performance Review basiert auf einem ausgewogenen Ansatz. Wir bewerten nicht nur WAS erreicht wurde, sondern auch WIE es erreicht wurde. Diese Kombination nennen wir Global Performance Score und stellt sicher, dass nicht nur Ergebnisse zählen, sondern auch die Art und Weise, wie diese Ergebnisse erreicht werden.",
                gpsFormulaTitle: "Die GPS-Formel",
                gpsFormulaExplain: "Der GPS setzt sich aus drei Dimensionen zusammen:",
                wasExplainTitle: "WAS: Messbare Ergebnisse",
                wasExplainWeight: "50% Gewichtung",
                wasExplainText: "Misst die Zielerreichung. Die Messung erfolgt objektiv über eine Umrechnungstabelle (%).",
                wasExplainExample: "Beispiel: \"Umsatzziel: 500.000 € geplant, 550.000 € erreicht = 110%\"",
                wieExplainTitle: "WIE: Verhalten & Kompetenzen",
                wieCoreExplainWeight: "25% Gewichtung (Kern-Kompetenzen)",
                wieLeadExplainWeight: "25% Gewichtung (Leadership-Kompetenzen)",
                wieExplainText: "Misst die Kompetenzen anhand von Verhaltensankern (BARS). Dies sichert die Einhaltung unserer Werte.",
                wieExplainCompetencies: "Kern-Kompetenzen: Fachkompetenz & Anwendung • Kommunikation & Zusammenarbeit • Problemlösekompetenz • Anpassungsfähigkeit • Selbstorganisation | Leadership-Kompetenzen: Mitarbeiterführung & -entwicklung • Strategisches Denken • Entscheidungsfähigkeit • Execution & Performance Management • Stakeholder-Management",
                barsConversionTitle: "Umrechnung: Zielerreichung % → BARS-Stufe",
                barsConversionDesc: "Die Zielerreichung in Prozent wird in BARS-Stufen (1-5) umgerechnet:",
                performanceRatingTitle: "Performance-Rating (basierend auf GPS)",
                performanceRatingDesc: "Der finale GPS-Wert bestimmt das Performance-Rating:",
                calculationExampleTitle: "Berechnungsbeispiel",
                calculationExampleIntro: "Annahmen:",
                calculationStep1: "WAS (Zielerreichung): 4,0",
                calculationStep2: "WIE (Kern-Kompetenzen): 3,2",
                calculationStep3: "WIE (Leadership-Kompetenzen): 4,0",
                calculationFormula: "Berechnung:",
                calculationResult: "Ergebnis: GPS = 3,8 → Exceeds Expectations (4)",
                whyGPSTitle: "Warum GPS?",
                whyGPS1Title: "Fairness & Objektivität",
                whyGPS1Text: "BARS-Methodik reduziert subjektive Bewertungen durch konkrete Verhaltensanker",
                whyGPS2Title: "Strategische Ausrichtung",
                whyGPS2Text: "Verhalten wird an unseren Werten \"Schnell • Fair • Persönlich\" gemessen",
                whyGPS3Title: "Entwicklungsorientiert",
                whyGPS3Text: "Klare Verhaltensbeispiele zeigen den Weg zur nächsten Stufe auf",
                // Performance Kompass
                performanceCompassTitle: "Ihr Performance Kompass",
                performanceCompassSubtitle: "Der Global Performance Score (GPS) stellt sicher, dass wir Ihren Erfolg ganzheitlich messen: Wir bewerten nicht nur WAS erreicht wurde, sondern auch WIE es im Einklang mit unseren Werten umgesetzt wurde.",
                wasBoxTitle: "50% WAS",
                wasBoxSubtitle: "Ziele & Ergebnisse (KPIs)",
                wieBoxTitle: "50% WIE",
                wieBoxSubtitle: "Verhalten & Kompetenzen (BARS)",
                wieBoxSubtitleManager: "25% Kern-Kompetenzen + 25% Leadership",
                wieBoxSubtitleEmployee: "Kern-Kompetenzen (BARS)",
                managerNote: "* Für Führungskräfte: Das WIE splittet sich in 25% Kern-Kompetenzen und 25% Leadership-Kompetenzen.",
                fairnessGuarantee: "FAIRNESS-GARANTIE: KALIBRIERTE BEWERTUNG",
                barsRanges: {
                    outstanding: "Herausragend (>130%)",
                    exceeded: "Übertroffen (111-130%)",
                    baseline: "Baseline (90-110%)",
                    partial: "Teilweise (70-89%)",
                    notReached: "Nicht erreicht (<70%)"
                },
                ratings: {
                    outstanding: "Top Bonus / Gehaltssprung",
                    exceeds: "Basis-Bonus / Gehaltserhöhung",
                    meets: "Standard-Runde / Kein Bonus",
                    needs: "Enge Führung / PIP",
                    doesNot: "Sofortige Eskalation"
                }
            },
            it: {
                title: "Performance Manager",
                welcome: "Benvenuto",
                intro: "Questa è la tua guida interattiva per il ",
                introBold: "Niederwieser Performance Review",
                introEnd: ". Qui troverai tutti gli ancoraggi comportamentali, definizioni ed esempi per valutare le prestazioni in modo oggettivo.",
                strategyTitle: "Strategia & Visione",
                strategySubtitle: "Focus sulla trasformazione",
                strategyDesc: "I nostri valori fondamentali Fast, Fair & Personal sono la bussola verso la Strategia 2035. Con il Performance Review creiamo la trasparenza per valutare oggettivamente risultati individuali (COSA) e competenze (COME), concentrando tutti gli sforzi sull'obiettivo comune: lo sviluppo verso ",
                strategyBold: "Smartest Solution Provider",
                strategyEnd: ".",
                barsTitle: "Come funziona BARS?",
                barsDesc: "Behaviorally Anchored Rating Scales: Valutiamo il comportamento, non la personalità. Usa la guida per capire la differenza tra \"Standard\" (3) e \"Role Model\" (5).",
                btnCompetencies: "Vedi Competenze",
                coreComp: "Competenze Chiave (Per Tutti)",
                leadComp: "Competenze di Leadership (Manager)",
                back: "← Torna alla panoramica",
                selectScore: "Seleziona un punteggio",
                example: "Esempio pratico",
                dashboard: "Dashboard",
                competencies: "Competenze",
                simulator: "Simulatore GPS",
                gpsExplainer: "Formula GPS",
                formular: "Modulo di valutazione",
                zielvereinbarung: "Accordo sugli obiettivi",
                level1: "Non soddisfa",
                level2: "Richiede miglioramento",
                level3: "Baseline (Standard)",
                level4: "Supera le aspettative",
                level5: "Eccellente / Role Model",
                // GPS Simulator Texte
                gpsSimTitle: "Simulatore GPS: Testare il calcolo",
                gpsSimDesc: "Testa la formula valutando COSA (Obiettivi) e COME (Competenze).",
                wasSection: "COSA: Raggiungere obiettivi",
                wasPercent: "50% del GPS",
                wasScoreLabel: "COSA Score",
                goalName: "Obiettivo",
                goalWeight: "Peso (%)",
                goalAchievement: "Raggiungimento (%)",
                addGoal: "Aggiungi obiettivo",
                removeGoal: "Rimuovi",
                competencyWeight: "Peso",
                totalWeight: "Peso totale",
                shouldBe100: "dovrebbe essere 100%",
                wieCore: "COME: Competenze Chiave",
                wieLeadership: "COME: Competenze di Leadership",
                score: "Punteggio",
                addLeadership: "Aggiungi Competenze di Leadership",
                leadershipActive: "Attivato (Manager)",
                leadershipOptional: "Opzionale",
                globalPerformanceScore: "Global Performance Score",
                theMath: "Il Calcolo: Formula",
                wasGoals: "COSA (Obiettivi)",
                wieCompetencies: "COME (Competenze)",
                wieCore2: "COME (Chiave)",
                wieLeader: "COME (Lead)",
                gpsTotal: "GPS TOTALE",
                resetSimulator: "Resetta simulatore",
                // GPS Erklärungsseite
                gpsExplainerTitle: "Il Global Performance Score (GPS)",
                gpsExplainerSubtitle: "Come funziona la nostra valutazione delle prestazioni",
                gpsIntroTitle: "Il nostro approccio equilibrato",
                gpsIntroText: "L'Annual Performance Review si basa su un approccio equilibrato. Valutiamo non solo COSA è stato raggiunto, ma anche COME è stato raggiunto. Questa combinazione viene definita Global Performance Score e garantisce che vengano considerati non solo i risultati, ma anche il modo in cui sono stati ottenuti.",
                gpsFormulaTitle: "La Formula GPS",
                gpsFormulaExplain: "Il GPS si compone di tre dimensioni:",
                wasExplainTitle: "COSA: Risultati misurabili",
                wasExplainWeight: "Peso 50%",
                wasExplainText: "Misura il raggiungimento degli obiettivi. La misurazione avviene in modo oggettivo attraverso una tabella di conversione (%).",
                wasExplainExample: "Esempio: \"Obiettivo di fatturato: 500.000 € pianificati, 550.000 € raggiunti = 110%\"",
                wieExplainTitle: "COME: Comportamento & Competenze",
                wieCoreExplainWeight: "Peso 25% (Competenze Chiave)",
                wieLeadExplainWeight: "Peso 25% (Competenze di Leadership)",
                wieExplainText: "Misura le competenze sulla base di ancoraggi comportamentali (BARS). Ciò garantisce il rispetto dei nostri valori.",
                wieExplainCompetencies: "Competenze Chiave: Competenza tecnica & Applicazione • Comunicazione & Collaborazione • Capacità di problem solving • Adattabilità • Autogestione | Competenze di Leadership: Gestione & Sviluppo del personale • Pensiero strategico • Capacità decisionale • Execution & Performance Management • Gestione degli stakeholder",
                barsConversionTitle: "Conversione: Raggiungimento % → Livello BARS",
                barsConversionDesc: "La percentuale di raggiungimento viene convertita in livelli BARS (1-5):",
                performanceRatingTitle: "Valutazione delle Prestazioni (basata su GPS)",
                performanceRatingDesc: "Il valore GPS finale determina la valutazione delle prestazioni:",
                calculationExampleTitle: "Esempio di calcolo",
                calculationExampleIntro: "Ipotesi:",
                calculationStep1: "COSA (Raggiungimento obiettivi): 4,0",
                calculationStep2: "COME (Competenze Chiave): 3,2",
                calculationStep3: "COME (Competenze di Leadership): 4,0",
                calculationFormula: "Calcolo:",
                calculationResult: "Risultato: GPS = 3,8 → Supera le Aspettative (4)",
                whyGPSTitle: "Perché GPS?",
                whyGPS1Title: "Equità & Oggettività",
                whyGPS1Text: "La metodologia BARS riduce le valutazioni soggettive grazie ad ancoraggi comportamentali concreti",
                whyGPS2Title: "Allineamento Strategico",
                whyGPS2Text: "Il comportamento viene misurato in base ai nostri valori \"Veloce • Equo • Personale\"",
                whyGPS3Title: "Orientato allo Sviluppo",
                whyGPS3Text: "Esempi comportamentali chiari indicano il percorso verso il livello successivo",
                // Performance Kompass
                performanceCompassTitle: "La tua Bussola delle Prestazioni",
                performanceCompassSubtitle: "Il Global Performance Score (GPS) garantisce che misuriamo il vostro successo in modo olistico: valutiamo non solo COSA è stato raggiunto, ma anche COME è stato realizzato in linea con i nostri valori.",
                wasBoxTitle: "50% COSA",
                wasBoxSubtitle: "Obiettivi & Risultati (KPI)",
                wieBoxTitle: "50% COME",
                wieBoxSubtitle: "Comportamento & Competenze (BARS)",
                wieBoxSubtitleManager: "25% Competenze Core + 25% Leadership",
                wieBoxSubtitleEmployee: "Competenze Core (BARS)",
                managerNote: "* Per i dirigenti: Il COME si divide in 25% Competenze Core e 25% Competenze di Leadership.",
                fairnessGuarantee: "GARANZIA DI EQUITÀ: VALUTAZIONE CALIBRATA",
                barsRanges: {
                    outstanding: "Eccellente (>130%)",
                    exceeded: "Superato (111-130%)",
                    baseline: "Baseline (90-110%)",
                    partial: "Parziale (70-89%)",
                    notReached: "Non raggiunto (<70%)"
                },
                ratings: {
                    outstanding: "Bonus Massimo / Aumento Salariale",
                    exceeds: "Bonus Base / Aumento",
                    meets: "Standard / Nessun Bonus",
                    needs: "Supervisione Stretta / PIP",
                    doesNot: "Escalation Immediata"
                }
            },
            en: {
                title: "Performance Manager",
                welcome: "Welcome",
                intro: "This is your interactive guide for the ",
                introBold: "Niederwieser Performance Review",
                introEnd: ". Here you will find all behavioral anchors, definitions, and examples to objectively assess performance.",
                strategyTitle: "Strategy & Vision",
                strategySubtitle: "Focus on Transformation",
                strategyDesc: "Our core values Fast, Fair & Personal are the compass towards Strategy 2035. With the Performance Review, we create transparency to objectively evaluate individual results (WHAT) and competencies (HOW), focusing all efforts on the common goal: development into the ",
                strategyBold: "Smartest Solution Provider",
                strategyEnd: ".",
                barsTitle: "How does BARS work?",
                barsDesc: "Behaviorally Anchored Rating Scales: We evaluate behavior, not personality. Use the guide to understand the difference between \"Standard\" (3) and \"Role Model\" (5).",
                btnCompetencies: "View Competencies",
                coreComp: "Core Competencies (For Everyone)",
                leadComp: "Leadership Competencies (Managers)",
                back: "← Back to Overview",
                selectScore: "Select a Score",
                example: "Practical Example",
                dashboard: "Dashboard",
                competencies: "Competencies",
                simulator: "GPS Simulator",
                gpsExplainer: "GPS Formula",
                formular: "Appraisal Form",
                zielvereinbarung: "Goal Agreement",
                level1: "Does Not Meet",
                level2: "Needs Improvement",
                level3: "Baseline (Standard)",
                level4: "Exceeds Expectations",
                level5: "Outstanding / Role Model",
                // GPS Simulator Texts
                gpsSimTitle: "GPS Simulator: Test Calculation",
                gpsSimDesc: "Test the formula by rating WHAT (Goals) and HOW (Competencies).",
                wasSection: "WHAT: Achieve Goals",
                wasPercent: "50% of GPS",
                wasScoreLabel: "WHAT Score",
                goalName: "Goal",
                goalWeight: "Weight (%)",
                goalAchievement: "Achievement (%)",
                addGoal: "Add Goal",
                removeGoal: "Remove",
                competencyWeight: "Weight",
                totalWeight: "Total Weight",
                shouldBe100: "should be 100%",
                wieCore: "HOW: Core Competencies",
                wieLeadership: "HOW: Leadership Competencies",
                score: "Score",
                addLeadership: "Add Leadership Competencies",
                leadershipActive: "Activated (Manager)",
                leadershipOptional: "Optional",
                globalPerformanceScore: "Global Performance Score",
                theMath: "The Math: Calculation",
                wasGoals: "WHAT (Goals)",
                wieCompetencies: "HOW (Competencies)",
                wieCore2: "HOW (Core)",
                wieLeader: "HOW (Lead)",
                gpsTotal: "GPS TOTAL",
                resetSimulator: "Reset Simulator",
                // GPS Explainer Page
                gpsExplainerTitle: "The Global Performance Score (GPS)",
                gpsExplainerSubtitle: "How Our Performance Evaluation Works",
                gpsIntroTitle: "Our Balanced Approach",
                gpsIntroText: "The Annual Performance Review is based on a balanced approach. We evaluate not only WHAT was achieved, but also HOW it was achieved. This combination is called the Global Performance Score and ensures that not only results count, but also the way these results were achieved.",
                gpsFormulaTitle: "The GPS Formula",
                gpsFormulaExplain: "The GPS consists of three dimensions:",
                wasExplainTitle: "WHAT: Measurable Results",
                wasExplainWeight: "50% Weight",
                wasExplainText: "Measures goal achievement. Measurement is objective through a conversion table (%).",
                wasExplainExample: "Example: \"Revenue target: €500,000 planned, €550,000 achieved = 110%\"",
                wieExplainTitle: "HOW: Behavior & Competencies",
                wieCoreExplainWeight: "25% Weight (Core Competencies)",
                wieLeadExplainWeight: "25% Weight (Leadership Competencies)",
                wieExplainText: "Measures competencies based on behavioral anchors (BARS). This ensures adherence to our values.",
                wieExplainCompetencies: "Core Competencies: Technical Expertise & Application • Communication & Collaboration • Problem-Solving Skills • Adaptability • Self-Organization | Leadership Competencies: Employee Management & Development • Strategic Thinking • Decision-Making • Execution & Performance Management • Stakeholder Management",
                barsConversionTitle: "Conversion: Achievement % → BARS Level",
                barsConversionDesc: "The achievement percentage is converted to BARS levels (1-5):",
                performanceRatingTitle: "Performance Rating (based on GPS)",
                performanceRatingDesc: "The final GPS value determines the performance rating:",
                calculationExampleTitle: "Calculation Example",
                calculationExampleIntro: "Assumptions:",
                calculationStep1: "WHAT (Goal Achievement): 4.0",
                calculationStep2: "HOW (Core Competencies): 3.2",
                calculationStep3: "HOW (Leadership Competencies): 4.0",
                calculationFormula: "Calculation:",
                calculationResult: "Result: GPS = 3.8 → Exceeds Expectations (4)",
                whyGPSTitle: "Why GPS?",
                whyGPS1Title: "Fairness & Objectivity",
                whyGPS1Text: "BARS methodology reduces subjective assessments through concrete behavioral anchors",
                whyGPS2Title: "Strategic Alignment",
                whyGPS2Text: "Behavior is measured against our values \"Fast • Fair • Personal\"",
                whyGPS3Title: "Development-Oriented",
                whyGPS3Text: "Clear behavioral examples show the path to the next level",
                // Performance Compass
                performanceCompassTitle: "Your Performance Compass",
                performanceCompassSubtitle: "The Global Performance Score (GPS) ensures that we measure your success holistically: We evaluate not only WHAT was achieved, but also HOW it was implemented in line with our values.",
                wasBoxTitle: "50% WHAT",
                wasBoxSubtitle: "Goals & Results (KPIs)",
                wieBoxTitle: "50% HOW",
                wieBoxSubtitle: "Behavior & Competencies (BARS)",
                wieBoxSubtitleManager: "25% Core Competencies + 25% Leadership",
                wieBoxSubtitleEmployee: "Core Competencies (BARS)",
                managerNote: "* For managers: The HOW splits into 25% Core Competencies and 25% Leadership Competencies.",
                fairnessGuarantee: "FAIRNESS GUARANTEE: CALIBRATED ASSESSMENT",
                barsRanges: {
                    outstanding: "Outstanding (>130%)",
                    exceeded: "Exceeded (111-130%)",
                    baseline: "Baseline (90-110%)",
                    partial: "Partial (70-89%)",
                    notReached: "Not Reached (<70%)"
                },
                ratings: {
                    outstanding: "Top Bonus / Salary Jump",
                    exceeds: "Base Bonus / Salary Increase",
                    meets: "Standard Round / No Bonus",
                    needs: "Close Supervision / PIP",
                    doesNot: "Immediate Escalation"
                }
            }
        };

        // --- FORM TEXT FOR APPRAISAL FORM ---
        const FORM_TEXT = {
            de: {
                headerTitle: "Jahresgespräch & Performance Review",
                headerSubtitle: "Annual Performance Review | Strategie 2035",
                partA: "Teil A: Gesprächsdaten",
                formType: "Art des Formulars",
                formTypeSelf: "Selbstreflexion (Mitarbeiter:in)",
                formTypeManager: "Beurteilung (Führungskraft)",
                selfReflectionNote: "⚠️ Bitte sende diese Selbstreflexion mindestens eine Woche vor dem Gespräch an deine Führungskraft.",
                partB: "Teil B: Zielerreichung (WAS) – 50% Gewichtung",
                partC: "Teil C: Kern-Kompetenzen (WIE)",
                compName: "Kompetenz",
                partCLead: "Teil C.2: Leadership-Kompetenzen",
                partC3: "Teil C.3: Global Performance Score (GPS)",
                partD: "Teil D: Stärken & Entwicklungsplanung",
                partE: "Teil E: Karriereperspektive & Zielvorstellungen",
                partF: "Teil F: Mitarbeiter-Feedback",
                partH: "Teil G: Unterschriften & Einverständnis",
                employee: "Mitarbeiter:in (Name, Vorname)",
                position: "Stellenbezeichnung / Funktion",
                manager: "Führungskraft (Name, Vorname)",
                date: "Gesprächsdatum",
                period: "Bewertungszeitraum",
                to: "bis",
                hintGPS: "Hinweis: Der GPS wird hier interaktiv berechnet. Übertragen Sie die finalen Werte aus der Kalibrierung.",
                profile: "Profil / Rolle",
                roleEmp: "Mitarbeitende (50% WAS / 50% Kern-Komp.)",
                roleMgr: "Führungskraft (50% WAS / 25% Kern / 25% Lead)",
                goalName: "Zielbezeichnung",
                weight: "Gewicht %",
                achievement: "Erreichung %",
                barsLevel: "BARS-Note",
                strengths: "D.1 Identifizierte Stärken",
                strengthsProfessional: "Fachliche Stärken (Was gelingt besonders gut?):",
                strengthsPersonal: "Persönliche Stärken (Welche Verhaltenskompetenzen zeichnen besonders aus?):",
                development: "D.2 Entwicklungsfelder & Maßnahmen",
                devIntro: "Welche Kompetenzen sollen gestärkt werden?",
                measure: "Maßnahme",
                responsible: "Verantwortlich",
                deadline: "Umsetzung bis",
                careerIntro: "Welche Zielvorstellungen hat der/die Mitarbeiter:in?",
                careerOptions: [
                    "Weiterentwicklung in höherwertige Tätigkeit",
                    "Vertiefung in der aktuellen Rolle (Spezialist:in)",
                    "Führungskarriere anstreben",
                    "Lateraler Move (anderer Bereich)",
                    "Beibehaltung der aktuellen Tätigkeit (keine Veränderung gewünscht)"
                ],
                comments: "Erläuterung:",
                feedbackIntro: "Bitte teile deine Einschätzung zur Zusammenarbeit, den Arbeitsbedingungen und Entwicklungsmöglichkeiten mit.",
                feedbackQ1: "1. Fühlst du dich ausreichend unterstützt und gefördert?",
                feedbackQ2: "2. Welche Verbesserungsvorschläge hast du (Prozesse, Tools, Arbeitsbedingungen)?",
                feedbackQ3: "3. Auf welche größeren Schwierigkeiten bist du dieses Jahr gestoßen?",
                feedbackQ4: "4. Was war dein größter persönlicher Erfolgsmoment?",
                feedbackQ5: "5. Wie nimmst du die Änderung der Unternehmensstrategie wahr?",
                feedbackQ6: "6. Welche Projekte würdest du für deine Abteilung vorschlagen?",
                feedbackQ7: "7. Wie bewertest du deine Work-Life-Balance? (1=sehr schlecht, 5=sehr gut)",
                signatureNote: "Mit der Unterschrift wird bestätigt, dass das Gespräch stattgefunden hat.",
                signatureEmp: "Unterschrift Mitarbeiter:in",
                signatureMgr: "Unterschrift Führungskraft",
                print: "Als PDF herunterladen",
                generating: "Erstelle PDF...",
                calcAuto: "Automatisch berechnet",
                totalWas: "WAS-Score",
                totalWie: "WIE-Score",
                addGoal: "Ziel hinzufügen",
                addDev: "Maßnahme hinzufügen",
                addComp: "Kompetenz hinzufügen",
                totalWeight: "Gesamtgewicht",
                shouldBe100: "sollte 100% sein",
                rating: "Rating",
                comment: "Kommentar / Begründung",
                barsCompetency: {
                    fach: {
                        1: "Erfüllt nicht – Fehlerhaft, kein fachliches Fundament",
                        2: "Verbesserungsbedarf – Standardprozesse okay, bei Abweichungen überfordert",
                        3: "Baseline – Souverän, selbstständig, qualitativ hochwertig",
                        4: "Übertrifft – Durchdringt komplexe Zusammenhänge, agiert präventiv",
                        5: "Herausragend – Fachliche Autorität, standortübergreifend anerkannt"
                    },
                    komm: {
                        1: "Erfüllt nicht – Kapselt sich ab, Absicherungs-Mentalität",
                        2: "Verbesserungsbedarf – Reaktiv, ineffiziente Kanäle",
                        3: "Baseline – Proaktiv, wertschätzend, teilt Wissen bereitwillig",
                        4: "Übertrifft – Schafft Verständnis, baut Silos ab, vermittelt bei Konflikten",
                        5: "Herausragend – Etabliert neue Standards, Netzwerk des Vertrauens"
                    },
                    prob: {
                        1: "Erfüllt nicht – Blockiert, wartet passiv auf Lösung von außen",
                        2: "Verbesserungsbedarf – Bearbeitet Symptome, eskaliert zu früh",
                        3: "Baseline – Analysiert strukturiert, findet pragmatische Lösungen",
                        4: "Übertrifft – Erkennt Muster, denkt in Lösungsalternativen",
                        5: "Herausragend – Löst strategische Probleme, Vorbild bei Krisen"
                    },
                    adapt: {
                        1: "Erfüllt nicht – Sträubt sich gegen Veränderungen",
                        2: "Verbesserungsbedarf – Wenig Eigeninitiative zur Weiterbildung",
                        3: "Baseline – Neugierig, reflektiert, passt sich zügig an",
                        4: "Übertrifft – Sucht aktiv Wissen, Katalysator für Neues",
                        5: "Herausragend – Antizipiert Trends, bereitet Organisation vor"
                    },
                    orga: {
                        1: "Erfüllt nicht – Chaotisch, hält Fristen nicht ein",
                        2: "Verbesserungsbedarf – Funktioniert unter Führung, bei Autonomie unsicher",
                        3: "Baseline – Organisiert, priorisiert, hält Commitments ein",
                        4: "Übertrifft – Vorausschauend, optimiert Prozesse, entlastet andere",
                        5: "Herausragend – Koordiniert komplexe Vorhaben, setzt Maßstäbe"
                    },
                    lead: {
                        1: "Erfüllt nicht – Kein Commitment zum Team, Mikromanagement",
                        2: "Verbesserungsbedarf – Führt nur 'gefällige' Gespräche",
                        3: "Baseline – Gibt klare Richtung, fördert individuell, coacht",
                        4: "Übertrifft – Strategisches Teamdesign, entwickelt High Performer",
                        5: "Herausragend – Baut standortübergreifende Führungskultur auf"
                    },
                    strat: {
                        1: "Erfüllt nicht – Tunnelblick, keine Weitsicht",
                        2: "Verbesserungsbedarf – Tagesgeschäft dominiert, wenig Bezug zur Strategie",
                        3: "Baseline – Übersetzt Strategie in Bereichsziele, zeigt Zusammenhänge",
                        4: "Übertrifft – Antizipiert Entwicklungen, fordert Status quo heraus",
                        5: "Herausragend – Prägt strategische Ausrichtung, M&A-Kompetenz"
                    },
                    decide: {
                        1: "Erfüllt nicht – Vermeidet Entscheidungen, delegiert ständig nach oben",
                        2: "Verbesserungsbedarf – Entscheidet nur bei perfekter Info-Lage",
                        3: "Baseline – Entscheidet zügig, transparent, steht zu Entscheidungen",
                        4: "Übertrifft – Trifft auch unbequeme Entscheidungen, dosiert Risiko klug",
                        5: "Herausragend – Entscheidet strategisch mit Mut, bei Unsicherheit souverän"
                    },
                    exec: {
                        1: "Erfüllt nicht – Plant nicht, keine Verbindlichkeit",
                        2: "Verbesserungsbedarf – Nachverfolgung inkonsistent, lässt nachsichtig durchgehen",
                        3: "Baseline – Klare Ziele, nachvollziehbare Erwartungen, fordert ein",
                        4: "Übertrifft – Stringent, balanciert Druck & Förderung, denkt in KPIs",
                        5: "Herausragend – Performance-Kultur über Standorte hinweg"
                    },
                    stake: {
                        1: "Erfüllt nicht – Ignoriert Stakeholder, provoziert Konflikte",
                        2: "Verbesserungsbedarf – Reagiert nur auf Eskalationen",
                        3: "Baseline – Pflegt proaktiv Beziehungen, moderiert sachlich",
                        4: "Übertrifft – Orchestriert Stakeholder, findet Win-Win-Lösungen",
                        5: "Herausragend – Diplomatie auf Executive-Level, verhindert Eskalationen"
                    }
                }
            },
            it: {
                headerTitle: "Colloquio Annuale & Performance Review",
                headerSubtitle: "Annual Performance Review | Strategia 2035",
                partA: "Parte A: Dati del Colloquio",
                formType: "Tipo di modulo",
                formTypeSelf: "Autoriflessione (Collaboratore)",
                formTypeManager: "Valutazione (Manager)",
                selfReflectionNote: "⚠️ Si prega di inviare questa autoriflessione al proprio manager almeno una settimana prima del colloquio.",
                partB: "Parte B: Raggiungimento Obiettivi (COSA) – Peso 50%",
                partC: "Parte C: Competenze Chiave (COME)",
                compName: "Competenza",
                partCLead: "Parte C.2: Competenze Leadership",
                partC3: "Parte C.3: Global Performance Score (GPS)",
                partD: "Parte D: Punti di forza & Pianificazione Sviluppo",
                partE: "Parte E: Prospettiva di carriera & Obiettivi",
                partF: "Parte F: Feedback del Collaboratore",
                partH: "Parte G: Firme & Accettazione",
                employee: "Collaboratore (Cognome, Nome)",
                position: "Posizione / Funzione",
                manager: "Responsabile (Cognome, Nome)",
                date: "Data del colloquio",
                period: "Periodo di valutazione",
                to: "al",
                hintGPS: "Nota: Il GPS viene calcolato interattivamente qui. Trasferire i valori finali dalla calibrazione.",
                profile: "Profilo / Ruolo",
                roleEmp: "Collaboratore (50% COSA / 50% Comp. Chiave)",
                roleMgr: "Manager (50% COSA / 25% Chiave / 25% Lead)",
                goalName: "Descrizione Obiettivo",
                weight: "Peso %",
                achievement: "Raggiunto %",
                barsLevel: "Voto BARS",
                strengths: "D.1 Punti di forza identificati",
                strengthsProfessional: "Punti di forza tecnici (Cosa riesce particolarmente bene?):",
                strengthsPersonal: "Punti di forza personali (Quali competenze comportamentali si distinguono?):",
                development: "D.2 Aree di sviluppo & Misure",
                devIntro: "Quali competenze devono essere rafforzate?",
                measure: "Misura",
                responsible: "Responsabile",
                deadline: "Attuazione entro",
                careerIntro: "Quali obiettivi di carriera ha il collaboratore?",
                careerOptions: [
                    "Sviluppo verso attività di livello superiore",
                    "Approfondimento nel ruolo attuale (Specialista)",
                    "Aspirazione alla carriera manageriale",
                    "Spostamento laterale (altro settore)",
                    "Mantenimento dell'attività attuale (nessun cambiamento desiderato)"
                ],
                comments: "Spiegazione:",
                feedbackIntro: "Condividi la tua valutazione sulla collaborazione, le condizioni di lavoro e le opportunità di sviluppo.",
                feedbackQ1: "1. Ti senti sufficientemente supportato e incoraggiato?",
                feedbackQ2: "2. Quali suggerimenti di miglioramento hai (processi, strumenti, condizioni di lavoro)?",
                feedbackQ3: "3. Quali difficoltà maggiori hai incontrato quest'anno?",
                feedbackQ4: "4. Qual è stato il tuo più grande momento di successo personale?",
                feedbackQ5: "5. Come percepisci il cambiamento della strategia aziendale?",
                feedbackQ6: "6. Quali progetti proporresti per il tuo reparto?",
                feedbackQ7: "7. Come valuti il tuo equilibrio vita-lavoro? (1=molto scarso, 5=molto buono)",
                signatureNote: "La firma conferma che il colloquio ha avuto luogo.",
                signatureEmp: "Firma Collaboratore",
                signatureMgr: "Firma Responsabile",
                print: "Scarica come PDF",
                generating: "Generazione PDF...",
                calcAuto: "Calcolato automaticamente",
                totalWas: "Score COSA",
                totalWie: "Score COME",
                addGoal: "Aggiungi Obiettivo",
                addDev: "Aggiungi Misura",
                addComp: "Aggiungi Competenza",
                totalWeight: "Peso Totale",
                shouldBe100: "dovrebbe essere 100%",
                rating: "Rating",
                comment: "Commento / Motivazione",
                barsCompetency: {
                    fach: {
                        1: "Non soddisfa – Lacune evidenti, nessuna base tecnica",
                        2: "Necessita miglioramento – Processi standard ok, in difficoltà con deviazioni",
                        3: "Baseline – Autonomo, affidabile, alta qualità",
                        4: "Supera – Padroneggia contesti complessi, agisce preventivamente",
                        5: "Eccezionale – Autorità tecnica, riconosciuto tra sedi"
                    },
                    komm: {
                        1: "Non soddisfa – Si isola, mentalità difensiva",
                        2: "Necessita miglioramento – Reattivo, canali inefficienti",
                        3: "Baseline – Proattivo, rispettoso, condivide conoscenze",
                        4: "Supera – Crea comprensione, abbatte silos, media conflitti",
                        5: "Eccezionale – Stabilisce nuovi standard, rete di fiducia"
                    },
                    prob: {
                        1: "Non soddisfa – Blocca, attende passivamente soluzioni esterne",
                        2: "Necessita miglioramento – Tratta sintomi, escalation prematura",
                        3: "Baseline – Analizza strutturalmente, trova soluzioni pragmatiche",
                        4: "Supera – Riconosce pattern, pensa in alternative",
                        5: "Eccezionale – Risolve problemi strategici, modello nelle crisi"
                    },
                    adapt: {
                        1: "Non soddisfa – Resiste ai cambiamenti",
                        2: "Necessita miglioramento – Poca iniziativa per formazione",
                        3: "Baseline – Curioso, riflette, si adatta rapidamente",
                        4: "Supera – Cerca attivamente conoscenza, catalizzatore per novità",
                        5: "Eccezionale – Anticipa trend, prepara organizzazione"
                    },
                    orga: {
                        1: "Non soddisfa – Caotico, non rispetta scadenze",
                        2: "Necessita miglioramento – Funziona sotto guida, insicuro in autonomia",
                        3: "Baseline – Organizzato, prioritizza, mantiene impegni",
                        4: "Supera – Previdente, ottimizza processi, alleggerisce altri",
                        5: "Eccezionale – Coordina progetti complessi, stabilisce standard"
                    },
                    lead: {
                        1: "Non soddisfa – Nessun impegno per team, micromanagement",
                        2: "Necessita miglioramento – Conduce solo conversazioni 'comode'",
                        3: "Baseline – Direzione chiara, sviluppo individuale, coaching",
                        4: "Supera – Design strategico team, sviluppa high performer",
                        5: "Eccezionale – Costruisce cultura leadership cross-site"
                    },
                    strat: {
                        1: "Non soddisfa – Visione tunnel, nessuna lungimiranza",
                        2: "Necessita miglioramento – Domina operatività, poco legame strategico",
                        3: "Baseline – Traduce strategia in obiettivi, mostra connessioni",
                        4: "Supera – Anticipa sviluppi, sfida status quo",
                        5: "Eccezionale – Plasma direzione strategica, competenza M&A"
                    },
                    decide: {
                        1: "Non soddisfa – Evita decisioni, delega sempre verso l'alto",
                        2: "Necessita miglioramento – Decide solo con informazioni perfette",
                        3: "Baseline – Decide rapidamente, trasparente, sostiene decisioni",
                        4: "Supera – Prende decisioni scomode, dosa rischio intelligentemente",
                        5: "Eccezionale – Decide strategicamente con coraggio, sovrano nell'incertezza"
                    },
                    exec: {
                        1: "Non soddisfa – Non pianifica, nessuna affidabilità",
                        2: "Necessita miglioramento – Follow-up incoerente, troppo indulgente",
                        3: "Baseline – Obiettivi chiari, aspettative comprensibili, richiede risultati",
                        4: "Supera – Rigoroso, bilancia pressione & supporto, pensa in KPI",
                        5: "Eccezionale – Cultura performance cross-site"
                    },
                    stake: {
                        1: "Non soddisfa – Ignora stakeholder, provoca conflitti",
                        2: "Necessita miglioramento – Reagisce solo a escalation",
                        3: "Baseline – Coltiva relazioni proattivamente, modera oggettivamente",
                        4: "Supera – Orchestra stakeholder, trova soluzioni win-win",
                        5: "Eccezionale – Diplomazia executive-level, previene escalation"
                    }
                }
            },
            en: {
                headerTitle: "Annual Meeting & Performance Review",
                headerSubtitle: "Annual Performance Review | Strategy 2035",
                partA: "Part A: Meeting Data",
                formType: "Form Type",
                formTypeSelf: "Self-Reflection (Employee)",
                formTypeManager: "Assessment (Manager)",
                selfReflectionNote: "⚠️ Please send this self-reflection to your manager at least one week before the meeting.",
                partB: "Part B: Goal Achievement (WHAT) – 50% Weight",
                partC: "Part C: Core Competencies (HOW)",
                compName: "Competency",
                partCLead: "Part C.2: Leadership Competencies",
                partC3: "Part C.3: Global Performance Score (GPS)",
                partD: "Part D: Strengths & Development Planning",
                partE: "Part E: Career Perspective & Goals",
                partF: "Part F: Employee Feedback",
                partH: "Part G: Signatures & Agreement",
                employee: "Employee (Last Name, First Name)",
                position: "Position / Function",
                manager: "Manager (Last Name, First Name)",
                date: "Meeting Date",
                period: "Evaluation Period",
                to: "to",
                hintGPS: "Note: The GPS is calculated interactively here. Transfer the final values from calibration.",
                profile: "Profile / Role",
                roleEmp: "Employee (50% WHAT / 50% Core Comp.)",
                roleMgr: "Manager (50% WHAT / 25% Core / 25% Lead)",
                goalName: "Goal Description",
                weight: "Weight %",
                achievement: "Achievement %",
                barsLevel: "BARS Score",
                strengths: "D.1 Identified Strengths",
                strengthsProfessional: "Professional Strengths (What works particularly well?):",
                strengthsPersonal: "Personal Strengths (Which behavioral competencies stand out?):",
                development: "D.2 Development Areas & Measures",
                devIntro: "Which competencies should be strengthened?",
                measure: "Measure",
                responsible: "Responsible",
                deadline: "Implementation by",
                careerIntro: "What career goals does the employee have?",
                careerOptions: [
                    "Development into higher-level activity",
                    "Deepening in current role (Specialist)",
                    "Pursue leadership career",
                    "Lateral move (different area)",
                    "Maintain current activity (no change desired)"
                ],
                comments: "Explanation:",
                feedbackIntro: "Please share your assessment of collaboration, working conditions, and development opportunities.",
                feedbackQ1: "1. Do you feel sufficiently supported and encouraged?",
                feedbackQ2: "2. What improvement suggestions do you have (processes, tools, working conditions)?",
                feedbackQ3: "3. What major difficulties did you encounter this year?",
                feedbackQ4: "4. What was your greatest personal moment of success?",
                feedbackQ5: "5. How do you perceive the change in company strategy?",
                feedbackQ6: "6. What projects would you propose for your department?",
                feedbackQ7: "7. How do you rate your work-life balance? (1=very poor, 5=very good)",
                signatureNote: "The signature confirms that the meeting took place.",
                signatureEmp: "Employee Signature",
                signatureMgr: "Manager Signature",
                print: "Download as PDF",
                generating: "Generating PDF...",
                calcAuto: "Calculated automatically",
                totalWas: "WHAT Score",
                totalWie: "HOW Score",
                addGoal: "Add Goal",
                addDev: "Add Measure",
                addComp: "Add Competency",
                totalWeight: "Total Weight",
                shouldBe100: "should be 100%",
                rating: "Rating",
                comment: "Comment / Justification",
                barsCompetency: {
                    fach: {
                        1: "Does Not Meet – Faulty, no professional foundation",
                        2: "Needs Improvement – Standard processes okay, overwhelmed with deviations",
                        3: "Baseline – Confident, independent, high quality",
                        4: "Exceeds – Masters complex contexts, acts preventively",
                        5: "Outstanding – Professional authority, recognized across locations"
                    },
                    komm: {
                        1: "Does Not Meet – Isolates themselves, defensive mentality",
                        2: "Needs Improvement – Reactive, inefficient channels",
                        3: "Baseline – Proactive, respectful, shares knowledge willingly",
                        4: "Exceeds – Creates understanding, breaks down silos, mediates conflicts",
                        5: "Outstanding – Establishes new standards, network of trust"
                    },
                    prob: {
                        1: "Does Not Meet – Blocks, passively waits for external solutions",
                        2: "Needs Improvement – Addresses symptoms, escalates too early",
                        3: "Baseline – Analyzes structurally, finds pragmatic solutions",
                        4: "Exceeds – Recognizes patterns, thinks in solution alternatives",
                        5: "Outstanding – Solves strategic problems, role model in crises"
                    },
                    adapt: {
                        1: "Does Not Meet – Resists changes",
                        2: "Needs Improvement – Little initiative for further training",
                        3: "Baseline – Curious, reflective, adapts quickly",
                        4: "Exceeds – Actively seeks knowledge, catalyst for new things",
                        5: "Outstanding – Anticipates trends, prepares organization"
                    },
                    orga: {
                        1: "Does Not Meet – Chaotic, misses deadlines",
                        2: "Needs Improvement – Functions under guidance, insecure with autonomy",
                        3: "Baseline – Organized, prioritizes, keeps commitments",
                        4: "Exceeds – Forward-thinking, optimizes processes, relieves others",
                        5: "Outstanding – Coordinates complex projects, sets standards"
                    },
                    lead: {
                        1: "Does Not Meet – No team commitment, micromanagement",
                        2: "Needs Improvement – Only conducts 'comfortable' conversations",
                        3: "Baseline – Clear direction, individual development, coaching",
                        4: "Exceeds – Strategic team design, develops high performers",
                        5: "Outstanding – Builds cross-site leadership culture"
                    },
                    strat: {
                        1: "Does Not Meet – Tunnel vision, no foresight",
                        2: "Needs Improvement – Dominated by operations, little strategic connection",
                        3: "Baseline – Translates strategy into goals, shows connections",
                        4: "Exceeds – Anticipates developments, challenges status quo",
                        5: "Outstanding – Shapes strategic direction, M&A competence"
                    },
                    decide: {
                        1: "Does Not Meet – Avoids decisions, always delegates upward",
                        2: "Needs Improvement – Only decides with perfect information",
                        3: "Baseline – Decides quickly, transparent, stands by decisions",
                        4: "Exceeds – Makes uncomfortable decisions, intelligently manages risk",
                        5: "Outstanding – Decides strategically with courage, sovereign in uncertainty"
                    },
                    exec: {
                        1: "Does Not Meet – No planning, no reliability",
                        2: "Needs Improvement – Inconsistent follow-up, too lenient",
                        3: "Baseline – Clear goals, understandable expectations, demands results",
                        4: "Exceeds – Rigorous, balances pressure & support, thinks in KPIs",
                        5: "Outstanding – Cross-site performance culture"
                    },
                    stake: {
                        1: "Does Not Meet – Ignores stakeholders, provokes conflicts",
                        2: "Needs Improvement – Only reacts to escalations",
                        3: "Baseline – Proactively cultivates relationships, moderates objectively",
                        4: "Exceeds – Orchestrates stakeholders, finds win-win solutions",
                        5: "Outstanding – Executive-level diplomacy, prevents escalations"
                    }
                }
            }
        };

        const CORE_COMPETENCIES_CALC = [
          { id: 'fach', name: 'Fachkompetenz & Anwendung', nameIt: 'Competenza tecnica & Applicazione', nameEn: 'Technical Expertise & Application', weight: 20 },
          { id: 'komm', name: 'Kommunikation & Zusammenarbeit', nameIt: 'Comunicazione & Collaborazione', nameEn: 'Communication & Collaboration', weight: 20 },
          { id: 'prob', name: 'Problemlösekompetenz', nameIt: 'Capacità di problem solving', nameEn: 'Problem-Solving Skills', weight: 20 },
          { id: 'adapt', name: 'Anpassungsfähigkeit', nameIt: 'Adattabilità', nameEn: 'Adaptability', weight: 20 },
          { id: 'orga', name: 'Selbstorganisation', nameIt: 'Autogestione', nameEn: 'Self-Organization', weight: 20 },
        ];

        const LEADERSHIP_COMPETENCIES_CALC = [
          { id: 'lead', name: 'Mitarbeiterführung & -entwicklung', nameIt: 'Gestione & Sviluppo del personale', nameEn: 'Employee Management & Development', weight: 20 },
          { id: 'strat', name: 'Strategisches Denken', nameIt: 'Pensiero strategico', nameEn: 'Strategic Thinking', weight: 20 },
          { id: 'decide', name: 'Entscheidungsfähigkeit', nameIt: 'Capacità decisionale', nameEn: 'Decision-Making', weight: 20 },
          { id: 'exec', name: 'Execution & Performance Mgmt', nameIt: 'Execution & Performance Mgmt', nameEn: 'Execution & Performance Mgmt', weight: 20 },
          { id: 'stake', name: 'Stakeholder-Mgmt & Konflikte', nameIt: 'Gestione degli stakeholder & Conflitti', nameEn: 'Stakeholder Mgmt & Conflicts', weight: 20 },
        ];

        const DEFAULTS = {
            de: {
                core: CORE_COMPETENCIES_CALC.map(c => ({...c, rating: 3, comment: ''})),
                lead: LEADERSHIP_COMPETENCIES_CALC.map(c => ({...c, rating: 3, comment: ''}))
            },
            it: {
                core: CORE_COMPETENCIES_CALC.map(c => ({...c, name: c.nameIt, rating: 3, comment: ''})),
                lead: LEADERSHIP_COMPETENCIES_CALC.map(c => ({...c, name: c.nameIt, rating: 3, comment: ''}))
            },
            en: {
                core: CORE_COMPETENCIES_CALC.map(c => ({...c, name: c.nameEn, rating: 3, comment: ''})),
                lead: LEADERSHIP_COMPETENCIES_CALC.map(c => ({...c, name: c.nameEn, rating: 3, comment: ''}))
            }
        };

        // --- APPLICATION DATA (Competencies and Levels) ---
        const APP_DATA = {
          de: {
            intro: {
              values: [
                { key: "Fast", desc: "Wir agieren schnell und lösungsorientiert.", icon: Zap, color: "text-yellow-600" },
                { key: "Fair", desc: "Wir arbeiten respektvoll und auf Augenhöhe zusammen.", icon: Scale, color: "text-blue-600" },
                { key: "Personal", desc: "Wir übernehmen Verantwortung und gestalten aktiv.", icon: Heart, color: "text-red-600" }
              ]
            },
            competencies: [
            {
              id: "c1",
              title: "Fachkompetenz & Anwendung",
              category: "core",
              icon: Briefcase,
              definition: `Bewertet spezifisches Fachwissen und dessen Anwendung. Es geht nicht nur um theoretisches Können, sondern den Beitrag zu Prozesssicherheit und Qualität.`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende verfügt nicht über das für die Position zwingend erforderliche fachliche Fundament. Aufgaben werden häufig fehlerhaft oder unvollständig ausgeführt (z. B. falsche Dateneingaben, Fehlbedienung von Anlagen, Falschauskünfte an Kunden), was zu Nacharbeit, Beschwerden oder Risiken führt. Es fehlt das Verständnis für die fachlichen Standards und Regeln des eigenen Bereichs. Auch nach Einarbeitung oder Feedback treten dieselben inhaltlichen Fehler wiederholt auf. Der/die Mitarbeitende zeigt wenig Antrieb, diese Wissenslücken eigenständig zu schließen. Komplexe Zusammenhänge des eigenen Fachgebiets werden nicht durchdrungen; man verlässt sich darauf, dass andere die fachliche Richtigkeit prüfen.`, 
                  example: `Admin: Pflegt Stammdaten wiederholt falsch ein, versteht die Auswirkung auf Rechnungen nicht.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende beherrscht Standardprozesse und Routineaufgaben in seinem Fachgebiet sicher, stößt aber bei Abweichungen, Spezialfällen oder neuen Anforderungen schnell an Grenzen. Das Wissen wird eher nach „Vorschrift“ angewendet, ohne das tiefere „Warum“ oder die Auswirkungen auf angrenzende Bereiche zu verstehen. Zur Lösung von fachlichen Problemen wird primär auf Anweisung gewartet oder sofort eskaliert, anstatt vorhandene Ressourcen (Dokumentation, Recherche, System-Hilfen) zu nutzen. Die Qualität der Arbeitsergebnisse ist schwankend, insbesondere wenn es stressig wird. Fachliche Neuerungen (z.B. neue Software-Features, geänderte Kundenanforderungen) werden nur zögerlich adaptiert.`, 
                  example: `IT: Löst Standard-Passwörter, ist aber bei komplexeren Netzwerkproblemen sofort überfordert und eskaliert ohne Diagnose.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende beherrscht sein Aufgabengebiet souverän und liefert konstant qualitativ hochwertige Ergebnisse (korrekte Auftragsabwicklung, stabile Systemverfügbarkeit, präzise Werkstücke). Er/Sie arbeitet im Tagesgeschäft vollkommen selbstständig. Auftretende fachliche Probleme löst er/sie zügig eigenständig oder holt gezielt und rechtzeitig Unterstützung ein. Er/Sie ist in der Lage, sein Wissen situativ an Kollegen weiterzugeben (kurze Einweisungen, Troubleshooting-Tipps) und trägt damit zur Stabilität des Teams bei. Fachliche Standards werden konsequent eingehalten.`, 
                  example: `Produktion: Bedient Anlage fehlerfrei nach Spezifikation. Behebt kleine Störungen (Sensor-Reset, Materialstau) selbstständig innerhalb von 10 Minuten. Zeigt neuen Kollegen die kritischen Handgriffe ohne lange Erklärungen.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende durchdringt auch komplexe fachliche Zusammenhänge tiefgehend und erkennt Wechselwirkungen, die anderen entgehen (z.B. wie eine Änderung im Auftrag die Produktionsplanung beeinflusst). Er/Sie agiert präventiv: Risiken oder Fehlerquellen werden identifiziert und eliminiert, bevor sie zum Problem werden. Das Fachwissen wird genutzt, um bestehende Abläufe aktiv zu optimieren und effizienter zu gestalten. Kollegen wenden sich bei kniffligen fachlichen Fragen aktiv an diese Person („Go-to-Person“). Der/die Mitarbeitende gibt Wissen proaktiv weiter und sorgt für einen hohen Standard im Team. Er/Sie blickt über den eigenen Schreibtisch hinaus und versteht die Anforderungen der internen Schnittstellenpartner genau.`, 
                  example: `Customer Service: Prüft bei spezifischer Frage proaktiv mit Labor die Machbarkeit und schlägt sicherere Alternative vor.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende gilt als absolute fachliche Autorität auf seinem Gebiet, deren Expertise auch standortübergreifend (Sulzberg/Bozen/Campogalliano) geschätzt und angefragt wird. Er/Sie nutzt sein exzellentes Wissen, um signifikante Verbesserungen für die Gruppe zu erzielen (z. B. Einführung konzernweiter Standards im Customer Service, massive Effizienzsteigerung durch neue IT-Lösungen). Diese Person fungiert als Multiplikator. Sie bereitet komplexes Fachwissen so auf, dass es für die Organisation nutzbar wird (z.B. Schulungen, Best-Practice-Leitfäden). Er/Sie antizipiert zukünftige Entwicklungen im Fachbereich (z.B. Markttrends, neue Technologien) und bereitet das Unternehmen proaktiv darauf vor. Fachliche Exzellenz wird hier zum direkten Mehrwert für den Unternehmenserfolg.`, 
                  example: `Group Function: Entwickelt einheitlichen Service-Standard für alle Standorte (DE/IT), schult Teams, sorgt für 'One Voice'.` 
                }
              }
            },
            {
              id: "c2",
              title: "Kommunikation & Zusammenarbeit",
              category: "core",
              icon: MessageCircle,
              definition: `Qualität des Informationsaustauschs und das Miteinander. 'One Niederwieser' bedeutet: Zusammenarbeit endet nicht an der Bürotür oder Ländergrenze.`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende behält arbeitskritische Informationen für sich oder gibt sie so unvollständig weiter, dass Kollegen oder Kunden nachfragen müssen und Fehler entstehen. Er/Sie kapselt sich ab und zeigt kein Interesse an gemeinsamer Zielerreichung. Bei Problemen wird Verantwortung abgeschoben („Nicht meine Zuständigkeit") oder Unterstützung verweigert. Die Kommunikation ist geprägt von Absicherungsmentalität (CC-Schlachten) statt Lösungsorientierung. Konflikte werden ignoriert, hinter dem Rücken ausgetragen oder unsachlich eskaliert. Das Verhalten verletzt Grundwerte des Respekts und der Fairness.`, 
                  example: `Produktion: Gibt bei Schichtübergabe trotz kritischer Maschinenstörung nur „Alles ok" weiter, um schnell nach Hause zu gehen. Nachschicht entdeckt Problem erst nach 2 Stunden Stillstand.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende kommuniziert primär reaktiv: Informationen fließen oft erst auf explizite Nachfrage („Holschuld“ statt „Bringschuld“). Er/Sie fokussiert sich stark auf den eigenen Aufgabenbereich und blendet die Bedürfnisse angrenzender Abteilungen oder Kollegen aus. In Meetings oder Projekten bringt er/sie sich kaum proaktiv ein. Der gewählte Kommunikationskanal ist häufig ineffizient (z. B. langes Hin-und-Her-Schreiben bei komplexen Themen statt eines kurzen, klärenden Anrufs – entgegen dem Prinzip „Phone before Email“). Feedback wird oft persönlich genommen oder defensiv abgewehrt. Die Zusammenarbeit funktioniert im Routinebetrieb, wird aber bei Stress, Unklarheit oder abteilungsübergreifenden Themen schnell holprig.`, 
                  example: `Backoffice: Schreibt tagelang E-Mails hin und her statt den Fall in 2 Minuten telefonisch zu klären.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende informiert Kollegen und Schnittstellenpartner proaktiv, vollständig und rechtzeitig über alles Relevante (z.B. Status-Updates, Verzögerungen, Abwesenheiten). Er/Sie wählt situationsbedingt den effizientesten Kanal (greift zum Hörer, wenn Dinge schnell geklärt werden müssen). Der Umgangston ist stets wertschätzend und auf Augenhöhe, unabhängig von Hierarchie oder Standort. Er/Sie bietet Kollegen Unterstützung an, wenn Not am Mann ist, und teilt Wissen bereitwillig. In Meetings ist er/sie präsent, gut vorbereitet und konstruktiv. Konflikte werden sachlich und direkt angesprochen. Er/Sie trägt stabil zu einer positiven, professionellen Arbeitsatmosphäre bei.`, 
                  example: `Sales: Informiert bei Lieferverzug sofort Kunden und Außendienst proaktiv mit neuem Termin.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende kommuniziert nicht nur Informationen, sondern schafft Verständnis. Er/Sie passt die Kommunikation gezielt an das Gegenüber an (z. B. übersetzt technische Details für Laien, bereitet Daten für Entscheider auf) und stellt sicher, dass die Botschaft korrekt ankommt. Er/Sie agiert aktiv als Bindeglied zwischen Abteilungen und baut Silos ab. Bei Konflikten oder Missverständnissen im Team übernimmt er/sie eine vermittelnde Rolle und sucht nach einer gemeinsamen Lösung („Win-Win“), anstatt Recht haben zu wollen. Er/Sie gibt konstruktives, entwicklungsorientiertes Feedback, das anderen hilft, besser zu werden. Die Zusammenarbeit mit dieser Person macht das gesamte Umfeld messbar effizienter und motivierter.`, 
                  example: `Schnittstelle: Moderiert bei Konflikt zwischen Produktion und Service, schafft Regelung für Eilaufträge.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende etabliert neue Standards der Zusammenarbeit, die über das eigene Team hinauswirken (z. B. Initiierung regelmäßiger Austauschformate zwischen den Standorten Sulzberg und Campogalliano oder zwischen Sales und Technik). Er/Sie lebt die Werte Fast, Fair, Personal so vorbildlich, dass er/sie als Rollenmodell wirkt und andere mitreißt. Er/Sie schafft ein Netzwerk des Vertrauens im gesamten Unternehmen und nutzt dieses, um komplexe, abteilungsübergreifende Probleme schnell und unbürokratisch zu lösen. Er/Sie wird bei schwierigen Kommunikationssituationen (z. B. Change-Prozesse, Krisen) als Mentor oder Mediator hinzugezogen. Er/Sie sorgt aktiv dafür, dass wir intern und extern „mit einer Stimme“ sprechen.`, 
                  example: `HR: Initiiert standortübergreifendes Sounding Board, um kulturelle Unterschiede zwischen Bozen und Sulzberg zu klären.` 
                }
              }
            },
            {
              id: "c3",
              title: "Problemlösekompetenz",
              category: "core",
              icon: ShieldAlert,
              definition: `Umgang mit Hindernissen. Wir unterscheiden Troubleshooting (Symptome) vs. Ursachenforschung (Wurzel).`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende erkennt Probleme oft erst, wenn sie bereits eskaliert sind, oder ignoriert offensichtliche Warnsignale (z.B. Fehlermeldungen, Kundenbeschwerden, Qualitätsabweichungen). Er/Sie zeigt keine Eigeninitiative zur Lösung, sondern wartet passiv auf Anweisungen („Dienst nach Vorschrift“). Bei Schwierigkeiten wird schnell aufgegeben oder die Verantwortung auf andere (Kollegen, IT, Lieferanten) geschoben. Fehler werden vertuscht oder kleingeredet, statt sie offen anzusprechen. Es findet kein Lernen aus Fehlern statt: Das exakt gleiche Problem tritt immer wieder auf, ohne dass das Verhalten geändert wird.`, 
                  example: `Admin: Klickt Fehlermeldung im ERP einfach weg, ohne Info. Am Monatsende stimmen Zahlen nicht.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende meldet Probleme zwar („Hier stimmt was nicht“), trägt aber kaum selbst zur Lösung bei. Er/Sie verlässt sich stark auf die Führungskraft oder erfahrene Kollegen, um den Weg aus der Krise zu finden. Lösungsversuche bleiben oft an der Oberfläche: Es werden Symptome bekämpft (z. B. Maschine einfach neustarten, Kunde vertrösten), aber nicht die eigentlichen Ursachen. Sobald ein erstes Hindernis bei der Lösungsfindung auftaucht, stoppt der Prozess. Er/Sie benötigt detaillierte Anleitung, um auch Standardprobleme zu beheben. Es fehlt der Blick für die Konsequenzen: Eine „schnelle Lösung“ schafft oft an anderer Stelle neue Probleme.`, 
                  example: `Produktion: Reduziert Maschinengeschwindigkeit damit Falten verschwinden, statt mechanische Ursache zu suchen.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende erkennt Probleme im eigenen Aufgabenbereich frühzeitig und geht sie eigenständig an. Er/Sie nutzt verfügbare Informationen (Daten, Handbücher, Historie) und Werkzeuge, um pragmatische Lösungen zu finden, die funktionieren. Er/Sie unterscheidet sicher, was er/sie selbst lösen kann und wann eine Eskalation notwendig ist – informiert dann aber präzise und lösungsorientiert (kommt mit einem Vorschlag, nicht nur mit der Beschwerde). Die Lösungen sind solide und nachhaltig für den Arbeitsalltag. Er/Sie bleibt auch in stressigen Situationen handlungsfähig („Kühler Kopf“). Nach einem Fehler wird Verantwortung übernommen („Accountability“) und korrigiert, statt Ausreden zu suchen.`, 
                  example: `Customer Service: Lokalisiert fehlende Ware, informiert Kunden ehrlich, löst Konflikt professionell.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende löst nicht nur das akute Problem, sondern betreibt systematische Ursachenforschung (z.B. „5-Why“-Methode, Datenanalyse), um zu verstehen, warum es passiert ist. Er/Sie entwickelt Maßnahmen, die verhindern, dass der Fehler jemals wieder auftritt (Fehlervermeidung). Er/Sie denkt über den eigenen Bereich hinaus: Wenn ein Problem Schnittstellen betrifft (z. B. Übergabe Sales an Produktion), wird das aktiv adressiert und gelöst. Er/Sie unterstützt Kollegen bei schwierigen Herausforderungen und bringt kreative, unkonventionelle Ansätze ein, wenn Standardlösungen nicht greifen. Probleme werden als Chance zur Verbesserung begriffen.`, 
                  example: `Logistik: Analysiert Verspätungs-Daten, spricht mit Spediteur und passt Abholprozess dauerhaft an.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende identifiziert komplexe, strukturelle Probleme oder Risiken, die anderen noch gar nicht aufgefallen sind, und entwickelt dafür umfassende Konzepte. Die Lösungen haben oft positiven Einfluss auf mehrere Abteilungen oder Standorte der Gruppe (Sulzberg/Bozen/Campogalliano). Er/Sie etabliert neue Standards oder „Best Practices“ zur Problemlösung, die im Unternehmen übernommen werden. Er/Sie verwandelt Probleme in echte Innovationen oder Wettbewerbsvorteile für Niederwieser. Bei Krisen übernimmt er/sie informell die Führung („Troubleshooter“) und navigiert das Team sicher durch unsicheres Terrain.`, 
                  example: `Quality: Initiiert Task-Force für Materialfehler über Standorte hinweg, führt neuen Gruppen-Standard ein.` 
                }
              }
            },
            {
              id: "c4",
              title: "Anpassungsfähigkeit & Lernbereitschaft",
              category: "core",
              icon: BookOpen,
              definition: `Wille, sich auf neue Rahmenbedingungen (IT, Markt, Prozesse) einzustellen. 'Growth Mindset' statt Status Quo.`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende reagiert auf Neuerungen (z.B. neue Software, Umstrukturierungen) mit offener Ablehnung, Zynismus oder Blockadehaltung. Er/Sie hält starr an veralteten Methoden fest („Das haben wir schon immer so gemacht“) und weigert sich, neue Fähigkeiten zu erlernen. Veränderungen führen zu einem massiven Leistungseinbruch oder schlechter Laune, die das Team ansteckt. Er/Sie benötigt unverhältnismäßig viel Überzeugungsarbeit und Druck, um selbst kleinste Anpassungen im Arbeitsablauf umzusetzen. Feedback zur persönlichen Weiterentwicklung wird ignoriert oder als Angriff gewertet.`, 
                  example: `Lager: Weigert sich, neue Scanner zu nutzen, führt private Handlisten weiter.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende akzeptiert Veränderungen erst nach längerem Zögern oder Murren. Er/Sie wartet ab, ob die Neuerung „wirklich bleibt“, bevor er/sie sich bewegt. Das Erlernen neuer Aufgaben oder Systeme dauert deutlich länger als bei vergleichbaren Kollegen, da die innere Motivation fehlt. Er/Sie zeigt wenig Eigeninitiative zur Weiterbildung; neues Wissen wird nur angeeignet, wenn es explizit angeordnet oder „vorgekaut“ wird. In Stresssituationen oder bei unklaren neuen Anforderungen fällt er/sie schnell in alte, ineffiziente Verhaltensmuster zurück. Die Anpassungsfähigkeit reicht für dynamische Phasen nicht aus.`, 
                  example: `Finance: Druckt trotz papierlosem System weiter Mails aus. Lernt neuen Prozess nur langsam.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende geht konstruktiv mit Veränderungen um und passt seine Arbeitsweise an neue Gegebenheiten an. Er/Sie setzt neue Vorgaben (z. B. Nutzung eines neuen Tools, geänderter Schichtplan) verlässlich und ohne großes Klagen um. Die Einarbeitung in neue Themen erfolgt in angemessener Zeit. Er/Sie erkennt, wann Wissen fehlt, und nutzt die angebotenen Schulungen oder Hilfsmittel, um die Lücke zu schließen. Er/Sie blockiert Innovationen nicht, sondern trägt sie im Tagesgeschäft mit. Man kann sich darauf verlassen, dass er/sie auch in einem sich wandelnden Umfeld stabil seine Leistung bringt („Fair“ gegenüber dem Team).`, 
                  example: `Sales: Nimmt an Schulung für neue nachhaltige Folien teil und berät Kunden ab Stichtag kompetent.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende sieht Veränderungen als Chance zur Verbesserung. Er/Sie wartet nicht auf Schulungen, sondern eignet sich neues Wissen (z. B. über neue Produkte, Markttrends oder Software-Kniffe) eigenständig an. Er/Sie experimentiert mit neuen Lösungsansätzen und teilt die Erkenntnisse mit dem Team. In Phasen des Umbruchs wirkt er/sie stabilisierend auf andere und hilft Kollegen, die sich mit der Veränderung schwerer tun (z.B. als „Buddy“ bei neuen Systemen). Er/Sie hinterfragt den Status quo konstruktiv und macht Vorschläge, wie man sich besser an neue Anforderungen anpassen kann.`, 
                  example: `Service: Klickt sich schon vor Schulung durch neues CRM, hilft danach Kollegen beim Start.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende antizipiert notwendige Veränderungen oft früher als andere und bereitet sich und das Umfeld proaktiv darauf vor (z.B. Erwerb von Zukunftskompetenzen, bevor sie akut gebraucht werden). Er/Sie treibt Innovationen voran, die das Unternehmen zukunftsfähig machen (z. B. Pilotierung komplett neuer Arbeitsweisen). Er/Sie etabliert eine Kultur des Lernens im eigenen Bereich, indem er/sie Fehler als Lernchance vorlebt und andere zum Ausprobieren ermutigt („Empowerment“). Er/Sie agiert als Leuchtturm bei strategischen Großprojekten (z.B. Harmonisierung der Standorte) und schafft Begeisterung für den neuen Weg, selbst bei anfänglichen Widerständen.`, 
                  example: `IT: Initiiert eigenständig KI-Pilotprojekt (Copilot), klärt Datenschutz und schult andere Standorte.` 
                }
              }
            },
            {
              id: "c5",
              title: "Selbstorganisation & Zuverlässigkeit",
              category: "core",
              icon: Clock,
              definition: `Strukturierung der Arbeit, Priorisierung und Accountability. Kann man sich auf das Wort verlassen?`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende arbeitet unsystematisch und ohne erkennbare Struktur. Aufgaben werden vergessen, Deadlines ohne Vorwarnung gerissen oder Termine versäumt. Er/Sie lässt sich leicht ablenken und verliert den Fokus auf das Wesentliche. Die Führungskraft oder Kollegen müssen ständig nachfassen („Babysitting“), damit Ergebnisse geliefert werden. Es fehlt der Überblick über offene Aufgaben; Zusagen werden leichtfertig gemacht und nicht eingehalten. Der Arbeitsplatz (physisch oder digital) ist unorganisiert, sodass wichtige Unterlagen oder Informationen nicht griffbereit sind. Die Unzuverlässigkeit belastet das Team massiv.`, 
                  example: `Sales: Vergisst Besuchsberichte, verlegt Zettel mit Kundenanfragen. Kein Überblick.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende erledigt einfache Routineaufgaben zuverlässig, gerät aber bei mehreren parallelen Aufgaben oder Zeitdruck schnell ins Schwimmen. Er/Sie hat Schwierigkeiten, Wichtiges von Unwichtigem zu unterscheiden (macht z.B. das, was Spaß macht, zuerst, nicht das, was eilt). Planung findet nur sehr kurzfristig (von Tag zu Tag) statt. Wenn es eng wird, kommuniziert er/sie dies nicht rechtzeitig, sondern erst, wenn das Kind bereits in den Brunnen gefallen ist. Die Qualität der Arbeit leidet unter fehlender Sorgfalt oder Zeitmanagement. Er/Sie benötigt regelmäßige Steuerung und Erinnerungen durch die Führungskraft, um auf Kurs zu bleiben.`, 
                  example: `Werkstatt: Räumt auf, obwohl dringende Eil-Reparatur die Produktion blockiert.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende organisiert seinen Arbeitsalltag selbstständig und priorisiert Aufgaben sinnvoll nach Dringlichkeit und Wichtigkeit. Zusagen und Termine werden verlässlich eingehalten. Sollte eine Deadline gefährdet sein, informiert er/sie mindestens 48 Stunden im Voraus proaktiv („Transparency"). Sein Arbeitsplatz und seine Systeme sind so strukturiert, dass wichtige Informationen jederzeit in unter 2 Minuten auffindbar sind (saubere Ablage, gepflegte To-Do-Listen). Man kann sich auf sein Wort verlassen.`, 
                  example: `Admin: Hat digitale Wiedervorlage im Griff (farbcodierte Prioritäten). Meldet am Dienstag, dass Monatsabschluss wegen Krankheitsausfall im Team 2 Tage später kommt – schlägt gleichzeitig Lösung vor (Unterstützung aus anderem Standort).` 
                },
                4: { 
                  text: `Der/die Mitarbeitende plant vorausschauend (2-3 Monate im Voraus) und erkennt Engpässe, bevor sie entstehen (Urlaubszeiten, Projekt-Deadlines, Ressourcenknappheit). Er/Sie optimiert aktiv die eigene Arbeitsweise (Nutzung digitaler Tools, Checklisten, Bündelung ähnlicher Aufgaben). Er/Sie bleibt auch bei 120% Auslastung strukturiert und liefert Ergebnisse pünktlich ab. Seine Zuverlässigkeit macht ihn/sie zu einer festen Säule im Team – Kollegen wissen: „Bei X ist es sicher aufgehoben."`, 
                  example: `Projektmanagement: Erstellt 4 Wochen vor Urlaub detaillierte Übergabemappe mit Status aller Projekte, offenen Punkten und Ansprechpartnern. Bereitet kritische Aufgaben vor (Vorratsbriefings, vorgefertigte Entscheidungsvorlagen). Vertretung kann nahtlos übernehmen.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende entwickelt Organisationssysteme oder Workflows, die nicht nur ihm/ihr selbst, sondern dem ganzen Team oder der Abteilung helfen, effizienter zu arbeiten (z. B. Einführung eines Kanban-Boards, Standardisierung der Ablage für die Gruppe). Er/Sie managt hochkomplexe Aufgabenpakete mit vielen Abhängigkeiten (z. B. standortübergreifende Projekte) souverän und termingerecht. Er/Sie gilt als „sicherer Hafen“ für kritische Aufgaben: Wenn er/sie es übernimmt, ist der Erfolg garantiert. Er/Sie schafft durch exzellente Organisation Freiräume für strategische Themen und Innovationen.`, 
                  example: `Marketing: Etabliert digitales Planungstool für alle Standorte (Sulzberg/Bozen/Campo), eliminiert Doppelarbeit.` 
                }
              }
            },
            {
              id: "l1",
              title: "Mitarbeiterführung & -entwicklung", // Korrigierte Titel
              category: "leadership",
              icon: Users,
              definition: `Steuerung, Motivation und Entwicklung des Teams. 'Leadership' statt nur 'Management'.`, // Geändert für DE
              levels: {
                1: { 
                  text: `Die Führungskraft vernachlässigt ihre Kernaufgaben: Mitarbeitergespräche (Jahresgespräch, Check-ins) finden nicht statt, sind extrem verspätet oder werden als lästige Pflichtübung abgehandelt. Es gibt kein konstruktives Feedback; Kritik erfolgt oft unsachlich oder vor anderen. Entwicklungswünsche der Mitarbeitenden werden ignoriert oder blockiert („Dafür haben wir keine Zeit“). Ziele werden unklar oder gar nicht kommuniziert, was zu Orientierungslosigkeit führt. Das Verhalten widerspricht unseren Werten massiv (z.B. Respektlosigkeit, „Divide and Conquer“). Im Team herrscht eine Atmosphäre der Angst oder Gleichgültigkeit, was zu hoher Fluktuation oder innerer Kündigung führt.`, 
                  example: `Prod-Leiter: Sagt Jahresgespräch 3x ab, führt es dann in 15min zwischen Tür und Angel.` 
                },
                2: { 
                  text: `Die Führungskraft erledigt die administrativen Pflichten (Urlaubsfreigabe, formale Gespräche), aber ohne Tiefe. Feedback gibt es meist nur, wenn etwas schiefgelaufen ist (reaktiv), kaum Lob oder Orientierung für die Zukunft. Die Führungsarbeit beschränkt sich auf das Zuweisen von Aufgaben („Micromanagement“), statt Verantwortung zu delegieren. Entwicklungspläne (IDPs) werden zwar ausgefüllt, verschwinden dann aber in der Schublade und werden nicht nachverfolgt. Die Führungskraft nimmt sich zu wenig Zeit für das Team („Tür zu“). Es fehlt an Klarheit und Inspiration; das Team arbeitet „Dienst nach Vorschrift“, aber nicht mehr.`, 
                  example: `Teamleiter: Nutzt Copy-Paste für Ziele. Antwortet auf Entwicklungswunsch vage 'Schauen wir mal'.` 
                },
                3: { 
                  text: `BASELINE: Die Führungskraft führt alle verpflichtenden Gespräche (Review, Zielsetzung) pünktlich, gut vorbereitet und auf Augenhöhe durch. Sie sorgt für klare Ziele und Erwartungen, sodass jeder weiß, was zu tun ist. Feedback erfolgt regelmäßig und fair – sowohl positiv als auch korrigierend. Sie unterstützt die fachliche Weiterentwicklung (z.B. Genehmigung von Schulungen) und ist für die Mitarbeitenden bei Problemen ansprechbar. Sie lebt die Werte „Fast, Fair, Personal“ im Alltag vor und sorgt für ein stabiles, positives Arbeitsklima. Sie behandelt alle Teammitglieder gerecht und diskriminierungsfrei.`, 
                  example: `Sales Director: Regelmäßige Check-ins, lobt Erfolge, spricht Defizite offen an. Team kennt Ziele.` 
                },
                4: { 
                  text: `Die Führungskraft nutzt Führung aktiv, um Mitarbeitende besser zu machen. Sie delegiert nicht nur Aufgaben, sondern Verantwortung, um Wachstum zu ermöglichen („Empowerment“). Sie führt regelmäßige, informelle Feedback-Gespräche (über den Standardprozess hinaus) und nutzt Coaching-Methoden, um Mitarbeitende zur eigenen Lösungsfindung anzuregen. Sie erkennt Potenziale proaktiv und schlägt individuelle Entwicklungsmaßnahmen vor (z. B. Projektleitung, Job Rotation). Sie schafft eine Teamkultur, in der Fehler offen besprochen werden, um daraus zu lernen. Die Zusammenarbeit mit dieser Person macht das gesamte Umfeld messbar effizienter und motivierter.`, 
                  example: `IT-Leiter: Delegiert Projektleitung an Talent, gibt spezifisches Feedback, stärkt Selbstvertrauen.` 
                },
                5: { 
                  text: `Die Führungskraft baut systematisch Nachfolger auf und entwickelt High-Potentials auch über den eigenen Bedarf hinaus (für die Gruppe). Sie gilt als Mentor im gesamten Unternehmen, dessen Rat auch von Mitarbeitenden anderer Bereiche gesucht wird. Sie schafft ein Umfeld der Exzellenz, in dem sich Talente entfalten können, und bindet Leistungsträger langfristig an Niederwieser. Sie steuert die Personalplanung strategisch vorausschauend (z.B. für die nächsten 2-3 Jahre) und sorgt dafür, dass das Team bereit für zukünftige Herausforderungen der Strategie 2035. Unter ihrer Führung entstehen Innovationen und überdurchschnittliche Ergebnisse durch Synergieeffekte.`, 
                  example: `Manager: Empfiehlt Top-Mitarbeiter proaktiv für Stelle an anderem Standort, statt ihn zu 'horten'.` 
                }
              }
            },
            {
              id: "l2",
              title: "Strategisches Denken",
              category: "leadership",
              icon: Brain,
              definition: `Das 'große Ganze' sehen. Weg vom Silo-Denken hin zum Gruppen-Denken ('One Niederwieser').`,
              levels: {
                1: { 
                  text: `Die Führungskraft handelt fast ausschließlich reaktiv und verliert sich im Mikromanagement des Tagesgeschäfts („Firefighting“). Sie zeigt kein Interesse an der Unternehmensstrategie oder versteht sie nicht. Entscheidungen werden isoliert für die eigene Abteilung getroffen, oft sogar zum Nachteil anderer Bereiche oder der Gruppe (Suboptimierung). Sie plant Budget und Ressourcen nur für den momentanen Bedarf ohne Weitblick. Strategische Initiativen der Geschäftsleitung werden ignoriert, belächelt oder als „störend“ für den Betrieb empfunden. Das Team hat keine Orientierung, wohin die Reise langfristig geht.`, 
                  example: `Prod-Leiter: Produziert auf Halde für 100% Auslastung, obwohl Vertrieb das Produkt nicht verkauft.` 
                },
                2: { 
                  text: `Die Führungskraft kennt die Schlagworte der Strategie (z. B. Nachhaltigkeit, Wachstum), schafft es aber nicht, diese in den Alltag ihres Teams zu integrieren. Strategie bleibt Theorie („Folie an der Wand“), während operativ „weiter wie bisher“ gearbeitet wird. Planung erfolgt meist nur kurzfristig (Quartal/Jahr). Zusammenhänge zwischen Abteilungen oder Standorten werden nur erkannt, wenn man explizit darauf hingewiesen wird. Sie wartet darauf, dass Strategie „von oben“ vorgegeben wird, statt selbst Vorschläge für den eigenen Bereich zu entwickeln.`, 
                  example: `Sales: Kennt Nachhaltigkeits-Ziel, steuert Team aber weiter nur über reine Menge/Umsatz.` 
                },
                3: { 
                  text: `BASELINE: Die Führungskraft leitet die Ziele ihres Bereichs logisch aus der Unternehmensstrategie ab. Sie erklärt ihrem Team das „Warum“ hinter Entscheidungen und stellt sicher, dass alle an einem Strang ziehen. Sie berücksichtigt bei ihrer Planung (Budget, Personal, Kapazität) einen Horizont von 12-18 Monaten. Sie erkennt relevante Trends im eigenen Fachbereich (z. B. Digitalisierung in der Admin, neue Technologien in der Produktion) und passt die Ausrichtung ihres Teams rechtzeitig an. Sie denkt über Standortgrenzen hinweg und unterstützt die Harmonisierung der Gruppe („One Niederwieser“), indem sie Standards einhält und Kooperation fördert.`, 
                  example: `IT-Leiter: Plant Budget proaktiv für Harmonisierung der ERP-Systeme (Bozen/Sulzberg).` 
                },
                4: { 
                  text: `Die Führungskraft erkennt Markt- oder interne Veränderungen, bevor sie offensichtlich werden, und bereitet ihren Bereich proaktiv darauf vor. Sie entwickelt eigeninitiativ strategische Vorschläge (z.B. neue Geschäftsfelder, strukturelle Anpassungen), die über das Tagesgeschäft hinausgehen. Sie sucht aktiv nach Synergien mit anderen Standorten (z.B. gemeinsame Nutzung von Ressourcen zwischen Sulzberg und Campogalliano) und bricht Silos auf. Sie denkt in Szenarien („Was wäre, wenn...“) und hat Plan B in der Tasche. Sie wird von Peers als strategischer Sparringspartner geschätzt.`, 
                  example: `Marketing: Schichtet Budget von Produktwerbung auf 'Solution-Kampagnen' um, bevor Markt dreht.` 
                },
                5: { 
                  text: `Die Führungskraft entwickelt Konzepte, die das Geschäftsmodell oder die Arbeitsweise der gesamten Gruppe nachhaltig verändern (z.B. Erschließung eines neuen Marktes, Einführung einer bahnbrechenden Technologie). Ihre Ideen fließen direkt in die Weiterentwicklung der Unternehmensstrategie ein. Sie erkennt disruptive Risiken oder Chancen sehr früh und steuert das Unternehmen durch mutige Entscheidungen in eine erfolgreiche Richtung. Sie gilt intern und extern als Vordenker („Thought Leader“) und inspiriert nicht nur das eigene Team, sondern die ganze Organisation, größer zu denken.`, 
                  example: `Standortleiter: Erarbeitet Business Case für Übernahme in Nische, ermöglicht Markteinstieg.` 
                }
              }
            },
            {
              id: "l3",
              title: "Entscheidungsfähigkeit",
              category: "leadership",
              icon: Target,
              definition: `Zeitnah und verbindlich entscheiden, auch unter Unsicherheit. Balance zwischen Analyse und Speed.`,
              levels: {
                1: { 
                  text: `Die Führungskraft trifft Entscheidungen extrem zögerlich oder gar nicht („Aussitzen“). Dringende Themen bleiben liegen, wodurch Fristen verstreichen oder Chancen verloren gehen. Sie fordert für kleinste Entscheidungen immer wieder neue Daten an oder delegiert die Entscheidung an den Vorgesetzten („Rückdelegation“), um bloß keinen Fehler zu machen. Getroffene Entscheidungen werden bei leichtem Gegenwind sofort revidiert („Flip-Flopping“), was das Team verunsichert. Wenn eine Entscheidung falsch war, sucht sie die Schuld bei anderen oder den Umständen, statt Verantwortung zu übernehmen. Es fehlt der Mut zur Klarheit.`, 
                  example: `Einkauf: Entscheidet wochenlang nicht über Preiserhöhung. Frist läuft ab, Konditionen werden schlechter.` 
                },
                2: { 
                  text: `Die Führungskraft entscheidet oft zu spät, sodass das Team in Warteposition verharrt. Sie verlässt sich zu stark auf Bauchgefühl oder Einzelmeinungen, statt verfügbare Fakten und Daten („Data driven“) hinzuzuziehen. Entscheidungen werden „im stillen Kämmerlein“ getroffen und dem Team ohne Begründung vorgesetzt. Schwierige oder unpopuläre Entscheidungen (z. B. Absagen an Bewerber, Stoppen von Projekten) werden aufgeschoben, in der Hoffnung, dass sich das Problem von selbst löst. Die Führungskraft braucht viel Rückversicherung von oben, um sich sicher zu fühlen.`, 
                  example: `Recruiting: Kann sich nicht zwischen Kandidaten entscheiden. Beide springen ab.` 
                },
                3: { 
                  text: `BASELINE: Die Führungskraft trifft Entscheidungen im Tagesgeschäft zeitnah und sicher. Sie wägt Chancen und Risiken vernünftig ab und nutzt die vorhandenen Informationen effizient. Sie kommuniziert die Entscheidung und das „Warum“ dahinter klar an ihr Team und betroffene Schnittstellen. Sie steht auch dann zu ihrer Entscheidung, wenn es Kritik gibt, ist aber bereit, den Kurs zu korrigieren, wenn neue Fakten auf den Tisch kommen (keine Sturheit). Sie unterscheidet sicher, was sie selbst entscheiden darf und was eskaliert werden muss – und liefert bei Eskalationen eine klare Empfehlung mit.`, 
                  example: `Schichtleiter: Entscheidet nachts selbstständig Umplanung bei Maschinenausfall, informiert Planung.` 
                },
                4: { 
                  text: `Die Führungskraft bleibt auch in unübersichtlichen Situationen, unter Zeitdruck oder bei unvollständiger Informationslage handlungsfähig. Sie trifft mutige Entscheidungen („Courage“), um Stillstand zu vermeiden, und managt das Risiko aktiv. Sie bezieht relevante Stakeholder (z.B. andere Standorte) rechtzeitig ein, um die Qualität der Entscheidung zu sichern, verliert sich aber nicht in endlosen Abstimmungsschleifen. Sie erklärt auch unpopuläre Entscheidungen so transparent und wertschätzend („Fair“), dass das Team sie mittragen kann.`, 
                  example: `Sales Dir: Lehnt unprofitablen Großauftrag mutig ab ('Courage'), erklärt Strategie 'Wert vor Volumen'.` 
                },
                5: { 
                  text: `Die Führungskraft trifft wegweisende Entscheidungen, die positive Auswirkungen weit über den eigenen Bereich hinaus haben (z.B. für die gesamte Gruppe). In Krisensituationen übernimmt sie sofort das Steuer, schafft Ruhe und gibt durch klare Entscheidungen Sicherheit und Orientierung. Sie etabliert Prinzipien oder Rahmenbedingungen, die es ihren Mitarbeitenden ermöglichen, selbstständig bessere Entscheidungen zu treffen („Empowerment“). Sie hat den Mut, alte Zöpfe abzuschneiden (z. B. unrentable Projekte oder Produkte zu stoppen), um Ressourcen für Neues freizumachen.`, 
                  example: `IT-Group: Kappt bei Cyber-Verdacht sofort alle Verbindungen der Gruppe, nimmt Prod-Ausfall in Kauf.` 
                }
              }
            },
            {
              id: "l4",
              title: "Execution & Performance",
              category: "leadership",
              icon: TrendingUp,
              definition: `Ziele in Ergebnisse umsetzen. Daten nutzen ('Clarity'), Prozesse beherrschen und konsequent steuern.`,
              levels: {
                1: { 
                  text: `Die Führungskraft arbeitet ohne erkennbaren Plan oder Struktur. Projekte und Aufgaben werden begonnen, aber nicht konsequent zu Ende geführt. Es gibt keine klaren Meilensteine oder Verantwortlichkeiten. Die Leistung des Teams wird nicht gemessen oder gesteuert; Abweichungen (z.B. Budgetüberzug, Terminverzug) fallen erst auf, wenn es zu spät ist. Ziele werden regelmäßig und deutlich verfehlt, ohne dass die Führungskraft gegensteuert oder die Ursachen analysiert. Es herrscht eine Kultur der Ausreden statt der Ergebnisse.`, 
                  example: `Projektleiter: Software-Rollout Monate überfällig. Kein neuer Plan, keine Info an User.` 
                },
                2: { 
                  text: `Die Führungskraft ist bemüht, verliert aber im Tagesgeschäft oft den Fokus. Planung erfolgt eher grob („Wird schon passen“), Risiken oder Engpässe werden nicht antizipiert. Die Steuerung erfolgt sporadisch (z.B. nur wenn der Chef nachfragt), nicht systematisch. Ziele werden teilweise erreicht, aber oft nur durch hektische „Last-Minute-Aktionen“ (Feuerlöschen) auf Kosten der Qualität oder der Mitarbeiter-Ressourcen. Es fehlt an Transparenz darüber, wo das Team wirklich steht. Prozesse werden nicht eingehalten oder ständig umgangen, um kurzfristige Ergebnisse zu erzwingen.`, 
                  example: `Sales: Merkt Zielverfehlung erst am 25., macht Druck für schlechte Margen-Deals.` 
                },
                3: { 
                  text: `BASELINE: Die Führungskraft plant Aufgaben und Projekte strukturiert mit realistischen Zeitplänen und Ressourcen. Sie definiert klare Erfolgskriterien (KPIs) und überprüft den Fortschritt regelmäßig (z.B. in Jour Fixes). Bei Abweichungen greift sie zeitnah ein und leitet Korrekturmaßnahmen ein, um das Ziel noch zu erreichen. Sie sorgt dafür, dass ihr Team die vereinbarten Ziele (Qualität, Kosten, Zeit) verlässlich erfüllt. Sie kommuniziert den Status transparent an Vorgesetzte und Schnittstellen. Man kann sich auf ihre Zusagen verlassen („Fair“).`, 
                  example: `Resp. Prod: Organisiert sofort Samstagsschicht bei Ausfall, informiert Vertrieb proaktiv.` 
                },
                4: { 
                  text: `Die Führungskraft verwaltet nicht nur, sondern optimiert aktiv. Sie nutzt Daten und Kennzahlen systematisch, um Ineffizienzen oder Bottlenecks aufzudecken, bevor sie zum Problem werden. Sie etabliert Routinen, die eine konstant hohe Performance sicherstellen. Sie liefert Ergebnisse oft schneller („Fast“) oder kostengünstiger als geplant, ohne die Qualität zu gefährden. Sie schafft es, auch bei unvorhergesehenen Hindernissen (z.B. Krankheitswelle, Lieferausfall) den Betrieb stabil zu halten, weil sie Szenarien vorausgeplant hat.`, 
                  example: `HR: Analysiert Prozess, führt digitales Tool ein, verkürzt 'Time-to-Hire' drastisch.` 
                },
                5: { 
                  text: `Die Führungskraft etabliert Best-Practice-Prozesse, die als Vorbild für die gesamte Gruppe dienen (z.B. ein neues Reporting-System, das später in Sulzberg und Bozen ausgerollt wird). Sie treibt kontinuierliche Verbesserung (KVP) so voran, dass Performance-Sprünge (z. B. signifikante Senkung der Ausschussquote oder Durchlaufzeit) erreicht werden. Sie schafft eine Hochleistungskultur, in der das Team sich selbstständig steuert und permanent übertrifft. Sie realisiert strategische Großprojekte in „Time, Budget & Quality“ und liefert damit einen direkten Beitrag zum Unternehmenserfolg („1 Result“).`, 
                  example: `Logistik: Bündelt Transporte Sulzberg/Bozen, senkt Kosten um 15% durch neues Cross-Docking.` 
                }
              }
            },
            {
              id: "l5",
              title: "Stakeholder & Konfliktlösung",
              category: "leadership",
              icon: Award,
              definition: `Beziehungen pflegen, politische Interessen moderieren. Brückenbauer zwischen Silos.`,
              levels: {
                1: { 
                  text: `Die Führungskraft ignoriert die Interessen anderer Abteilungen oder Standorte komplett. Sie kommuniziert nicht mit wichtigen Stakeholdern, was zu Überraschungen und Widerständen führt. In Konflikten verhält sie sich destruktiv: Sie sucht Schuldige statt Lösungen, redet schlecht über andere Bereiche („Die da oben/unten“) oder trägt Konflikte aggressiv und unsachlich aus. Alternativ werden Konflikte ignoriert oder ausgesessen, bis sie eskalieren. Das Verhalten beschädigt das Vertrauen und die Zusammenarbeit in der Gruppe massiv.`, 
                  example: `Prod-Leiter: Schimpft über 'unfähige Verkäufer' statt Machbarkeit direkt zu klären.` 
                },
                2: { 
                  text: `Die Führungskraft pflegt Beziehungen nur, wenn sie akut etwas braucht (transaktional). Sie vergisst häufig, relevante Partner (z.B. HR, IT, andere Standorte) rechtzeitig einzubinden, was Projekte verzögert. Sie erkennt politische Fettnäpfchen oft zu spät. Bei Konflikten reagiert sie defensiv oder zieht sich zurück, um „den Frieden zu wahren“, obwohl eine Klärung nötig wäre. Lösungen sind oft faule Kompromisse, die niemanden zufriedenstellen. Sie tut sich schwer, die Perspektive des Gegenübers einzunehmen.`, 
                  example: `Projektleiter: Vergisst Betriebsrat zu informieren. Zieht Projekt beleidigt zurück bei Veto.` 
                },
                3: { 
                  text: `BASELINE: Die Führungskraft kennt ihre wichtigsten Stakeholder und hält sie regelmäßig informiert. Sie stimmt sich proaktiv ab, um Missverständnisse zu vermeiden. Sie begegnet Partnern – egal ob intern oder extern – respektvoll und auf Augenhöhe. Konflikte werden zeitnah („Fast“) angesprochen und sachlich diskutiert. Sie vertritt die Interessen ihres Bereichs, ist aber bereit, Argumente der Gegenseite zu hören und faire Lösungen zu finden. Sie sorgt dafür, dass die Zusammenarbeit reibungslos funktioniert.`, 
                  example: `Service/Supply: Legt Zahlen offen, einigt sich sachlich auf Mindestbestand (Kompromiss).` 
                },
                4: { 
                  text: `Die Führungskraft baut aktiv ein belastbares Netzwerk über Abteilungsgrenzen hinweg auf. Sie antizipiert potenzielle Konflikte (z.B. Ressourcenengpässe zwischen Projekten) und moderiert diese präventiv, bevor sie eskalieren. Sie versteht die Zwänge und Ziele der anderen Seite und bietet Lösungen an, die beiden helfen („Win-Win“). Sie wird von anderen Abteilungen als verlässlicher Partner geschätzt, der nicht nur fordert, sondern auch unterstützt. Sie kann auch schwierige Botschaften diplomatisch und wertschätzend vermitteln.`, 
                  example: `Quality: Reist an Standorte, moderiert Workshop für gemeinsamen Standard.` 
                },
                5: { 
                  text: `Die Führungskraft löst komplexe, verfahrene Konflikte (z. B. kulturelle Spannungen zwischen Standorten oder historische Grabenkämpfe), an denen andere gescheitert sind. Sie schafft es, unterschiedliche Interessen auf das gemeinsame strategische Ziel („One Niederwieser“) auszurichten. Sie etabliert Gremien oder Formate, die den Austausch und das Stakeholder-Management strukturell verbessern. Sie genießt höchstes Vertrauen bei der Geschäftsführung und den Belegschaftsvertretungen und nutzt dieses Kapital zum Wohle des Unternehmens. Sie macht aus Gegnern Partner.`, 
                  example: `Manager: Rompe vecchi silos, integra team ostili in un'unità di successo.` 
                }
              }
            }
          ],
          },
          it: {
            intro: {
              values: [
                { key: "Fast", desc: "Agiamo velocemente e orientati alla soluzione.", icon: Zap, color: "text-yellow-600" },
                { key: "Fair", desc: "Lavoriamo insieme con rispetto e alla pari.", icon: Scale, color: "text-blue-600" },
                { key: "Personal", desc: "Ci assumiamo la responsabilità e partecipiamo attivamente.", icon: Heart, color: "text-red-600" }
              ]
            },
            competencies: [
            {
              id: "c1",
              title: "Competenza tecnica & Applicazione",
              category: "core",
              icon: Briefcase,
              definition: `Valuta le conoscenze tecniche specifiche e la loro applicazione. Non si tratta solo di abilità teoriche, ma del contributo alla sicurezza dei processi e alla qualità.`,
              levels: {
                1: { 
                  text: `Il collaboratore non possiede le basi tecniche essenziali richieste per la posizione. I compiti vengono eseguiti frequentemente in modo errato o incompleto (es. inserimento dati errati, uso scorretto degli impianti, informazioni errate ai clienti), portando a rilavorazioni, reclami o rischi. Manca la comprensione degli standard tecnici e delle regole del proprio settore. Anche dopo la formazione o il feedback, si verificano ripetutamente gli stessi errori di contenuto. Il collaboratore mostra poca iniziativa nel colmare autonomamente queste lacune. I contesti complessi del proprio campo non vengono compresi; si fa affidamento sugli altri per verificare la correttezza tecnica.`, 
                  example: `Admin: Inserisce ripetutamente i dati anagrafici in modo errato, non comprende l'impatto sulle fatture.` 
                },
                2: { 
                  text: `Il collaboratore padroneggia i processi standard e i compiti di routine nel suo campo, ma raggiunge rapidamente i limiti in caso di deviazioni, casi speciali o nuove esigenze. La conoscenza viene applicata più secondo le "prescrizioni", senza comprendere il "perché" più profondo o gli effetti sulle aree adiacenti. Per risolvere problemi tecnici si attende principalmente un'istruzione o si scala immediatamente, invece di utilizzare le risorse disponibili (documentazione, ricerca, guide di sistema). La qualità dei risultati è altalenante, specialmente sotto stress. Le novità tecniche (es. nuove funzionalità software, richieste dei clienti modificate) vengono adottate con esitazione.`, 
                  example: `IT: Risolve problemi di password standard, ma è subito sopraffatto da problemi di rete più complessi e scala senza diagnosi.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore padroneggia con sicurezza la propria area e fornisce costantemente risultati di alta qualità (elaborazione ordini corretta, sistemi stabili, pezzi precisi). Lavora in completa autonomia nelle attività quotidiane. Risolve rapidamente problemi tecnici da solo o richiede supporto mirato e tempestivo. È in grado di trasmettere conoscenze ai colleghi situazionalmente (brevi istruzioni, suggerimenti troubleshooting) e contribuisce alla stabilità del team. Gli standard tecnici vengono rispettati costantemente.`, 
                  example: `Produzione: Opera l'impianto senza errori secondo specifica. Risolve piccoli guasti (reset sensore, blocco materiale) autonomamente entro 10 minuti. Mostra ai nuovi colleghi le manovre critiche senza lunghe spiegazioni.` 
                },
                4: { 
                  text: `Il collaboratore comprende a fondo anche contesti tecnici complessi e riconosce interazioni che sfuggono ad altri (es. come una modifica nell'ordine influenza la pianificazione della produzione). Agisce preventivamente: rischi o fonti di errore vengono identificati ed eliminati prima che diventino un problema. La conoscenza tecnica viene utilizzata per ottimizzare attivamente i processi esistenti e renderli più efficienti. I colleghi si rivolgono attivamente a questa persona per domande tecniche difficili ("Go-to-Person"). Il collaboratore trasmette proattivamente le conoscenze e garantisce un alto standard nel team. Guarda oltre la propria scrivania e comprende esattamente le esigenze dei partner di interfaccia interni.`, 
                  example: `Customer Service: Verifica proattivamente la fattibilità con il laboratorio su domande specifiche e propone alternative più sicure.` 
                },
                5: { 
                  text: `Il collaboratore è considerato un'autorità tecnica assoluta nel suo campo, la cui competenza è apprezzata e richiesta anche tra le diverse sedi (Sulzberg/Bolzano/Campogalliano). Utilizza la sua eccellente conoscenza per ottenere miglioramenti significativi per il gruppo (es. introduzione di standard a livello di gruppo nel Customer Service, massiccio aumento dell'efficienza tramite nuove soluzioni IT). Questa persona funge da moltiplicatore. Elabora conoscenze complesse in modo che siano utilizzabili per l'organizzazione (es. corsi di formazione, linee guida best practice). Anticipa sviluppi futuri nel settore (es. trend di mercato, nuove tecnologie) e prepara l'azienda proattivamente. L'eccellenza tecnica diventa qui un valore aggiunto diretto per il successo aziendale.`, 
                  example: `Group Function: Sviluppa standard di servizio uniformi per tutte le sedi (DE/IT), forma i team, garantisce 'One Voice'.` 
                }
              }
            },
            {
              id: "c2",
              title: "Comunicazione & Collaborazione",
              category: "core",
              icon: MessageCircle,
              definition: `Qualità dello scambio di informazioni e della convivenza. 'One Niederwieser' significa: La collaborazione non finisce alla porta dell'ufficio o al confine nazionale.`,
              levels: {
                1: { 
                  text: `Il collaboratore trattiene informazioni critiche o le trasmette in modo incompleto, costringendo colleghi o clienti a chiedere chiarimenti e causando errori. Si isola e non mostra interesse per obiettivi comuni. In caso di problemi, scarica responsabilità ("Non è mia competenza") o rifiuta supporto. La comunicazione è caratterizzata da mentalità difensiva (battaglie in CC) anziché orientamento alla soluzione. I conflitti vengono ignorati, gestiti alle spalle o fatti escalare in modo non costruttivo. Il comportamento viola i valori fondamentali di rispetto e correttezza.`, 
                  example: `Produzione: Al cambio turno, nonostante guasto critico alla macchina, comunica solo "Tutto ok" per andare a casa velocemente. Il turno successivo scopre il problema solo dopo 2 ore di fermo.` 
                },
                2: { 
                  text: `Il collaboratore comunica principalmente in modo reattivo: le informazioni fluiscono solo su richiesta esplicita ("Dovere di informarsi" invece di "Dovere di informare"). Si concentra sulla propria area ignorando esigenze di reparti adiacenti o colleghi. In riunioni o progetti contribuisce raramente proattivamente. Il canale di comunicazione è spesso inefficiente (es. lunghi scambi email su temi complessi invece di breve chiamata chiarificatrice – contrariamente al principio "Phone before Email"). Il feedback viene preso personalmente o respinto difensivamente. La collaborazione funziona nella routine, ma diventa difficile con stress, incertezza o temi interfunzionali.`, 
                  example: `Backoffice: Scrive email avanti e indietro per giorni invece di chiarire il caso in 2 minuti al telefono.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore informa colleghi e partner proattivamente, completamente e tempestivamente su tutto ciò che è rilevante (es. aggiornamenti stato, ritardi, assenze). Sceglie il canale più efficiente situazionalmente (prende il telefono se le cose devono essere chiarite rapidamente). Il tono è sempre rispettoso e alla pari, indipendentemente da gerarchia o sede. Offre supporto ai colleghi quando necessario e condivide volentieri conoscenze. Nelle riunioni è presente, preparato e costruttivo. I conflitti vengono affrontati oggettivamente e direttamente. Contribuisce stabilmente a un'atmosfera lavorativa positiva e professionale.`, 
                  example: `Sales: In caso di ritardo nella consegna, informa subito proattivamente cliente e agente con nuova data.` 
                },
                4: { 
                  text: `Il collaboratore non comunica solo informazioni, ma crea comprensione. Adatta la comunicazione in modo mirato all'interlocutore (es. traduce dettagli tecnici per i non addetti ai lavori, prepara dati per i decisori) e assicura che il messaggio arrivi correttamente. Agisce attivamente come legame tra i reparti e abbatte i silos. In caso di conflitti o malintesi nel team, assume un ruolo di mediazione e cerca una soluzione comune ("Win-Win"), invece di voler avere ragione. Fornisce feedback costruttivi e orientati allo sviluppo che aiutano gli altri a migliorare. La collaborazione con questa persona rende l'intero ambiente misurabilmente più efficiente e motivato.`, 
                  example: `Interfaccia: Modera in caso di conflitto tra produzione e servizio, crea regolamentazione per ordini urgenti.` 
                },
                5: { 
                  text: `Il collaboratore stabilisce nuovi standard di collaborazione che vanno oltre il proprio team (es. avvio di formati di scambio regolari tra le sedi di Sulzberg e Campogalliano o tra Sales e Tecnica). Vive i valori Fast, Fair, Personal in modo così esemplare da fungere da modello e trascinare gli altri. Crea una rete di fiducia nell'intera azienda e la utilizza per risolvere problemi complessi e interfunzionali in modo rapido e non burocratico. Viene coinvolto come mentore o mediatore in situazioni comunicative difficili (es. processi di cambiamento, crisi). Si assicura attivamente che parliamo internamente ed esternamente "con una sola voce".`, 
                  example: `HR: Avvia Sounding Board inter-sede per chiarire differenze culturali tra Bolzano e Sulzberg.` 
                }
              }
            },
            {
              id: "c3",
              title: "Competenza nel Problem Solving",
              category: "core",
              icon: ShieldAlert,
              definition: `Gestione degli ostacoli. Distinguiamo tra Troubleshooting (sintomi) e ricerca delle cause (radice).`,
              levels: {
                1: { 
                  text: `Il collaboratore riconosce i problemi spesso solo quando sono già degenerati, o ignora segnali di avvertimento evidenti (es. messaggi di errore, reclami clienti, deviazioni di qualità). Non mostra iniziativa per la soluzione, ma attende passivamente istruzioni ("Lavoro secondo prescrizione"). Di fronte alle difficoltà si arrende rapidamente o scarica la responsabilità su altri (colleghi, IT, fornitori). Gli errori vengono nascosti o minimizzati invece di parlarne apertamente. Non c'è apprendimento dagli errori: lo stesso identico problema si verifica ancora e ancora senza che il comportamento venga modificato.`, 
                  example: `Admin: Chiude semplicemente il messaggio di errore nell'ERP, senza info. A fine mese i numeri non tornano.` 
                },
                2: { 
                  text: `Il collaboratore segnala i problemi ("Qui c'è qualcosa che non va"), ma contribuisce poco alla soluzione. Si affida molto al responsabile o a colleghi esperti per trovare la via d'uscita dalla crisi. I tentativi di soluzione rimangono spesso in superficie: si combattono i sintomi (es. riavviare semplicemente la macchina, temporeggiare col cliente), ma non le cause reali. Appena sorge un primo ostacolo nella ricerca della soluzione, il processo si ferma. Necessita di istruzioni dettagliate per risolvere anche problemi standard. Manca la visione delle conseguenze: una "soluzione rapida" crea spesso nuovi problemi altrove.`, 
                  example: `Produzione: Riduce velocità macchina per nascondere pieghe, invece di cercare causa meccanica.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore riconosce tempestivamente i problemi nel proprio ambito di competenza e li affronta autonomamente. Utilizza le informazioni disponibili (dati, manuali, storico) e gli strumenti per trovare soluzioni pragmatiche che funzionano. Distingue con sicurezza cosa può risolvere da solo e quando è necessaria un'escalation – informando poi in modo preciso e orientato alla soluzione (arriva con una proposta, non solo con il lamento). Le soluzioni sono solide e sostenibili per il lavoro quotidiano. Rimane capace di agire anche in situazioni stressanti ("Sangue freddo"). Dopo un errore si assume la responsabilità ("Accountability") e corregge, invece di cercare scuse.`, 
                  example: `Customer Service: Localizza merce mancante, informa cliente onestamente, risolve conflitto professionalmente.` 
                },
                4: { 
                  text: `Il collaboratore non risolve solo il problema acuto, ma conduce una ricerca sistematica delle cause (es. metodo "5-Why", analisi dati) per capire perché è successo. Sviluppa misure che impediscono che l'errore si verifichi di nuovo (prevenzione errori). Pensa oltre il proprio ambito: se un problema riguarda le interfacce (es. passaggio Sales a Produzione), questo viene indirizzato e risolto attivamente. Supporta i colleghi in sfide difficili e apporta approcci creativi e non convenzionali quando le soluzioni standard non funzionano. I problemi vengono concepiti come opportunità di miglioramento.`, 
                  example: `Logistica: Analizza dati ritardi, parla con spedizioniere e adatta processo di ritiro permanentemente.` 
                },
                5: { 
                  text: `Il collaboratore identifica problemi complessi e strutturali o rischi che altri non hanno ancora notato e sviluppa concetti completi per risolverli. Le soluzioni hanno spesso un impatto positivo su più reparti o sedi del gruppo (Sulzberg/Bolzano/Campogalliano). Stabilisce nuovi standard o "Best Practices" per la risoluzione dei problemi che vengono adottati in azienda. Trasforma i problemi in vere innovazioni o vantaggi competitivi per Niederwieser. Nelle crisi assume informalmente la guida ("Troubleshooter") e naviga il team con sicurezza attraverso terreni incerti.`, 
                  example: `Quality: Avvia Task-Force per difetti materiali tra le sedi, introduce nuovo standard di gruppo.` 
                }
              }
            },
            {
              id: "c4",
              title: "Adattabilità & Volontà di apprendere",
              category: "core",
              icon: BookOpen,
              definition: `Volontà di adattarsi a nuove condizioni quadro (IT, mercato, processi). 'Growth Mindset' invece di Status Quo.`,
              levels: {
                1: { 
                  text: `Il collaboratore reagisce alle novità (es. nuovo software, ristrutturazioni) con aperto rifiuto, cinismo o ostruzionismo. Si aggrappa rigidamente a metodi obsoleti ("Abbiamo sempre fatto così") e si rifiuta di apprendere nuove abilità. I cambiamenti portano a un massiccio calo delle prestazioni o a malumore che contagia il team. Necessita di una sproporzionata opera di convincimento e pressione per attuare anche i minimi adattamenti nel flusso di lavoro. Il feedback sullo sviluppo personale viene ignorato o valutato come un attacco.`, 
                  example: `Magazzino: Si rifiuta di usare nuovi scanner, continua a tenere liste manuali private.` 
                },
                2: { 
                  text: `Il collaboratore accetta i cambiamenti solo dopo lunga esitazione o mugugni. Aspetta di vedere se la novità "rimane davvero" prima di muoversi. L'apprendimento di nuovi compiti o sistemi dura molto più a lungo rispetto a colleghi comparabili, poiché manca la motivazione interna. Mostra poca iniziativa per l'aggiornamento; nuove conoscenze vengono acquisite solo se esplicitamente ordinate o "pre-digerite". In situazioni di stress o con nuove esigenze poco chiare, ricade rapidamente in vecchi modelli comportamentali inefficienti. L'adattabilità non è sufficiente per fasi dinamiche.`, 
                  example: `Finance: Stampa email nonostante sistema paperless. Impara nuovo processo solo lentamente.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore gestisce i cambiamenti in modo costruttivo e adatta il suo modo di lavorare alle nuove condizioni. Attua le nuove direttive (es. uso di un nuovo strumento, piano turni modificato) in modo affidabile e senza grandi lamentele. L'inserimento in nuovi temi avviene in tempi adeguati. Riconosce quando mancano conoscenze e utilizza i corsi offerti o gli ausili per colmare la lacuna. Non blocca le innovazioni, ma le supporta nel lavoro quotidiano. Ci si può fidare che fornisca stabilmente la sua prestazione anche in un ambiente in evoluzione ("Fair" verso il team).`, 
                  example: `Sales: Partecipa a corso su nuovi film sostenibili e consiglia i clienti con competenza dalla data stabilita.` 
                },
                4: { 
                  text: `Il collaboratore vede i cambiamenti come opportunità di miglioramento. Non aspetta i corsi, ma acquisisce nuove conoscenze (es. su nuovi prodotti, trend di mercato o trucchi software) autonomamente. Sperimenta nuovi approcci risolutivi e condivide le scoperte con il team. Nelle fasi di transizione agisce in modo stabilizzante sugli altri e aiuta i colleghi che hanno più difficoltà con il cambiamento (es. come "Buddy" per nuovi sistemi). Mette in discussione lo status quo in modo costruttivo e fa proposte su come adattarsi meglio alle nuove esigenze.`, 
                  example: `Service: Esplora il nuovo CRM prima del corso, aiuta poi i colleghi all'avvio.` 
                },
                5: { 
                  text: `Il collaboratore anticipa i cambiamenti necessari spesso prima degli altri e prepara sé stesso e l'ambiente proattivamente (es. acquisizione di competenze future prima che servano acutamente). Spinge innovazioni che rendono l'azienda pronta per il futuro (es. pilotaggio di modalità di lavoro completamente nuove). Stabilisce una cultura dell'apprendimento nel proprio ambito, vivendo gli errori come opportunità di apprendimento e incoraggiando gli altri a provare ("Empowerment"). Agisce come faro in grandi progetti strategici (es. armonizzazione delle sedi) e crea entusiasmo per la nuova strada, anche in caso di resistenze iniziali.`, 
                  example: `IT: Avvia autonomamente progetto pilota AI (Copilot), chiarisce privacy e forma altre sedi.` 
                }
              }
            },
            {
              id: "c5",
              title: "Auto-organizzazione & Affidabilità",
              category: "core",
              icon: Clock,
              definition: `Strutturazione del lavoro, priorizzazione e Accountability. Ci si può fidare della parola data?`,
              levels: {
                1: { 
                  text: `Il collaboratore lavora in modo asistematico e senza struttura riconoscibile. I compiti vengono dimenticati, le scadenze mancate senza preavviso o gli appuntamenti persi. Si lascia distrarre facilmente e perde il focus sull'essenziale. Il responsabile o i colleghi devono costantemente controllare ("Babysitting") affinché i risultati vengano consegnati. Manca la panoramica sui compiti aperti; le promesse vengono fatte con leggerezza e non mantenute. Il posto di lavoro (fisico o digitale) è disorganizzato, cosicché documenti o informazioni importanti non sono a portata di mano. L'inaffidabilità pesa massicciamente sul team.`, 
                  example: `Sales: Dimentica rapporti visita, smarrisce fogli con richieste clienti. Nessuna panoramica.` 
                },
                2: { 
                  text: `Il collaboratore sbriga compiti di routine semplici in modo affidabile, ma va rapidamente in difficoltà con più compiti paralleli o pressione temporale. Ha difficoltà a distinguere l'importante dal non importante (fa es. ciò che diverte prima, non ciò che urge). La pianificazione avviene solo a brevissimo termine (giorno per giorno). Quando i tempi si stringono, non lo comunica tempestivamente, ma solo quando il danno è già fatto. La qualità del lavoro soffre per mancanza di cura o gestione del tempo. Necessita di guida regolare e promemoria dal responsabile per rimanere in rotta.`, 
                  example: `Officina: Riordina, anche se riparazione urgente blocca la produzione.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore organizza autonomamente la giornata lavorativa e stabilisce priorità sensate per urgenza e importanza. Rispetta impegni e scadenze in modo affidabile. Se una scadenza è a rischio, informa con almeno 48 ore di anticipo proattivamente ("Transparency"). Postazione e sistemi sono strutturati in modo che informazioni importanti siano reperibili in meno di 2 minuti (archiviazione ordinata, liste to-do curate). Si può fare affidamento sulla sua parola.`, 
                  example: `Admin: Ha scadenziario digitale sotto controllo (priorità codificate per colore). Segnala martedì che chiusura mensile arriverà 2 giorni dopo per assenza malattia nel team – propone contestualmente soluzione (supporto da altra sede).` 
                },
                4: { 
                  text: `Il collaboratore pianifica con anticipo (2-3 mesi) e riconosce colli di bottiglia prima che si verifichino (ferie, scadenze progetti, carenza risorse). Ottimizza attivamente il proprio metodo di lavoro (strumenti digitali, checklist, raggruppamento attività simili). Rimane strutturato anche con carico di lavoro al 120% e consegna risultati puntuali. La sua affidabilità lo rende pilastro fisso del team – i colleghi sanno: "Con X è al sicuro."`, 
                  example: `Project Management: Prepara 4 settimane prima delle ferie dossier dettagliato con stato di tutti i progetti, punti aperti e referenti. Predispone attività critiche (briefing di scorta, template decisionali precompilati). Il sostituto può subentrare senza interruzioni.` 
                },
                5: { 
                  text: `Il collaboratore sviluppa sistemi organizzativi o flussi di lavoro che aiutano non solo lui/lei, ma l'intero team o reparto a lavorare più efficientemente (es. introduzione di una Kanban-Board, standardizzazione dell'archiviazione per il gruppo). Gestisce pacchetti di compiti altamente complessi con molte dipendenze (es. progetti inter-sede) con sovranità e puntualità. È considerato un "porto sicuro" per compiti critici: se se ne occupa lui/lei, il successo è garantito. Crea spazi per temi strategici e innovazioni attraverso un'eccellente organizzazione.`, 
                  example: `Marketing: Stabilisce tool di pianificazione digitale per tutte le sedi (Sulzberg/BZ/Campo), elimina doppi lavori.` 
                }
              }
            },
            {
              id: "l1",
              title: "Gestione & Sviluppo dei collaboratori",
              category: "leadership",
              icon: Users,
              definition: `Guida, motivazione e sviluppo del team. 'Leadership' invece di solo 'Management'.`,
              levels: {
                1: { 
                  text: `Il manager trascura i suoi compiti principali: i colloqui con i collaboratori (colloquio annuale, check-in) non hanno luogo, sono estremamente in ritardo o vengono sbrigati come fastidioso dovere. Non c'è feedback costruttivo; la critica avviene spesso in modo non oggettivo o davanti ad altri. I desideri di sviluppo dei collaboratori vengono ignorati o bloccati ("Non abbiamo tempo per questo"). Gli obiettivi vengono comunicati in modo poco chiaro o per nulla, portando a disorientamento. Il comportamento contraddice massicciamente i nostri valori (es. mancanza di rispetto, "Divide and Conquer"). Nel team regna un'atmosfera di paura o indifferenza, portando ad alto turnover o dimissioni interne.`, 
                  example: `Resp. Prod: Annulla colloquio annuale 3 volte, lo fa poi in 15min in piedi.` 
                },
                2: { 
                  text: `Il manager sbriga i doveri amministrativi (approvazione ferie, colloqui formali), ma senza profondità. Il feedback c'è per lo più solo se qualcosa è andato storto (reattivo), quasi nessuna lode o orientamento per il futuro. Il lavoro di leadership si limita all'assegnazione di compiti ("Micromanagement"), invece di delegare responsabilità. I piani di sviluppo (IDP) vengono sì compilati, ma spariscono poi nel cassetto e non vengono seguiti. Il manager si prende troppo poco tempo per il team ("Porta chiusa"). Manca chiarezza e ispirazione; il team lavora "secondo prescrizione", ma non oltre.`, 
                  example: `Team Leader: Usa Copia-Incolla per obiettivi. Risponde a desiderio sviluppo vagamente 'Vediamo'.` 
                },
                3: { 
                  text: `BASELINE: Il manager conduce tutti i colloqui obbligatori (Review, definizione obiettivi) puntualmente, ben preparato e alla pari. Assicura obiettivi e aspettative chiari, cosicché ognuno sappia cosa fare. Il feedback avviene regolarmente ed equamente – sia positivo che correttivo. Supporta lo sviluppo professionale (es. approvazione corsi) ed è disponibile per i collaboratori in caso di problemi. Vive i valori "Fast, Fair, Personal" nel quotidiano e garantisce un clima lavorativo stabile e positivo. Tratta tutti i membri del team equamente e senza discriminazioni.`, 
                  example: `Sales Director: Check-in regolari, loda successi, parla apertamente dei deficit. Team conosce obiettivi.` 
                },
                4: { 
                  text: `Il manager usa la leadership attivamente per rendere i collaboratori migliori. Non delega solo compiti, ma responsabilità, per permettere la crescita ("Empowerment"). Conduce regolari colloqui di feedback informali (oltre il processo standard) e usa metodi di coaching per stimolare i collaboratori a trovare soluzioni proprie. Riconosce potenziali proattivamente e propone misure di sviluppo individuali (es. guida progetto, Job Rotation). Crea una cultura di team in cui gli errori vengono discussi apertamente per impararne. Il team si sente supportato e porta prestazioni misurabilmente più alte grazie all'alta motivazione.`, 
                  example: `Resp. IT: Delega guida progetto a talento, dà feedback specifico, rafforza autostima.` 
                },
                5: { 
                  text: `Il manager costruisce sistematicamente successori e sviluppa High-Potentials auch über den eigenen Bedarf hinaus (per il gruppo). È considerato un mentore nell'intera azienda, il cui consiglio è cercato anche da collaboratori di altri settori. Crea un ambiente di eccellenza in cui i talenti possono svilupparsi e lega i top performer a lungo termine a Niederwieser. Gestisce la pianificazione del personale strategicamente in modo lungimirante (es. per i prossimi 2-3 anni) e assicura che il team sia pronto per le sfide future della Strategia 2035. Sotto la sua guida nascono innovazioni e risultati sopra la media grazie a effetti sinergici.`, 
                  example: `Manager: Raccomanda Top-Mitarbeiter proattivamente per posizione in altra sede, invece di 'accumularlo'.` 
                }
              }
            },
            {
              id: "l2",
              title: "Pensiero strategico",
              category: "leadership",
              icon: Brain,
              definition: `Vedere il 'quadro generale'. Via dal pensiero a silos verso il pensiero di gruppo ('One Niederwieser').`,
              levels: {
                1: { 
                  text: `Il manager agisce quasi esclusivamente in modo reattivo e si perde nel micromanagement del quotidiano ("Firefighting"). Non mostra interesse per la strategia aziendale o non la comprende. Le decisioni vengono prese isolatamente per il proprio reparto, spesso addirittura a svantaggio di altri settori o del gruppo (Subottimizzazione). Pianifica budget e risorse solo per il fabbisogno momentaneo senza lungimiranza. Le iniziative strategiche della direzione vengono ignorate, derise o percepite come "disturbo" per l'operatività. Il team non ha orientamento su dove vada il viaggio a lungo termine.`, 
                  example: `Resp. Prod: Produce a magazzino per 100% utilizzo, anche se vendite non vendono il prodotto.` 
                },
                2: { 
                  text: `Il manager conosce le parole chiave della strategia (es. sostenibilità, crescita), ma non riesce a integrarle nel quotidiano del suo team. La strategia rimane teoria ("Slide sul muro"), mentre operativamente si lavora "come sempre". La pianificazione avviene per lo più solo a breve termine (trimestre/anno). Le connessioni tra reparti o sedi vengono riconosciute solo se esplicitamente segnalate. Aspetta che la strategia venga data "dall'alto", invece di sviluppare proposte per il proprio ambito.`, 
                  example: `Sales: Conosce obiettivo sostenibilità, ma guida team ancora solo su pura quantità/fatturato.` 
                },
                3: { 
                  text: `BASELINE: Il manager deriva logicamente gli obiettivi del suo settore dalla strategia aziendale. Spiega al suo team il "Perché" dietro le decisioni e assicura che tutti tirino dalla stessa parte. Considera nella sua pianificazione (budget, personale, capacità) un orizzonte di 12-18 mesi. Riconosce trend rilevanti nel proprio ambito (es. digitalizzazione in amministrazione, nuove tecnologie in produzione) e adatta l'orientamento del suo team tempestivamente. Pensa oltre i confini della sede e supporta la harmonizzazione del gruppo ("One Niederwieser"), rispettando standard e promuovendo la cooperazione.`, 
                  example: `Resp. IT: Pianifica budget proattivamente per armonizzazione sistemi ERP (Bolzano/Sulzberg).` 
                },
                4: { 
                  text: `Il manager riconosce cambiamenti di mercato o interni prima che diventino ovvi e prepara il suo settore proattivamente. Sviluppa di propria iniziativa proposte strategiche (es. nuovi campi di business, adattamenti strutturali) che vanno oltre il quotidiano. Cerca attivamente sinergie con altre sedi (es. uso comune di risorse tra Sulzberg und Campogalliano) und rompe i silos. Pensa in scenari ("Cosa succederebbe se...") e ha un piano B in tasca. È apprezzato dai pari come sparring partner strategico.`, 
                  example: `Marketing: Sposta budget da pubblicità prodotto a 'campagne soluzioni' prima che il mercato giri.` 
                },
                5: { 
                  text: `Il manager sviluppa concetti che cambiano il modello di business o il modo di lavorare dell'intero gruppo in modo sostenibile (es. apertura di un nuovo mercato, introduzione di una tecnologia rivoluzionaria). Le sue idee fluiscono direttamente nello sviluppo della strategia aziendale. Riconosce rischi o opportunità distruttivi molto presto e guida l'azienda attraverso decisioni coraggiose in una direzione di successo. È considerato internamente ed esternamente come precursore ("Thought Leader") e inspira non solo il proprio team, ma l'intera organizzazione a pensare più in grande.`, 
                  example: `Resp. Sede: Elabora Business Case per acquisizione in nicchia, permette ingresso mercato.` 
                }
              }
            },
            {
              id: "l3",
              title: "Capacità decisionale",
              category: "leadership",
              icon: Target,
              definition: `Decidere tempestivamente e in modo vincolante, anche nell'incertezza. Equilibrio tra analisi e velocità.`,
              levels: {
                1: { 
                  text: `Il manager prende decisioni con estrema esitazione o non le prende affatto ("Temporeggiare"). Temi urgenti rimangono fermi, facendo scadere termini o perdere opportunità. Richiede per le minime decisioni sempre nuovi dati o delega la decisione al superiore ("Delega di ritorno"), pur di non fare errori. Le decisioni prese vengono riviste immediatamente al minimo vento contrario ("Flip-Flopping"), cosa che disorienta il team. Se una decisione era sbagliata, cerca la colpa negli altri o nelle circostanze, invece di assumersi la responsabilità. Manca il coraggio della chiarezza.`, 
                  example: `Acquisti: Non decide per settimane su aumento prezzi. Scadenza passa, condizioni peggiorano.` 
                },
                2: { 
                  text: `Il manager decide spesso troppo tardi, cosicché il team rimane in posizione di attesa. Si affida troppo alla sensazione di pancia o a opinioni singole, invece di consultare fatti e dati disponibili ("Data driven"). Le decisioni vengono prese "nel chiuso della stanza" e presentate al team senza giustificazione. Decisioni difficili o impopolari (es. rifiuti a candidati, stop di progetti) vengono rimandate, nella speranza che il problema si risolva da solo. Il manager necessita di molta rassicurazione dall'alto per sentirsi sicuro.`, 
                  example: `Recruiting: Non riesce a decidere tra candidati. Entrambi rinunciano.` 
                },
                3: { 
                  text: `BASELINE: Il manager prende decisioni nel quotidiano tempestivamente e con sicurezza. Pesa opportunità e rischi ragionevolmente e utilizza le informazioni esistenti in modo efficiente. Comunica la decisione e il "Perché" dietro di essa chiaramente al suo team e alle interfacce interessate. Mantiene la sua decisione anche se c'è critica, ma è pronto a correggere la rotta se arrivano nuovi fatti sul tavolo (nessuna testardaggine). Distingue con sicurezza cosa può decidere lui stesso e cosa deve essere scalato – e fornisce in caso di escalation una chiara raccomandazione.`, 
                  example: `Capoturno: Decide di notte autonomamente riprogrammazione per guasto macchina, informa pianificazione.` 
                },
                4: { 
                  text: `Il manager rimane capace di agire anche in situazioni confuse, sotto pressione temporale o con informazioni incomplete. Prende decisioni coraggiose ("Courage") per evitare lo stallo und gestisce il rischio attivamente. Coinvolge gli stakeholder rilevanti (es. altre sedi) tempestivamente per assicurare la qualità della decisione, ma non si perde in infiniti cicli di coordinamento. Spiega anche decisioni impopolari in modo così trasparente und wertschätzend ("Fair") che il team può sostenerle.`, 
                  example: `Sales Dir: Rifiuta coraggiosamente grande ordine non profittevole ('Courage'), erklärt Strategie 'Wert vor Volumen'.` 
                },
                5: { 
                  text: `Il manager prende decisioni pionieristiche che hanno effetti positivi ben oltre il proprio ambito (es. per l'intero gruppo). In situazioni di crisi prende immediatamente il timone, crea calma und dà sicurezza und orientamento tramite decisioni chiare. Stabilisce principi o condizioni quadro che permettono ai suoi collaboratori di prendere autonomamente decisioni migliori ("Empowerment"). Ha il coraggio di tagliare rami secchi (es. fermare progetti o prodotti non redditizi) per liberare risorse per il nuovo.`, 
                  example: `IT-Group: Kappt bei Cyber-Verdacht sofort alle Verbindungen der Gruppe, accetta stop prod.` 
                }
              }
            },
            {
              id: "l4",
              title: "Execution & Performance",
              category: "leadership",
              icon: TrendingUp,
              definition: `Trasformare obiettivi in risultati. Usare i dati ('Clarity'), padroneggiare i processi e guidare coerentemente.`,
              levels: {
                1: { 
                  text: `Il manager lavora senza piano o struttura riconoscibile. Progetti e compiti vengono iniziati, ma non portati a termine coerentemente. Non ci sono chiare pietre miliari o responsabilità. La prestazione del team non viene misurata o controllata; deviazioni (es. sforamento budget, ritardo termini) si notano solo quando è troppo tardi. Gli obiettivi vengono mancati regolarmente e chiaramente, ohne dass die Führungskraft gegensteuert oder die Ursachen analysiert. Es herrscht eine Kultur der Ausreden statt der Ergebnisse.`, 
                  example: `Projektleiter: Software-Rollout Monate überfällig. Kein neuer Plan, keine Info an User.` 
                },
                2: { 
                  text: `Il manager si impegna, ma perde spesso il focus nel quotidiano. La pianificazione avviene in modo approssimativo ("Andrà bene"), rischi o colli di bottiglia non vengono anticipati. Il controllo avviene sporadicamente (es. solo quando il capo chiede), non sistematicamente. Gli obiettivi vengono parzialmente raggiunti, ma spesso solo tramite frenetiche "azioni last-minute" (spegnere incendi) a spese della qualità o delle risorse dei collaboratori. Manca trasparenza su dove si trovi veramente il team. I processi non vengono rispettati o costantemente aggirati per forzare risultati a breve termine.`, 
                  example: `Sales: Nota mancato obiettivo solo il 25, fa pressione per deal a basso margine.` 
                },
                3: { 
                  text: `BASELINE: Il manager pianifica compiti e progetti in modo strutturato con tempistiche e risorse realistiche. Definisce chiari criteri di successo (KPI) e controlla il progresso regolarmente (es. in Jour Fixes). In caso di deviazioni interviene tempestivamente e avvia misure correttive per raggiungere ancora l'obiettivo. Assicura che il suo team soddisfi gli obiettivi concordati (Qualità, Costi, Tempo) in modo affidabile. Comunica lo stato in modo trasparente ai superiori e alle interfacce. Ci si può fidare delle sue promesse ("Fair").`, 
                  example: `Resp. Prod: Organizza subito turno sabato in caso di guasto, informa Vendite proattivamente.` 
                },
                4: { 
                  text: `Il manager non solo amministra, ma ottimizza attivamente. Utilizza dati e indicatori sistematicamente per scoprire inefficienze o colli di bottiglia prima che diventino un problema. Stabilisce routine che assicurano una performance costantemente alta. Fornisce risultati spesso più velocemente ("Fast") o in modo più economico del previsto, senza mettere a rischio la qualità. Riesce a mantenere stabile l'operatività anche in caso di ostacoli imprevisti (es. ondata di malattia, mancata consegna), perché ha pianificato scenari in anticipo.`, 
                  example: `HR: Analizza processo, introduce tool digitale, accorcia 'Time-to-Hire' drasticamente.` 
                },
                5: { 
                  text: `Il manager stabilisce processi Best-Practice che servono da modello per l'intero gruppo (es. un nuovo sistema di reporting che viene poi implementato a Sulzberg e Bolzano). Spinge il miglioramento continuo (KVP) in modo tale da raggiungere salti di performance (es. significativa riduzione della quota scarti o tempo di attraversamento). Crea una cultura di alta prestazione in cui il team si autogestisce e si supera permanentemente. Realizza grandi progetti strategici in "Time, Budget & Quality" e fornisce così un contributo diretto al successo aziendale ("1 Result").`, 
                  example: `Logistica: Raggruppa trasporti Sulzberg/Bolzano, riduce costi del 15% con nuovo Cross-Docking.` 
                }
              }
            },
            {
              id: "l5",
              title: "Stakeholder & Risoluzione dei conflitti",
              category: "leadership",
              icon: Award,
              definition: `Curare le relazioni, moderare interessi politici. Costruttore di ponti tra i silos.`,
              levels: {
                1: { 
                  text: `Il manager ignora completamente gli interessi di altri reparti o sedi. Non comunica con stakeholder importanti, portando a sorprese e resistenze. Nei conflitti si comporta in modo distruttivo: cerca colpevoli invece di soluzioni, parla male di altri settori ("Quelli lassù/laggiù") o porta avanti conflitti in modo aggressivo e non oggettivo. Alternativamente i conflitti vengono ignorati o attesi finché non degenerano. Il comportamento danneggia massicciamente la fiducia e la collaborazione nel gruppo.`, 
                  example: `Resp. Prod: Impreca su 'venditori incapaci' invece di chiarire fattibilità direttamente.` 
                },
                2: { 
                  text: `Il manager cura le relazioni solo quando ha acutamente bisogno di qualcosa (transazionale). Dimentica frequentemente di coinvolgere partner rilevanti (es. HR, IT, altre sedi) tempestivamente, ritardando i progetti. Riconosce gaffe politiche spesso troppo tardi. In caso di conflitti reagisce difensivamente o si ritira per "mantenere la pace", anche se sarebbe necessario un chiarimento. Le soluzioni sono spesso compromessi deboli che non soddisfano nessuno. Fa fatica ad assumere la prospettiva dell'interlocutore.`, 
                  example: `Project Leader: Dimentica di informare il consiglio di fabbrica. Ritira progetto offeso in caso di veto.` 
                },
                3: { 
                  text: `BASELINE: Il manager conosce i suoi stakeholder più importanti e li tiene regolarmente informati. Si coordina proattivamente per evitare malintesi. Incontra i partner – interni or esterni – con rispetto e alla pari. I conflitti vengono affrontati tempestivamente ("Fast") und diskutiert oggettivamente. Rappresenta gli interessi del suo settore, ma è pronto ad ascoltare argomenti della controparte e trovare soluzioni eque. Assicura che la collaborazione funzioni senza intoppi.`, 
                  example: `Service/Supply: Mostra numeri, concorda oggettivamente scorta minima (Compromesso).` 
                },
                4: { 
                  text: `Il manager costruisce attivamente una rete resiliente oltre i confini del reparto. Anticipa potenziali conflitti (es. colli di bottiglia risorse tra progetti) und moderiert diese präventiv, bevor sie eskalieren. Comprende i vincoli e gli obiettivi dell'altra parte e offre soluzioni che aiutano entrambi ("Win-Win"). È apprezzato da altri reparti come partner affidabile che non solo chiede, ma supporta anche. Sa comunicare anche messaggi difficili in modo diplomatico e rispettoso.`, 
                  example: `Quality: Viaggia nelle sedi, modera workshop per standard comune.` 
                },
                5: { 
                  text: `Il manager risolve conflitti complessi e bloccati (es. tensioni culturali tra sedi o guerre di trincea storiche) dove altri hanno fallito. Riesce a orientare interessi diversi verso l'obiettivo strategico comune ("One Niederwieser"). Stabilisce comitati o formati che migliorano strutturalmente lo scambio e la gestione degli stakeholder. Gode della massima fiducia presso la direzione e le rappresentanze dei lavoratori e utilizza questo capitale per il bene dell'azienda. Trasforma avversari in partner.`, 
                  example: `Manager: Rompe vecchi silos, integra team ostili in un'unità di successo.` 
                }
              }
            }
          ]
          },
          en: {
            intro: {
              values: [
                { key: "Fast", desc: "We act quickly and solution-oriented.", icon: Zap, color: "text-yellow-600" },
                { key: "Fair", desc: "We work together respectfully and on equal footing.", icon: Scale, color: "text-blue-600" },
                { key: "Personal", desc: "We take responsibility and actively shape things.", icon: Heart, color: "text-red-600" }
              ]
            },
            competencies: [
            {
              id: "c1",
              title: "Technical Expertise & Application",
              category: "core",
              icon: Briefcase,
              definition: `Evaluates specific professional knowledge and its application. It's not just about theoretical ability, but the contribution to process safety and quality.`,
              levels: {
                1: { 
                  text: `The employee lacks the necessary knowledge to perform core tasks. Regular errors jeopardize quality or safety. Requires constant monitoring and correction. Does not independently recognize when to seek help, leading to hidden problems that later have expensive consequences. Instructions are often misunderstood or forgotten. Mistakes are repeated, learning curve remains flat.`, 
                  example: `Machine operator: Repeatedly sets wrong parameters despite standard procedure, causes waste.` 
                },
                2: { 
                  text: `The employee reliably handles standard tasks with established knowledge. When procedures deviate (new products, machine changes, special requests), insecurity arises and support is necessary. Recognizes own limits, but often too late. Learns slowly and needs time with new topics. Work can usually be used, but occasionally requires corrections.`, 
                  example: `Shift worker: Routine runs; struggles with new recipes, needs coaching.` 
                },
                3: { 
                  text: `BASELINE: Solid and continuously current professional knowledge. Works independently and quality-consciously; delivers consistently reliable work. Proactively fills gaps and stays up-to-date in their field. Actively shares experience with colleagues and asks targeted questions when needed. Acts as a reliable element in daily operations. Contributes good ideas based on practical experience.`, 
                  example: `Maintenance: Identifies cause for repeat failure – proposes preventive schedule.` 
                },
                4: { 
                  text: `Deep specialist knowledge that goes beyond the role. Understands complex connections and draws preventive conclusions. Is frequently consulted by colleagues for support and is considered a mentor. Can translate new technical requirements (e.g., new materials, certifications) quickly into practice. Thinks in processes, not isolated tasks.`, 
                  example: `Quality: Anticipates customer objection before audit by initiating corrective action proactively.` 
                },
                5: { 
                  text: `Recognized across departments as expert and reference. Initiates and leads training measures; develops internal standards. Represents the company externally as technical authority (customer discussions, certifications, trade fairs). Drives innovations and improvements that demonstrably strengthen competitiveness or quality. Shapes the specialized knowledge of the entire area.`, 
                  example: `Process Engineer: Develops recognized procedure for complex laminate; trains colleagues at all locations.` 
                }
              }
            },
            {
              id: "c2",
              title: "Communication & Collaboration",
              category: "core",
              icon: MessageCircle,
              definition: `Covers information sharing, knowledge exchange, feedback culture, and cross-departmental cooperation. Essential for breaking down silos.`,
              levels: {
                1: { 
                  text: `Actively refuses to share information or works in a "protective mentality." Colleagues are surprised by important developments because the person didn't inform them. In team situations, an oppressive or dismissive atmosphere arises. Uses language that excludes or attacks others. Ignores requests or gives delayed, incomplete answers. Own performance is prioritized while team needs are neglected.`, 
                  example: `Production: Conceals machine problems, causes delays downstream.` 
                },
                2: { 
                  text: `Passes information only upon request or sporadically. Occasionally forgets to inform relevant parties. Uses inefficient channels (e.g., informal instead of written), leading to misunderstandings. May become defensive when receiving feedback or dismisses criticism as personal attacks. Team cooperation depends heavily on mood or is perceived as extra effort.`, 
                  example: `Shift worker: Forgot shift handover entry – follow-up shift runs into avoidable problem.` 
                },
                3: { 
                  text: `BASELINE: Proactively informs all relevant people – timely, in appropriate form. Gives and receives constructive feedback respectfully. Actively shares knowledge within the team. Uses existing channels (meetings, ticket systems, emails) reliably. Contributes actively in team situations and takes colleagues' perspectives into account. Cooperates appreciatively and smoothly within and outside own team.`, 
                  example: `Maintenance: Emails shift leaders after repair, logs action in system.` 
                },
                4: { 
                  text: `Creates understanding across departments and roles: explains backgrounds, invites dialogue, asks for input. Recognizes silos and actively works to break them down. Builds bridges in conflicts and finds constructive solutions. Is a valued sparring partner for ideas. Promotes transparent culture by sharing information broadly and voluntarily.`, 
                  example: `Team Lead: Organizes weekly cross-department briefing to prevent information gaps.` 
                },
                5: { 
                  text: `Establishes new standards for collaboration (processes, tools, meetings) that are adopted by other teams. Recognized mediator for complex interpersonal tensions. Builds a network of trust across all locations. Maintains a feedback culture that promotes continuous improvement and strengthens trust. Represents "Fast, Fair, Personal" in every interaction.`, 
                  example: `Manager: Introduces cross-location video standup; makes implicit knowledge visible.` 
                }
              }
            },
            {
              id: "c3",
              title: "Problem-Solving Skills",
              category: "core",
              icon: Lightbulb,
              definition: `Systematic analysis of problems, development of sustainable solutions, and self-responsible action. No passing the buck.`,
              levels: {
                1: { 
                  text: `The employee blocks at the first hurdle. Complains about problems but shows no initiative to solve them. Either does nothing or escalates everything immediately without own contribution. Reacts passively-aggressively when asked to contribute to solutions. Work remains unfinished. At best, fixes symptoms but not root causes. Appears overwhelmed by even minor changes or obstacles.`, 
                  example: `Production: Stops work, waits hours instead of seeking solution independently.` 
                },
                2: { 
                  text: `Addresses only symptoms, not root causes – problems recur. Escalates too early without own solution attempts or too late so that the situation worsens. Applies known patterns schematically even when inadequate. Does not transfer solutions to other contexts. Requires guidance to analyze situations. Ideas remain superficial.`, 
                  example: `Operator: Replaces same part repeatedly, fails to recognize underlying defect.` 
                },
                3: { 
                  text: `BASELINE: Analyzes problems structurally, identifies causes. Develops independent, pragmatic solutions within own area. Uses existing escalation paths when necessary, but not prematurely. Documents problems and solutions so they remain traceable. Distinguishes urgent from important and acts accordingly. Accepts responsibility for failures and works on their improvement.`, 
                  example: `Shift Lead: Reduces setup time through structured analysis and small process adjustment.` 
                },
                4: { 
                  text: `Recognizes patterns across cases and derives improvements that go beyond a single incident. Develops alternative solutions and weighs them against each other. Leads team-wide problem analyses (root cause analysis, retrospectives). Makes complex technical or organizational problems understandable. Provides impulses for process optimization.`, 
                  example: `Quality: Leads 5-Why workshop, closes systematic complaints.` 
                },
                5: { 
                  text: `Solves strategically relevant problems (e.g., cross-location process, major customer complaints, investment decisions). Acts as a role model in crisis situations: remains calm, establishes structure, leads others out of chaos. Recognizes systemic weaknesses that others overlook and initiates structural changes that contribute to sustainable development.`, 
                  example: `Ops Manager: Leads turnaround in failing project; afterward becomes mentor for problem solving.` 
                }
              }
            },
            {
              id: "c4",
              title: "Adaptability",
              category: "core",
              icon: Brain,
              definition: `Willingness to embrace new processes, technologies, responsibilities. Openness to feedback and personal development.`,
              levels: {
                1: { 
                  text: `Actively resists changes or new processes. Expresses openly negative attitudes: "That's how we've always done it." Shows no interest in own development, ignores training offerings. Stays in comfort zone and avoids learning experiences. Refuses to transfer tasks and behaves in a way that makes change more difficult.`, 
                  example: `Veteran: Refuses to learn new software; blocks colleagues' learning.` 
                },
                2: { 
                  text: `Goes along with changes only under pressure and often half-heartedly. New knowledge is learned slowly; interest in further development is low. Uses training but shows little initiative for independent learning. Sometimes passive when priorities shift. Waits for instructions instead of adapting proactively.`, 
                  example: `Technician: Uses new tool only when forced; has to be reminded repeatedly.` 
                },
                3: { 
                  text: `BASELINE: Is curious about new topics and approaches. Reflects on own work style and accepts constructive criticism. Responds flexibly to priority changes and adapts without loss of motivation. Uses offered training and implements what was learned. Contributes to continuous improvement, such as suggestions that make daily work easier.`, 
                  example: `Warehouse: Proposes new labeling after attending logistics training.` 
                },
                4: { 
                  text: `Actively seeks new knowledge, recognizes trends, and brings them to the team. Acts as a catalyst for change: convinces skeptics and supports implementation. Creates learning opportunities for self and others. Adapts quickly to fundamental changes without drop in motivation.`, 
                  example: `Team Lead: Introduces new production method from trade fair, leads pilot run.` 
                },
                5: { 
                  text: `Anticipates future trends or challenges and prepares the organization. Builds structures that increase adaptability (cross-training, modular processes). Shapes cultural change by embodying openness and learning orientation. Inspires others to embrace change.`, 
                  example: `Plant Manager: Initiates Transformation Workshop Series; equips plant for Industry 4.0.` 
                }
              }
            },
            {
              id: "c5",
              title: "Self-Organization",
              category: "core",
              icon: Clock,
              definition: `Time management, prioritization, reliability, resource management. Ensures personal contribution is plannable and predictable.`,
              levels: {
                1: { 
                  text: `Is chaotic: deadlines are frequently missed, tasks are forgotten or handled only partially. Work can hardly be planned for others. No visible priorities – works on random items. Commits to things but doesn't keep commitments, causing domino effects. Meetings and work start late, materials are not found.`, 
                  example: `Admin: Forgot important deadline – customer loses order.` 
                },
                2: { 
                  text: `Requires external structure and guidance to stay organized. Works reasonably well with clear instructions but has difficulties managing own time when given more autonomy. Re-prioritizes only when pointed out. Occasionally shows reactivity in case of overload but no forward-looking capacity management.`, 
                  example: `Assistant: Needs reminders for recurring tasks; forgets follow-ups.` 
                },
                3: { 
                  text: `BASELINE: Plans work reliably, keeps appointments and deadlines. Prioritizes sensibly and identifies time-critical tasks. Keeps commitments and communicates early when obstacles arise. Works with clear focus and avoids unnecessary distractions. Has a transparent overview of current projects and contributes personal share to team success.`, 
                  example: `Controller: Prepares monthly closing on time, communicates bottleneck proactively.` 
                },
                4: { 
                  text: `Plans ahead, anticipates bottlenecks, and reserves buffers. Relieves others by taking over coordination tasks. Continuously optimizes own ways of working (tools, routines) and shares improvements. Can successfully manage multiple work streams simultaneously without loss of quality.`, 
                  example: `Planner: Synchronizes three parallel projects, avoids bottleneck through early resource coordination.` 
                },
                5: { 
                  text: `Coordinates complex projects across departments or locations and brings them to a successful conclusion on schedule. Establishes standards for self-organization that others adopt (templates, checklists, work principles). Is trusted for particularly complex or ambiguous tasks. Acts as role model for organized and structured work.`, 
                  example: `Project Lead: Coordinates major investment across all locations, delivers on time and under budget.` 
                }
              }
            },
            {
              id: "l1",
              title: "Employee Management & Development",
              category: "leadership",
              icon: Users,
              definition: `Leadership through development – motivation, coaching, feedback, personnel development in the team.`,
              levels: {
                1: { 
                  text: `The manager shows no interest in the professional or personal development of their team. Team discussions are avoided or only superficial; annual conversations (if held at all) are formalistic and without value. There's constant micromanagement, creating a climate of distrust and leading to high turnover. High performers leave. Conflicts in the team are ignored or made worse. No succession planning or talent development visible.`, 
                  example: `Shift Lead: Criticizes only, never praises. Demotivates team, increases sick leave.` 
                },
                2: { 
                  text: `The manager holds mandatory conversations but avoids clear, uncomfortable feedback ("uncomfortable conversations"). High performers are insufficiently challenged, low performers not addressed. Development is left to HR or chance. The manager tends to reward loyalty or personal sympathy rather than performance. Team dynamics are hardly shaped, impulses for development are lacking. Little structured follow-up on coaching discussions.`, 
                  example: `Team Lead: Holds annual reviews superficially; forgets development agreements.` 
                },
                3: { 
                  text: `BASELINE: Regular, prepared team discussions with specific feedback (strengths, development areas). Coaching approach: promotes independent solutions instead of just prescribing. Addresses performance differences early and follows up on agreements. Delegates consciously, transfers responsibility for development. Interested in individual career aspirations and promotes appropriate measures (training, projects, mentoring).`, 
                  example: `Manager: Implements monthly feedback loops, prepares successors targeted.` 
                },
                4: { 
                  text: `The manager has a strategic development plan for their team: knows potentials, identifies and develops high performers, supports lateral moves for stagnating employees. Holds difficult conversations (low performance, conflicts) with clear outcome. Creates a learning environment where mistakes are allowed. Attracts and retains talents. Engages personally in mentoring and is valued for it.`, 
                  example: `Department Head: Promotes talent visibly, makes own team diverse and resilient.` 
                },
                5: { 
                  text: `Creates a sustainable leadership culture: the manager develops successors who themselves become excellent leaders. Exports best practices for people development to other locations. Has an outstanding record for talent retention and employee satisfaction. Is internally and externally known as employer of choice advocate. Leaves behind a sustainably strong team.`, 
                  example: `Director: Builds talent factory – team members develop into successful leaders.` 
                }
              }
            },
            {
              id: "l2",
              title: "Strategic Thinking",
              category: "leadership",
              icon: TrendingUp,
              definition: `Thinking ahead: understands competitive environment, develops foresight, initiates strategically.`,
              levels: {
                1: { 
                  text: `The manager is trapped in tunnel vision. Works purely reactively, always on the next acute fire without understanding context. Strategic topics (strategy 2035, market changes, competitive position) are ignored or not even understood. Sees neither risks nor opportunities at the horizon. Decisions are short-term and not aligned with the bigger picture. Doesn't communicate company goals to the team.`, 
                  example: `Manager: Focuses only on delivery pressure; ignores changing customer requirements.` 
                },
                2: { 
                  text: `The manager understands strategic guidelines but hardly translates them into own area. Operational day-to-day dominates thinking. Rarely links decisions to the strategic context or larger goals. Reacts to external changes (customer requirements, market shifts) only with delay. Rarely brings own ideas for strategic improvement.`, 
                  example: `Sales Lead: Focuses on ongoing business; misses emerging product trend.` 
                },
                3: { 
                  text: `BASELINE: The manager translates company strategy into tangible goals for their team. Shows connections to the bigger picture. Recognizes strategic developments (e.g., sustainability, automation) and aligns own planning accordingly. Actively informs themselves about customer, market, and industry trends. Makes strategic statements comprehensible for the team.`, 
                  example: `Production: Aligns shift planning to known plant strategy, takes capacity reserves.` 
                },
                4: { 
                  text: `The manager anticipates developments (technology, customer, competitive situation) and proactively builds competencies or capacities. Challenges the status quo ("What if...?") and brings substantiated proposals for improvement or innovation. Thinks in scenarios and prepares alternatives. Continuously brings external impulses (trade fairs, networks, publications) into the team.`, 
                  example: `Operations: Initiates automation pilot before cost pressure occurs.` 
                },
                5: { 
                  text: `The manager shapes strategic direction for their area or beyond – develops new business models, negotiates partnerships, or leads M&A projects. Is involved in strategic decision-making of the group. Has a broad overview of the competitive situation and contributes recognized impulses. Is a thought leader who influences direction inside and outside the organization.`, 
                  example: `Division Lead: Develops new service offering, opens new revenue stream.` 
                }
              }
            },
            {
              id: "l3",
              title: "Decision-Making",
              category: "leadership",
              icon: ShieldAlert,
              definition: `Deciding under uncertainty, courage for risky decisions, transparency about what and why.`,
              levels: {
                1: { 
                  text: `The manager chronically avoids decisions. Every somewhat significant question is escalated upward. Employees remain in limbo, initiative is blocked. If decisions are made, they are reversed at the smallest resistance. Taking responsibility is refused; in case of failures, blame is shifted to others. Decisions are not communicated transparently – the team doesn't know what applies and why.`, 
                  example: `Manager: Keeps everything in limbo, escalates everything. Team frustrated.` 
                },
                2: { 
                  text: `The manager makes decisions when information situation is almost perfect, but hesitates when data are ambiguous. Avoids politically sensitive decisions. Sticks too long to wrong decisions because of loss aversion or not to appear inconsistent. Doesn't always communicate decisions clearly or justifies them insufficiently. Risk considerations are superficial.`, 
                  example: `Team Lead: Holds back project budget until last minute; misses deadline.` 
                },
                3: { 
                  text: `BASELINE: The manager makes decisions within their mandate in a timely and transparent manner. Weighs risks and opportunities, documents considerations, and stands by results. Communicates decisions clearly – everyone knows what applies and why. Accepts that some decisions turn out wrong and draws learnings from this.`, 
                  example: `Shift Lead: Decides on overtime with clear reasoning, stands by when questioned.` 
                },
                4: { 
                  text: `The manager makes uncomfortable decisions (layoffs, reprioritization, investment stop) when necessary, even if these are unpopular. Intelligently manages risk: takes calculated risks for improvement without gambling. Shows courage to decide without full consensus when time is of the essence. Weighs costs of delaying decisions.`, 
                  example: `Plant Manager: Decides on shift restructuring – communicates personally, accompanies change.` 
                },
                5: { 
                  text: `The manager makes strategic, far-reaching decisions with courage and clarity – including in ambiguous situations or under high political pressure. Is known for principled decision-making that is later validated. Maintains decision quality even in crisis mode (no panic decisions). Actively seeks feedback on decision quality.`, 
                  example: `Director: Decides on fundamental reorientation during market downturn – leads restructuring successfully.` 
                }
              }
            },
            {
              id: "l4",
              title: "Execution & Performance Management",
              category: "leadership",
              icon: Target,
              definition: `Achieving results, consistent follow-through, demanding and supporting. Getting things done.`,
              levels: {
                1: { 
                  text: `The manager neither sets clear goals nor follows up on them. Expectations are unclear, performance is neither measured nor addressed. Promises to customers, management, or other stakeholders are frequently broken or missed – without consequences. No prioritization recognizable. In the team, anything goes; low performers run with no response. Meetings end without clear actions.`, 
                  example: `Manager: Tolerates delay after delay; customer loses trust.` 
                },
                2: { 
                  text: `Goals are stated but not consistently followed up. The manager remembers agreements only when already off track. Feedback on performance gaps is superficial or avoided. Requires only under pressure, then too harshly; no balance. Responds to performance problems too late or not at all. Tracking in meetings is unstructured.`, 
                  example: `Team Lead: Lets quota slip, only notices at month end.` 
                },
                3: { 
                  text: `BASELINE: The manager sets clear, understandable goals for their team. Expectations are transparent, performance is regularly discussed. Requires adherence to agreements and addresses deviations early. Supports team in goal achievement but doesn't take over responsibility. Distinguishes conscious goal adjustment from failure. Establishes a reliable progress tracking.`, 
                  example: `Production: Visualizes weekly targets, follows up on deviations, supports team.` 
                },
                4: { 
                  text: `The manager is rigorously consistent but without demotivating. Balances pressure and support. Establishes a performance culture where everyone gives their best. Reduces KPI blind spots through targeted measurement concepts. Proactively identifies risks for goal achievement and initiates countermeasures. Can simultaneously track multiple important initiatives.`, 
                  example: `Operations: Drives cost optimization, celebrates milestones, maintains team morale.` 
                },
                5: { 
                  text: `The manager establishes a cross-site performance culture that sets standards for the group. Leads major initiatives with strategic significance and track record of success. Is known for delivering what is promised. Shapes improvement practices (OKR, KPIs, retros) that are adopted by other areas. Develops leaders who bring the same rigor.`, 
                  example: `VP: Drives group-wide Lean initiative; measurable productivity gains.` 
                }
              }
            },
            {
              id: "l5",
              title: "Stakeholder & Conflict Resolution",
              category: "leadership",
              icon: Award,
              definition: `Cultivating relationships, moderating political interests. Bridge builder between silos.`,
              levels: {
                1: { 
                  text: `The manager completely ignores the interests of other departments or locations. Doesn't communicate with important stakeholders, leading to surprises and resistance. In conflicts behaves destructively: searches for culprits instead of solutions, speaks badly about other areas ("Those up/down there") or carries out conflicts aggressively and non-objectively. Alternatively, conflicts are ignored or waited out until they escalate. Behavior massively damages trust and cooperation in the group.`, 
                  example: `Prod Manager: Curses about 'incompetent sales' instead of clarifying feasibility directly.` 
                },
                2: { 
                  text: `The manager cultivates relationships only when acutely needing something (transactional). Frequently forgets to involve relevant partners (e.g., HR, IT, other locations) in time, delaying projects. Recognizes political faux pas often too late. In case of conflicts reacts defensively or withdraws to "keep the peace" even when clarification would be necessary. Solutions are often weak compromises that satisfy no one. Struggles to take the counterpart's perspective.`, 
                  example: `Project Lead: Forgets to inform works council. Withdraws project offended at veto.` 
                },
                3: { 
                  text: `BASELINE: The manager knows their most important stakeholders and keeps them regularly informed. Coordinates proactively to avoid misunderstandings. Meets partners – internal or external – with respect and on equal footing. Conflicts are addressed in a timely manner ("Fast") and discussed objectively. Represents the interests of their area, but is ready to listen to counterarguments and find fair solutions. Ensures cooperation runs smoothly.`, 
                  example: `Service/Supply: Shows figures, agrees objectively on minimum stock (Compromise).` 
                },
                4: { 
                  text: `The manager actively builds a resilient network beyond department boundaries. Anticipates potential conflicts (e.g., resource bottlenecks between projects) and moderates them preventively before they escalate. Understands the constraints and goals of the other side and offers solutions that help both ("Win-Win"). Is appreciated by other departments as a reliable partner who not only asks but also supports. Can communicate even difficult messages diplomatically and respectfully.`, 
                  example: `Quality: Travels to locations, moderates workshop for common standard.` 
                },
                5: { 
                  text: `The manager resolves complex, stuck conflicts (e.g., cultural tensions between locations or historical turf wars) where others have failed. Succeeds in aligning diverse interests toward the common strategic goal ("One Niederwieser"). Establishes committees or formats that structurally improve exchange and stakeholder management. Enjoys highest trust with management and employee representatives and uses this capital for the company's good. Transforms adversaries into partners.`, 
                  example: `Manager: Breaks old silos, integrates hostile teams into successful unit.` 
                }
              }
            }
          ]
          }
        };

        // --- QUIZ DATA (Removed, but keeping definition for completeness) ---
        const QUIZ_QUESTIONS = { de: [], it: [], en: [] }; // Leeren, da Quiz entfernt wird

        // --- REACT COMPONENT ---

        // ============================================
        // PRINT LAYOUT COMPONENT - Professioneller PDF-Export
        // ============================================
        const PrintLayout = ({ type, data, lang }) => {
          const e = React.createElement;
          
          // Texte für verschiedene Sprachen
          const texts = {
            de: {
              coverTitle: type === 'goals' ? 'Zielvereinbarung' : type === 'review' ? 'Leistungsbeurteilung' : 'Selbstreflexion',
              coverSubtitle: 'Performance Management',
              period: 'Beurteilungszeitraum',
              employee: 'Mitarbeiter/in',
              manager: 'Führungskraft',
              position: 'Position',
              department: 'Abteilung',
              date: 'Datum',
              confidential: 'Vertraulich - Nur für den internen Gebrauch',
              goals: 'Zieldefinition',
              weight: 'Gewichtung',
              target: 'Zielwert / Beschreibung',
              development: 'Entwicklungsmaßnahmen',
              measure: 'Maßnahme',
              responsible: 'Verantwortlich',
              deadline: 'Termin',
              signatures: 'Unterschriften',
              signatureNote: 'Mit ihrer Unterschrift bestätigen beide Parteien die Kenntnisnahme und Zustimmung.',
              dateSignature: 'Datum, Unterschrift',
              plannedBonus: 'Geplanter Bonus bei 100%'
            },
            it: {
              coverTitle: type === 'goals' ? 'Accordo sugli Obiettivi' : type === 'review' ? 'Valutazione delle Prestazioni' : 'Autovalutazione',
              coverSubtitle: 'Performance Management',
              period: 'Periodo di valutazione',
              employee: 'Collaboratore',
              manager: 'Responsabile',
              position: 'Posizione',
              department: 'Reparto',
              date: 'Data',
              confidential: 'Riservato - Solo per uso interno',
              goals: 'Definizione degli obiettivi',
              weight: 'Peso',
              target: 'Valore target / Descrizione',
              development: 'Misure di sviluppo',
              measure: 'Misura',
              responsible: 'Responsabile',
              deadline: 'Scadenza',
              signatures: 'Firme',
              signatureNote: 'Con la firma, entrambe le parti confermano la presa visione e l\'accordo.',
              dateSignature: 'Data, Firma',
              plannedBonus: 'Bonus previsto al 100%'
            },
            en: {
              coverTitle: type === 'goals' ? 'Goal Agreement' : type === 'review' ? 'Performance Review' : 'Self-Reflection',
              coverSubtitle: 'Performance Management',
              period: 'Review Period',
              employee: 'Employee',
              manager: 'Manager',
              position: 'Position',
              department: 'Department',
              date: 'Date',
              confidential: 'Confidential - Internal Use Only',
              goals: 'Goal Definition',
              weight: 'Weight',
              target: 'Target Value / Description',
              development: 'Development Measures',
              measure: 'Measure',
              responsible: 'Responsible',
              deadline: 'Deadline',
              signatures: 'Signatures',
              signatureNote: 'With their signature, both parties confirm acknowledgment and agreement.',
              dateSignature: 'Date, Signature',
              plannedBonus: 'Planned Bonus at 100%'
            }
          };
          
          const t = texts[lang] || texts.de;
          const currentDate = new Date().toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB');
          
          // Zahlenformatierung
          const formatNumber = (num) => {
            return new Intl.NumberFormat(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB').format(num);
          };

          // === COVER PAGE ===
          const CoverPage = () => e('div', { 
            style: { 
              pageBreakAfter: 'always', 
              minHeight: '297mm',
              display: 'flex',
              flexDirection: 'column',
              padding: '60px 50px',
              boxSizing: 'border-box'
            }
          },
            // Logo & Branding
            e('div', { style: { marginBottom: '80px' } },
              e('h1', { style: { color: '#243186', fontSize: '42pt', margin: 0, fontWeight: 700, letterSpacing: '-1px' } }, 'nıederwıeser'),
              e('p', { style: { color: '#6EBD84', fontSize: '11pt', margin: '5px 0 0 0', fontWeight: 600, letterSpacing: '3px' } }, 'FLEXIBLE FOOD PACKAGING')
            ),
            
            // Haupttitel
            e('div', { style: { flex: 1, display: 'flex', flexDirection: 'column', justifyContent: 'center' } },
              e('div', { style: { 
                background: 'linear-gradient(135deg, #243186 0%, #1a2564 100%)', 
                color: 'white', 
                padding: '40px 50px',
                borderRadius: '12px',
                marginBottom: '50px'
              }},
                e('h2', { style: { fontSize: '32pt', margin: 0, fontWeight: 700 } }, t.coverTitle),
                e('p', { style: { fontSize: '14pt', margin: '10px 0 0 0', opacity: 0.9 } }, t.coverSubtitle)
              ),
              
              // Stammdaten-Box
              e('div', { style: { 
                background: '#f8fafc', 
                border: '1px solid #e2e8f0',
                borderRadius: '8px',
                padding: '30px 40px'
              }},
                e('div', { style: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' } },
                  e('div', null,
                    e('p', { style: { color: '#64748b', fontSize: '9pt', margin: '0 0 5px 0', textTransform: 'uppercase', letterSpacing: '1px' } }, t.employee),
                    e('p', { style: { color: '#1e293b', fontSize: '14pt', margin: 0, fontWeight: 600 } }, data.employee || '–')
                  ),
                  e('div', null,
                    e('p', { style: { color: '#64748b', fontSize: '9pt', margin: '0 0 5px 0', textTransform: 'uppercase', letterSpacing: '1px' } }, t.manager),
                    e('p', { style: { color: '#1e293b', fontSize: '14pt', margin: 0, fontWeight: 600 } }, data.manager || '–')
                  ),
                  e('div', null,
                    e('p', { style: { color: '#64748b', fontSize: '9pt', margin: '0 0 5px 0', textTransform: 'uppercase', letterSpacing: '1px' } }, t.position),
                    e('p', { style: { color: '#1e293b', fontSize: '12pt', margin: 0 } }, data.position || '–')
                  ),
                  e('div', null,
                    e('p', { style: { color: '#64748b', fontSize: '9pt', margin: '0 0 5px 0', textTransform: 'uppercase', letterSpacing: '1px' } }, t.period),
                    e('p', { style: { color: '#1e293b', fontSize: '12pt', margin: 0 } }, data.period || new Date().getFullYear())
                  )
                )
              )
            ),
            
            // Footer
            e('div', { style: { textAlign: 'center', paddingTop: '40px', borderTop: '1px solid #e2e8f0' } },
              e('p', { style: { color: '#94a3b8', fontSize: '9pt', margin: 0 } }, t.confidential),
              e('p', { style: { color: '#cbd5e1', fontSize: '8pt', margin: '5px 0 0 0' } }, `${t.date}: ${currentDate}`)
            )
          );

          // === GOALS PAGE ===
          const GoalsPage = () => {
            if (!data.goals || data.goals.length === 0) return null;
            
            const totalWeight = data.goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
            
            return e('div', { style: { pageBreakAfter: 'always', padding: '40px 50px' } },
              // Header
              e('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px', paddingBottom: '15px', borderBottom: '2px solid #243186' } },
                e('div', null,
                  e('h1', { style: { color: '#243186', fontSize: '18pt', margin: 0, fontWeight: 700 } }, 'nıederwıeser'),
                  e('p', { style: { color: '#6EBD84', fontSize: '8pt', margin: '2px 0 0 0', letterSpacing: '2px' } }, 'PERFORMANCE MANAGEMENT')
                ),
                e('div', { style: { textAlign: 'right' } },
                  e('p', { style: { color: '#64748b', fontSize: '9pt', margin: 0 } }, data.employee),
                  e('p', { style: { color: '#94a3b8', fontSize: '8pt', margin: '2px 0 0 0' } }, data.period || new Date().getFullYear())
                )
              ),
              
              // Ziele Sektion
              e('div', { style: { marginBottom: '30px' } },
                e('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: '#f8fafc', padding: '12px 16px', borderLeft: '4px solid #3b82f6', marginBottom: '15px' } },
                  e('h3', { style: { fontSize: '14pt', margin: 0, color: '#1e40af', fontWeight: 600 } }, t.goals),
                  e('span', { style: { 
                    background: totalWeight === 100 ? '#dcfce7' : '#fef9c3', 
                    color: totalWeight === 100 ? '#166534' : '#854d0e',
                    padding: '4px 12px',
                    borderRadius: '20px',
                    fontSize: '10pt',
                    fontWeight: 600
                  }}, `${t.weight}: ${totalWeight}%`)
                ),
                
                // Ziele Tabelle
                e('table', { style: { width: '100%', borderCollapse: 'collapse', fontSize: '10pt' } },
                  e('thead', null,
                    e('tr', { style: { background: '#1e40af', color: 'white' } },
                      e('th', { style: { padding: '10px 12px', textAlign: 'left', fontWeight: 600, width: '35%' } }, t.goals),
                      e('th', { style: { padding: '10px 12px', textAlign: 'center', fontWeight: 600, width: '60px' } }, t.weight),
                      data.plannedBonus && e('th', { style: { padding: '10px 12px', textAlign: 'right', fontWeight: 600, width: '80px' } }, 'Bonus €'),
                      e('th', { style: { padding: '10px 12px', textAlign: 'left', fontWeight: 600 } }, t.target)
                    )
                  ),
                  e('tbody', null,
                    data.goals.map((goal, idx) => {
                      const goalBonus = data.plannedBonus ? (parseFloat(data.plannedBonus) * (parseFloat(goal.weight) || 0) / 100) : 0;
                      return e('tr', { key: idx, style: { background: idx % 2 === 0 ? '#ffffff' : '#f8fafc' } },
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', fontWeight: 500, verticalAlign: 'top' } }, goal.name || '–'),
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', textAlign: 'center', verticalAlign: 'top' } },
                          e('span', { style: { background: '#dbeafe', color: '#1e40af', padding: '2px 8px', borderRadius: '10px', fontWeight: 700, fontSize: '9pt' } }, `${goal.weight}%`)
                        ),
                        data.plannedBonus && e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', textAlign: 'right', fontWeight: 600, color: '#065f46', verticalAlign: 'top' } }, `${formatNumber(Math.round(goalBonus))} €`),
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', color: '#475569', fontSize: '9pt', verticalAlign: 'top' } }, goal.target || '–')
                      );
                    })
                  )
                ),
                
                // Bonus Summe
                data.plannedBonus && e('div', { style: { 
                  marginTop: '15px', 
                  padding: '15px 20px', 
                  background: 'linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%)', 
                  border: '1px solid #6ee7b7',
                  borderRadius: '8px',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }},
                  e('span', { style: { fontSize: '11pt', color: '#065f46', fontWeight: 600 } }, t.plannedBonus + ':'),
                  e('span', { style: { fontSize: '20pt', fontWeight: 900, color: '#065f46' } }, `${formatNumber(data.plannedBonus)} €`)
                )
              ),
              
              // Entwicklungsmaßnahmen
              data.devPlan && data.devPlan.length > 0 && data.devPlan[0].measure && e('div', { style: { marginBottom: '30px' } },
                e('div', { style: { background: '#f8fafc', padding: '12px 16px', borderLeft: '4px solid #6EBD84', marginBottom: '15px' } },
                  e('h3', { style: { fontSize: '14pt', margin: 0, color: '#166534', fontWeight: 600 } }, t.development)
                ),
                e('table', { style: { width: '100%', borderCollapse: 'collapse', fontSize: '10pt' } },
                  e('thead', null,
                    e('tr', { style: { background: '#166534', color: 'white' } },
                      e('th', { style: { padding: '10px 12px', textAlign: 'left', fontWeight: 600 } }, t.measure),
                      e('th', { style: { padding: '10px 12px', textAlign: 'left', fontWeight: 600, width: '120px' } }, t.responsible),
                      e('th', { style: { padding: '10px 12px', textAlign: 'center', fontWeight: 600, width: '100px' } }, t.deadline)
                    )
                  ),
                  e('tbody', null,
                    data.devPlan.filter(d => d.measure).map((dev, idx) => 
                      e('tr', { key: idx, style: { background: idx % 2 === 0 ? '#ffffff' : '#f0fdf4' } },
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', verticalAlign: 'top' } }, dev.measure || '–'),
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', verticalAlign: 'top' } }, dev.responsible || '–'),
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', textAlign: 'center', verticalAlign: 'top' } }, dev.deadline || '–')
                      )
                    )
                  )
                )
              )
            );
          };

          // === SIGNATURE PAGE ===
          const SignaturePage = () => e('div', { style: { padding: '40px 50px' } },
            // Header
            e('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px', paddingBottom: '15px', borderBottom: '2px solid #243186' } },
              e('div', null,
                e('h1', { style: { color: '#243186', fontSize: '18pt', margin: 0, fontWeight: 700 } }, 'nıederwıeser'),
                e('p', { style: { color: '#6EBD84', fontSize: '8pt', margin: '2px 0 0 0', letterSpacing: '2px' } }, 'PERFORMANCE MANAGEMENT')
              ),
              e('div', { style: { textAlign: 'right' } },
                e('p', { style: { color: '#64748b', fontSize: '9pt', margin: 0 } }, data.employee),
                e('p', { style: { color: '#94a3b8', fontSize: '8pt', margin: '2px 0 0 0' } }, data.period || new Date().getFullYear())
              )
            ),
            
            // Unterschriften Box
            e('div', { style: { 
              marginTop: '40px',
              padding: '30px 40px', 
              border: '2px solid #243186', 
              borderRadius: '12px'
            }},
              e('h3', { style: { fontSize: '14pt', margin: '0 0 15px 0', color: '#243186', fontWeight: 600, textAlign: 'center' } }, t.signatures),
              e('p', { style: { fontSize: '10pt', color: '#64748b', textAlign: 'center', marginBottom: '50px' } }, t.signatureNote),
              
              e('div', { style: { display: 'flex', justifyContent: 'space-between', marginTop: '60px' } },
                e('div', { style: { width: '42%', textAlign: 'center' } },
                  e('div', { style: { borderBottom: '2px solid #1e293b', height: '60px' } }),
                  e('p', { style: { margin: '10px 0 0 0', fontSize: '10pt', color: '#64748b' } }, t.employee),
                  e('p', { style: { margin: '3px 0 0 0', fontSize: '8pt', color: '#94a3b8' } }, t.dateSignature)
                ),
                e('div', { style: { width: '42%', textAlign: 'center' } },
                  e('div', { style: { borderBottom: '2px solid #1e293b', height: '60px' } }),
                  e('p', { style: { margin: '10px 0 0 0', fontSize: '10pt', color: '#64748b' } }, t.manager),
                  e('p', { style: { margin: '3px 0 0 0', fontSize: '8pt', color: '#94a3b8' } }, t.dateSignature)
                )
              )
            ),
            
            // Footer
            e('div', { style: { marginTop: '60px', paddingTop: '15px', borderTop: '1px solid #e2e8f0', textAlign: 'center' } },
              e('p', { style: { fontSize: '9pt', color: '#94a3b8', margin: 0 } }, 
                `Niederwieser Group | ${t.coverSubtitle} | ${currentDate}`
              ),
              e('p', { style: { fontSize: '8pt', color: '#cbd5e1', margin: '5px 0 0 0' } }, t.confidential)
            )
          );

          // === MAIN RENDER ===
          return e('div', { 
            id: 'print-layout-container',
            style: { 
              fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
              fontSize: '10pt',
              color: '#1e293b',
              background: 'white'
            }
          },
            e(CoverPage),
            e(GoalsPage),
            e(SignaturePage)
          );
        };

        // === ZIELVEREINBARUNG COMPONENT (Simplified Goal Agreement) ===
        const Zielvereinbarung = ({ lang, onSaveTeam, onCancel }) => {
            const t = FORM_TEXT[lang] || FORM_TEXT['de'];
            const formRef = useRef(null);

            
            // === TEAM CONTEXT ===
            const [teamContext, setTeamContext] = useState(null);
            const [teamButtonsVisible, setTeamButtonsVisible] = useState(false);
            
            useEffect(() => {
              const ctx = localStorage.getItem('nw_current_employee');
              console.log('🔍 Zielvereinbarung useEffect triggered');
              console.log('   localStorage nw_current_employee:', ctx);
              
              if (ctx) {
                try {
                  const data = JSON.parse(ctx);
                  console.log('✓ Parsed team context:', data);
                  setTeamContext(data);
                  setTeamButtonsVisible(true);
                  console.log('✓ teamButtonsVisible set to TRUE');
                  
                  // Load existing data if available
                  if (data.existingData) {
                    const existing = data.existingData;
                    
                    // Set form data
                    setFormData(prev => ({
                      ...prev,
                      employee: existing.employeeName || data.employee.name,
                      position: existing.position || data.employee.position,
                      manager: existing.formData?.manager || prev.manager,
                      date: existing.updatedAt ? existing.updatedAt.split('T')[0] : prev.date,
                      plannedBonus: existing.formData?.plannedBonus || ''
                    }));
                    
                    // Set goals if exists
                    if (existing.goals && existing.goals.length > 0) {
                      setGoals(existing.goals);
                    }
                    
                    // Set devPlan if exists
                    if (existing.devPlan && existing.devPlan.length > 0) {
                      setDevPlan(existing.devPlan);
                    }
                  } else {
                    // New appraisal - set employee data
                    setFormData(prev => ({
                      ...prev,
                      employee: data.employee.name,
                      position: data.employee.position
                    }));
                  }
                } catch (e) {
                  console.error('Error loading team context:', e);
                }
              }
            }, []);
            
            const handleSaveTeamAppraisal = (status) => {
              if (!teamContext || !onSaveTeam) {
                alert('Team-Kontext fehlt!');
                return;
              }
              
              // Für Zielvereinbarungen: kein GPS-Score berechnen
              const appraisal = {
                id: teamContext.appraisalId,
                type: 'goals', // WICHTIG: Typ auf 'goals' setzen
                employeeId: teamContext.employee.id,
                employeeName: teamContext.employee.name,
                position: teamContext.employee.position,
                period: teamContext.period,
                status: status,
                createdAt: teamContext.existingData?.createdAt || new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                goals: goals,
                devPlan: devPlan,
                formData: formData,
                // Für Zielvereinbarungen keine GPS-relevanten Scores
                gpsScore: 0,
                wasScore: 0,
                wieCoreScore: 0,
                wieLeaderScore: 0
              };
              
              // Debug-Log
              console.log('💾 Speichere Zielvereinbarung:', {
                status,
                goalsCount: goals.length,
                totalWeight: goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0)
              });
              
              onSaveTeam(appraisal);
            };
            
            const handleCancelTeam = () => {
              if (confirm(lang === 'de' ? 'Abbrechen? Änderungen gehen verloren.' : lang === 'it' ? 'Annullare? Le modifiche andranno perse.' : 'Cancel? Changes will be lost.')) {
                localStorage.removeItem('nw_current_employee');
                if (onCancel) onCancel();
              }
            };
            
            const [isGenerating, setIsGenerating] = useState(false);
            
            const [formData, setFormData] = useState({
                employee: '', 
                position: '', 
                manager: '', 
                date: new Date().toISOString().split('T')[0],
                plannedBonus: ''  // Geplanter Bonus (100%)
            });
            
            const [goals, setGoals] = useState([
                { id: 101, name: '', weight: 60, target: '' },
                { id: 102, name: '', weight: 40, target: '' }
            ]);
            
            const [devPlan, setDevPlan] = useState([
                { id: 201, measure: '', responsible: '', deadline: '' }
            ]);

            const handleFormChange = (field, val) => setFormData({...formData, [field]: val});
            
            // Hilfsfunktion: Tausenderpunkte aus Eingabe entfernen (1.000 → 1000)
            const parseGermanNumber = (str) => {
                if (!str) return '';
                // Entferne Tausenderpunkte und ersetze Komma durch Punkt für Dezimalzahlen
                return str.replace(/\./g, '').replace(',', '.');
            };
            
            // Hilfsfunktion: Zahl mit Tausenderpunkten formatieren (1000 → 1.000)
            const formatGermanNumber = (num) => {
                if (!num && num !== 0) return '';
                const numStr = String(num).replace(/[^\d]/g, '');
                if (!numStr) return '';
                return Number(numStr).toLocaleString('de-DE');
            };
            
            // Handler für Bonus-Feld mit Tausenderpunkt-Unterstützung
            const handleBonusChange = (val) => {
                // Erlaube nur Zahlen und Punkte
                const cleanVal = val.replace(/[^\d.]/g, '');
                // Speichere den rohen Wert ohne Formatierung für die Berechnung
                const numericVal = parseGermanNumber(cleanVal);
                setFormData({...formData, plannedBonus: numericVal});
            };
            
            // Formatierter Bonus für die Anzeige
            const displayBonus = formData.plannedBonus ? formatGermanNumber(formData.plannedBonus) : '';
            
            const updateItem = (list, setList, id, field, val) => {
                setList(list.map(i => {
                    if (i.id !== id) return i;
                    // Parse numeric fields to ensure calculations work correctly
                    if (field === 'weight') {
                        return { ...i, [field]: parseFloat(val) || 0 };
                    }
                    return { ...i, [field]: val };
                }));
            };
            const addItem = (list, setList, template) => setList([...list, { ...template, id: Date.now() }]);
            const removeItem = (list, setList, id) => setList(list.filter(i => i.id !== id));

            const handleDownloadPDF = async () => {
                if (!window.html2pdf) {
                    alert("PDF-Bibliothek nicht geladen. Bitte Seite neu laden.");
                    return;
                }
                
                // Validierung: Warnung bei sehr langen Texten
                const allGoalTexts = goals.map(g => (g.name || '').length).reduce((a, b) => a + b, 0);
                const allDevTexts = devPlan.map(d => (d.measure || '').length).reduce((a, b) => a + b, 0);
                const totalTextLength = allGoalTexts + allDevTexts;
                
                if (totalTextLength > 5000) {
                    const proceed = confirm(lang === 'de' 
                        ? `⚠️ Das Dokument enthält sehr viel Text (${Math.round(totalTextLength/1000)}k Zeichen).\n\nBei extrem langen Texten können Seitenumbrüche im PDF problematisch sein.\n\nTipp: Formulieren Sie prägnant und verwenden Sie Stichpunkte.\n\nTrotzdem fortfahren?`
                        : lang === 'it'
                        ? `⚠️ Il documento contiene molto testo (${Math.round(totalTextLength/1000)}k caratteri).\n\nCon testi molto lunghi, le interruzioni di pagina nel PDF possono essere problematiche.\n\nSuggerimento: Formulare in modo conciso e usare punti elenco.\n\nContinuare comunque?`
                        : `⚠️ Document contains a lot of text (${Math.round(totalTextLength/1000)}k characters).\n\nWith very long texts, page breaks in the PDF may be problematic.\n\nTip: Formulate concisely and use bullet points.\n\nProceed anyway?`
                    );
                    if (!proceed) return;
                }
                
                setIsGenerating(true);
                let pdfContainer = null;
                let printRoot = null;
                
                try {
                    // Daten für PrintLayout vorbereiten
                    const pdfData = {
                        employee: formData.employee || '–',
                        manager: formData.manager || '–',
                        position: formData.position || '–',
                        period: formData.date ? (() => {
                            const parts = formData.date.split('-');
                            return parts.length === 3 ? `${parts[2]}.${parts[1]}.${parts[0]}` : formData.date;
                        })() : new Date().getFullYear().toString(),
                        goals: goals,
                        devPlan: devPlan,
                        plannedBonus: formData.plannedBonus
                    };
                    
                    // Container für PrintLayout erstellen
                    pdfContainer = document.createElement('div');
                    pdfContainer.id = 'pdf-render-container';
                    pdfContainer.style.cssText = `
                        width: 210mm;
                        background: white;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        color: #1e293b;
                        font-size: 10pt;
                        line-height: 1.5;
                        position: absolute;
                        left: -9999px;
                        top: 0;
                    `;
                    document.body.appendChild(pdfContainer);
                    
                    // PrintLayout rendern
                    printRoot = ReactDOM.createRoot(pdfContainer);
                    printRoot.render(React.createElement(PrintLayout, {
                        type: 'goals',
                        data: pdfData,
                        lang: lang
                    }));
                    
                    // Promise-basiertes Warten auf DOM-Rendering
                    await new Promise(resolve => {
                        requestAnimationFrame(() => {
                            requestAnimationFrame(resolve);
                        });
                    });
                    // Zusätzliche Wartezeit für React-Rendering
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    const opt = {
                        margin: [10, 10, 10, 10],
                        filename: `Zielvereinbarung_${(formData.employee || 'Export').replace(/[^a-z0-9äöüß]/gi, '_')}.pdf`,
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { 
                            scale: 2,
                            useCORS: true,
                            logging: false,
                            backgroundColor: '#ffffff',
                            windowWidth: 794, // A4 Breite in px bei 96dpi
                            scrollY: 0,
                            scrollX: 0
                        },
                        jsPDF: { 
                            unit: 'mm', 
                            format: 'a4', 
                            orientation: 'portrait',
                            compress: true,
                            hotfixes: ['px_scaling'] // Fix für Skalierungsprobleme
                        },
                        pagebreak: { 
                            mode: ['css', 'legacy'], // 'avoid-all' entfernt - kann zu Abschneidungen führen
                            before: '.pdf-page-break-before',
                            after: '.pdf-page-break-after',
                            avoid: '.pdf-keep-together'
                        }
                    };
                    
                    await window.html2pdf()
                        .set(opt)
                        .from(pdfContainer)
                        .save();
                        
                } catch (error) {
                    console.error('PDF Generation Error:', error);
                    alert(lang === 'de' 
                      ? "Fehler beim PDF-Export: " + error.message + "\n\nTipp: Versuchen Sie, sehr lange Texte zu kürzen."
                      : "Errore export PDF: " + error.message);
                } finally {
                    // Cleanup immer ausführen
                    if (printRoot) {
                        try { printRoot.unmount(); } catch (e) {}
                    }
                    if (pdfContainer && document.body.contains(pdfContainer)) {
                        document.body.removeChild(pdfContainer);
                    }
                    setIsGenerating(false);
                }
            };

            const renderGoalRow = (item) => {
                const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
                const goalBonus = plannedBonusNum > 0 ? (plannedBonusNum * (parseFloat(item.weight) || 0) / 100) : 0;
                
                return e('tr', { key: item.id, className: "break-inside-avoid" },
                    e('td', { className: "p-2 border align-top" }, 
                        e('textarea', { 
                            className: "w-full bg-transparent outline-none font-medium resize-none", 
                            value: item.name, 
                            maxLength: 500,
                            rows: 2,
                            placeholder: lang === 'de' ? 'Zielbezeichnung (max. 500 Zeichen)...' : lang === 'it' ? 'Nome obiettivo (max. 500 caratteri)...' : 'Goal name (max. 500 characters)...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'name', ev.target.value) 
                        }),
                        e('div', { className: 'text-xs text-slate-400 text-right mt-1' }, 
                            `${(item.name || '').length}/500`
                        )
                    ),
                    e('td', { className: "p-2 border text-center w-20 align-top" }, 
                        e('div', { className: "flex items-center justify-center" },
                            e('input', { 
                                type: "number", 
                                className: "w-full bg-transparent outline-none text-right pr-1", 
                                value: item.weight, 
                                onChange: (ev) => updateItem(goals, setGoals, item.id, 'weight', ev.target.value) 
                            }), 
                            e('span', null, "%")
                        )
                    ),
                    // Bonus-Spalte (nur wenn Bonus eingegeben)
                    plannedBonusNum > 0 && e('td', { className: "p-2 border text-center w-24 align-top bg-emerald-50" }, 
                        e('span', { className: "font-semibold text-emerald-700" }, 
                            goalBonus > 0 ? `${formatGermanNumber(goalBonus.toFixed(0))} €` : '–'
                        )
                    ),
                    e('td', { className: "p-2 border align-top" }, 
                        e('input', { 
                            className: "w-full bg-transparent outline-none", 
                            value: item.target, 
                            placeholder: lang === 'de' ? 'z.B. 500.000€, 95% Qualität...' : lang === 'it' ? 'es. 500.000€, 95% qualità...' : 'e.g. 500,000€, 95% quality...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'target', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border text-center no-print w-8 align-top" }, 
                        e('button', { 
                            onClick: () => removeItem(goals, setGoals, item.id), 
                            className: "text-slate-300 hover:text-red-500" 
                        }, e(Trash2, { size: 14 }))
                    )
                );
            };

            const renderDevRow = (item) => (
                e('tr', { key: item.id, className: "break-inside-avoid" },
                    e('td', { className: "p-2 border" }, 
                        e('input', { 
                            className: "w-full bg-transparent outline-none", 
                            value: item.measure, 
                            placeholder: "...", 
                            onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'measure', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border" }, 
                        e('input', { 
                            className: "w-full bg-transparent outline-none", 
                            value: item.responsible, 
                            placeholder: "...", 
                            onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'responsible', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border" }, 
                        e('input', { 
                            type: "date", 
                            className: "w-full bg-transparent outline-none", 
                            value: item.deadline, 
                            onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'deadline', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border text-center no-print w-8" }, 
                        e('button', { 
                            onClick: () => removeItem(devPlan, setDevPlan, item.id), 
                            className: "text-slate-300 hover:text-red-500" 
                        }, e(Trash2, { size: 14 }))
                    )
                )
            );

            return e('div', { ref: formRef, className: "max-w-5xl mx-auto space-y-8 pb-20" },
                
                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200" },
                    e('div', { className: "flex justify-between items-start mb-6" },
                        e('div', null, 
                            e('h1', { className: "text-3xl font-bold", style: { color: "#243186" } }, "nıederwıeser"), 
                            e('span', { className: "text-sm tracking-wider font-medium", style: { color: "#6EBD84" } }, "FLEXIBLE FOOD PACKAGING")
                        ),
                        e('button', { 
                            onClick: handleDownloadPDF, 
                            disabled: isGenerating, 
                            className: "no-print flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50" 
                        }, 
                            isGenerating ? e(Loader2, { className: "animate-spin", size: 18 }) : e(Download, { size: 18 }), 
                            isGenerating ? t.generating : t.print
                        )
                    ),
                    e('div', { className: "border-b-2 border-slate-100 mb-4" }),
                    
                    // === DEBUG: Check Team Buttons ===
                    (() => {
                      console.log('🎨 Rendering form - teamButtonsVisible:', teamButtonsVisible, 'teamContext:', teamContext);
                      return null;
                    })(),
                    
                    // === TEAM BUTTONS (wenn teamContext) ===
                    teamButtonsVisible && teamContext && e('div', {
                      className: 'mb-6 p-5 bg-gradient-to-r from-[#243186] to-[#1a2564] rounded-xl shadow-2xl border-2 border-[#6EBD84]'
                    },
                      e('div', { className: 'flex flex-col gap-4' },
                        e('div', { className: 'flex justify-between items-start' },
                          e('div', { className: 'text-white' },
                            e('h2', { className: 'text-3xl font-bold mb-1', style: { color: '#6EBD84' } }, 
                              teamContext.employee.name
                            ),
                            e('p', { className: 'text-blue-200 text-base font-semibold' }, 
                              teamContext.employee.position + (teamContext.employee.department ? ' • ' + teamContext.employee.department : '')
                            ),
                            e('p', { className: 'text-blue-100 text-sm mt-2 font-medium' }, 
                              (lang === 'de' ? 'Bewertungszeitraum: ' : lang === 'it' ? 'Periodo: ' : 'Assessment period: ') + teamContext.period
                            )
                          ),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'text-white/80 hover:text-white transition-colors text-4xl leading-none font-bold'
                          }, '×')
                        ),
                        e('div', { className: 'grid grid-cols-3 gap-4 mt-2' },
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('draft'),
                            type: 'button',
                            className: 'bg-slate-200 hover:bg-slate-300 text-slate-900 py-4 px-5 rounded-xl font-bold text-base transition-all transform hover:scale-105 shadow-lg'
                          }, '💾 ' + (lang === 'de' ? 'Als Entwurf' : lang === 'it' ? 'Bozza' : 'Save Draft')),
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('completed'),
                            type: 'button',
                            className: 'bg-[#6EBD84] hover:bg-[#5da872] text-white py-4 px-5 rounded-xl font-bold text-base transition-all transform hover:scale-105 shadow-lg'
                          }, '✓ ' + (lang === 'de' ? 'Abschließen' : lang === 'it' ? 'Completa' : 'Complete')),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'border-2 border-white/40 text-white py-4 px-5 rounded-xl font-bold hover:bg-white/20 transition-all shadow-lg text-base'
                          }, lang === 'de' ? 'Abbrechen' : lang === 'it' ? 'Annulla' : 'Cancel')
                        )
                      )
                    ),
                    
                    e('h2', { className: "text-2xl font-bold", style: { color: "#243186" } }, lang === 'de' ? 'Zielvereinbarung' : lang === 'it' ? 'Accordo sugli obiettivi' : 'Goal Agreement'),
                    e('p', { className: "font-medium", style: { color: "#6EBD84" } }, t.headerSubtitle)
                ),

                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partA),
                    e('div', { className: "grid grid-cols-2 gap-6" },
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.employee), e('input', { type: "text", value: formData.employee, onChange: (ev) => handleFormChange('employee', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.manager), e('input', { type: "text", value: formData.manager, onChange: (ev) => handleFormChange('manager', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.position), e('input', { type: "text", value: formData.position, onChange: (ev) => handleFormChange('position', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.date), e('input', { type: "date", value: formData.date, onChange: (ev) => handleFormChange('date', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" }))
                    )
                ),

                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, lang === 'de' ? 'Zieldefinition' : lang === 'it' ? 'Definizione degli obiettivi' : 'Goal Definition'),
                    e('table', { className: "w-full text-sm" },
                        e('thead', { className: "bg-slate-50 text-left" }, 
                            e('tr', null, 
                                e('th', { className: "p-2 border w-1/3" }, t.goalName), 
                                e('th', { className: "p-2 border w-20" }, t.weight), 
                                // Bonus-Spalte Header (nur wenn Bonus eingegeben)
                                parseFloat(formData.plannedBonus) > 0 && e('th', { className: "p-2 border w-24 bg-emerald-50 text-emerald-700" }, lang === 'de' ? 'Bonus €' : lang === 'it' ? 'Bonus €' : 'Bonus €'),
                                e('th', { className: "p-2 border" }, lang === 'de' ? 'Zielwert / Beschreibung' : lang === 'it' ? 'Valore target / Descrizione' : 'Target Value / Description'), 
                                e('th', { className: "p-2 border no-print w-8" }, "")
                            )
                        ),
                        e('tbody', null, goals.map(item => renderGoalRow(item)))
                    ),
                    e('button', { 
                        onClick: () => addItem(goals, setGoals, {name:'', weight:0, target:''}), 
                        className: "no-print mt-3 text-xs flex items-center gap-1 text-blue-600" 
                    }, e(PlusCircle, {size:14}), t.addGoal),
                    
                    // Geplanter Bonus (100%) Feld
                    e('div', { className: "mt-6 pt-4 border-t border-slate-200" },
                        e('div', { className: "flex items-center gap-4" },
                            e('label', { className: "text-sm font-semibold text-slate-700 whitespace-nowrap" }, 
                                lang === 'de' ? 'Geplanter Bonus (100%):' : lang === 'it' ? 'Bonus previsto (100%):' : 'Planned Bonus (100%):'
                            ),
                            e('div', { className: "relative w-48" },
                                e('input', { 
                                    type: "text", 
                                    value: displayBonus,
                                    onChange: (ev) => handleBonusChange(ev.target.value),
                                    placeholder: lang === 'de' ? 'z.B. 5.000' : lang === 'it' ? 'es. 5.000' : 'e.g. 5,000',
                                    className: "w-full border border-slate-300 rounded-lg px-3 py-2 pr-8 outline-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] text-right font-medium"
                                }),
                                e('span', { className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium" }, '€')
                            ),
                            e('span', { className: "text-xs text-slate-400" }, 
                                lang === 'de' ? '(Tausenderpunkte erlaubt: 1.000 = 1000)' : lang === 'it' ? '(Punti per migliaia: 1.000 = 1000)' : '(Thousands separators allowed: 1,000 = 1000)'
                            )
                        )
                    )
                ),

                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.development),
                    e('p', { className: "text-xs text-slate-500 mb-2" }, t.devIntro),
                    e('table', { className: "w-full text-sm mb-2" },
                        e('thead', { className: "bg-slate-50 text-left" }, 
                            e('tr', null, 
                                e('th', { className: "p-2 border" }, t.measure), 
                                e('th', { className: "p-2 border" }, t.responsible), 
                                e('th', { className: "p-2 border" }, t.deadline), 
                                e('th', { className: "p-2 border no-print" }, "")
                            )
                        ),
                        e('tbody', null, devPlan.map(item => renderDevRow(item)))
                    ),
                    e('button', { 
                        onClick: () => addItem(devPlan, setDevPlan, {measure:'', responsible:'', deadline:''}), 
                        className: "no-print mt-2 text-xs flex items-center gap-1 text-blue-600" 
                    }, e(PlusCircle, {size:14}), t.addDev)
                ),

                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-8 border-b pb-2" }, t.partH),
                    e('div', { className: "grid grid-cols-2 gap-12" },
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.employee)),
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.manager))
                    )
                )
            );
        };

        // === APPRAISAL FORM COMPONENT ===
        const AppraisalForm = ({ lang, onSaveTeam, onCancel, db }) => {
            console.log('🔄 AppraisalForm wird gerendert...');
            console.log('   Props:', { lang, onSaveTeam: !!onSaveTeam, onCancel: !!onCancel, db: !!db });
            
            const t = FORM_TEXT[lang] || FORM_TEXT['de'];
            const defs = DEFAULTS[lang] || DEFAULTS['de'];
            const formRef = useRef(null);
            
            console.log('   t loaded:', !!t);
            console.log('   defs loaded:', !!defs, defs ? { coreCount: defs.core?.length, leadCount: defs.lead?.length } : null);
            
            const [isManager, setIsManager] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);
            const [formType, setFormType] = useState('manager'); // 'self' or 'manager'
            
            // === LINKED SELF ASSESSMENT (Selbstreflexion des Mitarbeiters) ===
            const [linkedSelfAssessment, setLinkedSelfAssessment] = useState(null);
            const [showSelfAssessmentHint, setShowSelfAssessmentHint] = useState(true);
            
            // === TEAM CONTEXT ===
            const [teamContext, setTeamContext] = useState(null);
            const [teamButtonsVisible, setTeamButtonsVisible] = useState(false);
            
            const [formData, setFormData] = useState({
                employee: '', position: '', manager: '', date: new Date().toISOString().split('T')[0],
                strengths1: '', strengths2: '', careerComment: '', 
                feedbackQ1: '', feedbackQ2: '', feedbackQ3: '', feedbackQ4: '', feedbackQ5: '', feedbackQ6: '', feedbackQ7: 0,
                plannedBonus: ''  // Geplanter Bonus (100%)
            });
            
            const [careerChecks, setCareerChecks] = useState([false, false, false, false, false]);
            const [goals, setGoals] = useState([
                { id: 101, name: '', weight: 60, achievement: 0 },
                { id: 102, name: '', weight: 40, achievement: 0 }
            ]);
            const [devPlan, setDevPlan] = useState([
                { id: 201, measure: '', responsible: '', deadline: '' }
            ]);
            const [coreList, setCoreList] = useState(defs.core);
            const [leadList, setLeadList] = useState(defs.lead);
            
            console.log('   States initialized. coreList:', coreList?.length, 'leadList:', leadList?.length);
            
            // Hilfsfunktion: Tausenderpunkte aus Eingabe entfernen (1.000 → 1000)
            const parseGermanNumber = (str) => {
                if (!str) return '';
                return str.replace(/\./g, '').replace(',', '.');
            };
            
            // Hilfsfunktion: Zahl mit Tausenderpunkten formatieren (1000 → 1.000)
            const formatGermanNumber = (num) => {
                if (!num && num !== 0) return '';
                const numStr = String(num).replace(/[^\d]/g, '');
                if (!numStr) return '';
                return Number(numStr).toLocaleString('de-DE');
            };
            
            // Handler für Bonus-Feld mit Tausenderpunkt-Unterstützung
            const handleBonusChange = (val) => {
                const cleanVal = val.replace(/[^\d.]/g, '');
                const numericVal = parseGermanNumber(cleanVal);
                setFormData({...formData, plannedBonus: numericVal});
            };
            
            // Formatierter Bonus für die Anzeige
            const displayBonus = formData.plannedBonus ? formatGermanNumber(formData.plannedBonus) : '';

            // === TEAM CONTEXT EFFECT ===
            useEffect(() => {
              const ctx = localStorage.getItem('nw_current_employee');
              console.log('🔍 AppraisalForm useEffect triggered');
              console.log('   localStorage nw_current_employee:', ctx);
              
              if (ctx) {
                try {
                  const data = JSON.parse(ctx);
                  console.log('✓ Parsed team context:', data);
                  setTeamContext(data);
                  setTeamButtonsVisible(true);
                  
                  // Load existing data if available
                  if (data.existingData) {
                    const existing = data.existingData;
                    
                    // Set form data
                    setFormData(prev => ({
                      ...prev,
                      employee: existing.employeeName || data.employee.name,
                      position: existing.position || data.employee.position,
                      manager: existing.formData?.manager || prev.manager,
                      date: existing.updatedAt ? existing.updatedAt.split('T')[0] : prev.date,
                      strengths1: existing.formData?.strengths1 || '',
                      strengths2: existing.formData?.strengths2 || '',
                      careerComment: existing.formData?.careerComment || '',
                      feedbackQ1: existing.formData?.feedbackQ1 || '',
                      feedbackQ2: existing.formData?.feedbackQ2 || '',
                      feedbackQ3: existing.formData?.feedbackQ3 || '',
                      feedbackQ4: existing.formData?.feedbackQ4 || '',
                      feedbackQ5: existing.formData?.feedbackQ5 || '',
                      feedbackQ6: existing.formData?.feedbackQ6 || '',
                      feedbackQ7: existing.formData?.feedbackQ7 || 0,
                      plannedBonus: existing.formData?.plannedBonus || ''
                    }));
                    
                    // Set goals if exists
                    if (existing.goals && existing.goals.length > 0) {
                      setGoals(existing.goals);
                    }
                    
                    // Set core scores if exists
                    if (existing.coreScores && Object.keys(existing.coreScores).length > 0) {
                      setCoreList(prev => prev.map(c => ({
                        ...c,
                        rating: existing.coreScores[c.id] || c.rating,
                        comment: existing.coreComments?.[c.id] || c.comment || ''
                      })));
                    }
                    
                    // Set leader scores if exists
                    if (existing.leaderScores && Object.keys(existing.leaderScores).length > 0) {
                      setLeadList(prev => prev.map(c => ({
                        ...c,
                        rating: existing.leaderScores[c.id] || c.rating,
                        comment: existing.leaderComments?.[c.id] || c.comment || ''
                      })));
                    }
                    
                    // Set isManager if leadership was included
                    if (existing.includeLeadership) {
                      setIsManager(true);
                    }
                    
                    // Set career checks if exists
                    if (existing.careerChecks) {
                      setCareerChecks(existing.careerChecks);
                    }
                    
                    // Set dev plan if exists
                    if (existing.devPlan && existing.devPlan.length > 0) {
                      setDevPlan(existing.devPlan);
                    }
                    
                  } else {
                    // New appraisal - set employee data
                    setFormData(prev => ({
                      ...prev,
                      employee: data.employee.name,
                      position: data.employee.position
                    }));
                  }
                  
                  // === SUCHE NACH VERKNÜPFTER SELBSTREFLEXION ===
                  // Direkt aus Firestore laden (robuster als localStorage Cache)
                  const loadSelfAssessment = async () => {
                    if (db && data.employee?.id) {
                      try {
                        // Einfache Query ohne orderBy (benötigt keinen zusammengesetzten Index)
                        const selfSnapshot = await db.collection('teamAppraisals')
                          .where('employeeId', '==', data.employee.id)
                          .where('type', '==', 'self_assessment')
                          .get();
                        
                        if (!selfSnapshot.empty) {
                          // Manuell die neueste finden
                          const allSelf = selfSnapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                          allSelf.sort((a, b) => {
                            const dateA = a.createdAt ? new Date(a.createdAt) : new Date(0);
                            const dateB = b.createdAt ? new Date(b.createdAt) : new Date(0);
                            return dateB - dateA;
                          });
                          const selfAssessment = allSelf[0];
                          console.log('🔗 Verknüpfte Selbstreflexion aus Firestore geladen:', selfAssessment);
                          setLinkedSelfAssessment(selfAssessment);
                        } else {
                          console.log('ℹ️ Keine Selbstreflexion für diesen Mitarbeiter gefunden');
                        }
                      } catch (firestoreErr) {
                        console.log('Firestore-Suche fehlgeschlagen, versuche localStorage...', firestoreErr);
                        // Fallback: localStorage Cache
                        const storedAppraisals = localStorage.getItem('nw_team_appraisals_cache');
                        if (storedAppraisals) {
                          try {
                            const appraisals = JSON.parse(storedAppraisals);
                            const selfAssessment = appraisals.find(a => 
                              a.type === 'self_assessment' && 
                              a.employeeId === data.employee.id
                            );
                            if (selfAssessment) {
                              console.log('🔗 Verknüpfte Selbstreflexion aus Cache:', selfAssessment);
                              setLinkedSelfAssessment(selfAssessment);
                            }
                          } catch (err) {
                            console.log('Keine cached appraisals gefunden');
                          }
                        }
                      }
                    }
                  };
                  loadSelfAssessment();
                  
                } catch (e) {
                  console.error('Error loading team context:', e);
                }
              }
            }, []);
            
            // === TEAM SAVE HANDLER ===
            const handleSaveTeamAppraisal = (status) => {
              if (!teamContext || !onSaveTeam) {
                alert('Team-Kontext fehlt!');
                return;
              }
              
              // === BERECHNE SCORES DIREKT BEIM SPEICHERN (für Konsistenz) ===
              // WAS Score berechnen
              const calculateWASForSave = () => {
                let sum = 0, weight = 0;
                goals.forEach(g => {
                  const w = parseFloat(g.weight) || 0;
                  if(w > 0) { sum += getBarsScore(g.achievement) * (w/100); weight += w; }
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
              };
              
              // WIE Score berechnen
              const calculateWIEForSave = (list) => {
                let sum = 0, weight = 0;
                list.forEach(i => {
                  const w = parseFloat(i.weight) || 0;
                  sum += i.rating * (w/100);
                  weight += w;
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
              };
              
              const currentWasScore = calculateWASForSave();
              const currentWieCoreScore = calculateWIEForSave(coreList);
              const currentWieLeadScore = calculateWIEForSave(leadList);
              const currentTotalGoalWeight = goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
              
              // GPS berechnen
              let currentFinalGPS;
              if (goals.length === 0 || currentTotalGoalWeight === 0) {
                currentFinalGPS = isManager 
                  ? (currentWieCoreScore * 0.5) + (currentWieLeadScore * 0.5)
                  : currentWieCoreScore;
              } else {
                currentFinalGPS = isManager 
                  ? (currentWasScore * 0.5) + (currentWieCoreScore * 0.25) + (currentWieLeadScore * 0.25)
                  : (currentWasScore * 0.5) + (currentWieCoreScore * 0.5);
              }
              
              // Collect core scores
              const coreScoresObj = {};
              const coreCommentsObj = {};
              coreList.forEach(c => {
                coreScoresObj[c.id] = c.rating;
                coreCommentsObj[c.id] = c.comment || '';
              });
              
              // Collect leader scores
              const leaderScoresObj = {};
              const leaderCommentsObj = {};
              leadList.forEach(c => {
                leaderScoresObj[c.id] = c.rating;
                leaderCommentsObj[c.id] = c.comment || '';
              });
              
              const appraisal = {
                id: teamContext.appraisalId,
                type: 'review',
                employeeId: teamContext.employee.id,
                employeeName: teamContext.employee.name,
                position: teamContext.employee.position,
                period: teamContext.period,
                status: status,
                createdAt: teamContext.existingData?.createdAt || new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                goals: goals,
                coreScores: coreScoresObj,
                coreComments: coreCommentsObj,
                leaderScores: leaderScoresObj,
                leaderComments: leaderCommentsObj,
                includeLeadership: isManager,
                wasScore: currentWasScore,
                wieCoreScore: currentWieCoreScore,
                wieLeaderScore: currentWieLeadScore,
                gpsScore: currentFinalGPS,
                formData: formData,
                careerChecks: careerChecks,
                devPlan: devPlan
              };
              
              // Debug-Log
              console.log('💾 Speichere Review:', {
                status,
                goals: goals.length,
                wasScore: currentWasScore.toFixed(2),
                wieCoreScore: currentWieCoreScore.toFixed(2),
                wieLeadScore: currentWieLeadScore.toFixed(2),
                gpsScore: currentFinalGPS.toFixed(2)
              });
              
              onSaveTeam(appraisal);
            };
            
            // === TEAM CANCEL HANDLER ===
            const handleCancelTeam = () => {
              if (confirm(lang === 'de' ? 'Abbrechen? Änderungen gehen verloren.' : lang === 'it' ? 'Annullare? Le modifiche andranno perse.' : 'Cancel? Changes will be lost.')) {
                localStorage.removeItem('nw_current_employee');
                if (onCancel) onCancel();
              }
            };

            useEffect(() => {
                setCoreList(prev => prev.map((p, i) => {
                    if (defs.core[i]) {
                        return {
                            ...p,
                            name: lang === 'it' && CORE_COMPETENCIES_CALC[i].nameIt ? 
                                CORE_COMPETENCIES_CALC[i].nameIt : 
                                CORE_COMPETENCIES_CALC[i].name
                        };
                    }
                    return p;
                }));
                setLeadList(prev => prev.map((p, i) => {
                    if (defs.lead[i]) {
                        return {
                            ...p,
                            name: lang === 'it' && LEADERSHIP_COMPETENCIES_CALC[i].nameIt ? 
                                LEADERSHIP_COMPETENCIES_CALC[i].nameIt : 
                                LEADERSHIP_COMPETENCIES_CALC[i].name
                        };
                    }
                    return p;
                }));
            }, [lang]);

            const calculateWAS = () => {
                let sum = 0, weight = 0;
                goals.forEach(g => {
                    const w = parseFloat(g.weight) || 0;
                    if(w > 0) { sum += getBarsScore(g.achievement) * (w/100); weight += w; }
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
            };

            const calculateWIE = (list) => {
                let sum = 0, weight = 0;
                list.forEach(i => {
                    const w = parseFloat(i.weight) || 0;
                    sum += i.rating * (w/100);
                    weight += w;
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
            };

            const wasScore = calculateWAS();
            const wieCoreScore = calculateWIE(coreList);
            const wieLeadScore = calculateWIE(leadList);
            
            // === HALO-EFFEKT ERKENNUNG ===
            // Warnung wenn alle Core-Kompetenzen exakt gleich bewertet wurden
            const coreRatings = coreList.map(c => c.rating).filter(r => r > 0);
            const allCoreRatingsSame = coreRatings.length >= 5 && coreRatings.every(r => r === coreRatings[0]);
            const haloEffectWarning = allCoreRatingsSame && coreRatings.length >= 5;
            
            // === GAP-ANALYSE (Selbst vs. Fremd) ===
            // Berechne Gaps für alle Kompetenzen
            const calculateGaps = () => {
              if (!linkedSelfAssessment) return {};
              const selfScores = linkedSelfAssessment.selfCoreScores || {};
              const gaps = {};
              
              // Core Kompetenzen
              const idMapping = { fach: 'c1', komm: 'c2', prob: 'c3', adapt: 'c4', orga: 'c5' };
              coreList.forEach(c => {
                const selfKey = idMapping[c.id] || c.id;
                const selfScore = selfScores[selfKey] || selfScores[c.id];
                if (selfScore && c.rating) {
                  const gap = c.rating - selfScore;
                  if (Math.abs(gap) > 1) {
                    gaps[c.id] = { 
                      gap, 
                      selfScore, 
                      fkScore: c.rating,
                      direction: gap > 0 ? 'fk_higher' : 'self_higher'
                    };
                  }
                }
              });
              
              // Leader Kompetenzen (falls vorhanden)
              if (linkedSelfAssessment.selfLeaderScores) {
                const selfLeaderScores = linkedSelfAssessment.selfLeaderScores;
                const leaderMapping = { lead: 'l1', strat: 'l2', decide: 'l3', exec: 'l4', stake: 'l5' };
                leadList.forEach(c => {
                  const selfKey = leaderMapping[c.id] || c.id;
                  const selfScore = selfLeaderScores[selfKey] || selfLeaderScores[c.id];
                  if (selfScore && c.rating) {
                    const gap = c.rating - selfScore;
                    if (Math.abs(gap) > 1) {
                      gaps[c.id] = { 
                        gap, 
                        selfScore, 
                        fkScore: c.rating,
                        direction: gap > 0 ? 'fk_higher' : 'self_higher'
                      };
                    }
                  }
                });
              }
              
              return gaps;
            };
            const competencyGaps = calculateGaps();
            const hasSignificantGaps = Object.keys(competencyGaps).length > 0;
            
            // Calculate total goal weight for validation
            const totalGoalWeight = goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
            
            // === BONUS-BERECHNUNG ===
            // Bonus basiert auf Gewichtung und Zielerreichung pro Ziel
            // Max. 100% Auszahlung pro Ziel (keine Überschreitung)
            const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
            
            // Berechne Bonus pro Ziel und Gesamtauszahlung
            const bonusPerGoal = goals.map(g => {
                const weight = parseFloat(g.weight) || 0;
                const achievement = parseFloat(g.achievement) || 0;
                const goalBonus = plannedBonusNum * (weight / 100);
                // Auszahlung gedeckelt auf 100% Zielerreichung
                const achievementFactor = Math.min(achievement / 100, 1.0);
                const payout = goalBonus * achievementFactor;
                return {
                    goalName: g.name,
                    weight: weight,
                    achievement: achievement,
                    goalBonus: goalBonus,
                    achievementFactor: achievementFactor,
                    payout: payout
                };
            });
            
            const totalBonusPayout = bonusPerGoal.reduce((sum, b) => sum + b.payout, 0);
            const bonusPayoutPercentage = plannedBonusNum > 0 ? (totalBonusPayout / plannedBonusNum * 100) : 0;
            
            // GPS-Berechnung: Wenn keine Ziele vorhanden, nur WIE-Kompetenzen (100%)
            // Fix: Prüfe ob Leadership-Scores tatsächlich > 0 sind bevor sie einfließen
            let finalGPS;
            const hasLeadershipScores = isManager && wieLeadScore > 0;
            
            if (goals.length === 0 || totalGoalWeight === 0) {
                // Keine Ziele: GPS = 100% WIE
                if (isManager && hasLeadershipScores) {
                    finalGPS = (wieCoreScore * 0.5) + (wieLeadScore * 0.5);
                } else {
                    // Nur Core-Kompetenzen (auch für Manager ohne Leadership-Bewertung)
                    finalGPS = wieCoreScore;
                }
            } else {
                // Mit Zielen: Standard-Formel
                if (isManager && hasLeadershipScores) {
                    finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.25) + (wieLeadScore * 0.25);
                } else {
                    // Standard für MA oder Manager ohne Leadership-Bewertung
                    finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.5);
                }
            }

            const handleFormChange = (field, val) => setFormData({...formData, [field]: val});
            const updateItem = (list, setList, id, field, val) => {
                setList(list.map(i => {
                    if (i.id !== id) return i;
                    // Parse numeric fields to ensure calculations work correctly
                    if (field === 'weight' || field === 'achievement') {
                        return { ...i, [field]: parseFloat(val) || 0 };
                    }
                    if (field === 'rating') {
                        return { ...i, [field]: parseInt(val) || 3 };
                    }
                    return { ...i, [field]: val };
                }));
            };
            const addItem = (list, setList, template) => setList([...list, { ...template, id: Date.now() }]);
            const removeItem = (list, setList, id) => setList(list.filter(i => i.id !== id));
            const toggleCareer = (index) => {
                const newChecks = [...careerChecks];
                newChecks[index] = !newChecks[index];
                setCareerChecks(newChecks);
            };

            const handleDownloadPDF = () => {
                if (!window.html2pdf) {
                    alert("PDF-Bibliothek nicht geladen. Bitte Seite neu laden.");
                    return;
                }
                
                // Validierung: Warnung bei sehr langen Texten (arbeitsrechtlich relevant!)
                const feedbackTexts = [
                    formData.strengths1, formData.strengths2,
                    formData.feedbackQ1, formData.feedbackQ2, formData.feedbackQ3,
                    formData.feedbackQ4, formData.feedbackQ5, formData.feedbackQ6, formData.feedbackQ7,
                    formData.careerComment
                ].filter(Boolean);
                const totalFeedbackLength = feedbackTexts.reduce((sum, t) => sum + t.length, 0);
                const coreCommentLength = coreList.reduce((sum, c) => sum + (c.comment || '').length, 0);
                const leadCommentLength = leadList.reduce((sum, c) => sum + (c.comment || '').length, 0);
                const totalTextLength = totalFeedbackLength + coreCommentLength + leadCommentLength;
                
                if (totalTextLength > 8000) {
                    const proceed = confirm(lang === 'de' 
                        ? `⚠️ Arbeitsrechtlicher Hinweis\n\nDas Dokument enthält sehr viel Text (${Math.round(totalTextLength/1000)}k Zeichen).\n\nBei extrem langen Texten können Seitenumbrüche problematisch sein – Text könnte abgeschnitten werden.\n\n✓ Prüfen Sie das PDF nach dem Download auf Vollständigkeit\n✓ Formulieren Sie ggf. prägnanter\n\nTrotzdem fortfahren?`
                        : lang === 'it'
                        ? `⚠️ Avviso legale\n\nIl documento contiene molto testo (${Math.round(totalTextLength/1000)}k caratteri).\n\nCon testi molto lunghi, le interruzioni di pagina possono causare problemi – il testo potrebbe essere tagliato.\n\n✓ Verifichi il PDF dopo il download\n✓ Formuli in modo più conciso se necessario\n\nContinuare comunque?`
                        : `⚠️ Legal Notice\n\nDocument contains a lot of text (${Math.round(totalTextLength/1000)}k characters).\n\nWith very long texts, page breaks may cause issues – text could be cut off.\n\n✓ Check the PDF for completeness after download\n✓ Consider more concise wording\n\nProceed anyway?`
                    );
                    if (!proceed) return;
                }
                
                setIsGenerating(true);
                
                setTimeout(() => {
                    try {
                        const pdfContainer = document.createElement('div');
                        pdfContainer.className = 'pdf-export-container';
                        pdfContainer.style.cssText = `
                            width: 177mm;
                            padding: 0;
                            background: white;
                            font-family: 'Segoe UI', Arial, sans-serif;
                            color: #1e293b;
                            font-size: 10pt;
                            line-height: 1.5;
                        `;
                        
                        const currentDate = new Date().toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
                        
                        // Formatiere das Bewertungsdatum korrekt (von YYYY-MM-DD zu DD.MM.YYYY)
                        const formatDateForPDF = (dateStr) => {
                            if (!dateStr) return '–';
                            const parts = dateStr.split('-');
                            if (parts.length === 3) {
                                return `${parts[2]}.${parts[1]}.${parts[0]}`;
                            }
                            return dateStr;
                        };
                        const formattedPeriod = formatDateForPDF(formData.date);
                        
                        // Profil-Text kürzen für PDF
                        const profileShort = isManager 
                            ? (lang === 'de' ? 'FK (50/25/25)' : lang === 'it' ? 'Dir. (50/25/25)' : 'Mgr (50/25/25)')
                            : (lang === 'de' ? 'MA (50/50)' : lang === 'it' ? 'Coll. (50/50)' : 'Emp (50/50)');
                        
                        // Professional PDF Layout
                        let pdfHTML = `
                            <!-- HEADER -->
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #243186;">
                                <div style="flex: 1;">
                                    <h1 style="color: #243186; font-size: 26pt; margin: 0; font-weight: 700; letter-spacing: -0.5px;">nıederwıeser</h1>
                                    <p style="color: #6EBD84; font-size: 8pt; margin: 2px 0 0 0; font-weight: 600; letter-spacing: 1.5px;">FLEXIBLE FOOD PACKAGING</p>
                                </div>
                                <div style="text-align: right; flex-shrink: 0; padding-left: 10px;">
                                    <p style="font-size: 8pt; color: #64748b; margin: 0;">Dok.: ${currentDate}</p>
                                    <p style="font-size: 8pt; color: #64748b; margin: 2px 0 0 0;">${lang === 'de' ? 'Periode' : lang === 'it' ? 'Periodo' : 'Period'}: ${formattedPeriod}</p>
                                </div>
                            </div>
                            
                            <!-- DOCUMENT TITLE -->
                            <div style="background: linear-gradient(135deg, #243186 0%, #1a2564 100%); color: white; padding: 15px 20px; margin-bottom: 20px; border-radius: 4px;">
                                <h2 style="margin: 0; font-size: 16pt; font-weight: 600;">${t.headerTitle}</h2>
                                <p style="margin: 5px 0 0 0; font-size: 11pt; opacity: 0.9;">${t.headerSubtitle}</p>
                            </div>
                            
                            <!-- TEIL A: STAMMDATEN -->
                            <div style="margin-bottom: 20px; page-break-inside: avoid;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partA}</h3>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                                    <tr>
                                        <td style="padding: 8px 10px; width: 22%; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.employee}</span>
                                        </td>
                                        <td style="padding: 8px 10px; width: 28%; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.employee || '–'}</td>
                                        <td style="padding: 8px 10px; width: 22%; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.manager}</span>
                                        </td>
                                        <td style="padding: 8px 10px; width: 28%; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.manager || '–'}</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px 10px; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.position}</span>
                                        </td>
                                        <td style="padding: 8px 10px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.position || '–'}</td>
                                        <td style="padding: 8px 10px; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.profile}</span>
                                        </td>
                                        <td style="padding: 8px 10px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${profileShort}</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- TEIL B: ZIELERREICHUNG -->
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #3b82f6; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #1e40af; font-weight: 600;">${t.partB}</h3>
                                    <span style="background: #dbeafe; color: #1e40af; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                                        Score: ${wasScore.toFixed(2)}
                                    </span>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #1e40af; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.goalName}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 65px;">${t.weight}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 75px;">${t.achievement}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 50px;">BARS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${goals.map((g, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${g.name || '–'}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 600; vertical-align: top;">${g.weight}%</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                                    <span style="background: ${g.achievement >= 100 ? '#dcfce7' : g.achievement >= 70 ? '#fef9c3' : '#fee2e2'}; color: ${g.achievement >= 100 ? '#166534' : g.achievement >= 70 ? '#854d0e' : '#dc2626'}; padding: 2px 8px; border-radius: 10px; font-weight: 600;">
                                                        ${g.achievement}%
                                                    </span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 700; font-size: 11pt; vertical-align: top;">${getBarsScore(g.achievement)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                                
                                ${plannedBonusNum > 0 && goals.length > 0 ? `
                                <!-- BONUS-BERECHNUNG -->
                                <div style="margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 1px solid #6ee7b7; border-radius: 6px;">
                                    <h4 style="font-size: 11pt; font-weight: 700; color: #065f46; margin: 0 0 12px 0; display: flex; align-items: center;">
                                        💰 ${lang === 'de' ? 'Bonus-Berechnung' : lang === 'it' ? 'Calcolo Bonus' : 'Bonus Calculation'}
                                    </h4>
                                    <table style="width: 100%; border-collapse: collapse; font-size: 9pt;">
                                        <thead>
                                            <tr style="background: rgba(6, 95, 70, 0.1);">
                                                <th style="padding: 8px; text-align: left; color: #065f46; font-weight: 600;">${lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'}</th>
                                                <th style="padding: 8px; text-align: center; color: #065f46; font-weight: 600; width: 60px;">${lang === 'de' ? 'Gewicht' : lang === 'it' ? 'Peso' : 'Weight'}</th>
                                                <th style="padding: 8px; text-align: right; color: #065f46; font-weight: 600; width: 80px;">${lang === 'de' ? 'Anteil' : lang === 'it' ? 'Quota' : 'Share'}</th>
                                                <th style="padding: 8px; text-align: center; color: #065f46; font-weight: 600; width: 70px;">${lang === 'de' ? 'Erreicht' : lang === 'it' ? 'Raggiunto' : 'Achieved'}</th>
                                                <th style="padding: 8px; text-align: right; color: #065f46; font-weight: 600; width: 90px;">${lang === 'de' ? 'Auszahlung' : lang === 'it' ? 'Pagamento' : 'Payout'}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${bonusPerGoal.map((b, idx) => `
                                                <tr style="border-top: 1px solid #a7f3d0;">
                                                    <td style="padding: 8px; color: #334155;">${b.goalName || (lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal') + ' ' + (idx + 1)}</td>
                                                    <td style="padding: 8px; text-align: center; color: #64748b;">${b.weight}%</td>
                                                    <td style="padding: 8px; text-align: right; color: #64748b;">${formatGermanNumber(b.goalBonus.toFixed(0))} €</td>
                                                    <td style="padding: 8px; text-align: center;">
                                                        <span style="padding: 2px 6px; border-radius: 10px; font-size: 8pt; font-weight: 600; background: ${b.achievement >= 100 ? '#dcfce7' : b.achievement >= 70 ? '#fef9c3' : '#fee2e2'}; color: ${b.achievement >= 100 ? '#166534' : b.achievement >= 70 ? '#854d0e' : '#dc2626'};">
                                                            ${b.achievement}%
                                                        </span>
                                                    </td>
                                                    <td style="padding: 8px; text-align: right; font-weight: 700; color: #065f46;">${formatGermanNumber(b.payout.toFixed(0))} €</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 12px; margin-top: 12px; border-top: 2px solid #6ee7b7;">
                                        <div>
                                            <span style="font-size: 9pt; color: #065f46;">${lang === 'de' ? 'Geplanter Bonus:' : lang === 'it' ? 'Bonus previsto:' : 'Planned Bonus:'}</span>
                                            <span style="font-weight: 700; margin-left: 5px;">${formatGermanNumber(plannedBonusNum.toFixed(0))} €</span>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 8pt; color: #059669;">${lang === 'de' ? 'Tatsächliche Auszahlung' : lang === 'it' ? 'Pagamento effettivo' : 'Actual Payout'}</div>
                                            <div style="font-size: 18pt; font-weight: 900; color: #065f46;">${formatGermanNumber(totalBonusPayout.toFixed(0))} €</div>
                                            <div style="font-size: 8pt; font-weight: 600; color: ${bonusPayoutPercentage >= 100 ? '#16a34a' : bonusPayoutPercentage >= 70 ? '#ca8a04' : '#dc2626'};">
                                                (${bonusPayoutPercentage.toFixed(1)}% ${lang === 'de' ? 'vom Zielbonus' : lang === 'it' ? 'del target' : 'of target bonus'})
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                            
                            <!-- TEIL C: WIE-KOMPETENZEN (CORE) -->
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #6EBD84; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #166534; font-weight: 600;">${t.partC}</h3>
                                    <span style="background: #dcfce7; color: #166534; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                                        Score: ${wieCoreScore.toFixed(2)}
                                    </span>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #166534; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 30%;">${t.compName}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 60px;">${t.rating}</th>
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.comment}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${coreList.map((c, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f0fdf4'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-weight: 500; vertical-align: top;">${c.name}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                                    <span style="display: inline-block; width: 24px; height: 24px; line-height: 24px; background: #166534; color: white; border-radius: 50%; font-weight: 700; font-size: 10pt;">${c.rating}</span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-size: 9pt; color: #475569; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${c.comment || '–'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            
                            ${isManager ? `
                            <!-- TEIL C: WIE-KOMPETENZEN (LEADERSHIP) -->
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #059669; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #059669; font-weight: 600;">${t.partCLead}</h3>
                                    <span style="background: #d1fae5; color: #059669; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                                        Score: ${wieLeadScore.toFixed(2)}
                                    </span>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #059669; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 30%;">${t.compName}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 60px;">${t.rating}</th>
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.comment}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${leadList.map((l, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#ecfdf5'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-weight: 500; vertical-align: top;">${l.name}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                                    <span style="display: inline-block; width: 24px; height: 24px; line-height: 24px; background: #059669; color: white; border-radius: 50%; font-weight: 700; font-size: 10pt;">${l.rating}</span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-size: 9pt; color: #475569; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${l.comment || '–'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            ` : ''}
                            
                            <!-- GPS ERGEBNIS -->
                            <div style="margin-bottom: 20px; padding: 25px; background: linear-gradient(135deg, #243186 0%, #1a2564 100%); border-radius: 8px; text-align: center; page-break-inside: avoid;">
                                <p style="font-size: 10pt; color: rgba(255,255,255,0.7); margin: 0 0 5px 0; text-transform: uppercase; letter-spacing: 2px;">FINAL GPS</p>
                                <p style="font-size: 52pt; font-weight: 900; margin: 10px 0; color: white;">${finalGPS.toFixed(2)}</p>
                                <p style="font-size: 10pt; color: #6EBD84; font-weight: 600; margin: 10px 0 0 0;">
                                    ${goals.length === 0 || totalGoalWeight === 0
                                        ? (isManager 
                                            ? (lang === 'de' ? '(100% WIE: 50% Kern + 50% Leadership)' : lang === 'it' ? '(100% COME: 50% Core + 50% Leadership)' : '(100% HOW: 50% Core + 50% Leadership)')
                                            : (lang === 'de' ? '(100% WIE: Kern-Kompetenzen)' : lang === 'it' ? '(100% COME: Competenze Core)' : '(100% HOW: Core Competencies)'))
                                        : (isManager 
                                            ? '(WAS 50% + WIE Core 25% + WIE Lead 25%)' 
                                            : '(WAS 50% + WIE Core 50%)')}
                                </p>
                                ${goals.length === 0 ? `<p style="font-size: 9pt; color: #fbbf24; margin-top: 8px;">⚠️ ${lang === 'de' ? 'Ohne Zielvereinbarung' : lang === 'it' ? 'Senza accordo obiettivi' : 'Without Goal Agreement'}</p>` : ''}
                            </div>
                            
                            <!-- TEIL D: STÄRKEN & ENTWICKLUNG -->
                            <div style="margin-bottom: 20px;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partD}</h3>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <p style="font-weight: 600; margin: 0 0 5px 0; font-size: 10pt; color: #334155;">${t.strengthsProfessional}</p>
                                    <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; min-height: 40px; word-wrap: break-word; overflow-wrap: break-word; white-space: pre-wrap; font-size: 10pt; line-height: 1.4;">${(formData.strengths1 || '–').substring(0, 2000)}${(formData.strengths1 || '').length > 2000 ? '...' : ''}</div>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <p style="font-weight: 600; margin: 0 0 5px 0; font-size: 10pt; color: #334155;">${t.strengthsPersonal}</p>
                                    <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; min-height: 40px; word-wrap: break-word; overflow-wrap: break-word; white-space: pre-wrap; font-size: 10pt; line-height: 1.4;">${(formData.strengths2 || '–').substring(0, 2000)}${(formData.strengths2 || '').length > 2000 ? '...' : ''}</div>
                                </div>
                                
                                <p style="font-weight: 600; margin: 15px 0 8px 0; font-size: 11pt; color: #243186;">${t.development}</p>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #243186; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.measure}</th>
                                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 120px;">${t.responsible}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 85px;">${t.deadline}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${devPlan.map((d, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top; word-wrap: break-word; overflow-wrap: break-word; white-space: pre-wrap;">${(d.measure || '–').substring(0, 500)}${(d.measure || '').length > 500 ? '...' : ''}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">${d.responsible || '–'}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">${d.deadline || '–'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- TEIL E: KARRIEREPERSPEKTIVEN -->
                            <div style="margin-bottom: 20px; page-break-inside: avoid;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partE}</h3>
                                </div>
                                <p style="font-size: 9pt; color: #64748b; margin-bottom: 8px;">${t.careerIntro}</p>
                                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
                                    ${t.careerOptions.map((opt, i) => careerChecks[i] ? `
                                        <span style="padding: 6px 12px; background: #dcfce7; border: 1px solid #86efac; border-radius: 20px; font-size: 9pt; color: #166534;">✓ ${opt}</span>
                                    ` : '').join('') || `<span style="font-size: 9pt; color: #94a3b8; font-style: italic;">${lang === 'de' ? 'Keine Auswahl getroffen' : lang === 'it' ? 'Nessuna selezione' : 'No selection made'}</span>`}
                                </div>
                                <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; font-size: 9pt; word-wrap: break-word; white-space: pre-wrap; min-height: 40px;">
                                    ${formData.careerComment || `<span style="color: #94a3b8; font-style: italic;">${lang === 'de' ? 'Kein Kommentar' : lang === 'it' ? 'Nessun commento' : 'No comment'}</span>`}
                                </div>
                            </div>
                            
                            <!-- TEIL F: FEEDBACK -->
                            <div style="margin-bottom: 20px;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partF}</h3>
                                </div>
                                <p style="font-size: 9pt; color: #64748b; margin-bottom: 12px;">${t.feedbackIntro}</p>
                                
                                ${[
                                    { q: t.feedbackQ1, a: formData.feedbackQ1 },
                                    { q: t.feedbackQ2, a: formData.feedbackQ2 },
                                    { q: t.feedbackQ3, a: formData.feedbackQ3 },
                                    { q: t.feedbackQ4, a: formData.feedbackQ4 },
                                    { q: t.feedbackQ5, a: formData.feedbackQ5 },
                                    { q: t.feedbackQ6, a: formData.feedbackQ6 },
                                    { q: t.feedbackQ7, a: formData.feedbackQ7 }
                                ].map(item => {
                                    // Erlaube Seitenumbruch bei langen Antworten (>200 Zeichen)
                                    const isLongText = (item.a || '').length > 200;
                                    return `
                                    <div style="margin-bottom: 10px; ${isLongText ? '' : 'page-break-inside: avoid;'}">
                                        <p style="font-weight: 600; margin: 0 0 4px 0; font-size: 9pt; color: #334155; page-break-after: avoid;">${item.q}</p>
                                        <div style="padding: 8px 10px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; font-size: 9pt; min-height: 20px; word-wrap: break-word; white-space: pre-wrap; overflow-wrap: break-word; orphans: 3; widows: 3;">${item.a || '–'}</div>
                                    </div>
                                `}).join('')}
                            </div>
                            
                            <!-- TEIL H: UNTERSCHRIFTEN (niemals umbrechen) -->
                            <div style="margin-top: 30px; padding: 20px; border: 2px solid #243186; border-radius: 6px; page-break-inside: avoid; break-inside: avoid;">
                                <h3 style="font-size: 12pt; margin: 0 0 25px 0; color: #243186; font-weight: 600; text-align: center;">${t.partH}</h3>
                                <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                                    <div style="width: 42%; text-align: center;">
                                        <div style="border-bottom: 2px solid #1e293b; height: 60px;"></div>
                                        <p style="margin: 8px 0 0 0; font-size: 9pt; color: #64748b;">${t.employee}</p>
                                        <p style="margin: 2px 0 0 0; font-size: 8pt; color: #94a3b8;">${lang === 'de' ? 'Datum, Unterschrift' : lang === 'it' ? 'Data, Firma' : 'Date, Signature'}</p>
                                    </div>
                                    <div style="width: 42%; text-align: center;">
                                        <div style="border-bottom: 2px solid #1e293b; height: 60px;"></div>
                                        <p style="margin: 8px 0 0 0; font-size: 9pt; color: #64748b;">${t.manager}</p>
                                        <p style="margin: 2px 0 0 0; font-size: 8pt; color: #94a3b8;">${lang === 'de' ? 'Datum, Unterschrift' : lang === 'it' ? 'Data, Firma' : 'Date, Signature'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- FOOTER -->
                            <div style="margin-top: 30px; padding-top: 10px; border-top: 1px solid #e2e8f0; text-align: center;">
                                <p style="font-size: 8pt; color: #94a3b8; margin: 0;">
                                    Niederwieser Group | ${lang === 'de' ? 'Performance Management System' : lang === 'it' ? 'Sistema di Gestione delle Performance' : 'Performance Management System'} | ${currentDate}
                                </p>
                                <p style="font-size: 7pt; color: #cbd5e1; margin: 3px 0 0 0;">
                                    ${lang === 'de' ? 'Dieses Dokument ist vertraulich und nur für den internen Gebrauch bestimmt.' : lang === 'it' ? 'Questo documento è riservato e destinato esclusivamente all\'uso interno.' : 'This document is confidential and intended for internal use only.'}
                                </p>
                            </div>
                        `;
                        
                        pdfContainer.innerHTML = pdfHTML;
                        document.body.appendChild(pdfContainer);
                        
                        const opt = {
                            margin: [15, 18, 15, 15], // [top, right, bottom, left] in mm
                            filename: `Performance_Review_${(formData.employee || 'Export').replace(/[^a-z0-9äöüß]/gi, '_')}.pdf`,
                            image: { type: 'jpeg', quality: 0.98 },
                            html2canvas: { 
                                scale: 2,
                                useCORS: true,
                                logging: false,
                                backgroundColor: '#ffffff'
                            },
                            jsPDF: { 
                                unit: 'mm', 
                                format: 'a4', 
                                orientation: 'portrait'
                            },
                            pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
                        };
                        
                        window.html2pdf()
                            .set(opt)
                            .from(pdfContainer)
                            .save()
                            .then(() => {
                                document.body.removeChild(pdfContainer);
                                setIsGenerating(false);
                            })
                            .catch(err => {
                                console.error('PDF Error:', err);
                                alert("Fehler beim PDF-Export: " + err.message);
                                if (document.body.contains(pdfContainer)) {
                                    document.body.removeChild(pdfContainer);
                                }
                                setIsGenerating(false);
                            });
                            
                    } catch (error) {
                        console.error('PDF Generation Error:', error);
                        alert("Fehler beim PDF-Export: " + error.message);
                        setIsGenerating(false);
                    }
                }, 300);
            };

            const renderRow = (item, setList, list, isGoal) => {
                // Hole MA-Selbsteinschätzung für diese Kompetenz (falls vorhanden)
                const getSelfScore = () => {
                  if (!linkedSelfAssessment || isGoal) return null;
                  const selfScores = linkedSelfAssessment.selfCoreScores || {};
                  const selfLeaderScores = linkedSelfAssessment.selfLeaderScores || {};
                  const selfComments = linkedSelfAssessment.selfCoreComments || {};
                  
                  // Mapping: item.id (fach, komm, prob, adapt, orga) → selfScores Key (c1, c2, c3, c4, c5)
                  const idMapping = { fach: 'c1', komm: 'c2', prob: 'c3', adapt: 'c4', orga: 'c5' };
                  const leaderMapping = { lead: 'l1', strat: 'l2', decide: 'l3', exec: 'l4', stake: 'l5' };
                  
                  // Check if it's a leadership competency
                  const isLeader = ['lead', 'strat', 'decide', 'exec', 'stake', 'l1', 'l2', 'l3', 'l4', 'l5'].includes(item.id);
                  const selfKey = isLeader 
                    ? (leaderMapping[item.id] || item.id)
                    : (idMapping[item.id] || item.id);
                  const scores = isLeader ? selfLeaderScores : selfScores;
                  
                  return {
                    score: scores[selfKey] || scores[item.id] || null,
                    comment: selfComments[selfKey] || selfComments[item.id] || null
                  };
                };
                const selfData = getSelfScore();
                
                // Gap-Analyse für diese Kompetenz
                const gapData = competencyGaps[item.id];
                const hasGap = gapData && Math.abs(gapData.gap) > 1;
                
                return e(React.Fragment, { key: item.id },
                    e('tr', { 
                      className: `break-inside-avoid ${hasGap ? 'ring-2 ring-amber-400 ring-inset bg-amber-50/50' : ''}`
                    },
                        e('td', { className: "p-2 border align-top" }, 
                            isGoal 
                                ? e('div', null,
                                    e('textarea', { 
                                        className: "w-full bg-transparent outline-none font-medium resize-none", 
                                        value: item.name, 
                                        maxLength: 500,
                                        rows: 2,
                                        placeholder: lang === 'de' ? 'Zielbezeichnung (max. 500 Zeichen)...' : lang === 'it' ? 'Nome obiettivo (max. 500 caratteri)...' : 'Goal name (max. 500 characters)...',
                                        onChange: (ev) => updateItem(list, setList, item.id, 'name', ev.target.value) 
                                    }),
                                    e('div', { className: 'text-xs text-slate-400 text-right mt-1' }, 
                                        `${(item.name || '').length}/500`
                                    )
                                  )
                                : e('div', null,
                                    e('input', { className: "w-full bg-transparent outline-none font-medium", value: item.name, placeholder: "...", onChange: (ev) => updateItem(list, setList, item.id, 'name', ev.target.value) }),
                                    // Gap-Warnung als Hinweis unter dem Namen
                                    hasGap && e('div', { 
                                      className: 'mt-1 text-xs px-2 py-1 rounded bg-amber-100 text-amber-800 border-l-3 border-amber-500 no-print flex items-start gap-1.5'
                                    },
                                      e('span', { className: 'text-amber-600 flex-shrink-0' }, '⚠️'),
                                      e('span', null,
                                        lang === 'de' 
                                          ? `Gap: MA sieht sich bei ${gapData.selfScore}, Sie bei ${gapData.fkScore}. Fragen Sie nach konkreten Beispielen!`
                                          : lang === 'it'
                                          ? `Gap: MA si vede a ${gapData.selfScore}, Lei a ${gapData.fkScore}. Chieda esempi concreti!`
                                          : `Gap: Employee rates ${gapData.selfScore}, you rate ${gapData.fkScore}. Ask for specific examples!`
                                      )
                                    )
                                  )
                        ),
                        isGoal && e('td', { className: "p-2 border text-center w-16 align-top" }, 
                            e('div', { className: "flex items-center justify-center" },
                                e('input', { type: "number", className: "w-full bg-transparent outline-none text-right pr-1", value: item.weight, onChange: (ev) => updateItem(list, setList, item.id, 'weight', ev.target.value) }), e('span', null, "%")
                            )
                        ),
                        isGoal && e('td', { className: "p-2 border text-center w-16 align-top" }, 
                            e('div', { className: "flex items-center justify-center" },
                                e('input', { type: "number", className: "w-full bg-transparent outline-none text-right pr-1", value: item.achievement, onChange: (ev) => updateItem(list, setList, item.id, 'achievement', ev.target.value) }), e('span', null, "%")
                            )
                        ),
                        e('td', { className: `p-2 border text-center w-24 font-bold align-top ${hasGap ? 'bg-amber-100' : 'bg-slate-50'}` }, 
                            isGoal ? getBarsScore(item.achievement) : 
                            e('div', { className: 'flex flex-col items-center gap-1' },
                              e('select', { 
                                className: `bg-transparent w-full text-center outline-none font-bold ${hasGap ? 'text-amber-700' : ''}`, 
                                value: item.rating, 
                                onChange: (ev) => updateItem(list, setList, item.id, 'rating', parseInt(ev.target.value)) 
                              }, 
                                  [1,2,3,4,5].map(n => e('option', {key:n, value:n}, n))),
                              // MA-Selbsteinschätzung Badge (falls vorhanden)
                              selfData && selfData.score && e('div', { 
                                className: `text-xs px-2 py-0.5 rounded font-medium mt-1 no-print ${hasGap ? 'bg-amber-200 text-amber-800' : 'bg-teal-100 text-teal-700'}`,
                                title: lang === 'de' 
                                  ? (hasGap ? `Abweichung: ${Math.abs(gapData.gap)} Stufen - Gesprächsbedarf!` : 'Selbsteinschätzung des Mitarbeiters')
                                  : (hasGap ? `Scostamento: ${Math.abs(gapData.gap)} livelli - da discutere!` : 'Autovalutazione del collaboratore')
                              }, 'MA: ', selfData.score)
                            )
                        ),
                        !isGoal && e('td', { className: "p-2 border" }, 
                            e('div', null,
                              e('textarea', { className: "w-full bg-transparent outline-none resize-none text-sm", rows: 1, value: item.comment, placeholder: "...", onChange: (ev) => updateItem(list, setList, item.id, 'comment', ev.target.value) }),
                              // MA-Kommentar Hinweis (falls vorhanden)
                              selfData && selfData.comment && e('div', { 
                                className: 'mt-1 text-xs text-teal-600 bg-teal-50 p-1.5 rounded border-l-2 border-teal-400 no-print'
                              }, 
                                e('span', { className: 'font-medium' }, 'MA: '),
                                selfData.comment.length > 80 ? selfData.comment.substring(0, 80) + '...' : selfData.comment
                              )
                            )
                        ),
                        // Löschen-Button für Ziele
                        isGoal && e('td', { className: "p-2 border text-center no-print w-8 align-top" }, 
                            e('button', { 
                                onClick: () => removeItem(list, setList, item.id), 
                                className: "text-slate-300 hover:text-red-500 transition-colors",
                                title: lang === 'de' ? 'Ziel löschen' : lang === 'it' ? 'Elimina obiettivo' : 'Delete Goal'
                            }, e(Trash2, { size: 14 }))
                        )
                    ),
                    !isGoal && item.rating && (() => {
                        // Map competency id to BARS key
                        const compKey = item.id === 'fach' || (typeof item.id === 'string' && item.id.length <= 10) ? item.id : 
                                       CORE_COMPETENCIES_CALC.find(c => c.name === item.name || c.nameIt === item.name)?.id ||
                                       LEADERSHIP_COMPETENCIES_CALC.find(c => c.name === item.name || c.nameIt === item.name)?.id;
                        const description = compKey && t.barsCompetency && t.barsCompetency[compKey] ? 
                                           t.barsCompetency[compKey][item.rating] : 
                                           '';
                        return description ? e('tr', { className: "break-inside-avoid no-print" },
                            e('td', { colSpan: 4, className: "px-2 py-1 border-l border-r bg-blue-50 text-xs text-blue-700 italic" },
                                description
                            )
                        ) : null;
                    })()
                );
            };
            
            const renderDevRow = (item) => (
                e('tr', { key: item.id, className: "break-inside-avoid" },
                    e('td', { className: "p-2 border" }, 
                        e('input', { className: "w-full bg-transparent outline-none", value: item.measure, placeholder: "...", onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'measure', ev.target.value) })
                    ),
                    e('td', { className: "p-2 border" }, 
                        e('input', { className: "w-full bg-transparent outline-none", value: item.responsible, placeholder: "...", onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'responsible', ev.target.value) })
                    ),
                    e('td', { className: "p-2 border" }, 
                        e('input', { type: "date", className: "w-full bg-transparent outline-none", value: item.deadline, onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'deadline', ev.target.value) })
                    ),
                    e('td', { className: "p-2 border text-center no-print w-8" }, 
                        e('button', { onClick: () => removeItem(devPlan, setDevPlan, item.id), className: "text-slate-300 hover:text-red-500" }, e(Trash2, { size: 14 }))
                    )
                )
            );

            // Error Boundary für Debugging
            try {
            return e('div', { ref: formRef, className: "max-w-5xl mx-auto space-y-8 pb-20" },
                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200" },
                    e('div', { className: "flex justify-between items-start mb-6" },
                        e('div', null, 
                            e('h1', { className: "text-3xl font-bold", style: { color: "#243186" } }, "nıederwıeser"), 
                            e('span', { className: "text-sm tracking-wider font-medium", style: { color: "#6EBD84" } }, "FLEXIBLE FOOD PACKAGING")
                        ),
                        e('button', { onClick: handleDownloadPDF, disabled: isGenerating, className: "no-print flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50" }, 
                            isGenerating ? e(Loader2, { className: "animate-spin", size: 18 }) : e(Download, { size: 18 }), 
                            isGenerating ? t.generating : t.print
                        )
                    ),
                    e('div', { className: "border-b-2 border-slate-100 mb-4" }),
                    
                    // === TEAM BUTTONS (wenn teamContext) ===
                    teamButtonsVisible && teamContext && e('div', {
                      className: 'mb-6 p-5 bg-gradient-to-r from-[#243186] to-[#1a2564] rounded-xl shadow-2xl border-2 border-[#6EBD84]'
                    },
                      e('div', { className: 'flex flex-col gap-4' },
                        e('div', { className: 'flex justify-between items-start' },
                          e('div', { className: 'text-white' },
                            e('h2', { className: 'text-2xl font-bold mb-1', style: { color: '#6EBD84' } }, 
                              teamContext.employee.name
                            ),
                            e('p', { className: 'text-blue-200 text-sm font-medium' }, 
                              teamContext.employee.position + (teamContext.employee.department ? ' • ' + teamContext.employee.department : '')
                            ),
                            e('p', { className: 'text-blue-100 text-xs mt-1' }, 
                              (lang === 'de' ? 'Bewertungszeitraum: ' : lang === 'it' ? 'Periodo: ' : 'Assessment period: ') + teamContext.period
                            )
                          ),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'text-white/80 hover:text-white transition-colors text-2xl leading-none font-bold'
                          }, '×')
                        ),
                        e('div', { className: 'grid grid-cols-3 gap-3 mt-2' },
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('draft'),
                            type: 'button',
                            className: 'bg-slate-200 hover:bg-slate-300 text-slate-900 py-3 px-4 rounded-lg font-bold text-sm transition-all shadow-lg flex items-center justify-center gap-2'
                          }, '💾 ', lang === 'de' ? 'Entwurf speichern' : lang === 'it' ? 'Salva bozza' : 'Save Draft'),
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('completed'),
                            type: 'button',
                            className: 'bg-[#6EBD84] hover:bg-[#5da872] text-white py-3 px-4 rounded-lg font-bold text-sm transition-all shadow-lg flex items-center justify-center gap-2'
                          }, '✓ ', lang === 'de' ? 'Abschließen' : lang === 'it' ? 'Completa' : 'Complete'),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'border-2 border-white/40 text-white py-3 px-4 rounded-lg font-bold hover:bg-white/20 transition-all shadow-lg text-sm'
                          }, lang === 'de' ? 'Abbrechen' : lang === 'it' ? 'Annulla' : 'Cancel')
                        )
                      )
                    ),
                    
                    // === SELBSTREFLEXION VERKNÜPFUNGS-BANNER ===
                    linkedSelfAssessment && showSelfAssessmentHint && e('div', {
                      className: 'mt-4 p-4 bg-teal-50 border-2 border-teal-300 rounded-xl no-print'
                    },
                      e('div', { className: 'flex items-start justify-between' },
                        e('div', { className: 'flex items-center gap-3' },
                          e('div', { className: 'bg-teal-100 p-2 rounded-full' },
                            e(Users, { size: 20, className: 'text-teal-600' })
                          ),
                          e('div', null,
                            e('p', { className: 'font-bold text-teal-800' },
                              lang === 'de' ? '✨ Selbstreflexion verfügbar!' : lang === 'it' ? '✨ Autovalutazione disponibile!' : '✨ Self-Reflection Available!'
                            ),
                            e('p', { className: 'text-sm text-teal-600' },
                              lang === 'de' 
                                ? `${linkedSelfAssessment.employeeName} hat eine Selbstreflexion eingereicht. Die Antworten werden in diesem Formular als Referenz angezeigt.`
                                : lang === 'it' ? `${linkedSelfAssessment.employeeName} ha inviato un\'autovalutazione. Le risposte vengono visualizzate come riferimento in questo modulo.`
                                : `${linkedSelfAssessment.employeeName} has submitted a self-reflection. The responses are displayed as reference in this form.`
                            ),
                            e('p', { className: 'text-xs text-teal-500 mt-1' },
                              lang === 'de' 
                                ? `Eingereicht am ${new Date(linkedSelfAssessment.submittedAt || linkedSelfAssessment.createdAt).toLocaleDateString('de-DE')}`
                                : lang === 'it' ? `Inviato il ${new Date(linkedSelfAssessment.submittedAt || linkedSelfAssessment.createdAt).toLocaleDateString('it-IT')}`
                                : `Submitted on ${new Date(linkedSelfAssessment.submittedAt || linkedSelfAssessment.createdAt).toLocaleDateString('en-GB')}`
                            )
                          )
                        ),
                        e('button', {
                          onClick: () => setShowSelfAssessmentHint(false),
                          className: 'text-teal-400 hover:text-teal-600 transition-colors'
                        }, e(X, { size: 18 }))
                      ),
                      e('div', { className: 'flex items-center justify-between mt-3' },
                        e('span', { className: 'flex items-center gap-1 text-teal-600 text-xs' },
                          e('span', { className: 'px-2 py-0.5 bg-teal-100 rounded font-medium' }, 'MA: X'),
                          lang === 'de' ? '= Selbsteinschätzung des Mitarbeiters' : lang === 'it' ? '= Autovalutazione del collaboratore' : '= Employee Self-Assessment'
                        ),
                        // Button zum Ansehen der kompletten Selbstreflexion
                        e('button', {
                          onClick: () => {
                            localStorage.setItem('nw_view_self_assessment', JSON.stringify(linkedSelfAssessment));
                            // Wir müssen hier leider einen kleinen Umweg gehen
                            window.dispatchEvent(new CustomEvent('viewSelfAssessment'));
                          },
                          className: 'px-3 py-1.5 bg-teal-600 text-white rounded-lg hover:bg-teal-700 text-sm font-medium flex items-center gap-2 transition-colors'
                        }, 
                          e(Eye, { size: 14 }),
                          lang === 'de' ? 'Vollständig ansehen' : lang === 'it' ? 'Visualizza completo' : 'View Complete'
                        )
                      )
                    ),
                    
                    // === HINWEIS: KEINE SELBSTREFLEXION VORHANDEN ===
                    !linkedSelfAssessment && showSelfAssessmentHint && e('div', {
                      className: 'mt-4 p-4 bg-amber-50 border-2 border-amber-200 rounded-xl no-print'
                    },
                      e('div', { className: 'flex items-start justify-between' },
                        e('div', { className: 'flex items-center gap-3' },
                          e('div', { className: 'bg-amber-100 p-2 rounded-full' },
                            e(AlertCircle, { size: 20, className: 'text-amber-600' })
                          ),
                          e('div', null,
                            e('p', { className: 'font-bold text-amber-800' },
                              lang === 'de' ? '📋 Keine Selbstreflexion eingereicht' : lang === 'it' ? '📋 Nessuna autovalutazione inviata' : '📋 No Self-Reflection Submitted'
                            ),
                            e('p', { className: 'text-sm text-amber-600' },
                              lang === 'de' 
                                ? 'Der Mitarbeiter hat noch keine Selbstreflexion ausgefüllt. Sie können den Selbstreflexions-Link über "Mein Team" versenden.'
                                : lang === 'it' 
                                ? 'Il collaboratore non ha ancora compilato l\'autovalutazione. Puoi inviare il link tramite "Il mio team".'
                                : 'The employee has not yet completed a self-reflection. You can send the self-reflection link via "My Team".'
                            )
                          )
                        ),
                        e('button', {
                          onClick: () => setShowSelfAssessmentHint(false),
                          className: 'text-amber-400 hover:text-amber-600 transition-colors'
                        }, e(X, { size: 18 }))
                      )
                    ),
                    
                    e('h2', { className: "text-2xl font-bold", style: { color: "#243186" } }, t.headerTitle),
                    e('p', { className: "font-medium", style: { color: "#6EBD84" } }, t.headerSubtitle)
                ),
                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partA),
                    e('div', { className: "no-print mb-6 bg-blue-50 p-4 rounded-lg border border-blue-200" },
                        e('span', { className: "font-bold text-sm text-blue-800 block mb-3" }, t.formType + ":"),
                        e('div', { className: "flex gap-6 mb-3" },
                            e('label', { className: "flex items-center gap-2 text-sm cursor-pointer" }, 
                                e('input', { type: "radio", checked: formType === 'self', onChange: () => setFormType('self'), name: "formType" }), 
                                t.formTypeSelf
                            ),
                            e('label', { className: "flex items-center gap-2 text-sm cursor-pointer" }, 
                                e('input', { type: "radio", checked: formType === 'manager', onChange: () => setFormType('manager'), name: "formType" }), 
                                t.formTypeManager
                            )
                        ),
                        formType === 'self' && e('div', { className: "bg-yellow-50 border border-yellow-300 p-3 rounded text-sm text-yellow-900" }, t.selfReflectionNote)
                    ),
                    e('div', { className: "hidden print:block pdf-only mb-4 p-3 bg-slate-50 border rounded" }, 
                        e('strong', null, t.formType + ": "), 
                        formType === 'self' ? t.formTypeSelf : t.formTypeManager
                    ),
                    e('div', { className: "no-print mb-6 bg-[#F4FAF7] p-3 rounded flex gap-6 items-center" },
                        e('span', { className: "font-bold text-sm text-[#4D9360]" }, t.profile + ":"),
                        e('label', { className: "flex items-center gap-2 text-sm cursor-pointer" }, e('input', { type: "radio", checked: !isManager, onChange: () => setIsManager(false) }), t.roleEmp),
                        e('label', { className: "flex items-center gap-2 text-sm cursor-pointer" }, e('input', { type: "radio", checked: isManager, onChange: () => setIsManager(true) }), t.roleMgr)
                    ),
                    e('div', { className: "hidden print:block pdf-only mb-4 font-bold" }, `${t.profile}: ${isManager ? t.roleMgr : t.roleEmp}`),
                    e('div', { className: "grid grid-cols-2 gap-6" },
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.employee), e('input', { type: "text", value: formData.employee, onChange: (ev) => handleFormChange('employee', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.manager), e('input', { type: "text", value: formData.manager, onChange: (ev) => handleFormChange('manager', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.position), e('input', { type: "text", value: formData.position, onChange: (ev) => handleFormChange('position', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.date), e('input', { type: "date", value: formData.date, onChange: (ev) => handleFormChange('date', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" }))
                    )
                ),
                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('div', { className: "flex justify-between items-center mb-4 border-b pb-2" },
                        e('h3', { className: "text-lg font-bold text-slate-700" }, t.partB),
                        e('span', { className: "bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-bold" }, 
                            goals.length > 0 ? `Score: ${wasScore.toFixed(2)}` : (lang === 'de' ? 'Keine Ziele (nur WIE)' : lang === 'it' ? 'Nessun obiettivo (solo COME)' : 'No goals (HOW only)')
                        )
                    ),
                    // NEUER HINWEIS: Keine Ziele vorhanden
                    e('div', { className: "no-print mb-4 p-4 rounded-lg bg-amber-50 border border-amber-200" },
                        e('div', { className: "flex items-start gap-3" },
                            e(Info, { size: 20, className: "text-amber-600 mt-0.5 flex-shrink-0" }),
                            e('div', null,
                                e('p', { className: "text-sm font-semibold text-amber-800 mb-1" }, 
                                    lang === 'de' ? 'Keine Zielvereinbarung vorhanden?' : lang === 'it' ? 'Nessun accordo sugli obiettivi?' : 'No Goal Agreement found?'
                                ),
                                e('p', { className: "text-xs text-amber-700" }, 
                                    lang === 'de' 
                                        ? 'Falls für diesen Mitarbeiter keine Ziele vereinbart wurden, löschen Sie bitte alle Zeilen mit dem 🗑️-Button. Der GPS wird dann automatisch nur aus Teil C (Kompetenzen = 100%) berechnet.'
                                        : 'Se non sono stati concordati obiettivi per questo collaboratore, eliminare tutte le righe con il pulsante 🗑️. Il GPS verrà calcolato automaticamente solo dalla Parte C (Competenze = 100%).'
                                )
                            )
                        )
                    ),
                    e('table', { className: "w-full text-sm" },
                        e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, 
                            e('th', { className: "p-2 border w-1/3" }, t.goalName), 
                            e('th', { className: "p-2 border" }, t.weight), 
                            e('th', { className: "p-2 border" }, t.achievement), 
                            e('th', { className: "p-2 border" }, "BARS"),
                            e('th', { className: "p-2 border no-print w-8" }, "")
                        )),
                        e('tbody', null, goals.map(item => renderRow(item, setGoals, goals, true)))
                    ),
                    e('button', { onClick: () => addItem(goals, setGoals, {name:'', weight:0, achievement:0}), className: "no-print mt-3 text-xs flex items-center gap-1 text-blue-600" }, e(PlusCircle, {size:14}), t.addGoal),
                    goals.length === 0 && e('div', { 
                        className: 'text-sm p-4 mt-3 rounded-lg bg-green-50 text-green-700 border border-green-200'
                    }, 
                        e('div', { className: "flex items-center gap-2" },
                            e(CheckCircle2, { size: 18 }),
                            e('span', { className: "font-semibold" },
                                lang === 'de' 
                                    ? '✓ GPS wird zu 100% aus WIE-Kompetenzen berechnet'
                                    : '✓ GPS calcolato al 100% dalle competenze COME'
                            )
                        ),
                        e('p', { className: "text-xs mt-1 ml-6" },
                            lang === 'de'
                                ? isManager 
                                    ? 'Formel: 50% Kern-Kompetenzen + 50% Leadership-Kompetenzen'
                                    : 'Formel: 100% Kern-Kompetenzen'
                                : isManager
                                    ? 'Formula: 50% Competenze Core + 50% Competenze Leadership'
                                    : 'Formula: 100% Competenze Core'
                        )
                    ),
                    goals.length > 0 && totalGoalWeight !== 100 && e('div', { 
                        className: `no-print text-sm p-3 mt-3 rounded-lg ${
                            totalGoalWeight > 100 ? 'bg-red-50 text-red-700 border border-red-200' : 
                            'bg-yellow-50 text-yellow-700 border border-yellow-200'
                        }`
                    }, 
                        `${t.totalWeight}: ${totalGoalWeight}% ${totalGoalWeight !== 100 ? `(${t.shouldBe100})` : ''}`
                    ),
                    
                    // Geplanter Bonus (100%) Feld und Berechnung
                    e('div', { className: "mt-6 pt-4 border-t border-slate-200" },
                        // Eingabefeld für geplanten Bonus
                        e('div', { className: "flex items-center gap-4 mb-4" },
                            e('label', { className: "text-sm font-semibold text-slate-700 whitespace-nowrap" }, 
                                lang === 'de' ? 'Geplanter Bonus (100%):' : lang === 'it' ? 'Bonus previsto (100%):' : 'Planned Bonus (100%):'
                            ),
                            e('div', { className: "relative w-48" },
                                e('input', { 
                                    type: "text", 
                                    value: displayBonus,
                                    onChange: (ev) => handleBonusChange(ev.target.value),
                                    placeholder: lang === 'de' ? 'z.B. 5.000' : lang === 'it' ? 'es. 5.000' : 'e.g. 5,000',
                                    className: "w-full border border-slate-300 rounded-lg px-3 py-2 pr-8 outline-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] text-right font-medium"
                                }),
                                e('span', { className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium" }, '€')
                            ),
                            e('span', { className: "text-xs text-slate-400" }, 
                                lang === 'de' ? '(Tausenderpunkte erlaubt)' : lang === 'it' ? '(Punti per migliaia)' : '(Thousands separators allowed)'
                            )
                        ),
                        
                        // Bonus-Berechnung anzeigen (nur wenn Bonus eingegeben)
                        plannedBonusNum > 0 && goals.length > 0 && e('div', { className: "bg-gradient-to-r from-emerald-50 to-green-50 p-4 rounded-xl border border-emerald-200" },
                            e('h4', { className: "font-bold text-emerald-800 mb-3 flex items-center gap-2" },
                                e(Calculator, { size: 18 }),
                                lang === 'de' ? 'Bonus-Berechnung' : lang === 'it' ? 'Calcolo Bonus' : 'Bonus Calculation'
                            ),
                            
                            // Tabelle mit Bonus pro Ziel
                            e('table', { className: "w-full text-sm mb-3" },
                                e('thead', { className: "bg-emerald-100/50" },
                                    e('tr', null,
                                        e('th', { className: "p-2 text-left text-emerald-800 font-semibold" }, 
                                            lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'),
                                        e('th', { className: "p-2 text-center text-emerald-800 font-semibold w-20" }, 
                                            lang === 'de' ? 'Gewicht' : lang === 'it' ? 'Peso' : 'Weight'),
                                        e('th', { className: "p-2 text-right text-emerald-800 font-semibold w-24" }, 
                                            lang === 'de' ? 'Anteil' : lang === 'it' ? 'Quota' : 'Share'),
                                        e('th', { className: "p-2 text-center text-emerald-800 font-semibold w-20" }, 
                                            lang === 'de' ? 'Erreicht' : lang === 'it' ? 'Raggiunto' : 'Achieved'),
                                        e('th', { className: "p-2 text-right text-emerald-800 font-semibold w-28" }, 
                                            lang === 'de' ? 'Auszahlung' : lang === 'it' ? 'Pagamento' : 'Payout')
                                    )
                                ),
                                e('tbody', null,
                                    bonusPerGoal.map((b, idx) => 
                                        e('tr', { key: idx, className: "border-t border-emerald-200" },
                                            e('td', { className: "p-2 text-slate-700" }, 
                                                b.goalName || `${lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'} ${idx + 1}`
                                            ),
                                            e('td', { className: "p-2 text-center text-slate-600" }, `${b.weight}%`),
                                            e('td', { className: "p-2 text-right text-slate-600" }, 
                                                `${formatGermanNumber(b.goalBonus.toFixed(0))} €`
                                            ),
                                            e('td', { className: "p-2 text-center" },
                                                e('span', { 
                                                    className: `px-2 py-0.5 rounded text-xs font-medium ${
                                                        b.achievement >= 100 ? 'bg-green-100 text-green-800' :
                                                        b.achievement >= 70 ? 'bg-yellow-100 text-yellow-800' :
                                                        'bg-red-100 text-red-800'
                                                    }`
                                                }, `${b.achievement}%`)
                                            ),
                                            e('td', { className: "p-2 text-right font-semibold text-emerald-700" }, 
                                                `${formatGermanNumber(b.payout.toFixed(0))} €`
                                            )
                                        )
                                    )
                                )
                            ),
                            
                            // Summenzeile
                            e('div', { className: "flex justify-between items-center pt-3 border-t-2 border-emerald-300" },
                                e('div', { className: "text-sm text-emerald-800" },
                                    e('span', { className: "font-medium" }, 
                                        lang === 'de' ? 'Geplant: ' : lang === 'it' ? 'Previsto: ' : 'Planned: '
                                    ),
                                    e('span', { className: "font-bold" }, `${formatGermanNumber(plannedBonusNum.toFixed(0))} €`)
                                ),
                                e('div', { className: "text-right" },
                                    e('div', { className: "text-xs text-emerald-600 mb-1" },
                                        lang === 'de' ? 'Tatsächliche Auszahlung:' : lang === 'it' ? 'Pagamento effettivo:' : 'Actual Payout:'
                                    ),
                                    e('div', { className: "text-2xl font-black text-emerald-700" },
                                        `${formatGermanNumber(totalBonusPayout.toFixed(0))} €`
                                    ),
                                    e('div', { className: `text-xs font-medium ${bonusPayoutPercentage >= 100 ? 'text-green-600' : bonusPayoutPercentage >= 70 ? 'text-yellow-600' : 'text-red-600'}` },
                                        `(${bonusPayoutPercentage.toFixed(1)}% ${lang === 'de' ? 'vom Zielbonus' : lang === 'it' ? 'del bonus target' : 'of target bonus'})`
                                    )
                                )
                            ),
                            
                            // Hinweis bei >100% Zielerreichung
                            bonusPerGoal.some(b => b.achievement > 100) && e('div', { className: "mt-3 p-2 bg-blue-50 border border-blue-200 rounded-lg text-xs text-blue-700" },
                                lang === 'de' 
                                    ? '💡 Hinweis: Bei >100% Zielerreichung wird der Bonus auf max. 100% des Ziel-Anteils gedeckelt.'
                                    : '💡 Nota: Con >100% di raggiungimento, il bonus è limitato al max. 100% della quota obiettivo.'
                            )
                        )
                    )
                ),
                
                // === HALO-EFFEKT WARNUNG ===
                haloEffectWarning && e('div', { 
                  className: "bg-amber-50 border-2 border-amber-400 rounded-xl p-4 no-print"
                },
                  e('div', { className: "flex items-start gap-3" },
                    e('div', { className: "text-2xl flex-shrink-0" }, "🎭"),
                    e('div', null,
                      e('div', { className: "font-bold text-amber-800 mb-1" }, 
                        lang === 'de' ? 'Möglicher Halo-Effekt' : lang === 'it' ? 'Possibile Effetto Halo' : 'Possible Halo Effect'
                      ),
                      e('div', { className: "text-sm text-amber-700" },
                        lang === 'de' 
                          ? `Alle 5 Core-Kompetenzen wurden mit Level ${coreRatings[0]} bewertet. Es ist unwahrscheinlich, dass jemand in allen Bereichen exakt gleich stark ist. Wo liegen echte Stärken, wo Entwicklungsfelder?`
                          : lang === 'it'
                          ? `Tutte le 5 competenze core sono valutate livello ${coreRatings[0]}. È improbabile che qualcuno sia uguale in tutte le aree. Dove sono i punti di forza, dove le aree di sviluppo?`
                          : `All 5 core competencies rated at level ${coreRatings[0]}. It's unlikely someone performs exactly the same in all areas. Where are real strengths, where development areas?`
                      )
                    )
                  )
                ),
                
                // === GAP-ANALYSE SUMMARY ===
                hasSignificantGaps && linkedSelfAssessment && e('div', { 
                  className: "bg-purple-50 border-2 border-purple-400 rounded-xl p-4 no-print"
                },
                  e('div', { className: "flex items-start gap-3" },
                    e('div', { className: "text-2xl flex-shrink-0" }, "🔍"),
                    e('div', null,
                      e('div', { className: "font-bold text-purple-800 mb-1" }, 
                        lang === 'de' 
                          ? `${Object.keys(competencyGaps).length} Wahrnehmungs-Gap${Object.keys(competencyGaps).length > 1 ? 's' : ''}`
                          : lang === 'it'
                          ? `${Object.keys(competencyGaps).length} gap di percezione`
                          : `${Object.keys(competencyGaps).length} perception gap${Object.keys(competencyGaps).length > 1 ? 's' : ''}`
                      ),
                      e('div', { className: "text-sm text-purple-700 mb-2" },
                        lang === 'de' 
                          ? 'Bei den gelb markierten Kompetenzen weicht Ihre Einschätzung um >1 Stufe vom Selbstbild ab. Nutzen Sie das Gespräch zum Abgleich.'
                          : lang === 'it'
                          ? 'Nelle competenze evidenziate in giallo, la valutazione differisce di >1 livello. Usi il colloquio per allineare.'
                          : 'For yellow-marked competencies, your rating differs by >1 level from self-assessment. Use the conversation to align.'
                      ),
                      e('div', { className: "text-xs text-purple-600 bg-purple-100 p-2 rounded italic" },
                        lang === 'de' 
                          ? '💡 "Können Sie mir ein konkretes Beispiel nennen, wo Sie das gezeigt haben?"'
                          : lang === 'it'
                          ? '💡 "Può darmi un esempio concreto in cui lo ha dimostrato?"'
                          : '💡 "Can you give me a specific example where you demonstrated this?"'
                      )
                    )
                  )
                ),
                
                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('div', { className: "flex justify-between items-center mb-4 border-b pb-2" },
                        e('h3', { className: "text-lg font-bold text-slate-700" }, t.partC),
                        e('span', { className: "bg-[#E8F5ED] text-[#4D9360] px-2 py-1 rounded text-xs font-bold" }, `Score: ${wieCoreScore.toFixed(2)}`)
                    ),
                    e('table', { className: "w-full text-sm" },
                        e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, 
                            e('th', { className: "p-2 border" }, t.compName), 
                            e('th', { className: "p-2 border w-24" }, t.rating), 
                            e('th', { className: "p-2 border" }, t.comment)
                        )),
                        e('tbody', null, coreList.map(item => renderRow(item, setCoreList, coreList, false)))
                    ),
                    e('button', { onClick: () => addItem(coreList, setCoreList, {name:'', weight:20, rating:3, comment:''}), className: "no-print mt-3 text-xs flex items-center gap-1 text-[#6EBD84]" }, e(PlusCircle, {size:14}), t.addComp)
                ),
                isManager && e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('div', { className: "flex justify-between items-center mb-4 border-b pb-2" },
                        e('h3', { className: "text-lg font-bold text-[#5CA872]" }, t.partCLead),
                        e('span', { className: "bg-[#E8F5ED] text-[#4D9360] px-2 py-1 rounded text-xs font-bold" }, `Score: ${wieLeadScore.toFixed(2)}`)
                    ),
                    e('table', { className: "w-full text-sm" },
                        e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, 
                            e('th', { className: "p-2 border" }, t.compName), 
                            e('th', { className: "p-2 border w-24" }, t.rating), 
                            e('th', { className: "p-2 border" }, t.comment)
                        )),
                        e('tbody', null, leadList.map(item => renderRow(item, setLeadList, leadList, false)))
                    ),
                    e('button', { onClick: () => addItem(leadList, setLeadList, {name:'', weight:20, rating:3, comment:''}), className: "no-print mt-3 text-xs flex items-center gap-1 text-[#6EBD84]" }, e(PlusCircle, {size:14}), t.addComp)
                ),
                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partC3),
                    e('div', { className: "bg-slate-50 p-6 rounded-xl text-center border border-slate-200" },
                        e('div', { className: "text-sm text-slate-500 uppercase tracking-widest mb-2" }, "Final GPS"),
                        e('div', { className: "text-5xl font-black text-slate-800" }, finalGPS.toFixed(2)),
                        e('div', { className: "mt-2 font-medium text-[#6EBD84]" }, 
                            goals.length === 0 || totalGoalWeight === 0
                                ? (isManager 
                                    ? (lang === 'de' ? '(100% WIE: 50% Kern + 50% Leadership)' : lang === 'it' ? '(100% COME: 50% Core + 50% Leadership)' : '(100% HOW: 50% Core + 50% Leadership)')
                                    : (lang === 'de' ? '(100% WIE: Kern-Kompetenzen)' : lang === 'it' ? '(100% COME: Competenze Core)' : '(100% HOW: Core Competencies)'))
                                : (isManager 
                                    ? '(WAS 50% + WIE Core 25% + WIE Lead 25%)' 
                                    : '(WAS 50% + WIE Core 50%)')
                        ),
                        goals.length === 0 && e('div', { className: "mt-3 text-xs text-amber-600 bg-amber-50 px-3 py-1 rounded-full inline-block" },
                            lang === 'de' ? '⚠️ Ohne Zielvereinbarung' : lang === 'it' ? '⚠️ Senza accordo obiettivi' : '⚠️ Without Goal Agreement'
                        )
                    )
                ),
                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partD),
                    e('div', { className: "mb-6" },
                        e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.strengthsProfessional),
                        // MA-Selbstreflexion Hinweis für Stärken
                        linkedSelfAssessment && linkedSelfAssessment.formData?.strengths1 && e('div', { 
                          className: 'mb-2 p-3 bg-teal-50 border border-teal-200 rounded-lg text-sm no-print'
                        },
                          e('div', { className: 'flex items-center gap-2 text-teal-700 font-medium mb-1' },
                            e(Users, { size: 14 }),
                            lang === 'de' ? 'Selbsteinschätzung MA (Stärken):' : lang === 'it' ? 'Autovalutazione MA (Punti di forza):' : 'Employee Self-Assessment (Strengths):'
                          ),
                          e('p', { className: 'text-teal-600 text-xs whitespace-pre-wrap' }, 
                            linkedSelfAssessment.formData.strengths1
                          )
                        ),
                        e('textarea', { 
                          className: `w-full border rounded p-2 text-sm ${(formData.strengths1 || '').length > 1500 ? 'border-amber-400 bg-amber-50' : 'border-slate-300'}`, 
                          rows: 3, 
                          value: formData.strengths1, 
                          maxLength: 2000,
                          onChange: (ev) => handleFormChange('strengths1', ev.target.value) 
                        }),
                        e('div', { className: 'flex justify-between items-center mt-1' },
                          (formData.strengths1 || '').length > 1500 && e('span', { className: 'text-xs text-amber-600' }, 
                            lang === 'de' ? '⚠️ Langer Text kann im PDF umbrechen' : '⚠️ Testo lungo può andare a capo nel PDF'
                          ),
                          e('span', { className: `text-xs ${(formData.strengths1 || '').length > 1500 ? 'text-amber-600' : 'text-slate-400'}` }, 
                            `${(formData.strengths1 || '').length}/2000`
                          )
                        ),
                        e('label', { className: "block text-sm font-bold mt-4 mb-1 text-slate-700" }, t.strengthsPersonal),
                        // MA-Selbstreflexion Hinweis für Entwicklungsfelder
                        linkedSelfAssessment && linkedSelfAssessment.formData?.strengths2 && e('div', { 
                          className: 'mb-2 p-3 bg-teal-50 border border-teal-200 rounded-lg text-sm no-print'
                        },
                          e('div', { className: 'flex items-center gap-2 text-teal-700 font-medium mb-1' },
                            e(Users, { size: 14 }),
                            lang === 'de' ? 'Selbsteinschätzung MA (Entwicklungsfelder):' : lang === 'it' ? 'Autovalutazione MA (Aree di sviluppo):' : 'Employee Self-Assessment (Development Areas):'
                          ),
                          e('p', { className: 'text-teal-600 text-xs whitespace-pre-wrap' }, 
                            linkedSelfAssessment.formData.strengths2
                          )
                        ),
                        e('textarea', { 
                          className: `w-full border rounded p-2 text-sm ${(formData.strengths2 || '').length > 1500 ? 'border-amber-400 bg-amber-50' : 'border-slate-300'}`, 
                          rows: 3, 
                          value: formData.strengths2, 
                          maxLength: 2000,
                          onChange: (ev) => handleFormChange('strengths2', ev.target.value) 
                        }),
                        e('div', { className: 'flex justify-between items-center mt-1' },
                          (formData.strengths2 || '').length > 1500 && e('span', { className: 'text-xs text-amber-600' }, 
                            lang === 'de' ? '⚠️ Langer Text kann im PDF umbrechen' : '⚠️ Testo lungo può andare a capo nel PDF'
                          ),
                          e('span', { className: `text-xs ${(formData.strengths2 || '').length > 1500 ? 'text-amber-600' : 'text-slate-400'}` }, 
                            `${(formData.strengths2 || '').length}/2000`
                          )
                        )
                    ),
                    // MA-Wünsche anzeigen (falls vorhanden)
                    linkedSelfAssessment && linkedSelfAssessment.formData?.wishesNextYear && e('div', { 
                      className: 'mb-4 p-3 bg-purple-50 border border-purple-200 rounded-lg text-sm no-print'
                    },
                      e('div', { className: 'flex items-center gap-2 text-purple-700 font-medium mb-1' },
                        e(Target, { size: 14 }),
                        lang === 'de' ? 'MA-Wünsche für das kommende Jahr:' : lang === 'it' ? 'Desideri del MA per l\'anno prossimo:' : 'Employee wishes for next year:'
                      ),
                      e('p', { className: 'text-purple-600 text-xs whitespace-pre-wrap' }, 
                        linkedSelfAssessment.formData.wishesNextYear
                      )
                    ),
                    // MA-Feedback an FK anzeigen (falls vorhanden) - hervorgehoben!
                    linkedSelfAssessment && linkedSelfAssessment.formData?.feedbackManager && e('div', { 
                      className: 'mb-4 p-4 bg-blue-50 border-2 border-blue-300 rounded-lg text-sm no-print'
                    },
                      e('div', { className: 'flex items-center gap-2 text-blue-800 font-bold mb-2' },
                        e(MessageCircle, { size: 16 }),
                        '💬 ', lang === 'de' ? 'Feedback des Mitarbeiters an Sie:' : lang === 'it' ? 'Feedback del collaboratore per Lei:' : 'Employee Feedback to You:'
                      ),
                      e('p', { className: 'text-blue-700 whitespace-pre-wrap' }, 
                        linkedSelfAssessment.formData.feedbackManager
                      )
                    ),
                    e('h4', { className: "font-bold text-slate-700 mb-2" }, t.development),
                    e('p', { className: "text-xs text-slate-500 mb-2" }, t.devIntro),
                    e('table', { className: "w-full text-sm mb-2" },
                        e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, e('th', { className: "p-2 border" }, t.measure), e('th', { className: "p-2 border" }, t.responsible), e('th', { className: "p-2 border" }, t.deadline), e('th', { className: "p-2 border no-print" }, ""))),
                        e('tbody', null, devPlan.map(item => renderDevRow(item)))
                    ),
                    e('button', { onClick: () => addItem(devPlan, setDevPlan, {measure:'', responsible:'', deadline:''}), className: "no-print mt-2 text-xs flex items-center gap-1 text-blue-600" }, e(PlusCircle, {size:14}), t.addDev)
                ),
                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partE),
                    e('p', { className: "text-xs text-slate-500 mb-2" }, t.careerIntro),
                    e('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-2 mb-4" },
                        t.careerOptions.map((opt, i) => 
                            e('label', { key: i, className: "flex items-center gap-2 text-sm p-2 border rounded cursor-pointer hover:bg-slate-50" },
                                e('input', { type: "checkbox", checked: careerChecks[i], onChange: () => toggleCareer(i) }), opt
                            )
                        )
                    ),
                    e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.comments),
                    e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.careerComment, onChange: (ev) => handleFormChange('careerComment', ev.target.value) })
                ),
                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partF),
                    e('p', { className: "text-xs text-slate-500 mb-4" }, t.feedbackIntro),
                    e('div', { className: "space-y-4" },
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ1),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ1, onChange: (ev) => handleFormChange('feedbackQ1', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ2),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ2, onChange: (ev) => handleFormChange('feedbackQ2', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ3),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ3, onChange: (ev) => handleFormChange('feedbackQ3', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ4),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ4, onChange: (ev) => handleFormChange('feedbackQ4', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ5),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ5, onChange: (ev) => handleFormChange('feedbackQ5', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ6),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ6, onChange: (ev) => handleFormChange('feedbackQ6', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, t.feedbackQ7),
                            e('div', { className: "flex gap-4" },
                                [1,2,3,4,5].map(n => 
                                    e('label', { key: n, className: "flex items-center gap-1 cursor-pointer" },
                                        e('input', { type: "radio", name: "balance", value: n, checked: formData.feedbackQ7 == n, onChange: (ev) => handleFormChange('feedbackQ7', ev.target.value) }), n
                                    )
                                )
                            )
                        )
                    )
                ),
                e('div', { className: "bg-white p-8 rounded-xl shadow-sm border border-slate-200 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-8 border-b pb-2" }, t.partH),
                    e('div', { className: "grid grid-cols-2 gap-12" },
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.employee)),
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.manager))
                    )
                )
            );
            } catch (renderError) {
                console.error('AppraisalForm render error:', renderError);
                return e('div', { className: 'p-8 bg-red-50 rounded-xl border-2 border-red-300' },
                    e('h2', { className: 'text-xl font-bold text-red-700 mb-4' }, '⚠️ Fehler beim Laden des Formulars'),
                    e('p', { className: 'text-red-600 mb-2' }, 'Error: ' + renderError.message),
                    e('pre', { className: 'text-xs bg-red-100 p-4 rounded overflow-auto' }, renderError.stack),
                    e('button', { 
                        onClick: onCancel,
                        className: 'mt-4 px-4 py-2 bg-red-600 text-white rounded-lg'
                    }, 'Zurück')
                );
            }
        };

        // === HELP CHAT / SMART HR COPILOT ===
        // === KNOWLEDGE BASE ===
        const KNOWLEDGE_BASE = {
          // A. Strategie & Werte
          strategy: {
            name: { de: 'Strategie 2035', it: 'Strategia 2035', en: 'Strategy 2035' },
            goal: { de: 'Smartest Solution Provider', it: 'Smartest Solution Provider', en: 'Smartest Solution Provider' },
            description: {
              de: 'Unser Ziel ist die Entwicklung zum "Smartest Solution Provider" bis 2035. Wir setzen auf Innovation, Nachhaltigkeit und exzellente Kundenbeziehungen.',
              it: 'Il nostro obiettivo è diventare il "Smartest Solution Provider" entro il 2035. Puntiamo su innovazione, sostenibilità ed eccellenti relazioni con i clienti.',
              en: 'Our goal is to become the "Smartest Solution Provider" by 2035. We focus on innovation, sustainability, and excellent customer relationships.'
            }
          },
          values: {
            fast: {
              de: { name: 'Fast', desc: 'Wir agieren schnell und lösungsorientiert. Geschwindigkeit ist ein Wettbewerbsvorteil.' },
              it: { name: 'Fast', desc: 'Agiamo velocemente e orientati alle soluzioni. La velocità è un vantaggio competitivo.' },
              en: { name: 'Fast', desc: 'We act quickly and solution-oriented. Speed is a competitive advantage.' }
            },
            fair: {
              de: { name: 'Fair', desc: 'Wir arbeiten respektvoll und auf Augenhöhe zusammen. Transparenz und Ehrlichkeit sind uns wichtig.' },
              it: { name: 'Fair', desc: 'Lavoriamo con rispetto e alla pari. Trasparenza e onestà sono importanti per noi.' },
              en: { name: 'Fair', desc: 'We work respectfully and as equals. Transparency and honesty are important to us.' }
            },
            personal: {
              de: { name: 'Personal', desc: 'Wir übernehmen Verantwortung und gestalten aktiv. Jeder Einzelne macht den Unterschied.' },
              it: { name: 'Personal', desc: 'Ci assumiamo responsabilità e contribuiamo attivamente. Ogni individuo fa la differenza.' },
              en: { name: 'Personal', desc: 'We take responsibility and actively contribute. Every individual makes a difference.' }
            }
          },
          
          // B. GPS-Formel
          gps: {
            formula: {
              de: 'GPS = (WAS + WIE) ÷ 2',
              it: 'GPS = (COSA + COME) ÷ 2',
              en: 'GPS = (WHAT + HOW) ÷ 2'
            },
            profiles: {
              employee: {
                de: '50% WAS (Ziele) + 50% WIE (5 Kern-Kompetenzen)',
                it: '50% COSA (Obiettivi) + 50% COME (5 Competenze Core)',
                en: '50% WHAT (Goals) + 50% HOW (5 Core Competencies)'
              },
              leader: {
                de: '50% WAS (Ziele) + 25% WIE (Kern) + 25% WIE (Leadership)',
                it: '50% COSA (Obiettivi) + 25% COME (Core) + 25% COME (Leadership)',
                en: '50% WHAT (Goals) + 25% HOW (Core) + 25% HOW (Leadership)'
              }
            },
            ratings: [
              { range: '4.51-5.00', rating: 5, name: { de: 'Outstanding', it: 'Outstanding', en: 'Outstanding' }, consequence: { de: 'Top Bonus / Gehaltssprung', it: 'Top Bonus / Aumento significativo', en: 'Top Bonus / Salary Jump' }},
              { range: '3.51-4.50', rating: 4, name: { de: 'Exceeds Expectations', it: 'Supera le aspettative', en: 'Exceeds Expectations' }, consequence: { de: 'Basis-Bonus / Erhöhung', it: 'Bonus base / Aumento', en: 'Base Bonus / Increase' }},
              { range: '2.51-3.50', rating: 3, name: { de: 'Meets Expectations', it: 'Soddisfa le aspettative', en: 'Meets Expectations' }, consequence: { de: 'Baseline / Standard', it: 'Baseline / Standard', en: 'Baseline / Standard' }},
              { range: '1.51-2.50', rating: 2, name: { de: 'Needs Improvement', it: 'Da migliorare', en: 'Needs Improvement' }, consequence: { de: 'PIP / Enge Führung', it: 'PIP / Supervisione stretta', en: 'PIP / Close Management' }},
              { range: '0.00-1.50', rating: 1, name: { de: 'Does Not Meet', it: 'Non soddisfa', en: 'Does Not Meet' }, consequence: { de: 'Eskalation / HR-Gespräch', it: 'Escalation / Colloquio HR', en: 'Escalation / HR Meeting' }}
            ]
          },
          
          // C. Zielerreichung
          goalAchievement: {
            conversion: [
              { percent: '≥130%', score: 5, desc: { de: 'Herausragend übertroffen', it: 'Eccezionalmente superato', en: 'Exceptionally exceeded' }},
              { percent: '111-129%', score: 4, desc: { de: 'Deutlich übertroffen', it: 'Nettamente superato', en: 'Clearly exceeded' }},
              { percent: '90-110%', score: 3, desc: { de: 'Baseline erreicht ✓', it: 'Baseline raggiunta ✓', en: 'Baseline achieved ✓' }},
              { percent: '70-89%', score: 2, desc: { de: 'Teilweise erreicht', it: 'Parzialmente raggiunto', en: 'Partially achieved' }},
              { percent: '<70%', score: 1, desc: { de: 'Nicht erreicht', it: 'Non raggiunto', en: 'Not achieved' }}
            ]
          },
          
          // D. Kompetenzen
          competencies: {
            core: [
              { id: 'c1', key: 'fach', name: { de: 'Fachkompetenz & Anwendung', it: 'Competenza Tecnica', en: 'Technical Expertise' },
                keywords: ['fach', 'technical', 'tecnic', 'expertise', 'wissen', 'knowledge', 'qualität', 'quality', 'prozess'],
                desc: { de: 'Fachwissen, Prozesssicherheit, Qualität, Weitergabe von Wissen. Nicht nur Theorie, sondern praktische Anwendung!', it: 'Conoscenza tecnica, sicurezza dei processi, qualità, trasferimento di conoscenze.', en: 'Technical knowledge, process safety, quality, knowledge transfer.' }},
              { id: 'c2', key: 'komm', name: { de: 'Kommunikation & Zusammenarbeit', it: 'Comunicazione & Collaborazione', en: 'Communication & Collaboration' },
                keywords: ['kommunikation', 'communication', 'comunicazione', 'zusammenarbeit', 'collabor', 'team', 'one niederwieser', 'phone before email', 'silo'],
                desc: { de: '"One Niederwieser" Mindset, Silos abbauen, "Phone before Email", proaktiver Informationsfluss.', it: 'Mentalità "One Niederwieser", eliminare i silos, "Phone before Email", flusso informativo proattivo.', en: '"One Niederwieser" mindset, breaking silos, "Phone before Email", proactive information flow.' }},
              { id: 'c3', key: 'prob', name: { de: 'Problemlösekompetenz', it: 'Capacità di Problem Solving', en: 'Problem Solving' },
                keywords: ['problem', 'lösung', 'solution', 'soluzione', 'root cause', 'ursache', 'troubleshoot', 'analyse', 'analysis'],
                desc: { de: 'Root Cause Analysis statt nur Symptome bekämpfen. Eigenständigkeit bei der Lösungsfindung.', it: 'Root Cause Analysis invece di combattere solo i sintomi. Autonomia nella ricerca di soluzioni.', en: 'Root Cause Analysis instead of just fighting symptoms. Independence in finding solutions.' }},
              { id: 'c4', key: 'adapt', name: { de: 'Anpassungsfähigkeit', it: 'Adattabilità', en: 'Adaptability' },
                keywords: ['anpass', 'adapt', 'adatt', 'change', 'veränder', 'cambio', 'growth mindset', 'flexib', 'agil', 'agile', 'neu', 'new'],
                desc: { de: 'Growth Mindset, positiver Umgang mit Veränderung, Bereitschaft neue Tools und Methoden zu lernen.', it: 'Growth Mindset, approccio positivo al cambiamento, disponibilità ad apprendere nuovi strumenti.', en: 'Growth Mindset, positive approach to change, willingness to learn new tools and methods.' }},
              { id: 'c5', key: 'orga', name: { de: 'Selbstorganisation', it: 'Auto-organizzazione', en: 'Self-Organization' },
                keywords: ['selbstorganisation', 'self-organiz', 'auto-organiz', 'priorit', 'deadline', 'zuverläss', 'reliab', 'affidabil', 'struktur', 'time management'],
                desc: { de: 'Priorisierung, Einhaltung von Deadlines, Zuverlässigkeit, strukturiertes Arbeiten.', it: 'Prioritizzazione, rispetto delle scadenze, affidabilità, lavoro strutturato.', en: 'Prioritization, meeting deadlines, reliability, structured work.' }}
            ],
            leadership: [
              { id: 'l1', key: 'lead', name: { de: 'Mitarbeiterführung', it: 'Gestione Personale', en: 'People Management' },
                keywords: ['mitarbeiterführung', 'people management', 'gestione personale', 'coaching', 'feedback', 'entwicklung', 'development', 'sviluppo', 'empower', 'delegation'],
                desc: { de: 'Coaching, regelmäßiges Feedback, Entwicklung fördern, Empowerment durch Delegation.', it: 'Coaching, feedback regolare, promuovere lo sviluppo, empowerment attraverso la delega.', en: 'Coaching, regular feedback, fostering development, empowerment through delegation.' }},
              { id: 'l2', key: 'strat', name: { de: 'Strategisches Denken', it: 'Pensiero Strategico', en: 'Strategic Thinking' },
                keywords: ['strateg', 'big picture', 'langfrist', 'long-term', 'lungo termine', 'trend', 'vision', 'zukunft', 'future', 'futuro'],
                desc: { de: 'Big Picture verstehen, langfristige Planung, Trends erkennen und antizipieren.', it: 'Capire il Big Picture, pianificazione a lungo termine, riconoscere e anticipare i trend.', en: 'Understanding the Big Picture, long-term planning, recognizing and anticipating trends.' }},
              { id: 'l3', key: 'decide', name: { de: 'Entscheidungsfähigkeit', it: 'Capacità Decisionale', en: 'Decision Making' },
                keywords: ['entscheid', 'decision', 'decis', 'mut', 'courage', 'coraggio', 'risiko', 'risk', 'rischio', 'geschwindigkeit', 'speed'],
                desc: { de: 'Mut (Courage), schnelle Entscheidungen, kalkuliertes Risiko-Management.', it: 'Coraggio, decisioni rapide, gestione calcolata del rischio.', en: 'Courage, quick decisions, calculated risk management.' }},
              { id: 'l4', key: 'exec', name: { de: 'Execution', it: 'Execution', en: 'Execution' },
                keywords: ['execution', 'umsetz', 'implement', 'kpi', 'performance', 'ergebnis', 'result', 'risultato', 'deliver'],
                desc: { de: 'KPIs definieren und tracken, konsequente Umsetzung, Performance-Kultur etablieren.', it: 'Definire e tracciare KPI, implementazione coerente, stabilire una cultura della performance.', en: 'Defining and tracking KPIs, consistent implementation, establishing performance culture.' }},
              { id: 'l5', key: 'stake', name: { de: 'Stakeholder-Management', it: 'Gestione Stakeholder', en: 'Stakeholder Management' },
                keywords: ['stakeholder', 'konflikt', 'conflict', 'conflitto', 'netzwerk', 'network', 'rete', 'diplomat', 'verhandl', 'negotiat', 'negozia'],
                desc: { de: 'Konfliktlösung, Netzwerke aufbauen und pflegen, diplomatisches Geschick.', it: 'Risoluzione dei conflitti, costruire e mantenere reti, abilità diplomatica.', en: 'Conflict resolution, building and maintaining networks, diplomatic skills.' }}
            ]
          },
          
          // E. Kalibrierung & Archetypen (mit psychologisch fundierten Führungsempfehlungen)
          calibration: {
            archetypes: {
              roleModel: { 
                name: { de: 'Role Model', it: 'Role Model', en: 'Role Model' }, 
                desc: { 
                  de: 'High WAS + High WIE. Vorbild & Leistungsträger. → Karriereperspektive klären, als Mentor einsetzen, Retention sichern!', 
                  it: 'High COSA + High COME. Modello & top performer. → Chiarire prospettive, usare come mentor, assicurare retention!', 
                  en: 'High WHAT + High HOW. Role model & top performer. → Clarify career path, deploy as mentor, secure retention!' 
                }
              },
              hiddenGem: { 
                name: { de: 'Hidden Gem', it: 'Hidden Gem', en: 'Hidden Gem' }, 
                desc: { 
                  de: 'Low WAS + High WIE. Tolles Verhalten, Ziele unklar. → SMART-Ziele setzen, Quick Wins ermöglichen, Selbstwirksamkeit stärken!', 
                  it: 'Low COSA + High COME. Ottimo comportamento, obiettivi poco chiari. → Obiettivi SMART, quick wins, rafforzare autoefficacia!', 
                  en: 'Low WHAT + High HOW. Great behavior, unclear goals. → Set SMART goals, enable quick wins, boost self-efficacy!' 
                }
              },
              soloStar: { 
                name: { de: 'Solo Star', it: 'Solo Star', en: 'Solo Star' }, 
                desc: { 
                  de: 'High WAS + Low WIE. Ergebnisse top, Verhalten kritisch. → Feedback zu Wirkung geben, Konsequenzen aufzeigen, Verhaltenscoaching!', 
                  it: 'High COSA + Low COME. Risultati top, comportamento critico. → Feedback su impatto, mostrare conseguenze, coaching comportamentale!', 
                  en: 'High WHAT + Low HOW. Top results, critical behavior. → Feedback on impact, show consequences, behavioral coaching!' 
                }
              },
              actionRequired: { 
                name: { de: 'Handlungsbedarf', it: 'Azione Richiesta', en: 'Action Required' }, 
                desc: { 
                  de: 'Low WAS + Low WIE. → Ursache klären (Können/Wollen/Dürfen), 90-Tage-Plan, wöchentliche Check-ins, Rollenpassung prüfen.', 
                  it: 'Low COSA + Low COME. → Chiarire causa (capacità/volontà/contesto), piano 90 giorni, check-in settimanali, verificare ruolo.', 
                  en: 'Low WHAT + Low HOW. → Clarify root cause (skill/will/context), 90-day plan, weekly check-ins, review role fit.' 
                }
              },
              solidBackbone: { 
                name: { de: 'Solid Backbone', it: 'Solid Backbone', en: 'Solid Backbone' }, 
                desc: { 
                  de: 'Rating 3 – das Rückgrat! → Wertschätzung zeigen, nicht nur "Stars" loben. Stabilität anerkennen, individuelle Stärken nutzen.', 
                  it: 'Rating 3 – la spina dorsale! → Mostrare apprezzamento, non solo le "star". Riconoscere stabilità, usare punti di forza.', 
                  en: 'Rating 3 – the backbone! → Show appreciation, not just "stars". Recognize stability, leverage individual strengths.' 
                }
              }
            },
            killerCriteria: {
              de: 'Killer Criteria Warnung: Wenn GPS > 2.5, aber "Kommunikation" ODER "Mitarbeiterführung" auf Level 1 bewertet wurde. Diese Kompetenzen sind kulturkritisch!',
              it: 'Avviso Killer Criteria: Se GPS > 2.5, ma "Comunicazione" O "Gestione Personale" è valutata al livello 1. Queste competenze sono critiche per la cultura!',
              en: 'Killer Criteria Warning: If GPS > 2.5, but "Communication" OR "People Management" is rated at level 1. These competencies are culture-critical!'
            }
          }
        };
        
        // === WORKFLOW ANSWERS - Deep App Knowledge ===
        const WORKFLOW_ANSWERS = {
          selfReflection: {
            de: {
              title: '📝 Selbstreflexion starten',
              text: `**So funktioniert's:**

1. Gehe zu **"Mein Team"** in der Navigation
2. Klicke beim Mitarbeiter auf **"🔗 Selbstreflexions-Link erstellen"**
3. Der Link wird automatisch in die Zwischenablage kopiert
4. Sende den Link per E-Mail oder Teams an den MA

**Erinnerung senden:**
• Klicke auf den **"Erinnern"**-Button beim eingeladenen MA
• Der Link wird erneut kopiert – sende ihn nochmals

**Wichtig:**
• Der MA kann den Link **ohne Login** öffnen
• Er sieht NUR seine eigene Selbsteinschätzung
• Die Ergebnisse erscheinen automatisch in deiner Bewertung`
            },
            it: {
              title: '📝 Avviare autovalutazione',
              text: `**Come funziona:**

1. Vai a **"Il mio Team"** nella navigazione
2. Clicca su **"🔗 Crea link autovalutazione"** per il collaboratore
3. Il link viene copiato automaticamente negli appunti
4. Invia il link via email o Teams al collaboratore

**Inviare promemoria:**
• Clicca sul pulsante **"Ricorda"** per il collaboratore invitato
• Il link viene ricopiato – invialo di nuovo

**Importante:**
• Il collaboratore può aprire il link **senza login**
• Vede SOLO la sua autovalutazione
• I risultati appaiono automaticamente nella tua valutazione`
            },
            en: {
              title: '📝 Start Self-Reflection',
              text: `**How it works:**

1. Go to **"My Team"** in the navigation
2. Click **"🔗 Create self-reflection link"** for the employee
3. The link is automatically copied to clipboard
4. Send the link via email or Teams to the employee

**Send reminder:**
• Click the **"Remind"** button for the invited employee
• The link is copied again – send it once more

**Important:**
• The employee can open the link **without login**
• They see ONLY their self-assessment
• Results automatically appear in your appraisal

💡 If an email is on file, you can also use the 📧 button.`
            }
          },
          
          saveDraftVsComplete: {
            de: {
              title: '💾 Entwurf vs. Abschließen',
              text: `**"Als Entwurf speichern" (💾):**
• Speichert den aktuellen Stand
• Bleibt **editierbar**
• GPS wird vorläufig berechnet
• Ideal für mehrtägige Bewertungen

**"Bewertung abschließen" (✅):**
• **Fixiert** die Bewertung endgültig
• Berechnet den finalen GPS-Score
• Danach ist **keine Änderung** mehr möglich
• Wird in HR-Reports aufgenommen

⚠️ Erst abschließen, wenn das Feedbackgespräch geführt wurde!`
            },
            it: {
              title: '💾 Bozza vs. Completare',
              text: `**"Salva come bozza" (💾):**
• Salva lo stato attuale
• Rimane **modificabile**
• GPS calcolato provvisoriamente
• Ideale per valutazioni su più giorni

**"Completa valutazione" (✅):**
• **Fissa** la valutazione definitivamente
• Calcola il GPS finale
• Dopo **non è più modificabile**
• Viene inclusa nei report HR

⚠️ Completa solo dopo il colloquio di feedback!`
            },
            en: {
              title: '💾 Draft vs. Complete',
              text: `**"Save as Draft" (💾):**
• Saves current progress
• Remains **editable**
• GPS calculated provisionally
• Ideal for multi-day evaluations

**"Complete Appraisal" (✅):**
• **Locks** the appraisal permanently
• Calculates final GPS score
• **No changes** possible afterwards
• Included in HR reports

⚠️ Only complete after the feedback conversation!`
            }
          },
          
          excelExport: {
            de: {
              title: '📊 Excel Export',
              text: `**So exportierst du alle Daten:**

1. Gehe zum **HR Dashboard** (nur für HR-Admins)
2. Klicke auf **"📊 Excel Export"**
3. Eine CSV-Datei wird heruntergeladen

**Enthaltene Daten:**
• Alle Mitarbeiter mit GPS, WAS, WIE Scores
• Einzelne Kompetenz-Scores (C1-C5, L1-L5)
• Freitexte: Stärken, Karriere-Kommentar, Wünsche
• Feedback an FK
• Status (Entwurf/Fertig) und Zeitstempel

💡 Die CSV öffnet sich direkt in Excel mit korrekten Umlauten.`
            },
            it: {
              title: '📊 Export Excel',
              text: `**Come esportare tutti i dati:**

1. Vai alla **Dashboard HR** (solo per admin HR)
2. Clicca su **"📊 Esporta Excel"**
3. Viene scaricato un file CSV

**Dati inclusi:**
• Tutti i collaboratori con GPS, COSA, COME Scores
• Singoli punteggi competenze (C1-C5, L1-L5)
• Testi liberi: Punti di forza, Commento carriera, Desideri
• Feedback al responsabile
• Stato (Bozza/Completato) e timestamp

💡 Il CSV si apre direttamente in Excel con caratteri corretti.`
            },
            en: {
              title: '📊 Excel Export',
              text: `**How to export all data:**

1. Go to **HR Dashboard** (HR admins only)
2. Click **"📊 Excel Export"**
3. A CSV file will download

**Included data:**
• All employees with GPS, WHAT, HOW scores
• Individual competency scores (C1-C5, L1-L5)
• Free text: Strengths, Career comment, Wishes
• Feedback to manager
• Status (Draft/Complete) and timestamps

💡 The CSV opens directly in Excel with correct characters.`
            }
          },
          
          statusColors: {
            de: {
              title: '🚦 Status-Farben erklärt',
              text: `**In der Team-Übersicht:**

🟢 **Grün** = Bewertung abgeschlossen
🟡 **Gelb** = Entwurf vorhanden (in Arbeit)
⚪ **Grau** = Noch keine Bewertung gestartet

**In der Kalibrierung (9-Box):**

🟢 **Grüne Bubble** = Rating 4-5 (Top Performer)
🔵 **Blaue gestrichelte Zone** = Solid Backbone (Rating 3)
🟠 **Orange Bubble** = Rating 2 (Entwicklungsbedarf)
🔴 **Rote Bubble** = Rating 1 (Handlungsbedarf)

💡 Bubble-Größe = GPS-Score (größer = höher)`
            },
            it: {
              title: '🚦 Colori di stato spiegati',
              text: `**Nella panoramica team:**

🟢 **Verde** = Valutazione completata
🟡 **Giallo** = Bozza presente (in corso)
⚪ **Grigio** = Nessuna valutazione iniziata

**Nella calibrazione (9-Box):**

🟢 **Bolla verde** = Rating 4-5 (Top Performer)
🔵 **Zona tratteggiata blu** = Solid Backbone (Rating 3)
🟠 **Bolla arancione** = Rating 2 (Da sviluppare)
🔴 **Bolla rossa** = Rating 1 (Azione richiesta)

💡 Dimensione bolla = GPS Score (più grande = più alto)`
            },
            en: {
              title: '🚦 Status Colors Explained',
              text: `**In team overview:**

🟢 **Green** = Appraisal completed
🟡 **Yellow** = Draft exists (in progress)
⚪ **Gray** = No appraisal started yet

**In calibration (9-Box):**

🟢 **Green bubble** = Rating 4-5 (Top Performer)
🔵 **Blue dashed zone** = Solid Backbone (Rating 3)
🟠 **Orange bubble** = Rating 2 (Development needed)
🔴 **Red bubble** = Rating 1 (Action required)

💡 Bubble size = GPS score (larger = higher)`
            }
          },
          
          barsLevels: {
            de: {
              title: '📏 BARS-Level erklärt',
              text: `**Die 5 Bewertungsstufen:**

**Level 1** ❌ Ungenügend
Grundanforderungen nicht erfüllt

**Level 2** ⚠️ Verbesserungswürdig  
Routine ok, bei Spezialfällen Probleme

**Level 3** ✅ Erfüllt Erwartungen (BASELINE)
Konstant gute Leistung - DAS IST DER STANDARD!

**Level 4** ⭐ Übertrifft Erwartungen
Proaktiv, "Go-to-Person" im Team

**Level 5** 🏆 Herausragend
Gruppenweiter Impact, Rollenmodell

💡 Level 3 ist KEINE schlechte Bewertung - es ist die Baseline!`
            },
            it: {
              title: '📏 Livelli BARS spiegati',
              text: `**I 5 livelli di valutazione:**

**Livello 1** ❌ Insufficiente
Requisiti base non soddisfatti

**Livello 2** ⚠️ Da migliorare
Routine ok, problemi con casi speciali

**Livello 3** ✅ Soddisfa le aspettative (BASELINE)
Performance costante - QUESTO È LO STANDARD!

**Livello 4** ⭐ Supera le aspettative
Proattivo, "Go-to-Person" nel team

**Livello 5** 🏆 Eccellente
Impatto di gruppo, Role Model

💡 Livello 3 NON è una valutazione negativa - è la baseline!`
            },
            en: {
              title: '📏 BARS Levels Explained',
              text: `**The 5 rating levels:**

**Level 1** ❌ Unsatisfactory
Basic requirements not met

**Level 2** ⚠️ Needs Improvement
Routine ok, problems with special cases

**Level 3** ✅ Meets Expectations (BASELINE)
Consistent good performance - THIS IS THE STANDARD!

**Level 4** ⭐ Exceeds Expectations
Proactive, "Go-to-Person" in team

**Level 5** 🏆 Outstanding
Group-wide impact, Role Model

💡 Level 3 is NOT a bad rating - it's the baseline!`
            }
          },
          
          nineBox: {
            de: {
              title: '📊 9-Box Grid erklärt',
              text: `**Das Bubble Chart zeigt 4 Quadranten:**

**Oben rechts** ⭐ Role Model
High WAS + High WIE
→ Befördern, als Mentor einsetzen

**Oben links** 💎 Hidden Gem  
Low WAS + High WIE
→ Klarere Ziele setzen

**Unten rechts** 🎯 Solo Star
High WAS + Low WIE
→ Verhaltens-Coaching

**Unten links** 🚨 Handlungsbedarf
Low WAS + Low WIE
→ PIP oder Rollenpassung prüfen

**Mitte (gestrichelt)** 🔵 Solid Backbone
Das stabile Rückgrat - Wertschätzung zeigen!`
            },
            it: {
              title: '📊 9-Box Grid spiegato',
              text: `**Il Bubble Chart mostra 4 quadranti:**

**In alto a destra** ⭐ Role Model
High COSA + High COME
→ Promuovere, usare come mentore

**In alto a sinistra** 💎 Hidden Gem
Low COSA + High COME
→ Obiettivi più chiari

**In basso a destra** 🎯 Solo Star
High COSA + Low COME
→ Coaching comportamentale

**In basso a sinistra** 🚨 Azione richiesta
Low COSA + Low COME
→ PIP o verificare ruolo

**Centro (tratteggiato)** 🔵 Solid Backbone
Spina dorsale stabile - Mostrare apprezzamento!`
            },
            en: {
              title: '📊 9-Box Grid Explained',
              text: `**The Bubble Chart shows 4 quadrants:**

**Top right** ⭐ Role Model
High WHAT + High HOW
→ Promote, use as mentor

**Top left** 💎 Hidden Gem
Low WHAT + High HOW
→ Set clearer goals

**Bottom right** 🎯 Solo Star
High WHAT + Low HOW
→ Behavioral coaching

**Bottom left** 🚨 Action Required
Low WHAT + Low HOW
→ PIP or review role fit

**Center (dashed)** 🔵 Solid Backbone
Stable backbone - Show appreciation!`
            }
          },
          
          smartGoals: {
            de: {
              title: '🎯 SMART Ziele',
              text: `**Gute Ziele sind SMART:**

**S**pezifisch
Was genau soll erreicht werden?

**M**essbar  
Wie wird Erfolg gemessen? (KPI, %)

**A**ttraktiv
Ist das Ziel motivierend?

**R**ealistisch
Ist es erreichbar mit den Ressourcen?

**T**erminiert
Bis wann? (Deadline)

**Beispiel:**
❌ "Umsatz steigern"
✅ "Umsatz in Q2 um 10% steigern durch 5 Neukunden"`
            },
            it: {
              title: '🎯 Obiettivi SMART',
              text: `**Buoni obiettivi sono SMART:**

**S**pecifico
Cosa deve essere raggiunto esattamente?

**M**isurabile
Come viene misurato il successo? (KPI, %)

**A**ccettabile
L'obiettivo è motivante?

**R**ealistico
È raggiungibile con le risorse?

**T**emporizzato
Entro quando? (Scadenza)

**Esempio:**
❌ "Aumentare il fatturato"
✅ "Aumentare il fatturato del 10% in Q2 con 5 nuovi clienti"`
            },
            en: {
              title: '🎯 SMART Goals',
              text: `**Good goals are SMART:**

**S**pecific
What exactly should be achieved?

**M**easurable
How is success measured? (KPI, %)

**A**chievable
Is the goal motivating?

**R**ealistic
Is it achievable with resources?

**T**ime-bound
By when? (Deadline)

**Example:**
❌ "Increase sales"
✅ "Increase Q2 sales by 10% through 5 new customers"`
            }
          },
          
          goalWeighting: {
            de: {
              title: '⚖️ Ziel-Gewichtung',
              text: `**So funktioniert die Gewichtung:**

• Jedes Ziel erhält eine Gewichtung (%)
• Alle Gewichtungen müssen **100%** ergeben
• Die Zielerreichung wird gewichtet verrechnet

**Beispiel:**
Ziel 1: 50% Gewichtung, 120% erreicht → 60 Punkte
Ziel 2: 30% Gewichtung, 100% erreicht → 30 Punkte  
Ziel 3: 20% Gewichtung, 80% erreicht → 16 Punkte
**Gesamt: 106%** → Score 3-4

💡 Wichtigere Ziele höher gewichten!`
            },
            it: {
              title: '⚖️ Ponderazione obiettivi',
              text: `**Come funziona la ponderazione:**

• Ogni obiettivo riceve una ponderazione (%)
• Tutte le ponderazioni devono sommare a **100%**
• Il raggiungimento viene calcolato ponderato

**Esempio:**
Obiettivo 1: 50% peso, 120% raggiunto → 60 punti
Obiettivo 2: 30% peso, 100% raggiunto → 30 punti
Obiettivo 3: 20% peso, 80% raggiunto → 16 punti
**Totale: 106%** → Score 3-4

💡 Ponderare di più gli obiettivi più importanti!`
            },
            en: {
              title: '⚖️ Goal Weighting',
              text: `**How weighting works:**

• Each goal gets a weight (%)
• All weights must total **100%**
• Achievement is calculated weighted

**Example:**
Goal 1: 50% weight, 120% achieved → 60 points
Goal 2: 30% weight, 100% achieved → 30 points
Goal 3: 20% weight, 80% achieved → 16 points
**Total: 106%** → Score 3-4

💡 Weight more important goals higher!`
            }
          }
        };
        
        // === SUGGESTED CHIPS per View ===
        const VIEW_CHIPS = {
          team: [
            { de: '🔗 Link generieren?', it: '🔗 Generare link?', en: '🔗 Generate link?', query: 'selbstreflexion link' },
            { de: '➕ Neuer MA', it: '➕ Nuovo collab.', en: '➕ New employee', query: 'mitarbeiter anlegen' },
            { de: '🚦 Status Farben', it: '🚦 Colori stato', en: '🚦 Status colors', query: 'status farben' }
          ],
          zielvereinbarung: [
            { de: '🎯 SMART Ziele', it: '🎯 Obiettivi SMART', en: '🎯 SMART Goals', query: 'smart ziele' },
            { de: '⚖️ Gewichtung', it: '⚖️ Ponderazione', en: '⚖️ Weighting', query: 'gewichtung' },
            { de: '💰 Bonus?', it: '💰 Bonus?', en: '💰 Bonus?', query: 'bonus gehalt' }
          ],
          teamcalibration: [
            { de: '📊 4 Quadranten', it: '📊 4 Quadranti', en: '📊 4 Quadrants', query: '9 box grid' },
            { de: '🔵 Solid Backbone', it: '🔵 Solid Backbone', en: '🔵 Solid Backbone', query: 'solid backbone' },
            { de: '⚠️ Warnungen?', it: '⚠️ Avvisi?', en: '⚠️ Warnings?', query: 'killer criteria' }
          ],
          formular: [
            { de: '📏 BARS Level', it: '📏 Livelli BARS', en: '📏 BARS Levels', query: 'bars level' },
            { de: '💾 Entwurf?', it: '💾 Bozza?', en: '💾 Draft?', query: 'entwurf speichern' },
            { de: '📊 GPS Formel', it: '📊 Formula GPS', en: '📊 GPS Formula', query: 'gps formel' }
          ],
          dashboard: [
            { de: '🚀 Schnellstart', it: '🚀 Avvio rapido', en: '🚀 Quick start', query: 'wie starte ich' },
            { de: '📊 GPS erklärt', it: '📊 GPS spiegato', en: '📊 GPS explained', query: 'gps' },
            { de: '🎯 Kompetenzen', it: '🎯 Competenze', en: '🎯 Competencies', query: 'kompetenzen übersicht' }
          ],
          hrdashboard: [
            { de: '📊 Excel Export', it: '📊 Export Excel', en: '📊 Excel Export', query: 'excel export' },
            { de: '📈 Kalibrierung', it: '📈 Calibrazione', en: '📈 Calibration', query: 'kalibrierung' },
            { de: '⚠️ Killer Criteria', it: '⚠️ Killer Criteria', en: '⚠️ Killer Criteria', query: 'killer criteria' }
          ]
        };
        
        function HelpChat({ lang, setActiveView, activeView, setSelectedCompetencyId }) {
          const [isOpen, setIsOpen] = useState(false);
          const [messages, setMessages] = useState([]);
          const [inputValue, setInputValue] = useState('');
          const [isTyping, setIsTyping] = useState(false);
          const messagesEndRef = React.useRef(null);
          
          // Scroll to bottom when new messages arrive
          React.useEffect(() => {
            if (messagesEndRef.current) {
              messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
            }
          }, [messages]);
          
          // Kontextsensitive Willkommensnachricht
          const getWelcomeMessage = () => {
            const contextMsg = {
              team: { de: 'Du bist im Team-Bereich. Brauchst du Hilfe beim Einladen oder Link erstellen?', it: 'Sei nella sezione team. Hai bisogno di aiuto per invitare o creare link?', en: 'You\'re in the team section. Need help inviting or creating links?' },
              formular: { de: 'Du füllst gerade eine Bewertung aus. Frag mich zu den BARS-Leveln!', it: 'Stai compilando una valutazione. Chiedimi dei livelli BARS!', en: 'You\'re filling out an appraisal. Ask me about BARS levels!' },
              teamcalibration: { de: 'Willkommen zur Kalibrierung! Ich erkläre dir gerne das 9-Box Grid.', it: 'Benvenuto alla calibrazione! Ti spiego volentieri il 9-Box Grid.', en: 'Welcome to calibration! I\'ll gladly explain the 9-Box Grid.' },
              zielvereinbarung: { de: 'Du bist bei den Zielen. Soll ich SMART erklären?', it: 'Sei negli obiettivi. Devo spiegare SMART?', en: 'You\'re in goals. Shall I explain SMART?' },
              hrdashboard: { de: 'Du bist im HR Dashboard. Ich kann dir beim Export helfen!', it: 'Sei nella Dashboard HR. Posso aiutarti con l\'export!', en: 'You\'re in the HR Dashboard. I can help with exports!' }
            };
            
            const context = contextMsg[activeView];
            const baseMsg = {
              de: '👋 Hallo! Ich bin dein HR-Copilot.\n\n',
              it: '👋 Ciao! Sono il tuo HR-Copilot.\n\n',
              en: '👋 Hello! I\'m your HR Copilot.\n\n'
            };
            
            if (context) {
              return baseMsg[lang] + context[lang];
            }
            
            return baseMsg[lang] + (lang === 'de' 
              ? 'Ich kenne die App in- und auswendig. Frag mich zu:\n• Workflows (Selbstreflexion, Speichern)\n• GPS-Berechnung & BARS-Level\n• Kompetenzen & Archetypen'
              : lang === 'it' ? 'Conosco l\'app a fondo. Chiedimi di:\n• Workflow (Autovalutazione, Salvare)\n• Calcolo GPS & Livelli BARS\n• Competenze & Archetipi'
              : 'I know the app inside out. Ask me about:\n• Workflows (Self-reflection, Saving)\n• GPS calculation & BARS levels\n• Competencies & Archetypes');
          };
          
          // Initial welcome message
          React.useEffect(() => {
            if (isOpen && messages.length === 0) {
              setMessages([{ type: 'bot', text: getWelcomeMessage(), actions: getQuickActions() }]);
            }
          }, [isOpen, activeView]);
          
          // Reset chat
          const resetChat = () => {
            setMessages([{ type: 'bot', text: getWelcomeMessage(), actions: getQuickActions() }]);
          };
          
          // Quick Actions
          const getQuickActions = () => [
            { label: lang === 'de' ? '📊 GPS' : lang === 'it' ? '📊 GPS' : '📊 GPS', action: () => handleQuickAction('gps formel') },
            { label: lang === 'de' ? '📝 Workflow' : lang === 'it' ? '📝 Workflow' : '📝 Workflow', action: () => handleQuickAction('prozess workflow') },
            { label: lang === 'de' ? '🎯 Kompetenzen' : lang === 'it' ? '🎯 Competenze' : '🎯 Competencies', action: () => handleQuickAction('kompetenzen übersicht') }
          ];
          
          // Get chips for current view
          const getCurrentChips = () => {
            return VIEW_CHIPS[activeView] || VIEW_CHIPS.dashboard;
          };
          
          const handleQuickAction = (query) => {
            setInputValue('');
            const userMsg = { type: 'user', text: query };
            setMessages(prev => [...prev, userMsg]);
            setIsTyping(true);
            
            setTimeout(() => {
              const response = analyzeInput(query);
              setMessages(prev => [...prev, { type: 'bot', text: response.text, actions: response.actions }]);
              setIsTyping(false);
            }, 600);
          };
          
          // Smart Brain - Analyze input with Workflow Knowledge
          const analyzeInput = (text) => {
            const input = text.toLowerCase().trim();
            const KB = KNOWLEDGE_BASE;
            const WF = WORKFLOW_ANSWERS;
            
            // === WORKFLOW: SELBSTREFLEXION ===
            if (input.match(/selbstreflexion|self.?reflect|autovalutazione|link.*send|link.*erst|einlad|invit|mitarbeiter.*perspektive/)) {
              const ans = WF.selfReflection[lang] || WF.selfReflection.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? '👥 Zum Team' : lang === 'it' ? '👥 Vai al team' : '👥 Go to Team', action: () => { setActiveView('team'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: ENTWURF VS ABSCHLIESSEN ===
            if (input.match(/entwurf|draft|bozza|speicher.*unterschied|abschlie|complet|finaliz|status.*unterschied/)) {
              const ans = WF.saveDraftVsComplete[lang] || WF.saveDraftVsComplete.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === WORKFLOW: EXCEL EXPORT ===
            if (input.match(/excel|export|csv|download|herunterlad|scarica/)) {
              const ans = WF.excelExport[lang] || WF.excelExport.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? '📊 HR Dashboard' : lang === 'it' ? '📊 Dashboard HR' : '📊 HR Dashboard', action: () => { setActiveView('hrdashboard'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: STATUS FARBEN ===
            if (input.match(/status.*farb|color|colori|ampel|grün|gelb|rot|verde|giallo|rosso|green|yellow|red/)) {
              const ans = WF.statusColors[lang] || WF.statusColors.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === WORKFLOW: BARS LEVEL ===
            if (input.match(/bars|level|stufe|livello|bewertungsstufe|1-5|skala|scala|scale|baseline/)) {
              const ans = WF.barsLevels[lang] || WF.barsLevels.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === WORKFLOW: 9-BOX GRID ===
            if (input.match(/9.?box|nine.?box|quadrant|bubble.*chart|grid|verteilung|distribu/)) {
              const ans = WF.nineBox[lang] || WF.nineBox.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? '📊 Zur Kalibrierung' : lang === 'it' ? '📊 Vai alla calibrazione' : '📊 Go to Calibration', action: () => { setActiveView('teamcalibration'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: SMART ZIELE ===
            if (input.match(/smart|ziel.*setzen|obiettiv.*definir|goal.*set/)) {
              const ans = WF.smartGoals[lang] || WF.smartGoals.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? '📋 Zielvereinbarung' : lang === 'it' ? '📋 Obiettivi' : '📋 Goals', action: () => { setActiveView('zielvereinbarung'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: GEWICHTUNG ===
            if (input.match(/gewicht|weight|ponder|prozent.*ziel|percent.*goal/)) {
              const ans = WF.goalWeighting[lang] || WF.goalWeighting.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === HILFE / WAS KANNST DU ===
            if (input.match(/hilfe|help|aiuto|was kannst|cosa puoi|what can|was weißt|wie starte|come inizi|how.*start/)) {
              return {
                text: lang === 'de' 
                  ? `🧠 **Ich bin dein HR-Copilot!**\n\nIch kenne die App und alle Workflows:\n\n**📋 Prozesse:**\n• Selbstreflexion starten & Link senden\n• Entwurf vs. Abschließen\n• Excel Export\n\n**📊 Bewertung:**\n• GPS-Formel & Rating-Skala\n• BARS-Level (1-5)\n• Alle 10 Kompetenzen\n\n**📈 Kalibrierung:**\n• 9-Box Grid & 4 Archetypen\n• Killer Criteria\n• Status-Farben\n\n**⚡ Strategie:**\n• Strategie 2035\n• Werte: Fast, Fair, Personal`
                  : lang === 'it' ? `🧠 **Sono il tuo HR-Copilot!**\n\nConosco l'app e tutti i workflow:\n\n**📋 Processi:**\n• Avviare autovalutazione & inviare link\n• Bozza vs. Completare\n• Export Excel\n\n**📊 Valutazione:**\n• Formula GPS & Scala Rating\n• Livelli BARS (1-5)\n• Tutte le 10 competenze\n\n**📈 Calibrazione:**\n• 9-Box Grid & 4 Archetipi\n• Killer Criteria\n• Colori stato\n\n**⚡ Strategia:**\n• Strategia 2035\n• Valori: Fast, Fair, Personal`
                  : `🧠 **I'm your HR Copilot!**\n\nI know the app and all workflows:\n\n**📋 Processes:**\n• Start self-reflection & send link\n• Draft vs. Complete\n• Excel Export\n\n**📊 Evaluation:**\n• GPS formula & Rating scale\n• BARS levels (1-5)\n• All 10 competencies\n\n**📈 Calibration:**\n• 9-Box Grid & 4 Archetypes\n• Killer Criteria\n• Status colors\n\n**⚡ Strategy:**\n• Strategy 2035\n• Values: Fast, Fair, Personal`,
                actions: getQuickActions()
              };
            }
            
            // === KONTEXT-SENSITIVITÄT: Proaktive Tipps je nach View ===
            if (input.match(/tipp|tip|consiglio|wo bin ich|where am i|dove sono/)) {
              const contextTips = {
                team: { de: '👥 **Du bist im Team-Bereich**\n\nHier kannst du:\n• Mitarbeiter anlegen\n• Selbstreflexions-Links erstellen\n• Bewertungen starten\n\n💡 Tipp: Klicke auf "🔗" um einen Link zu generieren!', it: '👥 **Sei nella sezione team**\n\nQui puoi:\n• Creare collaboratori\n• Generare link autovalutazione\n• Avviare valutazioni\n\n💡 Suggerimento: Clicca "🔗" per generare un link!', en: '👥 **You\'re in the team section**\n\nHere you can:\n• Create employees\n• Generate self-reflection links\n• Start appraisals\n\n💡 Tip: Click "🔗" to generate a link!' },
                formular: { de: '📝 **Du füllst eine Bewertung aus**\n\n💡 Tipps:\n• Level 3 ist die Baseline (nicht schlecht!)\n• Nutze "Entwurf" für mehrtägige Bewertungen\n• Konkrete Beispiele in Freitexten nennen', it: '📝 **Stai compilando una valutazione**\n\n💡 Suggerimenti:\n• Livello 3 è la baseline (non negativo!)\n• Usa "Bozza" per valutazioni su più giorni\n• Cita esempi concreti nei testi liberi', en: '📝 **You\'re filling out an appraisal**\n\n💡 Tips:\n• Level 3 is the baseline (not bad!)\n• Use "Draft" for multi-day evaluations\n• Mention concrete examples in free text' },
                teamcalibration: { de: '📊 **Du bist in der Kalibrierung**\n\n💡 Tipps:\n• Achte auf "Killer Criteria" Warnungen\n• Solid Backbone (Rating 3) ist das Rückgrat\n• Nutze die Peer-Learning Matches!', it: '📊 **Sei nella calibrazione**\n\n💡 Suggerimenti:\n• Fai attenzione agli avvisi "Killer Criteria"\n• Solid Backbone (Rating 3) è la spina dorsale\n• Usa i match Peer-Learning!', en: '📊 **You\'re in calibration**\n\n💡 Tips:\n• Watch for "Killer Criteria" warnings\n• Solid Backbone (Rating 3) is the backbone\n• Use the Peer-Learning matches!' }
              };
              
              const tip = contextTips[activeView];
              if (tip) {
                return { text: tip[lang] || tip.de, actions: [] };
              }
            }
            
            // === BONUS / GEHALT ===
            if (input.match(/bonus|gehalt|salary|stipendio|vergütung|compensation|geld|money|soldi/)) {
              const g = KB.gps;
              const ratingsText = g.ratings.map(r => `• ${r.range}: **${r.name[lang] || r.name.de}** → ${r.consequence[lang] || r.consequence.de}`).join('\n');
              return {
                text: lang === 'de' 
                  ? `💰 **GPS → Vergütung**\n\nDer GPS-Score ist mit der variablen Vergütung verknüpft:\n\n${ratingsText}\n\n📌 Die genauen Beträge sind in der Compensation Policy definiert.`
                  : lang === 'it' ? `💰 **GPS → Compensazione**\n\nIl GPS Score è collegato alla retribuzione variabile:\n\n${ratingsText}\n\n📌 Gli importi esatti sono definiti nella Compensation Policy.`
                  : `💰 **GPS → Compensation**\n\nThe GPS score is linked to variable compensation:\n\n${ratingsText}\n\n📌 Exact amounts are defined in the Compensation Policy.`,
                actions: [{ label: lang === 'de' ? '📊 GPS Details' : lang === 'it' ? '📊 Dettagli GPS' : '📊 GPS Details', action: () => { setActiveView('gpsexplainer'); setIsOpen(false); }}]
              };
            }
            
            // === KILLER CRITERIA ===
            if (input.match(/killer|kritisch|critical|critico|warnung|warning|avviso|level 1|stufe 1/)) {
              return {
                text: lang === 'de' 
                  ? `⚠️ **Killer Criteria**\n\n${KB.calibration.killerCriteria.de}\n\n**Warum?**\nKommunikation und Führung sind kulturkritisch. Ein "Solo Star" mit Top-Ergebnissen aber toxischem Verhalten schadet dem Team.\n\n📌 Das System zeigt automatisch eine gelbe Warnung an.`
                  : lang === 'it' ? `⚠️ **Killer Criteria**\n\n${KB.calibration.killerCriteria.it}\n\n**Perché?**\nComunicazione e leadership sono critiche per la cultura. Un "Solo Star" con top risultati ma comportamento tossico danneggia il team.\n\n📌 Il sistema mostra automaticamente un avviso giallo.`
                  : `⚠️ **Killer Criteria**\n\n${KB.calibration.killerCriteria.en}\n\n**Why?**\nCommunication and leadership are culture-critical. A "Solo Star" with top results but toxic behavior harms the team.\n\n📌 The system automatically shows a yellow warning.`,
                actions: []
              };
            }
            
            // === GPS FORMEL ===
            if (input.match(/gps|berechnung|formel|calcolo|formula|calculation|score|50.*50|wie.*berechnet/)) {
              const g = KB.gps;
              return {
                text: lang === 'de' 
                  ? `📊 **GPS = Global Performance Score**\n\n**Formel:** ${g.formula.de}\n\n**Mitarbeiter:**\n${g.profiles.employee.de}\n\n**Führungskräfte:**\n${g.profiles.leader.de}\n\n💡 Beide Dimensionen (WAS + WIE) zählen je 50%!`
                  : lang === 'it' ? `📊 **GPS = Global Performance Score**\n\n**Formula:** ${g.formula.it}\n\n**Collaboratore:**\n${g.profiles.employee.it}\n\n**Manager:**\n${g.profiles.leader.it}\n\n💡 Entrambe le dimensioni (COSA + COME) contano 50% ciascuna!`
                  : `📊 **GPS = Global Performance Score**\n\n**Formula:** ${g.formula.en}\n\n**Employee:**\n${g.profiles.employee.en}\n\n**Manager:**\n${g.profiles.leader.en}\n\n💡 Both dimensions (WHAT + HOW) count 50% each!`,
                actions: [{ label: lang === 'de' ? '🔍 GPS Explainer' : lang === 'it' ? '🔍 GPS Explainer' : '🔍 GPS Explainer', action: () => { setActiveView('gpsexplainer'); setIsOpen(false); }}]
              };
            }
            
            // === STRATEGIE 2035 ===
            if (input.match(/strategie|strategy|strategia|2035|smartest|solution provider/)) {
              return {
                text: lang === 'de' 
                  ? `🚀 **${KB.strategy.name.de}**\n\n**Ziel:** "${KB.strategy.goal.de}"\n\n${KB.strategy.description.de}\n\nDie Strategie wird durch unsere Werte Fast, Fair, Personal gelebt.`
                  : lang === 'it' ? `🚀 **${KB.strategy.name.it}**\n\n**Obiettivo:** "${KB.strategy.goal.it}"\n\n${KB.strategy.description.it}\n\nLa strategia viene vissuta attraverso i nostri valori Fast, Fair, Personal.`
                  : `🚀 **${KB.strategy.name.en}**\n\n**Goal:** "${KB.strategy.goal.en}"\n\n${KB.strategy.description.en}\n\nThe strategy is lived through our values Fast, Fair, Personal.`,
                actions: [{ label: lang === 'de' ? '⚡ Werte' : lang === 'it' ? '⚡ Valori' : '⚡ Values', action: () => handleQuickAction('werte') }]
              };
            }
            
            // === WERTE ===
            if (input.match(/wert|value|valor|fast|fair|personal|kultur|culture/)) {
              const v = KB.values;
              return {
                text: lang === 'de' 
                  ? `⚡ **Unsere Werte**\n\n🏃 **${v.fast.de.name}**\n${v.fast.de.desc}\n\n⚖️ **${v.fair.de.name}**\n${v.fair.de.desc}\n\n💪 **${v.personal.de.name}**\n${v.personal.de.desc}`
                  : lang === 'it' ? `⚡ **I nostri valori**\n\n🏃 **${v.fast.it.name}**\n${v.fast.it.desc}\n\n⚖️ **${v.fair.it.name}**\n${v.fair.it.desc}\n\n💪 **${v.personal.it.name}**\n${v.personal.it.desc}`
                  : `⚡ **Our Values**\n\n🏃 **${v.fast.en.name}**\n${v.fast.en.desc}\n\n⚖️ **${v.fair.en.name}**\n${v.fair.en.desc}\n\n💪 **${v.personal.en.name}**\n${v.personal.en.desc}`,
                actions: []
              };
            }
            
            // === ARCHETYPEN ===
            if (input.match(/archetyp|archetype|archetipo|role model|hidden gem|solo star|handlungsbedarf|action required|solid backbone|backbone/)) {
              const arch = KB.calibration.archetypes;
              return {
                text: lang === 'de' 
                  ? `📈 **Die 4 Archetypen + Solid Backbone**\n\n⭐ **Role Model:** ${arch.roleModel.desc.de}\n\n💎 **Hidden Gem:** ${arch.hiddenGem.desc.de}\n\n🎯 **Solo Star:** ${arch.soloStar.desc.de}\n\n🚨 **Handlungsbedarf:** ${arch.actionRequired.desc.de}\n\n✅ **Solid Backbone:** ${arch.solidBackbone.desc.de}`
                  : lang === 'it' ? `📈 **I 4 Archetipi + Solid Backbone**\n\n⭐ **Role Model:** ${arch.roleModel.desc.it}\n\n💎 **Hidden Gem:** ${arch.hiddenGem.desc.it}\n\n🎯 **Solo Star:** ${arch.soloStar.desc.it}\n\n🚨 **Azione Richiesta:** ${arch.actionRequired.desc.it}\n\n✅ **Solid Backbone:** ${arch.solidBackbone.desc.it}`
                  : `📈 **The 4 Archetypes + Solid Backbone**\n\n⭐ **Role Model:** ${arch.roleModel.desc.en}\n\n💎 **Hidden Gem:** ${arch.hiddenGem.desc.en}\n\n🎯 **Solo Star:** ${arch.soloStar.desc.en}\n\n🚨 **Action Required:** ${arch.actionRequired.desc.en}\n\n✅ **Solid Backbone:** ${arch.solidBackbone.desc.en}`,
                actions: [{ label: lang === 'de' ? '📊 Kalibrierung' : lang === 'it' ? '📊 Calibrazione' : '📊 Calibration', action: () => { setActiveView('teamcalibration'); setIsOpen(false); }}]
              };
            }
            
            // === EINZELNE KOMPETENZEN ===
            const allComps = [...KB.competencies.core, ...KB.competencies.leadership];
            for (const comp of allComps) {
              if (comp.keywords.some(kw => input.includes(kw))) {
                const isLeadership = KB.competencies.leadership.includes(comp);
                return {
                  text: lang === 'de' 
                    ? `${isLeadership ? '👔' : '🎯'} **${comp.name.de}**\n${isLeadership ? '(Leadership-Kompetenz)' : '(Core-Kompetenz)'}\n\n${comp.desc.de}\n\n📌 Bewertung auf der BARS-Skala 1-5.`
                    : lang === 'it' ? `${isLeadership ? '👔' : '🎯'} **${comp.name.it}**\n${isLeadership ? '(Competenza Leadership)' : '(Competenza Core)'}\n\n${comp.desc.it}\n\n📌 Valutazione sulla scala BARS 1-5.`
                    : `${isLeadership ? '👔' : '🎯'} **${comp.name.en}**\n${isLeadership ? '(Leadership Competency)' : '(Core Competency)'}\n\n${comp.desc.en}\n\n📌 Evaluation on BARS scale 1-5.`,
                  actions: [{ 
                    label: lang === 'de' ? '🔍 Details' : lang === 'it' ? '🔍 Dettagli' : '🔍 Details', 
                    action: () => { if(setSelectedCompetencyId) setSelectedCompetencyId(comp.id); setActiveView('detail'); setIsOpen(false); }
                  }]
                };
              }
            }
            
            // === KOMPETENZEN ÜBERSICHT ===
            if (input.match(/kompetenz|competenc|abilit|skill|alle|tutt|all|übersicht|overview/)) {
              const coreNames = KB.competencies.core.map(c => c.name[lang] || c.name.de).join(', ');
              const leaderNames = KB.competencies.leadership.map(c => c.name[lang] || c.name.de).join(', ');
              return {
                text: lang === 'de' 
                  ? `📚 **Alle 10 Kompetenzen**\n\n🎯 **5 Core:**\n${coreNames}\n\n👔 **5 Leadership:**\n${leaderNames}\n\nFrag mich nach einer bestimmten Kompetenz!`
                  : lang === 'it' ? `📚 **Tutte le 10 Competenze**\n\n🎯 **5 Core:**\n${coreNames}\n\n👔 **5 Leadership:**\n${leaderNames}\n\nChiedimi di una competenza specifica!`
                  : `📚 **All 10 Competencies**\n\n🎯 **5 Core:**\n${coreNames}\n\n👔 **5 Leadership:**\n${leaderNames}\n\nAsk me about a specific competency!`,
                actions: [{ label: lang === 'de' ? '📋 Liste' : lang === 'it' ? '📋 Lista' : '📋 List', action: () => { setActiveView('list'); setIsOpen(false); }}]
              };
            }
            
            // === PROZESS / WORKFLOW ALLGEMEIN ===
            if (input.match(/prozess|workflow|ablauf|processo|flusso|wie.*funktioniert|come.*funziona|schritt|step/)) {
              return {
                text: lang === 'de' 
                  ? `⚙️ **Bewertungs-Workflow**\n\n**Der typische Ablauf:**\n\n1️⃣ **Team:** Mitarbeiter anlegen\n2️⃣ **Link:** Selbstreflexions-Link senden\n3️⃣ **Bewertung:** WAS + WIE bewerten\n4️⃣ **GPS:** Wird automatisch berechnet\n5️⃣ **Gespräch:** Feedbackgespräch führen\n6️⃣ **Abschluss:** Bewertung finalisieren\n\n💡 Frag mich zu einem Schritt für Details!`
                  : lang === 'it' ? `⚙️ **Workflow di valutazione**\n\n**Il flusso tipico:**\n\n1️⃣ **Team:** Creare collaboratore\n2️⃣ **Link:** Inviare link autovalutazione\n3️⃣ **Valutazione:** Valutare COSA + COME\n4️⃣ **GPS:** Calcolato automaticamente\n5️⃣ **Colloquio:** Condurre feedback\n6️⃣ **Conclusione:** Finalizzare\n\n💡 Chiedimi di un passo per dettagli!`
                  : `⚙️ **Appraisal Workflow**\n\n**The typical flow:**\n\n1️⃣ **Team:** Create employee\n2️⃣ **Link:** Send self-reflection link\n3️⃣ **Evaluation:** Evaluate WHAT + HOW\n4️⃣ **GPS:** Calculated automatically\n5️⃣ **Meeting:** Conduct feedback\n6️⃣ **Completion:** Finalize\n\n💡 Ask me about a step for details!`,
                actions: []
              };
            }
            
            // === MITARBEITER ANLEGEN ===
            if (input.match(/mitarbeiter.*anleg|collaborator.*crea|employee.*creat|neuer.*ma|nuovo.*collab|new.*employ/)) {
              return {
                text: lang === 'de' 
                  ? `➕ **Neuen Mitarbeiter anlegen**\n\n1. Gehe zu **"Mein Team"**\n2. Klicke auf **"➕ Mitarbeiter hinzufügen"**\n3. Fülle Name, Position, E-Mail aus\n4. Wähle: Führungskraft? (Ja/Nein)\n\n**Automatisch erstellt:**\n• Persönlicher Zugangs-Link\n• Selbstreflexions-Formular\n\n💡 E-Mail ist optional, ermöglicht aber automatische Einladung.`
                  : lang === 'it' ? `➕ **Creare nuovo collaboratore**\n\n1. Vai a **"Il mio Team"**\n2. Clicca su **"➕ Aggiungi collaboratore"**\n3. Compila Nome, Posizione, Email\n4. Scegli: Manager? (Sì/No)\n\n**Creato automaticamente:**\n• Link di accesso personale\n• Modulo autovalutazione\n\n💡 Email è opzionale, ma permette invito automatico.`
                  : `➕ **Create new employee**\n\n1. Go to **"My Team"**\n2. Click **"➕ Add employee"**\n3. Fill in Name, Position, Email\n4. Choose: Manager? (Yes/No)\n\n**Automatically created:**\n• Personal access link\n• Self-reflection form\n\n💡 Email is optional, but enables automatic invitation.`,
                actions: [{ label: lang === 'de' ? '👥 Zum Team' : lang === 'it' ? '👥 Vai al team' : '👥 Go to Team', action: () => { setActiveView('team'); setIsOpen(false); }}]
              };
            }
            
            // === FALLBACK ===
            return {
              text: lang === 'de' 
                ? `🤔 Dazu habe ich keine spezifische Antwort.\n\n**Versuch es mit:**\n• "Selbstreflexion starten"\n• "Entwurf vs. Abschließen"\n• "BARS Level erklärt"\n• "9-Box Grid"\n• Name einer Kompetenz\n\n💡 Oder tippe "Hilfe" für eine Übersicht!`
                : lang === 'it' ? `🤔 Non ho una risposta specifica.\n\n**Prova con:**\n• "Avviare autovalutazione"\n• "Bozza vs. Completare"\n• "Livelli BARS spiegati"\n• "9-Box Grid"\n• Nome di una competenza\n\n💡 Oppure scrivi "Aiuto" per una panoramica!`
                : `🤔 I don't have a specific answer for that.\n\n**Try:**\n• "Start self-reflection"\n• "Draft vs. Complete"\n• "BARS levels explained"\n• "9-Box Grid"\n• Name of a competency\n\n💡 Or type "Help" for an overview!`,
              actions: getQuickActions()
            };
          };
          
          // Handle send message
          const handleSend = () => {
            if (!inputValue.trim()) return;
            
            const userMsg = { type: 'user', text: inputValue };
            setMessages(prev => [...prev, userMsg]);
            setInputValue('');
            setIsTyping(true);
            
            setTimeout(() => {
              const response = analyzeInput(inputValue);
              setMessages(prev => [...prev, { type: 'bot', text: response.text, actions: response.actions }]);
              setIsTyping(false);
            }, 600);
          };
          
          const handleKeyPress = (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              handleSend();
            }
          };
          
          return React.createElement(React.Fragment, null,
            // Floating Action Button
            React.createElement('button', {
              onClick: () => setIsOpen(!isOpen),
              className: `fixed bottom-6 right-6 z-50 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all duration-300 ${isOpen ? 'bg-slate-600 rotate-90' : 'bg-[#243186] hover:bg-[#1a2563] hover:scale-110'}`,
              style: { boxShadow: '0 4px 20px rgba(36, 49, 134, 0.4)' }
            },
              isOpen 
                ? React.createElement(X, { size: 24, className: 'text-white' })
                : React.createElement(MessageCircle, { size: 24, className: 'text-white' })
            ),
            
            // Chat Window
            isOpen && React.createElement('div', {
              className: 'fixed bottom-24 right-6 z-50 w-80 md:w-96 bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden',
              style: { maxHeight: '75vh' }
            },
              // Header with Reset Button
              React.createElement('div', { 
                className: 'px-4 py-3 flex items-center gap-3',
                style: { background: 'linear-gradient(135deg, #243186 0%, #3b4cad 100%)' }
              },
                React.createElement('div', { className: 'w-10 h-10 rounded-full bg-white/20 flex items-center justify-center' },
                  React.createElement(Sparkles, { size: 20, className: 'text-white' })
                ),
                React.createElement('div', { className: 'flex-1' },
                  React.createElement('h3', { className: 'font-bold text-white text-sm' }, 
                    lang === 'de' ? 'HR-Copilot' : lang === 'it' ? 'HR-Copilot' : 'HR Copilot'
                  ),
                  React.createElement('p', { className: 'text-xs text-white/70' },
                    lang === 'de' ? 'Ich kenne die App!' : lang === 'it' ? 'Conosco l\'app!' : 'I know the app!'
                  )
                ),
                // Reset Button
                React.createElement('button', {
                  onClick: resetChat,
                  className: 'w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors',
                  title: lang === 'de' ? 'Chat zurücksetzen' : lang === 'it' ? 'Resetta chat' : 'Reset chat'
                },
                  React.createElement(RotateCcw, { size: 14, className: 'text-white' })
                ),
                // Close Button
                React.createElement('button', {
                  onClick: () => setIsOpen(false),
                  className: 'w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors'
                },
                  React.createElement(X, { size: 16, className: 'text-white' })
                )
              ),
              
              // Messages
              React.createElement('div', { 
                className: 'p-4 space-y-3 overflow-y-auto',
                style: { maxHeight: '320px', minHeight: '180px' }
              },
                ...messages.map((msg, idx) => 
                  React.createElement('div', { 
                    key: idx,
                    className: `flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`
                  },
                    React.createElement('div', { 
                      className: `max-w-[85%] rounded-2xl px-4 py-2.5 ${msg.type === 'user' ? 'bg-slate-100 text-slate-800 rounded-br-md' : 'bg-gradient-to-br from-[#243186] to-[#3b4cad] text-white rounded-bl-md'}`
                    },
                      React.createElement('p', { 
                        className: 'text-sm whitespace-pre-line',
                        style: { lineHeight: '1.5' }
                      }, msg.text),
                      msg.actions && msg.actions.length > 0 && React.createElement('div', { className: 'mt-2 flex flex-wrap gap-1.5' },
                        ...msg.actions.map((action, i) => 
                          React.createElement('button', {
                            key: i,
                            onClick: action.action,
                            className: `px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${msg.type === 'user' ? 'bg-slate-200 text-slate-700 hover:bg-slate-300' : 'bg-white/20 text-white hover:bg-white/30'}`
                          }, action.label)
                        )
                      )
                    )
                  )
                ),
                // Typing indicator
                isTyping && React.createElement('div', { className: 'flex justify-start' },
                  React.createElement('div', { className: 'bg-slate-100 rounded-2xl rounded-bl-md px-4 py-3' },
                    React.createElement('div', { className: 'flex gap-1' },
                      React.createElement('span', { className: 'w-2 h-2 bg-slate-400 rounded-full animate-bounce', style: { animationDelay: '0ms' } }),
                      React.createElement('span', { className: 'w-2 h-2 bg-slate-400 rounded-full animate-bounce', style: { animationDelay: '150ms' } }),
                      React.createElement('span', { className: 'w-2 h-2 bg-slate-400 rounded-full animate-bounce', style: { animationDelay: '300ms' } })
                    )
                  )
                ),
                React.createElement('div', { ref: messagesEndRef })
              ),
              
              // Suggested Chips (context-aware)
              React.createElement('div', { 
                className: 'px-3 py-2 border-t border-slate-100 bg-slate-50/50 overflow-x-auto flex gap-2',
                style: { scrollbarWidth: 'none', msOverflowStyle: 'none' }
              },
                ...getCurrentChips().map((chip, idx) =>
                  React.createElement('button', {
                    key: idx,
                    onClick: () => handleQuickAction(chip.query),
                    className: 'whitespace-nowrap px-3 py-1.5 rounded-full text-xs font-medium bg-white border border-slate-200 text-slate-600 hover:bg-slate-100 hover:border-slate-300 transition-colors'
                  }, chip[lang] || chip.de)
                )
              ),
              
              // Input
              React.createElement('div', { className: 'p-3 border-t border-slate-100 bg-white' },
                React.createElement('div', { className: 'flex gap-2' },
                  React.createElement('input', {
                    type: 'text',
                    value: inputValue,
                    onChange: (e) => setInputValue(e.target.value),
                    onKeyPress: handleKeyPress,
                    placeholder: lang === 'de' ? 'Frag mich...' : lang === 'it' ? 'Chiedimi...' : 'Ask me...',
                    className: 'flex-1 px-4 py-2.5 rounded-xl border border-slate-200 text-sm focus:outline-none focus:ring-2 focus:ring-[#243186]/30 focus:border-[#243186]'
                  }),
                  React.createElement('button', {
                    onClick: handleSend,
                    disabled: !inputValue.trim(),
                    className: 'w-10 h-10 rounded-xl bg-[#6EBD84] text-white flex items-center justify-center hover:bg-[#5da872] transition-colors disabled:opacity-50 disabled:cursor-not-allowed'
                  },
                    React.createElement(Send, { size: 18 })
                  )
                )
              )
            )
          );
        }

        function PerformanceApp() {
          const [activeView, setActiveView] = useState('dashboard');

          // === FIREBASE AUTH STATE ===
          const [user, setUser] = useState(null);
          const [authLoading, setAuthLoading] = useState(true);
          const [accessCodeChecking, setAccessCodeChecking] = useState(false); // NEU: Prüft ob AccessCode-Check läuft
          
          // === GUEST MODE STATE (für Selbstreflexion via Link) ===
          const [guestMode, setGuestMode] = useState(false);
          const [guestEmployee, setGuestEmployee] = useState(null);
          const [guestManagerId, setGuestManagerId] = useState(null); // userId der FK für Firestore-Zugriff
          
          // === BUBBLE CHART TOOLTIP STATE ===
          const [bubbleTooltip, setBubbleTooltip] = useState(null);
          
          // === TEAM CALIBRATION STATES ===
          const [calibrationSort, setCalibrationSort] = useState({ field: 'name', direction: 'asc' }); // Sortierung
          const [calibrationFilter, setCalibrationFilter] = useState('all'); // 'all', 'completed', 'draft'
          const [calibrationNotes, setCalibrationNotes] = useState({}); // { reviewId: 'Notiz...' }
          const [editingNoteId, setEditingNoteId] = useState(null); // ID der gerade bearbeiteten Notiz
          
          // === MIGRATION STATE ===
          const [migrationStatus, setMigrationStatus] = useState(null); // null, 'pending', 'done', 'error'
          const [migrationResult, setMigrationResult] = useState(null); // { members: X, appraisals: Y }
          
          // === EVENT LISTENER für View-Wechsel aus Kind-Komponenten ===
          useEffect(() => {
            const handleViewSelfAssessment = () => {
              setActiveView('viewSelfAssessment');
            };
            window.addEventListener('viewSelfAssessment', handleViewSelfAssessment);
            return () => window.removeEventListener('viewSelfAssessment', handleViewSelfAssessment);
          }, []);
          
          // === MIGRATION FUNCTION: localStorage → Firestore ===
          // Migriert alte lokale Daten in die Cloud beim ersten Login
          const migrateLocalDataToFirebase = async (currentUser) => {
            // Guard: Nur für echte User (nicht anonym), nur wenn DB verfügbar
            if (!currentUser || !db || currentUser.isAnonymous) {
              return { migrated: false, members: 0, appraisals: 0 };
            }
            
            // Check: Bereits migriert?
            const migrationKey = `nw_migrated_${currentUser.uid}`;
            if (localStorage.getItem(migrationKey)) {
              console.log('ℹ️ Migration bereits durchgeführt für User:', currentUser.uid);
              return { migrated: false, members: 0, appraisals: 0, reason: 'already_migrated' };
            }
            
            // Alte Daten laden
            const localMembersRaw = localStorage.getItem('nw_team_members');
            const localAppraisalsRaw = localStorage.getItem('nw_team_appraisals');
            
            const localMembers = localMembersRaw ? JSON.parse(localMembersRaw) : [];
            const localAppraisals = localAppraisalsRaw ? JSON.parse(localAppraisalsRaw) : [];
            
            // Keine Daten vorhanden?
            if (localMembers.length === 0 && localAppraisals.length === 0) {
              console.log('ℹ️ Keine lokalen Daten zum Migrieren gefunden.');
              localStorage.setItem(migrationKey, 'true');
              return { migrated: false, members: 0, appraisals: 0, reason: 'no_data' };
            }
            
            console.log('🔄 Starte Migration:', localMembers.length, 'Mitarbeiter,', localAppraisals.length, 'Bewertungen');
            setMigrationStatus('pending');
            
            try {
              // Hilfsfunktion: AccessCode generieren (gleiche Logik wie in addTeamMember)
              const generateMigrationAccessCode = () => {
                if (typeof crypto !== 'undefined' && crypto.randomUUID) {
                  return crypto.randomUUID();
                }
                // Sicherer Fallback mit crypto.getRandomValues
                if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
                  const array = new Uint8Array(16);
                  crypto.getRandomValues(array);
                  const hex = Array.from(array, b => b.toString(16).padStart(2, '0')).join('');
                  return `${hex.slice(0,8)}-${hex.slice(8,12)}-${hex.slice(12,16)}-${hex.slice(16,20)}-${hex.slice(20,32)}`;
                }
                // Letzter Fallback
                return 'xxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'.replace(/x/g, () => 
                  Math.floor(Math.random() * 16).toString(16)
                );
              };
              
              // Mapping: alte lokale ID → neue Firestore ID
              // Wichtig für die Verknüpfung von Appraisals mit Mitarbeitern
              const idMapping = {};
              
              let memberCount = 0;
              let appraisalCount = 0;
              
              // === SCHRITT 1: Mitarbeiter migrieren ===
              for (const member of localMembers) {
                try {
                  const oldId = member.id;
                  
                  // Neues Dokument mit allen erforderlichen Feldern
                  const newMemberData = {
                    userId: currentUser.uid,
                    name: member.name || 'Unbekannt',
                    position: member.position || '',
                    department: member.department || '',
                    accessCode: generateMigrationAccessCode(), // NEU: Für Selbstreflexions-Link
                    createdAt: member.createdAt || new Date().toISOString(),
                    migratedAt: new Date().toISOString(),
                    migratedFromLocal: true
                  };
                  
                  // In Firestore speichern
                  const docRef = await db.collection('teamMembers').add(newMemberData);
                  
                  // ID-Mapping speichern
                  idMapping[oldId] = docRef.id;
                  memberCount++;
                  
                  console.log(`  ✓ Mitarbeiter migriert: ${member.name} (${oldId} → ${docRef.id})`);
                } catch (memberError) {
                  console.error(`  ✗ Fehler bei Mitarbeiter ${member.name}:`, memberError);
                }
              }
              
              // === SCHRITT 2: Bewertungen/Appraisals migrieren ===
              for (const appraisal of localAppraisals) {
                try {
                  const oldEmployeeId = appraisal.employeeId;
                  const newEmployeeId = idMapping[oldEmployeeId] || oldEmployeeId;
                  
                  // Neues Dokument mit allen erforderlichen Feldern
                  const newAppraisalData = {
                    ...appraisal, // Alle bestehenden Daten übernehmen
                    userId: currentUser.uid,
                    employeeId: newEmployeeId, // Aktualisierte ID
                    type: appraisal.type || 'review', // Fallback für alte Daten ohne Typ
                    createdAt: appraisal.createdAt || new Date().toISOString(),
                    migratedAt: new Date().toISOString(),
                    migratedFromLocal: true
                  };
                  
                  // Alte lokale ID entfernen (Firestore generiert eigene)
                  delete newAppraisalData.id;
                  
                  // In Firestore speichern
                  await db.collection('teamAppraisals').add(newAppraisalData);
                  appraisalCount++;
                  
                  console.log(`  ✓ Bewertung migriert: ${appraisal.employeeName || 'Unbekannt'} (${appraisal.type || 'review'})`);
                } catch (appraisalError) {
                  console.error(`  ✗ Fehler bei Bewertung:`, appraisalError);
                }
              }
              
              // === SCHRITT 3: Aufräumen ===
              // Migration als abgeschlossen markieren (User-spezifisch)
              localStorage.setItem(migrationKey, 'true');
              
              // Alte Daten als Backup umbenennen (nicht löschen, zur Sicherheit)
              if (localMembersRaw) {
                localStorage.setItem('nw_team_members_backup', localMembersRaw);
                localStorage.removeItem('nw_team_members');
              }
              if (localAppraisalsRaw) {
                localStorage.setItem('nw_team_appraisals_backup', localAppraisalsRaw);
                localStorage.removeItem('nw_team_appraisals');
              }
              
              console.log('✅ Migration abgeschlossen:', memberCount, 'Mitarbeiter,', appraisalCount, 'Bewertungen');
              
              const result = { migrated: true, members: memberCount, appraisals: appraisalCount };
              setMigrationResult(result);
              setMigrationStatus('done');
              
              return result;
              
            } catch (error) {
              console.error('❌ Migration fehlgeschlagen:', error);
              setMigrationStatus('error');
              return { migrated: false, members: 0, appraisals: 0, error: error.message };
            }
          };
          
          // Auth State Listener (erweitert um Migration)
          // WICHTIG: Prüft zuerst ob ein accessCode in der URL ist
          React.useEffect(() => {
            if (!auth) {
              setAuthLoading(false);
              return;
            }
            
            // Prüfe ZUERST ob ein accessCode in der URL ist
            const params = new URLSearchParams(window.location.search);
            const hasAccessCode = params.get('accessCode');
            
            if (hasAccessCode) {
              // AccessCode vorhanden - setze Flag und warte auf checkAccessCode
              console.log('🔗 AccessCode in URL erkannt, warte auf Prüfung...');
              setAccessCodeChecking(true);
              // authLoading bleibt true bis checkAccessCode fertig ist
            }
            
            const unsubscribe = auth.onAuthStateChanged(async (currentUser) => {
              setUser(currentUser);
              
              // Migration beim ersten Login durchführen (nur für echte User)
              if (currentUser && !currentUser.isAnonymous && db) {
                try {
                  const result = await migrateLocalDataToFirebase(currentUser);
                  if (result.migrated && (result.members > 0 || result.appraisals > 0)) {
                    console.log('🎉 Daten erfolgreich migriert:', result);
                    // Benutzerfreundliche Erfolgsmeldung
                    setTimeout(() => {
                      const alertMsg = lang === 'en'
                        ? `✨ Welcome back!\n\nWe have successfully transferred your local data to the cloud:\n• ${result.members} employees\n• ${result.appraisals} appraisals\n\nYour data is now securely stored in Firebase and accessible from any device.`
                        : lang === 'it'
                          ? `✨ Bentornato!\n\nAbbiamo trasferito con successo i tuoi dati locali nel cloud:\n• ${result.members} collaboratori\n• ${result.appraisals} valutazioni\n\nI tuoi dati sono ora salvati in Firebase e accessibili da qualsiasi dispositivo.`
                          : `✨ Willkommen zurück!\n\nWir haben Ihre lokalen Daten erfolgreich in die Cloud übertragen:\n• ${result.members} Mitarbeiter\n• ${result.appraisals} Bewertungen\n\nIhre Daten sind jetzt sicher in Firebase gespeichert und von jedem Gerät abrufbar.`;
                      alert(alertMsg);
                    }, 500); // Kurze Verzögerung damit UI fertig geladen ist
                  }
                } catch (migrationError) {
                  console.error('Migration error:', migrationError);
                }
              }
              
              // WICHTIG: authLoading nur auf false setzen wenn KEIN accessCode-Check läuft
              // Wenn accessCode vorhanden, wird authLoading von checkAccessCode gesteuert
              if (!hasAccessCode) {
                setAuthLoading(false);
              }
            });
            return () => unsubscribe();
          }, [db]);
          
          // === ACCESS CODE CHECK (für Gast-Modus via Link) ===
          // WICHTIG: Auch eingeloggte User können Selbstreflexion ausfüllen (FK ist auch MA für seinen Vorgesetzten)
          React.useEffect(() => {
            const checkAccessCode = async () => {
              const params = new URLSearchParams(window.location.search);
              const code = params.get('accessCode');
              
              if (!code) {
                // Kein AccessCode - nichts zu tun
                return;
              }
              
              // Warte auf db und auth
              if (!db || !auth) {
                console.log('⏳ Warte auf Firebase...');
                return;
              }
              
              console.log('🔗 AccessCode Check startet:', code);
              
              // Hole aktuellen User direkt von Firebase Auth
              const currentUser = auth.currentUser;
              
              try {
                // Wenn KEIN User eingeloggt ist → Anonymen Login für Firestore-Zugriff
                if (!currentUser) {
                  console.log('🔐 Kein User eingeloggt, starte anonyme Authentifizierung...');
                  await auth.signInAnonymously();
                  console.log('✓ Anonymer Login erfolgreich');
                } else {
                  // User ist bereits eingeloggt (als FK oder anonym) - NICHT ausloggen!
                  console.log('✓ User bereits eingeloggt:', currentUser.email || 'Anonym');
                }
                
                // Firestore-Query um Mitarbeiter zu finden
                const snapshot = await db.collection('teamMembers')
                  .where('accessCode', '==', code)
                  .limit(1)
                  .get();
                
                if (snapshot.empty) {
                  console.log('❌ Kein Mitarbeiter mit diesem accessCode gefunden');
                  // Bei ungültigem Code: Nur anonymen User ausloggen
                  if (currentUser?.isAnonymous) {
                    await auth.signOut();
                  }
                  alert(lang === 'de' 
                    ? 'Ungültiger oder abgelaufener Link. Bitte wenden Sie sich an Ihre Führungskraft.' 
                    : lang === 'it'
                    ? 'Link non valido o scaduto. Contatta il tuo responsabile.'
                    : 'Invalid or expired link. Please contact your manager.');
                  // URL bereinigen
                  window.history.replaceState({}, document.title, window.location.pathname);
                  setAccessCodeChecking(false);
                  setAuthLoading(false);
                  return;
                }
                
                const employeeDoc = snapshot.docs[0];
                const employeeData = {
                  id: employeeDoc.id,
                  ...employeeDoc.data()
                };
                
                console.log('✓ Mitarbeiter gefunden:', employeeData.name);
                
                // Aktiviere Gast-Modus (funktioniert auch für eingeloggte User)
                // Der "Gast-Modus" bedeutet hier: Selbstreflexions-Ansicht
                setGuestMode(true);
                setGuestEmployee(employeeData);
                setGuestManagerId(employeeData.userId); // Die userId ist die des Managers
                setActiveView('guestWelcome');
                setAccessCodeChecking(false);
                setAuthLoading(false);
                
              } catch (error) {
                console.error('❌ Fehler beim Laden des Mitarbeiters:', error);
                // Bei Fehler: Nur anonymen User ausloggen
                if (auth.currentUser?.isAnonymous) {
                  try { await auth.signOut(); } catch (e) { /* ignore */ }
                }
                alert(lang === 'de' 
                  ? 'Fehler beim Laden. Bitte versuchen Sie es erneut.' 
                  : lang === 'it'
                  ? 'Errore di caricamento. Riprova.'
                  : 'Error loading. Please try again.');
                window.history.replaceState({}, document.title, window.location.pathname);
                setAccessCodeChecking(false);
                setAuthLoading(false);
              }
            };
            
            checkAccessCode();
          }, [db, auth]); // Nur einmal beim Start, wenn db und auth verfügbar
          
          // === TEAM STATES ===
          const [teamMembers, setTeamMembers] = useState([]);
          const [teamAppraisals, setTeamAppraisals] = useState([]);
          const [firestoreLoading, setFirestoreLoading] = useState(false);
          
          // === MEMOIZED CALIBRATION DATA (Performance-Optimierung) ===
          // Diese Berechnungen sind teuer und werden nur bei Änderungen der Abhängigkeiten neu berechnet
          const calibrationData = useMemo(() => {
            // Frühzeitiger Return wenn keine Daten
            if (!teamAppraisals || teamAppraisals.length === 0) {
              return { employeeData: [], teamAvg: null, allReviews: [], hasAnyLeadership: false, filteredReviews: [] };
            }
            
            const allReviews = teamAppraisals.filter(a => a.type === 'review' || !a.type);
            const hasAnyLeadership = allReviews.some(r => r.includeLeadership && r.leaderScores);
            
            // Filtere Reviews
            const filteredReviews = (() => {
              if (calibrationFilter === 'completed') return allReviews.filter(r => r.status === 'completed');
              if (calibrationFilter === 'draft') return allReviews.filter(r => r.status === 'draft' || !r.status);
              return allReviews;
            })();
            
            // Bereite Mitarbeiter-Daten auf (teure Operation)
            const employeeData = filteredReviews.map(review => {
              const member = teamMembers.find(m => m.id === review.employeeId);
              const name = review.employeeName || member?.name || 'Unknown';
              const wasScore = review.wasScore || 0;
              
              // Normalisiere Core Scores
              const rawCoreScores = review.coreScores || {};
              const coreKeys = Object.keys(rawCoreScores);
              const coreValues = Object.values(rawCoreScores).filter(v => typeof v === 'number' && v > 0);
              const isNumericKeys = coreKeys.length > 0 && coreKeys.every(k => !isNaN(parseFloat(k)));
              
              let coreScores;
              if (isNumericKeys && coreValues.length >= 5) {
                const sortedKeys = coreKeys.sort();
                coreScores = { fach: rawCoreScores[sortedKeys[0]] || 0, komm: rawCoreScores[sortedKeys[1]] || 0, prob: rawCoreScores[sortedKeys[2]] || 0, adapt: rawCoreScores[sortedKeys[3]] || 0, orga: rawCoreScores[sortedKeys[4]] || 0 };
              } else {
                coreScores = { fach: rawCoreScores.fach || rawCoreScores.c1 || 0, komm: rawCoreScores.komm || rawCoreScores.c2 || 0, prob: rawCoreScores.prob || rawCoreScores.c3 || 0, adapt: rawCoreScores.adapt || rawCoreScores.c4 || 0, orga: rawCoreScores.orga || rawCoreScores.c5 || 0 };
              }
              
              // Normalisiere Leader Scores
              const rawLeaderScores = review.leaderScores || {};
              const leaderKeys = Object.keys(rawLeaderScores);
              const leaderValues = Object.values(rawLeaderScores).filter(v => typeof v === 'number' && v > 0);
              const isNumericLeaderKeys = leaderKeys.length > 0 && leaderKeys.every(k => !isNaN(parseFloat(k)));
              
              let leaderScores;
              if (isNumericLeaderKeys && leaderValues.length >= 5) {
                const sortedKeys = leaderKeys.sort();
                leaderScores = { lead: rawLeaderScores[sortedKeys[0]] || 0, strat: rawLeaderScores[sortedKeys[1]] || 0, decide: rawLeaderScores[sortedKeys[2]] || 0, exec: rawLeaderScores[sortedKeys[3]] || 0, stake: rawLeaderScores[sortedKeys[4]] || 0 };
              } else {
                leaderScores = { lead: rawLeaderScores.lead || rawLeaderScores.l1 || 0, strat: rawLeaderScores.strat || rawLeaderScores.l2 || 0, decide: rawLeaderScores.decide || rawLeaderScores.l3 || 0, exec: rawLeaderScores.exec || rawLeaderScores.l4 || 0, stake: rawLeaderScores.stake || rawLeaderScores.l5 || 0 };
              }
              
              // WIE Durchschnitt
              const allWieScores = [...Object.values(coreScores).filter(v => v > 0), ...(review.includeLeadership ? Object.values(leaderScores).filter(v => v > 0) : [])];
              const wieAvg = allWieScores.length > 0 ? allWieScores.reduce((s, v) => s + v, 0) / allWieScores.length : 0;
              
              return { id: review.id, employeeId: review.employeeId, name, status: review.status, gps: review.gpsScore || 0, wasScore, wieAvg, coreScores, leaderScores, includeLeadership: review.includeLeadership };
            })
            // Sortierung
            .sort((a, b) => {
              let comparison = 0;
              switch (calibrationSort.field) {
                case 'name': comparison = a.name.localeCompare(b.name); break;
                case 'gps': comparison = a.gps - b.gps; break;
                case 'was': comparison = a.wasScore - b.wasScore; break;
                case 'wie': comparison = a.wieAvg - b.wieAvg; break;
                default: comparison = a.name.localeCompare(b.name);
              }
              return calibrationSort.direction === 'desc' ? -comparison : comparison;
            });
            
            // Team-Durchschnitte (teure Operation)
            const calcAvg = (arr) => arr.length > 0 ? arr.reduce((s, v) => s + v, 0) / arr.length : 0;
            const coreCompIds = ['fach', 'komm', 'prob', 'adapt', 'orga'];
            const leaderCompIds = ['lead', 'strat', 'decide', 'exec', 'stake'];
            
            const teamAvg = {
              gps: calcAvg(employeeData.map(e => e.gps).filter(v => v > 0)),
              was: calcAvg(employeeData.map(e => e.wasScore).filter(v => v > 0)),
              wie: calcAvg(employeeData.map(e => e.wieAvg).filter(v => v > 0)),
              core: {},
              leader: {}
            };
            
            coreCompIds.forEach(id => { teamAvg.core[id] = calcAvg(employeeData.map(e => e.coreScores[id]).filter(v => v > 0)); });
            if (hasAnyLeadership) {
              leaderCompIds.forEach(id => { teamAvg.leader[id] = calcAvg(employeeData.filter(e => e.includeLeadership).map(e => e.leaderScores[id]).filter(v => v > 0)); });
            }
            
            return { employeeData, teamAvg, allReviews, hasAnyLeadership, filteredReviews };
          }, [teamAppraisals, teamMembers, calibrationFilter, calibrationSort]);
          
          // === MEMOIZED PEER-LEARNING MATCHES (Performance-Optimierung) ===
          const peerLearningMatches = useMemo(() => {
            const { employeeData, hasAnyLeadership } = calibrationData;
            if (!employeeData || employeeData.length < 2) return [];
            
            const coreCompIds = ['fach', 'komm', 'prob', 'adapt', 'orga'];
            const leaderCompIds = ['lead', 'strat', 'decide', 'exec', 'stake'];
            const allCompIds = [...coreCompIds, ...(hasAnyLeadership ? leaderCompIds : [])];
            
            const allMatches = [];
            allCompIds.forEach(compId => {
              const isLeadership = leaderCompIds.includes(compId);
              const mentors = [];
              const mentees = [];
              
              employeeData.forEach(emp => {
                const score = isLeadership ? (emp.includeLeadership ? emp.leaderScores[compId] : 0) : emp.coreScores[compId];
                if (score >= 4) mentors.push({ name: emp.name, score, employeeId: emp.employeeId });
                else if (score > 0 && score <= 2) mentees.push({ name: emp.name, score, employeeId: emp.employeeId });
              });
              
              if (mentors.length > 0 && mentees.length > 0) {
                mentors.sort((a, b) => b.score - a.score);
                mentees.sort((a, b) => a.score - b.score);
                const mentor = mentors[0];
                const mentee = mentees[0];
                if (mentor.employeeId !== mentee.employeeId) {
                  allMatches.push({ mentor, mentee, compId, isLeadership, scoreDiff: mentor.score - mentee.score });
                }
              }
            });
            
            allMatches.sort((a, b) => b.scoreDiff - a.scoreDiff);
            return allMatches.slice(0, 3);
          }, [calibrationData]);
          
          // === HR ADMIN STATES ===
          const [isHRAdmin, setIsHRAdmin] = useState(false);
          const [allCompanyAppraisals, setAllCompanyAppraisals] = useState([]);
          const [allCompanyMembers, setAllCompanyMembers] = useState([]);
          const [hrDataLoading, setHRDataLoading] = useState(false);
          const [hrFilter, setHrFilter] = useState('all');
          const [hrSearch, setHrSearch] = useState('');
          
          // HR Admin Check
          React.useEffect(() => {
            if (user && user.email) {
              const admin = isUserHRAdmin(user.email);
              setIsHRAdmin(admin);
              if (admin) console.log('🔐 HR Admin erkannt:', user.email);
            } else {
              setIsHRAdmin(false);
            }
          }, [user]);
          
          // HR Admin: Lade ALLE Daten
          React.useEffect(() => {
            if (!isHRAdmin || !db || guestMode) {
              setAllCompanyAppraisals([]);
              setAllCompanyMembers([]);
              return;
            }
            
            setHRDataLoading(true);
            console.log('📊 HR Admin: Lade unternehmensweite Daten...');
            
            const unsub1 = db.collection('teamAppraisals').onSnapshot(snap => {
              const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
              setAllCompanyAppraisals(data);
              console.log('📊 HR Admin:', data.length, 'Beurteilungen geladen');
            }, err => console.error('HR appraisals error:', err));
            
            const unsub2 = db.collection('teamMembers').onSnapshot(snap => {
              const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
              setAllCompanyMembers(data);
              setHRDataLoading(false);
              console.log('👥 HR Admin:', data.length, 'Mitarbeiter geladen');
            }, err => { console.error('HR members error:', err); setHRDataLoading(false); });
            
            return () => { unsub1(); unsub2(); };
          }, [isHRAdmin, guestMode]);
          
          // Firestore Listener für teamMembers - NUR wenn user eingeloggt UND NICHT Gast-Modus
          React.useEffect(() => {
            // Im Gast-Modus keine Team-Daten laden (anonymer User hat eigene UID)
            if (!user || !db || guestMode) {
              setTeamMembers([]);
              return;
            }
            
            // Anonyme User ausschließen (haben isAnonymous = true)
            if (user.isAnonymous) {
              setTeamMembers([]);
              return;
            }
            
            setFirestoreLoading(true);
            const unsubscribe = db.collection('teamMembers')
              .where('userId', '==', user.uid)
              .onSnapshot((snapshot) => {
                const members = snapshot.docs.map(doc => ({
                  id: doc.id,
                  ...doc.data()
                }));
                setTeamMembers(members);
                setFirestoreLoading(false);
              }, (error) => {
                console.error('Firestore teamMembers error:', error);
                setFirestoreLoading(false);
              });
            
            return () => unsubscribe();
          }, [user, guestMode]);
          
          // Firestore Listener für teamAppraisals - NUR wenn user eingeloggt UND NICHT Gast-Modus
          React.useEffect(() => {
            // Im Gast-Modus keine Appraisals laden
            if (!user || !db || guestMode) {
              setTeamAppraisals([]);
              return;
            }
            
            // Anonyme User ausschließen
            if (user.isAnonymous) {
              setTeamAppraisals([]);
              return;
            }
            
            const unsubscribe = db.collection('teamAppraisals')
              .where('userId', '==', user.uid)
              .onSnapshot((snapshot) => {
                const appraisals = snapshot.docs.map(doc => ({
                  id: doc.id,
                  ...doc.data()
                }));
                setTeamAppraisals(appraisals);
                // Cache für AppraisalForm (Selbstreflexion-Verknüpfung)
                localStorage.setItem('nw_team_appraisals_cache', JSON.stringify(appraisals));
              }, (error) => {
                console.error('Firestore teamAppraisals error:', error);
              });
            
            return () => unsubscribe();
          }, [user, guestMode]);
          
          const [selectedCompetencyId, setSelectedCompetencyId] = useState(null);
          const [activeScore, setActiveScore] = useState(3);
          
          // Quiz-spezifische States entfernt
          const [lang, setLang] = useState('de'); // 'de' or 'it'
          
          // SAFE DATA ACCESS (Bug Fix)
          const t = UI_TEXT[lang] || UI_TEXT['de']; 
          const data = APP_DATA[lang] || APP_DATA['de']; 

          const navigateToCompetency = (id) => {
            setSelectedCompetencyId(id);
            setActiveScore(3);
            setActiveView('detail');
          };
          
          const getActiveCompetencyData = () => {
            if (!data || !data.competencies) return null;
            return data.competencies.find(c => c.id === selectedCompetencyId);
          };

          // Components
          const ScoreBadge = ({ score, active }) => {
            const colors = {
              1: "bg-red-100 text-red-800 border-red-200",
              2: "bg-orange-100 text-orange-800 border-orange-200",
              3: "bg-green-100 text-green-800 border-green-200",
              4: "bg-blue-100 text-blue-800 border-blue-200",
              5: "bg-[#E8F5ED] text-[#4D9360] border-[#D1EBE0]"
            };
            
            return React.createElement('div', {
              className: `flex items-center justify-center w-10 h-10 rounded-full font-bold border-2 cursor-pointer transition-all ${active ? 'scale-110 shadow-md ring-2 ring-offset-2 ring-[#6EBD84] ' + colors[score] : 'opacity-60 grayscale hover:grayscale-0'}`,
              onClick: () => setActiveScore(score)
            }, score);
          };

          
          // === TEAM FUNCTIONS (mit Firestore) ===
          
          // Hilfsfunktion: Generiere accessCode (crypto.randomUUID mit sicherem Fallback)
          const generateAccessCode = () => {
            // Primär: crypto.randomUUID() (modern, sicher)
            if (typeof crypto !== 'undefined' && crypto.randomUUID) {
              return crypto.randomUUID();
            }
            // Fallback: crypto.getRandomValues (sicherer als Math.random)
            if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
              const array = new Uint8Array(16);
              crypto.getRandomValues(array);
              // Format als UUID-ähnlicher String
              const hex = Array.from(array, b => b.toString(16).padStart(2, '0')).join('');
              return `${hex.slice(0,8)}-${hex.slice(8,12)}-${hex.slice(12,16)}-${hex.slice(16,20)}-${hex.slice(20,32)}`;
            }
            // Letzter Fallback für sehr alte Browser (nicht kryptographisch sicher)
            console.warn('Using insecure Math.random() for accessCode - please update browser');
            return 'xxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'.replace(/x/g, () => 
              Math.floor(Math.random() * 16).toString(16)
            );
          };
          
          const addTeamMember = async (data) => {
            if (!user || !db) return;
            
            try {
              const accessCode = generateAccessCode();
              const selfReflectionUrl = window.location.origin + window.location.pathname + '?accessCode=' + accessCode;
              const managerName = user.displayName || user.email?.split('@')[0] || 'Your Manager';
              
              // Mitarbeiter in Firestore speichern
              const memberRef = await db.collection('teamMembers').add({
                userId: user.uid,
                name: data.name,
                position: data.position,
                email: data.email || '',
                department: data.department || '',
                accessCode: accessCode,
                createdAt: new Date().toISOString(),
                invitedAt: null,  // Wird erst beim Einladen/Link-Erstellen gesetzt
                lastReminderAt: null
              });
              console.log('✓ Mitarbeiter erstellt mit accessCode:', accessCode);
              
              // Info: Selbstreflexions-Link muss manuell versendet werden
              // (Firebase Trigger Email Extension nicht konfiguriert)
            } catch (error) {
              console.error('Error adding team member:', error);
              alert(lang === 'de' ? 'Fehler beim Speichern!' : lang === 'it' ? 'Errore durante il salvataggio!' : 'Error saving!');
            }
          };
          
          // Hilfsfunktion: Zeitdifferenz formatieren
          const getTimeSinceInvite = (invitedAt) => {
            if (!invitedAt) return null;
            const now = new Date();
            const invited = new Date(invitedAt);
            const diffMs = now - invited;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            
            if (diffDays > 0) {
              return lang === 'de' ? `vor ${diffDays} Tag${diffDays > 1 ? 'en' : ''}` 
                   : lang === 'it' ? `${diffDays} giorn${diffDays > 1 ? 'i' : 'o'} fa`
                   : `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            } else if (diffHours > 0) {
              return lang === 'de' ? `vor ${diffHours} Stunde${diffHours > 1 ? 'n' : ''}`
                   : lang === 'it' ? `${diffHours} or${diffHours > 1 ? 'e' : 'a'} fa`
                   : `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            }
            return lang === 'de' ? 'gerade eben' : lang === 'it' ? 'poco fa' : 'just now';
          };
          
          const deleteTeamMember = async (id) => {
            if (!user || !db) return;
            
            if (confirm(lang === 'de' ? 'Wirklich löschen?' : lang === 'it' ? 'Eliminare?' : 'Delete?')) {
              try {
                // Lösche Mitarbeiter
                await db.collection('teamMembers').doc(id).delete();
                
                // Lösche zugehörige Appraisals
                const appraisalsSnapshot = await db.collection('teamAppraisals')
                  .where('userId', '==', user.uid)
                  .where('employeeId', '==', id)
                  .get();
                
                const batch = db.batch();
                appraisalsSnapshot.docs.forEach(doc => {
                  batch.delete(doc.ref);
                });
                await batch.commit();
              } catch (error) {
                console.error('Error deleting team member:', error);
                alert(lang === 'de' ? 'Fehler beim Löschen!' : lang === 'it' ? 'Errore durante l\'eliminazione!' : 'Error deleting!');
              }
            }
          };
          
          const startTeamAppraisal = (employeeId, period, existingAppraisal = null) => {
            const employee = teamMembers.find(e => e.id === employeeId);
            if (!employee) return;
            
            // Wenn existingAppraisal übergeben wurde, nutze diesen, sonst suche nach Draft
            const existingDraft = existingAppraisal || teamAppraisals.find(
              a => a.employeeId === employeeId && a.period === period && a.status === 'draft' && a.type === 'review'
            );
            
            localStorage.setItem('nw_current_employee', JSON.stringify({
              employee, period,
              type: 'review',
              appraisalId: existingDraft ? existingDraft.id : 'appr_' + Date.now(),
              existingData: existingDraft
            }));
            
            setActiveView('formular');
          };
          
          // Neue Funktion für Zielvereinbarungen
          const startTeamGoalSetting = (employeeId, period, existingGoal = null) => {
            const employee = teamMembers.find(e => e.id === employeeId);
            if (!employee) return;
            
            // Wenn existingGoal übergeben wurde, nutze diesen, sonst suche nach Draft
            const existingDraft = existingGoal || teamAppraisals.find(
              a => a.employeeId === employeeId && a.period === period && a.status === 'draft' && a.type === 'goals'
            );
            
            localStorage.setItem('nw_current_employee', JSON.stringify({
              employee, period,
              type: 'goals',
              appraisalId: existingDraft ? existingDraft.id : 'goal_' + Date.now(),
              existingData: existingDraft
            }));
            
            setActiveView('zielvereinbarung');
          };
          
          const saveTeamAppraisal = async (appraisal) => {
            if (!user || !db) return;
            
            // Stelle sicher, dass type gesetzt ist (default: 'review')
            const appraisalWithType = {
              ...appraisal,
              type: appraisal.type || 'review',
              userId: user.uid
            };
            
            try {
              // Prüfe, ob das Dokument bereits existiert
              const docRef = db.collection('teamAppraisals').doc(appraisalWithType.id);
              const docSnap = await docRef.get();
              
              if (docSnap.exists) {
                // Update existierendes Dokument mit merge
                await docRef.set(appraisalWithType, { merge: true });
                console.log('✓ Dokument aktualisiert:', appraisalWithType.id);
              } else {
                // Neues Dokument erstellen
                await docRef.set(appraisalWithType);
                console.log('✓ Neues Dokument erstellt:', appraisalWithType.id);
              }
              
              // Debug-Log
              console.log('💾 Gespeicherte Daten:', {
                id: appraisalWithType.id,
                type: appraisalWithType.type,
                status: appraisalWithType.status,
                gpsScore: appraisalWithType.gpsScore,
                wasScore: appraisalWithType.wasScore,
                employeeName: appraisalWithType.employeeName
              });
              
              localStorage.removeItem('nw_current_employee');
              
              // Angepasste Meldung je nach Typ
              const typeLabel = appraisalWithType.type === 'goals' 
                ? (lang === 'de' ? 'Zielvereinbarung' : lang === 'it' ? 'Accordo obiettivi' : 'Goal Agreement')
                : (lang === 'de' ? 'Bewertung' : lang === 'it' ? 'Valutazione' : 'Assessment');
              const statusLabel = appraisalWithType.status === 'draft'
                ? (lang === 'de' ? ' (Entwurf)' : lang === 'it' ? ' (Bozza)' : ' (Draft)')
                : '';
              alert(typeLabel + statusLabel + (lang === 'de' ? ' gespeichert!' : lang === 'it' ? ' salvato!' : ' saved!'));
              setActiveView('teamoverview');
            } catch (error) {
              console.error('Error saving appraisal:', error);
              alert(lang === 'de' ? 'Fehler beim Speichern!' : lang === 'it' ? 'Errore durante il salvataggio!' : 'Error saving!');
            }
          };
          
          const renderTeamOverview = () => {
            // === LOGIN PRÜFUNG ===
            if (!user) {
              return React.createElement(LoginView, { 
                lang: lang, 
                onLoginSuccess: () => {} // Auth state wird automatisch aktualisiert
              });
            }
            
            // === LOGOUT FUNKTION ===
            const handleLogout = async () => {
              try {
                await auth.signOut();
                setActiveView('dashboard');
              } catch (error) {
                console.error('Logout error:', error);
              }
            };
            
            // Erweiterte Statistiken mit Typ-Unterscheidung
            const reviews = teamAppraisals.filter(a => a.type === 'review' || !a.type);
            const goalsData = teamAppraisals.filter(a => a.type === 'goals');
            const selfAssessments = teamAppraisals.filter(a => a.type === 'self_assessment');
            
            const stats = {
              members: teamMembers.length,
              reviews: reviews.length,
              goals: goalsData.length,
              selfAssessments: selfAssessments.length,
              completedReviews: reviews.filter(a => a.status === 'completed').length,
              drafts: teamAppraisals.filter(a => a.status === 'draft').length,
              avgGPS: reviews.filter(a => a.status === 'completed').length > 0 
                ? (reviews.filter(a => a.status === 'completed').reduce((s, a) => s + (a.gpsScore || 0), 0) / reviews.filter(a => a.status === 'completed').length).toFixed(2)
                : '–'
            };
            
            // Berechne Status pro Mitarbeiter
            const getMemberStatus = (memberId) => {
              const memberAppraisals = teamAppraisals.filter(a => a.employeeId === memberId);
              if (memberAppraisals.length === 0) return 'none';
              const hasCompleted = memberAppraisals.some(a => a.status === 'completed');
              const hasDraft = memberAppraisals.some(a => a.status === 'draft');
              if (hasCompleted) return 'completed';
              if (hasDraft) return 'draft';
              return 'none';
            };
            
            const getStatusBadge = (status) => {
              if (status === 'completed') {
                return React.createElement('span', {
                  className: 'px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800'
                }, lang === 'de' ? '✓ Abgeschlossen' : lang === 'it' ? '✓ Completato' : '✓ Completed');
              } else if (status === 'draft') {
                return React.createElement('span', {
                  className: 'px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800'
                }, lang === 'de' ? '📝 Entwurf' : lang === 'it' ? '📝 Bozza' : '📝 Draft');
              }
              return React.createElement('span', {
                className: 'px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600'
              }, lang === 'de' ? '○ Nicht gestartet' : lang === 'it' ? '○ Non avviato' : '○ Not started');
            };
            
            // Type Badge für Historie
            const getTypeBadge = (type) => {
              if (type === 'goals') {
                return React.createElement('span', {
                  className: 'px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 flex items-center gap-1'
                }, React.createElement(Target, { size: 10 }), lang === 'de' ? 'Ziele' : lang === 'it' ? 'Obiettivi' : 'Goals');
              }
              if (type === 'self_assessment') {
                return React.createElement('span', {
                  className: 'px-2 py-0.5 rounded text-xs font-medium bg-teal-100 text-teal-800 flex items-center gap-1'
                }, React.createElement(Users, { size: 10 }), lang === 'de' ? 'Selbstreflexion' : lang === 'it' ? 'Autovalutazione' : 'Self-Reflection');
              }
              return React.createElement('span', {
                className: 'px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 flex items-center gap-1'
              }, React.createElement(ClipboardList, { size: 10 }), 'Review');
            };
            
            return React.createElement('div', { className: 'space-y-6 pb-10' },
              // Header mit Logout
              React.createElement('div', { className: 'flex justify-between items-center' },
                React.createElement('div', null,
                  React.createElement('h2', { className: 'text-3xl font-bold', style: { color: '#243186' } },
                    lang === 'de' ? '👥 Mein Team' : lang === 'it' ? '👥 Il mio team' : '👥 My Team'
                  ),
                  React.createElement('p', { className: 'text-slate-500 text-sm' },
                    lang === 'de' ? 'Performance Reviews & Zielvereinbarungen verwalten' : lang === 'it' ? 'Gestisci Performance Reviews e Obiettivi' : 'Manage Performance Reviews & Goal Agreements'
                  )
                ),
                // User Info & Logout Button
                React.createElement('div', { className: 'flex items-center gap-4' },
                  React.createElement('div', { className: 'text-right' },
                    React.createElement('p', { className: 'text-sm font-medium text-slate-700' }, 
                      user.email
                    ),
                    React.createElement('p', { className: 'text-xs text-slate-400' }, 
                      lang === 'de' ? 'Eingeloggt' : lang === 'it' ? 'Connesso' : 'Logged in'
                    )
                  ),
                  React.createElement('button', {
                    onClick: handleLogout,
                    className: 'flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors text-sm font-medium'
                  },
                    React.createElement(LogOut, { size: 16 }),
                    lang === 'de' ? 'Abmelden' : lang === 'it' ? 'Esci' : 'Sign out'
                  )
                )
              ),
              
              // Stats Cards - 5 Karten
              React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4' },
                React.createElement('div', { className: 'bg-white p-5 rounded-xl shadow-sm border border-slate-200' },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement(Users, { size: 24, className: 'text-[#243186]' }),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, stats.members),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        lang === 'de' ? 'Mitarbeiter' : lang === 'it' ? 'Dipendenti' : 'Employees')
                    )
                  )
                ),
                React.createElement('div', { className: 'bg-white p-5 rounded-xl shadow-sm border border-slate-200' },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement(ClipboardList, { size: 24, className: 'text-blue-600' }),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, stats.reviews),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 'Reviews')
                    )
                  )
                ),
                React.createElement('div', { className: 'bg-white p-5 rounded-xl shadow-sm border border-slate-200' },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement(Target, { size: 24, className: 'text-purple-600' }),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, stats.goals),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        lang === 'de' ? 'Zielvereinb.' : lang === 'it' ? 'Obiettivi' : 'Goals')
                    )
                  )
                ),
                React.createElement('div', { className: 'bg-white p-5 rounded-xl shadow-sm border border-slate-200' },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement(CheckCircle2, { size: 24, className: 'text-green-600' }),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, stats.completedReviews),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        lang === 'de' ? 'Abgeschlossen' : lang === 'it' ? 'Completate' : 'Completed')
                    )
                  )
                ),
                React.createElement('div', { className: 'bg-white p-5 rounded-xl shadow-sm border border-slate-200' },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement(Award, { size: 24, className: 'text-[#6EBD84]' }),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, stats.avgGPS),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 'Ø GPS Score')
                    )
                  )
                )
              ),
              
              // Add Employee Form
              React.createElement('div', { className: 'bg-white p-6 rounded-xl shadow-sm border border-slate-200' },
                React.createElement('h3', { className: 'font-bold text-lg mb-4 flex items-center gap-2', style: { color: '#243186' } },
                  React.createElement(UserPlus, { size: 20 }),
                  lang === 'de' ? 'Neuen Mitarbeiter hinzufügen' : lang === 'it' ? 'Aggiungi nuovo dipendente' : 'Add New Employee'
                ),
                React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3' },
                  React.createElement('input', {
                    type: 'text', 
                    placeholder: lang === 'de' ? 'Name *' : lang === 'it' ? 'Nome *' : 'Name *', 
                    id: 'new-name',
                    className: 'border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none transition-all'
                  }),
                  React.createElement('input', {
                    type: 'text', 
                    placeholder: lang === 'de' ? 'Position *' : lang === 'it' ? 'Posizione *' : 'Position *', 
                    id: 'new-position',
                    className: 'border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none transition-all'
                  }),
                  React.createElement('input', {
                    type: 'email', 
                    placeholder: lang === 'de' ? 'E-Mail (für Einladung)' : lang === 'it' ? 'Email (per invito)' : 'Email (for invitation)', 
                    id: 'new-email',
                    className: 'border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none transition-all'
                  }),
                  React.createElement('input', {
                    type: 'text', 
                    placeholder: lang === 'de' ? 'Abteilung' : lang === 'it' ? 'Reparto' : 'Department', 
                    id: 'new-dept',
                    className: 'border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none transition-all'
                  }),
                  React.createElement('button', {
                    onClick: () => {
                      const name = document.getElementById('new-name').value.trim();
                      const position = document.getElementById('new-position').value.trim();
                      const email = document.getElementById('new-email').value.trim();
                      const department = document.getElementById('new-dept').value.trim();
                      if (name && position) {
                        addTeamMember({ name, position, email, department });
                        document.getElementById('new-name').value = '';
                        document.getElementById('new-position').value = '';
                        document.getElementById('new-email').value = '';
                        document.getElementById('new-dept').value = '';
                      } else {
                        alert(lang === 'de' ? 'Name und Position sind erforderlich!' : lang === 'it' ? 'Nome e posizione sono obbligatori!' : 'Name and position are required!');
                      }
                    },
                    className: 'bg-[#6EBD84] text-white px-6 py-2.5 rounded-lg hover:bg-[#5da872] transition-colors font-medium flex items-center justify-center gap-2'
                  }, React.createElement(PlusCircle, { size: 18 }), lang === 'de' ? 'Hinzufügen' : lang === 'it' ? 'Aggiungi' : 'Add')
                )
              ),
              
              // Team Members List
              React.createElement('div', { className: 'space-y-4' },
                React.createElement('h3', { className: 'font-bold text-lg', style: { color: '#243186' } },
                  lang === 'de' ? 'Team-Mitglieder' : lang === 'it' ? 'Membri del team' : 'Team Members'
                ),
                teamMembers.length === 0 
                  ? React.createElement('div', { 
                      className: 'bg-slate-50 p-12 rounded-xl text-center border-2 border-dashed border-slate-300' 
                    },
                    React.createElement(Users, { size: 48, className: 'mx-auto text-slate-300 mb-4' }),
                    React.createElement('p', { className: 'text-slate-500 text-lg' }, 
                      lang === 'de' ? 'Noch keine Mitarbeiter hinzugefügt' : lang === 'it' ? 'Nessun dipendente ancora aggiunto' : 'No employees added yet'),
                    React.createElement('p', { className: 'text-slate-400 text-sm mt-1' }, 
                      lang === 'de' ? 'Fügen Sie oben einen Mitarbeiter hinzu, um zu beginnen.' : lang === 'it' ? 'Aggiungi un dipendente sopra per iniziare.' : 'Add an employee above to get started.')
                  )
                  : teamMembers.map(member => {
                      const memberAppraisals = teamAppraisals.filter(a => a.employeeId === member.id);
                      const memberStatus = getMemberStatus(member.id);
                      
                      return React.createElement('div', { 
                        key: member.id,
                        className: 'bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-all'
                      },
                        React.createElement('div', { className: 'flex justify-between items-start' },
                          // Left: Member Info
                          React.createElement('div', { className: 'flex-1' },
                            React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                              React.createElement('h3', { className: 'font-bold text-lg text-slate-800' }, member.name),
                              getStatusBadge(memberStatus)
                            ),
                            React.createElement('p', { className: 'text-sm text-slate-600' },
                              member.position + (member.department ? ' • ' + member.department : '')
                            ),
                            // E-Mail anzeigen (wenn vorhanden)
                            member.email && React.createElement('p', { className: 'text-xs text-slate-400 flex items-center gap-1 mb-3' },
                              React.createElement(Mail, { size: 12 }),
                              member.email
                            ),
                            !member.email && React.createElement('div', { className: 'mb-3' }),
                            
                            // Appraisals List - mit Typ-Badge
                            memberAppraisals.length > 0 && React.createElement('div', { 
                              className: 'mt-3 space-y-2 bg-slate-50 p-3 rounded-lg' 
                            },
                              React.createElement('p', { className: 'text-xs font-medium text-slate-500 uppercase tracking-wider mb-2' },
                                lang === 'de' ? 'Dokumente & Bewertungen:' : lang === 'it' ? 'Documenti e valutazioni:' : 'Documents & Assessments:'
                              ),
                              memberAppraisals.map(a => 
                                React.createElement('div', { 
                                  key: a.id, 
                                  className: `flex gap-3 items-center text-sm bg-white p-2.5 rounded border ${a.type === 'self_assessment' ? 'border-teal-300 bg-teal-50/30' : 'border-slate-200'}` 
                                },
                                  // Type Badge
                                  getTypeBadge(a.type),
                                  // Period
                                  React.createElement('span', { className: 'font-medium text-slate-700 min-w-16' }, a.period),
                                  // Status Badge (erweitert für self_assessment)
                                  React.createElement('span', {
                                    className: `px-2 py-0.5 rounded text-xs font-medium ${
                                      a.status === 'completed' 
                                        ? 'bg-green-100 text-green-800' 
                                        : a.status === 'submitted_self'
                                          ? 'bg-teal-100 text-teal-800'
                                          : 'bg-yellow-100 text-yellow-800'
                                    }`
                                  }, a.status === 'completed' 
                                    ? (lang === 'de' ? 'Fertig' : lang === 'it' ? 'Fatto' : 'Done') 
                                    : a.status === 'submitted_self'
                                      ? (lang === 'de' ? '📩 Eingereicht' : lang === 'it' ? '📩 Inviato' : '📩 Submitted')
                                      : (lang === 'de' ? 'Entwurf' : lang === 'it' ? 'Bozza' : 'Draft')),
                                  // GPS Score (nur für Reviews anzeigen, nicht für self_assessment)
                                  (a.type !== 'goals' && a.type !== 'self_assessment') && React.createElement('span', { className: 'text-slate-600' }, 
                                    'GPS: ', 
                                    React.createElement('span', { className: 'font-bold' }, (a.gpsScore || 0).toFixed(2))
                                  ),
                                  // Action Buttons (unterschiedlich je nach Typ)
                                  React.createElement('div', { className: 'flex gap-2 ml-auto' },
                                    // Bearbeiten-Button: NUR für reviews und goals (nicht für self_assessment)
                                    a.type !== 'self_assessment' && React.createElement('button', {
                                      onClick: () => {
                                        // Je nach Typ die richtige Funktion aufrufen
                                        if (a.type === 'goals') {
                                          startTeamGoalSetting(member.id, a.period, a);
                                        } else {
                                          startTeamAppraisal(member.id, a.period, a);
                                        }
                                      },
                                      className: 'text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-50 rounded transition-colors',
                                      title: lang === 'de' ? 'Bearbeiten' : lang === 'it' ? 'Modifica' : 'Edit'
                                    }, React.createElement(Edit2, { size: 16 })),
                                    // Ansehen-Button: Für abgeschlossene Reviews/Goals UND für Selbstreflexionen
                                    (a.status === 'completed' || a.type === 'self_assessment') && React.createElement('button', {
                                      onClick: () => {
                                        if (a.type === 'self_assessment') {
                                          // Selbstreflexion anzeigen (später: eigene View)
                                          setActiveView('viewSelfAssessment');
                                          localStorage.setItem('nw_view_self_assessment', JSON.stringify(a));
                                        } else if (a.type === 'goals') {
                                          startTeamGoalSetting(member.id, a.period, a);
                                        } else {
                                          startTeamAppraisal(member.id, a.period, a);
                                        }
                                      },
                                      className: 'text-slate-600 hover:text-slate-800 p-1 hover:bg-slate-100 rounded transition-colors',
                                      title: lang === 'de' ? 'Ansehen' : lang === 'it' ? 'Visualizza' : 'View'
                                    }, React.createElement(Eye, { size: 16 })),
                                    // Löschen-Button: Für alle Typen
                                    React.createElement('button', {
                                      onClick: async () => {
                                        const confirmMsg = a.type === 'goals'
                                          ? (lang === 'de' ? 'Zielvereinbarung wirklich löschen?' : lang === 'it' ? 'Eliminare gli obiettivi?' : 'Delete Goal Agreement?')
                                          : a.type === 'self_assessment'
                                            ? (lang === 'de' ? 'Selbstreflexion wirklich löschen?' : lang === 'it' ? 'Eliminare l\'autovalutazione?' : 'Delete Self-Assessment?')
                                            : (lang === 'de' ? 'Bewertung wirklich löschen?' : lang === 'it' ? 'Eliminare la valutazione?' : 'Delete Assessment?');
                                        if (confirm(confirmMsg)) {
                                          try {
                                            await db.collection('teamAppraisals').doc(a.id).delete();
                                          } catch (error) {
                                            console.error('Error deleting appraisal:', error);
                                            alert(lang === 'de' ? 'Fehler beim Löschen!' : lang === 'it' ? 'Errore durante l\'eliminazione!' : 'Error deleting!');
                                          }
                                        }
                                      },
                                      className: 'text-red-500 hover:text-red-700 p-1 hover:bg-red-50 rounded transition-colors',
                                      title: lang === 'de' ? 'Löschen' : lang === 'it' ? 'Elimina' : 'Delete'
                                    }, React.createElement(Trash2, { size: 16 }))
                                  )
                                )
                              )
                            )
                          ),
                          
                          // Right: Action Buttons - mit Zielvereinbarung
                          React.createElement('div', { className: 'flex flex-col gap-2 ml-4' },
                            // Neue Bewertung Button
                            React.createElement('button', {
                              onClick: () => {
                                const currentYear = new Date().getFullYear();
                                const period = prompt(
                                  lang === 'de' ? 'Bewertungszeitraum eingeben:' : lang === 'it' ? 'Inserisci periodo:' : 'Enter assessment period:',
                                  currentYear.toString()
                                );
                                if (period) startTeamAppraisal(member.id, period);
                              },
                              className: 'px-4 py-2.5 bg-[#6EBD84] text-white rounded-lg hover:bg-[#5da872] text-sm font-medium flex items-center gap-2 transition-colors'
                            }, 
                              React.createElement(ClipboardList, { size: 16 }),
                              lang === 'de' ? 'Neue Bewertung' : lang === 'it' ? 'Nuova valutazione' : 'New Assessment'
                            ),
                            // Neue Zielvereinbarung Button
                            React.createElement('button', {
                              onClick: () => {
                                const currentYear = new Date().getFullYear();
                                const period = prompt(
                                  lang === 'de' ? 'Zielzeitraum eingeben (z.B. 2025):' : lang === 'it' ? 'Inserisci periodo obiettivi:' : 'Enter goal period (e.g. 2025):',
                                  currentYear.toString()
                                );
                                if (period) startTeamGoalSetting(member.id, period);
                              },
                              className: 'px-4 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm font-medium flex items-center gap-2 transition-colors'
                            }, 
                              React.createElement(Target, { size: 16 }),
                              lang === 'de' ? 'Neue Zielvereinb.' : lang === 'it' ? 'Nuovi obiettivi' : 'New Goals'
                            ),
                            
                            // === SELBSTREFLEXIONS-EINLADUNG BEREICH ===
                            // Prüfe ob bereits eine Selbstreflexion eingereicht wurde
                            (() => {
                              const hasSelfAssessment = memberAppraisals.some(a => a.type === 'self_assessment' && a.status === 'submitted_self');
                              const timeSince = getTimeSinceInvite(member.invitedAt);
                              
                              if (hasSelfAssessment) {
                                // ✅ ERHALTEN - Grüner Erfolgs-Badge
                                return React.createElement('div', {
                                  className: 'px-4 py-2 bg-gradient-to-r from-green-50 to-emerald-50 text-green-700 rounded-lg text-sm font-medium flex items-center gap-2 border border-green-200'
                                },
                                  React.createElement(CheckCircle2, { size: 16, className: 'text-green-500' }),
                                  lang === 'de' ? 'Selbstreflexion erhalten' : lang === 'it' ? 'Autovalutazione ricevuta' : 'Self-reflection received'
                                );
                              }
                              
                              // Noch nicht eingereicht
                              return React.createElement('div', { className: 'flex items-center gap-2' },
                                
                                // 🆕 NICHT EINGELADEN: Grüner Einladen-Button
                                !member.invitedAt && React.createElement('button', {
                                  onClick: async () => {
                                    const selfReflectionUrl = window.location.origin + window.location.pathname + '?accessCode=' + member.accessCode;
                                    try {
                                      await navigator.clipboard.writeText(selfReflectionUrl);
                                      await db.collection('teamMembers').doc(member.id).update({
                                        invitedAt: new Date().toISOString()
                                      });
                                      alert(lang === 'de' 
                                        ? '✅ Link kopiert!\n\nJetzt per E-Mail oder Teams an ' + member.name + ' senden.\n\n💡 Tipp: Der Link funktioniert ohne Login.' 
                                        : lang === 'it' 
                                        ? '✅ Link copiato!\n\nOra invia via email o Teams a ' + member.name + '.\n\n💡 Il link funziona senza login.'
                                        : '✅ Link copied!\n\nNow send via email or Teams to ' + member.name + '.\n\n💡 The link works without login.');
                                    } catch (err) {
                                      prompt(lang === 'de' ? 'Link für ' + member.name + ':' : 'Link:', 
                                        window.location.origin + window.location.pathname + '?accessCode=' + member.accessCode);
                                    }
                                  },
                                  className: 'px-4 py-2 bg-[#6EBD84] text-white rounded-lg hover:bg-[#5da872] text-sm font-medium flex items-center gap-2 transition-all shadow-sm hover:shadow',
                                  title: lang === 'de' ? 'Link kopieren zum Versenden' : lang === 'it' ? 'Copia link da inviare' : 'Copy link to send'
                                },
                                  React.createElement(Link, { size: 16 }),
                                  lang === 'de' ? 'Einladen' : lang === 'it' ? 'Invita' : 'Invite'
                                ),
                                
                                // ⏳ EINGELADEN, WARTET: Amber Status-Chip mit Copy-Icon
                                member.invitedAt && React.createElement('div', { 
                                  className: 'flex items-center gap-1 bg-amber-50 rounded-lg border border-amber-200 overflow-hidden'
                                },
                                  // Status-Text
                                  React.createElement('span', { 
                                    className: 'text-xs text-amber-700 px-3 py-1.5 flex items-center gap-1.5'
                                  },
                                    React.createElement(Clock, { size: 12 }),
                                    lang === 'de' ? `Wartet ${timeSince}` : lang === 'it' ? `In attesa ${timeSince}` : `Waiting ${timeSince}`
                                  ),
                                  // Copy-Icon Button (dezent, aber funktional)
                                  React.createElement('button', {
                                    onClick: async () => {
                                      const url = window.location.origin + window.location.pathname + '?accessCode=' + member.accessCode;
                                      try {
                                        await navigator.clipboard.writeText(url);
                                        // Kurzes visuelles Feedback
                                        const btn = event.currentTarget;
                                        btn.classList.add('bg-green-100');
                                        setTimeout(() => btn.classList.remove('bg-green-100'), 500);
                                      } catch (err) {
                                        prompt('Link:', url);
                                      }
                                    },
                                    className: 'px-2 py-1.5 text-amber-600 hover:bg-amber-100 hover:text-amber-800 transition-colors border-l border-amber-200',
                                    title: lang === 'de' ? 'Link erneut kopieren' : lang === 'it' ? 'Copia link di nuovo' : 'Copy link again'
                                  },
                                    React.createElement(Copy, { size: 14 })
                                  )
                                )
                              );
                            })(),
                            
                            // Entfernen Button
                            React.createElement('button', {
                              onClick: () => deleteTeamMember(member.id),
                              className: 'px-4 py-2.5 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 text-sm font-medium flex items-center gap-2 transition-colors'
                            }, 
                              React.createElement(Trash2, { size: 16 }),
                              lang === 'de' ? 'Entfernen' : lang === 'it' ? 'Rimuovi' : 'Remove'
                            )
                          )
                        )
                      );
                    })
              )
            );
          };
          
          // === HR ADMIN DASHBOARD ===
          const renderHRDashboard = () => {
            if (hrDataLoading) {
              return React.createElement('div', { className: 'flex justify-center py-20' },
                React.createElement(Loader2, { className: 'w-12 h-12 animate-spin text-purple-600' })
              );
            }
            
            // Filter
            let filtered = [...allCompanyAppraisals];
            if (hrFilter === 'completed') filtered = filtered.filter(a => a.status === 'completed');
            if (hrFilter === 'draft') filtered = filtered.filter(a => a.status === 'draft');
            if (hrFilter === 'self') filtered = filtered.filter(a => a.type === 'self_assessment');
            if (hrFilter === 'reviews') filtered = filtered.filter(a => a.type === 'review' || !a.type);
            
            if (hrSearch) {
              const s = hrSearch.toLowerCase();
              filtered = filtered.filter(a => 
                (a.employeeName || '').toLowerCase().includes(s) ||
                (a.formData?.employee || '').toLowerCase().includes(s) ||
                (a.formData?.manager || '').toLowerCase().includes(s)
              );
            }
            
            filtered.sort((a, b) => new Date(b.updatedAt || b.createdAt || 0) - new Date(a.updatedAt || a.createdAt || 0));
            
            // Stats
            const stats = {
              members: allCompanyMembers.length,
              appraisals: allCompanyAppraisals.length,
              completed: allCompanyAppraisals.filter(a => a.status === 'completed').length,
              reviews: allCompanyAppraisals.filter(a => a.type === 'review' || !a.type).length,
              self: allCompanyAppraisals.filter(a => a.type === 'self_assessment').length
            };
            
            const reviewsWithGPS = allCompanyAppraisals.filter(a => (a.type === 'review' || !a.type) && a.gpsScore > 0);
            const avgGPS = reviewsWithGPS.length > 0 
              ? (reviewsWithGPS.reduce((sum, a) => sum + a.gpsScore, 0) / reviewsWithGPS.length).toFixed(2)
              : '–';
            
            return React.createElement('div', { className: 'space-y-6 pb-12' },
              // Header
              React.createElement('div', { 
                className: 'rounded-2xl p-6 text-white',
                style: { background: 'linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)' }
              },
                React.createElement('h1', { className: 'text-2xl font-bold mb-2 flex items-center gap-3' },
                  React.createElement(Building2, { size: 28 }),
                  '🔐 HR Admin Dashboard'
                ),
                React.createElement('p', { className: 'text-white/80 mb-4' },
                  getText(lang, 'Unternehmensweite Übersicht aller Performance-Daten', 'Panoramica aziendale', 'Company-wide overview')
                ),
                React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-3' },
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.members),
                    React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Mitarbeiter', 'Collaboratori', 'Employees'))
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.reviews),
                    React.createElement('div', { className: 'text-xs text-white/70' }, 'Reviews')
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.self),
                    React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Selbstrefl.', 'Autorifless.', 'Self-Assess.'))
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, avgGPS),
                    React.createElement('div', { className: 'text-xs text-white/70' }, 'Ø GPS')
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.completed + '/' + stats.appraisals),
                    React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Fertig', 'Completate', 'Done'))
                  )
                )
              ),
              
              // Filter + Export
              React.createElement('div', { className: 'bg-white rounded-xl p-4 shadow-sm border flex flex-wrap gap-3 items-center' },
                React.createElement('input', {
                  type: 'text',
                  placeholder: getText(lang, '🔍 Suche...', '🔍 Cerca...', '🔍 Search...'),
                  value: hrSearch,
                  onChange: (e) => setHrSearch(e.target.value),
                  className: 'flex-1 min-w-[200px] px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none'
                }),
                React.createElement('select', {
                  value: hrFilter,
                  onChange: (e) => setHrFilter(e.target.value),
                  className: 'px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none'
                },
                  React.createElement('option', { value: 'all' }, getText(lang, 'Alle', 'Tutti', 'All')),
                  React.createElement('option', { value: 'reviews' }, 'Reviews'),
                  React.createElement('option', { value: 'self' }, getText(lang, 'Selbstreflexionen', 'Autoriflessioni', 'Self-Assessments')),
                  React.createElement('option', { value: 'completed' }, '✓ ' + getText(lang, 'Fertig', 'Completate', 'Completed')),
                  React.createElement('option', { value: 'draft' }, '✎ ' + getText(lang, 'Entwürfe', 'Bozze', 'Drafts'))
                ),
                React.createElement('span', { className: 'text-sm text-slate-500' }, filtered.length + ' ' + getText(lang, 'Einträge', 'voci', 'entries')),
                // Excel Export Button
                React.createElement('button', {
                  onClick: () => {
                    // Erstelle CSV-Daten für Excel
                    const headers = [
                      'Mitarbeiter', 'Position', 'Führungskraft', 'Typ', 'Status',
                      'GPS', 'WAS', 'WIE Core', 'WIE Lead',
                      'C1 Fachkompetenz', 'C2 Kommunikation', 'C3 Problemlösung', 'C4 Adaptivität', 'C5 Organisation',
                      'L1 Führung', 'L2 Strategie', 'L3 Entscheidung', 'L4 Execution', 'L5 Stakeholder',
                      'Stärken 1', 'Stärken 2', 'Karriere-Kommentar', 'Wünsche nächstes Jahr',
                      'Feedback an FK', 'Erstellt am', 'Aktualisiert am'
                    ];
                    
                    const rows = allCompanyAppraisals.map(a => {
                      const coreScores = a.coreScores || {};
                      const leaderScores = a.leaderScores || {};
                      const formData = a.formData || {};
                      
                      return [
                        a.employeeName || formData.employee || '',
                        formData.position || a.position || '',
                        formData.manager || '',
                        a.type === 'self_assessment' ? 'Selbstreflexion' : a.type === 'goals' ? 'Zielvereinbarung' : 'Review',
                        a.status === 'completed' ? 'Fertig' : 'Entwurf',
                        a.gpsScore || '',
                        a.wasScore || '',
                        a.wieCoreScore || '',
                        a.wieLeaderScore || '',
                        // Core Scores mit korrekten IDs (fach, komm, prob, adapt, orga)
                        coreScores.fach || coreScores.c1 || '',
                        coreScores.komm || coreScores.c2 || '',
                        coreScores.prob || coreScores.c3 || '',
                        coreScores.adapt || coreScores.c4 || '',
                        coreScores.orga || coreScores.c5 || '',
                        // Leader Scores mit korrekten IDs (lead, strat, decide, exec, stake)
                        leaderScores.lead || leaderScores.l1 || '',
                        leaderScores.strat || leaderScores.l2 || '',
                        leaderScores.decide || leaderScores.l3 || '',
                        leaderScores.exec || leaderScores.l4 || '',
                        leaderScores.stake || leaderScores.l5 || '',
                        (formData.strengths1 || '').replace(/[\n\r]+/g, ' ').substring(0, 200),
                        (formData.strengths2 || '').replace(/[\n\r]+/g, ' ').substring(0, 200),
                        (formData.careerComment || '').replace(/[\n\r]+/g, ' ').substring(0, 200),
                        (formData.wishesNextYear || a.formData?.wishesNextYear || '').replace(/[\n\r]+/g, ' ').substring(0, 200),
                        (formData.feedbackManager || a.formData?.feedbackManager || '').replace(/[\n\r]+/g, ' ').substring(0, 200),
                        a.createdAt ? new Date(a.createdAt).toLocaleDateString('de-DE') : '',
                        a.updatedAt ? new Date(a.updatedAt).toLocaleDateString('de-DE') : ''
                      ];
                    });
                    
                    // CSV erstellen mit BOM für Excel-Kompatibilität
                    const escapeCSV = (val) => {
                      if (val === null || val === undefined) return '';
                      const str = String(val);
                      if (str.includes(';') || str.includes('"') || str.includes('\n')) {
                        return '"' + str.replace(/"/g, '""') + '"';
                      }
                      return str;
                    };
                    
                    const csvContent = '\uFEFF' + // BOM für UTF-8 in Excel
                      headers.map(escapeCSV).join(';') + '\n' +
                      rows.map(row => row.map(escapeCSV).join(';')).join('\n');
                    
                    // Download
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = 'Niederwieser_Performance_Export_' + new Date().toISOString().split('T')[0] + '.csv';
                    link.click();
                    URL.revokeObjectURL(link.href);
                  },
                  className: 'px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium flex items-center gap-2 transition-colors'
                },
                  React.createElement(Download, { size: 16 }),
                  getText(lang, '📊 Excel Export', '📊 Esporta Excel', '📊 Excel Export')
                )
              ),
              
              // Tabelle
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border overflow-hidden' },
                React.createElement('div', { className: 'overflow-x-auto' },
                  React.createElement('table', { className: 'w-full text-sm' },
                    React.createElement('thead', { className: 'bg-slate-50 border-b' },
                      React.createElement('tr', null,
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee')),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'Führungskraft', 'Manager', 'Manager')),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, 'Typ'),
                        React.createElement('th', { className: 'px-4 py-3 text-center font-semibold' }, 'GPS'),
                        React.createElement('th', { className: 'px-4 py-3 text-center font-semibold' }, 'WAS'),
                        React.createElement('th', { className: 'px-4 py-3 text-center font-semibold' }, 'WIE'),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, 'Status'),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'Datum', 'Data', 'Date'))
                      )
                    ),
                    React.createElement('tbody', { className: 'divide-y' },
                      filtered.length === 0 
                        ? React.createElement('tr', null,
                            React.createElement('td', { colSpan: 8, className: 'px-4 py-12 text-center text-slate-500' },
                              getText(lang, 'Keine Daten gefunden', 'Nessun dato', 'No data found')
                            )
                          )
                        : filtered.map(a => {
                            const name = a.employeeName || a.formData?.employee || '–';
                            const manager = a.formData?.manager || '–';
                            const position = a.formData?.position || a.position || '';
                            const gps = a.gpsScore || 0;
                            const was = a.wasScore || 0;
                            const wie = a.wieCoreScore || 0;
                            
                            const typeLabel = a.type === 'self_assessment' ? 'Self' : a.type === 'goals' ? 'Goals' : 'Review';
                            const typeColor = a.type === 'self_assessment' ? 'bg-purple-100 text-purple-700' : 
                                              a.type === 'goals' ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700';
                            
                            const gpsColor = gps >= 3.5 ? 'bg-green-50 text-green-700' : 
                                             gps >= 2.5 ? 'bg-blue-50 text-blue-700' : 
                                             gps > 0 ? 'bg-orange-50 text-orange-700' : 'bg-slate-50 text-slate-400';
                            
                            return React.createElement('tr', { key: a.id, className: 'hover:bg-slate-50' },
                              React.createElement('td', { className: 'px-4 py-3' },
                                React.createElement('div', { className: 'font-medium text-slate-800' }, name),
                                React.createElement('div', { className: 'text-xs text-slate-500' }, position)
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-slate-600' }, manager),
                              React.createElement('td', { className: 'px-4 py-3' },
                                React.createElement('span', { className: 'px-2 py-1 rounded-full text-xs font-medium ' + typeColor }, typeLabel)
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-center' },
                                React.createElement('span', { className: 'px-2 py-1 rounded font-bold ' + gpsColor }, gps > 0 ? gps.toFixed(2) : '–')
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-center text-slate-600' }, was > 0 ? was.toFixed(2) : '–'),
                              React.createElement('td', { className: 'px-4 py-3 text-center text-slate-600' }, wie > 0 ? wie.toFixed(2) : '–'),
                              React.createElement('td', { className: 'px-4 py-3' },
                                React.createElement('span', { 
                                  className: 'px-2 py-1 rounded-full text-xs ' + (a.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700')
                                }, a.status === 'completed' ? '✓' : '✎')
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-slate-500 text-xs' },
                                a.updatedAt ? new Date(a.updatedAt).toLocaleDateString('de-DE') : 
                                a.createdAt ? new Date(a.createdAt).toLocaleDateString('de-DE') : '–'
                              )
                            );
                          })
                    )
                  )
                )
              ),
              
              // Footer
              React.createElement('div', { className: 'text-center text-xs text-slate-400 py-4' },
                '🔐 HR Admin – ' + (user?.email || '')
              )
            );
          };
          
          // === TEAM CALIBRATION RENDER FUNCTION ===
          const renderTeamCalibration = () => {
            // Sammle alle Reviews (type: 'review' oder kein type für Rückwärtskompatibilität)
            const allReviews = teamAppraisals.filter(a => a.type === 'review' || !a.type);
            
            // Completed = Reviews mit status 'completed' UND gpsScore > 0
            const completedReviews = allReviews.filter(a => a.status === 'completed' && a.gpsScore && a.gpsScore > 0);
            
            // Drafts = Reviews mit status 'draft' ODER ohne gpsScore
            const draftReviews = allReviews.filter(a => a.status === 'draft' || !a.gpsScore || a.gpsScore === 0);
            
            // Reviews mit GPS für Statistiken (alle mit gpsScore > 0, unabhängig vom Status)
            const reviewsWithGPS = allReviews.filter(a => a.gpsScore && a.gpsScore > 0);
            
            // Debug-Log
            console.log('📊 Team Calibration Filter:', {
              totalAppraisals: teamAppraisals.length,
              allReviews: allReviews.length,
              completed: completedReviews.length,
              drafts: draftReviews.length,
              withGPS: reviewsWithGPS.length,
              sample: allReviews[0] || null
            });
            
            // Team-Name aus user oder Fallback
            const teamName = user?.displayName ? `Team ${user.displayName.split(' ')[0]}` : getText(lang, 'Mein Team', 'Il mio team', 'My Team');
            
            // Aktuelle Review-Periode
            const currentPeriod = new Date().getFullYear().toString();
            
            // === STATISTIK-BERECHNUNGEN ===
            
            // Hilfsfunktion: WAS % zu BARS konvertieren
            const convertWAStoBARS = (percentage) => {
              if (percentage < 70) return 1;
              if (percentage < 90) return 2;
              if (percentage <= 110) return 3;
              if (percentage <= 130) return 4;
              return 5;
            };
            
            // Hilfsfunktion: Standardabweichung berechnen
            const calculateStdDev = (values) => {
              if (values.length === 0) return 0;
              if (values.length === 1) return 0; // Keine Streuung bei einem Wert
              const avg = values.reduce((sum, v) => sum + v, 0) / values.length;
              const squareDiffs = values.map(v => Math.pow(v - avg, 2));
              const avgSquareDiff = squareDiffs.reduce((sum, v) => sum + v, 0) / values.length;
              return Math.sqrt(avgSquareDiff);
            };
            
            // Hilfsfunktion: WIE-Durchschnitt aus Kompetenzen berechnen
            // WICHTIG: Daten werden als coreScores/leaderScores Objekte gespeichert, NICHT als Arrays!
            const calculateWieAverage = (review) => {
              const ratings = [];
              
              // Core Scores aus coreScores Objekt (Format: { c1: 3, c2: 4, ... })
              if (review.coreScores && typeof review.coreScores === 'object') {
                Object.values(review.coreScores).forEach(rating => {
                  if (typeof rating === 'number' && rating > 0) {
                    ratings.push(rating);
                  }
                });
              }
              
              // Leadership Scores aus leaderScores Objekt (Format: { l1: 3, l2: 4, ... })
              if (review.leaderScores && typeof review.leaderScores === 'object') {
                Object.values(review.leaderScores).forEach(rating => {
                  if (typeof rating === 'number' && rating > 0) {
                    ratings.push(rating);
                  }
                });
              }
              
              // Fallback: Direkt wieCoreScore und wieLeaderScore nutzen falls vorhanden
              if (ratings.length === 0) {
                if (review.wieCoreScore && review.wieCoreScore > 0) {
                  ratings.push(review.wieCoreScore);
                }
                if (review.wieLeaderScore && review.wieLeaderScore > 0) {
                  ratings.push(review.wieLeaderScore);
                }
              }
              
              return ratings.length > 0 ? ratings.reduce((sum, r) => sum + r, 0) / ratings.length : 0;
            };
            
            // Hilfsfunktion: WAS-Score berechnen (aus goals)
            const calculateWasScore = (review) => {
              // Erst prüfen ob wasScore direkt gespeichert ist
              if (review.wasScore && review.wasScore > 0) {
                return review.wasScore;
              }
              
              // Sonst aus goals berechnen
              if (!review.goals || !Array.isArray(review.goals) || review.goals.length === 0) return null;
              const validGoals = review.goals.filter(g => g.weight > 0);
              if (validGoals.length === 0) return null;
              
              let weightedSum = 0;
              let totalWeight = 0;
              validGoals.forEach(g => {
                const achievement = g.achievement || 0;
                const barsScore = convertWAStoBARS(achievement);
                weightedSum += barsScore * (g.weight / 100);
                totalWeight += g.weight / 100;
              });
              return totalWeight > 0 ? weightedSum / totalWeight : null;
            };
            
            // Berechne alle Statistiken
            const stats = {
              totalMembers: teamMembers.length,
              totalReviews: allReviews.length,
              completedReviews: completedReviews.length,
              draftReviews: draftReviews.length,
              avgGPS: 0,
              avgWAS: 0,
              avgWIE: 0,
              stdDev: 0
            };
            
            // Nur berechnen wenn Reviews mit GPS vorhanden
            if (reviewsWithGPS.length > 0) {
              // GPS Durchschnitt
              const gpsValues = reviewsWithGPS.map(r => r.gpsScore || 0).filter(v => v > 0);
              if (gpsValues.length > 0) {
                stats.avgGPS = gpsValues.reduce((sum, v) => sum + v, 0) / gpsValues.length;
                // Standardabweichung
                stats.stdDev = calculateStdDev(gpsValues);
              }
              
              // WAS Durchschnitt - nutze wasScore direkt falls vorhanden
              const wasScores = reviewsWithGPS
                .map(r => r.wasScore || calculateWasScore(r))
                .filter(s => s !== null && s > 0);
              if (wasScores.length > 0) {
                stats.avgWAS = wasScores.reduce((sum, v) => sum + v, 0) / wasScores.length;
              }
              
              // WIE Durchschnitt - nutze wieCoreScore/wieLeaderScore falls vorhanden
              const wieScores = reviewsWithGPS.map(r => {
                // Erst direkte Scores nutzen
                if (r.wieCoreScore && r.wieCoreScore > 0) {
                  if (r.includeLeadership && r.wieLeaderScore && r.wieLeaderScore > 0) {
                    return (r.wieCoreScore + r.wieLeaderScore) / 2;
                  }
                  return r.wieCoreScore;
                }
                // Sonst berechnen
                return calculateWieAverage(r);
              }).filter(s => s > 0);
              
              if (wieScores.length > 0) {
                stats.avgWIE = wieScores.reduce((sum, v) => sum + v, 0) / wieScores.length;
              }
            }
            
            // Debug-Log (kann später entfernt werden)
            console.log('📊 Team Calibration Stats:', {
              allReviews: allReviews.length,
              reviewsWithGPS: reviewsWithGPS.length,
              stats,
              sampleReview: reviewsWithGPS[0] || null
            });
            
            // === RENDER ===
            return React.createElement('div', { className: "space-y-6 pb-12" },
              
              // HERO HEADER mit Gradient (Unternehmensfarben)
              React.createElement('div', { 
                className: "rounded-2xl p-6 md:p-8 text-white shadow-xl",
                style: { background: "linear-gradient(135deg, #243186 0%, #1a2563 50%, #243186 100%)" }
              },
                // Titel-Zeile
                React.createElement('div', { className: "flex flex-col md:flex-row md:items-center md:justify-between mb-6" },
                  React.createElement('div', null,
                    React.createElement('h1', { className: "text-2xl md:text-3xl font-bold mb-2 flex items-center gap-3" },
                      React.createElement(Scale, { size: 28 }),
                      lang === 'de' ? `Team-Kalibrierung: ${teamName}` : lang === 'it' ? `Calibrazione Team: ${teamName}` : `Team Calibration: ${teamName}`
                    ),
                    React.createElement('p', { className: "text-white/80" },
                      `${stats.totalMembers} ${lang === 'de' ? 'Mitarbeiter' : lang === 'it' ? 'Collaboratori' : 'Employees'} | Review-Periode: ${currentPeriod}`
                    )
                  ),
                  // Status-Badge
                  React.createElement('div', { className: "mt-4 md:mt-0 flex items-center gap-2" },
                    React.createElement('span', { 
                      className: "bg-white/20 backdrop-blur px-4 py-2 rounded-full text-sm font-medium"
                    },
                      `${stats.draftReviews} ${lang === 'de' ? 'Entwürfe' : lang === 'it' ? 'Bozze' : 'Drafts'} | ${stats.completedReviews} ${lang === 'de' ? 'Fertig' : lang === 'it' ? 'Completate' : 'Completed'}`
                    )
                  )
                ),
                
                // Stats Grid
                reviewsWithGPS.length > 0 
                  ? React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4" },
                      // GPS Durchschnitt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, stats.avgGPS.toFixed(1)),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'GPS Ø' : lang === 'it' ? 'GPS Medio' : 'GPS Avg'
                        )
                      ),
                      // WAS Durchschnitt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, 
                          stats.avgWAS > 0 ? stats.avgWAS.toFixed(1) : '–'
                        ),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'WAS Ø' : lang === 'it' ? 'COSA Medio' : 'WHAT Avg'
                        )
                      ),
                      // WIE Durchschnitt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, stats.avgWIE.toFixed(1)),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'WIE Ø' : lang === 'it' ? 'COME Medio' : 'HOW Avg'
                        )
                      ),
                      // Standardabweichung
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, stats.stdDev.toFixed(2)),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, "Std.Dev")
                      ),
                      // Fortschritt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center col-span-2 md:col-span-1" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, 
                          `${stats.completedReviews}/${stats.totalMembers}`
                        ),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'Fortschritt' : lang === 'it' ? 'Progresso' : 'Progress'
                        )
                      )
                    )
                  : // Keine Reviews vorhanden
                    React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-6 text-center" },
                      React.createElement('p', { className: "text-white/80 text-lg" },
                        lang === 'de' 
                          ? '📋 Noch keine Reviews abgeschlossen. Starte mit dem ersten Performance Review!'
                          : '📋 Nessuna review completata. Inizia con la prima Performance Review!'
                      )
                    )
              ),
              
              // === FILTER & SORTIERUNGS-TOOLBAR ===
              reviewsWithGPS.length > 0 && React.createElement('div', { 
                className: "bg-white rounded-xl p-4 shadow-sm border border-slate-200 flex flex-col md:flex-row md:items-center gap-4"
              },
                // Filter
                React.createElement('div', { className: "flex items-center gap-2" },
                  React.createElement('span', { className: "text-sm font-medium text-slate-600" }, 
                    lang === 'de' ? 'Filter:' : lang === 'it' ? 'Filtro:' : 'Filter:'
                  ),
                  React.createElement('div', { className: "flex bg-slate-100 rounded-lg p-1" },
                    React.createElement('button', {
                      onClick: () => setCalibrationFilter('all'),
                      className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${
                        calibrationFilter === 'all' 
                          ? 'bg-white text-slate-800 shadow-sm' 
                          : 'text-slate-500 hover:text-slate-700'
                      }`
                    }, lang === 'de' ? 'Alle' : lang === 'it' ? 'Tutti' : 'All'),
                    React.createElement('button', {
                      onClick: () => setCalibrationFilter('completed'),
                      className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${
                        calibrationFilter === 'completed' 
                          ? 'bg-green-100 text-green-800 shadow-sm' 
                          : 'text-slate-500 hover:text-slate-700'
                      }`
                    }, `✓ ${lang === 'de' ? 'Fertig' : lang === 'it' ? 'Completate' : 'Completed'}`),
                    React.createElement('button', {
                      onClick: () => setCalibrationFilter('draft'),
                      className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${
                        calibrationFilter === 'draft' 
                          ? 'bg-amber-100 text-amber-800 shadow-sm' 
                          : 'text-slate-500 hover:text-slate-700'
                      }`
                    }, `✎ ${lang === 'de' ? 'Entwürfe' : lang === 'it' ? 'Bozze' : 'Drafts'}`)
                  )
                ),
                
                // Trennlinie
                React.createElement('div', { className: "hidden md:block w-px h-8 bg-slate-200" }),
                
                // Sortierung
                React.createElement('div', { className: "flex items-center gap-2" },
                  React.createElement('span', { className: "text-sm font-medium text-slate-600" }, 
                    lang === 'de' ? 'Sortieren:' : lang === 'it' ? 'Ordina:' : 'Sort:'
                  ),
                  React.createElement('select', {
                    value: `${calibrationSort.field}-${calibrationSort.direction}`,
                    onChange: (e) => {
                      const [field, direction] = e.target.value.split('-');
                      setCalibrationSort({ field, direction });
                    },
                    className: "px-3 py-1.5 text-sm border border-slate-200 rounded-lg bg-white focus:ring-2 focus:ring-[#6EBD84] outline-none"
                  },
                    React.createElement('option', { value: 'name-asc' }, lang === 'de' ? 'Name A-Z' : lang === 'it' ? 'Nome A-Z' : 'Name A-Z'),
                    React.createElement('option', { value: 'name-desc' }, lang === 'de' ? 'Name Z-A' : lang === 'it' ? 'Nome Z-A' : 'Name Z-A'),
                    React.createElement('option', { value: 'gps-desc' }, lang === 'de' ? 'GPS ↓ (höchste)' : lang === 'it' ? 'GPS ↓ (più alto)' : 'GPS ↓ (highest)'),
                    React.createElement('option', { value: 'gps-asc' }, lang === 'de' ? 'GPS ↑ (niedrigste)' : lang === 'it' ? 'GPS ↑ (più basso)' : 'GPS ↑ (lowest)'),
                    React.createElement('option', { value: 'was-desc' }, lang === 'de' ? 'WAS ↓ (höchste)' : lang === 'it' ? 'COSA ↓ (più alto)' : 'WHAT ↓ (highest)'),
                    React.createElement('option', { value: 'was-asc' }, lang === 'de' ? 'WAS ↑ (niedrigste)' : lang === 'it' ? 'COSA ↑ (più basso)' : 'WHAT ↑ (lowest)'),
                    React.createElement('option', { value: 'wie-desc' }, lang === 'de' ? 'WIE ↓ (höchste)' : lang === 'it' ? 'COME ↓ (più alto)' : 'HOW ↓ (highest)'),
                    React.createElement('option', { value: 'wie-asc' }, lang === 'de' ? 'WIE ↑ (niedrigste)' : lang === 'it' ? 'COME ↑ (più basso)' : 'HOW ↑ (lowest)')
                  )
                ),
                
                // Spacer
                React.createElement('div', { className: "flex-1" }),
                
                // Anzahl gefiltert
                React.createElement('span', { className: "text-sm text-slate-500" },
                  (() => {
                    const filtered = calibrationFilter === 'all' ? reviewsWithGPS :
                                     calibrationFilter === 'completed' ? completedReviews : draftReviews;
                    return `${filtered.length} ${lang === 'de' ? 'angezeigt' : lang === 'it' ? 'visualizzati' : 'displayed'}`;
                  })()
                )
              ),
              
              // Info-Box (falls keine Reviews)
              reviewsWithGPS.length === 0 && React.createElement('div', { 
                className: "bg-gradient-to-br from-amber-50 to-orange-50 border-2 border-amber-200 rounded-2xl p-8 text-center" 
              },
                React.createElement('div', { className: "max-w-md mx-auto" },
                  React.createElement('div', { className: "bg-amber-100 rounded-full p-4 w-16 h-16 mx-auto mb-4 flex items-center justify-center" },
                    React.createElement(Info, { size: 32, className: "text-amber-600" })
                  ),
                  React.createElement('h3', { className: "font-bold text-amber-900 text-xl mb-3" },
                    lang === 'de' ? 'Noch keine Daten für Kalibrierung' : lang === 'it' ? 'Nessun dato per la calibrazione' : 'No data for calibration yet'
                  ),
                  React.createElement('p', { className: "text-amber-800 mb-4 leading-relaxed" },
                    lang === 'de' 
                      ? 'Um Bubble Chart, Heatmap und Warnungen zu sehen, müssen zuerst Performance Reviews mit GPS-Bewertung für deine Team-Mitglieder erstellt werden.'
                      : 'Per visualizzare Bubble Chart, Heatmap e avvisi, devono prima essere create le Performance Review con valutazione GPS per i membri del team.'
                  ),
                  // Checkliste
                  React.createElement('div', { className: "bg-white rounded-xl p-4 mb-4 text-left border border-amber-200" },
                    React.createElement('div', { className: "text-sm font-medium text-amber-900 mb-2" },
                      lang === 'de' ? 'So startest du:' : lang === 'it' ? 'Come iniziare:' : 'How to start:'
                    ),
                    React.createElement('ul', { className: "text-sm text-amber-800 space-y-1.5" },
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "1."),
                        lang === 'de' ? 'Gehe zu "Mein Team"' : lang === 'it' ? 'Vai a "Il mio team"' : 'Go to "My Team"'
                      ),
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "2."),
                        lang === 'de' ? 'Wähle einen Mitarbeiter und starte ein Review' : lang === 'it' ? 'Seleziona un collaboratore e inizia una review' : 'Select an employee and start a review'
                      ),
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "3."),
                        lang === 'de' ? 'Fülle WAS (Ziele) und WIE (Kompetenzen) aus' : lang === 'it' ? 'Compila COSA (obiettivi) e COME (competenze)' : 'Fill in WHAT (goals) and HOW (competencies)'
                      ),
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "4."),
                        lang === 'de' ? 'Speichere das Review (GPS wird automatisch berechnet)' : lang === 'it' ? 'Salva la review (GPS viene calcolato automaticamente)' : 'Save the review (GPS is calculated automatically)'
                      )
                    )
                  ),
                  React.createElement('button', {
                    onClick: () => setActiveView('teamoverview'),
                    className: "flex items-center gap-2 px-6 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors font-medium mx-auto shadow-lg shadow-amber-200"
                  },
                    React.createElement(Users, { size: 18 }),
                    lang === 'de' ? 'Zu Mein Team' : lang === 'it' ? 'Vai al mio team' : 'Go to My Team'
                  ),
                  // Draft-Hinweis falls vorhanden
                  draftReviews.length > 0 && React.createElement('p', { className: "text-sm text-amber-700 mt-4" },
                    lang === 'de' 
                      ? `💡 Du hast ${draftReviews.length} Entwürfe. Schließe diese ab, um GPS-Werte zu erhalten.`
                      : `💡 Hai ${draftReviews.length} bozze. Completale per ottenere i valori GPS.`
                  )
                )
              ),
              
              // === AUTO-WARNUNGEN ===
              reviewsWithGPS.length > 0 && (() => {
                const warnings = [];
                
                // Bereite Daten für Analyse vor
                const analysisData = reviewsWithGPS.map(review => {
                  const member = teamMembers.find(m => m.id === review.employeeId);
                  const name = review.employeeName || member?.name || 'Unbekannt';
                  const coreScores = review.coreScores || {};
                  const leaderScores = review.leaderScores || {};
                  
                  return {
                    name,
                    gps: review.gpsScore || 0,
                    wasScore: review.wasScore || 0,
                    kommunikation: coreScores.komm || coreScores.c2 || 0, // Kommunikation
                    mitarbeiterfuehrung: leaderScores.lead || leaderScores.l1 || 0, // Mitarbeiterführung
                    includeLeadership: review.includeLeadership,
                    allScores: { ...coreScores, ...leaderScores }
                  };
                });
                
                // CHECK 1: Killer Criteria Verletzung
                // GPS > 2.5 aber Level 1 bei Kommunikation oder Mitarbeiterführung
                analysisData.forEach(emp => {
                  if (emp.gps > 2.5) {
                    if (emp.kommunikation > 0 && emp.kommunikation === 1) {
                      warnings.push({
                        type: 'error',
                        title: lang === 'de' ? 'Killer Criteria Verletzung' : lang === 'it' ? 'Violazione Killer Criteria' : 'Killer Criteria Violation',
                        message: lang === 'de' 
                          ? `${emp.name}: GPS ${emp.gps.toFixed(1)} trotz Level ${emp.kommunikation} bei Kommunikation → GPS sollte max. 2.5 sein!`
                          : `${emp.name}: GPS ${emp.gps.toFixed(1)} nonostante Livello ${emp.kommunikation} in Comunicazione → GPS dovrebbe essere max. 2.5!`
                      });
                    }
                    if (emp.includeLeadership && emp.mitarbeiterfuehrung > 0 && emp.mitarbeiterfuehrung === 1) {
                      warnings.push({
                        type: 'error',
                        title: lang === 'de' ? 'Killer Criteria Verletzung' : lang === 'it' ? 'Violazione Killer Criteria' : 'Killer Criteria Violation',
                        message: lang === 'de'
                          ? `${emp.name}: GPS ${emp.gps.toFixed(1)} trotz Level ${emp.mitarbeiterfuehrung} bei Mitarbeiterführung → GPS sollte max. 2.5 sein!`
                          : `${emp.name}: GPS ${emp.gps.toFixed(1)} nonostante Livello ${emp.mitarbeiterfuehrung} in Gestione Personale → GPS dovrebbe essere max. 2.5!`
                      });
                    }
                  }
                });
                
                // CHECK 2: ENTFERNT - WAS-GPS Unterschiede sind durch WIE-Komponente beabsichtigt
                // Die GPS-Formel (50% WAS + 50% WIE) führt natürlich zu unterschiedlichen GPS bei gleichem WAS
                
                // CHECK 3: Verteilungs-Probleme (nur bei ausreichender Teamgröße)
                const totalCount = analysisData.length;
                if (totalCount >= 5) {
                  // Zu viele Top-Performer (GPS >= 4.5) - nur bei mindestens 5 MA sinnvoll
                  const topPerformers = analysisData.filter(e => e.gps >= 4.5).length;
                  const topPercent = (topPerformers / totalCount) * 100;
                  if (topPercent > 25) {
                    warnings.push({
                      type: 'info',
                      title: lang === 'de' ? 'Verteilungs-Hinweis' : lang === 'it' ? 'Nota distribuzione' : 'Distribution Note',
                      message: lang === 'de'
                        ? `${topPercent.toFixed(0)}% mit GPS ≥ 4.5 (${topPerformers}/${totalCount}). Üblich: 10-20%. Bewertung prüfen?`
                        : `${topPercent.toFixed(0)}% con GPS ≥ 4.5 (${topPerformers}/${totalCount}). Normale: 10-20%. Verificare?`
                    });
                  }
                  
                  // Check für Level 1 bei irgendeiner Kompetenz mit gutem GPS
                  analysisData.forEach(emp => {
                    const hasLevel1 = Object.values(emp.allScores).some(score => score === 1);
                    if (hasLevel1 && emp.gps >= 3.5) {
                      warnings.push({
                        type: 'warning',
                        title: lang === 'de' ? 'Level 1 bei gutem GPS' : lang === 'it' ? 'Livello 1 con buon GPS' : 'Level 1 with good GPS',
                        message: lang === 'de'
                          ? `${emp.name}: GPS ${emp.gps.toFixed(1)} aber mindestens 1x Level 1. Entwicklungsbedarf?`
                          : `${emp.name}: GPS ${emp.gps.toFixed(1)} ma almeno 1x Livello 1. Necessità di sviluppo?`
                      });
                    }
                  });
                }
                
                // Render Warnungen
                if (warnings.length === 0) {
                  // Keine Warnungen - Alles OK
                  return React.createElement('div', { 
                    className: "bg-green-50 border-2 border-green-300 rounded-xl p-4 mb-6 flex items-center gap-3"
                  },
                    React.createElement('span', { className: "text-2xl" }, "✅"),
                    React.createElement('div', { className: "text-green-800" },
                      React.createElement('span', { className: "font-semibold" }, 
                        lang === 'de' ? 'Keine Warnungen' : lang === 'it' ? 'Nessun avviso' : 'No warnings'
                      ),
                      React.createElement('span', { className: "ml-2" }, 
                        lang === 'de' ? '– Deine Bewertungen sind konsistent!' : lang === 'it' ? '– Le tue valutazioni sono coerenti!' : '– Your assessments are consistent!'
                      )
                    )
                  );
                }
                
                // Warnungen anzeigen
                return React.createElement('div', { className: "space-y-3 mb-6" },
                  // Header
                  React.createElement('div', { className: "flex items-center gap-2 text-slate-600 text-sm mb-2" },
                    React.createElement(AlertCircle, { size: 16 }),
                    React.createElement('span', null, 
                      lang === 'de' 
                        ? `${warnings.length} ${warnings.length === 1 ? 'Hinweis' : 'Hinweise'} zur Kalibrierung:`
                        : `${warnings.length} ${warnings.length === 1 ? 'avviso' : 'avvisi'} per la calibrazione:`
                    )
                  ),
                  // Warnungen
                  ...warnings.slice(0, 5).map((w, idx) => {
                    let bgColor, borderColor, textColor, icon;
                    if (w.type === 'error') {
                      bgColor = 'bg-red-50'; borderColor = 'border-red-400'; textColor = 'text-red-800'; icon = '🚨';
                    } else if (w.type === 'warning') {
                      bgColor = 'bg-yellow-50'; borderColor = 'border-yellow-400'; textColor = 'text-yellow-800'; icon = '⚠️';
                    } else {
                      bgColor = 'bg-blue-50'; borderColor = 'border-blue-400'; textColor = 'text-blue-800'; icon = '💡';
                    }
                    
                    return React.createElement('div', { 
                      key: idx,
                      className: `${bgColor} border-2 ${borderColor} rounded-lg p-4 flex items-start gap-3`
                    },
                      React.createElement('span', { className: "text-xl flex-shrink-0" }, icon),
                      React.createElement('div', { className: textColor },
                        React.createElement('div', { className: "font-semibold text-sm mb-1" }, w.title),
                        React.createElement('div', { className: "text-sm" }, w.message)
                      )
                    );
                  }),
                  // Falls mehr als 5 Warnungen
                  warnings.length > 5 && React.createElement('div', { 
                    className: "text-sm text-slate-500 text-center py-2"
                  },
                    lang === 'de' 
                      ? `... und ${warnings.length - 5} weitere Hinweise`
                      : `... e altri ${warnings.length - 5} avvisi`
                  )
                );
              })(),
              
              // === BUBBLE CHART: WAS vs. WIE ===
              reviewsWithGPS.length > 0 && (() => {
                // Chart-Dimensionen
                const width = 650;
                const height = 450;
                const padding = 55;
                
                // Scale-Funktionen (0-5 auf Pixel)
                const scaleX = (was) => padding + ((was / 5) * (width - 2 * padding));
                const scaleY = (wie) => height - padding - ((wie / 5) * (height - 2 * padding));
                
                // === CI-KONFORME BUBBLE-FARBEN (strikt nach GPS-Rating) ===
                const getBubbleColor = (gps) => {
                  if (gps > 4.50) return '#16a34a'; // Rating 5: Outstanding (Green-600)
                  if (gps > 3.50) return '#10b981'; // Rating 4: Exceeds (Emerald-500)
                  if (gps > 2.50) return '#2563eb'; // Rating 3: Meets (Blue-600)
                  if (gps > 1.50) return '#f97316'; // Rating 2: Needs Improvement (Orange-500)
                  return '#dc2626';                  // Rating 1: Fail (Red-600)
                };
                
                // === ACTION CARDS basierend auf GPS-Rating (A&O-Psychologie & Führungscoach-Perspektive) ===
                const getActionCard = (gps) => {
                  if (gps > 4.50) return { 
                    icon: '🌟', 
                    rating: 'OUTSTANDING (5)', 
                    action: lang === 'de' 
                      ? '→ Karrieregespräch führen: Aufstiegsperspektiven klären\n→ Stretch-Assignments & strategische Projekte\n→ Als Mentor für andere einsetzen\n→ Retention: Bindung aktiv stärken!' 
                      : lang === 'it' 
                      ? '→ Colloquio carriera: chiarire prospettive\n→ Progetti strategici & sfidanti\n→ Usare come mentor per altri\n→ Retention: rafforzare il legame!' 
                      : '→ Career talk: clarify growth path\n→ Stretch assignments & strategic projects\n→ Deploy as mentor for others\n→ Retention: actively strengthen bond!',
                    color: '#16a34a', bg: '#dcfce7'
                  };
                  if (gps > 3.50) return { 
                    icon: '🚀', 
                    rating: 'EXCEEDS (4)', 
                    action: lang === 'de' 
                      ? '→ Stärken gezielt ausbauen & sichtbar machen\n→ Verantwortung erweitern (Job Enrichment)\n→ Als fachlicher Ansprechpartner positionieren\n→ Entwicklungsziel für nächstes Level definieren' 
                      : lang === 'it' 
                      ? '→ Sviluppare punti di forza & renderli visibili\n→ Ampliare responsabilità (Job Enrichment)\n→ Posizionare come referente tecnico\n→ Definire obiettivo per il prossimo livello' 
                      : '→ Leverage strengths & increase visibility\n→ Expand responsibility (Job Enrichment)\n→ Position as subject matter expert\n→ Define goal for next level',
                    color: '#10b981', bg: '#d1fae5'
                  };
                  if (gps > 2.50) return { 
                    icon: '✅', 
                    rating: 'MEETS (3)', 
                    action: lang === 'de' 
                      ? '→ Wertschätzung aussprechen – Rückgrat des Teams!\n→ Stabilität anerkennen, nicht nur "Stars" loben\n→ Individuelle Stärken identifizieren & nutzen\n→ Bei Interesse: gezielte Entwicklungsimpulse' 
                      : lang === 'it' 
                      ? '→ Esprimere apprezzamento – spina dorsale!\n→ Riconoscere stabilità, non solo le "star"\n→ Identificare & utilizzare punti di forza\n→ Se interessato: impulsi di sviluppo mirati' 
                      : '→ Express appreciation – team backbone!\n→ Recognize stability, not just "stars"\n→ Identify & leverage individual strengths\n→ If interested: targeted development',
                    color: '#2563eb', bg: '#dbeafe'
                  };
                  if (gps > 1.50) return { 
                    icon: '⚠️', 
                    rating: 'NEEDS IMPR. (2)', 
                    action: lang === 'de' 
                      ? '→ Ursachenanalyse: Kompetenz, Motivation oder Kontext?\n→ Klare Erwartungen & messbare Ziele setzen\n→ Engmaschiges Feedback (alle 2-4 Wochen)\n→ 90-Tage-Entwicklungsplan mit Meilensteinen' 
                      : lang === 'it' 
                      ? '→ Analisi cause: competenza, motivazione o contesto?\n→ Aspettative chiare & obiettivi misurabili\n→ Feedback frequente (ogni 2-4 settimane)\n→ Piano sviluppo 90 giorni con milestone' 
                      : '→ Root cause: skill, motivation or context?\n→ Clear expectations & measurable goals\n→ Frequent feedback (every 2-4 weeks)\n→ 90-day development plan with milestones',
                    color: '#f97316', bg: '#ffedd5'
                  };
                  return { 
                    icon: '🚨', 
                    rating: 'FAIL (1)', 
                    action: lang === 'de' 
                      ? '→ Sofortiges HR-Gespräch ansetzen\n→ Schriftlicher PIP mit klaren Konsequenzen\n→ Wöchentliche Check-ins dokumentieren\n→ Rollenpassung & Alternativen prüfen' 
                      : lang === 'it' 
                      ? '→ Colloquio HR immediato\n→ PIP scritto con conseguenze chiare\n→ Check-in settimanali documentati\n→ Verificare idoneità ruolo & alternative' 
                      : '→ Schedule immediate HR meeting\n→ Written PIP with clear consequences\n→ Document weekly check-ins\n→ Review role fit & alternatives',
                    color: '#dc2626', bg: '#fee2e2'
                  };
                };
                
                // Initialen aus Name
                const getInitials = (name) => {
                  const parts = name.trim().split(' ');
                  if (parts.length >= 2) {
                    return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
                  }
                  return name.substring(0, 2).toUpperCase();
                };
                
                // Bereite Mitarbeiter-Daten auf
                const bubbleData = reviewsWithGPS.map(review => {
                  const member = teamMembers.find(m => m.id === review.employeeId);
                  const name = review.employeeName || member?.name || 'Unknown';
                  const wasScore = review.wasScore || 0;
                  const coreScores = review.coreScores || {};
                  const leaderScores = review.leaderScores || {};
                  
                  const allWieScores = [
                    ...Object.values(coreScores).filter(v => v > 0),
                    ...(review.includeLeadership ? Object.values(leaderScores).filter(v => v > 0) : [])
                  ];
                  const wieAvg = allWieScores.length > 0 
                    ? allWieScores.reduce((s, v) => s + v, 0) / allWieScores.length 
                    : 0;
                  
                  return {
                    name,
                    gps: review.gpsScore || 0,
                    was: wasScore,
                    wie: wieAvg,
                    initials: getInitials(name)
                  };
                }).filter(e => e.gps > 0);
                
                // === SOLID BACKBONE ZONE (Rating 3 = 2.5 bis 3.5) ===
                const solidBackboneX1 = scaleX(2.5);
                const solidBackboneX2 = scaleX(3.5);
                const solidBackboneY1 = scaleY(3.5);
                const solidBackboneY2 = scaleY(2.5);
                
                // === 4 ARCHETYPEN-ZONEN ===
                const zones = [
                  { 
                    id: 'handlungsbedarf',
                    name: lang === 'de' ? 'HANDLUNGSBEDARF' : lang === 'it' ? 'AZIONE RICHIESTA' : 'ACTION REQUIRED',
                    x: padding, 
                    y: scaleY(2.5), 
                    w: scaleX(2.5) - padding, 
                    h: height - padding - scaleY(2.5),
                    fill: '#fee2e2', textColor: '#991b1b', icon: '🚨'
                  },
                  { 
                    id: 'solo-star',
                    name: 'SOLO STAR',
                    x: scaleX(2.5), 
                    y: scaleY(2.5), 
                    w: width - padding - scaleX(2.5), 
                    h: height - padding - scaleY(2.5),
                    fill: '#ffedd5', textColor: '#9a3412', icon: '🎯'
                  },
                  { 
                    id: 'hidden-gem',
                    name: 'HIDDEN GEM',
                    x: padding, 
                    y: padding, 
                    w: scaleX(2.5) - padding, 
                    h: scaleY(2.5) - padding,
                    fill: '#fef9c3', textColor: '#854d0e', icon: '💎'
                  },
                  { 
                    id: 'role-model',
                    name: 'ROLE MODEL',
                    x: scaleX(2.5), 
                    y: padding, 
                    w: width - padding - scaleX(2.5), 
                    h: scaleY(2.5) - padding,
                    fill: '#dcfce7', textColor: '#166534', icon: '⭐'
                  }
                ];
                
                return React.createElement('div', { className: "bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-slate-200 mb-6" },
                  // Header mit Icon
                  React.createElement('div', { className: "flex items-center justify-between mb-6" },
                    React.createElement('div', { className: "flex items-center gap-3" },
                      React.createElement('div', { className: "w-12 h-12 rounded-xl bg-gradient-to-br from-[#243186] to-[#1a2564] flex items-center justify-center shadow-lg" },
                        React.createElement('span', { className: "text-2xl" }, "📊")
                      ),
                      React.createElement('div', null,
                        React.createElement('h3', { className: "text-xl md:text-2xl font-bold", style: { color: "#243186" } },
                          lang === 'de' ? 'GPS-Verteilung (9-Box Grid)' : lang === 'it' ? 'Distribuzione GPS (9-Box Grid)' : 'GPS Distribution (9-Box Grid)'
                        ),
                        React.createElement('p', { className: "text-sm text-slate-500" },
                          lang === 'de' ? 'WAS (Ergebnisse) vs. WIE (Verhalten)' : lang === 'it' ? 'COSA (Risultati) vs. COME (Comportamento)' : 'WHAT (Results) vs. HOW (Behavior)'
                        )
                      )
                    ),
                    // Legende (Rating-Farben)
                    React.createElement('div', { className: "hidden lg:flex items-center gap-3 text-xs" },
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#dc2626' } }),
                        React.createElement('span', { className: "text-slate-600" }, "1 (≤1.5)")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#f97316' } }),
                        React.createElement('span', { className: "text-slate-600" }, "2")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#2563eb' } }),
                        React.createElement('span', { className: "text-slate-600" }, "3")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#10b981' } }),
                        React.createElement('span', { className: "text-slate-600" }, "4")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#16a34a' } }),
                        React.createElement('span', { className: "text-slate-600" }, "5 (>4.5)")
                      )
                    )
                  ),
                  
                  // Chart Container
                  React.createElement('div', { className: "relative", style: { maxWidth: '850px', margin: '0 auto' } },
                    
                    // SVG Chart
                    React.createElement('svg', { 
                      viewBox: `0 0 ${width} ${height}`, 
                      className: "w-full h-auto",
                      style: { minHeight: '420px' }
                    },
                      // Definitionen (Schatten, etc.)
                      React.createElement('defs', null,
                        React.createElement('filter', { id: 'bubbleShadow', x: '-50%', y: '-50%', width: '200%', height: '200%' },
                          React.createElement('feDropShadow', { dx: '0', dy: '3', stdDeviation: '4', floodOpacity: '0.25' })
                        )
                      ),
                      
                      // === 4 ARCHETYPEN-ZONEN (Hintergrund) ===
                      ...zones.map(zone => 
                        React.createElement('g', { key: zone.id },
                          // Zone-Rechteck
                          React.createElement('rect', {
                            x: zone.x, y: zone.y, width: zone.w, height: zone.h,
                            fill: zone.fill, opacity: 0.7
                          }),
                          // Zone-Icon
                          React.createElement('text', {
                            x: zone.x + zone.w / 2, y: zone.y + zone.h / 2 - 8,
                            textAnchor: 'middle', fontSize: '28', opacity: 0.5
                          }, zone.icon),
                          // Zone-Label
                          React.createElement('text', {
                            x: zone.x + zone.w / 2, y: zone.y + zone.h / 2 + 20,
                            textAnchor: 'middle', fontSize: '11', fontWeight: 700,
                            fill: zone.textColor, opacity: 0.9
                          }, zone.name)
                        )
                      ),
                      
                      // === SOLID BACKBONE ZONE (Rating 3 - Meets Expectations) ===
                      React.createElement('rect', {
                        x: solidBackboneX1, y: solidBackboneY1,
                        width: solidBackboneX2 - solidBackboneX1,
                        height: solidBackboneY2 - solidBackboneY1,
                        fill: 'rgba(255,255,255,0.6)',
                        stroke: '#243186', strokeWidth: 2, strokeDasharray: '8,4',
                        rx: 6
                      }),
                      React.createElement('text', {
                        x: (solidBackboneX1 + solidBackboneX2) / 2, 
                        y: (solidBackboneY1 + solidBackboneY2) / 2 + 4,
                        textAnchor: 'middle', fontSize: '10', fontWeight: 600,
                        fill: '#243186', opacity: 0.8
                      }, 'SOLID BACKBONE'),
                      React.createElement('text', {
                        x: (solidBackboneX1 + solidBackboneX2) / 2, 
                        y: (solidBackboneY1 + solidBackboneY2) / 2 + 18,
                        textAnchor: 'middle', fontSize: '9', 
                        fill: '#243186', opacity: 0.6
                      }, '(Rating 3)'),
                      
                      // === ACHSEN-LABELS (CI-Blau) ===
                      React.createElement('text', {
                        x: width / 2, y: height - 8, textAnchor: 'middle',
                        fontSize: '13', fill: '#243186', fontWeight: 600
                      }, lang === 'de' ? 'WAS: Ergebnisse (Ziele) →' : lang === 'it' ? 'COSA: Risultati (Obiettivi) →' : 'WHAT: Results (Goals) →'),
                      
                      React.createElement('text', {
                        x: 14, y: height / 2, textAnchor: 'middle',
                        transform: `rotate(-90 14 ${height / 2})`,
                        fontSize: '13', fill: '#243186', fontWeight: 600
                      }, lang === 'de' ? '↑ WIE: Verhalten (Kompetenzen)' : lang === 'it' ? '↑ COME: Comportamento (Competenze)' : '↑ HOW: Behavior (Competencies)'),
                      
                      // === SKALA X-ACHSE ===
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('g', { key: `x-${v}` },
                          React.createElement('line', {
                            x1: scaleX(v), y1: height - padding, x2: scaleX(v), y2: height - padding + 6,
                            stroke: '#243186', strokeWidth: 1.5
                          }),
                          React.createElement('text', {
                            x: scaleX(v), y: height - padding + 20, textAnchor: 'middle',
                            fontSize: '12', fill: '#243186', fontWeight: 500
                          }, v)
                        )
                      ),
                      
                      // === SKALA Y-ACHSE ===
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('g', { key: `y-${v}` },
                          React.createElement('line', {
                            x1: padding - 6, y1: scaleY(v), x2: padding, y2: scaleY(v),
                            stroke: '#243186', strokeWidth: 1.5
                          }),
                          React.createElement('text', {
                            x: padding - 14, y: scaleY(v) + 4, textAnchor: 'middle',
                            fontSize: '12', fill: '#243186', fontWeight: 500
                          }, v)
                        )
                      ),
                      
                      // === GRID-LINIEN (dezent) ===
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('line', {
                          key: `grid-x-${v}`,
                          x1: scaleX(v), y1: padding, x2: scaleX(v), y2: height - padding,
                          stroke: v === 3 ? '#243186' : '#cbd5e1', 
                          strokeWidth: v === 3 ? 1.5 : 0.5,
                          strokeDasharray: v === 3 ? '6,3' : 'none',
                          opacity: v === 3 ? 0.6 : 0.5
                        })
                      ),
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('line', {
                          key: `grid-y-${v}`,
                          x1: padding, y1: scaleY(v), x2: width - padding, y2: scaleY(v),
                          stroke: v === 3 ? '#243186' : '#cbd5e1', 
                          strokeWidth: v === 3 ? 1.5 : 0.5,
                          strokeDasharray: v === 3 ? '6,3' : 'none',
                          opacity: v === 3 ? 0.6 : 0.5
                        })
                      ),
                      
                      // === BUBBLES (Mitarbeiter) ===
                      ...bubbleData.map((emp, idx) => {
                        // Deterministischer Jitter basierend auf Name
                        const hashCode = (str) => {
                          let hash = 0;
                          for (let i = 0; i < str.length; i++) {
                            hash = ((hash << 5) - hash) + str.charCodeAt(i);
                            hash = hash & hash;
                          }
                          return hash;
                        };
                        
                        const nameHash = hashCode(emp.name || `emp${idx}`);
                        const jitterX = ((nameHash % 21) - 10);
                        const jitterY = (((nameHash >> 8) % 21) - 10);
                        
                        const baseCx = scaleX(emp.was || 3);
                        const baseCy = scaleY(emp.wie || 3);
                        const cx = Math.max(padding + 20, Math.min(width - padding - 20, baseCx + jitterX));
                        const cy = Math.max(padding + 20, Math.min(height - padding - 20, baseCy + jitterY));
                        
                        const r = Math.max(20, Math.min(38, emp.gps * 7.5));
                        const color = getBubbleColor(emp.gps);
                        
                        return React.createElement('g', { 
                          key: idx,
                          style: { cursor: 'pointer' },
                          onMouseEnter: () => setBubbleTooltip({ ...emp, cx, cy, r, actionCard: getActionCard(emp.gps) }),
                          onMouseLeave: () => setBubbleTooltip(null)
                        },
                          // Bubble mit Schatten
                          React.createElement('circle', {
                            cx, cy, r,
                            fill: color,
                            opacity: 0.85,
                            filter: 'url(#bubbleShadow)',
                            className: 'transition-all duration-200 hover:opacity-100'
                          }),
                          // Weißer Ring
                          React.createElement('circle', {
                            cx, cy, r: r - 2,
                            fill: 'none', stroke: 'white', strokeWidth: 2.5, opacity: 0.6
                          }),
                          // Initialen
                          React.createElement('text', {
                            x: cx, y: cy, textAnchor: 'middle', dy: '0.35em',
                            fill: 'white', fontWeight: 700, fontSize: r > 26 ? '14px' : '11px',
                            style: { textShadow: '0 1px 3px rgba(0,0,0,0.4)' }
                          }, emp.initials)
                        );
                      })
                    ),
                    
                    // === TOOLTIP MIT ACTION CARD ===
                    bubbleTooltip && (() => {
                      const tooltipX = (bubbleTooltip.cx / width) * 100;
                      const tooltipY = ((bubbleTooltip.cy - bubbleTooltip.r - 10) / height) * 100;
                      const showBelow = tooltipY < 20;
                      const adjustLeft = tooltipX < 20 ? 'translateX(-5%)' : tooltipX > 80 ? 'translateX(-95%)' : 'translateX(-50%)';
                      const action = bubbleTooltip.actionCard;
                      
                      return React.createElement('div', {
                        className: "absolute bg-white text-slate-800 rounded-xl shadow-2xl text-sm z-50 pointer-events-none border border-slate-200 overflow-hidden",
                        style: { 
                          left: `${tooltipX}%`, 
                          top: showBelow 
                            ? `${((bubbleTooltip.cy + bubbleTooltip.r + 10) / height) * 100}%`
                            : `${tooltipY}%`,
                          transform: showBelow ? `${adjustLeft} translateY(0)` : `${adjustLeft} translateY(-100%)`,
                          minWidth: '220px',
                          maxWidth: '280px'
                        }
                      },
                        // Header mit Name
                        React.createElement('div', { 
                          className: "px-4 py-3 border-b border-slate-100",
                          style: { backgroundColor: '#243186' }
                        },
                          React.createElement('div', { className: "font-bold text-white" }, bubbleTooltip.name)
                        ),
                        // GPS Score
                        React.createElement('div', { className: "px-4 py-3" },
                          React.createElement('div', { className: "flex items-center justify-between mb-3" },
                            React.createElement('span', { className: "text-slate-500 text-xs uppercase tracking-wide" }, "GPS Score"),
                            React.createElement('span', { 
                              className: "text-2xl font-bold",
                              style: { color: action.color }
                            }, bubbleTooltip.gps.toFixed(2))
                          ),
                          // WAS & WIE
                          React.createElement('div', { className: "grid grid-cols-2 gap-2 text-xs mb-3" },
                            React.createElement('div', { className: "bg-slate-50 rounded p-2 text-center" },
                              React.createElement('div', { className: "text-slate-400 mb-0.5" }, "WAS"),
                              React.createElement('div', { className: "font-semibold text-sm" }, bubbleTooltip.was > 0 ? bubbleTooltip.was.toFixed(1) : '–')
                            ),
                            React.createElement('div', { className: "bg-slate-50 rounded p-2 text-center" },
                              React.createElement('div', { className: "text-slate-400 mb-0.5" }, "WIE"),
                              React.createElement('div', { className: "font-semibold text-sm" }, bubbleTooltip.wie > 0 ? bubbleTooltip.wie.toFixed(1) : '–')
                            )
                          ),
                          // === ACTION CARD ===
                          React.createElement('div', { 
                            className: "rounded-lg p-3 text-xs",
                            style: { backgroundColor: action.bg }
                          },
                            React.createElement('div', { 
                              className: "font-bold mb-1 flex items-center gap-1.5",
                              style: { color: action.color }
                            },
                              React.createElement('span', null, action.icon),
                              React.createElement('span', null, action.rating)
                            ),
                            React.createElement('div', { className: "text-slate-700" },
                              React.createElement('span', { className: "font-medium" }, 'Action: '),
                              action.action
                            )
                          )
                        )
                      );
                    })()
                  ),
                  
                  // Mobile Legende
                  React.createElement('div', { className: "flex lg:hidden flex-wrap justify-center gap-2 mt-4 text-xs" },
                    [
                      { color: '#dc2626', label: '1' },
                      { color: '#f97316', label: '2' },
                      { color: '#2563eb', label: '3' },
                      { color: '#10b981', label: '4' },
                      { color: '#16a34a', label: '5' }
                    ].map((item, i) => 
                      React.createElement('div', { key: i, className: "flex items-center gap-1" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: item.color } }),
                        React.createElement('span', { className: "text-slate-600" }, item.label)
                      )
                    )
                  ),
                  
                  // === ARCHETYPEN-ERKLÄRUNG ===
                  React.createElement('div', { className: "mt-6 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-5 border border-slate-200" },
                    React.createElement('h4', { className: "text-sm font-bold mb-4 flex items-center gap-2", style: { color: '#243186' } },
                      React.createElement(Info, { size: 16 }),
                      lang === 'de' ? 'Die 4 Archetypen verstehen' : lang === 'it' ? 'Capire i 4 archetipi' : 'Understanding the 4 Archetypes'
                    ),
                    React.createElement('div', { className: "grid md:grid-cols-2 gap-3" },
                      // ROLE MODEL (oben rechts)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#166534' } },
                        React.createElement('span', { className: "text-xl" }, "⭐"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#166534' } }, "ROLE MODEL"),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'High WAS + High WIE. Vorbilder, Mentoren, Beförderungskandidaten.'
                              : lang === 'it' ? 'High COSA + High COME. Modelli, mentori, candidati promozione.'
                              : 'High WHAT + High HOW. Role models, mentors, promotion candidates.'
                          )
                        )
                      ),
                      // HIDDEN GEM (oben links)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#854d0e' } },
                        React.createElement('span', { className: "text-xl" }, "💎"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#854d0e' } }, "HIDDEN GEM"),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'Low WAS + High WIE. Tolles Verhalten, braucht klarere Ziele.'
                              : lang === 'it' ? 'Low COSA + High COME. Ottimo comportamento, serve obiettivi chiari.'
                              : 'Low WHAT + High HOW. Great behavior, needs clearer goals.'
                          )
                        )
                      ),
                      // SOLO STAR (unten rechts)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#9a3412' } },
                        React.createElement('span', { className: "text-xl" }, "🎯"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#9a3412' } }, "SOLO STAR"),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'High WAS + Low WIE. Erreicht Ziele, aber WIE ist problematisch. Verhaltens-Coaching nötig.'
                              : lang === 'it' ? 'High COSA + Low COME. Raggiunge obiettivi, ma COME problematico. Serve coaching.'
                              : 'High WHAT + Low HOW. Achieves goals, but HOW is problematic. Behavior coaching needed.'
                          )
                        )
                      ),
                      // HANDLUNGSBEDARF (unten links)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#991b1b' } },
                        React.createElement('span', { className: "text-xl" }, "🚨"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#991b1b' } }, 
                            lang === 'de' ? 'HANDLUNGSBEDARF' : lang === 'it' ? 'AZIONE RICHIESTA' : 'ACTION REQUIRED'
                          ),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'Low WAS + Low WIE. Intensive Unterstützung oder Rollenpassung prüfen.'
                              : lang === 'it' ? 'Low COSA + Low COME. Supporto intensivo o valutare cambio ruolo.'
                              : 'Low WHAT + Low HOW. Intensive support or review role fit.'
                          )
                        )
                      )
                    )
                  ),
                  
                  // Kompakter Hinweis
                  React.createElement('p', { className: "text-xs text-slate-500 mt-4 text-center" },
                    lang === 'de' 
                      ? '💡 Bubble-Größe = GPS-Score | Farbe = Rating (1-5) | Gestrichelte Box = Solid Backbone (Rating 3)'
                      : lang === 'it' ? '💡 Dimensione bolla = GPS | Colore = Rating (1-5) | Box tratteggiata = Solid Backbone (Rating 3)'
                      : '💡 Bubble size = GPS score | Color = Rating (1-5) | Dashed box = Solid Backbone (Rating 3)'
                  )
                );
              })(),
              
              // === KOMPETENZ-HEATMAP ===
              // Zeige ALLE Reviews (auch Entwürfe), nicht nur die mit GPS > 0
              allReviews.length > 0 && (() => {
                // Hilfsfunktionen für Farbcodierung (Unternehmensfarben)
                const getColorForGPS = (gps) => {
                  if (!gps || gps <= 0) return 'bg-slate-100 text-slate-400';
                  if (gps < 2.0) return 'bg-red-100 text-red-800';
                  if (gps < 2.5) return 'bg-orange-100 text-orange-800';
                  if (gps < 3.5) return 'bg-[#E8F5ED] text-[#243186]'; // Niederwieser Blau auf hellem Grün
                  return 'bg-[#6EBD84] text-white'; // Niederwieser Grün
                };
                
                const getColorForLevel = (level) => {
                  if (!level || level <= 0) return 'bg-slate-50 text-slate-400';
                  if (level <= 1.4) return 'bg-red-100 text-red-800';
                  if (level <= 2.4) return 'bg-orange-100 text-orange-800';
                  if (level <= 3.4) return 'bg-[#E8F5ED] text-[#243186]'; // Niederwieser Blau
                  return 'bg-[#6EBD84] text-white'; // Niederwieser Grün
                };
                
                // Kompetenz-IDs
                const coreCompIds = ['fach', 'komm', 'prob', 'adapt', 'orga'];
                const leaderCompIds = ['lead', 'strat', 'decide', 'exec', 'stake'];
                
                // Kompetenz-Labels (kurz) - mit korrekten IDs
                const compLabels = {
                  de: { fach: 'Fach', komm: 'Komm', prob: 'Prob', adapt: 'Adapt', orga: 'Orga', lead: 'Führung', strat: 'Strat', decide: 'Entsch', exec: 'Exec', stake: 'Stakeh' },
                  it: { fach: 'Tecn', komm: 'Comm', prob: 'Prob', adapt: 'Adatt', orga: 'Orga', lead: 'Lead', strat: 'Strat', decide: 'Decis', exec: 'Exec', stake: 'Stakeh' },
                  en: { fach: 'Tech', komm: 'Comm', prob: 'Prob', adapt: 'Adapt', orga: 'Orga', lead: 'Lead', strat: 'Strat', decide: 'Decis', exec: 'Exec', stake: 'Stakeh' }
                };
                const labels = compLabels[lang] || compLabels.de;
                
                // Prüfe ob mindestens ein Review Leadership hat
                const hasAnyLeadership = allReviews.some(r => r.includeLeadership && r.leaderScores);
                
                // === FILTER ANWENDEN ===
                const filteredReviews = (() => {
                  if (calibrationFilter === 'completed') {
                    return allReviews.filter(r => r.status === 'completed');
                  } else if (calibrationFilter === 'draft') {
                    return allReviews.filter(r => r.status === 'draft' || !r.status);
                  }
                  return allReviews;
                })();
                
                // Bereite Mitarbeiter-Daten auf
                const employeeData = filteredReviews.map(review => {
                  // Finde Mitarbeiter-Name
                  const member = teamMembers.find(m => m.id === review.employeeId);
                  const name = review.employeeName || member?.name || (lang === 'de' ? 'Unbekannt' : lang === 'it' ? 'Sconosciuto' : 'Unknown');
                  
                  // WAS Score (direkt oder berechnet)
                  const wasScore = review.wasScore || 0;
                  
                  // WIE Scores - normalisiere IDs (unterstütze alle Formate)
                  const rawCoreScores = review.coreScores || {};
                  const rawLeaderScores = review.leaderScores || {};
                  
                  // Normalisiere Core Scores (unterstütze ALLE ID-Formate)
                  // Format 1: fach, komm, prob, adapt, orga (neu)
                  // Format 2: c1, c2, c3, c4, c5 (alt)
                  // Format 3: Numerische IDs von Math.random() (ganz alt)
                  const coreKeys = Object.keys(rawCoreScores);
                  const coreValues = Object.values(rawCoreScores).filter(v => typeof v === 'number' && v > 0);
                  
                  // Wenn numerische Keys, dann nach Position mappen
                  const isNumericKeys = coreKeys.length > 0 && coreKeys.every(k => !isNaN(parseFloat(k)));
                  
                  let coreScores;
                  if (isNumericKeys && coreValues.length >= 5) {
                    // Alte Math.random() IDs - nimm die ersten 5 numerischen Werte
                    const sortedKeys = coreKeys.sort();
                    coreScores = {
                      fach: rawCoreScores[sortedKeys[0]] || 0,
                      komm: rawCoreScores[sortedKeys[1]] || 0,
                      prob: rawCoreScores[sortedKeys[2]] || 0,
                      adapt: rawCoreScores[sortedKeys[3]] || 0,
                      orga: rawCoreScores[sortedKeys[4]] || 0
                    };
                  } else {
                    // Standard: fach/komm oder c1/c2 Format
                    coreScores = {
                      fach: rawCoreScores.fach || rawCoreScores.c1 || 0,
                      komm: rawCoreScores.komm || rawCoreScores.c2 || 0,
                      prob: rawCoreScores.prob || rawCoreScores.c3 || 0,
                      adapt: rawCoreScores.adapt || rawCoreScores.c4 || 0,
                      orga: rawCoreScores.orga || rawCoreScores.c5 || 0
                    };
                  }
                  
                  // Gleiches für Leader Scores
                  const leaderKeys = Object.keys(rawLeaderScores);
                  const leaderValues = Object.values(rawLeaderScores).filter(v => typeof v === 'number' && v > 0);
                  const isNumericLeaderKeys = leaderKeys.length > 0 && leaderKeys.every(k => !isNaN(parseFloat(k)));
                  
                  let leaderScores;
                  if (isNumericLeaderKeys && leaderValues.length >= 5) {
                    const sortedKeys = leaderKeys.sort();
                    leaderScores = {
                      lead: rawLeaderScores[sortedKeys[0]] || 0,
                      strat: rawLeaderScores[sortedKeys[1]] || 0,
                      decide: rawLeaderScores[sortedKeys[2]] || 0,
                      exec: rawLeaderScores[sortedKeys[3]] || 0,
                      stake: rawLeaderScores[sortedKeys[4]] || 0
                    };
                  } else {
                    leaderScores = {
                      lead: rawLeaderScores.lead || rawLeaderScores.l1 || 0,
                      strat: rawLeaderScores.strat || rawLeaderScores.l2 || 0,
                      decide: rawLeaderScores.decide || rawLeaderScores.l3 || 0,
                      exec: rawLeaderScores.exec || rawLeaderScores.l4 || 0,
                      stake: rawLeaderScores.stake || rawLeaderScores.l5 || 0
                    };
                  }
                  
                  // WIE Durchschnitt
                  const allWieScores = [
                    ...Object.values(coreScores).filter(v => v > 0),
                    ...(review.includeLeadership ? Object.values(leaderScores).filter(v => v > 0) : [])
                  ];
                  const wieAvg = allWieScores.length > 0 
                    ? allWieScores.reduce((s, v) => s + v, 0) / allWieScores.length 
                    : 0;
                  
                  return {
                    id: review.id,
                    employeeId: review.employeeId,
                    name,
                    status: review.status,
                    gps: review.gpsScore || 0,
                    wasScore,
                    wieAvg,
                    coreScores,
                    leaderScores,
                    includeLeadership: review.includeLeadership,
                    note: calibrationNotes[review.id] || '' // Notiz hinzufügen
                  };
                })
                // === SORTIERUNG ANWENDEN ===
                .sort((a, b) => {
                  const { field, direction } = calibrationSort;
                  let comparison = 0;
                  
                  switch (field) {
                    case 'name':
                      comparison = a.name.localeCompare(b.name);
                      break;
                    case 'gps':
                      comparison = a.gps - b.gps;
                      break;
                    case 'was':
                      comparison = a.wasScore - b.wasScore;
                      break;
                    case 'wie':
                      comparison = a.wieAvg - b.wieAvg;
                      break;
                    default:
                      comparison = a.name.localeCompare(b.name);
                  }
                  
                  return direction === 'desc' ? -comparison : comparison;
                });
                
                // Team-Durchschnitte berechnen
                const calcAvg = (arr) => arr.length > 0 ? arr.reduce((s, v) => s + v, 0) / arr.length : 0;
                
                const teamAvg = {
                  gps: calcAvg(employeeData.map(e => e.gps).filter(v => v > 0)),
                  was: calcAvg(employeeData.map(e => e.wasScore).filter(v => v > 0)),
                  wie: calcAvg(employeeData.map(e => e.wieAvg).filter(v => v > 0)),
                  core: {},
                  leader: {}
                };
                
                // Durchschnitte pro Kompetenz
                coreCompIds.forEach(id => {
                  const vals = employeeData.map(e => e.coreScores[id]).filter(v => v > 0);
                  teamAvg.core[id] = calcAvg(vals);
                });
                
                if (hasAnyLeadership) {
                  leaderCompIds.forEach(id => {
                    const vals = employeeData.filter(e => e.includeLeadership).map(e => e.leaderScores[id]).filter(v => v > 0);
                    teamAvg.leader[id] = calcAvg(vals);
                  });
                }
                
                // Debug-Log für Heatmap-Daten
                console.log('🔥 Heatmap Data:', {
                  employeeCount: employeeData.length,
                  hasLeadership: hasAnyLeadership,
                  teamAvg,
                  sampleEmployee: employeeData[0] || null,
                  colorTest: {
                    level1: getColorForLevel(1),
                    level2: getColorForLevel(2),
                    level3: getColorForLevel(3),
                    level4: getColorForLevel(4),
                    level5: getColorForLevel(5),
                    gps2_0: getColorForGPS(2.0),
                    gps3_0: getColorForGPS(3.0),
                    gps4_0: getColorForGPS(4.0)
                  }
                });
                
                // Render Heatmap
                return React.createElement('div', { className: "bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-slate-200" },
                  // Header
                  React.createElement('div', { className: "flex flex-col md:flex-row md:items-center md:justify-between mb-4" },
                    React.createElement('h3', { className: "text-xl md:text-2xl font-bold flex items-center gap-2", style: { color: "#243186" } },
                      "🔥 ", lang === 'de' ? 'Kompetenz-Heatmap' : lang === 'it' ? 'Heatmap Competenze' : 'Competency Heatmap'
                    ),
                    // Legende (Unternehmensfarben)
                    React.createElement('div', { className: "flex flex-wrap gap-2 mt-3 md:mt-0 text-xs" },
                      React.createElement('span', { className: "px-2 py-1 rounded bg-red-100 text-red-800" }, "1 Kritisch"),
                      React.createElement('span', { className: "px-2 py-1 rounded bg-orange-100 text-orange-800" }, "2 Below"),
                      React.createElement('span', { className: "px-2 py-1 rounded bg-[#E8F5ED] text-[#243186]" }, "3 Baseline"),
                      React.createElement('span', { className: "px-2 py-1 rounded bg-[#6EBD84] text-white" }, "4-5 Top")
                    )
                  ),
                  
                  // === COACHING-INFO BOX ===
                  React.createElement('div', { className: "mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100" },
                    React.createElement('div', { className: "flex items-start gap-3" },
                      React.createElement('div', { className: "w-10 h-10 rounded-lg bg-[#243186] flex items-center justify-center flex-shrink-0" },
                        React.createElement(MessageCircle, { size: 20, className: "text-white" })
                      ),
                      React.createElement('div', { className: "flex-1" },
                        React.createElement('h4', { className: "font-bold text-[#243186] text-sm mb-2" },
                          lang === 'de' ? '💡 Coaching-Tipps für das Feedbackgespräch' : lang === 'it' ? '💡 Suggerimenti di coaching per il colloquio' : '💡 Coaching Tips for Feedback Conversations'
                        ),
                        React.createElement('div', { className: "grid md:grid-cols-2 gap-3 text-xs text-slate-700" },
                          React.createElement('div', { className: "flex items-start gap-2" },
                            React.createElement('span', { className: "text-red-500 font-bold" }, "1-2:"),
                            React.createElement('span', null, 
                              lang === 'de' ? 'Konkretes Beispiel erfragen. Gemeinsam 1-2 Maßnahmen definieren. Follow-up in 4 Wochen.'
                              : lang === 'it' ? 'Chiedere esempio concreto. Definire insieme 1-2 azioni. Follow-up in 4 settimane.'
                              : 'Ask for concrete example. Define 1-2 actions together. Follow-up in 4 weeks.'
                            )
                          ),
                          React.createElement('div', { className: "flex items-start gap-2" },
                            React.createElement('span', { className: "text-[#6EBD84] font-bold" }, "4-5:"),
                            React.createElement('span', null, 
                              lang === 'de' ? 'Stärke anerkennen! Fragen: "Wie können Sie das Team damit unterstützen?"'
                              : lang === 'it' ? 'Riconoscere il punto di forza! Chiedere: "Come può supportare il team con questo?"'
                              : 'Acknowledge strength! Ask: "How can you support the team with this?"'
                            )
                          )
                        )
                      )
                    )
                  ),
                  
                  // === KOMPETENZ-ERKLÄRUNGEN (aufklappbar) ===
                  React.createElement('details', { className: "mb-6 group" },
                    React.createElement('summary', { className: "cursor-pointer text-sm font-medium text-[#243186] hover:text-[#1a2564] flex items-center gap-2" },
                      React.createElement(HelpCircle, { size: 16 }),
                      lang === 'de' ? 'Kompetenzen erklärt + Coaching-Fragen' : lang === 'it' ? 'Competenze spiegate + Domande di coaching' : 'Competencies explained + Coaching questions'
                    ),
                    React.createElement('div', { className: "mt-4 grid md:grid-cols-2 gap-3" },
                      // Kernkompetenzen
                      React.createElement('div', { className: "space-y-2" },
                        React.createElement('h5', { className: "font-bold text-slate-700 text-xs uppercase tracking-wide mb-2" }, 
                          lang === 'de' ? '📋 Kernkompetenzen' : lang === 'it' ? '📋 Competenze core' : '📋 Core Competencies'
                        ),
                        // Fachkompetenz
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Fach – Fachkompetenz & Anwendung' : 'Fach – Technical Expertise'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Wendet Fachwissen effektiv an, löst technische Probleme selbstständig.' : 'Applies expertise effectively, solves technical problems independently.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '→ "Welche Weiterbildung würde Ihnen helfen?"' : '→ "What training would help you?"'
                          )
                        ),
                        // Kommunikation
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Komm – Kommunikation & Zusammenarbeit' : 'Comm – Communication & Collaboration'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Teilt Infos proaktiv, hört aktiv zu, arbeitet konstruktiv mit anderen.' : 'Shares info proactively, listens actively, works constructively with others.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '→ "In welcher Situation war Kommunikation schwierig?"' : '→ "In which situation was communication difficult?"'
                          )
                        ),
                        // Problemlösung
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Prob – Problemlösekompetenz' : 'Prob – Problem-Solving'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Analysiert Probleme strukturiert, entwickelt kreative Lösungen.' : 'Analyzes problems systematically, develops creative solutions.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '→ "Welches Problem haben Sie zuletzt gelöst? Wie?"' : '→ "What problem did you solve recently? How?"'
                          )
                        ),
                        // Anpassungsfähigkeit
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Adapt – Anpassungsfähigkeit' : 'Adapt – Adaptability'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Reagiert flexibel auf Veränderungen, bleibt offen für Neues.' : 'Responds flexibly to changes, stays open to new things.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '→ "Was war die größte Veränderung dieses Jahr?"' : '→ "What was the biggest change this year?"'
                          )
                        ),
                        // Selbstorganisation
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Orga – Selbstorganisation' : 'Orga – Self-Organization'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Priorisiert eigenständig, hält Deadlines ein, arbeitet strukturiert.' : 'Prioritizes independently, meets deadlines, works in a structured way.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '→ "Wie organisieren Sie Ihren Arbeitstag?"' : '→ "How do you organize your workday?"'
                          )
                        )
                      ),
                      // Führungskompetenzen
                      React.createElement('div', { className: "space-y-2" },
                        React.createElement('h5', { className: "font-bold text-purple-700 text-xs uppercase tracking-wide mb-2" }, 
                          lang === 'de' ? '👔 Führungskompetenzen' : lang === 'it' ? '👔 Competenze leadership' : '👔 Leadership Competencies'
                        ),
                        // Mitarbeiterführung
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Führung – Mitarbeiterführung & -entwicklung' : 'Lead – People Management & Development'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Fördert Teammitglieder, gibt regelmäßig Feedback, delegiert sinnvoll.' : 'Develops team members, gives regular feedback, delegates meaningfully.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '→ "Wie fördern Sie Ihre Mitarbeiter individuell?"' : '→ "How do you develop your employees individually?"'
                          )
                        ),
                        // Strategisches Denken
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Strat – Strategisches Denken' : 'Strat – Strategic Thinking'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Denkt über den Tellerrand, plant langfristig, erkennt Zusammenhänge.' : 'Thinks beyond the obvious, plans long-term, sees connections.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '→ "Welche Trends beeinflussen unseren Bereich?"' : '→ "What trends affect our area?"'
                          )
                        ),
                        // Entscheidungsfähigkeit
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Entsch – Entscheidungsfähigkeit' : 'Decis – Decision-Making'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Trifft zeitnah fundierte Entscheidungen, steht dazu, kommuniziert klar.' : 'Makes timely informed decisions, stands by them, communicates clearly.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '→ "Welche schwierige Entscheidung haben Sie getroffen?"' : '→ "What difficult decision did you make?"'
                          )
                        ),
                        // Execution
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Exec – Execution & Performance Mgmt' : 'Exec – Execution & Performance Mgmt'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Setzt Strategie um, monitort Ergebnisse, steuert bei Abweichungen nach.' : 'Implements strategy, monitors results, adjusts when needed.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '→ "Wie tracken Sie den Fortschritt Ihres Teams?"' : '→ "How do you track your team\'s progress?"'
                          )
                        ),
                        // Stakeholder
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Stakeh – Stakeholder-Mgmt & Konflikte' : 'Stakeh – Stakeholder Mgmt & Conflicts'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Managt Erwartungen, löst Konflikte konstruktiv, baut Beziehungen auf.' : 'Manages expectations, resolves conflicts constructively, builds relationships.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '→ "Welchen Konflikt haben Sie kürzlich gelöst?"' : '→ "What conflict did you resolve recently?"'
                          )
                        )
                      )
                    )
                  ),
                  
                  // === MOBILE: Karten-Ansicht (< md) ===
                  React.createElement('div', { className: "md:hidden space-y-4" },
                    employeeData.map(emp => 
                      React.createElement('div', { 
                        key: emp.id, 
                        className: "bg-slate-50 rounded-xl p-4 border border-slate-200"
                      },
                        // Header mit Name und GPS
                        React.createElement('div', { className: "flex justify-between items-start mb-3" },
                          React.createElement('div', null,
                            React.createElement('div', { className: "font-bold text-slate-800" }, emp.name),
                            React.createElement('div', { className: "text-xs text-slate-500 flex items-center gap-1" },
                              emp.status === 'completed' 
                                ? React.createElement('span', { className: "text-green-600" }, "✓ Abgeschlossen")
                                : React.createElement('span', { className: "text-amber-600" }, "✎ Entwurf"),
                              emp.includeLeadership && React.createElement('span', { className: "ml-1 text-purple-600" }, "👔 FK")
                            )
                          ),
                          React.createElement('div', { 
                            className: `px-3 py-1.5 rounded-lg font-bold text-lg ${getColorForGPS(emp.gps)}`
                          }, emp.gps.toFixed(2))
                        ),
                        // Scores Grid
                        React.createElement('div', { className: "grid grid-cols-3 gap-2 text-center text-sm mb-3" },
                          React.createElement('div', { className: "bg-white rounded-lg p-2 border border-slate-200" },
                            React.createElement('div', { className: "text-xs text-slate-500" }, "WAS"),
                            React.createElement('div', { className: "font-bold" }, emp.wasScore > 0 ? emp.wasScore.toFixed(1) : '–')
                          ),
                          React.createElement('div', { className: "bg-white rounded-lg p-2 border border-slate-200" },
                            React.createElement('div', { className: "text-xs text-slate-500" }, "WIE Ø"),
                            React.createElement('div', { className: "font-bold" }, emp.wieAvg > 0 ? emp.wieAvg.toFixed(1) : '–')
                          ),
                          React.createElement('div', { className: "bg-white rounded-lg p-2 border border-slate-200" },
                            React.createElement('div', { className: "text-xs text-slate-500" }, "GPS"),
                            React.createElement('div', { className: "font-bold" }, emp.gps.toFixed(2))
                          )
                        ),
                        // Kompetenzen als Tags
                        React.createElement('div', { className: "flex flex-wrap gap-1.5" },
                          ...coreCompIds.map(id => {
                            const score = emp.coreScores[id] || 0;
                            return React.createElement('span', { 
                              key: id, 
                              className: `px-2 py-1 rounded text-xs font-medium ${getColorForLevel(score)}`
                            }, `${labels[id]}: ${score > 0 ? score : '–'}`);
                          }),
                          ...(emp.includeLeadership ? leaderCompIds.map(id => {
                            const score = emp.leaderScores[id] || 0;
                            return React.createElement('span', { 
                              key: id, 
                              className: `px-2 py-1 rounded text-xs font-medium border border-purple-200 ${getColorForLevel(score)}`
                            }, `${labels[id]}: ${score > 0 ? score : '–'}`);
                          }) : [])
                        ),
                        // === NOTIZEN-BEREICH (Mobile) ===
                        React.createElement('div', { className: "mt-3 pt-3 border-t border-slate-200" },
                          editingNoteId === emp.id
                            ? // Bearbeitungsmodus
                              React.createElement('div', { className: "space-y-2" },
                                React.createElement('textarea', {
                                  value: calibrationNotes[emp.id] || '',
                                  onChange: (e) => setCalibrationNotes({ ...calibrationNotes, [emp.id]: e.target.value }),
                                  placeholder: lang === 'de' ? 'Notiz für Kalibrierungs-Meeting...' : lang === 'it' ? 'Note per il meeting di calibrazione...' : 'Note for calibration meeting...',
                                  className: "w-full px-3 py-2 text-sm border border-slate-300 rounded-lg resize-none focus:ring-2 focus:ring-[#6EBD84] outline-none",
                                  rows: 2
                                }),
                                React.createElement('div', { className: "flex gap-2" },
                                  React.createElement('button', {
                                    onClick: () => setEditingNoteId(null),
                                    className: "px-3 py-1 text-xs bg-[#243186] text-white rounded-lg hover:bg-[#1a2563]"
                                  }, '✓ ' + (lang === 'de' ? 'Fertig' : lang === 'it' ? 'Fatto' : 'Done')),
                                  React.createElement('button', {
                                    onClick: () => {
                                      const newNotes = { ...calibrationNotes };
                                      delete newNotes[emp.id];
                                      setCalibrationNotes(newNotes);
                                      setEditingNoteId(null);
                                    },
                                    className: "px-3 py-1 text-xs text-red-600 hover:bg-red-50 rounded-lg"
                                  }, lang === 'de' ? 'Löschen' : lang === 'it' ? 'Elimina' : 'Delete')
                                )
                              )
                            : // Anzeigemodus
                              React.createElement('div', { 
                                onClick: () => setEditingNoteId(emp.id),
                                className: "cursor-pointer text-sm"
                              },
                                emp.note 
                                  ? React.createElement('div', { className: "bg-amber-50 border border-amber-200 rounded-lg p-2 text-amber-800" },
                                      React.createElement('span', { className: "mr-1" }, "📝"),
                                      emp.note
                                    )
                                  : React.createElement('div', { className: "text-slate-400 hover:text-slate-600 flex items-center gap-1" },
                                      React.createElement(Edit2, { size: 12 }),
                                      lang === 'de' ? 'Notiz hinzufügen...' : lang === 'it' ? 'Aggiungi nota...' : 'Add note...'
                                    )
                              )
                        )
                      )
                    ),
                    // Mobile: Team-Durchschnitt
                    React.createElement('div', { className: "bg-[#E8F5ED] rounded-xl p-4 border-2 border-[#6EBD84]" },
                      React.createElement('div', { className: "font-bold text-[#243186] mb-2" }, 
                        `📊 ${lang === 'de' ? 'Team-Durchschnitt' : lang === 'it' ? 'Media Team' : 'Team Average'}`
                      ),
                      React.createElement('div', { className: "grid grid-cols-3 gap-2 text-center text-sm" },
                        React.createElement('div', { className: "bg-white rounded-lg p-2" },
                          React.createElement('div', { className: "text-xs text-slate-500" }, "GPS Ø"),
                          React.createElement('div', { className: "font-bold text-[#243186]" }, teamAvg.gps.toFixed(2))
                        ),
                        React.createElement('div', { className: "bg-white rounded-lg p-2" },
                          React.createElement('div', { className: "text-xs text-slate-500" }, "WAS Ø"),
                          React.createElement('div', { className: "font-bold text-[#243186]" }, teamAvg.was.toFixed(1))
                        ),
                        React.createElement('div', { className: "bg-white rounded-lg p-2" },
                          React.createElement('div', { className: "text-xs text-slate-500" }, "WIE Ø"),
                          React.createElement('div', { className: "font-bold text-[#243186]" }, teamAvg.wie.toFixed(1))
                        )
                      )
                    )
                  ),
                  
                  // === DESKTOP: Tabellen-Ansicht (>= md) ===
                  React.createElement('div', { className: "hidden md:block overflow-x-auto" },
                    React.createElement('table', { className: "w-full text-sm border-collapse" },
                      // Thead
                      React.createElement('thead', null,
                        React.createElement('tr', { className: "bg-slate-100" },
                          React.createElement('th', { className: "px-3 py-3 text-left font-bold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[140px]" }, 
                            lang === 'de' ? 'Mitarbeiter' : lang === 'it' ? 'Collaboratore' : 'Employee'
                          ),
                          React.createElement('th', { className: "px-2 py-3 text-center font-bold text-slate-700 min-w-[50px]" }, "GPS"),
                          React.createElement('th', { className: "px-2 py-3 text-center font-bold text-slate-700 min-w-[50px]" }, "WAS"),
                          React.createElement('th', { className: "px-2 py-3 text-center font-bold text-slate-700 min-w-[50px]" }, "WIE"),
                          // Core Kompetenzen
                          ...coreCompIds.map(id => 
                            React.createElement('th', { key: id, className: "px-2 py-3 text-center font-semibold text-slate-600 min-w-[45px]" }, labels[id])
                          ),
                          // Leadership Kompetenzen (falls vorhanden)
                          ...(hasAnyLeadership ? leaderCompIds.map(id => 
                            React.createElement('th', { key: id, className: "px-2 py-3 text-center font-semibold text-purple-700 min-w-[45px] bg-purple-50" }, labels[id])
                          ) : []),
                          // Notizen-Spalte
                          React.createElement('th', { className: "px-3 py-3 text-left font-bold text-slate-700 min-w-[180px] bg-amber-50" }, 
                            "📝 " + (lang === 'de' ? 'Notizen' : lang === 'it' ? 'Note' : 'Notes')
                          )
                        )
                      ),
                      // Tbody
                      React.createElement('tbody', null,
                        // Mitarbeiter-Zeilen
                        ...employeeData.map((emp, idx) => 
                          React.createElement('tr', { 
                            key: emp.id, 
                            className: `border-b border-slate-100 hover:bg-slate-50 ${idx % 2 === 0 ? 'bg-white' : 'bg-slate-50/50'}`
                          },
                            // Name + Status
                            React.createElement('td', { className: "px-3 py-3 sticky left-0 bg-inherit z-10" },
                              React.createElement('div', { className: "flex items-center gap-2 flex-wrap" },
                                React.createElement('span', { className: "font-semibold text-slate-800" }, emp.name),
                                // Status Badge
                                React.createElement('span', { 
                                  className: `text-xs px-2 py-0.5 rounded-full ${emp.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`
                                }, emp.status === 'completed' ? '✓' : '✎'),
                                // FK Badge
                                emp.includeLeadership && React.createElement('span', { 
                                  className: "text-xs px-2 py-0.5 rounded-full bg-purple-100 text-purple-700"
                                }, "👔 FK")
                              )
                            ),
                            // GPS
                            React.createElement('td', { className: `px-2 py-3 text-center font-bold rounded ${getColorForGPS(emp.gps)}` },
                              emp.gps > 0 ? emp.gps.toFixed(1) : '–'
                            ),
                            // WAS
                            React.createElement('td', { className: `px-2 py-3 text-center font-medium rounded ${getColorForLevel(emp.wasScore)}` },
                              emp.wasScore > 0 ? emp.wasScore.toFixed(1) : '–'
                            ),
                            // WIE Ø
                            React.createElement('td', { className: `px-2 py-3 text-center font-medium rounded ${getColorForLevel(emp.wieAvg)}` },
                              emp.wieAvg > 0 ? emp.wieAvg.toFixed(1) : '–'
                            ),
                            // Core Kompetenzen - IMMER mit Wert anzeigen
                            ...coreCompIds.map(id => 
                              React.createElement('td', { 
                                key: id, 
                                className: `px-2 py-3 text-center rounded font-bold ${getColorForLevel(emp.coreScores[id])}`
                              }, 
                                React.createElement('span', { className: 'text-sm' }, emp.coreScores[id] || '–')
                              )
                            ),
                            // Leadership Kompetenzen - IMMER mit Wert anzeigen
                            ...(hasAnyLeadership ? leaderCompIds.map(id => 
                              React.createElement('td', { 
                                key: id, 
                                className: `px-2 py-3 text-center rounded font-bold ${emp.includeLeadership ? getColorForLevel(emp.leaderScores[id]) : 'bg-slate-100 text-slate-300'}`
                              }, 
                                React.createElement('span', { className: 'text-sm' }, emp.includeLeadership ? (emp.leaderScores[id] || '–') : '–')
                              )
                            ) : []),
                            // === NOTIZEN-ZELLE ===
                            React.createElement('td', { className: "px-3 py-2 bg-amber-50/50" },
                              editingNoteId === emp.id
                                ? // Bearbeitungsmodus
                                  React.createElement('div', { className: "flex items-center gap-2" },
                                    React.createElement('input', {
                                      type: 'text',
                                      value: calibrationNotes[emp.id] || '',
                                      onChange: (e) => setCalibrationNotes({ ...calibrationNotes, [emp.id]: e.target.value }),
                                      placeholder: lang === 'de' ? 'Notiz...' : lang === 'it' ? 'Nota...' : 'Note...',
                                      className: "flex-1 px-2 py-1 text-sm border border-amber-300 rounded focus:ring-2 focus:ring-amber-500 outline-none",
                                      autoFocus: true,
                                      onKeyDown: (e) => { if (e.key === 'Enter') setEditingNoteId(null); }
                                    }),
                                    React.createElement('button', {
                                      onClick: () => setEditingNoteId(null),
                                      className: "px-2 py-1 text-xs bg-amber-500 text-white rounded hover:bg-amber-600"
                                    }, '✓')
                                  )
                                : // Anzeigemodus
                                  React.createElement('div', { 
                                    onClick: () => setEditingNoteId(emp.id),
                                    className: "cursor-pointer text-sm min-h-[24px] flex items-center"
                                  },
                                    emp.note 
                                      ? React.createElement('span', { className: "text-amber-800 truncate max-w-[200px]" }, emp.note)
                                      : React.createElement('span', { className: "text-slate-300 hover:text-amber-600 flex items-center gap-1 text-xs" },
                                          React.createElement(Edit2, { size: 12 }),
                                          lang === 'de' ? 'Notiz...' : lang === 'it' ? 'Nota...' : 'Note...'
                                        )
                                  )
                            )
                          )
                        ),
                        
                        // Team-Durchschnitt Zeile
                        React.createElement('tr', { className: "bg-[#E8F5ED] font-bold sticky bottom-0" },
                          React.createElement('td', { className: "px-3 py-3 sticky left-0 bg-[#E8F5ED] z-10 text-[#243186]" }, 
                            `📊 TEAM Ø (${employeeData.length})`
                          ),
                          React.createElement('td', { className: "px-2 py-3 text-center text-[#243186]" }, 
                            teamAvg.gps > 0 ? teamAvg.gps.toFixed(1) : '–'
                          ),
                          React.createElement('td', { className: "px-2 py-3 text-center text-[#243186]" }, 
                            teamAvg.was > 0 ? teamAvg.was.toFixed(1) : '–'
                          ),
                          React.createElement('td', { className: "px-2 py-3 text-center text-[#243186]" }, 
                            teamAvg.wie > 0 ? teamAvg.wie.toFixed(1) : '–'
                          ),
                          // Core Durchschnitte
                          ...coreCompIds.map(id => 
                            React.createElement('td', { key: id, className: "px-2 py-3 text-center text-[#243186]" }, 
                              teamAvg.core[id] > 0 ? teamAvg.core[id].toFixed(1) : '–'
                            )
                          ),
                          // Leadership Durchschnitte
                          ...(hasAnyLeadership ? leaderCompIds.map(id => 
                            React.createElement('td', { key: id, className: "px-2 py-3 text-center text-purple-900 bg-purple-100" }, 
                              teamAvg.leader[id] > 0 ? teamAvg.leader[id].toFixed(1) : '–'
                            )
                          ) : []),
                          // Leere Notizen-Zelle für Team-Durchschnitt
                          React.createElement('td', { className: "px-3 py-3 bg-[#E8F5ED]" })
                        )
                      )
                    )
                  ),
                  
                  // === TEAM-ENTWICKLUNGSEMPFEHLUNG ===
                  employeeData.length > 0 && (() => {
                    // Finde niedrigsten Durchschnitt pro Kompetenz
                    const compAverages = {};
                    coreCompIds.forEach(id => {
                      const vals = employeeData.map(e => e.coreScores[id]).filter(v => v > 0);
                      compAverages[id] = vals.length > 0 ? vals.reduce((a, b) => a + b, 0) / vals.length : 0;
                    });
                    
                    // Sortiere nach niedrigstem Durchschnitt
                    const sortedComps = Object.entries(compAverages)
                      .filter(([_, avg]) => avg > 0)
                      .sort((a, b) => a[1] - b[1]);
                    
                    if (sortedComps.length === 0) return null;
                    
                    const lowestComp = sortedComps[0];
                    const lowestId = lowestComp[0];
                    const lowestAvg = lowestComp[1];
                    
                    // Empfehlungen pro Kompetenz
                    const devRecommendations = {
                      fach: {
                        de: { title: 'Fachkompetenz stärken', actions: ['Peer-Learning Sessions einführen', 'Externe Schulungen prüfen', 'Mentoring durch erfahrene Kollegen'] },
                        it: { title: 'Rafforzare competenza tecnica', actions: ['Introdurre sessioni di peer-learning', 'Valutare formazione esterna', 'Mentoring da colleghi esperti'] }
                      },
                      komm: {
                        de: { title: 'Kommunikation verbessern', actions: ['Regelmäßige Team-Meetings etablieren', 'Feedback-Kultur stärken', 'Kommunikationstraining anbieten'] },
                        it: { title: 'Migliorare comunicazione', actions: ['Stabilire meeting regolari', 'Rafforzare cultura del feedback', 'Offrire training comunicazione'] }
                      },
                      prob: {
                        de: { title: 'Problemlösekompetenz entwickeln', actions: ['Strukturierte Problemanalyse üben', 'Case Studies im Team bearbeiten', 'Design Thinking Workshop'] },
                        it: { title: 'Sviluppare problem solving', actions: ['Praticare analisi strutturata', 'Lavorare su case studies', 'Workshop Design Thinking'] }
                      },
                      adapt: {
                        de: { title: 'Anpassungsfähigkeit fördern', actions: ['Change-Kommunikation verbessern', 'Kleine Experimente ermutigen', 'Lessons Learned teilen'] },
                        it: { title: 'Promuovere adattabilità', actions: ['Migliorare comunicazione del cambiamento', 'Incoraggiare piccoli esperimenti', 'Condividere lessons learned'] }
                      },
                      orga: {
                        de: { title: 'Selbstorganisation unterstützen', actions: ['Priorisierungstechniken vermitteln', 'Klare Deadlines setzen', 'Zeitmanagement-Tools einführen'] },
                        it: { title: 'Supportare auto-organizzazione', actions: ['Insegnare tecniche di prioritizzazione', 'Definire deadline chiare', 'Introdurre strumenti time management'] }
                      }
                    };
                    
                    const rec = devRecommendations[lowestId]?.[lang] || devRecommendations[lowestId]?.de;
                    if (!rec) return null;
                    
                    return React.createElement('div', { className: "mt-6 bg-amber-50 rounded-xl p-5 border border-amber-200" },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "w-10 h-10 rounded-lg bg-amber-500 flex items-center justify-center flex-shrink-0" },
                          React.createElement(Target, { size: 20, className: "text-white" })
                        ),
                        React.createElement('div', { className: "flex-1" },
                          React.createElement('h4', { className: "font-bold text-amber-800 text-sm mb-1" },
                            lang === 'de' ? '🎯 Team-Entwicklungsempfehlung' : lang === 'it' ? '🎯 Raccomandazione sviluppo team' : '🎯 Team Development Recommendation'
                          ),
                          React.createElement('p', { className: "text-sm text-amber-700 mb-3" },
                            lang === 'de' 
                              ? `Niedrigster Team-Durchschnitt: ${labels[lowestId]} (Ø ${lowestAvg.toFixed(1)}) – ${rec.title}`
                              : `Media team più bassa: ${labels[lowestId]} (Ø ${lowestAvg.toFixed(1)}) – ${rec.title}`
                          ),
                          React.createElement('div', { className: "flex flex-wrap gap-2" },
                            ...rec.actions.map((action, i) => 
                              React.createElement('span', { 
                                key: i, 
                                className: "inline-flex items-center gap-1 px-2 py-1 bg-white rounded-full text-xs text-amber-800 border border-amber-300"
                              },
                                React.createElement(CheckCircle2, { size: 12 }),
                                action
                              )
                            )
                          )
                        )
                      )
                    );
                  })(),
                  
                  // === PEER-LEARNING / MENTORING ENGINE ===
                  employeeData.length >= 2 && (() => {
                    // Vollständige Kompetenz-Namen für bessere Lesbarkeit
                    const fullCompNames = {
                      de: { 
                        fach: 'Fachkompetenz', komm: 'Kommunikation', prob: 'Problemlösung', 
                        adapt: 'Anpassungsfähigkeit', orga: 'Selbstorganisation',
                        lead: 'Mitarbeiterführung', strat: 'Strategisches Denken', 
                        decide: 'Entscheidungsfähigkeit', exec: 'Execution', stake: 'Stakeholder-Management'
                      },
                      it: { 
                        fach: 'Competenza tecnica', komm: 'Comunicazione', prob: 'Problem solving', 
                        adapt: 'Adattabilità', orga: 'Auto-organizzazione',
                        lead: 'Gestione personale', strat: 'Pensiero strategico', 
                        decide: 'Capacità decisionale', exec: 'Execution', stake: 'Gestione stakeholder'
                      },
                      en: { 
                        fach: 'Technical Expertise', komm: 'Communication', prob: 'Problem Solving', 
                        adapt: 'Adaptability', orga: 'Self-Organization',
                        lead: 'People Management', strat: 'Strategic Thinking', 
                        decide: 'Decision Making', exec: 'Execution', stake: 'Stakeholder Management'
                      }
                    };
                    const compNames = fullCompNames[lang] || fullCompNames.de;
                    
                    // Sammle alle Mentoring-Matches
                    const allMatches = [];
                    
                    // Durchlaufe alle Kompetenzen
                    const allCompIds = [...coreCompIds, ...(hasAnyLeadership ? leaderCompIds : [])];
                    
                    allCompIds.forEach(compId => {
                      const isLeadership = leaderCompIds.includes(compId);
                      
                      // Finde Mentoren (Score 4 oder 5) und Mentees (Score 1 oder 2)
                      const mentors = [];
                      const mentees = [];
                      
                      employeeData.forEach(emp => {
                        const score = isLeadership 
                          ? (emp.includeLeadership ? emp.leaderScores[compId] : 0)
                          : emp.coreScores[compId];
                        
                        if (score >= 4) {
                          mentors.push({ name: emp.name, score, employeeId: emp.employeeId });
                        } else if (score > 0 && score <= 2) {
                          mentees.push({ name: emp.name, score, employeeId: emp.employeeId });
                        }
                      });
                      
                      // Erstelle Matches wenn es sowohl Mentoren als auch Mentees gibt
                      if (mentors.length > 0 && mentees.length > 0) {
                        // Sortiere für beste Matches: höchster Mentor-Score mit niedrigstem Mentee-Score
                        mentors.sort((a, b) => b.score - a.score);
                        mentees.sort((a, b) => a.score - b.score);
                        
                        // Erstelle Match (bester Mentor mit schlechtestem Mentee)
                        const mentor = mentors[0];
                        const mentee = mentees[0];
                        
                        // Vermeide Self-Matches
                        if (mentor.employeeId !== mentee.employeeId) {
                          allMatches.push({
                            mentor,
                            mentee,
                            compId,
                            compName: compNames[compId] || compId,
                            isLeadership,
                            scoreDiff: mentor.score - mentee.score
                          });
                        }
                      }
                    });
                    
                    // Sortiere nach größter Differenz und nimm max 3
                    allMatches.sort((a, b) => b.scoreDiff - a.scoreDiff);
                    const topMatches = allMatches.slice(0, 3);
                    
                    // Zeige nur an wenn Matches vorhanden
                    if (topMatches.length === 0) return null;
                    
                    return React.createElement('div', { 
                      className: "mt-6 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-5 border border-indigo-200"
                    },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { 
                          className: "w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",
                          style: { background: 'linear-gradient(135deg, #243186 0%, #6366f1 100%)' }
                        },
                          React.createElement(Users, { size: 20, className: "text-white" })
                        ),
                        React.createElement('div', { className: "flex-1" },
                          React.createElement('h4', { className: "font-bold text-sm mb-1", style: { color: '#243186' } },
                            lang === 'de' ? '🤝 Peer-Learning Impulse' 
                              : lang === 'it' ? '🤝 Impulsi Peer-Learning' 
                              : '🤝 Peer-Learning Opportunities'
                          ),
                          React.createElement('p', { className: "text-xs text-indigo-600 mb-3" },
                            lang === 'de' 
                              ? 'Basierend auf Kompetenz-Stärken und -Lücken im Team'
                              : lang === 'it' ? 'Basato su punti di forza e lacune nelle competenze del team'
                              : 'Based on competency strengths and gaps in the team'
                          ),
                          React.createElement('div', { className: "space-y-2" },
                            ...topMatches.map((match, idx) => 
                              React.createElement('div', { 
                                key: idx,
                                className: "bg-white rounded-lg p-3 border border-indigo-100 flex items-center gap-3 text-sm"
                              },
                                // Mentor
                                React.createElement('div', { className: "flex items-center gap-1.5" },
                                  React.createElement('span', { 
                                    className: "w-7 h-7 rounded-full flex items-center justify-center text-white text-xs font-bold",
                                    style: { backgroundColor: '#6EBD84' }
                                  }, match.mentor.score),
                                  React.createElement('span', { className: "font-medium text-slate-800" }, 
                                    match.mentor.name.split(' ')[0]
                                  )
                                ),
                                // Pfeil
                                React.createElement('span', { className: "text-indigo-400" }, '→'),
                                // Mentee
                                React.createElement('div', { className: "flex items-center gap-1.5" },
                                  React.createElement('span', { 
                                    className: "w-7 h-7 rounded-full flex items-center justify-center text-white text-xs font-bold",
                                    style: { backgroundColor: match.mentee.score === 1 ? '#dc2626' : '#f97316' }
                                  }, match.mentee.score),
                                  React.createElement('span', { className: "font-medium text-slate-800" }, 
                                    match.mentee.name.split(' ')[0]
                                  )
                                ),
                                // Kompetenz-Badge
                                React.createElement('span', { 
                                  className: `ml-auto px-2 py-0.5 rounded text-xs font-medium ${match.isLeadership ? 'bg-purple-100 text-purple-700' : 'bg-indigo-100 text-indigo-700'}`
                                }, match.compName)
                              )
                            )
                          ),
                          // Hinweis
                          React.createElement('p', { className: "text-xs text-indigo-500 mt-3 italic" },
                            lang === 'de' 
                              ? '💡 Peer-Mentoring fördert Wissenstransfer und stärkt das Team.'
                              : lang === 'it' ? '💡 Il peer-mentoring promuove il trasferimento di conoscenze e rafforza il team.'
                              : '💡 Peer mentoring promotes knowledge transfer and strengthens the team.'
                          )
                        )
                      )
                    );
                  })(),
                  
                  // Hinweis
                  React.createElement('p', { className: "text-xs text-slate-500 mt-4 text-center" },
                    lang === 'de' 
                      ? '💡 Tipp: Scrolle horizontal um alle Kompetenzen zu sehen. Lila Spalten = Leadership-Kompetenzen.'
                      : '💡 Suggerimento: Scorri orizzontalmente per vedere tutte le competenze. Colonne viola = Competenze Leadership.'
                  )
                );
              })(),
              
              // Quick Actions
              React.createElement('div', { className: "flex flex-wrap gap-3 justify-center" },
                React.createElement('button', {
                  onClick: () => setActiveView('teamoverview'),
                  className: "flex items-center gap-2 px-5 py-2.5 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors text-sm font-medium"
                },
                  React.createElement(Users, { size: 16 }),
                  getText(lang, 'Mein Team', 'Il mio team', 'My Team')
                ),
                reviewsWithGPS.length > 0 && React.createElement('button', {
                  onClick: () => setActiveView('formular'),
                  className: "flex items-center gap-2 px-5 py-2.5 bg-[#6EBD84] text-white rounded-lg hover:bg-[#5da872] transition-colors text-sm font-medium"
                },
                  React.createElement(FileText, { size: 16 }),
                  lang === 'de' ? 'Neues Review' : lang === 'it' ? 'Nuova review' : 'New Review'
                )
              )
            );
          };
          
const renderDashboard = () => {
            // Safety check inside render
            if (!data || !data.intro) return React.createElement('div', null, "Loading...");

            return React.createElement('div', { className: "space-y-8 animate-in fade-in duration-500" },
              // === MIGRATION SUCCESS BANNER ===
              migrationStatus === 'done' && migrationResult && (migrationResult.members > 0 || migrationResult.appraisals > 0) &&
                React.createElement('div', { 
                  className: 'bg-green-50 border border-green-200 rounded-xl p-4 flex items-start gap-3 animate-in fade-in duration-500'
                },
                  React.createElement(CheckCircle2, { size: 24, className: 'text-green-600 flex-shrink-0 mt-0.5' }),
                  React.createElement('div', { className: 'flex-1' },
                    React.createElement('h4', { className: 'font-semibold text-green-800 mb-1' },
                      getText(lang, '✨ Daten erfolgreich migriert!', '✨ Dati migrati con successo!', '✨ Data successfully migrated!')
                    ),
                    React.createElement('p', { className: 'text-sm text-green-700' },
                      getText(lang,
                        `${migrationResult.members} Mitarbeiter und ${migrationResult.appraisals} Bewertungen wurden in die Cloud übertragen. Ihre Daten sind jetzt sicher in Firebase gespeichert.`,
                        `${migrationResult.members} collaboratori e ${migrationResult.appraisals} valutazioni sono stati trasferiti nel cloud. I tuoi dati sono ora salvati in Firebase.`,
                        `${migrationResult.members} employees and ${migrationResult.appraisals} appraisals have been transferred to the cloud. Your data is now securely stored in Firebase.`)
                    )
                  ),
                  React.createElement('button', {
                    onClick: () => { setMigrationStatus(null); setMigrationResult(null); },
                    className: 'text-green-600 hover:text-green-800 p-1'
                  }, React.createElement(X, { size: 18 }))
                ),
              
              // === QUICKSTART GUIDE (GANZ OBEN) ===
              React.createElement('div', { className: "bg-gradient-to-br from-slate-50 to-white rounded-2xl p-6 md:p-8 shadow-lg border border-slate-200" },
                React.createElement('div', { className: "flex items-center gap-3 mb-6" },
                  React.createElement('div', { className: "bg-[#6EBD84] p-3 rounded-xl" },
                    React.createElement(Lightbulb, { size: 28, className: "text-white" })
                  ),
                  React.createElement('div', null,
                    React.createElement('h2', { className: "text-2xl font-bold", style: { color: "#243186" } },
                      lang === 'de' ? '🚀 Schnellstart-Guide' : lang === 'it' ? '🚀 Guida Rapida' : '🚀 Quick Start Guide'
                    ),
                    React.createElement('p', { className: "text-slate-500 text-sm" },
                      lang === 'de' ? 'So nutzen Sie den Performance Manager' : lang === 'it' ? 'Come utilizzare il Performance Manager' : 'How to use the Performance Manager'
                    )
                  )
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 gap-6" },
                  // LINKE SPALTE: Für Führungskräfte
                  React.createElement('div', { className: "bg-[#243186] rounded-xl p-5 text-white" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-4" },
                      React.createElement(Users, { size: 24, className: "text-[#6EBD84]" }),
                      React.createElement('h3', { className: "text-lg font-bold" },
                        lang === 'de' ? 'Für Führungskräfte' : lang === 'it' ? 'Per Manager' : 'For Managers'
                      )
                    ),
                    React.createElement('div', { className: "space-y-4" },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '1'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Account erstellen' : lang === 'it' ? 'Crea account' : 'Create account'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? 'Unter "Mein Team" registrieren.' : lang === 'it' ? 'Registrati in "Il mio team".' : 'Register in "My Team".')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '2'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Team anlegen' : lang === 'it' ? 'Crea team' : 'Create team'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? 'Unter "Mein Team" Mitarbeiter hinzufügen.' : lang === 'it' ? 'In "Il mio team" aggiungi collaboratori.' : 'Add employees in "My Team".')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '3'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Selbstreflexion-Link senden' : lang === 'it' ? 'Invia link autovalutazione' : 'Send self-reflection link'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? '"📋 Selbstreflexion-Link" an Mitarbeiter senden.' : lang === 'it' ? 'Invia "📋 Link autovalutazione" al collaboratore.' : 'Send "📋 Self-Reflection Link" to employee.')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '4'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Beurteilung erstellen' : lang === 'it' ? 'Crea valutazione' : 'Create assessment'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? '"📝 Beurteilung starten" oder "🎯 Zielvereinbarung".' : lang === 'it' ? '"📝 Avvia valutazione" o "🎯 Obiettivi".' : '"📝 Start Assessment" or "🎯 Goals".')
                        )
                      )
                    )
                  ),
                  // RECHTE SPALTE: Für Mitarbeiter
                  React.createElement('div', { className: "bg-white rounded-xl p-5 border-2 border-[#6EBD84]" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-4" },
                      React.createElement(User, { size: 24, className: "text-[#243186]" }),
                      React.createElement('h3', { className: "text-lg font-bold", style: { color: "#243186" } },
                        lang === 'de' ? 'Für Mitarbeiter' : lang === 'it' ? 'Per Collaboratori' : 'For Employees'
                      )
                    ),
                    React.createElement('div', { className: "bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4" },
                      React.createElement('div', { className: "flex items-center gap-2" },
                        React.createElement(Link, { size: 16, className: "text-purple-600" }),
                        React.createElement('p', { className: "text-sm font-medium text-purple-700" },
                          lang === 'de' ? 'Link erhalten? Einfach öffnen – kein Login nötig!' : lang === 'it' ? 'Ricevuto un link? Aprilo – nessun login!' : 'Received a link? Just open it – no login needed!'
                        )
                      )
                    ),
                    React.createElement('div', { className: "space-y-4" },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#243186] text-white font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '1'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold", style: { color: "#243186" } }, lang === 'de' ? 'Link öffnen' : lang === 'it' ? 'Apri link' : 'Open link'),
                          React.createElement('p', { className: "text-sm text-slate-600" }, lang === 'de' ? 'Klicken Sie auf den Link in der E-Mail.' : lang === 'it' ? 'Clicca sul link nell\'email.' : 'Click the link in the email.')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#243186] text-white font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '2'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold", style: { color: "#243186" } }, lang === 'de' ? 'Selbsteinschätzung ausfüllen' : lang === 'it' ? 'Compila autovalutazione' : 'Complete self-assessment'),
                          React.createElement('p', { className: "text-sm text-slate-600" }, lang === 'de' ? 'Kompetenzen ehrlich bewerten.' : lang === 'it' ? 'Valuta le competenze onestamente.' : 'Rate competencies honestly.')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#243186] text-white font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '3'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold", style: { color: "#243186" } }, lang === 'de' ? 'Absenden' : lang === 'it' ? 'Invia' : 'Submit'),
                          React.createElement('p', { className: "text-sm text-slate-600" }, lang === 'de' ? 'Ihre Führungskraft sieht die Antworten.' : lang === 'it' ? 'Il manager vedrà le risposte.' : 'Your manager sees the answers.')
                        )
                      )
                    )
                  )
                ),
                React.createElement('div', { className: "mt-4 text-center" },
                  React.createElement('p', { className: "text-sm text-slate-500" },
                    lang === 'de' ? '💡 Nutzen Sie die Seitenleiste links zur Navigation.' : lang === 'it' ? '💡 Usa la barra laterale per navigare.' : '💡 Use the sidebar to navigate.'
                  )
                )
              ),
              
              React.createElement('div', { className: "bg-white rounded-xl p-6 shadow-sm border border-slate-200" },
                React.createElement('h2', { className: "text-2xl font-bold mb-4", style: { color: "#243186" } }, t.welcome),
                React.createElement('p', { className: "mb-6 leading-relaxed", style: { color: "#243186" } },
                  t.intro, React.createElement('strong', null, t.introBold), t.introEnd
                ),
                React.createElement('div', { className: "bg-slate-50 p-5 rounded-lg border border-slate-100 mb-6" },
                  React.createElement('h3', { className: "font-semibold mb-3 flex items-center gap-2", style: { color: "#243186" } },
                    React.createElement(Target, { size: 18 }), " ", t.strategyTitle
                  ),
                  React.createElement('p', { className: "text-sm leading-relaxed", style: { color: "#243186" } },
                    t.strategyDesc, React.createElement('strong', null, t.strategyBold), t.strategyEnd
                  )
                )
              ),
              
              React.createElement('div', { className: "grid md:grid-cols-3 gap-4" },
                // BEGIN: Fast, Fair, Personal Block
                data.intro.values.map((val) => (
                  React.createElement('div', { 
                    key: val.key, 
                    // Dunkler Hintergrund, weißer Text, Akzentlinie oben
                    className: "bg-[#243186] p-5 rounded-xl shadow-lg border-t-4 border-t-[#6EBD84] flex flex-col items-center text-center transition-all hover:shadow-xl" 
                  },
                    // Icon: Weiß mit Akzentfarbe für die Hervorhebung
                    React.createElement('div', { className: `mb-3 p-2 rounded-full border-2 border-white/50 text-white/90` }, 
                      React.createElement(val.icon, { size: 32 })
                    ),
                    // Titel: Weißer Text, fett
                    React.createElement('h3', { className: "font-bold text-lg text-white mb-1" }, val.key),
                    // Beschreibung: Hellerer weißer Text
                    React.createElement('p', { className: "text-sm text-slate-300" }, val.desc)
                  )
                ))
                // END: Fast, Fair, Personal Block
              ),
              
              // Performance Kompass Section
              React.createElement('div', { 
                className: "rounded-xl shadow-lg p-8", 
                style: { background: "linear-gradient(135deg, #243186 0%, #1a2460 100%)" }
              },
                React.createElement('h2', { className: "text-3xl font-bold text-white mb-3" }, 
                  t.performanceCompassTitle
                ),
                React.createElement('p', { className: "text-slate-200 text-lg mb-6 leading-relaxed" }, 
                  t.performanceCompassSubtitle
                ),
                // Top Row: WAS + WIE
                React.createElement('div', { className: "relative mb-6" },
                  React.createElement('div', { className: "grid md:grid-cols-2 gap-6" },
                    // WAS Box
                    React.createElement('div', { 
                      className: "bg-white/10 backdrop-blur-sm rounded-2xl p-6 border-2 border-white/20 hover:border-[#6EBD84] transition-all duration-300 hover:scale-105"
                    },
                      React.createElement('div', { className: "flex items-center justify-between mb-4" },
                        React.createElement('h3', { 
                          className: "text-3xl font-bold",
                          style: { color: "#6EBD84" }
                        }, t.wasBoxTitle),
                        React.createElement(Target, { size: 48, className: "text-white/60" })
                      ),
                      React.createElement('p', { className: "text-white text-lg" }, 
                        t.wasBoxSubtitle
                      )
                    ),
                    
                    // WIE Box - mit dynamischem Inhalt für Manager/Mitarbeiter
                    React.createElement('div', { 
                      className: "bg-white/10 backdrop-blur-sm rounded-2xl p-6 border-2 border-white/20 hover:border-[#6EBD84] transition-all duration-300 hover:scale-105"
                    },
                      React.createElement('div', { className: "flex items-center justify-between mb-4" },
                        React.createElement('h3', { 
                          className: "text-3xl font-bold",
                          style: { color: "#6EBD84" }
                        }, t.wieBoxTitle),
                        React.createElement(Brain, { size: 48, className: "text-white/60" })
                      ),
                      React.createElement('p', { className: "text-white text-lg mb-2" }, 
                        t.wieBoxSubtitle
                      ),
                      // Manager/Mitarbeiter Unterscheidung
                      React.createElement('div', { className: "mt-3 pt-3 border-t border-white/20" },
                        React.createElement('div', { className: "flex items-start gap-2 text-sm text-white/80" },
                          React.createElement(Users, { size: 14, className: "mt-0.5 flex-shrink-0" }),
                          React.createElement('span', null, 
                            lang === 'de' ? 'Mitarbeitende: 50% Kern-Kompetenzen' : lang === 'it' ? 'Collaboratori: 50% Competenze Core' : 'Employees: 50% Core Competencies'
                          )
                        ),
                        React.createElement('div', { className: "flex items-start gap-2 text-sm text-white/80 mt-1" },
                          React.createElement(Award, { size: 14, className: "mt-0.5 flex-shrink-0" }),
                          React.createElement('span', null, 
                            lang === 'de' ? 'Führungskräfte: 25% Kern-Komp. + 25% Leadership' : lang === 'it' ? 'Dirigenti: 25% Comp. Core + 25% Leadership' : 'Managers: 25% Core Comp. + 25% Leadership'
                          )
                        )
                      )
                    )
                  ),
                  // Plus Symbol zwischen den Boxen (nur Desktop)
                  React.createElement('div', { className: "hidden md:flex absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none" },
                    React.createElement('div', { className: "w-16 h-16 rounded-full bg-white flex items-center justify-center shadow-lg" },
                      React.createElement('span', { className: "text-[#243186] text-4xl font-bold" }, "+")
                    )
                  )
                ),
                
                // Formel-Erklärung unter den Boxen
                React.createElement('div', { className: "flex justify-center mb-4" },
                  React.createElement('div', { className: "bg-white/5 backdrop-blur-sm rounded-lg px-6 py-3 border border-white/10" },
                    React.createElement('p', { className: "text-white/90 text-sm text-center" },
                      lang === 'de' 
                        ? '📊 GPS = 50% WAS-Zielerreichung + 50% WIE-Kompetenzbewertung'
                        : '📊 GPS = 50% Raggiungimento COSA + 50% Valutazione COME'
                    )
                  )
                ),
                
                // GPS Result Box - mittig positioniert, zentrierter Text
                React.createElement('div', { className: "flex justify-center" },
                  React.createElement('div', { 
                    className: "w-full md:w-1/2 bg-gradient-to-br from-[#6EBD84] to-[#5aa871] rounded-2xl p-6 border-2 border-white shadow-2xl transform hover:scale-105 transition-all duration-300"
                  },
                    React.createElement('div', { className: "text-center" },
                      React.createElement('h3', { 
                        className: "text-3xl font-bold text-white mb-2"
                      }, "GPS"),
                      React.createElement('p', { className: "text-white text-lg" }, 
                        "Global Performance Score"
                      )
                    )
                  )
                ),
                // Fairness Garantie Badge
                React.createElement('div', { className: "flex justify-center mt-6" },
                  React.createElement('div', { 
                    className: "inline-flex items-center gap-3 px-6 py-3 rounded-full border-2",
                    style: { 
                      backgroundColor: "rgba(110, 189, 132, 0.2)",
                      borderColor: "#6EBD84"
                    }
                  },
                    React.createElement(Scale, { size: 20, style: { color: "#6EBD84" } }),
                    React.createElement('span', { 
                      className: "font-bold text-sm uppercase tracking-wider",
                      style: { color: "#6EBD84" }
                    }, t.fairnessGuarantee)
                  )
                ),
                
                // GPS Rating Scale Table
                React.createElement('div', { className: "mt-6 bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20" },
                  React.createElement('p', { className: "text-white text-center text-sm mb-4" },
                    lang === 'de' 
                      ? 'Der finale GPS-Score wird in ein 5-stufiges Rating überführt:'
                      : 'Il punteggio GPS finale viene convertito in un rating a 5 livelli:'
                  ),
                  React.createElement('div', { className: "overflow-hidden rounded-lg border border-white/30" },
                    // Header Row
                    React.createElement('div', { className: "grid grid-cols-3 gap-0" },
                      React.createElement('div', { className: "bg-white/20 backdrop-blur-sm px-4 py-3 font-bold text-white text-sm border-r border-white/30" },
                        lang === 'de' ? 'GPS-Score' : lang === 'it' ? 'Punteggio GPS' : 'GPS Score'
                      ),
                      React.createElement('div', { className: "bg-white/20 backdrop-blur-sm px-4 py-3 font-bold text-white text-sm text-center border-r border-white/30" },
                        'Note'
                      ),
                      React.createElement('div', { className: "bg-white/20 backdrop-blur-sm px-4 py-3 font-bold text-white text-sm" },
                        lang === 'de' ? 'Beschreibung' : 'Descrizione'
                      )
                    ),
                    // Rating 5
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-pink-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '4,51 – 5,00'
                      ),
                      React.createElement('div', { className: "bg-pink-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '5'
                      ),
                      React.createElement('div', { className: "bg-pink-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Outstanding'
                      )
                    ),
                    // Rating 4
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-orange-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '3,51 – 4,50'
                      ),
                      React.createElement('div', { className: "bg-orange-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '4'
                      ),
                      React.createElement('div', { className: "bg-orange-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Exceeds Expectations'
                      )
                    ),
                    // Rating 3
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-blue-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '2,51 – 3,50'
                      ),
                      React.createElement('div', { className: "bg-blue-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '3'
                      ),
                      React.createElement('div', { className: "bg-blue-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Meets Expectations (Baseline)'
                      )
                    ),
                    // Rating 2
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-green-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '1,51 – 2,50'
                      ),
                      React.createElement('div', { className: "bg-green-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '2'
                      ),
                      React.createElement('div', { className: "bg-green-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Needs Improvement'
                      )
                    ),
                    // Rating 1
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-teal-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '1,00 – 1,50'
                      ),
                      React.createElement('div', { className: "bg-teal-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '1'
                      ),
                      React.createElement('div', { className: "bg-teal-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Does Not Meet'
                      )
                    )
                  )
                )
              ),
              
              // Hintergrundfarbe geändert auf das CI-Dunkelblau: #243186
              React.createElement('div', { className: "bg-[#243186] rounded-xl p-6 text-white shadow-lg" },
                React.createElement('div', { className: "flex flex-col items-start" },
                  React.createElement('h3', { className: "text-xl font-bold mb-2" }, t.barsTitle),
                  React.createElement('p', { className: "text-[#E8F5ED] text-sm mb-4 opacity-90" }, t.barsDesc),
                  React.createElement('button', {
                    onClick: () => setActiveView('list'),
                    className: "bg-white text-[#6EBD84] px-6 py-2 rounded-lg font-semibold hover:bg-[#F4FAF7] transition-colors"
                  }, t.btnCompetencies)
                )
              ),
              
              React.createElement('div', { className: "mt-12 mb-8" },
                React.createElement('h2', { className: "text-2xl font-bold mb-8 text-center", style: { color: "#243186" } },
                  lang === 'de' ? 'DER JAHRESZYKLUS IM ÜBERBLICK' : 'IL CICLO ANNUALE IN SINTESI'
                ),
                // Verwendung der benutzerdefinierten Klasse für gleich hohe Spalten
                React.createElement('div', { className: "equal-height-grid" },
                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(Scale, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 1' : 'FASE 1'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Entwurf & Kalibrierung' : 'Bozza & Calibrazione'
                      )
                    ),
                    // Inhalt ohne Aufzählungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(ClipboardList, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Führungskraft erstellt GPS-Entwurf.' 
                          : 'Il manager crea la bozza GPS.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(CalendarCheck, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Kalibrierungs-Meeting im Führungskreis sichert Fairness.' 
                          : 'Meeting di calibrazione nel team di leadership garantisce equità.')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'WICHTIG: Nach diesem Meeting ist der GPS-Score final und verbindlich.' 
                          : 'IMPORTANTE: Dopo questo meeting il punteggio GPS è finale e vincolante.'
                      )
                    )
                  ),

                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(Brain, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 2' : 'FASE 2'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Selbstreflexion' : 'Autoriflessione'
                      )
                    ),
                    // Inhalt ohne Aufzählungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(BookOpen, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Mitarbeiter bereitet Selbstreflexion vor.' 
                          : 'Il collaboratore prepara l\'autoriflessione.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Users, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Dient als Basis für den Dialog auf Augenhöhe.' 
                          : 'Serve come base per il dialogo alla pari.')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'TIMING: Zusendung an FK ca. eine Woche vor Gesprächstermin' 
                          : 'TIMING: Invio al manager ca. una settimana prima del colloquio'
                      )
                    )
                  ),

                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(MessageCircle, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 3' : 'FASE 3'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Review-Gespräch' : 'Colloquio di Review'
                      )
                    ),
                    // Inhalt ohne Aufzählungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Scale, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Erklärung des GPS-Scores' 
                          : 'Spiegazione del punteggio GPS')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Target, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Feedback zu Zielerreichung (WAS) & Kompetenzen (WIE)' 
                          : 'Feedback sul raggiungimento obiettivi (COSA) & competenze (COME)')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'Keine Verhandlung des GPS-Scores, aber offenes Ohr.' 
                          : 'Nessuna negoziazione del punteggio GPS, ma ascolto aperto.'
                      )
                    )
                  ),

                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(Target, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 4' : 'FASE 4'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Zielvereinbarung' : 'Definizione Obiettivi'
                      )
                    ),
                    // Inhalt ohne Aufzählungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(TrendingUp, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Blick nach vorne.' 
                          : 'Sguardo al futuro.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Briefcase, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Vereinbarung der neuen Ziele.' 
                          : 'Definizione dei nuovi obiettivi.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Lightbulb, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Erstellung des Entwicklungsplans' 
                          : 'Creazione del piano di sviluppo')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'HALBJAHRES-CHECK: Kurzer Boxenstopp zur Kurskorrektur.' 
                          : 'CHECK SEMESTRALE: Breve pit-stop per correzione di rotta.'
                      )
                    )
                  )
                )
              )
            );
          };

          const renderCompetencyList = () => {
            if (!data || !data.competencies) return null;
            
            const core = data.competencies.filter(c => c.category === 'core');
            const lead = data.competencies.filter(c => c.category === 'leadership');

            return React.createElement('div', { className: "space-y-8 pb-10" },
              // BARS Explanation Box
              React.createElement('div', { className: "bg-[#243186] rounded-xl p-6 shadow-lg mb-6" },
                React.createElement('h2', { className: "text-2xl font-bold text-white mb-4 flex items-center gap-3" },
                  React.createElement(BookOpen, { size: 28, style: { color: "#6EBD84" } }),
                  lang === 'de' ? 'Bewertung anhand von Verhaltensankern (BARS)' : 'Valutazione tramite ancore comportamentali (BARS)'
                ),
                React.createElement('div', { className: "space-y-4 text-white" },
                  React.createElement('p', { className: "text-lg leading-relaxed" },
                    lang === 'de' 
                      ? 'Für jede Kompetenz wird ein Score von 1 bis 5 vergeben.'
                      : 'Per ogni competenza viene assegnato un punteggio da 1 a 5.'
                  ),
                  React.createElement('p', { className: "text-lg leading-relaxed" },
                    lang === 'de'
                      ? 'Basis ist nicht das "Bauchgefühl", sondern der Vergleich des beobachteten Verhaltens mit den definierten Ankern.'
                      : 'La base non è l\'intuizione, ma il confronto del comportamento osservato con gli ancore definiti.'
                  ),
                  React.createElement('div', { className: "bg-white/10 rounded-lg p-5 border-l-4", style: { borderColor: "#6EBD84" } },
                    React.createElement('div', { className: "flex items-start gap-3 mb-3" },
                      React.createElement(Lightbulb, { size: 24, style: { color: "#6EBD84" }, className: "flex-shrink-0 mt-1" }),
                      React.createElement('p', { className: "text-lg font-semibold", style: { color: "#6EBD84" } },
                        lang === 'de' 
                          ? 'Die Vorgehensweise für Führungskräfte:'
                          : 'La procedura per i manager:'
                      )
                    ),
                    React.createElement('p', { className: "text-white italic text-base leading-relaxed pl-9" },
                      lang === 'de'
                        ? 'Lese die Verhaltensanker im Handlungsleitfaden. Frage dich: "Welche Beschreibung passt am besten zu dem Verhalten, das ich dieses Jahr beobachtet habe?"'
                        : 'Leggi gli ancore comportamentali nella guida operativa. Chiediti: "Quale descrizione si adatta meglio al comportamento che ho osservato quest\'anno?"'
                    )
                  )
                )
              ),
              
              React.createElement('div', null,
                React.createElement('h3', { className: "text-lg font-bold text-slate-700 mb-4 flex items-center gap-2" },
                  React.createElement(Users, { size: 20 }), " ", t.coreComp
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 lg:grid-cols-3 gap-4" },
                  core.map(c => (
                    React.createElement('div', {
                      key: c.id,
                      onClick: () => navigateToCompetency(c.id),
                      className: "group bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-[#BAE1CE] cursor-pointer transition-all"
                    },
                      React.createElement('div', { className: "flex justify-between items-start mb-3" },
                        React.createElement('div', { className: "p-2 bg-[#F4FAF7] rounded-lg text-[#6EBD84] group-hover:bg-[#6EBD84] group-hover:text-white transition-colors" }, React.createElement(c.icon, { size: 24 })),
                        React.createElement(ChevronRight, { size: 20, className: "text-slate-300 group-hover:text-[#6EBD84]" })
                      ),
                      React.createElement('h4', { className: "font-bold text-slate-800" }, c.title)
                    )
                  ))
                )
              ),
              React.createElement('div', null,
                React.createElement('h3', { className: "text-lg font-bold text-slate-700 mb-4 flex items-center gap-2" },
                  React.createElement(Briefcase, { size: 20 }), " ", t.leadComp
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 lg:grid-cols-3 gap-4" },
                  lead.map(c => (
                    React.createElement('div', {
                      key: c.id,
                      onClick: () => navigateToCompetency(c.id),
                      className: "group bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-[#BAE1CE] cursor-pointer transition-all"
                    },
                      React.createElement('div', { className: "flex justify-between items-start mb-3" },
                        React.createElement('div', { className: "p-2 bg-[#F4FAF7] rounded-lg text-[#6EBD84] group-hover:bg-[#6EBD84] group-hover:text-white transition-colors" }, React.createElement(c.icon, { size: 24 })),
                        React.createElement(ChevronRight, { size: 20, className: "text-slate-300 group-hover:text-[#6EBD84]" })
                      ),
                      React.createElement('h4', { className: "font-bold text-slate-800" }, c.title)
                    )
                  ))
                )
              )
            );
          };

          const renderDetailView = () => {
            const compData = getActiveCompetencyData();
            if (!compData) return null;
            const currentLevel = compData.levels[activeScore];

            return React.createElement('div', { className: "animate-in slide-in-from-right duration-300 pb-12" },
              React.createElement('button', {
                onClick: () => setActiveView('list'),
                className: "text-sm text-slate-500 hover:text-[#6EBD84] flex items-center gap-1 mb-4"
              }, t.back),
              React.createElement('div', { className: "bg-white rounded-xl shadow-lg overflow-hidden border border-slate-200" },
                React.createElement('div', { className: "p-6 md:p-8 bg-slate-50 border-b border-slate-100" },
                  React.createElement('div', { className: "flex items-center gap-4 mb-4" },
                    React.createElement('div', { className: `p-3 rounded-xl ${compData.category === 'core' ? 'bg-[#6EBD84]' : 'bg-[#6EBD84]'} text-white` }, React.createElement(compData.icon, { size: 32 })),
                    React.createElement('div', null,
                      React.createElement('h2', { className: "text-2xl font-bold text-slate-800" }, compData.title),
                      React.createElement('span', { className: "text-xs uppercase tracking-wider font-semibold text-slate-500" }, compData.category === 'core' ? 'Core' : 'Leadership')
                    )
                  ),
                  React.createElement('p', { className: "text-slate-600 leading-relaxed" }, compData.definition)
                ),
                React.createElement('div', { className: "p-6 md:p-8" },
                  React.createElement('div', { className: "flex flex-col items-center mb-8" },
                    React.createElement('span', { className: "text-sm font-semibold text-slate-400 mb-4 uppercase tracking-widest" }, t.selectScore),
                    React.createElement('div', { className: "flex gap-3 md:gap-6" },
                      [1, 2, 3, 4, 5].map(s => React.createElement(ScoreBadge, { key: s, score: s, active: activeScore === s }))
                    )
                  ),
                  React.createElement('div', { className: "bg-slate-50 rounded-2xl p-6 md:p-8 border border-slate-200 relative overflow-hidden transition-all" },
                    React.createElement('div', { className: `absolute top-0 left-0 w-2 h-full ${activeScore === 1 ? 'bg-red-500' : activeScore === 2 ? 'bg-orange-400' : activeScore === 3 ? 'bg-green-500' : activeScore === 4 ? 'bg-blue-500' : 'bg-[#6EBD84]'}` }),
                    React.createElement('div', { className: "mb-6" },
                      React.createElement('h3', { className: "text-lg font-bold text-slate-800 mb-2 flex items-center gap-2" },
                        activeScore === 3 ? React.createElement(CheckCircle2, { className: "text-green-600", size: 20 }) :
                        activeScore === 5 ? React.createElement(Award, { className: "text-[#6EBD84]", size: 20 }) :
                        activeScore === 1 ? React.createElement(ShieldAlert, { className: "text-red-500", size: 20 }) : React.createElement(BookOpen, { className: "text-slate-400", size: 20 }),
                        activeScore === 1 ? t.level1 :
                        activeScore === 2 ? t.level2 :
                        activeScore === 3 ? t.level3 :
                        activeScore === 4 ? t.level4 : t.level5
                      ),
                      React.createElement('p', { className: "text-slate-700 text-lg leading-relaxed whitespace-pre-line" }, currentLevel.text)
                    ),
                    React.createElement('div', { className: "bg-white rounded-xl p-5 border-l-4 border-l-slate-300 shadow-sm" },
                      React.createElement('h4', { className: "text-sm font-bold text-slate-400 uppercase mb-2 flex items-center gap-2" },
                        React.createElement(Lightbulb, { size: 16 }), " ", t.example
                      ),
                      React.createElement('p', { className: "text-slate-600 italic font-medium" }, `"${currentLevel.example}"`)
                    )
                  )
                )
              )
            );
          };

          // === GPS EXPLAINER RENDER FUNCTION ===
          const renderGPSExplainer = () => {
            return React.createElement('div', { className: "pb-12 space-y-8" },
              // Header
              React.createElement('div', { className: "mb-4" },
                React.createElement('h1', { className: "text-3xl font-bold text-slate-800 mb-2" }, t.gpsExplainerTitle),
                React.createElement('p', { className: "text-slate-600 text-lg" }, t.gpsExplainerSubtitle)
              ),
              
              // OPTIMIERUNG 1: HERO-SEKTION MIT VISUELLER FORMEL
              React.createElement('div', { 
                className: "text-white py-10 px-6 md:px-8 rounded-3xl mb-8 shadow-2xl",
                style: { background: "linear-gradient(135deg, #243186 0%, #1a2460 100%)" }
              },
                React.createElement('h2', { className: "text-2xl md:text-3xl font-bold text-center mb-8" }, 
                  lang === 'de' ? 'Die GPS-Formel' : 'La Formula GPS'
                ),
                
                // Formel-Visualisierung - verbessert für bessere Darstellung
                React.createElement('div', { className: "flex items-center justify-center gap-3 md:gap-5 flex-wrap" },
                  // WAS Box
                  React.createElement('div', { 
                    className: "bg-white/10 backdrop-blur rounded-xl p-5 md:p-6 w-[140px] md:w-[180px] border border-white/20"
                  },
                    React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-2 text-center" }, "50%"),
                    React.createElement('div', { className: "text-lg md:text-xl font-semibold mb-1 text-center", style: { color: "#6EBD84" } }, 
                      lang === 'de' ? 'WAS' : 'COSA'
                    ),
                    React.createElement('div', { className: "text-xs opacity-80 text-center" }, 
                      lang === 'de' ? 'Ziele & KPIs' : 'Obiettivi & KPI'
                    )
                  ),
                  
                  // Plus Symbol
                  React.createElement('div', { className: "text-3xl md:text-4xl font-bold opacity-70" }, "+"),
                  
                  // WIE Box
                  React.createElement('div', { 
                    className: "bg-white/10 backdrop-blur rounded-xl p-5 md:p-6 w-[140px] md:w-[180px] border border-white/20"
                  },
                    React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-2 text-center" }, "50%"),
                    React.createElement('div', { className: "text-lg md:text-xl font-semibold mb-1 text-center", style: { color: "#6EBD84" } }, 
                      lang === 'de' ? 'WIE' : 'COME'
                    ),
                    React.createElement('div', { className: "text-xs opacity-80 text-center" }, 
                      lang === 'de' ? 'Kompetenzen' : 'Competenze'
                    )
                  ),
                  
                  // Equals Symbol
                  React.createElement('div', { className: "text-3xl md:text-4xl font-bold opacity-70" }, "="),
                  
                  // GPS Box - jetzt als weißer Kasten mit grünem Text
                  React.createElement('div', { 
                    className: "bg-white rounded-xl p-5 md:p-6 w-[140px] md:w-[180px] shadow-lg"
                  },
                    React.createElement('div', { className: "text-lg md:text-xl font-bold mb-1 text-center", style: { color: "#243186" } }, "GPS"),
                    React.createElement('div', { className: "text-2xl md:text-3xl font-bold mb-1 text-center", style: { color: "#6EBD84" } }, "1.0–5.0"),
                    React.createElement('div', { className: "text-xs text-center text-slate-600" }, "Performance Score")
                  )
                ),
                
                // Hinweis-Badge - dezenter
                React.createElement('div', { className: "mt-6 text-center" },
                  React.createElement('div', { className: "inline-flex items-center gap-2 bg-white/10 px-4 py-2 rounded-full text-sm" },
                    React.createElement(Info, { size: 16, style: { color: "#6EBD84" } }),
                    React.createElement('span', { className: "opacity-90" }, 
                      lang === 'de' ? 'Beide Dimensionen zählen gleich viel!' : 'Entrambe le dimensioni contano allo stesso modo!'
                    )
                  )
                ),
                
                // Manager/Mitarbeiter Unterscheidung - kompakter
                React.createElement('div', { className: "mt-4 flex justify-center gap-3 flex-wrap text-xs" },
                  React.createElement('div', { className: "bg-white/10 rounded-lg px-3 py-1.5" },
                    React.createElement('span', { className: "opacity-70" }, lang === 'de' ? 'MA: ' : 'Coll: '),
                    React.createElement('span', null, '50% + 50%')
                  ),
                  React.createElement('div', { className: "bg-white/10 rounded-lg px-3 py-1.5" },
                    React.createElement('span', { className: "opacity-70" }, lang === 'de' ? 'FK: ' : 'Dir: '),
                    React.createElement('span', null, '50% + 25% + 25%')
                  )
                )
              ),

              // WAS & WIE Cards - Visuell optimiert
              React.createElement('div', { className: "grid md:grid-cols-2 gap-6 mb-8" },
                
                // WAS Card
                React.createElement('div', { 
                  className: "text-white rounded-2xl p-6 md:p-8 shadow-xl transform hover:scale-[1.02] transition-all duration-300",
                  style: { background: "linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)" }
                },
                  React.createElement('div', { className: "flex items-center gap-4 mb-6" },
                    React.createElement('div', { className: "bg-white/20 rounded-full p-4" },
                      React.createElement(Target, { size: 32 })
                    ),
                    React.createElement('div', null,
                      React.createElement('div', { className: "text-3xl font-bold" }, "50%"),
                      React.createElement('div', { className: "text-lg font-semibold" }, t.wasExplainTitle)
                    )
                  ),
                  
                  React.createElement('div', { className: "space-y-4" },
                    React.createElement('p', { className: "text-white/90 leading-relaxed" }, t.wasExplainText),
                    
                    React.createElement('div', { className: "bg-white/10 rounded-lg p-4 backdrop-blur" },
                      React.createElement('div', { className: "text-xs font-semibold mb-2 opacity-75" }, 
                        lang === 'de' ? 'BEISPIEL:' : 'ESEMPIO:'
                      ),
                      React.createElement('div', { className: "text-sm" }, t.wasExplainExample)
                    ),
                    
                    React.createElement('div', { className: "flex items-center gap-2 text-sm font-semibold bg-white/20 rounded-lg px-4 py-2 w-fit" },
                      React.createElement(CheckCircle2, { size: 18 }),
                      lang === 'de' ? 'Objektiv messbar' : 'Oggettivamente misurabile'
                    )
                  )
                ),
                
                // WIE Card
                React.createElement('div', { 
                  className: "text-white rounded-2xl p-6 md:p-8 shadow-xl transform hover:scale-[1.02] transition-all duration-300",
                  style: { background: "linear-gradient(135deg, #6EBD84 0%, #3E7D4E 100%)" }
                },
                  React.createElement('div', { className: "flex items-center gap-4 mb-6" },
                    React.createElement('div', { className: "bg-white/20 rounded-full p-4" },
                      React.createElement(Brain, { size: 32 })
                    ),
                    React.createElement('div', null,
                      React.createElement('div', { className: "text-3xl font-bold" }, "50%"),
                      React.createElement('div', { className: "text-lg font-semibold" }, t.wieExplainTitle)
                    )
                  ),
                  
                  React.createElement('div', { className: "space-y-4" },
                    React.createElement('p', { className: "text-white/90 leading-relaxed" }, t.wieExplainText),
                    
                    // Gewichtung Pills
                    React.createElement('div', { className: "flex flex-wrap gap-2" },
                      React.createElement('div', { className: "bg-white/20 rounded-full px-4 py-2 text-sm font-semibold backdrop-blur" },
                        t.wieCoreExplainWeight
                      ),
                      React.createElement('div', { className: "bg-white/20 rounded-full px-4 py-2 text-sm font-semibold backdrop-blur" },
                        t.wieLeadExplainWeight
                      )
                    ),
                    
                    React.createElement('div', { className: "flex items-center gap-2 text-sm font-semibold bg-white/20 rounded-lg px-4 py-2 w-fit" },
                      React.createElement(ClipboardList, { size: 18 }),
                      lang === 'de' ? 'BARS-Methodik' : 'Metodologia BARS'
                    )
                  )
                )
              ),

              // Kompetenzen-Übersicht (kompakt)
              React.createElement('div', { className: "bg-white rounded-xl shadow-sm border border-slate-200 p-6" },
                React.createElement('h3', { className: "text-xl font-bold text-slate-800 mb-4 flex items-center gap-2" },
                  React.createElement(Users, { size: 24, style: { color: "#6EBD84" } }),
                  lang === 'de' ? 'Bewertete Kompetenzen' : 'Competenze valutate'
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 gap-4" },
                  // Kern-Kompetenzen
                  React.createElement('div', { className: "bg-purple-50 rounded-lg p-4 border border-purple-200" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-3" },
                      React.createElement('div', { className: "bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm" }, "5"),
                      React.createElement('span', { className: "font-bold text-purple-900" }, 
                        lang === 'de' ? 'Kern-Kompetenzen' : 'Competenze Core'
                      )
                    ),
                    React.createElement('div', { className: "text-sm text-slate-700 space-y-1" },
                      (lang === 'de' 
                        ? ['Fachkompetenz', 'Kommunikation', 'Problemlösung', 'Anpassungsfähigkeit', 'Selbstorganisation']
                        : ['Competenza tecnica', 'Comunicazione', 'Problem solving', 'Adattabilità', 'Auto-organizzazione']
                      ).map((comp, idx) => 
                        React.createElement('div', { key: idx, className: "flex items-center gap-2" },
                          React.createElement('span', { className: "text-purple-500" }, "•"),
                          comp
                        )
                      )
                    )
                  ),
                  // Leadership-Kompetenzen
                  React.createElement('div', { className: "bg-indigo-50 rounded-lg p-4 border border-indigo-200" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-3" },
                      React.createElement('div', { className: "bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm" }, "5"),
                      React.createElement('span', { className: "font-bold text-indigo-900" }, 
                        lang === 'de' ? 'Leadership-Kompetenzen' : 'Competenze Leadership'
                      ),
                      React.createElement('span', { className: "text-xs text-indigo-600 ml-2" }, 
                        lang === 'de' ? '(nur FK)' : '(solo dirigenti)'
                      )
                    ),
                    React.createElement('div', { className: "text-sm text-slate-700 space-y-1" },
                      (lang === 'de' 
                        ? ['Mitarbeiterführung', 'Strategisches Denken', 'Entscheidungsfähigkeit', 'Execution', 'Stakeholder-Mgmt']
                        : ['Gestione personale', 'Pensiero strategico', 'Capacità decisionale', 'Execution', 'Gestione stakeholder']
                      ).map((comp, idx) => 
                        React.createElement('div', { key: idx, className: "flex items-center gap-2" },
                          React.createElement('span', { className: "text-indigo-500" }, "•"),
                          comp
                        )
                      )
                    )
                  )
                )
              ),

              // BARS Conversion Table
              React.createElement('div', { className: "bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden" },
                React.createElement('div', { className: "p-6 border-b border-slate-200", style: { backgroundColor: "#243186" } },
                  React.createElement('h3', { className: "text-2xl font-bold text-white flex items-center gap-3" },
                    React.createElement(Scale, { className: "w-7 h-7", style: { color: "#6EBD84" } }),
                    t.barsConversionTitle
                  ),
                  React.createElement('p', { className: "mt-2", style: { color: "#6EBD84" } }, t.barsConversionDesc)
                ),
                React.createElement('div', { className: "overflow-x-auto" },
                  React.createElement('table', { className: "w-full" },
                    React.createElement('thead', { className: "bg-slate-50" },
                      React.createElement('tr', null,
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          lang === 'de' ? 'Zielerreichung %' : 'Raggiungimento %'
                        ),
                        React.createElement('th', { className: "px-6 py-3 text-center text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          "BARS-Stufe"
                        ),
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          lang === 'de' ? 'Beschreibung' : 'Descrizione'
                        )
                      )
                    ),
                    React.createElement('tbody', { className: "bg-white divide-y divide-slate-200" },
                      BARS_RANGES.map((range, idx) => React.createElement('tr', { key: idx, className: "hover:bg-slate-50" },
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900" }, 
                          lang === 'de' ? range.label : 
                            (range.score === 5 ? 'Eccezionale (>130%)' :
                             range.score === 4 ? 'Superato (111-130%)' :
                             range.score === 3 ? 'Baseline (90-110%)' :
                             range.score === 2 ? 'Parziale (70-89%)' : 'Non raggiunto (<70%)')
                        ),
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-center" },
                          React.createElement('span', { 
                            className: `inline-flex items-center justify-center w-10 h-10 rounded-full text-white font-bold ${
                              range.score === 5 ? 'bg-green-600' :
                              range.score === 4 ? 'bg-emerald-500' :
                              range.score === 3 ? 'bg-blue-600' :
                              range.score === 2 ? 'bg-orange-500' : 'bg-red-600'
                            }`
                          }, range.score)
                        ),
                        React.createElement('td', { className: "px-6 py-4 text-sm text-slate-700" }, 
                          lang === 'de' ? 
                            (range.score === 5 ? 'Ziel herausragend übertroffen' :
                             range.score === 4 ? 'Ziel übertroffen' :
                             range.score === 3 ? 'Ziel vollständig erreicht (Baseline)' :
                             range.score === 2 ? 'Ziel teilweise erreicht' : 'Ziel nicht erreicht') :
                            (range.score === 5 ? 'Obiettivo superato eccezionalmente' :
                             range.score === 4 ? 'Obiettivo superato' :
                             range.score === 3 ? 'Obiettivo completamente raggiunto (Baseline)' :
                             range.score === 2 ? 'Obiettivo parzialmente raggiunto' : 'Obiettivo non raggiunto')
                        )
                      ))
                    )
                  )
                )
              ),

              // Performance Rating Table
              React.createElement('div', { className: "bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden" },
                React.createElement('div', { className: "p-6 border-b border-slate-200", style: { backgroundColor: "#243186" } },
                  React.createElement('h3', { className: "text-2xl font-bold text-white flex items-center gap-3" },
                    React.createElement(Award, { className: "w-7 h-7", style: { color: "#6EBD84" } }),
                    t.performanceRatingTitle
                  ),
                  React.createElement('p', { className: "mt-2", style: { color: "#6EBD84" } }, t.performanceRatingDesc)
                ),
                React.createElement('div', { className: "overflow-x-auto" },
                  React.createElement('table', { className: "w-full" },
                    React.createElement('thead', { className: "bg-slate-50" },
                      React.createElement('tr', null,
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          "GPS Range"
                        ),
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          "Rating"
                        )
                      )
                    ),
                    React.createElement('tbody', { className: "bg-white divide-y divide-slate-200" },
                      RATINGS.map((rating, idx) => React.createElement('tr', { key: idx, className: "hover:bg-slate-50" },
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-bold text-slate-900" }, 
                          `${rating.min.toFixed(2)} - ${rating.max.toFixed(2)}`
                        ),
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" },
                          React.createElement('span', { className: `px-3 py-1 rounded-full text-white text-sm font-bold ${rating.color}` }, 
                            rating.label
                          )
                        )
                      ))
                    )
                  )
                )
              ),

              // Calculation Example
              React.createElement('div', { className: "bg-white rounded-xl shadow-sm border border-slate-200 p-6" },
                React.createElement('h3', { className: "text-2xl font-bold text-slate-800 mb-4 flex items-center gap-3" },
                  React.createElement(Calculator, { className: "w-7 h-7 text-slate-600" }),
                  t.calculationExampleTitle
                ),
                React.createElement('div', { className: "bg-slate-50 rounded-lg p-6 space-y-4" },
                  React.createElement('p', { className: "font-semibold text-slate-700" }, t.calculationExampleIntro),
                  React.createElement('ul', { className: "space-y-2 ml-4" },
                    React.createElement('li', { className: "text-slate-700" }, `• ${t.calculationStep1}`),
                    React.createElement('li', { className: "text-slate-700" }, `• ${t.calculationStep2}`),
                    React.createElement('li', { className: "text-slate-700" }, `• ${t.calculationStep3}`)
                  ),
                  React.createElement('div', { className: "border-t border-slate-300 pt-4 mt-4" },
                    React.createElement('p', { className: "font-semibold text-slate-700 mb-2" }, t.calculationFormula),
                    React.createElement('p', { className: "font-mono text-lg text-slate-800 bg-white p-4 rounded border border-slate-200" }, 
                      "(4,0 × 0,5) + (3,2 × 0,25) + (4,0 × 0,25) = 3,8"
                    )
                  ),
                  React.createElement('div', { className: "bg-green-50 border-l-4 border-green-500 p-4 rounded" },
                    React.createElement('p', { className: "font-bold text-green-900" }, t.calculationResult)
                  )
                )
              ),

              // Why GPS Section
              React.createElement('div', { className: "rounded-xl shadow-lg p-8", style: { backgroundColor: "#243186" } },
                React.createElement('h3', { className: "text-2xl font-bold text-white mb-6 flex items-center gap-3" },
                  React.createElement(Lightbulb, { className: "w-7 h-7", style: { color: "#6EBD84" } }),
                  t.whyGPSTitle
                ),
                React.createElement('div', { className: "grid md:grid-cols-3 gap-6" },
                  React.createElement('div', { className: "bg-white bg-opacity-10 rounded-lg p-6" },
                    React.createElement('div', { className: "w-12 h-12 rounded-full flex items-center justify-center mb-4", style: { backgroundColor: "#6EBD84" } },
                      React.createElement(Scale, { className: "w-6 h-6 text-white" })
                    ),
                    React.createElement('h4', { className: "text-lg font-bold text-white mb-2" }, t.whyGPS1Title),
                    React.createElement('p', { className: "text-slate-300 text-sm" }, t.whyGPS1Text)
                  ),
                  React.createElement('div', { className: "bg-white bg-opacity-10 rounded-lg p-6" },
                    React.createElement('div', { className: "w-12 h-12 rounded-full flex items-center justify-center mb-4", style: { backgroundColor: "#6EBD84" } },
                      React.createElement(Target, { className: "w-6 h-6 text-white" })
                    ),
                    React.createElement('h4', { className: "text-lg font-bold text-white mb-2" }, t.whyGPS2Title),
                    React.createElement('p', { className: "text-slate-300 text-sm" }, t.whyGPS2Text)
                  ),
                  React.createElement('div', { className: "bg-white bg-opacity-10 rounded-lg p-6" },
                    React.createElement('div', { className: "w-12 h-12 rounded-full flex items-center justify-center mb-4", style: { backgroundColor: "#6EBD84" } },
                      React.createElement(TrendingUp, { className: "w-6 h-6 text-white" })
                    ),
                    React.createElement('h4', { className: "text-lg font-bold text-white mb-2" }, t.whyGPS3Title),
                    React.createElement('p', { className: "text-slate-300 text-sm" }, t.whyGPS3Text)
                  )
                )
              )
            );
          };

          // === GUEST WELCOME RENDER FUNCTION ===
          const renderGuestWelcome = () => {
            if (!guestEmployee) return null;
            
            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4' },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-2xl w-full' },
                // Header mit Logo
                React.createElement('div', { className: 'text-center mb-8' },
                  React.createElement('h1', { className: 'text-2xl font-bold tracking-tight', style: { color: '#243186' } }, 'nıederwıeser'),
                  React.createElement('p', { className: 'text-xs uppercase tracking-widest', style: { color: '#6EBD84' } }, 'Performance Manager')
                ),
                
                // Willkommens-Icon
                React.createElement('div', { className: 'w-24 h-24 rounded-full bg-[#E8F5ED] flex items-center justify-center mx-auto mb-6' },
                  React.createElement(Users, { size: 48, className: 'text-[#6EBD84]' })
                ),
                
                // Begrüßung
                React.createElement('div', { className: 'text-center mb-8' },
                  React.createElement('h2', { className: 'text-3xl font-bold text-slate-800 mb-3' },
                    lang === 'de' ? 'Willkommen, ' : 'Benvenuto/a, ',
                    guestEmployee.name, '!'
                  ),
                  
                  // Position Badge
                  React.createElement('div', { className: 'inline-flex items-center gap-2 bg-slate-100 px-4 py-2 rounded-full text-sm text-slate-600' },
                    React.createElement(Briefcase, { size: 16 }),
                    guestEmployee.position,
                    guestEmployee.department && React.createElement('span', { className: 'text-slate-400' }, ' • ', guestEmployee.department)
                  )
                ),
                
                // Haupttext mit Zeitangabe
                React.createElement('div', { className: 'bg-slate-50 rounded-xl p-6 mb-6 text-center' },
                  React.createElement('div', { className: 'flex items-center justify-center gap-2 text-slate-500 mb-3' },
                    React.createElement(Clock, { size: 20 }),
                    React.createElement('span', { className: 'font-medium' }, 
                      lang === 'de' ? 'ca. 15-20 Minuten' : 'ca. 15-20 minuti'
                    )
                  ),
                  React.createElement('p', { className: 'text-slate-700 text-lg' },
                    lang === 'de'
                      ? 'Bitte nehmen Sie sich Zeit für Ihre Selbstreflexion zur Vorbereitung auf das Jahresgespräch mit Ihrer Führungskraft.'
                      : 'Per favore, prenditi del tempo per la tua autovalutazione in preparazione al colloquio annuale con il tuo responsabile.'
                  )
                ),
                
                // Info-Box: Was erwartet Sie?
                React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-5 mb-6' },
                  React.createElement('h4', { className: 'font-semibold text-blue-900 mb-3 flex items-center gap-2' },
                    React.createElement(Info, { size: 20 }),
                    lang === 'de' ? 'Was erwartet Sie?' : 'Cosa ti aspetta?'
                  ),
                  React.createElement('div', { className: 'grid md:grid-cols-2 gap-3' },
                    // Punkt 1
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '1')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Selbsteinschätzung Ihrer 5 Kernkompetenzen' : 'Autovalutazione delle tue 5 competenze chiave'
                      )
                    ),
                    // Punkt 2
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '2')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Reflexion zu Stärken & Entwicklungsfeldern' : 'Riflessione su punti di forza e aree di sviluppo'
                      )
                    ),
                    // Punkt 3
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '3')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Ihre Wünsche für das kommende Jahr' : 'I tuoi desideri per l\'anno prossimo'
                      )
                    ),
                    // Punkt 4
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '4')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Feedback zur Zusammenarbeit' : 'Feedback sulla collaborazione'
                      )
                    )
                  )
                ),
                
                // Sprachauswahl
                React.createElement('div', { className: 'flex justify-center gap-2 mb-6' },
                  React.createElement('button', {
                    onClick: () => setLang('de'),
                    className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${lang === 'de' ? 'bg-[#243186] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`
                  }, '🇩🇪 DE'),
                  React.createElement('button', {
                    onClick: () => setLang('it'),
                    className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${lang === 'it' ? 'bg-[#243186] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`
                  }, '🇮🇹 IT'),
                  React.createElement('button', {
                    onClick: () => setLang('en'),
                    className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${lang === 'en' ? 'bg-[#243186] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`
                  }, '🇬🇧 EN')
                ),
                
                // Start Button → navigiert zu guestForm
                React.createElement('button', {
                  onClick: () => setActiveView('guestForm'),
                  className: 'w-full bg-[#6EBD84] text-white py-4 rounded-xl font-semibold text-lg hover:bg-[#5da872] transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-3'
                },
                  React.createElement(Play, { size: 24 }),
                  lang === 'de' ? 'Selbstreflexion starten' : lang === 'it' ? 'Inizia autovalutazione' : 'Start Self-Reflection'
                ),
                
                // "Zurück zur App" Button - NUR für eingeloggte User (nicht anonym)
                user && !user.isAnonymous && React.createElement('button', {
                  onClick: () => {
                    // Gast-Modus beenden und zur normalen App zurückkehren
                    setGuestMode(false);
                    setGuestEmployee(null);
                    setGuestManagerId(null);
                    setActiveView('dashboard');
                    // URL bereinigen
                    window.history.replaceState({}, document.title, window.location.pathname);
                  },
                  className: 'w-full mt-3 bg-slate-100 text-slate-700 py-3 rounded-xl font-medium hover:bg-slate-200 transition-all flex items-center justify-center gap-2'
                },
                  React.createElement(ArrowLeft, { size: 18 }),
                  lang === 'de' ? 'Zurück zur App' : lang === 'it' ? 'Torna all\'app' : 'Back to App'
                ),
                
                // Footer Hinweis
                React.createElement('p', { className: 'text-xs text-slate-400 mt-6 text-center' },
                  lang === 'de'
                    ? '🔒 Ihre Eingaben werden vertraulich behandelt und dienen der Vorbereitung auf das Gespräch mit Ihrer Führungskraft.'
                    : '🔒 I tuoi dati saranno trattati in modo confidenziale e serviranno a preparare il colloquio con il tuo responsabile.'
                )
              )
            );
          };
          
          // === GUEST FORM RENDER FUNCTION (Vollständiges Selbstreflexions-Formular) ===
          const renderGuestForm = () => {
            if (!guestEmployee) return null;
            
            // Lokale States für das Gast-Formular
            const [guestFormData, setGuestFormData] = React.useState({
              strengths1: '',      // Meine größten Stärken
              strengths2: '',      // Meine Entwicklungsfelder
              wishesNextYear: '',  // Wünsche für das kommende Jahr
              feedbackManager: '', // Feedback an die Führungskraft
              additionalComments: '' // Sonstige Anmerkungen
            });
            
            // Kompetenz-Scores (nur Kern-Kompetenzen, keine Leadership)
            const [selfCoreScores, setSelfCoreScores] = React.useState({
              c1: 3, c2: 3, c3: 3, c4: 3, c5: 3
            });
            const [selfCoreComments, setSelfCoreComments] = React.useState({
              c1: '', c2: '', c3: '', c4: '', c5: ''
            });
            
            // Speicher-Status
            const [isSaving, setIsSaving] = React.useState(false);
            const [isSubmitted, setIsSubmitted] = React.useState(false);
            const [currentStep, setCurrentStep] = React.useState(1); // Wizard-Schritte
            
            // Kompetenz-Daten aus APP_DATA
            const competencyData = APP_DATA[lang]?.competencies?.filter(c => c.category === 'core') || [];
            
            // BARS Labels
            const barsLabels = {
              de: {
                1: 'Erfüllt nicht',
                2: 'Verbesserungsbedarf', 
                3: 'Baseline',
                4: 'Übertrifft',
                5: 'Herausragend'
              },
              it: {
                1: 'Non soddisfa',
                2: 'Da migliorare',
                3: 'Baseline',
                4: 'Supera',
                5: 'Eccellente'
              },
              en: {
                1: 'Does Not Meet',
                2: 'Needs Improvement',
                3: 'Baseline',
                4: 'Exceeds',
                5: 'Outstanding'
              }
            };
            
            // Speichern-Handler
            const handleGuestSave = async () => {
              if (!db || !guestEmployee) {
                alert(lang === 'de' ? 'Fehler: Keine Verbindung zur Datenbank.' : 'Errore: Nessuna connessione al database.');
                return;
              }
              
              setIsSaving(true);
              
              try {
                const selfAssessmentId = 'self_' + guestEmployee.id + '_' + Date.now();
                
                const selfAssessmentData = {
                  id: selfAssessmentId,
                  type: 'self_assessment',
                  employeeId: guestEmployee.id,
                  employeeName: guestEmployee.name,
                  position: guestEmployee.position,
                  department: guestEmployee.department || '',
                  userId: guestEmployee.userId, // Manager's userId für Zugriff
                  period: new Date().getFullYear().toString(),
                  status: 'submitted_self',
                  isSelfAssessment: true,
                  
                  // Kompetenz-Selbsteinschätzungen
                  selfCoreScores: selfCoreScores,
                  selfCoreComments: selfCoreComments,
                  
                  // Freitext-Felder
                  formData: {
                    strengths1: guestFormData.strengths1,
                    strengths2: guestFormData.strengths2,
                    wishesNextYear: guestFormData.wishesNextYear,
                    feedbackManager: guestFormData.feedbackManager,
                    additionalComments: guestFormData.additionalComments
                  },
                  
                  // Timestamps
                  createdAt: new Date().toISOString(),
                  submittedAt: new Date().toISOString()
                };
                
                // In Firestore speichern
                await db.collection('teamAppraisals').doc(selfAssessmentId).set(selfAssessmentData);
                
                console.log('✓ Selbstreflexion gespeichert:', selfAssessmentId);
                setIsSubmitted(true);
                
              } catch (error) {
                console.error('❌ Fehler beim Speichern:', error);
                alert(lang === 'de' 
                  ? 'Fehler beim Speichern. Bitte versuchen Sie es erneut.' 
                  : 'Errore durante il salvataggio. Riprova.');
              } finally {
                setIsSaving(false);
              }
            };
            
            // Success Screen nach dem Absenden
            if (isSubmitted) {
              return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4' },
                React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-lg w-full text-center' },
                  // Success Icon
                  React.createElement('div', { className: 'w-24 h-24 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-6' },
                    React.createElement(CheckCircle2, { size: 48, className: 'text-green-600' })
                  ),
                  
                  React.createElement('h2', { className: 'text-3xl font-bold text-slate-800 mb-4' },
                    lang === 'de' ? 'Vielen Dank!' : lang === 'it' ? 'Grazie mille!' : 'Thank you!'
                  ),
                  
                  React.createElement('p', { className: 'text-slate-600 text-lg mb-6' },
                    lang === 'de'
                      ? 'Ihre Selbstreflexion wurde erfolgreich übermittelt.'
                      : lang === 'it'
                      ? 'La tua autovalutazione è stata inviata con successo.'
                      : 'Your self-reflection has been submitted successfully.'
                  ),
                  
                  React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 text-left' },
                    React.createElement('h4', { className: 'font-semibold text-blue-900 mb-2 flex items-center gap-2' },
                      React.createElement(Info, { size: 18 }),
                      lang === 'de' ? 'Nächste Schritte' : lang === 'it' ? 'Prossimi passi' : 'Next Steps'
                    ),
                    React.createElement('p', { className: 'text-sm text-blue-800' },
                      lang === 'de'
                        ? 'Ihre Führungskraft wird Ihre Eingaben sehen und diese als Grundlage für das gemeinsame Jahresgespräch nutzen. Sie werden zeitnah kontaktiert, um einen Termin zu vereinbaren.'
                        : lang === 'it'
                        ? 'Il tuo responsabile vedrà le tue risposte e le utilizzerà come base per il colloquio annuale. Sarai contattato a breve per fissare un appuntamento.'
                        : 'Your manager will see your responses and use them as a basis for the annual review. You will be contacted shortly to schedule a meeting.'
                    )
                  ),
                  
                  // "Zurück zur App" Button - NUR für eingeloggte User (nicht anonym)
                  user && !user.isAnonymous 
                    ? React.createElement('button', {
                        onClick: () => {
                          // Gast-Modus beenden und zur normalen App zurückkehren
                          setGuestMode(false);
                          setGuestEmployee(null);
                          setGuestManagerId(null);
                          setActiveView('dashboard');
                          // URL bereinigen
                          window.history.replaceState({}, document.title, window.location.pathname);
                        },
                        className: 'w-full bg-[#6EBD84] text-white py-3 rounded-xl font-semibold hover:bg-[#5da872] transition-all flex items-center justify-center gap-2'
                      },
                        React.createElement(ArrowLeft, { size: 18 }),
                        lang === 'de' ? 'Zurück zur App' : lang === 'it' ? 'Torna all\'app' : 'Back to App'
                      )
                    : React.createElement('p', { className: 'text-sm text-slate-500' },
                        lang === 'de'
                          ? 'Sie können dieses Fenster jetzt schließen.'
                          : lang === 'it'
                          ? 'Puoi chiudere questa finestra.'
                          : 'You can close this window now.'
                      )
                )
              );
            }
            
            // Wizard Navigation
            const totalSteps = 4;
            const stepTitles = {
              de: ['Kompetenzen', 'Stärken & Entwicklung', 'Wünsche & Feedback', 'Zusammenfassung'],
              it: ['Competenze', 'Punti di forza', 'Desideri & Feedback', 'Riepilogo'],
              en: ['Competencies', 'Strengths & Development', 'Wishes & Feedback', 'Summary']
            };
            
            // Kompetenz-Bewertungs-Komponente
            const renderCompetencyCard = (comp, index) => {
              const compId = `c${index + 1}`;
              const currentScore = selfCoreScores[compId] || 3;
              const currentComment = selfCoreComments[compId] || '';
              
              return React.createElement('div', { 
                key: compId,
                className: 'bg-white rounded-xl border border-slate-200 p-5 mb-4'
              },
                // Header
                React.createElement('div', { className: 'flex items-start gap-3 mb-4' },
                  React.createElement('div', { className: 'w-10 h-10 rounded-lg bg-[#E8F5ED] flex items-center justify-center flex-shrink-0' },
                    React.createElement(comp.icon || Briefcase, { size: 20, className: 'text-[#6EBD84]' })
                  ),
                  React.createElement('div', null,
                    React.createElement('h4', { className: 'font-bold text-slate-800' }, comp.title),
                    React.createElement('p', { className: 'text-sm text-slate-500 mt-1' }, comp.definition?.substring(0, 100) + '...')
                  )
                ),
                
                // BARS Score Auswahl
                React.createElement('div', { className: 'mb-4' },
                  React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-2' },
                    lang === 'de' ? 'Ihre Selbsteinschätzung:' : lang === 'it' ? 'La tua autovalutazione:' : 'Your Self-Assessment:'
                  ),
                  React.createElement('div', { className: 'flex gap-2' },
                    [1, 2, 3, 4, 5].map(score => 
                      React.createElement('button', {
                        key: score,
                        onClick: () => setSelfCoreScores(prev => ({...prev, [compId]: score})),
                        className: `flex-1 py-3 px-2 rounded-lg border-2 transition-all text-center ${
                          currentScore === score 
                            ? score <= 2 ? 'border-red-500 bg-red-50 text-red-700' :
                              score === 3 ? 'border-green-500 bg-green-50 text-green-700' :
                              'border-blue-500 bg-blue-50 text-blue-700'
                            : 'border-slate-200 hover:border-slate-300 text-slate-600'
                        }`
                      },
                        React.createElement('div', { className: 'text-xl font-bold' }, score),
                        React.createElement('div', { className: 'text-xs mt-1 hidden sm:block' }, barsLabels[lang][score])
                      )
                    )
                  )
                ),
                
                // Kommentar-Feld
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-2' },
                    lang === 'de' ? 'Begründung / Beispiele (optional):' : lang === 'it' ? 'Motivazione / Esempi (opzionale):' : 'Reasoning / Examples (optional):'
                  ),
                  React.createElement('textarea', {
                    value: currentComment,
                    onChange: (e) => setSelfCoreComments(prev => ({...prev, [compId]: e.target.value})),
                    placeholder: lang === 'de' 
                      ? 'Beschreiben Sie konkrete Situationen, die Ihre Einschätzung belegen...'
                      : 'Descrivi situazioni concrete che supportano la tua valutazione...',
                    className: 'w-full border border-slate-300 rounded-lg px-4 py-3 text-sm resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                    rows: 3
                  })
                )
              );
            };
            
            // Step 1: Kompetenzen
            const renderStep1 = () => React.createElement('div', { className: 'space-y-4' },
              React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6' },
                React.createElement('p', { className: 'text-sm text-blue-800' },
                  lang === 'de'
                    ? 'Bitte schätzen Sie sich selbst in den folgenden 5 Kernkompetenzen ein. Nutzen Sie die Skala von 1 (Erfüllt nicht) bis 5 (Herausragend). Level 3 entspricht der erwarteten Baseline.'
                    : 'Per favore, valuta te stesso nelle seguenti 5 competenze chiave. Usa la scala da 1 (Non soddisfa) a 5 (Eccellente). Il livello 3 corrisponde alla baseline attesa.'
                )
              ),
              competencyData.map((comp, idx) => renderCompetencyCard(comp, idx))
            );
            
            // Step 2: Stärken & Entwicklung
            const renderStep2 = () => React.createElement('div', { className: 'space-y-6' },
              // Stärken
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(Award, { size: 20, className: 'text-[#6EBD84]' }),
                  lang === 'de' ? 'Meine größten Stärken' : lang === 'it' ? 'I miei punti di forza' : 'My Greatest Strengths'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Was können Sie besonders gut? Worauf sind Sie stolz?'
                    : 'In cosa sei particolarmente bravo? Di cosa sei orgoglioso?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.strengths1,
                  onChange: (e) => setGuestFormData(prev => ({...prev, strengths1: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Beschreiben Sie 2-3 Stärken mit konkreten Beispielen...'
                    : 'Descrivi 2-3 punti di forza con esempi concreti...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 5
                })
              ),
              
              // Entwicklungsfelder
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(TrendingUp, { size: 20, className: 'text-amber-500' }),
                  lang === 'de' ? 'Meine Entwicklungsfelder' : lang === 'it' ? 'Le mie aree di sviluppo' : 'My Development Areas'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Wo sehen Sie Verbesserungspotenzial? Was möchten Sie lernen?'
                    : 'Dove vedi potenziale di miglioramento? Cosa vorresti imparare?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.strengths2,
                  onChange: (e) => setGuestFormData(prev => ({...prev, strengths2: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Beschreiben Sie 1-2 Bereiche, in denen Sie sich entwickeln möchten...'
                    : 'Descrivi 1-2 aree in cui vorresti svilupparti...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 5
                })
              )
            );
            
            // Step 3: Wünsche & Feedback
            const renderStep3 = () => React.createElement('div', { className: 'space-y-6' },
              // Wünsche für das kommende Jahr
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(Target, { size: 20, className: 'text-purple-500' }),
                  lang === 'de' ? 'Meine Wünsche für das kommende Jahr' : lang === 'it' ? 'I miei desideri per l\'anno prossimo' : 'My wishes for the coming year'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Welche Projekte, Aufgaben oder Entwicklungsmöglichkeiten wünschen Sie sich?'
                    : 'Quali progetti, compiti o opportunità di sviluppo desideri?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.wishesNextYear,
                  onChange: (e) => setGuestFormData(prev => ({...prev, wishesNextYear: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'z.B. neue Verantwortungsbereiche, Weiterbildungen, Projektteilnahme...'
                    : 'es. nuove responsabilità, formazione, partecipazione a progetti...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 4
                })
              ),
              
              // Feedback an die FK
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(MessageCircle, { size: 20, className: 'text-blue-500' }),
                  lang === 'de' ? 'Feedback an meine Führungskraft' : lang === 'it' ? 'Feedback al mio responsabile' : 'Feedback to My Manager'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Was läuft gut in der Zusammenarbeit? Was könnte verbessert werden?'
                    : 'Cosa funziona bene nella collaborazione? Cosa potrebbe essere migliorato?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.feedbackManager,
                  onChange: (e) => setGuestFormData(prev => ({...prev, feedbackManager: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Konstruktives Feedback zur Zusammenarbeit...'
                    : 'Feedback costruttivo sulla collaborazione...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 4
                })
              ),
              
              // Sonstige Anmerkungen
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(FileText, { size: 20, className: 'text-slate-500' }),
                  lang === 'de' ? 'Sonstige Anmerkungen (optional)' : lang === 'it' ? 'Altre osservazioni (opzionale)' : 'Additional Comments (optional)'
                ),
                React.createElement('textarea', {
                  value: guestFormData.additionalComments,
                  onChange: (e) => setGuestFormData(prev => ({...prev, additionalComments: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Weitere Themen, die Sie besprechen möchten...'
                    : 'Altri argomenti che vorresti discutere...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 3
                })
              )
            );
            
            // Step 4: Zusammenfassung
            const renderStep4 = () => {
              // Durchschnittliche Selbsteinschätzung berechnen
              const avgScore = Object.values(selfCoreScores).reduce((a, b) => a + b, 0) / 5;
              
              return React.createElement('div', { className: 'space-y-6' },
                // Info-Box
                React.createElement('div', { className: 'bg-amber-50 border border-amber-200 rounded-xl p-4' },
                  React.createElement('p', { className: 'text-sm text-amber-800 flex items-start gap-2' },
                    React.createElement(AlertCircle, { size: 18, className: 'flex-shrink-0 mt-0.5' }),
                    lang === 'de'
                      ? 'Bitte prüfen Sie Ihre Angaben. Nach dem Absenden können Sie diese nicht mehr ändern.'
                      : 'Per favore, controlla i tuoi dati. Dopo l\'invio non potrai più modificarli.'
                  )
                ),
                
                // Kompetenz-Zusammenfassung
                React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                  React.createElement('h4', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                    React.createElement(Award, { size: 20, className: 'text-[#6EBD84]' }),
                    lang === 'de' ? 'Kompetenz-Selbsteinschätzung' : lang === 'it' ? 'Autovalutazione competenze' : 'Competency Self-Assessment'
                  ),
                  React.createElement('div', { className: 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 mb-4' },
                    competencyData.map((comp, idx) => {
                      const compId = `c${idx + 1}`;
                      const score = selfCoreScores[compId];
                      return React.createElement('div', { 
                        key: compId,
                        className: 'text-center p-3 bg-slate-50 rounded-lg'
                      },
                        React.createElement('div', { 
                          className: `text-2xl font-bold ${
                            score <= 2 ? 'text-red-600' : score === 3 ? 'text-green-600' : 'text-blue-600'
                          }`
                        }, score),
                        React.createElement('div', { className: 'text-xs text-slate-500 mt-1 truncate' }, comp.title?.split(' ')[0])
                      );
                    })
                  ),
                  React.createElement('div', { className: 'flex items-center justify-between bg-slate-100 rounded-lg p-3' },
                    React.createElement('span', { className: 'text-sm text-slate-600' },
                      lang === 'de' ? 'Durchschnitt:' : lang === 'it' ? 'Media:' : 'Average:'
                    ),
                    React.createElement('span', { className: 'text-xl font-bold text-[#243186]' }, avgScore.toFixed(2))
                  )
                ),
                
                // Freitext-Zusammenfassung
                React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                  React.createElement('h4', { className: 'font-semibold text-slate-800 mb-4' },
                    lang === 'de' ? 'Ihre Eingaben' : lang === 'it' ? 'Le tue risposte' : 'Your Responses'
                  ),
                  React.createElement('div', { className: 'space-y-4 text-sm' },
                    guestFormData.strengths1 && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'Stärken:' : lang === 'it' ? 'Punti di forza:' : 'Strengths:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.strengths1)
                    ),
                    guestFormData.strengths2 && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'Entwicklungsfelder:' : lang === 'it' ? 'Aree di sviluppo:' : 'Development Areas:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.strengths2)
                    ),
                    guestFormData.wishesNextYear && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'Wünsche:' : lang === 'it' ? 'Desideri:' : 'Wishes:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.wishesNextYear)
                    ),
                    guestFormData.feedbackManager && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'Feedback an FK:' : lang === 'it' ? 'Feedback al responsabile:' : 'Feedback to Manager:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.feedbackManager)
                    )
                  )
                )
              );
            };
            
            // Haupt-Render
            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4 pb-24' },
              React.createElement('div', { className: 'max-w-2xl mx-auto' },
                // Header (sticky)
                React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6 sticky top-4 z-10' },
                  // Obere Zeile: Logo, Skip-Button, User-Info
                  React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                    // Links: Logo
                    React.createElement('div', null,
                      React.createElement('h1', { className: 'text-xl font-bold', style: { color: '#243186' } }, 'nıederwıeser'),
                      React.createElement('p', { className: 'text-xs uppercase tracking-widest', style: { color: '#6EBD84' } }, 
                        lang === 'de' ? 'Selbstreflexion' : lang === 'it' ? 'Autovalutazione' : 'Self-Reflection'
                      )
                    ),
                    
                    // Mitte: Skip-Button (nur wenn nicht auf Schritt 4)
                    currentStep < 4 && React.createElement('button', {
                      onClick: () => setCurrentStep(4),
                      className: 'hidden sm:flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors'
                    },
                      React.createElement(ChevronRight, { size: 16 }),
                      lang === 'de' ? 'Zum Absenden' : lang === 'it' ? 'Vai all\'invio' : 'Skip to Submit'
                    ),
                    
                    // Rechts: User-Info
                    React.createElement('div', { className: 'text-right' },
                      React.createElement('p', { className: 'font-medium text-slate-800' }, guestEmployee.name),
                      React.createElement('p', { className: 'text-sm text-slate-500' }, guestEmployee.position)
                    )
                  ),
                  
                  // Mobile: Skip-Button unter der Kopfzeile (nur wenn nicht auf Schritt 4)
                  currentStep < 4 && React.createElement('div', { className: 'sm:hidden mb-4' },
                    React.createElement('button', {
                      onClick: () => setCurrentStep(4),
                      className: 'w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors'
                    },
                      React.createElement(ChevronRight, { size: 16 }),
                      lang === 'de' ? 'Direkt zum Absenden springen' : lang === 'it' ? 'Vai direttamente all\'invio' : 'Skip to Submit'
                    )
                  ),
                  
                  // Progress Bar
                  React.createElement('div', { className: 'flex items-center gap-2' },
                    [1, 2, 3, 4].map(step => 
                      React.createElement('div', { 
                        key: step,
                        className: 'flex-1'
                      },
                        React.createElement('div', { 
                          className: `h-2 rounded-full transition-all ${
                            step < currentStep ? 'bg-[#6EBD84]' :
                            step === currentStep ? 'bg-[#243186]' : 'bg-slate-200'
                          }`
                        }),
                        React.createElement('p', { className: `text-xs mt-1 text-center ${step === currentStep ? 'text-[#243186] font-medium' : 'text-slate-400'}` },
                          stepTitles[lang][step - 1]
                        )
                      )
                    )
                  )
                ),
                
                // Step Content
                React.createElement('div', { className: 'mb-6' },
                  currentStep === 1 && renderStep1(),
                  currentStep === 2 && renderStep2(),
                  currentStep === 3 && renderStep3(),
                  currentStep === 4 && renderStep4()
                ),
                
                // Navigation Buttons (Fixed am unteren Rand)
                React.createElement('div', { className: 'fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-4' },
                  React.createElement('div', { className: 'max-w-2xl mx-auto flex gap-3' },
                    // Zurück Button
                    currentStep > 1 && React.createElement('button', {
                      onClick: () => setCurrentStep(prev => prev - 1),
                      className: 'flex-1 py-3 px-6 border border-slate-300 text-slate-700 rounded-xl font-medium hover:bg-slate-50 transition-colors'
                    }, lang === 'de' ? '← Zurück' : lang === 'it' ? '← Indietro' : '← Back'),
                    
                    // Weiter / Absenden Button
                    currentStep < totalSteps 
                      ? React.createElement('button', {
                          onClick: () => setCurrentStep(prev => prev + 1),
                          className: 'flex-1 py-3 px-6 bg-[#6EBD84] text-white rounded-xl font-medium hover:bg-[#5da872] transition-colors'
                        }, lang === 'de' ? 'Weiter →' : lang === 'it' ? 'Avanti →' : 'Next →')
                      : React.createElement('button', {
                          onClick: handleGuestSave,
                          disabled: isSaving,
                          className: 'flex-1 py-3 px-6 bg-[#243186] text-white rounded-xl font-medium hover:bg-[#1a2563] transition-colors disabled:opacity-50 flex items-center justify-center gap-2'
                        }, 
                          isSaving && React.createElement(Loader2, { size: 20, className: 'animate-spin' }),
                          isSaving 
                            ? (lang === 'de' ? 'Wird gesendet...' : lang === 'it' ? 'Invio in corso...' : 'Sending...')
                            : (lang === 'de' ? '✓ Absenden' : lang === 'it' ? '✓ Invia' : '✓ Submit')
                        )
                  )
                )
              )
            );
          };

          // === VIEW SELF ASSESSMENT (Manager sieht eingereichte Selbstreflexion) ===
          const renderViewSelfAssessment = () => {
            // Lade Daten aus localStorage
            const stored = localStorage.getItem('nw_view_self_assessment');
            if (!stored) {
              return React.createElement('div', { className: 'text-center py-12' },
                React.createElement('p', { className: 'text-slate-500' }, 
                  lang === 'de' ? 'Keine Selbstreflexion ausgewählt.' : lang === 'it' ? 'Nessuna autovalutazione selezionata.' : 'No self-reflection selected.'
                ),
                React.createElement('button', {
                  onClick: () => setActiveView('teamoverview'),
                  className: 'mt-4 px-4 py-2 bg-slate-100 rounded-lg hover:bg-slate-200'
                }, lang === 'de' ? '← Zurück' : lang === 'it' ? '← Indietro' : '← Back')
              );
            }
            
            const selfData = JSON.parse(stored);
            const barsLabels = {
              de: { 1: 'Erfüllt nicht', 2: 'Verbesserungsbedarf', 3: 'Baseline', 4: 'Übertrifft', 5: 'Herausragend' },
              it: { 1: 'Non soddisfa', 2: 'Da migliorare', 3: 'Baseline', 4: 'Supera', 5: 'Eccellente' },
              en: { 1: 'Does Not Meet', 2: 'Needs Improvement', 3: 'Baseline', 4: 'Exceeds', 5: 'Outstanding' }
            };
            
            // Kompetenz-Namen (statt APP_DATA zu verwenden, definieren wir sie hier direkt)
            const competencyNames = {
              de: {
                c1: 'Fachkompetenz',
                c2: 'Kommunikation', 
                c3: 'Problemlösung',
                c4: 'Anpassungsfähigkeit',
                c5: 'Organisation'
              },
              it: {
                c1: 'Competenza tecnica',
                c2: 'Comunicazione',
                c3: 'Problem solving', 
                c4: 'Adattabilità',
                c5: 'Organizzazione'
              },
              en: {
                c1: 'Technical Expertise',
                c2: 'Communication',
                c3: 'Problem Solving', 
                c4: 'Adaptability',
                c5: 'Organization'
              }
            };
            
            // Kompetenz-Icons (Lucide)
            const competencyIcons = {
              c1: Briefcase,
              c2: MessageCircle,
              c3: Lightbulb,
              c4: RefreshCw,
              c5: Calendar
            };
            
            // Scores
            const scores = selfData.selfCoreScores || {};
            const comments = selfData.selfCoreComments || {};
            const compIds = ['c1', 'c2', 'c3', 'c4', 'c5'];
            
            // Durchschnitt berechnen
            const validScores = compIds.map(id => scores[id]).filter(v => v > 0);
            const avgScore = validScores.length > 0
              ? validScores.reduce((a, b) => a + b, 0) / validScores.length
              : 0;
            
            // Farbe für Score
            const getScoreColor = (score) => {
              if (score <= 1) return { bg: 'bg-red-500', text: 'text-red-800', light: 'bg-red-100' };
              if (score <= 2) return { bg: 'bg-orange-500', text: 'text-orange-800', light: 'bg-orange-100' };
              if (score <= 3) return { bg: 'bg-[#243186]', text: 'text-[#243186]', light: 'bg-blue-100' };
              if (score <= 4) return { bg: 'bg-[#6EBD84]', text: 'text-[#6EBD84]', light: 'bg-green-100' };
              return { bg: 'bg-[#6EBD84]', text: 'text-green-800', light: 'bg-green-100' };
            };
            
            return React.createElement('div', { className: 'space-y-6 pb-10' },
              // Header mit großem Namen
              React.createElement('div', { className: 'bg-gradient-to-r from-teal-500 to-teal-600 rounded-2xl p-6 text-white shadow-lg' },
                React.createElement('div', { className: 'flex items-center justify-between' },
                  React.createElement('div', null,
                    React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                      React.createElement('div', { className: 'bg-white/20 p-3 rounded-full' },
                        React.createElement(Users, { size: 28 })
                      ),
                      React.createElement('div', null,
                        React.createElement('p', { className: 'text-teal-100 text-sm' },
                          lang === 'de' ? 'Selbstreflexion von' : lang === 'it' ? 'Autovalutazione di' : 'Self-Reflection from'
                        ),
                        React.createElement('h1', { className: 'text-2xl md:text-3xl font-bold' },
                          selfData.employeeName || 'Mitarbeiter'
                        )
                      )
                    ),
                    React.createElement('div', { className: 'flex items-center gap-4 mt-3 text-sm text-teal-100' },
                      React.createElement('span', { className: 'flex items-center gap-1' },
                        React.createElement(Briefcase, { size: 14 }),
                        selfData.position || '–'
                      ),
                      selfData.department && React.createElement('span', { className: 'flex items-center gap-1' },
                        React.createElement(Building2, { size: 14 }),
                        selfData.department
                      ),
                      React.createElement('span', { className: 'flex items-center gap-1' },
                        React.createElement(Calendar, { size: 14 }),
                        selfData.period || new Date().getFullYear()
                      )
                    )
                  ),
                  React.createElement('button', {
                    onClick: () => {
                      localStorage.removeItem('nw_view_self_assessment');
                      setActiveView('teamoverview');
                    },
                    className: 'px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors'
                  }, 
                    React.createElement(ArrowLeft, { size: 16 }),
                    lang === 'de' ? 'Zurück' : lang === 'it' ? 'Indietro' : 'Back'
                  )
                )
              ),
              
              // Info-Banner mit Datum
              React.createElement('div', { className: 'bg-teal-50 border border-teal-200 rounded-xl p-4 flex items-center gap-3' },
                React.createElement('span', { className: 'text-2xl' }, '📩'),
                React.createElement('div', null,
                  React.createElement('span', { className: 'font-medium text-teal-900' },
                    lang === 'de' 
                      ? `Eingereicht am ${new Date(selfData.submittedAt || selfData.createdAt).toLocaleDateString('de-DE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`
                      : `Inviato il ${new Date(selfData.submittedAt || selfData.createdAt).toLocaleDateString('it-IT', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`
                  )
                )
              ),
              
              // Kompetenz-Scores mit Balken
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-slate-200 p-6' },
                React.createElement('div', { className: 'flex items-center justify-between mb-6' },
                  React.createElement('h3', { className: 'font-bold text-lg text-slate-800 flex items-center gap-2' },
                    React.createElement(Award, { size: 20, className: 'text-[#6EBD84]' }),
                    lang === 'de' ? 'Kompetenz-Selbsteinschätzung' : lang === 'it' ? 'Autovalutazione competenze' : 'Competency Self-Assessment'
                  ),
                  // Durchschnitt Badge
                  React.createElement('div', { className: 'bg-[#243186] text-white px-4 py-2 rounded-lg' },
                    React.createElement('span', { className: 'text-sm opacity-80' }, 'Ø '),
                    React.createElement('span', { className: 'text-xl font-bold' }, avgScore.toFixed(1))
                  )
                ),
                
                // Kompetenzen mit visuellen Balken
                React.createElement('div', { className: 'space-y-4' },
                  compIds.map(compId => {
                    const score = scores[compId] || 0;
                    const comment = comments[compId] || '';
                    const colors = getScoreColor(score);
                    const Icon = competencyIcons[compId] || Briefcase;
                    const name = competencyNames[lang]?.[compId] || compId;
                    
                    return React.createElement('div', { 
                      key: compId,
                      className: 'border border-slate-200 rounded-lg p-4 hover:border-slate-300 transition-colors'
                    },
                      // Kompetenz-Header
                      React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                        React.createElement('div', { className: 'flex items-center gap-2' },
                          React.createElement(Icon, { size: 18, className: 'text-slate-500' }),
                          React.createElement('span', { className: 'font-medium text-slate-800' }, name)
                        ),
                        React.createElement('div', { 
                          className: `px-3 py-1 rounded-full text-sm font-bold ${colors.light} ${colors.text}`
                        }, 
                          score, ' – ', barsLabels[lang]?.[score] || '–'
                        )
                      ),
                      
                      // Visueller Score-Balken
                      React.createElement('div', { className: 'flex items-center gap-2 mb-2' },
                        React.createElement('div', { className: 'flex-1 h-3 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: `h-full ${colors.bg} rounded-full transition-all duration-500`,
                            style: { width: `${(score / 5) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs text-slate-400 w-8 text-right' }, 
                          `${score}/5`
                        )
                      ),
                      
                      // BARS Skala Punkte
                      React.createElement('div', { className: 'flex justify-between px-1 mb-2' },
                        [1, 2, 3, 4, 5].map(n => 
                          React.createElement('div', { 
                            key: n,
                            className: `w-2 h-2 rounded-full ${n <= score ? colors.bg : 'bg-slate-200'}`
                          })
                        )
                      ),
                      
                      // Kommentar (falls vorhanden)
                      comment && React.createElement('div', { className: 'mt-3 bg-slate-50 rounded-lg p-3 border-l-4 border-teal-400' },
                        React.createElement('p', { className: 'text-sm text-slate-600 italic' },
                          '"', comment, '"'
                        )
                      )
                    );
                  })
                )
              ),
              
              // Freitext-Antworten
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-slate-200 p-6' },
                React.createElement('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  React.createElement(FileText, { size: 20, className: 'text-slate-500' }),
                  lang === 'de' ? 'Freitext-Antworten' : lang === 'it' ? 'Risposte libere' : 'Free Text Responses'
                ),
                
                React.createElement('div', { className: 'space-y-4' },
                  // Stärken
                  selfData.formData?.strengths1 && React.createElement('div', { className: 'border border-slate-200 rounded-lg p-4' },
                    React.createElement('label', { className: 'flex items-center gap-2 text-sm font-medium text-slate-700 mb-2' },
                      React.createElement(Award, { size: 16, className: 'text-[#6EBD84]' }),
                      lang === 'de' ? 'Meine größten Stärken' : lang === 'it' ? 'I miei punti di forza' : 'My Greatest Strengths'
                    ),
                    React.createElement('div', { className: 'bg-green-50 rounded-lg p-4 text-slate-700 whitespace-pre-wrap' },
                      selfData.formData.strengths1
                    )
                  ),
                  
                  // Entwicklungsfelder
                  selfData.formData?.strengths2 && React.createElement('div', { className: 'border border-slate-200 rounded-lg p-4' },
                    React.createElement('label', { className: 'flex items-center gap-2 text-sm font-medium text-slate-700 mb-2' },
                      React.createElement(TrendingUp, { size: 16, className: 'text-amber-500' }),
                      lang === 'de' ? 'Meine Entwicklungsfelder' : lang === 'it' ? 'Le mie aree di sviluppo' : 'My Development Areas'
                    ),
                    React.createElement('div', { className: 'bg-amber-50 rounded-lg p-4 text-slate-700 whitespace-pre-wrap' },
                      selfData.formData.strengths2
                    )
                  ),
                  
                  // Wünsche
                  selfData.formData?.wishesNextYear && React.createElement('div', { className: 'border border-slate-200 rounded-lg p-4' },
                    React.createElement('label', { className: 'flex items-center gap-2 text-sm font-medium text-slate-700 mb-2' },
                      React.createElement(Target, { size: 16, className: 'text-purple-500' }),
                      lang === 'de' ? 'Meine Wünsche für das kommende Jahr' : lang === 'it' ? 'I miei desideri per l\'anno prossimo' : 'My wishes for the coming year'
                    ),
                    React.createElement('div', { className: 'bg-purple-50 rounded-lg p-4 text-slate-700 whitespace-pre-wrap' },
                      selfData.formData.wishesNextYear
                    )
                  ),
                  
                  // Feedback an FK (hervorgehoben)
                  selfData.formData?.feedbackManager && React.createElement('div', { className: 'border-2 border-blue-300 rounded-lg p-4 bg-blue-50/50' },
                    React.createElement('label', { className: 'flex items-center gap-2 text-sm font-medium text-blue-800 mb-2' },
                      React.createElement(MessageCircle, { size: 16, className: 'text-blue-600' }),
                      lang === 'de' ? '💬 Feedback an Sie als Führungskraft' : lang === 'it' ? '💬 Feedback per Lei come responsabile' : '💬 Feedback to You as Manager'
                    ),
                    React.createElement('div', { className: 'bg-white rounded-lg p-4 text-blue-900 whitespace-pre-wrap border border-blue-200' },
                      selfData.formData.feedbackManager
                    )
                  ),
                  
                  // Sonstige Anmerkungen
                  selfData.formData?.additionalComments && React.createElement('div', { className: 'border border-slate-200 rounded-lg p-4' },
                    React.createElement('label', { className: 'flex items-center gap-2 text-sm font-medium text-slate-700 mb-2' },
                      React.createElement(FileText, { size: 16, className: 'text-slate-400' }),
                      lang === 'de' ? 'Sonstige Anmerkungen' : 'Altre osservazioni'
                    ),
                    React.createElement('div', { className: 'bg-slate-50 rounded-lg p-4 text-slate-700 whitespace-pre-wrap' },
                      selfData.formData.additionalComments
                    )
                  ),
                  
                  // Falls keine Freitexte vorhanden
                  !selfData.formData?.strengths1 && !selfData.formData?.strengths2 && !selfData.formData?.wishesNextYear && !selfData.formData?.feedbackManager && !selfData.formData?.additionalComments &&
                    React.createElement('div', { className: 'text-center py-8 text-slate-400' },
                      React.createElement('p', null, lang === 'de' ? 'Keine Freitext-Antworten vorhanden.' : lang === 'it' ? 'Nessuna risposta libera presente.' : 'No free text responses available.')
                    )
                )
              ),
              
              // Aktions-Buttons unten
              React.createElement('div', { className: 'flex justify-center gap-4 pt-4' },
                React.createElement('button', {
                  onClick: () => {
                    localStorage.removeItem('nw_view_self_assessment');
                    setActiveView('teamoverview');
                  },
                  className: 'px-6 py-3 bg-slate-100 hover:bg-slate-200 rounded-lg font-medium text-slate-700 flex items-center gap-2 transition-colors'
                }, 
                  React.createElement(ArrowLeft, { size: 18 }),
                  lang === 'de' ? 'Zurück zum Team' : lang === 'it' ? 'Torna al team' : 'Back to Team'
                )
              )
            );
          };

          // === MAIN RENDER ===
          
          // Migrations-Ladebildschirm (zeigt an während Daten importiert werden)
          if (migrationStatus === 'pending') {
            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center' },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-md text-center' },
                React.createElement('div', { className: 'w-16 h-16 rounded-full bg-[#E8F5ED] flex items-center justify-center mx-auto mb-6' },
                  React.createElement(Loader2, { className: 'w-8 h-8 animate-spin text-[#6EBD84]' })
                ),
                React.createElement('h2', { className: 'text-xl font-bold text-slate-800 mb-2' },
                  getText(lang, 'Daten werden importiert...', 'Importazione dati in corso...', 'Importing data...')
                ),
                React.createElement('p', { className: 'text-slate-500 text-sm' },
                  getText(lang, 
                    'Wir übertragen Ihre lokalen Daten sicher in die Cloud. Dies dauert nur einen Moment.',
                    'Stiamo trasferendo i tuoi dati locali nel cloud in modo sicuro. Ci vorrà solo un momento.',
                    'We are securely transferring your local data to the cloud. This will only take a moment.')
                ),
                React.createElement('div', { className: 'mt-6 flex items-center justify-center gap-2 text-xs text-slate-400' },
                  React.createElement('div', { className: 'w-2 h-2 rounded-full bg-[#6EBD84] animate-pulse' }),
                  React.createElement('span', null, getText(lang, 'Bitte warten...', 'Attendere prego...', 'Please wait...'))
                )
              )
            );
          }
          
          // Wenn Gast-Modus aktiv: Zeige nur die Gast-Ansicht (ohne Sidebar, ohne Login)
          if (guestMode) {
            // Loading State
            if (authLoading) {
              return React.createElement('div', { className: 'min-h-screen bg-slate-100 flex items-center justify-center' },
                React.createElement('div', { className: 'text-center' },
                  React.createElement(Loader2, { className: 'w-12 h-12 animate-spin text-[#6EBD84] mx-auto mb-4' }),
                  React.createElement('p', { className: 'text-slate-500' }, getText(lang, 'Laden...', 'Caricamento...', 'Loading...'))
                )
              );
            }
            
            // Gast-Willkommensseite
            if (activeView === 'guestWelcome') {
              return renderGuestWelcome();
            }
            
            // Gast-Formular (Selbstreflexion)
            if (activeView === 'guestForm') {
              return renderGuestForm();
            }
            
            // Fallback für unbekannte Gast-Views
            return React.createElement('div', { className: 'min-h-screen bg-slate-100 flex items-center justify-center p-4' },
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-slate-200 p-8 text-center max-w-md' },
                React.createElement(AlertCircle, { size: 48, className: 'text-amber-500 mx-auto mb-4' }),
                React.createElement('h2', { className: 'text-xl font-bold text-slate-800 mb-2' },
                  lang === 'de' ? 'Seite nicht gefunden' : lang === 'it' ? 'Pagina non trovata' : 'Page Not Found'
                ),
                React.createElement('button', {
                  onClick: () => setActiveView('guestWelcome'),
                  className: 'mt-4 px-6 py-2 bg-[#6EBD84] text-white rounded-lg hover:bg-[#5da872] transition-colors'
                }, lang === 'de' ? 'Zurück zum Start' : lang === 'it' ? 'Torna all\'inizio' : 'Back to Start')
              )
            );
          }

          // === LOADING SCREEN (während Auth oder AccessCode-Check läuft) ===
          if (authLoading || accessCodeChecking) {
            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center' },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-md text-center' },
                React.createElement('div', { className: 'w-16 h-16 rounded-full bg-[#E8F5ED] flex items-center justify-center mx-auto mb-6' },
                  React.createElement(Loader2, { className: 'w-8 h-8 animate-spin text-[#6EBD84]' })
                ),
                React.createElement('h1', { className: "text-[#243186] font-bold text-2xl tracking-tight mb-2" }, "nıederwıeser"),
                React.createElement('p', { className: "text-xs uppercase tracking-widest mb-4", style: { color: "#6EBD84" } }, "Performance Manager"),
                React.createElement('p', { className: 'text-slate-500 text-sm' },
                  getText(lang, 'Wird geladen...', 'Caricamento in corso...', 'Loading...')
                )
              )
            );
          }

          return React.createElement('div', { className: "min-h-screen bg-slate-100 font-sans text-slate-900 flex flex-col md:flex-row" },
            React.createElement('aside', { className: "bg-[#243186] text-slate-300 w-full md:w-64 flex-shrink-0 flex flex-col" }, // Sidebar background
              React.createElement('div', { className: "p-6 border-b border-slate-800" },
                React.createElement('h1', { className: "text-white font-bold text-xl tracking-tight" }, "nıederwıeser"),
                // Akzentfarbe geändert auf #6EBD84
                React.createElement('p', { className: "text-xs mt-1 uppercase tracking-widest", style: { color: "#6EBD84" } }, t.title)
              ),
              React.createElement('nav', { className: "flex-1 p-4 space-y-2" },
                React.createElement('div', { className: "mb-6 px-2" },
                    // Sprachauswahl modern
                    React.createElement('div', { className: "bg-slate-800/50 backdrop-blur rounded-xl p-1.5 border border-slate-700/50" },
                        React.createElement('div', { className: "flex gap-1" },
                            React.createElement('button', {
                                onClick: () => setLang('de'),
                                className: `flex-1 py-2.5 rounded-lg text-xs font-semibold tracking-wide transition-all duration-300 ${lang === 'de' ? 'bg-gradient-to-r from-[#6EBD84] to-[#5da872] text-white shadow-lg shadow-[#6EBD84]/30' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`
                            }, "DE"),
                            React.createElement('button', {
                                onClick: () => setLang('it'),
                                className: `flex-1 py-2.5 rounded-lg text-xs font-semibold tracking-wide transition-all duration-300 ${lang === 'it' ? 'bg-gradient-to-r from-[#6EBD84] to-[#5da872] text-white shadow-lg shadow-[#6EBD84]/30' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`
                            }, "IT"),
                            React.createElement('button', {
                                onClick: () => setLang('en'),
                                className: `flex-1 py-2.5 rounded-lg text-xs font-semibold tracking-wide transition-all duration-300 ${lang === 'en' ? 'bg-gradient-to-r from-[#6EBD84] to-[#5da872] text-white shadow-lg shadow-[#6EBD84]/30' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`
                            }, "EN")
                        )
                    ),
                    React.createElement('p', { className: "text-[10px] mt-2 text-center uppercase tracking-widest", style: { color: '#6EBD84' } },
                        'Select Language'
                    )
                ),
                // Navigations-Buttons mit Akzentfarbe
                React.createElement('button', {
                  // Navigation auf Dashboard
                  onClick: () => { setActiveView('dashboard'); setActiveScore(3); },
                  className: `w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeView === 'dashboard' ? 'bg-[#6EBD84] text-white' : 'hover:bg-slate-800'}`
                }, React.createElement(BookOpen, { size: 18 }), " ", t.dashboard),
                React.createElement('button', {
                  // Navigation auf Kompetenzliste
                  onClick: () => { setActiveView('list'); setActiveScore(3); },
                  className: `w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeView === 'list' || activeView === 'detail' ? 'bg-[#6EBD84] text-white' : 'hover:bg-slate-800'}`
                }, React.createElement(Users, { size: 18 }), " ", t.competencies),
                React.createElement('button', {
                  onClick: () => { setActiveView('gpsexplainer'); setActiveScore(3); },
                  className: `w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeView === 'gpsexplainer' ? 'bg-[#6EBD84] text-white' : 'hover:bg-slate-800'}`
                }, React.createElement(Info, { size: 18 }), " ", t.gpsExplainer),
                React.createElement('button', {
                  onClick: () => { setActiveView('formular'); setActiveScore(3); },
                  className: `w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeView === 'formular' ? 'bg-[#6EBD84] text-white' : 'hover:bg-slate-800'}`
                }, React.createElement(FileText, { size: 18 }), " ", t.formular),
                React.createElement('button', {
                  onClick: () => { setActiveView('zielvereinbarung'); setActiveScore(3); },
                  className: `w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeView === 'zielvereinbarung' ? 'bg-[#6EBD84] text-white' : 'hover:bg-slate-800'}`
                }, React.createElement(Target, { size: 18 }), " ", t.zielvereinbarung),
                React.createElement('button', {
                  onClick: () => { setActiveView('teamoverview'); setActiveScore(3); },
                  className: `w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeView === 'teamoverview' ? 'bg-[#6EBD84] text-white' : 'hover:bg-slate-800'}`
                }, React.createElement(Users, { size: 18 }), " ", getText(lang, 'Mein Team', 'Il mio team', 'My Team')),
                // Team-Kalibrierung Menüpunkt (nur für FK mit Team sichtbar)
                teamMembers.length > 0 && React.createElement('button', {
                  onClick: () => { setActiveView('teamcalibration'); setActiveScore(3); },
                  className: `w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeView === 'teamcalibration' ? 'bg-[#6EBD84] text-white' : 'hover:bg-slate-800'}`
                }, React.createElement(Scale, { size: 18 }), " ", getText(lang, '📊 Team-Kalibrierung', '📊 Calibrazione Team', '📊 Team Calibration')),
                // HR ADMIN Menüpunkt (nur für HR-Admins sichtbar)
                isHRAdmin && React.createElement('div', { className: 'mt-4 pt-4 border-t border-slate-700' },
                  React.createElement('p', { className: 'text-xs px-4 mb-2 uppercase tracking-wider', style: { color: '#6EBD84' } }, 'HR Admin'),
                  React.createElement('button', {
                    onClick: () => { setActiveView('hrdashboard'); },
                    className: `w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeView === 'hrdashboard' ? 'bg-purple-600 text-white' : 'hover:bg-slate-800 text-purple-300'}`
                  }, React.createElement(Building2, { size: 18 }), ' 🔐 HR Dashboard')
                )
              )
            ),
            React.createElement('main', { className: "flex-1 overflow-y-auto h-screen p-4 md:p-8 md:pb-20" },
              React.createElement('div', { className: "max-w-4xl mx-auto" },
                activeView === 'dashboard' && renderDashboard(),
                activeView === 'list' && renderCompetencyList(),
                activeView === 'detail' && renderDetailView(),
                activeView === 'gpsexplainer' && renderGPSExplainer(),
                activeView === 'zielvereinbarung' && React.createElement(Zielvereinbarung, { lang: lang, onSaveTeam: saveTeamAppraisal, onCancel: () => setActiveView('teamoverview') }),
                activeView === 'teamoverview' && renderTeamOverview(),
                activeView === 'viewSelfAssessment' && renderViewSelfAssessment(),
                activeView === 'formular' && React.createElement(AppraisalForm, { lang: lang, onSaveTeam: saveTeamAppraisal, onCancel: () => setActiveView('teamoverview'), db: db }),
                activeView === 'teamcalibration' && renderTeamCalibration(),
                activeView === 'hrdashboard' && isHRAdmin && renderHRDashboard()
              )
            ),
            // HelpChat - Smart HR Assistant (nur für eingeloggte User)
            React.createElement(HelpChat, { 
              lang: lang, 
              setActiveView: setActiveView, 
              activeView: activeView,
              setSelectedCompetencyId: setSelectedCompetencyId 
            })
          );
        }

        // --- RENDER APP ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(PerformanceApp));
    </script>
</body>
</html>