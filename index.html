<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com https://www.gstatic.com https://esm.sh; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; connect-src 'self' https://*.googleapis.com https://*.firebaseio.com https://*.firebaseapp.com https://*.cloudfunctions.net wss://*.firebaseio.com https://esm.sh; img-src 'self' data: blob: https://*.googleusercontent.com https://*.firebasestorage.app; font-src 'self' data:; frame-src 'self' https://*.firebaseapp.com;">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Niederwieser Performance Manager v93 - Production Hardening</title>
    
    <script src="https://cdn.tailwindcss.com/3.4.17"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <script>
        // VERSION CHECK - Wenn du diese Zeile in der Konsole siehst, ist v93 aktiv!
        console.log('üöÄ Performance Manager v93 - Production Hardening: CSP, Error Boundary, PII-safe Logging');
        
        // ============================================
        // PRODUCTION MODE & SAFE LOGGING
        // ============================================
        const PRODUCTION_MODE = window.location.hostname !== 'localhost' && !window.location.hostname.includes('127.0.0.1');
        
        // Sanitize PII from log output (DSGVO-konform)
        const sanitizeForLog = (value) => {
            if (typeof value !== 'string') return value;
            // Email: show only domain
            if (value.includes('@')) return value.replace(/^[^@]+/, '***');
            return value;
        };
        
        // Debug logger - only logs in development, sanitizes PII
        const devLog = (...args) => {
            if (PRODUCTION_MODE) return;
            const sanitized = args.map(a => typeof a === 'string' ? sanitizeForLog(a) : a);
            console.log(...sanitized);
        };
        const devWarn = (...args) => {
            if (PRODUCTION_MODE) return;
            console.warn(...args);
        };
        const devError = (...args) => {
            // Errors always log, but sanitize PII
            const sanitized = args.map(a => typeof a === 'string' ? sanitizeForLog(a) : a);
            console.error(...sanitized);
        };
        
        // ============================================
        // GLOBAL ERROR HANDLERS
        // F√§ngt unbehandelte Fehler und Promise-Rejections
        // ============================================
        window.addEventListener('error', (event) => {
            devError('üö® Unhandled Error:', event.message);
            // TODO: Sentry/Error-Tracking
        });
        window.addEventListener('unhandledrejection', (event) => {
            devError('üö® Unhandled Promise Rejection:', event.reason?.message || event.reason);
            // TODO: Sentry/Error-Tracking
        });
        
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'in': 'fade-in 0.3s ease-out',
                        'out': 'fade-out 0.3s ease-out',
                    },
                    keyframes: {
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        'fade-out': {
                            '0%': { opacity: '1', transform: 'translateY(0)' },
                            '100%': { opacity: '0', transform: 'translateY(10px)' },
                        }
                    }
                }
            }
        };
    </script>

    <style>
        body { -webkit-font-smoothing: antialiased; }
        /* Custom Scrollbar for better visibility */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* === TOAST ANIMATION === */
        @keyframes slideUp {
            from { opacity: 0; transform: translateX(-50%) translateY(30px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        /* === AUTO-GROW TEXTAREA STYLES === */
        /* Diese Styles sorgen daf√ºr, dass Textareas im UI mit dem Inhalt mitwachsen */
        .auto-grow-textarea {
            min-height: 60px !important;
            max-height: 400px !important;
            overflow-y: auto !important;
            resize: vertical !important;
            line-height: 1.5 !important;
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
        }
        
        /* Comment-Textareas in Kompetenz-Tabellen */
        .competency-comment-textarea {
            min-height: 40px !important;
            max-height: 200px !important;
            overflow-y: auto !important;
            resize: vertical !important;
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
            width: 100% !important;
        }
        
        /* Input-Felder die viel Text enthalten k√∂nnen */
        .text-input-expandable {
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
        }
        /* Zus√§tzliche Flex-Anpassung f√ºr die gleich hohe Spalte */
        .equal-height-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem; /* 6 */
            align-items: stretch;
        }
        
        /* ========================================
           PROFESSIONAL PDF PRINT STYLES
           DIN A4 Format (210mm x 297mm)
           Niederwieser Corporate Design
           ======================================== */
        
        /* === PRINT MEDIA QUERY === */
        @media print {
            .no-print { display: none !important; visibility: hidden !important; height: 0 !important; overflow: hidden !important; }
            .break-inside-avoid { page-break-inside: avoid; break-inside: avoid; }
            body { background: white !important; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            
            /* Hide navigation and interactive elements - but NOT form inputs in content area */
            button, select, nav, aside, .no-print { display: none !important; }
            
            /* Style inputs/textareas to look like text in print */
            input, textarea {
                border: none !important;
                background: transparent !important;
                resize: none !important;
                overflow: visible !important;
                height: auto !important;
                min-height: auto !important;
                padding: 0 !important;
            }
            
            /* Hide sidebar for print */
            nav, aside, [class*="sidebar"], [class*="w-64"], [class*="bg-slate-900"] { display: none !important; }
            
            /* Make main content full width */
            main, [class*="flex-1"] { 
                width: 100% !important; 
                max-width: 100% !important;
                margin: 0 !important;
                padding: 10mm !important;
            }
            
            /* Ensure colors print correctly */
            .bg-gradient-to-r, [class*="bg-teal"], [class*="bg-blue"], [class*="bg-green"], [class*="bg-orange"] {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* Page breaks */
            .print-break-before { page-break-before: always; }
            .print-break-after { page-break-after: always; }
            h2, h3 { page-break-after: avoid; }
            
            /* Tables should have visible borders */
            table { border-collapse: collapse !important; }
            td, th { border: 1px solid #ccc !important; }
            
            /* Force page size */
            @page {
                size: A4 portrait;
                margin: 15mm;
            }
        }
        
        /* === KRITISCH: no-print Elemente auch ohne print-media ausblenden f√ºr html2pdf === */
        .pdf-export-mode .no-print,
        .pdf-render-container .no-print,
        [data-pdf-export="true"] .no-print {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            width: 0 !important;
            overflow: hidden !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        /* === PDF-ONLY Elements (visible only in PDF) === */
        .pdf-only { 
            display: none; 
        }
        .pdf-mode .pdf-only { 
            display: block !important; 
        }
        
        /* ========================================
           PDF MODE - Professional Document Layout
           KRITISCH: Alle Ma√üe in PIXEL (px) f√ºr html2pdf.js
           A4 = 210mm √ó 297mm = 794px √ó 1123px @ 96dpi
           Content-Breite = 794px - 2√ó57px (15mm R√§nder) = 680px
           ======================================== */
        .pdf-mode {
            background: white !important;
            width: 680px !important;  /* Content-Breite ohne R√§nder */
            max-width: 680px !important;
            margin: 0 !important;
            padding: 0 !important;
            font-family: Arial, Helvetica, sans-serif !important;
            font-size: 12px !important;
            line-height: 1.4 !important;
            color: #1e293b !important;
            box-sizing: border-box !important;
        }
        
        .pdf-mode * {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
            box-sizing: border-box !important;
        }
        
        .pdf-mode .no-print { 
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
        }
        
        /* === PAGE BREAK CONTROL === */
        .pdf-mode .break-inside-avoid,
        .pdf-mode .pdf-section { 
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        .pdf-mode .page-break-before {
            page-break-before: always !important;
            break-before: page !important;
        }
        
        .pdf-mode .pdf-text-block {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
            orphans: 3;
            widows: 3;
        }
        
        .pdf-mode .pdf-keep-together {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        /* === KRITISCH: Verhindere Range-Error bei Bildern und komplexen Elementen === */
        .pdf-mode img {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
            max-width: 100% !important;
        }
        
        .pdf-mode svg {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        /* Alle interaktiven Elemente komplett verstecken */
        .pdf-mode button,
        .pdf-mode input,
        .pdf-mode textarea,
        .pdf-mode select {
            display: none !important;
        }
        
        /* === TEXT WRAPPING - CRITICAL FOR LONG CONTENT === */
        .pdf-mode td,
        .pdf-mode th,
        .pdf-mode p,
        .pdf-mode span,
        .pdf-mode div,
        .pdf-mode .pdf-text-content {
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
            word-break: break-word !important;
            overflow-wrap: break-word !important;
        }
        
        /* === TYPOGRAPHY - Corporate Design (in px) === */
        .pdf-mode h1 { 
            font-size: 28px !important; 
            font-weight: 700 !important;
            color: #243186 !important;
            margin: 0 0 4px 0 !important;
            line-height: 1.2 !important;
        }
        .pdf-mode h2 { 
            font-size: 20px !important; 
            font-weight: 700 !important;
            color: #243186 !important;
            margin: 0 0 12px 0 !important;
            page-break-after: avoid !important;
        }
        .pdf-mode h3 { 
            font-size: 16px !important; 
            font-weight: 600 !important;
            color: #243186 !important;
            margin: 0 0 8px 0 !important;
            page-break-after: avoid !important;
        }
        .pdf-mode h4 { 
            font-size: 14px !important; 
            font-weight: 600 !important;
            color: #334155 !important;
            margin: 0 0 4px 0 !important;
        }
        .pdf-mode p { 
            font-size: 12px !important; 
            line-height: 1.4 !important;
            margin: 0 0 8px 0 !important;
        }
        .pdf-mode label { 
            font-size: 11px !important;
            font-weight: 500 !important;
            color: #475569 !important;
        }
        
        /* === TABLE STYLES - Professional Look === */
        .pdf-mode table {
            border-collapse: collapse !important;
            width: 100% !important;
            margin: 8px 0 16px 0 !important;
            table-layout: fixed !important;
            font-size: 12px !important;
        }
        .pdf-mode thead th {
            background-color: #f8fafc !important;
            font-weight: 700 !important;
            font-size: 11px !important;
            padding: 8px 6px !important;
            border: 1px solid #e2e8f0 !important;
            text-align: left !important;
            color: #334155 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.025em !important;
        }
        .pdf-mode tbody td {
            padding: 8px 6px !important;
            border: 1px solid #e2e8f0 !important;
            font-size: 12px !important;
            vertical-align: top !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            background: white !important;
        }
        .pdf-mode tbody tr {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        .pdf-mode tbody tr:nth-child(even) td {
            background-color: #fafafa !important;
        }
        
        /* Long text cells can break across pages */
        .pdf-mode td.pdf-text-cell {
            page-break-inside: auto !important;
            break-inside: auto !important;
        }
        
        /* === SECTION STYLING === */
        .pdf-mode .pdf-section-container {
            margin-bottom: 16px !important;
            padding: 0 !important;
            border: none !important;
        }
        
        .pdf-mode .pdf-section-header {
            background: #f8fafc !important;
            padding: 10px 12px !important;
            border-left: 4px solid #243186 !important;
            margin-bottom: 12px !important;
        }
        
        .pdf-mode .pdf-section-header-green {
            border-left-color: #6EBD84 !important;
        }
        
        /* === REMOVE WEB-SPECIFIC STYLING === */
        .pdf-mode [class*="shadow"] {
            box-shadow: none !important;
        }
        .pdf-mode [class*="rounded-3xl"],
        .pdf-mode [class*="rounded-2xl"],
        .pdf-mode [class*="rounded-xl"] {
            border-radius: 4px !important;
        }
        .pdf-mode [class*="rounded-lg"],
        .pdf-mode [class*="rounded-md"] {
            border-radius: 2px !important;
        }
        
        /* === GPS SCORE BOX === */
        .pdf-mode .pdf-gps-box {
            background: linear-gradient(135deg, #243186 0%, #1a2564 100%) !important;
            padding: 20px !important;
            border-radius: 4px !important;
            text-align: center !important;
            margin: 16px 0 !important;
            page-break-inside: avoid !important;
        }
        .pdf-mode .pdf-gps-score {
            font-size: 48px !important;
            font-weight: 900 !important;
            color: white !important;
            margin: 8px 0 !important;
        }
        .pdf-mode .pdf-gps-label {
            font-size: 12px !important;
            color: #6EBD84 !important;
            font-weight: 600 !important;
            text-transform: uppercase !important;
            letter-spacing: 2px !important;
        }
        
        /* === TEXT DISPLAY BLOCKS (replaces textarea/input in print) === */
        .pdf-mode .pdf-text-display {
            padding: 10px 12px !important;
            border: 1px solid #e2e8f0 !important;
            border-radius: 4px !important;
            background: #fafafa !important;
            min-height: 30px !important;
            font-size: 12px !important;
            line-height: 1.5 !important;
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            color: #334155 !important;
        }
        
        .pdf-mode .pdf-text-display:empty::before {
            content: '‚Äì';
            color: #94a3b8;
        }
        
        /* === SIGNATURE AREA === */
        .pdf-mode .pdf-signature-line {
            border-bottom: 1px solid #1e293b !important;
            height: 40px !important;
            margin-top: 30px !important;
        }
        
        /* === CONFIDENTIAL BADGE === */
        .pdf-mode .pdf-confidential {
            font-size: 10px !important;
            color: #dc2626 !important;
            font-weight: 600 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
        }
        
        /* === RATING BADGES === */
        .pdf-mode .pdf-rating-badge {
            display: inline-block !important;
            width: 24px !important;
            height: 24px !important;
            line-height: 24px !important;
            text-align: center !important;
            border-radius: 50% !important;
            font-weight: 700 !important;
            font-size: 13px !important;
            color: white !important;
        }
        .pdf-mode .pdf-rating-1 { background: #dc2626 !important; }
        .pdf-mode .pdf-rating-2 { background: #f59e0b !important; }
        .pdf-mode .pdf-rating-3 { background: #3b82f6 !important; }
        .pdf-mode .pdf-rating-4 { background: #22c55e !important; }
        .pdf-mode .pdf-rating-5 { background: #059669 !important; }
    </style>
</head>
<body class="bg-slate-100 text-slate-900">
    
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            BookOpen, Users, Target, Award, ChevronRight, Star, AlertTriangle,
            X, Zap, Heart, Scale, Brain, TrendingUp, Clock, MessageCircle, 
            Briefcase, Lightbulb, ShieldAlert, CheckCircle2, Check, AlertCircle,
            ClipboardList, CalendarCheck, Calculator, Info, RotateCcw, Trophy, PlusCircle, XCircle,
            Download, Loader2, Trash2, FileText, Edit2, Edit3, Eye, UserPlus, Play, LogOut, Mail, Lock, Link, Save, LayoutGrid, List,
            Building2, ArrowLeft, RefreshCw, Calendar, User, HelpCircle, Send, Sparkles, Copy, Circle, Share2, Users2,
            Upload, FileUp, ExternalLink, Settings, Factory, ChevronLeft, Filter, SlidersHorizontal, ChevronDown, ChevronUp
        } from 'https://esm.sh/lucide-react@0.292.0';

        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyCxQ9qLHls7RAUWmOkOSAg1E9-wzfRIAYc",
            authDomain: "performance-manager-b0967.firebaseapp.com",
            projectId: "performance-manager-b0967",
            storageBucket: "performance-manager-b0967.firebasestorage.app",
            messagingSenderId: "191493540566",
            appId: "1:191493540566:web:a64b78148c01a8fc089777",
            measurementId: "G-BHVYQBQR9C"
        };

        // Firebase initialisieren
        let firebaseApp = null;
        let auth = null;
        let db = null;
        let storage = null;  // Global f√ºr Storage
        
        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            storage = firebase.storage();  // Firebase Storage f√ºr gro√üe Dateien (PDFs)
            devLog("Firebase erfolgreich initialisiert (inkl. Storage)");
        } catch (error) {
            console.error("Firebase Initialisierungsfehler:", error);
        }

        // ============================================
        // HR ADMIN CONFIGURATION
        // ============================================
        const HR_ADMIN_EMAILS = ['d.andrisani@niederwiesergroup.com'];
        const isUserHRAdmin = (email) => email && HR_ADMIN_EMAILS.includes(email.toLowerCase());

        // ============================================
        // REACT ERROR BOUNDARY
        // F√§ngt unbehandelte Fehler in Komponenten ab
        // und zeigt eine benutzerfreundliche Fehlermeldung
        // ============================================
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null, errorInfo: null };
            }
            
            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }
            
            componentDidCatch(error, errorInfo) {
                this.setState({ errorInfo });
                devError('üö® React Error Boundary caught error:', error?.message);
                // TODO: Hier Sentry/Error-Tracking einbinden
                // if (window.Sentry) window.Sentry.captureException(error, { extra: errorInfo });
            }
            
            render() {
                if (this.state.hasError) {
                    return React.createElement('div', { 
                        className: 'min-h-screen bg-slate-100 flex items-center justify-center p-6' 
                    },
                        React.createElement('div', { 
                            className: 'bg-white rounded-2xl shadow-xl p-8 max-w-lg w-full text-center' 
                        },
                            React.createElement('div', { 
                                className: 'w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4' 
                            }, React.createElement('span', { className: 'text-3xl' }, '‚ö†Ô∏è')),
                            React.createElement('h2', { 
                                className: 'text-xl font-bold text-slate-800 mb-2' 
                            }, 'Es ist ein Fehler aufgetreten'),
                            React.createElement('p', { 
                                className: 'text-slate-600 mb-6' 
                            }, 'Die Anwendung hat einen unerwarteten Fehler festgestellt. Bitte laden Sie die Seite neu.'),
                            !PRODUCTION_MODE && this.state.error && React.createElement('pre', {
                                className: 'text-left bg-slate-50 rounded-lg p-4 mb-6 text-xs text-red-600 overflow-auto max-h-40'
                            }, this.state.error.toString()),
                            React.createElement('button', {
                                onClick: () => window.location.reload(),
                                className: 'px-6 py-3 bg-[#243186] text-white rounded-lg font-medium hover:bg-[#1a2564] transition-colors'
                            }, 'Seite neu laden')
                        )
                    );
                }
                return this.props.children;
            }
        }

        // ============================================
        // LOGIN VIEW COMPONENT
        // ============================================
        const LoginView = ({ lang, onLoginSuccess }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [fullName, setFullName] = useState(''); // v92: Name f√ºr displayName
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const t = {
                de: {
                    loginTitle: 'Anmelden',
                    registerTitle: 'Registrieren',
                    email: 'E-Mail-Adresse',
                    password: 'Passwort',
                    confirmPassword: 'Passwort best√§tigen',
                    loginBtn: 'Anmelden',
                    registerBtn: 'Registrieren',
                    noAccount: 'Noch kein Konto?',
                    hasAccount: 'Bereits ein Konto?',
                    registerLink: 'Jetzt registrieren',
                    loginLink: 'Jetzt anmelden',
                    teamAccess: 'Team-Zugang',
                    teamDesc: 'Melden Sie sich an, um Ihr Team zu verwalten und Performance Reviews durchzuf√ºhren.',
                    passwordMismatch: 'Passw√∂rter stimmen nicht √ºberein',
                    errorAuth: 'Authentifizierungsfehler. Bitte √ºberpr√ºfen Sie Ihre Eingaben.',
                    errorEmail: 'E-Mail-Adresse bereits registriert',
                    errorWeak: 'Passwort zu schwach (min. 6 Zeichen)',
                    errorInvalid: 'Ung√ºltige E-Mail oder falsches Passwort',
                    fullName: 'Vor- und Nachname',
                    fullNamePlaceholder: 'z.B. Max Mustermann',
                    nameRequired: 'Bitte geben Sie Ihren vollst√§ndigen Namen ein'
                },
                it: {
                    loginTitle: 'Accedi',
                    registerTitle: 'Registrati',
                    email: 'Indirizzo email',
                    password: 'Password',
                    confirmPassword: 'Conferma password',
                    loginBtn: 'Accedi',
                    registerBtn: 'Registrati',
                    noAccount: 'Non hai un account?',
                    hasAccount: 'Hai gi√† un account?',
                    registerLink: 'Registrati ora',
                    loginLink: 'Accedi ora',
                    teamAccess: 'Accesso Team',
                    teamDesc: 'Accedi per gestire il tuo team e condurre Performance Reviews.',
                    passwordMismatch: 'Le password non corrispondono',
                    errorAuth: 'Errore di autenticazione. Verifica i tuoi dati.',
                    errorEmail: 'Email gi√† registrata',
                    errorWeak: 'Password troppo debole (min. 6 caratteri)',
                    errorInvalid: 'Email non valida o password errata',
                    fullName: 'Nome e cognome',
                    fullNamePlaceholder: 'es. Mario Rossi',
                    nameRequired: 'Inserisci il tuo nome completo'
                },
                en: {
                    loginTitle: 'Sign In',
                    registerTitle: 'Register',
                    email: 'Email Address',
                    password: 'Password',
                    confirmPassword: 'Confirm Password',
                    loginBtn: 'Sign In',
                    registerBtn: 'Register',
                    noAccount: 'No account yet?',
                    hasAccount: 'Already have an account?',
                    registerLink: 'Register now',
                    loginLink: 'Sign in now',
                    teamAccess: 'Team Access',
                    teamDesc: 'Sign in to manage your team and conduct Performance Reviews.',
                    passwordMismatch: 'Passwords do not match',
                    errorAuth: 'Authentication error. Please check your inputs.',
                    errorEmail: 'Email address already registered',
                    errorWeak: 'Password too weak (min. 6 characters)',
                    errorInvalid: 'Invalid email or wrong password',
                    fullName: 'Full Name',
                    fullNamePlaceholder: 'e.g. John Smith',
                    nameRequired: 'Please enter your full name'
                }
            };

            const txt = t[lang] || t.de;

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                if (!isLogin && password !== confirmPassword) {
                    setError(txt.passwordMismatch);
                    setLoading(false);
                    return;
                }

                // v92: Name-Validierung bei Registrierung
                if (!isLogin && !fullName.trim()) {
                    setError(txt.nameRequired);
                    setLoading(false);
                    return;
                }

                try {
                    if (isLogin) {
                        const userCredential = await auth.signInWithEmailAndPassword(email, password);
                        // NEU: Stelle sicher, dass der Benutzer in registeredUsers existiert
                        if (userCredential.user && window.db) {
                            try {
                                const doc = await window.db.collection('registeredUsers').doc(userCredential.user.uid).get();
                                if (!doc.exists) {
                                    await window.db.collection('registeredUsers').doc(userCredential.user.uid).set({
                                        email: email.toLowerCase(),
                                        createdAt: new Date().toISOString(),
                                        uid: userCredential.user.uid
                                    });
                                    devLog('‚úÖ Bestehender Benutzer in registeredUsers nachgetragen');
                                }
                                // v92: displayName nachtr√§glich setzen falls fehlend
                                if (!userCredential.user.displayName && doc.exists && doc.data().fullName) {
                                    await userCredential.user.updateProfile({ displayName: doc.data().fullName });
                                    devLog('‚úÖ displayName aus registeredUsers gesetzt:', doc.data().fullName);
                                } else if (!userCredential.user.displayName) {
                                    // v92: Wenn auch in registeredUsers kein Name ‚Üí Prompt anzeigen
                                    const promptMsg = lang === 'de' ? 'Bitte geben Sie Ihren vollst√§ndigen Namen ein (Vor- und Nachname):' 
                                                    : lang === 'it' ? 'Inserisci il tuo nome completo (nome e cognome):' 
                                                    : 'Please enter your full name (first and last name):';
                                    const enteredName = prompt(promptMsg);
                                    if (enteredName && enteredName.trim()) {
                                        await userCredential.user.updateProfile({ displayName: enteredName.trim() });
                                        // Auch in registeredUsers speichern
                                        await window.db.collection('registeredUsers').doc(userCredential.user.uid).update({
                                            fullName: enteredName.trim(),
                                            fullNameUpdatedAt: new Date().toISOString()
                                        });
                                        devLog('‚úÖ displayName nachtr√§glich gesetzt:', enteredName.trim());
                                    }
                                }
                            } catch (dbErr) {
                                console.error('Fehler beim Nachtragen in registeredUsers:', dbErr);
                            }
                        }
                    } else {
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        // v92: displayName sofort setzen
                        if (userCredential.user && fullName.trim()) {
                            await userCredential.user.updateProfile({ displayName: fullName.trim() });
                            devLog('‚úÖ displayName gesetzt:', fullName.trim());
                        }
                        // NEU: Speichere registrierten Benutzer in Firestore f√ºr sp√§tere Abfragen
                        if (userCredential.user && window.db) {
                            try {
                                await window.db.collection('registeredUsers').doc(userCredential.user.uid).set({
                                    email: email.toLowerCase(),
                                    fullName: fullName.trim(), // v92: Name mitspeichern
                                    createdAt: new Date().toISOString(),
                                    uid: userCredential.user.uid
                                });
                                devLog('‚úÖ Benutzer in registeredUsers gespeichert');
                            } catch (dbErr) {
                                console.error('Fehler beim Speichern in registeredUsers:', dbErr);
                            }
                        }
                    }
                    if (onLoginSuccess) onLoginSuccess();
                } catch (err) {
                    console.error('Auth error:', err);
                    if (err.code === 'auth/email-already-in-use') {
                        setError(txt.errorEmail);
                    } else if (err.code === 'auth/weak-password') {
                        setError(txt.errorWeak);
                    } else if (err.code === 'auth/invalid-credential' || err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found') {
                        setError(txt.errorInvalid);
                    } else {
                        setError(txt.errorAuth);
                    }
                }
                setLoading(false);
            };

            return React.createElement('div', { className: 'min-h-[60vh] flex items-center justify-center' },
                React.createElement('div', { className: 'bg-white p-8 rounded-2xl shadow-xl border border-slate-200 w-full max-w-md' },
                    // Header
                    React.createElement('div', { className: 'text-center mb-8' },
                        React.createElement('div', { className: 'w-16 h-16 bg-[#243186] rounded-full flex items-center justify-center mx-auto mb-4' },
                            React.createElement(Users, { size: 32, className: 'text-white' })
                        ),
                        React.createElement('h2', { className: 'text-2xl font-bold', style: { color: '#243186' } },
                            txt.teamAccess
                        ),
                        React.createElement('p', { className: 'text-slate-500 mt-2 text-sm' },
                            txt.teamDesc
                        )
                    ),

                    // Tabs
                    React.createElement('div', { className: 'flex bg-slate-100 rounded-lg p-1 mb-6' },
                        React.createElement('button', {
                            onClick: () => { setIsLogin(true); setError(''); },
                            className: `flex-1 py-2.5 rounded-md text-sm font-medium transition-all ${isLogin ? 'bg-[#6EBD84] text-white shadow' : 'text-slate-600 hover:text-slate-900'}`
                        }, txt.loginTitle),
                        React.createElement('button', {
                            onClick: () => { setIsLogin(false); setError(''); },
                            className: `flex-1 py-2.5 rounded-md text-sm font-medium transition-all ${!isLogin ? 'bg-[#6EBD84] text-white shadow' : 'text-slate-600 hover:text-slate-900'}`
                        }, txt.registerTitle)
                    ),

                    // Error Message
                    error && React.createElement('div', { className: 'bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm' },
                        error
                    ),

                    // Form
                    React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
                        // Email
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, txt.email),
                            React.createElement('div', { className: 'relative' },
                                React.createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' },
                                    React.createElement(Mail, { size: 18, className: 'text-slate-400' })
                                ),
                                React.createElement('input', {
                                    type: 'email',
                                    value: email,
                                    onChange: (e) => setEmail(e.target.value),
                                    required: true,
                                    className: 'w-full pl-10 pr-4 py-2.5 bg-slate-100 border-transparent rounded-2xl focus:bg-white focus:ring-2 focus:ring-[#243186]/20 focus:border-transparent outline-none transition-all',
                                    placeholder: 'name@firma.de'
                                })
                            )
                        ),

                        // v92: Full Name (nur bei Registrierung)
                        !isLogin && React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, txt.fullName),
                            React.createElement('div', { className: 'relative' },
                                React.createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' },
                                    React.createElement(Users, { size: 18, className: 'text-slate-400' })
                                ),
                                React.createElement('input', {
                                    type: 'text',
                                    value: fullName,
                                    onChange: (e) => setFullName(e.target.value),
                                    required: !isLogin,
                                    className: 'w-full pl-10 pr-4 py-2.5 bg-slate-100 border-transparent rounded-2xl focus:bg-white focus:ring-2 focus:ring-[#243186]/20 focus:border-transparent outline-none transition-all',
                                    placeholder: txt.fullNamePlaceholder
                                })
                            )
                        ),

                        // Password
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, txt.password),
                            React.createElement('div', { className: 'relative' },
                                React.createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' },
                                    React.createElement(Lock, { size: 18, className: 'text-slate-400' })
                                ),
                                React.createElement('input', {
                                    type: 'password',
                                    value: password,
                                    onChange: (e) => setPassword(e.target.value),
                                    required: true,
                                    minLength: 6,
                                    className: 'w-full pl-10 pr-4 py-2.5 bg-slate-100 border-transparent rounded-2xl focus:bg-white focus:ring-2 focus:ring-[#243186]/20 focus:border-transparent outline-none transition-all',
                                    placeholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'
                                })
                            )
                        ),

                        // Confirm Password (nur bei Registrierung)
                        !isLogin && React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, txt.confirmPassword),
                            React.createElement('div', { className: 'relative' },
                                React.createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' },
                                    React.createElement(Lock, { size: 18, className: 'text-slate-400' })
                                ),
                                React.createElement('input', {
                                    type: 'password',
                                    value: confirmPassword,
                                    onChange: (e) => setConfirmPassword(e.target.value),
                                    required: true,
                                    minLength: 6,
                                    className: 'w-full pl-10 pr-4 py-2.5 bg-slate-100 border-transparent rounded-2xl focus:bg-white focus:ring-2 focus:ring-[#243186]/20 focus:border-transparent outline-none transition-all',
                                    placeholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'
                                })
                            )
                        ),

                        // Submit Button
                        React.createElement('button', {
                            type: 'submit',
                            disabled: loading,
                            className: 'w-full bg-[#243186] text-white py-3 rounded-2xl font-semibold hover:bg-[#1a2460] transition-colors flex items-center justify-center gap-2 disabled:opacity-50'
                        },
                            loading ? React.createElement(Loader2, { size: 20, className: 'animate-spin' }) : null,
                            isLogin ? txt.loginBtn : txt.registerBtn
                        )
                    )
                )
            );
        };

        const { createElement: e } = React;

        // === PDF SANITIZING HELPER ===
        // Entfernt alle no-print Elemente aus einem DOM-Container vor dem PDF-Export
        const sanitizePdfContainer = (container) => {
          if (!container) return;
          
          // Entferne alle Elemente mit no-print Klasse
          const noPrintElements = container.querySelectorAll('.no-print, [data-no-print="true"]');
          noPrintElements.forEach(el => {
            el.style.display = 'none';
            el.style.visibility = 'hidden';
            el.style.height = '0';
            el.style.width = '0';
            el.style.overflow = 'hidden';
            el.style.position = 'absolute';
            el.style.left = '-9999px';
          });
          
          // Entferne leere Container die durch das Ausblenden entstanden sind
          const emptyContainers = container.querySelectorAll('div:empty');
          emptyContainers.forEach(el => {
            if (!el.textContent.trim() && el.children.length === 0) {
              el.style.display = 'none';
            }
          });
          
          // === KRITISCH: Entferne leere Text-Nodes um Range-Error zu verhindern ===
          // Dies behebt: "Failed to execute 'setEnd' on 'Range': The offset X is larger than the node's length"
          const removeEmptyTextNodes = (node) => {
            const walker = document.createTreeWalker(
              node,
              NodeFilter.SHOW_TEXT,
              null,
              false
            );
            const emptyNodes = [];
            let textNode;
            while (textNode = walker.nextNode()) {
              // Nur wirklich leere Nodes (nicht nur Whitespace)
              if (textNode.nodeValue === '' || textNode.nodeValue === null) {
                emptyNodes.push(textNode);
              }
            }
            emptyNodes.forEach(n => {
              if (n.parentNode) {
                n.parentNode.removeChild(n);
              }
            });
            return emptyNodes.length;
          };
          
          const removedTextNodes = removeEmptyTextNodes(container);
          
          // Entferne alle interaktiven Elemente komplett
          const interactiveElements = container.querySelectorAll('button, input, textarea, select');
          interactiveElements.forEach(el => {
            el.remove();
          });
          
          devLog(`üßπ PDF Sanitizer: ${noPrintElements.length} no-print, ${removedTextNodes} leere Text-Nodes, ${interactiveElements.length} interaktive Elemente entfernt`);
          return container;
        };

        // === LOCALSTORAGE RESILIENCE HELPER ===
        // Sichere localStorage Operationen mit Try-Catch und Fallback
        const safeLocalStorage = {
          getItem: (key, fallback = null) => {
            try {
              const item = localStorage.getItem(key);
              return item ? JSON.parse(item) : fallback;
            } catch (e) {
              devWarn(`‚ö†Ô∏è localStorage.getItem('${key}') fehlgeschlagen:`, e);
              return fallback;
            }
          },
          setItem: (key, value) => {
            try {
              localStorage.setItem(key, JSON.stringify(value));
              return true;
            } catch (e) {
              devWarn(`‚ö†Ô∏è localStorage.setItem('${key}') fehlgeschlagen:`, e);
              return false;
            }
          },
          removeItem: (key) => {
            try {
              localStorage.removeItem(key);
              return true;
            } catch (e) {
              devWarn(`‚ö†Ô∏è localStorage.removeItem('${key}') fehlgeschlagen:`, e);
              return false;
            }
          }
        };

        // === v92: USER DISPLAY NAME HELPER ===
        // Erzeugt einen lesbaren Anzeigenamen aus Firebase User-Objekt
        // Fallback-Kette: displayName ‚Üí Email formatiert ‚Üí 'Manager'
        const getUserDisplayName = (user) => {
          if (!user) return '';
          // 1. Firebase displayName (gesetzt via updateProfile)
          if (user.displayName) return user.displayName;
          // 2. Email-Adresse formatieren: d.andrisani ‚Üí D. Andrisani
          if (user.email) {
            const localPart = user.email.split('@')[0]; // z.B. "d.andrisani" oder "donato.andrisani"
            return localPart
              .split(/[._-]/) // Trenne an Punkt, Unterstrich, Bindestrich
              .map(part => part.charAt(0).toUpperCase() + part.slice(1).toLowerCase())
              .join(' ');
          }
          return '';
        };

        // === DRAFT AUTO-SAVE HELPER ===
        // Speichert Entw√ºrfe automatisch und stellt sie wieder her
        const DraftManager = {
          DRAFT_PREFIX: 'nw_draft_',
          EXPIRY_HOURS: 24,
          
          saveDraft: (draftId, data) => {
            const draftKey = DraftManager.DRAFT_PREFIX + draftId;
            const draftData = {
              ...data,
              savedAt: Date.now()
            };
            const success = safeLocalStorage.setItem(draftKey, draftData);
            if (success) {
              devLog(`üíæ Entwurf gespeichert`);
            }
            return success;
          },
          
          loadDraft: (draftId) => {
            const draftKey = DraftManager.DRAFT_PREFIX + draftId;
            const draft = safeLocalStorage.getItem(draftKey, null);
            
            if (!draft) return null;
            
            // Pr√ºfe ob Entwurf noch g√ºltig ist (< 24h)
            const ageHours = (Date.now() - draft.savedAt) / (1000 * 60 * 60);
            if (ageHours > DraftManager.EXPIRY_HOURS) {
              devLog(`üóëÔ∏è Veralteter Entwurf gel√∂scht`);
              safeLocalStorage.removeItem(draftKey);
              return null;
            }
            
            devLog(`üìÇ Entwurf geladen`);
            return draft;
          },
          
          deleteDraft: (draftId) => {
            const draftKey = DraftManager.DRAFT_PREFIX + draftId;
            safeLocalStorage.removeItem(draftKey);
            devLog(`üóëÔ∏è Entwurf gel√∂scht`);
          },
          
          // Formatiere Zeitstempel f√ºr Anzeige
          formatSavedTime: (timestamp, lang) => {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMinutes = Math.round((now - date) / (1000 * 60));
            
            if (diffMinutes < 1) {
              return lang === 'de' ? 'gerade eben' : lang === 'it' ? 'proprio ora' : 'just now';
            }
            if (diffMinutes < 60) {
              return lang === 'de' ? `vor ${diffMinutes} Min.` : lang === 'it' ? `${diffMinutes} min fa` : `${diffMinutes} min ago`;
            }
            const diffHours = Math.round(diffMinutes / 60);
            if (diffHours < 24) {
              return lang === 'de' ? `vor ${diffHours} Std.` : lang === 'it' ? `${diffHours} ore fa` : `${diffHours}h ago`;
            }
            return date.toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB');
          }
        };
        
        // ============================================
        // TOAST NOTIFICATION UTILITY
        // ============================================
        const showToast = (message, type = 'success') => {
          const colors = {
            success: 'linear-gradient(135deg, #059669, #10b981)',
            error: 'linear-gradient(135deg, #dc2626, #ef4444)',
            warning: 'linear-gradient(135deg, #d97706, #f59e0b)',
            info: 'linear-gradient(135deg, #2563eb, #3b82f6)'
          };
          const icons = { success: '‚úì', error: '‚úó', warning: '‚ö†', info: '‚Ñπ' };
          
          const toast = document.createElement('div');
          toast.textContent = (icons[type] || '') + ' ' + message; // v92: textContent statt innerHTML (XSS-sicher)
          toast.style.cssText = `
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: ${colors[type] || colors.success};
            color: white;
            padding: 16px 32px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 99999;
            animation: slideUp 0.3s ease-out;
            max-width: 90vw;
            text-align: center;
          `;
          document.body.appendChild(toast);
          
          setTimeout(() => {
            toast.style.transition = 'opacity 0.3s, transform 0.3s';
            toast.style.opacity = '0';
            toast.style.transform = 'translateX(-50%) translateY(20px)';
            setTimeout(() => toast.remove(), 300);
          }, 2500);
        };

        // === GPS CONFIDENCE CALCULATOR ===
        // Berechnet die Konfidenz der GPS-Bewertung basierend auf Vollst√§ndigkeit
        const calculateGPSConfidence = (goals, coreList, leadList, isManager) => {
          const validGoals = goals.filter(g => g.weight > 0 && g.name?.trim());
          const validCore = coreList.filter(c => c.name?.trim() && c.rating > 0);
          const validLead = leadList.filter(l => l.name?.trim() && l.rating > 0);
          
          const totalGoalWeight = validGoals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
          const hasCompleteGoals = totalGoalWeight >= 95 && totalGoalWeight <= 105;
          const hasAllCore = validCore.length >= 5;
          const hasAllLead = !isManager || validLead.length >= 5;
          
          // Berechne Konfidenz-Score (0-100)
          let confidenceScore = 0;
          
          // Ziele (max 40 Punkte)
          if (hasCompleteGoals) confidenceScore += 40;
          else if (totalGoalWeight > 0) confidenceScore += Math.min(30, totalGoalWeight * 0.3);
          
          // Core Kompetenzen (max 40 Punkte, oder 60 wenn kein Manager)
          const coreMax = isManager ? 40 : 60;
          confidenceScore += Math.min(coreMax, validCore.length * (coreMax / 5));
          
          // Leadership Kompetenzen (max 20 Punkte, nur f√ºr Manager)
          if (isManager) {
            confidenceScore += Math.min(20, validLead.length * 4);
          }
          
          // Bestimme Level
          if (confidenceScore >= 90) {
            return { 
              level: 'high', 
              score: confidenceScore,
              color: 'text-green-600',
              bgColor: 'bg-green-100',
              icon: '‚úì',
              label: { de: 'Vollst√§ndig', it: 'Completo', en: 'Complete' }
            };
          }
          if (confidenceScore >= 60) {
            return { 
              level: 'medium', 
              score: confidenceScore,
              color: 'text-amber-600',
              bgColor: 'bg-amber-100',
              icon: '‚ö†',
              label: { de: 'Teilweise', it: 'Parziale', en: 'Partial' }
            };
          }
          return { 
            level: 'low', 
            score: confidenceScore,
            color: 'text-red-600',
            bgColor: 'bg-red-100',
            icon: '‚ùå',
            label: { de: 'Unvollst√§ndig', it: 'Incompleto', en: 'Incomplete' }
          };
        };

        // === SELF-ASSESSMENT DUPLICATE CHECKER ===
        // Pr√ºft ob bereits eine Selbstreflexion f√ºr einen Mitarbeiter/Periode existiert
        const checkExistingSelfAssessment = async (db, employeeId, period) => {
          if (!db || !employeeId) return { exists: false, data: null };
          
          try {
            // Suche nach allen Self-Typen (Firestore erlaubt kein OR in where)
            const snapshot = await db.collection('teamAppraisals')
              .where('employeeId', '==', employeeId)
              .where('period', '==', period)
              .get();
            
            // Filtere nach Self-Typen
            const selfDocs = snapshot.docs.filter(doc => {
              const type = doc.data().type;
              return type === 'self' || type === 'self_assessment' || type === 'self-reflection' || type === 'self_assessment_standalone';
            });
            
            if (selfDocs.length > 0) {
              const existing = selfDocs[0].data();
              return { 
                exists: true, 
                data: existing,
                docId: selfDocs[0].id
              };
            }
            return { exists: false, data: null };
          } catch (error) {
            console.error('‚ùå Fehler beim Pr√ºfen auf existierende Selbstreflexion:', error);
            return { exists: false, data: null, error: error };
          }
        };

        // === MULTILINGUAL TEXT HELPER ===
        // Verwendung: getText(lang, 'German text', 'Italian text', 'English text')
        const getText = (lang, de, it, en) => {
          if (lang === 'en') return en || de;
          if (lang === 'it') return it || de;
          return de;
        };

        // === GPS SIMULATOR CONSTANTS ===
        const BARS_RANGES = [
          { min: 131, score: 5, label: "Herausragend (>130%)" },
          { min: 111, max: 130, score: 4, label: "√úbertroffen (111-130%)" },
          { min: 90, max: 110, score: 3, label: "Baseline (90-110%)" },
          { min: 70, max: 89, score: 2, label: "Teilweise (70-89%)" },
          { min: 0, max: 69, score: 1, label: "Nicht erreicht (<70%)" },
        ];

        const RATINGS = [
          { min: 4.51, max: 5.00, label: "Outstanding (5)", color: "bg-green-600", desc: "Top Bonus / Gehaltssprung" },
          { min: 3.51, max: 4.50, label: "Exceeds Expectations (4)", color: "bg-emerald-500", desc: "Basis-Bonus / Gehaltserh√∂hung" },
          { min: 2.51, max: 3.50, label: "Meets Expectations (3)", color: "bg-blue-600", desc: "Standard-Runde / Kein Bonus" },
          { min: 1.51, max: 2.50, label: "Needs Improvement (2)", color: "bg-orange-500", desc: "Enge F√ºhrung / PIP" },
          { min: 0.00, max: 1.50, label: "Does Not Meet (1)", color: "bg-red-600", desc: "Sofortige Eskalation" },
        ];

        const getBarsScore = (percentage) => {
          const range = BARS_RANGES.find(r => percentage >= r.min && (r.max === undefined || percentage <= r.max));
          return range ? range.score : 1;
        };

        const getRating = (score) => {
          return RATINGS.find(r => score >= r.min && score <= r.max) || RATINGS[RATINGS.length - 1];
        };


        // --- UI TEXT (German and Italian) ---
        const UI_TEXT = {
            de: {
                title: "Performance Manager",
                welcome: "Willkommen",
                intro: "Dies ist Ihr interaktiver Guide f√ºr das ",
                introBold: "Niederwieser Performance Review",
                introEnd: ". Hier finden Sie alle Verhaltensanker, Definitionen und Beispiele, um Leistungen objektiv einzusch√§tzen.",
                strategyTitle: "Strategie & Vision",
                strategySubtitle: "Die Transformation im Fokus",
                strategyDesc: "Unsere Kernwerte Fast, Fair & Personal sind der Kompass zur Strategie 2035. Mit dem Performance Review schaffen wir die Transparenz, individuelle Ergebnisse (WAS) und Kompetenzen (WIE) objektiv zu bewerten, um alle Anstrengungen auf das gemeinsame Ziel zu b√ºndeln: die Entwicklung zum ",
                strategyBold: "Smartest Solution Provider",
                strategyEnd: ".",
                barsTitle: "Wie funktioniert BARS?",
                barsDesc: "Behaviorally Anchored Rating Scales: Wir bewerten Verhalten, nicht Pers√∂nlichkeit. Nutzen Sie den Guide, um den Unterschied zwischen \"Standard\" (3) und \"Role Model\" (5) zu verstehen.",
                btnCompetencies: "Kompetenzen ansehen",
                coreComp: "Kern-Kompetenzen (F√ºr Alle)",
                leadComp: "Leadership-Kompetenzen (F√ºhrungskr√§fte)",
                back: "‚Üê Zur√ºck zur √úbersicht",
                selectScore: "W√§hlen Sie einen Score",
                example: "Praktisches Beispiel",
                dashboard: "Dashboard",
                competencies: "Kompetenzen",
                simulator: "GPS Simulator",
                gpsExplainer: "GPS Formel",
                formular: "Beurteilungsformular",
                zielvereinbarung: "Zielvereinbarung",
                level1: "Erf√ºllt nicht",
                level2: "Verbesserungsbedarf",
                level3: "Baseline (Standard)",
                level4: "√úbertrifft Erwartungen",
                level5: "Herausragend / Role Model",
                // GPS Simulator Texte
                gpsSimTitle: "GPS Simulator: Berechnung testen",
                gpsSimDesc: "Testen Sie die Formel, indem Sie WAS (Ziele) und WIE (Kompetenzen) bewerten.",
                wasSection: "WAS: Ziele erreichen",
                wasPercent: "50% der GPS",
                wasScoreLabel: "WAS Score",
                goalName: "Ziel",
                goalWeight: "Gewicht (%)",
                goalAchievement: "Erreichung (%)",
                addGoal: "Ziel hinzuf√ºgen",
                removeGoal: "Entfernen",
                competencyWeight: "Gewicht",
                totalWeight: "Gesamtgewicht",
                shouldBe100: "sollte 100% sein",
                wieCore: "WIE: Kern-Kompetenzen",
                wieLeadership: "WIE: Leadership-Kompetenzen",
                score: "Score",
                addLeadership: "Leadership-Kompetenzen hinzuf√ºgen",
                leadershipActive: "Aktiviert (F√ºhrungskraft)",
                leadershipOptional: "Optional",
                globalPerformanceScore: "Global Performance Score",
                theMath: "The Math: Berechnung",
                wasGoals: "WAS (Ziele)",
                wieCompetencies: "WIE (Kompetenzen)",
                wieCore2: "WIE (Kern)",
                wieLeader: "WIE (Lead)",
                gpsTotal: "GPS TOTAL",
                resetSimulator: "Simulator zur√ºcksetzen",
                // GPS Erkl√§rungsseite
                gpsExplainerTitle: "Der Global Performance Score (GPS)",
                gpsExplainerSubtitle: "So funktioniert unsere Performance-Bewertung",
                gpsIntroTitle: "Unser ausgewogener Ansatz",
                gpsIntroText: "Der Annual Performance Review basiert auf einem ausgewogenen Ansatz. Wir bewerten nicht nur WAS erreicht wurde, sondern auch WIE es erreicht wurde. Diese Kombination nennen wir Global Performance Score und stellt sicher, dass nicht nur Ergebnisse z√§hlen, sondern auch die Art und Weise, wie diese Ergebnisse erreicht werden.",
                gpsFormulaTitle: "Die GPS-Formel",
                gpsFormulaExplain: "Der GPS setzt sich aus drei Dimensionen zusammen:",
                wasExplainTitle: "WAS: Messbare Ergebnisse",
                wasExplainWeight: "50% Gewichtung",
                wasExplainText: "Misst die Zielerreichung. Die Messung erfolgt objektiv √ºber eine Umrechnungstabelle (%).",
                wasExplainExample: "Beispiel: \"Umsatzziel: 500.000 ‚Ç¨ geplant, 550.000 ‚Ç¨ erreicht = 110%\"",
                wieExplainTitle: "WIE: Verhalten & Kompetenzen",
                wieCoreExplainWeight: "25% Gewichtung (Kern-Kompetenzen)",
                wieLeadExplainWeight: "25% Gewichtung (Leadership-Kompetenzen)",
                wieExplainText: "Misst die Kompetenzen anhand von Verhaltensankern (BARS). Dies sichert die Einhaltung unserer Werte.",
                wieExplainCompetencies: "Kern-Kompetenzen: Fachkompetenz & Anwendung ‚Ä¢ Kommunikation & Zusammenarbeit ‚Ä¢ Probleml√∂sekompetenz ‚Ä¢ Anpassungsf√§higkeit ‚Ä¢ Selbstorganisation | Leadership-Kompetenzen: Mitarbeiterf√ºhrung & -entwicklung ‚Ä¢ Strategisches Denken ‚Ä¢ Entscheidungsf√§higkeit ‚Ä¢ Execution & Performance Management ‚Ä¢ Stakeholder-Management",
                barsConversionTitle: "Umrechnung: Zielerreichung % ‚Üí BARS-Stufe",
                barsConversionDesc: "Die Zielerreichung in Prozent wird in BARS-Stufen (1-5) umgerechnet:",
                performanceRatingTitle: "Performance-Rating (basierend auf GPS)",
                performanceRatingDesc: "Der finale GPS-Wert bestimmt das Performance-Rating:",
                calculationExampleTitle: "Berechnungsbeispiel",
                calculationExampleIntro: "Annahmen:",
                calculationStep1: "WAS (Zielerreichung): 4,0",
                calculationStep2: "WIE (Kern-Kompetenzen): 3,2",
                calculationStep3: "WIE (Leadership-Kompetenzen): 4,0",
                calculationFormula: "Berechnung:",
                calculationResult: "Ergebnis: GPS = 3,8 ‚Üí Exceeds Expectations (4)",
                whyGPSTitle: "Warum GPS?",
                whyGPS1Title: "Fairness & Objektivit√§t",
                whyGPS1Text: "BARS-Methodik reduziert subjektive Bewertungen durch konkrete Verhaltensanker",
                whyGPS2Title: "Strategische Ausrichtung",
                whyGPS2Text: "Verhalten wird an unseren Werten \"Schnell ‚Ä¢ Fair ‚Ä¢ Pers√∂nlich\" gemessen",
                whyGPS3Title: "Entwicklungsorientiert",
                whyGPS3Text: "Klare Verhaltensbeispiele zeigen den Weg zur n√§chsten Stufe auf",
                // Performance Kompass
                performanceCompassTitle: "Ihr Performance Kompass",
                performanceCompassSubtitle: "Der Global Performance Score (GPS) stellt sicher, dass wir Ihren Erfolg ganzheitlich messen: Wir bewerten nicht nur WAS erreicht wurde, sondern auch WIE es im Einklang mit unseren Werten umgesetzt wurde.",
                wasBoxTitle: "50% WAS",
                wasBoxSubtitle: "Ziele & Ergebnisse (KPIs)",
                wieBoxTitle: "50% WIE",
                wieBoxSubtitle: "Verhalten & Kompetenzen (BARS)",
                wieBoxSubtitleManager: "25% Kern-Kompetenzen + 25% Leadership",
                wieBoxSubtitleEmployee: "Kern-Kompetenzen (BARS)",
                managerNote: "* F√ºr F√ºhrungskr√§fte: Das WIE splittet sich in 25% Kern-Kompetenzen und 25% Leadership-Kompetenzen.",
                fairnessGuarantee: "FAIRNESS-GARANTIE: KALIBRIERTE BEWERTUNG",
                barsRanges: {
                    outstanding: "Herausragend (>130%)",
                    exceeded: "√úbertroffen (111-130%)",
                    baseline: "Baseline (90-110%)",
                    partial: "Teilweise (70-89%)",
                    notReached: "Nicht erreicht (<70%)"
                },
                ratings: {
                    outstanding: "Top Bonus / Gehaltssprung",
                    exceeds: "Basis-Bonus / Gehaltserh√∂hung",
                    meets: "Standard-Runde / Kein Bonus",
                    needs: "Enge F√ºhrung / PIP",
                    doesNot: "Sofortige Eskalation"
                }
            },
            it: {
                title: "Performance Manager",
                welcome: "Benvenuto",
                intro: "Questa √® la tua guida interattiva per il ",
                introBold: "Niederwieser Performance Review",
                introEnd: ". Qui troverai tutti gli ancoraggi comportamentali, definizioni ed esempi per valutare le prestazioni in modo oggettivo.",
                strategyTitle: "Strategia & Visione",
                strategySubtitle: "Focus sulla trasformazione",
                strategyDesc: "I nostri valori fondamentali Fast, Fair & Personal sono la bussola verso la Strategia 2035. Con il Performance Review creiamo la trasparenza per valutare oggettivamente risultati individuali (COSA) e competenze (COME), concentrando tutti gli sforzi sull'obiettivo comune: lo sviluppo verso ",
                strategyBold: "Smartest Solution Provider",
                strategyEnd: ".",
                barsTitle: "Come funziona BARS?",
                barsDesc: "Behaviorally Anchored Rating Scales: Valutiamo il comportamento, non la personalit√†. Usa la guida per capire la differenza tra \"Standard\" (3) e \"Role Model\" (5).",
                btnCompetencies: "Vedi Competenze",
                coreComp: "Competenze Chiave (Per Tutti)",
                leadComp: "Competenze di Leadership (Manager)",
                back: "‚Üê Torna alla panoramica",
                selectScore: "Seleziona un punteggio",
                example: "Esempio pratico",
                dashboard: "Dashboard",
                competencies: "Competenze",
                simulator: "Simulatore GPS",
                gpsExplainer: "Formula GPS",
                formular: "Modulo di valutazione",
                zielvereinbarung: "Accordo sugli obiettivi",
                level1: "Non soddisfa",
                level2: "Richiede miglioramento",
                level3: "Baseline (Standard)",
                level4: "Supera le aspettative",
                level5: "Eccellente / Role Model",
                // GPS Simulator Texte
                gpsSimTitle: "Simulatore GPS: Testare il calcolo",
                gpsSimDesc: "Testa la formula valutando COSA (Obiettivi) e COME (Competenze).",
                wasSection: "COSA: Raggiungere obiettivi",
                wasPercent: "50% del GPS",
                wasScoreLabel: "COSA Score",
                goalName: "Obiettivo",
                goalWeight: "Peso (%)",
                goalAchievement: "Raggiungimento (%)",
                addGoal: "Aggiungi obiettivo",
                removeGoal: "Rimuovi",
                competencyWeight: "Peso",
                totalWeight: "Peso totale",
                shouldBe100: "dovrebbe essere 100%",
                wieCore: "COME: Competenze Chiave",
                wieLeadership: "COME: Competenze di Leadership",
                score: "Punteggio",
                addLeadership: "Aggiungi Competenze di Leadership",
                leadershipActive: "Attivato (Manager)",
                leadershipOptional: "Opzionale",
                globalPerformanceScore: "Global Performance Score",
                theMath: "Il Calcolo: Formula",
                wasGoals: "COSA (Obiettivi)",
                wieCompetencies: "COME (Competenze)",
                wieCore2: "COME (Chiave)",
                wieLeader: "COME (Lead)",
                gpsTotal: "GPS TOTALE",
                resetSimulator: "Resetta simulatore",
                // GPS Erkl√§rungsseite
                gpsExplainerTitle: "Il Global Performance Score (GPS)",
                gpsExplainerSubtitle: "Come funziona la nostra valutazione delle prestazioni",
                gpsIntroTitle: "Il nostro approccio equilibrato",
                gpsIntroText: "L'Annual Performance Review si basa su un approccio equilibrato. Valutiamo non solo COSA √® stato raggiunto, ma anche COME √® stato raggiunto. Questa combinazione viene definita Global Performance Score e garantisce che vengano considerati non solo i risultati, ma anche il modo in cui sono stati ottenuti.",
                gpsFormulaTitle: "La Formula GPS",
                gpsFormulaExplain: "Il GPS si compone di tre dimensioni:",
                wasExplainTitle: "COSA: Risultati misurabili",
                wasExplainWeight: "Peso 50%",
                wasExplainText: "Misura il raggiungimento degli obiettivi. La misurazione avviene in modo oggettivo attraverso una tabella di conversione (%).",
                wasExplainExample: "Esempio: \"Obiettivo di fatturato: 500.000 ‚Ç¨ pianificati, 550.000 ‚Ç¨ raggiunti = 110%\"",
                wieExplainTitle: "COME: Comportamento & Competenze",
                wieCoreExplainWeight: "Peso 25% (Competenze Chiave)",
                wieLeadExplainWeight: "Peso 25% (Competenze di Leadership)",
                wieExplainText: "Misura le competenze sulla base di ancoraggi comportamentali (BARS). Ci√≤ garantisce il rispetto dei nostri valori.",
                wieExplainCompetencies: "Competenze Chiave: Competenza tecnica & Applicazione ‚Ä¢ Comunicazione & Collaborazione ‚Ä¢ Capacit√† di problem solving ‚Ä¢ Adattabilit√† ‚Ä¢ Autogestione | Competenze di Leadership: Gestione & Sviluppo del personale ‚Ä¢ Pensiero strategico ‚Ä¢ Capacit√† decisionale ‚Ä¢ Execution & Performance Management ‚Ä¢ Gestione degli stakeholder",
                barsConversionTitle: "Conversione: Raggiungimento % ‚Üí Livello BARS",
                barsConversionDesc: "La percentuale di raggiungimento viene convertita in livelli BARS (1-5):",
                performanceRatingTitle: "Valutazione delle Prestazioni (basata su GPS)",
                performanceRatingDesc: "Il valore GPS finale determina la valutazione delle prestazioni:",
                calculationExampleTitle: "Esempio di calcolo",
                calculationExampleIntro: "Ipotesi:",
                calculationStep1: "COSA (Raggiungimento obiettivi): 4,0",
                calculationStep2: "COME (Competenze Chiave): 3,2",
                calculationStep3: "COME (Competenze di Leadership): 4,0",
                calculationFormula: "Calcolo:",
                calculationResult: "Risultato: GPS = 3,8 ‚Üí Supera le Aspettative (4)",
                whyGPSTitle: "Perch√© GPS?",
                whyGPS1Title: "Equit√† & Oggettivit√†",
                whyGPS1Text: "La metodologia BARS riduce le valutazioni soggettive grazie ad ancoraggi comportamentali concreti",
                whyGPS2Title: "Allineamento Strategico",
                whyGPS2Text: "Il comportamento viene misurato in base ai nostri valori \"Veloce ‚Ä¢ Equo ‚Ä¢ Personale\"",
                whyGPS3Title: "Orientato allo Sviluppo",
                whyGPS3Text: "Esempi comportamentali chiari indicano il percorso verso il livello successivo",
                // Performance Kompass
                performanceCompassTitle: "La tua Bussola delle Prestazioni",
                performanceCompassSubtitle: "Il Global Performance Score (GPS) garantisce che misuriamo il vostro successo in modo olistico: valutiamo non solo COSA √® stato raggiunto, ma anche COME √® stato realizzato in linea con i nostri valori.",
                wasBoxTitle: "50% COSA",
                wasBoxSubtitle: "Obiettivi & Risultati (KPI)",
                wieBoxTitle: "50% COME",
                wieBoxSubtitle: "Comportamento & Competenze (BARS)",
                wieBoxSubtitleManager: "25% Competenze Core + 25% Leadership",
                wieBoxSubtitleEmployee: "Competenze Core (BARS)",
                managerNote: "* Per i dirigenti: Il COME si divide in 25% Competenze Core e 25% Competenze di Leadership.",
                fairnessGuarantee: "GARANZIA DI EQUIT√Ä: VALUTAZIONE CALIBRATA",
                barsRanges: {
                    outstanding: "Eccellente (>130%)",
                    exceeded: "Superato (111-130%)",
                    baseline: "Baseline (90-110%)",
                    partial: "Parziale (70-89%)",
                    notReached: "Non raggiunto (<70%)"
                },
                ratings: {
                    outstanding: "Bonus Massimo / Aumento Salariale",
                    exceeds: "Bonus Base / Aumento",
                    meets: "Standard / Nessun Bonus",
                    needs: "Supervisione Stretta / PIP",
                    doesNot: "Escalation Immediata"
                }
            },
            en: {
                title: "Performance Manager",
                welcome: "Welcome",
                intro: "This is your interactive guide for the ",
                introBold: "Niederwieser Performance Review",
                introEnd: ". Here you will find all behavioral anchors, definitions, and examples to objectively assess performance.",
                strategyTitle: "Strategy & Vision",
                strategySubtitle: "Focus on Transformation",
                strategyDesc: "Our core values Fast, Fair & Personal are the compass towards Strategy 2035. With the Performance Review, we create transparency to objectively evaluate individual results (WHAT) and competencies (HOW), focusing all efforts on the common goal: development into the ",
                strategyBold: "Smartest Solution Provider",
                strategyEnd: ".",
                barsTitle: "How does BARS work?",
                barsDesc: "Behaviorally Anchored Rating Scales: We evaluate behavior, not personality. Use the guide to understand the difference between \"Standard\" (3) and \"Role Model\" (5).",
                btnCompetencies: "View Competencies",
                coreComp: "Core Competencies (For Everyone)",
                leadComp: "Leadership Competencies (Managers)",
                back: "‚Üê Back to Overview",
                selectScore: "Select a Score",
                example: "Practical Example",
                dashboard: "Dashboard",
                competencies: "Competencies",
                simulator: "GPS Simulator",
                gpsExplainer: "GPS Formula",
                formular: "Appraisal Form",
                zielvereinbarung: "Goal Agreement",
                level1: "Does Not Meet",
                level2: "Needs Improvement",
                level3: "Baseline (Standard)",
                level4: "Exceeds Expectations",
                level5: "Outstanding / Role Model",
                // GPS Simulator Texts
                gpsSimTitle: "GPS Simulator: Test Calculation",
                gpsSimDesc: "Test the formula by rating WHAT (Goals) and HOW (Competencies).",
                wasSection: "WHAT: Achieve Goals",
                wasPercent: "50% of GPS",
                wasScoreLabel: "WHAT Score",
                goalName: "Goal",
                goalWeight: "Weight (%)",
                goalAchievement: "Achievement (%)",
                addGoal: "Add Goal",
                removeGoal: "Remove",
                competencyWeight: "Weight",
                totalWeight: "Total Weight",
                shouldBe100: "should be 100%",
                wieCore: "HOW: Core Competencies",
                wieLeadership: "HOW: Leadership Competencies",
                score: "Score",
                addLeadership: "Add Leadership Competencies",
                leadershipActive: "Activated (Manager)",
                leadershipOptional: "Optional",
                globalPerformanceScore: "Global Performance Score",
                theMath: "The Math: Calculation",
                wasGoals: "WHAT (Goals)",
                wieCompetencies: "HOW (Competencies)",
                wieCore2: "HOW (Core)",
                wieLeader: "HOW (Lead)",
                gpsTotal: "GPS TOTAL",
                resetSimulator: "Reset Simulator",
                // GPS Explainer Page
                gpsExplainerTitle: "The Global Performance Score (GPS)",
                gpsExplainerSubtitle: "How Our Performance Evaluation Works",
                gpsIntroTitle: "Our Balanced Approach",
                gpsIntroText: "The Annual Performance Review is based on a balanced approach. We evaluate not only WHAT was achieved, but also HOW it was achieved. This combination is called the Global Performance Score and ensures that not only results count, but also the way these results were achieved.",
                gpsFormulaTitle: "The GPS Formula",
                gpsFormulaExplain: "The GPS consists of three dimensions:",
                wasExplainTitle: "WHAT: Measurable Results",
                wasExplainWeight: "50% Weight",
                wasExplainText: "Measures goal achievement. Measurement is objective through a conversion table (%).",
                wasExplainExample: "Example: \"Revenue target: ‚Ç¨500,000 planned, ‚Ç¨550,000 achieved = 110%\"",
                wieExplainTitle: "HOW: Behavior & Competencies",
                wieCoreExplainWeight: "25% Weight (Core Competencies)",
                wieLeadExplainWeight: "25% Weight (Leadership Competencies)",
                wieExplainText: "Measures competencies based on behavioral anchors (BARS). This ensures adherence to our values.",
                wieExplainCompetencies: "Core Competencies: Technical Expertise & Application ‚Ä¢ Communication & Collaboration ‚Ä¢ Problem-Solving Skills ‚Ä¢ Adaptability ‚Ä¢ Self-Organization | Leadership Competencies: Employee Management & Development ‚Ä¢ Strategic Thinking ‚Ä¢ Decision-Making ‚Ä¢ Execution & Performance Management ‚Ä¢ Stakeholder Management",
                barsConversionTitle: "Conversion: Achievement % ‚Üí BARS Level",
                barsConversionDesc: "The achievement percentage is converted to BARS levels (1-5):",
                performanceRatingTitle: "Performance Rating (based on GPS)",
                performanceRatingDesc: "The final GPS value determines the performance rating:",
                calculationExampleTitle: "Calculation Example",
                calculationExampleIntro: "Assumptions:",
                calculationStep1: "WHAT (Goal Achievement): 4.0",
                calculationStep2: "HOW (Core Competencies): 3.2",
                calculationStep3: "HOW (Leadership Competencies): 4.0",
                calculationFormula: "Calculation:",
                calculationResult: "Result: GPS = 3.8 ‚Üí Exceeds Expectations (4)",
                whyGPSTitle: "Why GPS?",
                whyGPS1Title: "Fairness & Objectivity",
                whyGPS1Text: "BARS methodology reduces subjective assessments through concrete behavioral anchors",
                whyGPS2Title: "Strategic Alignment",
                whyGPS2Text: "Behavior is measured against our values \"Fast ‚Ä¢ Fair ‚Ä¢ Personal\"",
                whyGPS3Title: "Development-Oriented",
                whyGPS3Text: "Clear behavioral examples show the path to the next level",
                // Performance Compass
                performanceCompassTitle: "Your Performance Compass",
                performanceCompassSubtitle: "The Global Performance Score (GPS) ensures that we measure your success holistically: We evaluate not only WHAT was achieved, but also HOW it was implemented in line with our values.",
                wasBoxTitle: "50% WHAT",
                wasBoxSubtitle: "Goals & Results (KPIs)",
                wieBoxTitle: "50% HOW",
                wieBoxSubtitle: "Behavior & Competencies (BARS)",
                wieBoxSubtitleManager: "25% Core Competencies + 25% Leadership",
                wieBoxSubtitleEmployee: "Core Competencies (BARS)",
                managerNote: "* For managers: The HOW splits into 25% Core Competencies and 25% Leadership Competencies.",
                fairnessGuarantee: "FAIRNESS GUARANTEE: CALIBRATED ASSESSMENT",
                barsRanges: {
                    outstanding: "Outstanding (>130%)",
                    exceeded: "Exceeded (111-130%)",
                    baseline: "Baseline (90-110%)",
                    partial: "Partial (70-89%)",
                    notReached: "Not Reached (<70%)"
                },
                ratings: {
                    outstanding: "Top Bonus / Salary Jump",
                    exceeds: "Base Bonus / Salary Increase",
                    meets: "Standard Round / No Bonus",
                    needs: "Close Supervision / PIP",
                    doesNot: "Immediate Escalation"
                }
            }
        };

        // --- FORM TEXT FOR APPRAISAL FORM ---
        const FORM_TEXT = {
            de: {
                headerTitle: "Jahresgespr√§ch & Performance Review",
                headerSubtitle: "Annual Performance Review | Strategie 2035",
                partA: "Teil A: Gespr√§chsdaten",
                formType: "Art des Formulars",
                formTypeSelf: "Selbstreflexion (Mitarbeiter:in)",
                formTypeManager: "Beurteilung (F√ºhrungskraft)",
                selfReflectionNote: "‚ö†Ô∏è Bitte sende diese Selbstreflexion mindestens eine Woche vor dem Gespr√§ch an deine F√ºhrungskraft.",
                partB: "Teil B: Zielerreichung (WAS) ‚Äì 50% Gewichtung",
                partC: "Teil C: Kern-Kompetenzen (WIE)",
                compName: "Kompetenz",
                partCLead: "Teil C.2: Leadership-Kompetenzen",
                partC3: "Teil C.3: Global Performance Score (GPS)",
                partD: "Teil D: St√§rken & Entwicklungsplanung",
                partE: "Teil E: Karriereperspektive & Zielvorstellungen",
                partF: "Teil F: Mitarbeiter-Feedback",
                partH: "Teil G: Unterschriften & Einverst√§ndnis",
                employee: "Mitarbeiter:in (Name, Vorname)",
                position: "Stellenbezeichnung / Funktion",
                manager: "F√ºhrungskraft (Name, Vorname)",
                date: "Gespr√§chsdatum",
                period: "Bewertungszeitraum",
                to: "bis",
                hintGPS: "Hinweis: Der GPS wird hier interaktiv berechnet. √úbertragen Sie die finalen Werte aus der Kalibrierung.",
                profile: "Profil / Rolle",
                roleEmp: "Mitarbeitende (50% WAS / 50% Kern-Komp.)",
                roleMgr: "F√ºhrungskraft (50% WAS / 25% Kern / 25% Lead)",
                goalName: "Zielbezeichnung",
                weight: "Gewicht %",
                achievement: "Erreichung %",
                barsLevel: "BARS-Note",
                strengths: "D.1 Identifizierte St√§rken",
                strengthsProfessional: "Fachliche St√§rken (Was gelingt besonders gut?):",
                strengthsPersonal: "Pers√∂nliche St√§rken (Welche Verhaltenskompetenzen zeichnen besonders aus?):",
                development: "D.2 Entwicklungsfelder & Ma√ünahmen",
                devIntro: "Welche Kompetenzen sollen gest√§rkt werden?",
                measure: "Ma√ünahme",
                responsible: "Verantwortlich",
                deadline: "Umsetzung bis",
                careerIntro: "Welche Zielvorstellungen hat der/die Mitarbeiter:in?",
                careerOptions: [
                    "Zufrieden mit aktueller Position",
                    "Strebe Fachkarriere an",
                    "Strebe F√ºhrungskarriere an",
                    "Offen f√ºr Abteilungswechsel",
                    "Offen f√ºr Standortwechsel"
                ],
                comments: "Erl√§uterung:",
                feedbackIntro: "Bitte teile deine Einsch√§tzung zur Zusammenarbeit, den Arbeitsbedingungen und Entwicklungsm√∂glichkeiten mit.",
                feedbackQ1: "1. F√ºhlst du dich ausreichend unterst√ºtzt und gef√∂rdert?",
                feedbackQ2: "2. Welche Verbesserungsvorschl√§ge hast du (Prozesse, Tools, Arbeitsbedingungen)?",
                feedbackQ3: "3. Auf welche gr√∂√üeren Schwierigkeiten bist du dieses Jahr gesto√üen?",
                feedbackQ4: "4. Was war dein gr√∂√üter pers√∂nlicher Erfolgsmoment?",
                feedbackQ5: "5. Wie nimmst du die √Ñnderung der Unternehmensstrategie wahr?",
                feedbackQ6: "6. Welche Projekte w√ºrdest du f√ºr deine Abteilung vorschlagen?",
                feedbackQ7: "7. Wie bewertest du deine Work-Life-Balance? (1=sehr schlecht, 5=sehr gut)",
                signatureNote: "Mit der Unterschrift wird best√§tigt, dass das Gespr√§ch stattgefunden hat.",
                signatureEmp: "Unterschrift Mitarbeiter:in",
                signatureMgr: "Unterschrift F√ºhrungskraft",
                print: "Als PDF herunterladen",
                generating: "Erstelle PDF...",
                calcAuto: "Automatisch berechnet",
                totalWas: "WAS-Score",
                totalWie: "WIE-Score",
                addGoal: "Ziel hinzuf√ºgen",
                addDev: "Ma√ünahme hinzuf√ºgen",
                addComp: "Kompetenz hinzuf√ºgen",
                totalWeight: "Gesamtgewicht",
                shouldBe100: "sollte 100% sein",
                rating: "Rating",
                comment: "Kommentar / Begr√ºndung",
                barsCompetency: {
                    fach: {
                        1: "Erf√ºllt nicht ‚Äì Fehlerhaft, kein fachliches Fundament",
                        2: "Verbesserungsbedarf ‚Äì Standardprozesse okay, bei Abweichungen √ºberfordert",
                        3: "Baseline ‚Äì Souver√§n, selbstst√§ndig, qualitativ hochwertig",
                        4: "√úbertrifft ‚Äì Durchdringt komplexe Zusammenh√§nge, agiert pr√§ventiv",
                        5: "Herausragend ‚Äì Fachliche Autorit√§t, standort√ºbergreifend anerkannt"
                    },
                    komm: {
                        1: "Erf√ºllt nicht ‚Äì Kapselt sich ab, Absicherungs-Mentalit√§t",
                        2: "Verbesserungsbedarf ‚Äì Reaktiv, ineffiziente Kan√§le",
                        3: "Baseline ‚Äì Proaktiv, wertsch√§tzend, teilt Wissen bereitwillig",
                        4: "√úbertrifft ‚Äì Schafft Verst√§ndnis, baut Silos ab, vermittelt bei Konflikten",
                        5: "Herausragend ‚Äì Etabliert neue Standards, Netzwerk des Vertrauens"
                    },
                    prob: {
                        1: "Erf√ºllt nicht ‚Äì Blockiert, wartet passiv auf L√∂sung von au√üen",
                        2: "Verbesserungsbedarf ‚Äì Bearbeitet Symptome, eskaliert zu fr√ºh",
                        3: "Baseline ‚Äì Analysiert strukturiert, findet pragmatische L√∂sungen",
                        4: "√úbertrifft ‚Äì Erkennt Muster, denkt in L√∂sungsalternativen",
                        5: "Herausragend ‚Äì L√∂st strategische Probleme, Vorbild bei Krisen"
                    },
                    adapt: {
                        1: "Erf√ºllt nicht ‚Äì Str√§ubt sich gegen Ver√§nderungen",
                        2: "Verbesserungsbedarf ‚Äì Wenig Eigeninitiative zur Weiterbildung",
                        3: "Baseline ‚Äì Neugierig, reflektiert, passt sich z√ºgig an",
                        4: "√úbertrifft ‚Äì Sucht aktiv Wissen, Katalysator f√ºr Neues",
                        5: "Herausragend ‚Äì Antizipiert Trends, bereitet Organisation vor"
                    },
                    orga: {
                        1: "Erf√ºllt nicht ‚Äì Chaotisch, h√§lt Fristen nicht ein",
                        2: "Verbesserungsbedarf ‚Äì Funktioniert unter F√ºhrung, bei Autonomie unsicher",
                        3: "Baseline ‚Äì Organisiert, priorisiert, h√§lt Commitments ein",
                        4: "√úbertrifft ‚Äì Vorausschauend, optimiert Prozesse, entlastet andere",
                        5: "Herausragend ‚Äì Koordiniert komplexe Vorhaben, setzt Ma√üst√§be"
                    },
                    lead: {
                        1: "Erf√ºllt nicht ‚Äì Kein Commitment zum Team, Mikromanagement",
                        2: "Verbesserungsbedarf ‚Äì F√ºhrt nur 'gef√§llige' Gespr√§che",
                        3: "Baseline ‚Äì Gibt klare Richtung, f√∂rdert individuell, coacht",
                        4: "√úbertrifft ‚Äì Strategisches Teamdesign, entwickelt High Performer",
                        5: "Herausragend ‚Äì Baut standort√ºbergreifende F√ºhrungskultur auf"
                    },
                    strat: {
                        1: "Erf√ºllt nicht ‚Äì Tunnelblick, keine Weitsicht",
                        2: "Verbesserungsbedarf ‚Äì Tagesgesch√§ft dominiert, wenig Bezug zur Strategie",
                        3: "Baseline ‚Äì √úbersetzt Strategie in Bereichsziele, zeigt Zusammenh√§nge",
                        4: "√úbertrifft ‚Äì Antizipiert Entwicklungen, fordert Status quo heraus",
                        5: "Herausragend ‚Äì Pr√§gt strategische Ausrichtung, M&A-Kompetenz"
                    },
                    decide: {
                        1: "Erf√ºllt nicht ‚Äì Vermeidet Entscheidungen, delegiert st√§ndig nach oben",
                        2: "Verbesserungsbedarf ‚Äì Entscheidet nur bei perfekter Info-Lage",
                        3: "Baseline ‚Äì Entscheidet z√ºgig, transparent, steht zu Entscheidungen",
                        4: "√úbertrifft ‚Äì Trifft auch unbequeme Entscheidungen, dosiert Risiko klug",
                        5: "Herausragend ‚Äì Entscheidet strategisch mit Mut, bei Unsicherheit souver√§n"
                    },
                    exec: {
                        1: "Erf√ºllt nicht ‚Äì Plant nicht, keine Verbindlichkeit",
                        2: "Verbesserungsbedarf ‚Äì Nachverfolgung inkonsistent, l√§sst nachsichtig durchgehen",
                        3: "Baseline ‚Äì Klare Ziele, nachvollziehbare Erwartungen, fordert ein",
                        4: "√úbertrifft ‚Äì Stringent, balanciert Druck & F√∂rderung, denkt in KPIs",
                        5: "Herausragend ‚Äì Performance-Kultur √ºber Standorte hinweg"
                    },
                    stake: {
                        1: "Erf√ºllt nicht ‚Äì Ignoriert Stakeholder, provoziert Konflikte",
                        2: "Verbesserungsbedarf ‚Äì Reagiert nur auf Eskalationen",
                        3: "Baseline ‚Äì Pflegt proaktiv Beziehungen, moderiert sachlich",
                        4: "√úbertrifft ‚Äì Orchestriert Stakeholder, findet Win-Win-L√∂sungen",
                        5: "Herausragend ‚Äì Diplomatie auf Executive-Level, verhindert Eskalationen"
                    }
                }
            },
            it: {
                headerTitle: "Colloquio Annuale & Performance Review",
                headerSubtitle: "Annual Performance Review | Strategia 2035",
                partA: "Parte A: Dati del Colloquio",
                formType: "Tipo di modulo",
                formTypeSelf: "Autoriflessione (Collaboratore)",
                formTypeManager: "Valutazione (Manager)",
                selfReflectionNote: "‚ö†Ô∏è Si prega di inviare questa autoriflessione al proprio manager almeno una settimana prima del colloquio.",
                partB: "Parte B: Raggiungimento Obiettivi (COSA) ‚Äì Peso 50%",
                partC: "Parte C: Competenze Chiave (COME)",
                compName: "Competenza",
                partCLead: "Parte C.2: Competenze Leadership",
                partC3: "Parte C.3: Global Performance Score (GPS)",
                partD: "Parte D: Punti di forza & Pianificazione Sviluppo",
                partE: "Parte E: Prospettiva di carriera & Obiettivi",
                partF: "Parte F: Feedback del Collaboratore",
                partH: "Parte G: Firme & Accettazione",
                employee: "Collaboratore (Cognome, Nome)",
                position: "Posizione / Funzione",
                manager: "Responsabile (Cognome, Nome)",
                date: "Data del colloquio",
                period: "Periodo di valutazione",
                to: "al",
                hintGPS: "Nota: Il GPS viene calcolato interattivamente qui. Trasferire i valori finali dalla calibrazione.",
                profile: "Profilo / Ruolo",
                roleEmp: "Collaboratore (50% COSA / 50% Comp. Chiave)",
                roleMgr: "Manager (50% COSA / 25% Chiave / 25% Lead)",
                goalName: "Descrizione Obiettivo",
                weight: "Peso %",
                achievement: "Raggiunto %",
                barsLevel: "Voto BARS",
                strengths: "D.1 Punti di forza identificati",
                strengthsProfessional: "Punti di forza tecnici (Cosa riesce particolarmente bene?):",
                strengthsPersonal: "Punti di forza personali (Quali competenze comportamentali si distinguono?):",
                development: "D.2 Aree di sviluppo & Misure",
                devIntro: "Quali competenze devono essere rafforzate?",
                measure: "Misura",
                responsible: "Responsabile",
                deadline: "Attuazione entro",
                careerIntro: "Quali obiettivi di carriera ha il collaboratore?",
                careerOptions: [
                    "Soddisfatto/a della posizione attuale",
                    "Aspiro a carriera tecnica",
                    "Aspiro a carriera manageriale",
                    "Aperto/a a cambio reparto",
                    "Aperto/a a cambio sede"
                ],
                comments: "Spiegazione:",
                feedbackIntro: "Condividi la tua valutazione sulla collaborazione, le condizioni di lavoro e le opportunit√† di sviluppo.",
                feedbackQ1: "1. Ti senti sufficientemente supportato e incoraggiato?",
                feedbackQ2: "2. Quali suggerimenti di miglioramento hai (processi, strumenti, condizioni di lavoro)?",
                feedbackQ3: "3. Quali difficolt√† maggiori hai incontrato quest'anno?",
                feedbackQ4: "4. Qual √® stato il tuo pi√π grande momento di successo personale?",
                feedbackQ5: "5. Come percepisci il cambiamento della strategia aziendale?",
                feedbackQ6: "6. Quali progetti proporresti per il tuo reparto?",
                feedbackQ7: "7. Come valuti il tuo equilibrio vita-lavoro? (1=molto scarso, 5=molto buono)",
                signatureNote: "La firma conferma che il colloquio ha avuto luogo.",
                signatureEmp: "Firma Collaboratore",
                signatureMgr: "Firma Responsabile",
                print: "Scarica come PDF",
                generating: "Generazione PDF...",
                calcAuto: "Calcolato automaticamente",
                totalWas: "Score COSA",
                totalWie: "Score COME",
                addGoal: "Aggiungi Obiettivo",
                addDev: "Aggiungi Misura",
                addComp: "Aggiungi Competenza",
                totalWeight: "Peso Totale",
                shouldBe100: "dovrebbe essere 100%",
                rating: "Rating",
                comment: "Commento / Motivazione",
                barsCompetency: {
                    fach: {
                        1: "Non soddisfa ‚Äì Lacune evidenti, nessuna base tecnica",
                        2: "Necessita miglioramento ‚Äì Processi standard ok, in difficolt√† con deviazioni",
                        3: "Baseline ‚Äì Autonomo, affidabile, alta qualit√†",
                        4: "Supera ‚Äì Padroneggia contesti complessi, agisce preventivamente",
                        5: "Eccezionale ‚Äì Autorit√† tecnica, riconosciuto tra sedi"
                    },
                    komm: {
                        1: "Non soddisfa ‚Äì Si isola, mentalit√† difensiva",
                        2: "Necessita miglioramento ‚Äì Reattivo, canali inefficienti",
                        3: "Baseline ‚Äì Proattivo, rispettoso, condivide conoscenze",
                        4: "Supera ‚Äì Crea comprensione, abbatte silos, media conflitti",
                        5: "Eccezionale ‚Äì Stabilisce nuovi standard, rete di fiducia"
                    },
                    prob: {
                        1: "Non soddisfa ‚Äì Blocca, attende passivamente soluzioni esterne",
                        2: "Necessita miglioramento ‚Äì Tratta sintomi, escalation prematura",
                        3: "Baseline ‚Äì Analizza strutturalmente, trova soluzioni pragmatiche",
                        4: "Supera ‚Äì Riconosce pattern, pensa in alternative",
                        5: "Eccezionale ‚Äì Risolve problemi strategici, modello nelle crisi"
                    },
                    adapt: {
                        1: "Non soddisfa ‚Äì Resiste ai cambiamenti",
                        2: "Necessita miglioramento ‚Äì Poca iniziativa per formazione",
                        3: "Baseline ‚Äì Curioso, riflette, si adatta rapidamente",
                        4: "Supera ‚Äì Cerca attivamente conoscenza, catalizzatore per novit√†",
                        5: "Eccezionale ‚Äì Anticipa trend, prepara organizzazione"
                    },
                    orga: {
                        1: "Non soddisfa ‚Äì Caotico, non rispetta scadenze",
                        2: "Necessita miglioramento ‚Äì Funziona sotto guida, insicuro in autonomia",
                        3: "Baseline ‚Äì Organizzato, prioritizza, mantiene impegni",
                        4: "Supera ‚Äì Previdente, ottimizza processi, alleggerisce altri",
                        5: "Eccezionale ‚Äì Coordina progetti complessi, stabilisce standard"
                    },
                    lead: {
                        1: "Non soddisfa ‚Äì Nessun impegno per team, micromanagement",
                        2: "Necessita miglioramento ‚Äì Conduce solo conversazioni 'comode'",
                        3: "Baseline ‚Äì Direzione chiara, sviluppo individuale, coaching",
                        4: "Supera ‚Äì Design strategico team, sviluppa high performer",
                        5: "Eccezionale ‚Äì Costruisce cultura leadership cross-site"
                    },
                    strat: {
                        1: "Non soddisfa ‚Äì Visione tunnel, nessuna lungimiranza",
                        2: "Necessita miglioramento ‚Äì Domina operativit√†, poco legame strategico",
                        3: "Baseline ‚Äì Traduce strategia in obiettivi, mostra connessioni",
                        4: "Supera ‚Äì Anticipa sviluppi, sfida status quo",
                        5: "Eccezionale ‚Äì Plasma direzione strategica, competenza M&A"
                    },
                    decide: {
                        1: "Non soddisfa ‚Äì Evita decisioni, delega sempre verso l'alto",
                        2: "Necessita miglioramento ‚Äì Decide solo con informazioni perfette",
                        3: "Baseline ‚Äì Decide rapidamente, trasparente, sostiene decisioni",
                        4: "Supera ‚Äì Prende decisioni scomode, dosa rischio intelligentemente",
                        5: "Eccezionale ‚Äì Decide strategicamente con coraggio, sovrano nell'incertezza"
                    },
                    exec: {
                        1: "Non soddisfa ‚Äì Non pianifica, nessuna affidabilit√†",
                        2: "Necessita miglioramento ‚Äì Follow-up incoerente, troppo indulgente",
                        3: "Baseline ‚Äì Obiettivi chiari, aspettative comprensibili, richiede risultati",
                        4: "Supera ‚Äì Rigoroso, bilancia pressione & supporto, pensa in KPI",
                        5: "Eccezionale ‚Äì Cultura performance cross-site"
                    },
                    stake: {
                        1: "Non soddisfa ‚Äì Ignora stakeholder, provoca conflitti",
                        2: "Necessita miglioramento ‚Äì Reagisce solo a escalation",
                        3: "Baseline ‚Äì Coltiva relazioni proattivamente, modera oggettivamente",
                        4: "Supera ‚Äì Orchestra stakeholder, trova soluzioni win-win",
                        5: "Eccezionale ‚Äì Diplomazia executive-level, previene escalation"
                    }
                }
            },
            en: {
                headerTitle: "Annual Meeting & Performance Review",
                headerSubtitle: "Annual Performance Review | Strategy 2035",
                partA: "Part A: Meeting Data",
                formType: "Form Type",
                formTypeSelf: "Self-Reflection (Employee)",
                formTypeManager: "Assessment (Manager)",
                selfReflectionNote: "‚ö†Ô∏è Please send this self-reflection to your manager at least one week before the meeting.",
                partB: "Part B: Goal Achievement (WHAT) ‚Äì 50% Weight",
                partC: "Part C: Core Competencies (HOW)",
                compName: "Competency",
                partCLead: "Part C.2: Leadership Competencies",
                partC3: "Part C.3: Global Performance Score (GPS)",
                partD: "Part D: Strengths & Development Planning",
                partE: "Part E: Career Perspective & Goals",
                partF: "Part F: Employee Feedback",
                partH: "Part G: Signatures & Agreement",
                employee: "Employee (Last Name, First Name)",
                position: "Position / Function",
                manager: "Manager (Last Name, First Name)",
                date: "Meeting Date",
                period: "Evaluation Period",
                to: "to",
                hintGPS: "Note: The GPS is calculated interactively here. Transfer the final values from calibration.",
                profile: "Profile / Role",
                roleEmp: "Employee (50% WHAT / 50% Core Comp.)",
                roleMgr: "Manager (50% WHAT / 25% Core / 25% Lead)",
                goalName: "Goal Description",
                weight: "Weight %",
                achievement: "Achievement %",
                barsLevel: "BARS Score",
                strengths: "D.1 Identified Strengths",
                strengthsProfessional: "Professional Strengths (What works particularly well?):",
                strengthsPersonal: "Personal Strengths (Which behavioral competencies stand out?):",
                development: "D.2 Development Areas & Measures",
                devIntro: "Which competencies should be strengthened?",
                measure: "Measure",
                responsible: "Responsible",
                deadline: "Implementation by",
                careerIntro: "What career goals does the employee have?",
                careerOptions: [
                    "Satisfied with current position",
                    "Seeking technical career",
                    "Seeking management career",
                    "Open to department change",
                    "Open to location change"
                ],
                comments: "Explanation:",
                feedbackIntro: "Please share your assessment of collaboration, working conditions, and development opportunities.",
                feedbackQ1: "1. Do you feel sufficiently supported and encouraged?",
                feedbackQ2: "2. What improvement suggestions do you have (processes, tools, working conditions)?",
                feedbackQ3: "3. What major difficulties did you encounter this year?",
                feedbackQ4: "4. What was your greatest personal moment of success?",
                feedbackQ5: "5. How do you perceive the change in company strategy?",
                feedbackQ6: "6. What projects would you propose for your department?",
                feedbackQ7: "7. How do you rate your work-life balance? (1=very poor, 5=very good)",
                signatureNote: "The signature confirms that the meeting took place.",
                signatureEmp: "Employee Signature",
                signatureMgr: "Manager Signature",
                print: "Download as PDF",
                generating: "Generating PDF...",
                calcAuto: "Calculated automatically",
                totalWas: "WHAT Score",
                totalWie: "HOW Score",
                addGoal: "Add Goal",
                addDev: "Add Measure",
                addComp: "Add Competency",
                totalWeight: "Total Weight",
                shouldBe100: "should be 100%",
                rating: "Rating",
                comment: "Comment / Justification",
                barsCompetency: {
                    fach: {
                        1: "Does Not Meet ‚Äì Faulty, no professional foundation",
                        2: "Needs Improvement ‚Äì Standard processes okay, overwhelmed with deviations",
                        3: "Baseline ‚Äì Confident, independent, high quality",
                        4: "Exceeds ‚Äì Masters complex contexts, acts preventively",
                        5: "Outstanding ‚Äì Professional authority, recognized across locations"
                    },
                    komm: {
                        1: "Does Not Meet ‚Äì Isolates themselves, defensive mentality",
                        2: "Needs Improvement ‚Äì Reactive, inefficient channels",
                        3: "Baseline ‚Äì Proactive, respectful, shares knowledge willingly",
                        4: "Exceeds ‚Äì Creates understanding, breaks down silos, mediates conflicts",
                        5: "Outstanding ‚Äì Establishes new standards, network of trust"
                    },
                    prob: {
                        1: "Does Not Meet ‚Äì Blocks, passively waits for external solutions",
                        2: "Needs Improvement ‚Äì Addresses symptoms, escalates too early",
                        3: "Baseline ‚Äì Analyzes structurally, finds pragmatic solutions",
                        4: "Exceeds ‚Äì Recognizes patterns, thinks in solution alternatives",
                        5: "Outstanding ‚Äì Solves strategic problems, role model in crises"
                    },
                    adapt: {
                        1: "Does Not Meet ‚Äì Resists changes",
                        2: "Needs Improvement ‚Äì Little initiative for further training",
                        3: "Baseline ‚Äì Curious, reflective, adapts quickly",
                        4: "Exceeds ‚Äì Actively seeks knowledge, catalyst for new things",
                        5: "Outstanding ‚Äì Anticipates trends, prepares organization"
                    },
                    orga: {
                        1: "Does Not Meet ‚Äì Chaotic, misses deadlines",
                        2: "Needs Improvement ‚Äì Functions under guidance, insecure with autonomy",
                        3: "Baseline ‚Äì Organized, prioritizes, keeps commitments",
                        4: "Exceeds ‚Äì Forward-thinking, optimizes processes, relieves others",
                        5: "Outstanding ‚Äì Coordinates complex projects, sets standards"
                    },
                    lead: {
                        1: "Does Not Meet ‚Äì No team commitment, micromanagement",
                        2: "Needs Improvement ‚Äì Only conducts 'comfortable' conversations",
                        3: "Baseline ‚Äì Clear direction, individual development, coaching",
                        4: "Exceeds ‚Äì Strategic team design, develops high performers",
                        5: "Outstanding ‚Äì Builds cross-site leadership culture"
                    },
                    strat: {
                        1: "Does Not Meet ‚Äì Tunnel vision, no foresight",
                        2: "Needs Improvement ‚Äì Dominated by operations, little strategic connection",
                        3: "Baseline ‚Äì Translates strategy into goals, shows connections",
                        4: "Exceeds ‚Äì Anticipates developments, challenges status quo",
                        5: "Outstanding ‚Äì Shapes strategic direction, M&A competence"
                    },
                    decide: {
                        1: "Does Not Meet ‚Äì Avoids decisions, always delegates upward",
                        2: "Needs Improvement ‚Äì Only decides with perfect information",
                        3: "Baseline ‚Äì Decides quickly, transparent, stands by decisions",
                        4: "Exceeds ‚Äì Makes uncomfortable decisions, intelligently manages risk",
                        5: "Outstanding ‚Äì Decides strategically with courage, sovereign in uncertainty"
                    },
                    exec: {
                        1: "Does Not Meet ‚Äì No planning, no reliability",
                        2: "Needs Improvement ‚Äì Inconsistent follow-up, too lenient",
                        3: "Baseline ‚Äì Clear goals, understandable expectations, demands results",
                        4: "Exceeds ‚Äì Rigorous, balances pressure & support, thinks in KPIs",
                        5: "Outstanding ‚Äì Cross-site performance culture"
                    },
                    stake: {
                        1: "Does Not Meet ‚Äì Ignores stakeholders, provokes conflicts",
                        2: "Needs Improvement ‚Äì Only reacts to escalations",
                        3: "Baseline ‚Äì Proactively cultivates relationships, moderates objectively",
                        4: "Exceeds ‚Äì Orchestrates stakeholders, finds win-win solutions",
                        5: "Outstanding ‚Äì Executive-level diplomacy, prevents escalations"
                    }
                }
            }
        };

        const CORE_COMPETENCIES_CALC = [
          { id: 'fach', name: 'Fachkompetenz & Anwendung', nameIt: 'Competenza tecnica & Applicazione', nameEn: 'Technical Expertise & Application', weight: 20 },
          { id: 'komm', name: 'Kommunikation & Zusammenarbeit', nameIt: 'Comunicazione & Collaborazione', nameEn: 'Communication & Collaboration', weight: 20 },
          { id: 'prob', name: 'Probleml√∂sekompetenz', nameIt: 'Capacit√† di problem solving', nameEn: 'Problem-Solving Skills', weight: 20 },
          { id: 'adapt', name: 'Anpassungsf√§higkeit', nameIt: 'Adattabilit√†', nameEn: 'Adaptability', weight: 20 },
          { id: 'orga', name: 'Selbstorganisation', nameIt: 'Autogestione', nameEn: 'Self-Organization', weight: 20 },
        ];

        const LEADERSHIP_COMPETENCIES_CALC = [
          { id: 'lead', name: 'Mitarbeiterf√ºhrung & -entwicklung', nameIt: 'Gestione & Sviluppo del personale', nameEn: 'Employee Management & Development', weight: 20 },
          { id: 'strat', name: 'Strategisches Denken', nameIt: 'Pensiero strategico', nameEn: 'Strategic Thinking', weight: 20 },
          { id: 'decide', name: 'Entscheidungsf√§higkeit', nameIt: 'Capacit√† decisionale', nameEn: 'Decision-Making', weight: 20 },
          { id: 'exec', name: 'Execution & Performance Mgmt', nameIt: 'Execution & Performance Mgmt', nameEn: 'Execution & Performance Mgmt', weight: 20 },
          { id: 'stake', name: 'Stakeholder-Mgmt & Konflikte', nameIt: 'Gestione degli stakeholder & Conflitti', nameEn: 'Stakeholder Mgmt & Conflicts', weight: 20 },
        ];

        const DEFAULTS = {
            de: {
                core: CORE_COMPETENCIES_CALC.map(c => ({...c, rating: 3, comment: ''})),
                lead: LEADERSHIP_COMPETENCIES_CALC.map(c => ({...c, rating: 3, comment: ''}))
            },
            it: {
                core: CORE_COMPETENCIES_CALC.map(c => ({...c, name: c.nameIt, rating: 3, comment: ''})),
                lead: LEADERSHIP_COMPETENCIES_CALC.map(c => ({...c, name: c.nameIt, rating: 3, comment: ''}))
            },
            en: {
                core: CORE_COMPETENCIES_CALC.map(c => ({...c, name: c.nameEn, rating: 3, comment: ''})),
                lead: LEADERSHIP_COMPETENCIES_CALC.map(c => ({...c, name: c.nameEn, rating: 3, comment: ''}))
            }
        };

        // --- APPLICATION DATA (Competencies and Levels) ---
        const APP_DATA = {
          de: {
            intro: {
              values: [
                { key: "Fast", desc: "Wir agieren schnell und l√∂sungsorientiert.", icon: Zap, color: "text-yellow-600" },
                { key: "Fair", desc: "Wir arbeiten respektvoll und auf Augenh√∂he zusammen.", icon: Scale, color: "text-blue-600" },
                { key: "Personal", desc: "Wir √ºbernehmen Verantwortung und gestalten aktiv.", icon: Heart, color: "text-red-600" }
              ]
            },
            competencies: [
            {
              id: "c1",
              title: "Fachkompetenz & Anwendung",
              category: "core",
              icon: Briefcase,
              definition: `Bewertet spezifisches Fachwissen und dessen Anwendung. Es geht nicht nur um theoretisches K√∂nnen, sondern den Beitrag zu Prozesssicherheit und Qualit√§t.`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende verf√ºgt nicht √ºber das f√ºr die Position zwingend erforderliche fachliche Fundament. Aufgaben werden h√§ufig fehlerhaft oder unvollst√§ndig ausgef√ºhrt (z. B. falsche Dateneingaben, Fehlbedienung von Anlagen, Falschausk√ºnfte an Kunden), was zu Nacharbeit, Beschwerden oder Risiken f√ºhrt. Es fehlt das Verst√§ndnis f√ºr die fachlichen Standards und Regeln des eigenen Bereichs. Auch nach Einarbeitung oder Feedback treten dieselben inhaltlichen Fehler wiederholt auf. Der/die Mitarbeitende zeigt wenig Antrieb, diese Wissensl√ºcken eigenst√§ndig zu schlie√üen. Komplexe Zusammenh√§nge des eigenen Fachgebiets werden nicht durchdrungen; man verl√§sst sich darauf, dass andere die fachliche Richtigkeit pr√ºfen.`, 
                  example: `Admin: Pflegt Stammdaten wiederholt falsch ein, versteht die Auswirkung auf Rechnungen nicht. | Buchhaltung: Versteht USt-Systematik nicht, bucht wiederholt falsch (19% statt 7%), Steuerbescheide m√ºssen korrigiert werden. | HR: Kennt K√ºndigungsfristen nicht, erstellt fehlerhafte Arbeitsvertr√§ge, die nachgebessert werden m√ºssen. | Einkauf: Versteht Incoterms nicht, bestellt mit falschen Lieferbedingungen (DDP statt EXW), verursacht unerwartete Kosten.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende beherrscht die Standardprozesse und Routineaufgaben seines Fachgebiets sicher und liefert im Tagesgesch√§ft zuverl√§ssige Ergebnisse. Bei Abweichungen, Spezialf√§llen oder neuen Anforderungen erkennt er/sie die eigenen Grenzen und holt sich gezielt Unterst√ºtzung von erfahrenen Kollegen oder der F√ºhrungskraft - ein dem aktuellen Erfahrungsstand angemessenes Vorgehen. Er/Sie beginnt, verf√ºgbare Ressourcen (Dokumentation, Handb√ºcher, System-Hilfen) eigenst√§ndig zu nutzen, bevor eskaliert wird. Das Verst√§ndnis f√ºr das ‚ÄûWarum" hinter Prozessen entwickelt sich schrittweise. Die Basis f√ºr den n√§chsten Entwicklungsschritt - vollst√§ndige Selbstst√§ndigkeit auch bei komplexen Themen - ist gelegt.`, 
                  example: `IT: L√∂st Standard-Anfragen (Passwort-Resets, Drucker-Probleme) kompetent und selbstst√§ndig. Bei komplexeren Netzwerkproblemen f√ºhrt er/sie eine erste Diagnose durch (Logs pr√ºfen, Symptome dokumentieren), bevor erfahrene Kollegen hinzugezogen werden. | Buchhaltung: Bucht Standardvorg√§nge korrekt und termingerecht. Bei Intercompany-Buchungen nutzt er/sie zunehmend die verf√ºgbare Dokumentation und fragt gezielt nach. | HR: Erstellt Routinezeugnisse professionell. Bei Sonderf√§llen recherchiert er/sie Vorlagen und bespricht kritische Punkte mit der F√ºhrungskraft. | Controlling: Erstellt Standardreports zuverl√§ssig. Bei komplexen Nachfragen holt er/sie sich Unterst√ºtzung.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende beherrscht sein Aufgabengebiet souver√§n und liefert konstant qualitativ hochwertige Ergebnisse (korrekte Auftragsabwicklung, stabile Systemverf√ºgbarkeit, pr√§zise Werkst√ºcke). Er/Sie arbeitet im Tagesgesch√§ft vollkommen selbstst√§ndig. Auftretende fachliche Probleme l√∂st er/sie z√ºgig eigenst√§ndig oder holt gezielt und rechtzeitig Unterst√ºtzung ein. Er/Sie ist in der Lage, sein Wissen situativ an Kollegen weiterzugeben (kurze Einweisungen, Troubleshooting-Tipps) und tr√§gt damit zur Stabilit√§t des Teams bei. Fachliche Standards werden konsequent eingehalten.`, 
                  example: `Produktion: Bedient Anlage fehlerfrei nach Spezifikation. | Buchhaltung: F√ºhrt Monatsabschluss selbstst√§ndig und termingerecht durch, kl√§rt offene Posten eigeninitiativ. | HR: Bearbeitet Personalf√§lle von Einstellung bis Austritt rechtssicher und vollst√§ndig. | Einkauf: Verhandelt Konditionen im Rahmen der Vorgaben, h√§lt Lieferantenstamm aktuell, eskaliert bei Engp√§ssen rechtzeitig.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende durchdringt auch komplexe fachliche Zusammenh√§nge tiefgehend und erkennt Wechselwirkungen, die anderen entgehen (z.B. wie eine √Ñnderung im Auftrag die Produktionsplanung beeinflusst). Er/Sie agiert pr√§ventiv: Risiken oder Fehlerquellen werden identifiziert und eliminiert, bevor sie zum Problem werden. Das Fachwissen wird genutzt, um bestehende Abl√§ufe aktiv zu optimieren und effizienter zu gestalten. Kollegen wenden sich bei kniffligen fachlichen Fragen aktiv an diese Person (‚ÄûGo-to-Person‚Äú). Der/die Mitarbeitende gibt Wissen proaktiv weiter und sorgt f√ºr einen hohen Standard im Team. Er/Sie blickt √ºber den eigenen Schreibtisch hinaus und versteht die Anforderungen der internen Schnittstellenpartner genau.`, 
                  example: `Customer Service: Pr√ºft bei spezifischer Frage proaktiv mit Labor die Machbarkeit und schl√§gt sicherere Alternative vor. | Buchhaltung: Erkennt steuerliche Optimierungspotenziale, schl√§gt Umstrukturierung der Intercompany-Beziehungen vor. | HR: Entwickelt neue Onboarding-Checkliste, die Einarbeitungszeit um 30% reduziert. | Controlling: Baut Dashboard, das Gesch√§ftsf√ºhrung fr√ºhzeitig auf Margenverfall hinweist.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende gilt als absolute fachliche Autorit√§t auf seinem Gebiet, deren Expertise auch standort√ºbergreifend (Sulzberg/Bozen/Campogalliano) gesch√§tzt und angefragt wird. Er/Sie nutzt sein exzellentes Wissen, um signifikante Verbesserungen f√ºr die Gruppe zu erzielen (z. B. Einf√ºhrung konzernweiter Standards im Customer Service, massive Effizienzsteigerung durch neue IT-L√∂sungen). Diese Person fungiert als Multiplikator. Sie bereitet komplexes Fachwissen so auf, dass es f√ºr die Organisation nutzbar wird (z.B. Schulungen, Best-Practice-Leitf√§den). Er/Sie antizipiert zuk√ºnftige Entwicklungen im Fachbereich (z.B. Markttrends, neue Technologien) und bereitet das Unternehmen proaktiv darauf vor. Fachliche Exzellenz wird hier zum direkten Mehrwert f√ºr den Unternehmenserfolg.`, 
                  example: `Group Function: Entwickelt einheitlichen Service-Standard f√ºr alle Standorte (DE/IT), schult Teams. | Buchhaltung: F√ºhrt gruppenweites Reporting nach IFRS ein, wird vom Wirtschaftspr√ºfer als Ansprechpartner gesch√§tzt. | HR: Entwickelt Performance-Management-System f√ºr alle Standorte, wird zum internen Experten. | Controlling: Etabliert Rolling Forecast, der von GF als Steuerungsinstrument √ºbernommen wird.` 
                }
              }
            },
            {
              id: "c2",
              title: "Kommunikation & Zusammenarbeit",
              category: "core",
              icon: MessageCircle,
              definition: `Qualit√§t des Informationsaustauschs und das Miteinander. 'One Niederwieser' bedeutet: Zusammenarbeit endet nicht an der B√ºrot√ºr oder L√§ndergrenze.`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende beh√§lt arbeitskritische Informationen f√ºr sich oder gibt sie so unvollst√§ndig weiter, dass Kollegen oder Kunden nachfragen m√ºssen und Fehler entstehen. Er/Sie kapselt sich ab und zeigt kein Interesse an gemeinsamer Zielerreichung. Bei Problemen wird Verantwortung abgeschoben (‚ÄûNicht meine Zust√§ndigkeit") oder Unterst√ºtzung verweigert. Die Kommunikation ist gepr√§gt von Absicherungsmentalit√§t (CC-Schlachten) statt L√∂sungsorientierung. Konflikte werden ignoriert, hinter dem R√ºcken ausgetragen oder unsachlich eskaliert. Das Verhalten verletzt Grundwerte des Respekts und der Fairness.`, 
                  example: `Produktion: Gibt bei Schicht√ºbergabe trotz kritischer Maschinenst√∂rung nur ‚ÄûAlles ok" weiter. | Buchhaltung: Informiert Kollegen nicht √ºber ge√§nderte Kontierungsregeln, Fehlbuchungen h√§ufen sich. | HR: Teilt K√ºndigungen nicht rechtzeitig mit, Vertretungsregelungen scheitern. | Einkauf: Verschweigt Lieferantenprobleme, Produktion steht √ºberraschend still.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende kommuniziert prim√§r reaktiv: Informationen flie√üen oft erst auf explizite Nachfrage (‚ÄûHolschuld‚Äú statt ‚ÄûBringschuld‚Äú). Er/Sie fokussiert sich stark auf den eigenen Aufgabenbereich und blendet die Bed√ºrfnisse angrenzender Abteilungen oder Kollegen aus. In Meetings oder Projekten bringt er/sie sich kaum proaktiv ein. Der gew√§hlte Kommunikationskanal ist h√§ufig ineffizient (z. B. langes Hin-und-Her-Schreiben bei komplexen Themen statt eines kurzen, kl√§renden Anrufs ‚Äì entgegen dem Prinzip ‚ÄûPhone before Email‚Äú). Feedback wird oft pers√∂nlich genommen oder defensiv abgewehrt. Die Zusammenarbeit funktioniert im Routinebetrieb, wird aber bei Stress, Unklarheit oder abteilungs√ºbergreifenden Themen schnell holprig.`, 
                  example: `Backoffice: Schreibt tagelang E-Mails hin und her statt den Fall telefonisch zu kl√§ren. | Buchhaltung: Antwortet auf R√ºckfragen erst nach Tagen, blockiert Freigabeprozesse. | HR: Informiert √ºber neue Richtlinien nur per Rundmail ohne Erkl√§rung, Nachfragen h√§ufen sich. | Controlling: Liefert Zahlen ohne Kontext, Empf√§nger verstehen Aussage nicht.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende informiert Kollegen und Schnittstellenpartner proaktiv, vollst√§ndig und rechtzeitig √ºber alles Relevante (z.B. Status-Updates, Verz√∂gerungen, Abwesenheiten). Er/Sie w√§hlt situationsbedingt den effizientesten Kanal (greift zum H√∂rer, wenn Dinge schnell gekl√§rt werden m√ºssen). Der Umgangston ist stets wertsch√§tzend und auf Augenh√∂he, unabh√§ngig von Hierarchie oder Standort. Er/Sie bietet Kollegen Unterst√ºtzung an, wenn Not am Mann ist, und teilt Wissen bereitwillig. In Meetings ist er/sie pr√§sent, gut vorbereitet und konstruktiv. Konflikte werden sachlich und direkt angesprochen. Er/Sie tr√§gt stabil zu einer positiven, professionellen Arbeitsatmosph√§re bei.`, 
                  example: `Sales: Informiert bei Lieferverzug sofort Kunden und Au√üendienst proaktiv mit neuem Termin. | Buchhaltung: K√ºndigt Monatsabschluss-Termine fr√ºhzeitig an, stimmt Schnittstellen ab. | HR: Kommuniziert √Ñnderungen im Arbeitsrecht verst√§ndlich an alle F√ºhrungskr√§fte. | Assistenz: H√§lt alle Beteiligten √ºber Terminverschiebungen auf dem Laufenden.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende kommuniziert nicht nur Informationen, sondern schafft Verst√§ndnis. Er/Sie passt die Kommunikation gezielt an das Gegen√ºber an (z. B. √ºbersetzt technische Details f√ºr Laien, bereitet Daten f√ºr Entscheider auf) und stellt sicher, dass die Botschaft korrekt ankommt. Er/Sie agiert aktiv als Bindeglied zwischen Abteilungen und baut Silos ab. Bei Konflikten oder Missverst√§ndnissen im Team √ºbernimmt er/sie eine vermittelnde Rolle und sucht nach einer gemeinsamen L√∂sung (‚ÄûWin-Win‚Äú), anstatt Recht haben zu wollen. Er/Sie gibt konstruktives, entwicklungsorientiertes Feedback, das anderen hilft, besser zu werden. Die Zusammenarbeit mit dieser Person macht das gesamte Umfeld messbar effizienter und motivierter.`, 
                  example: `Schnittstelle: Moderiert bei Konflikt zwischen Produktion und Service, schafft Regelung f√ºr Eilauftr√§ge. | Buchhaltung: Erkl√§rt Finance-Themen so, dass auch Nicht-Kaufleute verstehen und mitentscheiden k√∂nnen. | HR: Vermittelt bei Teamkonflikt, findet L√∂sung die beide Seiten akzeptieren. | Controlling: Bereitet Zahlen f√ºr GF so auf, dass Entscheidungen direkt m√∂glich sind.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende etabliert neue Standards der Zusammenarbeit, die √ºber das eigene Team hinauswirken (z. B. Initiierung regelm√§√üiger Austauschformate zwischen den Standorten Sulzberg und Campogalliano oder zwischen Sales und Technik). Er/Sie lebt die Werte Fast, Fair, Personal so vorbildlich, dass er/sie als Rollenmodell wirkt und andere mitrei√üt. Er/Sie schafft ein Netzwerk des Vertrauens im gesamten Unternehmen und nutzt dieses, um komplexe, abteilungs√ºbergreifende Probleme schnell und unb√ºrokratisch zu l√∂sen. Er/Sie wird bei schwierigen Kommunikationssituationen (z. B. Change-Prozesse, Krisen) als Mentor oder Mediator hinzugezogen. Er/Sie sorgt aktiv daf√ºr, dass wir intern und extern ‚Äûmit einer Stimme‚Äú sprechen.`, 
                  example: `HR: Initiiert standort√ºbergreifendes Sounding Board f√ºr kulturelle Unterschiede Bozen/Sulzberg. | Buchhaltung: Etabliert monatlichen Finance-Call mit allen Standorten, schafft Transparenz. | Assistenz: F√ºhrt einheitliches Kommunikationsprotokoll f√ºr GF-Bereich ein. | Controlling: Schafft Reporting-Standard, der gruppenweite Vergleichbarkeit erm√∂glicht.` 
                }
              }
            },
            {
              id: "c3",
              title: "Probleml√∂sekompetenz",
              category: "core",
              icon: ShieldAlert,
              definition: `Umgang mit Hindernissen. Wir unterscheiden Troubleshooting (Symptome) vs. Ursachenforschung (Wurzel).`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende erkennt Probleme oft erst, wenn sie bereits eskaliert sind, oder ignoriert offensichtliche Warnsignale (z.B. Fehlermeldungen, Kundenbeschwerden, Qualit√§tsabweichungen). Er/Sie zeigt keine Eigeninitiative zur L√∂sung, sondern wartet passiv auf Anweisungen (‚ÄûDienst nach Vorschrift‚Äú). Bei Schwierigkeiten wird schnell aufgegeben oder die Verantwortung auf andere (Kollegen, IT, Lieferanten) geschoben. Fehler werden vertuscht oder kleingeredet, statt sie offen anzusprechen. Es findet kein Lernen aus Fehlern statt: Das exakt gleiche Problem tritt immer wieder auf, ohne dass das Verhalten ge√§ndert wird.`, 
                  example: `Admin: Klickt Fehlermeldung im ERP einfach weg, am Monatsende stimmen Zahlen nicht. | Buchhaltung: Ignoriert Mahnungen wochenlang, bis Inkasso droht. | HR: √úbersieht Befristungsende, Mitarbeiter arbeitet illegal weiter. | Einkauf: Bemerkt Preisabweichung nicht, zahlt monatelang zu viel.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende erkennt Probleme im eigenen Aufgabenbereich und meldet sie zeitnah. Bei Standardproblemen wendet er/sie dokumentierte L√∂sungsschritte (Checklisten, Anleitungen) an - bei Abweichungen vom Standard holt er/sie Unterst√ºtzung. Die Problemanalyse erfolgt gemeinsam mit erfahrenen Kollegen oder der F√ºhrungskraft; er/sie liefert dabei eine pr√§zise Fehlerbeschreibung als wichtige Grundlage. Der Unterschied zu Stufe 3: Er/sie l√∂st Probleme MIT ANLEITUNG, nicht eigenst√§ndig.`, 
                  example: `IT: Behebt bekannte Fehler nach Dokumentation (z.B. Passwort-Reset, Drucker-Neustart). Bei unbekannten Fehlern: sammelt Infos und eskaliert - l√∂st diese NICHT eigenst√§ndig. | Buchhaltung: Kl√§rt Standardf√§lle nach Prozessvorgabe, holt bei Sonderf√§llen R√ºcksprache. | Unterschied zu Stufe 3: Stufe-3-MA w√ºrde auch unbekannte Probleme selbst analysieren und mit L√∂sungsvorschlag kommen.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende erkennt Probleme im eigenen Aufgabenbereich fr√ºhzeitig und geht sie eigenst√§ndig an. Er/Sie nutzt verf√ºgbare Informationen (Daten, Handb√ºcher, Historie) und Werkzeuge, um pragmatische L√∂sungen zu finden, die funktionieren. Er/Sie unterscheidet sicher, was er/sie selbst l√∂sen kann und wann eine Eskalation notwendig ist ‚Äì informiert dann aber pr√§zise und l√∂sungsorientiert (kommt mit einem Vorschlag, nicht nur mit der Beschwerde). Die L√∂sungen sind solide und nachhaltig f√ºr den Arbeitsalltag. Er/Sie bleibt auch in stressigen Situationen handlungsf√§hig (‚ÄûK√ºhler Kopf‚Äú). Nach einem Fehler wird Verantwortung √ºbernommen (‚ÄûAccountability‚Äú) und korrigiert, statt Ausreden zu suchen.`, 
                  example: `Customer Service: Lokalisiert fehlende Ware, informiert Kunden ehrlich, l√∂st Konflikt professionell. | Buchhaltung: Kl√§rt offene Posten selbstst√§ndig mit Kunden, dokumentiert L√∂sung. | HR: Findet pragmatische L√∂sung f√ºr Urlaubskonflikt im Team. | Einkauf: Organisiert bei Lieferausfall schnell Alternative, informiert alle Betroffenen.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende l√∂st nicht nur das akute Problem, sondern betreibt systematische Ursachenforschung (z.B. ‚Äû5-Why‚Äú-Methode, Datenanalyse), um zu verstehen, warum es passiert ist. Er/Sie entwickelt Ma√ünahmen, die verhindern, dass der Fehler jemals wieder auftritt (Fehlervermeidung). Er/Sie denkt √ºber den eigenen Bereich hinaus: Wenn ein Problem Schnittstellen betrifft (z. B. √úbergabe Sales an Produktion), wird das aktiv adressiert und gel√∂st. Er/Sie unterst√ºtzt Kollegen bei schwierigen Herausforderungen und bringt kreative, unkonventionelle Ans√§tze ein, wenn Standardl√∂sungen nicht greifen. Probleme werden als Chance zur Verbesserung begriffen.`, 
                  example: `Logistik: Analysiert Versp√§tungs-Daten, passt Abholprozess dauerhaft an. | Buchhaltung: Analysiert wiederkehrende Buchungsfehler, schl√§gt Prozess√§nderung vor, die Fehlerquelle eliminiert. | HR: Untersucht hohe Fluktuation in Abteilung, identifiziert F√ºhrungsproblem, initiiert Ma√ünahmen. | Controlling: Findet Ursache f√ºr Margenverfall, entwickelt Gegensteuerungskonzept.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende identifiziert komplexe, strukturelle Probleme oder Risiken, die anderen noch gar nicht aufgefallen sind, und entwickelt daf√ºr umfassende Konzepte. Die L√∂sungen haben oft positiven Einfluss auf mehrere Abteilungen oder Standorte der Gruppe (Sulzberg/Bozen/Campogalliano). Er/Sie etabliert neue Standards oder ‚ÄûBest Practices‚Äú zur Probleml√∂sung, die im Unternehmen √ºbernommen werden. Er/Sie verwandelt Probleme in echte Innovationen oder Wettbewerbsvorteile f√ºr Niederwieser. Bei Krisen √ºbernimmt er/sie informell die F√ºhrung (‚ÄûTroubleshooter‚Äú) und navigiert das Team sicher durch unsicheres Terrain.`, 
                  example: `Quality: Initiiert Task-Force f√ºr Materialfehler √ºber Standorte hinweg. | Buchhaltung: Deckt systematischen Abrechnungsfehler auf, der Gruppe 50k EUR/Jahr kostete, implementiert Kontrolle. | HR: Erkennt strukturelles Qualifizierungsdefizit, entwickelt Schulungsprogramm f√ºr alle Standorte. | Controlling: Identifiziert versteckte Kostentreiber, spart durch Prozess√§nderung 100k EUR/Jahr.` 
                }
              }
            },
            {
              id: "c4",
              title: "Anpassungsf√§higkeit & Lernbereitschaft",
              category: "core",
              icon: BookOpen,
              definition: `Wille, sich auf neue Rahmenbedingungen (IT, Markt, Prozesse) einzustellen. 'Growth Mindset' statt Status Quo.`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende reagiert auf Neuerungen (z.B. neue Software, Umstrukturierungen) mit offener Ablehnung, Zynismus oder Blockadehaltung. Er/Sie h√§lt starr an veralteten Methoden fest (‚ÄûDas haben wir schon immer so gemacht‚Äú) und weigert sich, neue F√§higkeiten zu erlernen. Ver√§nderungen f√ºhren zu einem massiven Leistungseinbruch oder schlechter Laune, die das Team ansteckt. Er/Sie ben√∂tigt unverh√§ltnism√§√üig viel √úberzeugungsarbeit und Druck, um selbst kleinste Anpassungen im Arbeitsablauf umzusetzen. Feedback zur pers√∂nlichen Weiterentwicklung wird ignoriert oder als Angriff gewertet.`, 
                  example: `Lager: Weigert sich, neue Scanner zu nutzen, f√ºhrt private Handlisten weiter. | Buchhaltung: Blockiert ERP-Umstellung aktiv, beschwert sich lautstark √ºber jeden Change. | HR: Lehnt digitale Personalakte kategorisch ab, besteht auf Papier. | Sekretariat: Weigert sich, neues Buchungssystem zu lernen, sabotiert Einf√ºhrung.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende steht Ver√§nderungen offen gegen√ºber und setzt neue Vorgaben um. F√ºr die Einarbeitung in neue Systeme oder Prozesse ben√∂tigt er/sie BEGLEITUNG durch Schulung oder Kollegen - selbstst√§ndiges Einarbeiten nur nach Dokumentation ist noch herausfordernd. Bei Unsicherheiten fragt er/sie nach, was gut und richtig ist. In Stresssituationen greift er/sie manchmal auf vertraute Methoden zur√ºck. Der Unterschied zu Stufe 3: Die Einarbeitung erfolgt MIT UNTERST√úTZUNG, nicht selbstst√§ndig.`, 
                  example: `Finance: Braucht Einzelschulung oder Kollegenbegleitung f√ºr neue Software - lernt nicht allein aus Handbuch. Nach Einarbeitung: zuverl√§ssige Anwendung. | HR: Nutzt neue HR-Software nach Schulung korrekt; bei neuen Funktionen: wartet auf Erkl√§rung statt selbst zu erkunden. | Unterschied zu Stufe 3: Stufe-3-MA arbeitet sich selbstst√§ndig ein und probiert neue Funktionen eigeninitiativ aus.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende geht konstruktiv mit Ver√§nderungen um und passt seine Arbeitsweise an neue Gegebenheiten an. Er/Sie setzt neue Vorgaben (z. B. Nutzung eines neuen Tools, ge√§nderter Schichtplan) verl√§sslich und ohne gro√ües Klagen um. Die Einarbeitung in neue Themen erfolgt in angemessener Zeit. Er/Sie erkennt, wann Wissen fehlt, und nutzt die angebotenen Schulungen oder Hilfsmittel, um die L√ºcke zu schlie√üen. Er/Sie blockiert Innovationen nicht, sondern tr√§gt sie im Tagesgesch√§ft mit. Man kann sich darauf verlassen, dass er/sie auch in einem sich wandelnden Umfeld stabil seine Leistung bringt (‚ÄûFair‚Äú gegen√ºber dem Team).`, 
                  example: `Sales: Nimmt an Schulung f√ºr nachhaltige Folien teil und ber√§t Kunden ab Stichtag kompetent. | Buchhaltung: Arbeitet sich in D365 Business Central ein, nutzt Standardfunktionen zuverl√§ssig. | HR: Setzt neue Datenschutz-Anforderungen (DSGVO) termingerecht um. | Assistenz: √úbernimmt neue Aufgaben aus Umstrukturierung ohne Murren.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende sieht Ver√§nderungen als Chance zur Verbesserung. Er/Sie wartet nicht auf Schulungen, sondern eignet sich neues Wissen (z. B. √ºber neue Produkte, Markttrends oder Software-Kniffe) eigenst√§ndig an. Er/Sie experimentiert mit neuen L√∂sungsans√§tzen und teilt die Erkenntnisse mit dem Team. In Phasen des Umbruchs wirkt er/sie stabilisierend auf andere und hilft Kollegen, die sich mit der Ver√§nderung schwerer tun (z.B. als ‚ÄûBuddy‚Äú bei neuen Systemen). Er/Sie hinterfragt den Status quo konstruktiv und macht Vorschl√§ge, wie man sich besser an neue Anforderungen anpassen kann.`, 
                  example: `Service: Klickt sich schon vor Schulung durch neues CRM, hilft danach Kollegen beim Start. | Buchhaltung: Testet neue ERP-Features aktiv, gibt konstruktives Feedback an IT, wird Key-User. | HR: Probiert KI-Tools f√ºr Recruiting selbst aus, evaluiert Nutzen f√ºr Team. | Controlling: Baut sich selbst Power BI-Kenntnisse auf, erstellt erste Dashboards eigeninitiativ.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende antizipiert notwendige Ver√§nderungen oft fr√ºher als andere und bereitet sich und das Umfeld proaktiv darauf vor (z.B. Erwerb von Zukunftskompetenzen, bevor sie akut gebraucht werden). Er/Sie treibt Innovationen voran, die das Unternehmen zukunftsf√§hig machen (z. B. Pilotierung komplett neuer Arbeitsweisen). Er/Sie etabliert eine Kultur des Lernens im eigenen Bereich, indem er/sie Fehler als Lernchance vorlebt und andere zum Ausprobieren ermutigt (‚ÄûEmpowerment‚Äú). Er/Sie agiert als Leuchtturm bei strategischen Gro√üprojekten (z.B. Harmonisierung der Standorte) und schafft Begeisterung f√ºr den neuen Weg, selbst bei anf√§nglichen Widerst√§nden.`, 
                  example: `IT: Initiiert eigenst√§ndig KI-Pilotprojekt (Copilot), kl√§rt Datenschutz, schult andere Standorte. | Buchhaltung: Treibt E-Invoicing-Einf√ºhrung f√ºr Gruppe voran, wird zum internen Experten. | HR: F√ºhrt Performance-Management-System ein, das Kulturwandel unterst√ºtzt. | Controlling: Implementiert Predictive Analytics, revolutioniert Forecasting f√ºr alle Standorte.` 
                }
              }
            },
            {
              id: "c5",
              title: "Selbstorganisation & Zuverl√§ssigkeit",
              category: "core",
              icon: Clock,
              definition: `Strukturierung der Arbeit, Priorisierung und Accountability. Kann man sich auf das Wort verlassen?`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende arbeitet unsystematisch und ohne erkennbare Struktur. Aufgaben werden vergessen, Deadlines ohne Vorwarnung gerissen oder Termine vers√§umt. Er/Sie l√§sst sich leicht ablenken und verliert den Fokus auf das Wesentliche. Die F√ºhrungskraft oder Kollegen m√ºssen st√§ndig nachfassen (‚ÄûBabysitting‚Äú), damit Ergebnisse geliefert werden. Es fehlt der √úberblick √ºber offene Aufgaben; Zusagen werden leichtfertig gemacht und nicht eingehalten. Der Arbeitsplatz (physisch oder digital) ist unorganisiert, sodass wichtige Unterlagen oder Informationen nicht griffbereit sind. Die Unzuverl√§ssigkeit belastet das Team massiv.`, 
                  example: `Sales: Vergisst Besuchsberichte, verlegt Zettel mit Kundenanfragen. | Buchhaltung: Vergisst Zahlungsfristen, Mahnungen h√§ufen sich. Belege verschwinden im Papierchaos. | HR: Verpasst Probezeit-Enden, vergisst Vertragsumstellungen. Personalakten unvollst√§ndig. | Sekretariat: Termine werden doppelt vergeben, wichtige E-Mails tagelang unbeantwortet.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende erledigt Routineaufgaben zuverl√§ssig und termingerecht - auf sein/ihr Wort kann man sich verlassen. Der Arbeitsplatz (physisch und digital) ist grunds√§tzlich organisiert. Bei mehreren parallelen Aufgaben oder in Hochphasen arbeitet er/sie noch an einer systematischeren Priorisierung nach Dringlichkeit und Wichtigkeit. Die Planung erfolgt aktuell eher kurzfristig; eine vorausschauendere Planung entwickelt sich mit zunehmender Erfahrung. Er/Sie h√§lt Zusagen ein und kommuniziert zunehmend fr√ºhzeitig wenn Engp√§sse absehbar werden. Bei hoher Belastung nimmt er/sie Unterst√ºtzung durch die F√ºhrungskraft an und setzt Empfehlungen um.`, 
                  example: `Werkstatt: Erledigt die t√§glichen Aufgaben zuverl√§ssig. Lernt bei konkurrierenden Anforderungen die Dringlichkeit zu pr√ºfen - manchmal noch mit Unterst√ºtzung des Meisters. | Buchhaltung: Erledigt Standardaufgaben termingerecht. In Hochphasen braucht er/sie manchmal Unterst√ºtzung bei der Priorisierung, arbeitet aber daran Engp√§sse fr√ºher zu kommunizieren. | HR: Bearbeitet Bewerbungen strukturiert. Entwickelt zunehmend Gesp√ºr daf√ºr welche Positionen besonders zeitkritisch sind. | Einkauf: F√ºhrt eine √úbersicht √ºber offene Bestellungen. Arbeitet daran diese proaktiver zu pflegen.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende organisiert seinen Arbeitsalltag selbstst√§ndig und priorisiert Aufgaben sinnvoll nach Dringlichkeit und Wichtigkeit. Zusagen und Termine werden verl√§sslich eingehalten. Sollte eine Deadline gef√§hrdet sein, informiert er/sie mindestens 48 Stunden im Voraus proaktiv (‚ÄûTransparency"). Sein Arbeitsplatz und seine Systeme sind so strukturiert, dass wichtige Informationen jederzeit in unter 2 Minuten auffindbar sind (saubere Ablage, gepflegte To-Do-Listen). Man kann sich auf sein Wort verlassen.`, 
                  example: `Admin: Hat digitale Wiedervorlage im Griff (farbcodierte Priorit√§ten). Meldet am Dienstag, dass Monatsabschluss wegen Krankheitsausfall im Team 2 Tage sp√§ter kommt ‚Äì schl√§gt gleichzeitig L√∂sung vor (Unterst√ºtzung aus anderem Standort).` 
                },
                4: { 
                  text: `Der/die Mitarbeitende plant vorausschauend (2-3 Monate im Voraus) und erkennt Engp√§sse, bevor sie entstehen (Urlaubszeiten, Projekt-Deadlines, Ressourcenknappheit). Er/Sie optimiert aktiv die eigene Arbeitsweise (Nutzung digitaler Tools, Checklisten, B√ºndelung √§hnlicher Aufgaben). Er/Sie bleibt auch bei 120% Auslastung strukturiert und liefert Ergebnisse p√ºnktlich ab. Seine Zuverl√§ssigkeit macht ihn/sie zu einer festen S√§ule im Team ‚Äì Kollegen wissen: ‚ÄûBei X ist es sicher aufgehoben."`, 
                  example: `Projektmanagement: Erstellt 4 Wochen vor Urlaub detaillierte √úbergabemappe mit Status aller Projekte, offenen Punkten und Ansprechpartnern. Bereitet kritische Aufgaben vor (Vorratsbriefings, vorgefertigte Entscheidungsvorlagen). Vertretung kann nahtlos √ºbernehmen.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende entwickelt Organisationssysteme oder Workflows, die nicht nur ihm/ihr selbst, sondern dem ganzen Team oder der Abteilung helfen, effizienter zu arbeiten (z. B. Einf√ºhrung eines Kanban-Boards, Standardisierung der Ablage f√ºr die Gruppe). Er/Sie managt hochkomplexe Aufgabenpakete mit vielen Abh√§ngigkeiten (z. B. standort√ºbergreifende Projekte) souver√§n und termingerecht. Er/Sie gilt als ‚Äûsicherer Hafen‚Äú f√ºr kritische Aufgaben: Wenn er/sie es √ºbernimmt, ist der Erfolg garantiert. Er/Sie schafft durch exzellente Organisation Freir√§ume f√ºr strategische Themen und Innovationen.`, 
                  example: `Marketing: Etabliert digitales Planungstool f√ºr alle Standorte (Sulzberg/Bozen/Campo), eliminiert Doppelarbeit.` 
                }
              }
            },
            {
              id: "l1",
              title: "Mitarbeiterf√ºhrung & -entwicklung", // Korrigierte Titel
              category: "leadership",
              icon: Users,
              definition: `Steuerung, Motivation und Entwicklung des Teams. 'Leadership' statt nur 'Management'.`, // Ge√§ndert f√ºr DE
              levels: {
                1: { 
                  text: `Die F√ºhrungskraft vernachl√§ssigt ihre Kernaufgaben: Mitarbeitergespr√§che (Jahresgespr√§ch, Check-ins) finden nicht statt, sind extrem versp√§tet oder werden als l√§stige Pflicht√ºbung abgehandelt. Es gibt kein konstruktives Feedback; Kritik erfolgt oft unsachlich oder vor anderen. Entwicklungsw√ºnsche der Mitarbeitenden werden ignoriert oder blockiert (‚ÄûDaf√ºr haben wir keine Zeit‚Äú). Ziele werden unklar oder gar nicht kommuniziert, was zu Orientierungslosigkeit f√ºhrt. Das Verhalten widerspricht unseren Werten massiv (z.B. Respektlosigkeit, ‚ÄûDivide and Conquer‚Äú). Im Team herrscht eine Atmosph√§re der Angst oder Gleichg√ºltigkeit, was zu hoher Fluktuation oder innerer K√ºndigung f√ºhrt.`, 
                  example: `Prod-Leiter: Sagt Jahresgespr√§ch 3x ab, f√ºhrt es dann in 15min zwischen T√ºr und Angel. | Leiter Buchhaltung: Gibt nie Feedback, Team erf√§hrt Kritik nur √ºber Dritte. | HR-Leiter: Blockiert Weiterbildungsw√ºnsche grunds√§tzlich ('kein Budget'), demotiviert Team. | Abteilungsleiter Verwaltung: Micromanagement bei jeder E-Mail, kein Vertrauen ins Team.` 
                },
                2: { 
                  text: `Die F√ºhrungskraft f√ºhrt die PFLICHTGESPR√ÑCHE (Jahresgespr√§ch, Zielvereinbarung) p√ºnktlich und dokumentiert die Ergebnisse. Feedback erfolgt prim√§r anlassbezogen - ein systematisches, regelm√§√üiges Feedback im Alltag (positiv UND korrigierend) ist noch im Aufbau. Entwicklungsziele werden im Jahresgespr√§ch vereinbart; die unterj√§hrige Nachverfolgung k√∂nnte aktiver sein. Sie delegiert Aufgaben, beh√§lt aber oft die finale Kontrolle. Der Unterschied zu Stufe 3: F√ºhrt PFLICHTGESPR√ÑCHE zuverl√§ssig, aber noch keine proaktiven Entwicklungsgespr√§che im Alltag.`, 
                  example: `Teamleiter: Alle Pflichtgespr√§che termingerecht durchgef√ºhrt und dokumentiert. Feedback haupts√§chlich wenn etwas schiefl√§uft - spontanes Lob kommt seltener. | Abteilungsleiter: Delegiert Aufgaben klar, pr√ºft aber Ergebnisse detailliert nach. | Unterschied zu Stufe 3: Stufe-3-FK gibt auch im Alltag regelm√§√üig Feedback (positiv + korrigierend) und f√ºhrt proaktive Entwicklungsgespr√§che au√üerhalb des Pflichtzyklus.` 
                },
                3: { 
                  text: `BASELINE: Die F√ºhrungskraft f√ºhrt alle verpflichtenden Gespr√§che (Review, Zielsetzung) p√ºnktlich, gut vorbereitet und auf Augenh√∂he durch. Sie sorgt f√ºr klare Ziele und Erwartungen, sodass jeder wei√ü, was zu tun ist. Feedback erfolgt regelm√§√üig und fair ‚Äì sowohl positiv als auch korrigierend. Sie unterst√ºtzt die fachliche Weiterentwicklung (z.B. Genehmigung von Schulungen) und ist f√ºr die Mitarbeitenden bei Problemen ansprechbar. Sie lebt die Werte ‚ÄûFast, Fair, Personal‚Äú im Alltag vor und sorgt f√ºr ein stabiles, positives Arbeitsklima. Sie behandelt alle Teammitglieder gerecht und diskriminierungsfrei.`, 
                  example: `Sales Director: Regelm√§√üige Check-ins, lobt Erfolge, spricht Defizite offen an. Team kennt Ziele. | Leiter Buchhaltung: Bespricht Jahresabschluss-Learnings im Team, plant gemeinsam Verbesserungen. | HR-Leiter: F√ºhrt strukturierte Entwicklungsgespr√§che, f√∂rdert Weiterbildung aktiv. | Abteilungsleiter: Gibt zeitnahes, konkretes Feedback, Team wei√ü wo es steht.` 
                },
                4: { 
                  text: `Die F√ºhrungskraft nutzt F√ºhrung aktiv, um Mitarbeitende besser zu machen. Sie delegiert nicht nur Aufgaben, sondern Verantwortung, um Wachstum zu erm√∂glichen (‚ÄûEmpowerment‚Äú). Sie f√ºhrt regelm√§√üige, informelle Feedback-Gespr√§che (√ºber den Standardprozess hinaus) und nutzt Coaching-Methoden, um Mitarbeitende zur eigenen L√∂sungsfindung anzuregen. Sie erkennt Potenziale proaktiv und schl√§gt individuelle Entwicklungsma√ünahmen vor (z. B. Projektleitung, Job Rotation). Sie schafft eine Teamkultur, in der Fehler offen besprochen werden, um daraus zu lernen. Die Zusammenarbeit mit dieser Person macht das gesamte Umfeld messbar effizienter und motivierter.`, 
                  example: `IT-Leiter: Delegiert Projektleitung an Talent, gibt spezifisches Feedback, st√§rkt Selbstvertrauen. | Leiter Buchhaltung: √úbertr√§gt Bilanzverantwortung an Nachwuchskraft, coacht bei Bedarf. | HR-Leiter: L√§sst MA eigenverantwortlich Recruiting-Projekt f√ºhren, gibt Coaching statt Anweisungen. | Controlling-Leiter: Entwickelt High-Potential systematisch durch Job-Enrichment und Mentoring.` 
                },
                5: { 
                  text: `Die F√ºhrungskraft baut systematisch Nachfolger auf und entwickelt High-Potentials auch √ºber den eigenen Bedarf hinaus (f√ºr die Gruppe). Sie gilt als Mentor im gesamten Unternehmen, dessen Rat auch von Mitarbeitenden anderer Bereiche gesucht wird. Sie schafft ein Umfeld der Exzellenz, in dem sich Talente entfalten k√∂nnen, und bindet Leistungstr√§ger langfristig an Niederwieser. Sie steuert die Personalplanung strategisch vorausschauend (z.B. f√ºr die n√§chsten 2-3 Jahre) und sorgt daf√ºr, dass das Team bereit f√ºr zuk√ºnftige Herausforderungen der Strategie 2035. Unter ihrer F√ºhrung entstehen Innovationen und √ºberdurchschnittliche Ergebnisse durch Synergieeffekte.`, 
                  example: `Manager: Empfiehlt Top-Mitarbeiter proaktiv f√ºr Stelle an anderem Standort, statt ihn zu 'horten'. | Leiter Buchhaltung: Hat zwei Nachfolger aufgebaut, einer bereits in anderer Abteilung erfolgreich. | HR-Leiter: Entwickelt Talente √ºber eigenen Bedarf hinaus f√ºr Gruppe, gilt als Talentschmiede. | CFO: F√ºhrungskultur im Bereich ist Vorbild, niedrigste Fluktuation in der Gruppe.` 
                }
              }
            },
            {
              id: "l2",
              title: "Strategisches Denken",
              category: "leadership",
              icon: Brain,
              definition: `Das 'gro√üe Ganze' sehen. Weg vom Silo-Denken hin zum Gruppen-Denken ('One Niederwieser').`,
              levels: {
                1: { 
                  text: `Die F√ºhrungskraft handelt fast ausschlie√ülich reaktiv und verliert sich im Mikromanagement des Tagesgesch√§fts (‚ÄûFirefighting‚Äú). Sie zeigt kein Interesse an der Unternehmensstrategie oder versteht sie nicht. Entscheidungen werden isoliert f√ºr die eigene Abteilung getroffen, oft sogar zum Nachteil anderer Bereiche oder der Gruppe (Suboptimierung). Sie plant Budget und Ressourcen nur f√ºr den momentanen Bedarf ohne Weitblick. Strategische Initiativen der Gesch√§ftsleitung werden ignoriert, bel√§chelt oder als ‚Äûst√∂rend‚Äú f√ºr den Betrieb empfunden. Das Team hat keine Orientierung, wohin die Reise langfristig geht.`, 
                  example: `Prod-Leiter: Produziert auf Halde f√ºr 100% Auslastung, obwohl Vertrieb das Produkt nicht verkauft. | Leiter Buchhaltung: Optimiert nur eigene KPIs, ignoriert Auswirkungen auf Cashflow der Gruppe. | HR-Leiter: Rekrutiert ohne Abstimmung mit Strategie, falsche Profile werden eingestellt. | Controlling: Liefert nur historische Zahlen, keine zukunftsgerichtete Analyse.` 
                },
                2: { 
                  text: `Die F√ºhrungskraft kennt die Unternehmensstrategie (Strategie 2035, Werte Fast Fair Personal) und erkl√§rt dem Team das ‚ÄûWarum" hinter Entscheidungen. Die Planung fokussiert auf das LAUFENDE GESCH√ÑFTSJAHR - ein Horizont von 12+ Monaten wird nur auf Anforderung der Gesch√§ftsleitung ber√ºcksichtigt. Sie SETZT strategische Vorgaben um; eigene strategische Impulse sind noch selten. Externe Trends werden wahrgenommen, aber noch nicht systematisch in die Bereichsplanung integriert. Der Unterschied zu Stufe 3: Setzt Strategie um, ENTWICKELT aber noch keine eigenen strategischen Initiativen.`, 
                  example: `Sales: Jahresplanung orientiert sich an Vorgaben der GL; eigene strategische Vorschl√§ge (z.B. neue Marktsegmente) kommen noch selten. | Produktion: Plant Kapazit√§t f√ºr laufendes Jahr solide; mittelfristige Investitionen werden erst auf Nachfrage der GL adressiert. | Unterschied zu Stufe 3: Stufe-3-FK bringt eigenst√§ndig strategische Vorschl√§ge ein und plant proaktiv √ºber das Gesch√§ftsjahr hinaus.` 
                },
                3: { 
                  text: `BASELINE: Die F√ºhrungskraft leitet die Ziele ihres Bereichs logisch aus der Unternehmensstrategie ab. Sie erkl√§rt ihrem Team das ‚ÄûWarum‚Äú hinter Entscheidungen und stellt sicher, dass alle an einem Strang ziehen. Sie ber√ºcksichtigt bei ihrer Planung (Budget, Personal, Kapazit√§t) einen Horizont von 12-18 Monaten. Sie erkennt relevante Trends im eigenen Fachbereich (z. B. Digitalisierung in der Admin, neue Technologien in der Produktion) und passt die Ausrichtung ihres Teams rechtzeitig an. Sie denkt √ºber Standortgrenzen hinweg und unterst√ºtzt die Harmonisierung der Gruppe (‚ÄûOne Niederwieser‚Äú), indem sie Standards einh√§lt und Kooperation f√∂rdert.`, 
                  example: `IT-Leiter: Plant Budget proaktiv f√ºr Harmonisierung der ERP-Systeme (Bozen/Sulzberg). | Leiter Buchhaltung: Richtet Reporting an Strategie 2035 aus, macht Fortschritt messbar. | HR-Leiter: Plant Personalentwicklung entlang der strategischen Kompetenzbedarfe. | Controlling: Entwickelt KPIs, die strategische Ziele operationalisieren.` 
                },
                4: { 
                  text: `Die F√ºhrungskraft erkennt Markt- oder interne Ver√§nderungen, bevor sie offensichtlich werden, und bereitet ihren Bereich proaktiv darauf vor. Sie entwickelt eigeninitiativ strategische Vorschl√§ge (z.B. neue Gesch√§ftsfelder, strukturelle Anpassungen), die √ºber das Tagesgesch√§ft hinausgehen. Sie sucht aktiv nach Synergien mit anderen Standorten (z.B. gemeinsame Nutzung von Ressourcen zwischen Sulzberg und Campogalliano) und bricht Silos auf. Sie denkt in Szenarien (‚ÄûWas w√§re, wenn...‚Äú) und hat Plan B in der Tasche. Sie wird von Peers als strategischer Sparringspartner gesch√§tzt.`, 
                  example: `Marketing: Schichtet Budget auf 'Solution-Kampagnen' um, bevor Markt dreht. | Leiter Buchhaltung: Antizipiert Auswirkungen neuer Steuergesetzgebung, bereitet Gruppe vor. | HR-Leiter: Erkennt Fachkr√§ftemangel fr√ºh, startet Employer-Branding-Initiative. | CFO: Identifiziert M&A-Ziel, das Technologiel√ºcke schlie√üt, bereitet Due Diligence vor.` 
                },
                5: { 
                  text: `Die F√ºhrungskraft entwickelt Konzepte, die das Gesch√§ftsmodell oder die Arbeitsweise der gesamten Gruppe nachhaltig ver√§ndern (z.B. Erschlie√üung eines neuen Marktes, Einf√ºhrung einer bahnbrechenden Technologie). Ihre Ideen flie√üen direkt in die Weiterentwicklung der Unternehmensstrategie ein. Sie erkennt disruptive Risiken oder Chancen sehr fr√ºh und steuert das Unternehmen durch mutige Entscheidungen in eine erfolgreiche Richtung. Sie gilt intern und extern als Vordenker (‚ÄûThought Leader‚Äú) und inspiriert nicht nur das eigene Team, sondern die ganze Organisation, gr√∂√üer zu denken.`, 
                  example: `Standortleiter: Erarbeitet Business Case f√ºr √úbernahme in Nische, erm√∂glicht Markteinstieg. | Leiter Buchhaltung: Entwickelt Shared-Service-Konzept f√ºr Finance-Funktionen aller Standorte. | HR-Leiter: Entwirft People-Strategie 2035, die GF √ºberzeugt und Vorstandsbeschluss wird. | CFO: Restrukturiert Finanzierung der Gruppe, senkt Kapitalkosten signifikant.` 
                }
              }
            },
            {
              id: "l3",
              title: "Entscheidungsf√§higkeit",
              category: "leadership",
              icon: Target,
              definition: `Zeitnah und verbindlich entscheiden, auch unter Unsicherheit. Balance zwischen Analyse und Speed.`,
              levels: {
                1: { 
                  text: `Die F√ºhrungskraft trifft Entscheidungen extrem z√∂gerlich oder gar nicht (‚ÄûAussitzen‚Äú). Dringende Themen bleiben liegen, wodurch Fristen verstreichen oder Chancen verloren gehen. Sie fordert f√ºr kleinste Entscheidungen immer wieder neue Daten an oder delegiert die Entscheidung an den Vorgesetzten (‚ÄûR√ºckdelegation‚Äú), um blo√ü keinen Fehler zu machen. Getroffene Entscheidungen werden bei leichtem Gegenwind sofort revidiert (‚ÄûFlip-Flopping‚Äú), was das Team verunsichert. Wenn eine Entscheidung falsch war, sucht sie die Schuld bei anderen oder den Umst√§nden, statt Verantwortung zu √ºbernehmen. Es fehlt der Mut zur Klarheit.`, 
                  example: `Einkauf: Entscheidet wochenlang nicht √ºber Preiserh√∂hung, Frist l√§uft ab, Konditionen verschlechtern sich. | Leiter Buchhaltung: Kann sich nicht f√ºr Buchungsmethode entscheiden, Jahresabschluss verz√∂gert sich. | HR-Leiter: Schiebt K√ºndigungsentscheidung bei Low-Performer monatelang auf. | Abteilungsleiter: Delegiert jede Entscheidung nach oben, Team wartet st√§ndig.` 
                },
                2: { 
                  text: `Die F√ºhrungskraft trifft Entscheidungen im Tagesgesch√§ft in angemessener Zeit und nutzt dabei verf√ºgbare Informationen und Daten. Bei komplexeren oder weitreichenden Entscheidungen holt sie sich Abstimmung mit Vorgesetzten oder Peers um Sicherheit zu gewinnen - ein verantwortungsvolles Vorgehen das die Qualit√§t der Entscheidung sichert. Sie kommuniziert Entscheidungen zunehmend mit Begr√ºndung an das Team. Auch bei schwierigen Themen schiebt sie Entscheidungen nicht endlos auf, sondern findet einen angemessenen Zeitpunkt. Die Entscheidungssicherheit - wann eigenst√§ndig entscheiden, wann abstimmen - w√§chst mit zunehmender Erfahrung. Sie steht zu getroffenen Entscheidungen und korrigiert bei neuen Erkenntnissen transparent.`, 
                  example: `Recruiting: Trifft Auswahlentscheidungen nach strukturierter Bewertung. Bei Grenzf√§llen holt sie eine zweite Meinung ein, was zu fundierten Entscheidungen f√ºhrt. | Leiter Buchhaltung: Entscheidet Routinethemen eigenst√§ndig und z√ºgig. Bei Grenzf√§llen holt sie Abstimmung mit dem CFO - ein angemessenes Vorgehen. | HR-Leiter: Trifft Entscheidungen und steht zu diesen. Bei berechtigter Kritik passt sie den Kurs transparent an. | Controlling: Gibt klare Empfehlungen auf Basis eigener Analysen. Bei strategisch relevanten Themen stimmt sie sich ab ohne Verantwortung abzugeben.` 
                },
                3: { 
                  text: `BASELINE: Die F√ºhrungskraft trifft Entscheidungen im Tagesgesch√§ft zeitnah und sicher. Sie w√§gt Chancen und Risiken vern√ºnftig ab und nutzt die vorhandenen Informationen effizient. Sie kommuniziert die Entscheidung und das ‚ÄûWarum‚Äú dahinter klar an ihr Team und betroffene Schnittstellen. Sie steht auch dann zu ihrer Entscheidung, wenn es Kritik gibt, ist aber bereit, den Kurs zu korrigieren, wenn neue Fakten auf den Tisch kommen (keine Sturheit). Sie unterscheidet sicher, was sie selbst entscheiden darf und was eskaliert werden muss ‚Äì und liefert bei Eskalationen eine klare Empfehlung mit.`, 
                  example: `Schichtleiter: Entscheidet nachts selbstst√§ndig Umplanung bei Maschinenausfall, informiert Planung. | Leiter Buchhaltung: Entscheidet eigenst√§ndig √ºber Zahlungspriorit√§ten bei Liquidit√§tsengpass. | HR-Leiter: Genehmigt dringende Einstellung ohne lange Abstimmungsschleifen. | Controlling: Gibt klare Empfehlung bei Investitionsentscheidung, steht dazu.` 
                },
                4: { 
                  text: `Die F√ºhrungskraft bleibt auch in un√ºbersichtlichen Situationen, unter Zeitdruck oder bei unvollst√§ndiger Informationslage handlungsf√§hig. Sie trifft mutige Entscheidungen (‚ÄûCourage‚Äú), um Stillstand zu vermeiden, und managt das Risiko aktiv. Sie bezieht relevante Stakeholder (z.B. andere Standorte) rechtzeitig ein, um die Qualit√§t der Entscheidung zu sichern, verliert sich aber nicht in endlosen Abstimmungsschleifen. Sie erkl√§rt auch unpopul√§re Entscheidungen so transparent und wertsch√§tzend (‚ÄûFair‚Äú), dass das Team sie mittragen kann.`, 
                  example: `Sales Dir: Lehnt unprofitablen Gro√üauftrag mutig ab, erkl√§rt Strategie 'Wert vor Volumen'. | Leiter Buchhaltung: Stoppt fragw√ºrdige Transaktion trotz Druck aus Fachabteilung (Compliance). | HR-Leiter: Trennt sich von toxischem High-Performer, obwohl kurzfristig schmerzhaft. | CFO: Entscheidet unter Unsicherheit f√ºr Investition, managed Risiken aktiv.` 
                },
                5: { 
                  text: `Die F√ºhrungskraft trifft wegweisende Entscheidungen, die positive Auswirkungen weit √ºber den eigenen Bereich hinaus haben (z.B. f√ºr die gesamte Gruppe). In Krisensituationen √ºbernimmt sie sofort das Steuer, schafft Ruhe und gibt durch klare Entscheidungen Sicherheit und Orientierung. Sie etabliert Prinzipien oder Rahmenbedingungen, die es ihren Mitarbeitenden erm√∂glichen, selbstst√§ndig bessere Entscheidungen zu treffen (‚ÄûEmpowerment‚Äú). Sie hat den Mut, alte Z√∂pfe abzuschneiden (z. B. unrentable Projekte oder Produkte zu stoppen), um Ressourcen f√ºr Neues freizumachen.`, 
                  example: `IT-Group: Kappt bei Cyber-Verdacht sofort alle Verbindungen der Gruppe, nimmt Prod-Ausfall in Kauf. | Leiter Buchhaltung: Stoppt in Krise alle nicht-kritischen Zahlungen, sichert Liquidit√§t der Gruppe. | HR-Leiter: Entscheidet in Krisensituation schnell √ºber Kurzarbeit, gibt Team Sicherheit. | CFO: Bricht gescheiterte √úbernahme ab trotz hoher Sunk Costs, sch√ºtzt Gruppe vor gr√∂√üerem Schaden.` 
                }
              }
            },
            {
              id: "l4",
              title: "Execution & Performance",
              category: "leadership",
              icon: TrendingUp,
              definition: `Ziele in Ergebnisse umsetzen. Daten nutzen ('Clarity'), Prozesse beherrschen und konsequent steuern.`,
              levels: {
                1: { 
                  text: `Die F√ºhrungskraft arbeitet ohne erkennbaren Plan oder Struktur. Projekte und Aufgaben werden begonnen, aber nicht konsequent zu Ende gef√ºhrt. Es gibt keine klaren Meilensteine oder Verantwortlichkeiten. Die Leistung des Teams wird nicht gemessen oder gesteuert; Abweichungen (z.B. Budget√ºberzug, Terminverzug) fallen erst auf, wenn es zu sp√§t ist. Ziele werden regelm√§√üig und deutlich verfehlt, ohne dass die F√ºhrungskraft gegensteuert oder die Ursachen analysiert. Es herrscht eine Kultur der Ausreden statt der Ergebnisse.`, 
                  example: `Projektleiter: Software-Rollout Monate √ºberf√§llig, kein neuer Plan, keine Info an User. | Leiter Buchhaltung: Jahresabschluss jedes Jahr zu sp√§t, keine Ursachenanalyse. | HR-Leiter: Recruiting-Prozess ohne Struktur, Time-to-Hire unbekannt. | Controlling: Reports kommen unzuverl√§ssig, Qualit√§t schwankt stark.` 
                },
                2: { 
                  text: `Die F√ºhrungskraft plant Projekte und Aufgaben strukturiert, definiert Meilensteine und Verantwortlichkeiten. Sie nutzt regelm√§√üige Statusmeetings (Jour Fixes, Team-Meetings) zur Steuerung und beh√§lt den √úberblick √ºber offene Aufgaben und Termine. Bei Abweichungen vom Plan leitet sie Gegenma√ünahmen ein - die noch fr√ºhere Erkennung von Engp√§ssen entwickelt sich mit zunehmender Erfahrung. Ziele werden erreicht, wobei in Hochphasen manchmal noch erh√∂hter Einsatz erforderlich ist. Sie kommuniziert den Status transparent an Vorgesetzte und Schnittstellen. Prozesse werden eingehalten; bei Bedarf werden Abweichungen begr√ºndet und dokumentiert.`, 
                  example: `Sales: Trackt die Zielerreichung regelm√§√üig in Teammeetings. Bei Abweichungen leitet sie Ma√ünahmen ein - manchmal k√∂nnte das noch fr√ºher im Monat erfolgen. | Leiter Buchhaltung: Steuert den Monatsabschluss nach klarem Kalender. In Hochphasen ist manchmal erh√∂hter Einsatz n√∂tig - arbeitet daran Spitzen besser zu verteilen. | HR-Leiter: F√ºhrt relevante KPIs (Time-to-Hire, Fluktuation) und nutzt sie zunehmend f√ºr die Steuerung. | Controlling: Liefert Zahlen p√ºnktlich und mit Kommentierung. Baut die Handlungsempfehlungen sukzessive aus.` 
                },
                3: { 
                  text: `BASELINE: Die F√ºhrungskraft plant Aufgaben und Projekte strukturiert mit realistischen Zeitpl√§nen und Ressourcen. Sie definiert klare Erfolgskriterien (KPIs) und √ºberpr√ºft den Fortschritt regelm√§√üig (z.B. in Jour Fixes). Bei Abweichungen greift sie zeitnah ein und leitet Korrekturma√ünahmen ein, um das Ziel noch zu erreichen. Sie sorgt daf√ºr, dass ihr Team die vereinbarten Ziele (Qualit√§t, Kosten, Zeit) verl√§sslich erf√ºllt. Sie kommuniziert den Status transparent an Vorgesetzte und Schnittstellen. Man kann sich auf ihre Zusagen verlassen (‚ÄûFair‚Äú).`, 
                  example: `Resp. Prod: Organisiert sofort Samstagsschicht bei Ausfall, informiert Vertrieb proaktiv. | Leiter Buchhaltung: Steuert Team nach klarem Closing-Kalender, Fristen werden eingehalten. | HR-Leiter: Trackt Recruiting-KPIs, greift bei Abweichungen ein. | Controlling: Liefert Reports p√ºnktlich mit Kommentierung und Empfehlungen.` 
                },
                4: { 
                  text: `Die F√ºhrungskraft verwaltet nicht nur, sondern optimiert aktiv. Sie nutzt Daten und Kennzahlen systematisch, um Ineffizienzen oder Bottlenecks aufzudecken, bevor sie zum Problem werden. Sie etabliert Routinen, die eine konstant hohe Performance sicherstellen. Sie liefert Ergebnisse oft schneller (‚ÄûFast‚Äú) oder kosteng√ºnstiger als geplant, ohne die Qualit√§t zu gef√§hrden. Sie schafft es, auch bei unvorhergesehenen Hindernissen (z.B. Krankheitswelle, Lieferausfall) den Betrieb stabil zu halten, weil sie Szenarien vorausgeplant hat.`, 
                  example: `HR: Analysiert Prozess, f√ºhrt digitales Tool ein, verk√ºrzt Time-to-Hire drastisch. | Leiter Buchhaltung: Automatisiert Mahnwesen, reduziert DSO (Days Sales Outstanding) um 20%. | HR-Leiter: Optimiert Onboarding-Prozess, neue MA sind 2 Wochen fr√ºher produktiv. | Controlling: Etabliert Self-Service-Reporting, entlastet Team f√ºr Analysen.` 
                },
                5: { 
                  text: `Die F√ºhrungskraft etabliert Best-Practice-Prozesse, die als Vorbild f√ºr die gesamte Gruppe dienen (z.B. ein neues Reporting-System, das sp√§ter in Sulzberg und Bozen ausgerollt wird). Sie treibt kontinuierliche Verbesserung (KVP) so voran, dass Performance-Spr√ºnge (z. B. signifikante Senkung der Ausschussquote oder Durchlaufzeit) erreicht werden. Sie schafft eine Hochleistungskultur, in der das Team sich selbstst√§ndig steuert und permanent √ºbertrifft. Sie realisiert strategische Gro√üprojekte in ‚ÄûTime, Budget & Quality‚Äú und liefert damit einen direkten Beitrag zum Unternehmenserfolg (‚Äû1 Result‚Äú).`, 
                  example: `Logistik: B√ºndelt Transporte Sulzberg/Bozen, senkt Kosten um 15% durch neues Cross-Docking. | Leiter Buchhaltung: F√ºhrt Fast-Close ein, Monatsabschluss in 3 statt 10 Tagen, Vorbild f√ºr Gruppe. | HR-Leiter: Implementiert People-Analytics, Fluktuation sinkt um 25%. | CFO: Etabliert gruppenweites Performance-Management, alle Bereiche √ºber Plan.` 
                }
              }
            },
            {
              id: "l5",
              title: "Stakeholder & Konfliktl√∂sung",
              category: "leadership",
              icon: Award,
              definition: `Beziehungen pflegen, politische Interessen moderieren. Br√ºckenbauer zwischen Silos.`,
              levels: {
                1: { 
                  text: `Die F√ºhrungskraft ignoriert die Interessen anderer Abteilungen oder Standorte komplett. Sie kommuniziert nicht mit wichtigen Stakeholdern, was zu √úberraschungen und Widerst√§nden f√ºhrt. In Konflikten verh√§lt sie sich destruktiv: Sie sucht Schuldige statt L√∂sungen, redet schlecht √ºber andere Bereiche (‚ÄûDie da oben/unten‚Äú) oder tr√§gt Konflikte aggressiv und unsachlich aus. Alternativ werden Konflikte ignoriert oder ausgesessen, bis sie eskalieren. Das Verhalten besch√§digt das Vertrauen und die Zusammenarbeit in der Gruppe massiv.`, 
                  example: `Prod-Leiter: Schimpft √ºber 'unf√§hige Verk√§ufer' statt Machbarkeit direkt zu kl√§ren. | Leiter Buchhaltung: Eskaliert jeden Konflikt mit Fachabteilungen an GF statt L√∂sung zu suchen. | HR-Leiter: Redet schlecht √ºber Betriebsrat, vergiftet Zusammenarbeit. | Controlling: Gibt anderen Abteilungen Schuld an Zahlen, statt gemeinsam Ursachen zu analysieren.` 
                },
                2: { 
                  text: `Die F√ºhrungskraft pflegt die DIREKTEN Schnittstellenbeziehungen (unmittelbare Peers, eigene F√ºhrungskraft) und informiert diese bei konkretem Anlass. Das Stakeholder-Netzwerk beschr√§nkt sich auf das operative Minimum; ein breiteres strategisches Netzwerk ist noch im Aufbau. Konflikte werden angesprochen, die L√∂sung erfolgt aber oft MIT UNTERST√úTZUNG (HR, eigene FK). Bei Interessenkonflikten tendiert sie manchmal zu Kompromissen, die das eigene Team bevorzugen. Der Unterschied zu Stufe 3: Pflegt DIREKTES Netzwerk, baut aber noch kein strategisches Stakeholder-Netzwerk auf.`, 
                  example: `Projektleiter: Informiert Betriebsrat bei Bedarf; Einbindung erfolgt manchmal erst sp√§t im Prozess. Bei Eskalationen: holt HR zur Unterst√ºtzung. | Abteilungsleiter: Netzwerk = direkte Peers und eigene FK. Kontakte zu anderen Standorten oder zur GL nur bei konkretem Anlass. | Unterschied zu Stufe 3: Stufe-3-FK pflegt aktiv ein breites Netzwerk (auch standort√ºbergreifend) und l√∂st Konflikte eigenst√§ndig.` 
                },
                3: { 
                  text: `BASELINE: Die F√ºhrungskraft kennt ihre wichtigsten Stakeholder und h√§lt sie regelm√§√üig informiert. Sie stimmt sich proaktiv ab, um Missverst√§ndnisse zu vermeiden. Sie begegnet Partnern ‚Äì egal ob intern oder extern ‚Äì respektvoll und auf Augenh√∂he. Konflikte werden zeitnah (‚ÄûFast‚Äú) angesprochen und sachlich diskutiert. Sie vertritt die Interessen ihres Bereichs, ist aber bereit, Argumente der Gegenseite zu h√∂ren und faire L√∂sungen zu finden. Sie sorgt daf√ºr, dass die Zusammenarbeit reibungslos funktioniert.`, 
                  example: `Service/Supply: Legt Zahlen offen, einigt sich sachlich auf Mindestbestand (Kompromiss). | Leiter Buchhaltung: Stimmt sich regelm√§√üig mit Fachabteilungen ab, Prozesse laufen reibungslos. | HR-Leiter: Pflegt konstruktive Beziehung zum Betriebsrat, BV werden einvernehmlich geschlossen. | Controlling: Bespricht kritische Entwicklungen bilateral vor, keine √úberraschungen im Meeting.` 
                },
                4: { 
                  text: `Die F√ºhrungskraft baut aktiv ein belastbares Netzwerk √ºber Abteilungsgrenzen hinweg auf. Sie antizipiert potenzielle Konflikte (z.B. Ressourcenengp√§sse zwischen Projekten) und moderiert diese pr√§ventiv, bevor sie eskalieren. Sie versteht die Zw√§nge und Ziele der anderen Seite und bietet L√∂sungen an, die beiden helfen (‚ÄûWin-Win‚Äú). Sie wird von anderen Abteilungen als verl√§sslicher Partner gesch√§tzt, der nicht nur fordert, sondern auch unterst√ºtzt. Sie kann auch schwierige Botschaften diplomatisch und wertsch√§tzend vermitteln.`, 
                  example: `Quality: Reist an Standorte, moderiert Workshop f√ºr gemeinsamen Standard. | Leiter Buchhaltung: Moderiert bei Konflikt zwischen Einkauf und Produktion zu Zahlungszielen. | HR-Leiter: Vermittelt bei Konflikt zwischen Abteilungen, findet Win-Win-L√∂sung. | CFO: Baut Br√ºcken zwischen deutschen und italienischen Teams, schafft Vertrauen.` 
                },
                5: { 
                  text: `Die F√ºhrungskraft l√∂st komplexe, verfahrene Konflikte (z. B. kulturelle Spannungen zwischen Standorten oder historische Grabenk√§mpfe), an denen andere gescheitert sind. Sie schafft es, unterschiedliche Interessen auf das gemeinsame strategische Ziel (‚ÄûOne Niederwieser‚Äú) auszurichten. Sie etabliert Gremien oder Formate, die den Austausch und das Stakeholder-Management strukturell verbessern. Sie genie√üt h√∂chstes Vertrauen bei der Gesch√§ftsf√ºhrung und den Belegschaftsvertretungen und nutzt dieses Kapital zum Wohle des Unternehmens. Sie macht aus Gegnern Partner.`, 
                  example: `Manager: L√∂st historische Grabenk√§mpfe zwischen Abteilungen, schafft echte Zusammenarbeit. | Leiter Buchhaltung: Etabliert Finance-Netzwerk aller Standorte, das als Vorbild f√ºr andere Funktionen gilt. | HR-Leiter: Wird bei schwierigen Restrukturierungen als Mediator zwischen GF und BR hinzugezogen. | CFO: Genie√üt h√∂chstes Vertrauen bei allen Stakeholdern, seine Vermittlung wird immer akzeptiert.` 
                }
              }
            }
          ],
          },
          it: {
            intro: {
              values: [
                { key: "Fast", desc: "Agiamo velocemente e orientati alla soluzione.", icon: Zap, color: "text-yellow-600" },
                { key: "Fair", desc: "Lavoriamo insieme con rispetto e alla pari.", icon: Scale, color: "text-blue-600" },
                { key: "Personal", desc: "Ci assumiamo la responsabilit√† e partecipiamo attivamente.", icon: Heart, color: "text-red-600" }
              ]
            },
            competencies: [
            {
              id: "c1",
              title: "Competenza tecnica & Applicazione",
              category: "core",
              icon: Briefcase,
              definition: `Valuta le conoscenze tecniche specifiche e la loro applicazione. Non si tratta solo di abilit√† teoriche, ma del contributo alla sicurezza dei processi e alla qualit√†.`,
              levels: {
                1: { 
                  text: `Il collaboratore non possiede le basi tecniche essenziali richieste per la posizione. I compiti vengono eseguiti frequentemente in modo errato o incompleto (es. inserimento dati errati, uso scorretto degli impianti, informazioni errate ai clienti), portando a rilavorazioni, reclami o rischi. Manca la comprensione degli standard tecnici e delle regole del proprio settore. Anche dopo la formazione o il feedback, si verificano ripetutamente gli stessi errori di contenuto. Il collaboratore mostra poca iniziativa nel colmare autonomamente queste lacune. I contesti complessi del proprio campo non vengono compresi; si fa affidamento sugli altri per verificare la correttezza tecnica.`, 
                  example: `Admin: Inserisce ripetutamente i dati anagrafici in modo errato, non comprende l'impatto sulle fatture. | Contabilit√†: Non comprende il sistema IVA, contabilizza ripetutamente in modo errato (22% invece di 10%), gli avvisi fiscali devono essere corretti. | HR: Non conosce i termini di preavviso, crea contratti di lavoro errati che devono essere corretti. | Acquisti: Non comprende gli Incoterms, ordina con condizioni di consegna sbagliate (DDP invece di EXW), causando costi imprevisti.` 
                },
                2: { 
                  text: `Il collaboratore padroneggia i processi standard e i compiti di routine nel suo campo, ma raggiunge rapidamente i limiti in caso di deviazioni, casi speciali o nuove esigenze. La conoscenza viene applicata pi√π secondo le "prescrizioni", senza comprendere il "perch√©" pi√π profondo o gli effetti sulle aree adiacenti. Per risolvere problemi tecnici si attende principalmente un'istruzione o si scala immediatamente, invece di utilizzare le risorse disponibili (documentazione, ricerca, guide di sistema). La qualit√† dei risultati √® altalenante, specialmente sotto stress. Le novit√† tecniche (es. nuove funzionalit√† software, richieste dei clienti modificate) vengono adottate con esitazione.`, 
                  example: `IT: Risolve problemi di password standard, ma √® subito sopraffatto da problemi di rete pi√π complessi e scala senza diagnosi. | Contabilit√†: Contabilizza operazioni standard correttamente, ma √® insicuro con registrazioni intercompany o valute estere. | HR: Crea referenze standard secondo modello, ma √® impotente in casi speciali (accordo di risoluzione). | Controlling: Crea report standard, ma non sa spiegare i numeri in modo approfondito.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore padroneggia con sicurezza la propria area e fornisce costantemente risultati di alta qualit√† (elaborazione ordini corretta, sistemi stabili, pezzi precisi). Lavora in completa autonomia nelle attivit√† quotidiane. Risolve rapidamente problemi tecnici da solo o richiede supporto mirato e tempestivo. √à in grado di trasmettere conoscenze ai colleghi situazionalmente (brevi istruzioni, suggerimenti troubleshooting) e contribuisce alla stabilit√† del team. Gli standard tecnici vengono rispettati costantemente.`, 
                  example: `Produzione: Opera l'impianto senza errori secondo specifica. | Contabilit√†: Esegue la chiusura mensile autonomamente e puntualmente, chiarisce le partite aperte di propria iniziativa. | HR: Gestisce i casi del personale dall'assunzione al termine in modo legalmente corretto e completo. | Acquisti: Negozia le condizioni secondo le linee guida, mantiene aggiornato l'anagrafica fornitori, scala tempestivamente in caso di carenze.` 
                },
                4: { 
                  text: `Il collaboratore comprende a fondo anche contesti tecnici complessi e riconosce interazioni che sfuggono ad altri (es. come una modifica nell'ordine influenza la pianificazione della produzione). Agisce preventivamente: rischi o fonti di errore vengono identificati ed eliminati prima che diventino un problema. La conoscenza tecnica viene utilizzata per ottimizzare attivamente i processi esistenti e renderli pi√π efficienti. I colleghi si rivolgono attivamente a questa persona per domande tecniche difficili ("Go-to-Person"). Il collaboratore trasmette proattivamente le conoscenze e garantisce un alto standard nel team. Guarda oltre la propria scrivania e comprende esattamente le esigenze dei partner di interfaccia interni.`, 
                  example: `Customer Service: Verifica proattivamente la fattibilit√† con il laboratorio su domande specifiche e propone alternative pi√π sicure. | Contabilit√†: Riconosce potenziali di ottimizzazione fiscale, propone ristrutturazione delle relazioni intercompany. | HR: Sviluppa nuova checklist di onboarding che riduce il tempo di inserimento del 30%. | Controlling: Costruisce dashboard che avvisa la direzione in anticipo sul calo dei margini.` 
                },
                5: { 
                  text: `Il collaboratore √® considerato un'autorit√† tecnica assoluta nel suo campo, la cui competenza √® apprezzata e richiesta anche tra le diverse sedi (Sulzberg/Bolzano/Campogalliano). Utilizza la sua eccellente conoscenza per ottenere miglioramenti significativi per il gruppo (es. introduzione di standard a livello di gruppo nel Customer Service, massiccio aumento dell'efficienza tramite nuove soluzioni IT). Questa persona funge da moltiplicatore. Elabora conoscenze complesse in modo che siano utilizzabili per l'organizzazione (es. corsi di formazione, linee guida best practice). Anticipa sviluppi futuri nel settore (es. trend di mercato, nuove tecnologie) e prepara l'azienda proattivamente. L'eccellenza tecnica diventa qui un valore aggiunto diretto per il successo aziendale.`, 
                  example: `Group Function: Sviluppa standard di servizio uniformi per tutte le sedi (DE/IT), forma i team. | Contabilit√†: Introduce reporting di gruppo secondo IFRS, √® apprezzato dal revisore come interlocutore. | HR: Sviluppa sistema di Performance Management per tutte le sedi, diventa esperto interno. | Controlling: Stabilisce Rolling Forecast, adottato dalla direzione come strumento di gestione.` 
                }
              }
            },
            {
              id: "c2",
              title: "Comunicazione & Collaborazione",
              category: "core",
              icon: MessageCircle,
              definition: `Qualit√† dello scambio di informazioni e della convivenza. 'One Niederwieser' significa: La collaborazione non finisce alla porta dell'ufficio o al confine nazionale.`,
              levels: {
                1: { 
                  text: `Il collaboratore trattiene informazioni critiche o le trasmette in modo incompleto, costringendo colleghi o clienti a chiedere chiarimenti e causando errori. Si isola e non mostra interesse per obiettivi comuni. In caso di problemi, scarica responsabilit√† ("Non √® mia competenza") o rifiuta supporto. La comunicazione √® caratterizzata da mentalit√† difensiva (battaglie in CC) anzich√© orientamento alla soluzione. I conflitti vengono ignorati, gestiti alle spalle o fatti escalare in modo non costruttivo. Il comportamento viola i valori fondamentali di rispetto e correttezza.`, 
                  example: `Produzione: Al cambio turno comunica solo "Tutto ok" nonostante guasto critico. | Contabilit√†: Non informa i colleghi su regole di contabilizzazione modificate, errori si accumulano. | HR: Non comunica dimissioni tempestivamente, piani di sostituzione falliscono. | Acquisti: Nasconde problemi con fornitori, produzione si ferma inaspettatamente.` 
                },
                2: { 
                  text: `Il collaboratore comunica principalmente in modo reattivo: le informazioni fluiscono solo su richiesta esplicita ("Dovere di informarsi" invece di "Dovere di informare"). Si concentra sulla propria area ignorando esigenze di reparti adiacenti o colleghi. In riunioni o progetti contribuisce raramente proattivamente. Il canale di comunicazione √® spesso inefficiente (es. lunghi scambi email su temi complessi invece di breve chiamata chiarificatrice ‚Äì contrariamente al principio "Phone before Email"). Il feedback viene preso personalmente o respinto difensivamente. La collaborazione funziona nella routine, ma diventa difficile con stress, incertezza o temi interfunzionali.`, 
                  example: `Backoffice: Scrive email avanti e indietro per giorni invece di chiarire telefonicamente. | Contabilit√†: Risponde alle richieste solo dopo giorni, blocca processi di approvazione. | HR: Informa su nuove direttive solo via email circolare senza spiegazioni. | Controlling: Fornisce numeri senza contesto, destinatari non capiscono il messaggio.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore informa colleghi e partner proattivamente, completamente e tempestivamente su tutto ci√≤ che √® rilevante (es. aggiornamenti stato, ritardi, assenze). Sceglie il canale pi√π efficiente situazionalmente (prende il telefono se le cose devono essere chiarite rapidamente). Il tono √® sempre rispettoso e alla pari, indipendentemente da gerarchia o sede. Offre supporto ai colleghi quando necessario e condivide volentieri conoscenze. Nelle riunioni √® presente, preparato e costruttivo. I conflitti vengono affrontati oggettivamente e direttamente. Contribuisce stabilmente a un'atmosfera lavorativa positiva e professionale.`, 
                  example: `Sales: In caso di ritardo consegna, informa subito cliente e agente con nuova data. | Contabilit√†: Annuncia scadenze chiusura mensile con anticipo, coordina interfacce. | HR: Comunica modifiche del diritto del lavoro in modo comprensibile a tutti i responsabili. | Assistenza: Tiene tutti informati su spostamenti di appuntamenti.` 
                },
                4: { 
                  text: `Il collaboratore non comunica solo informazioni, ma crea comprensione. Adatta la comunicazione in modo mirato all'interlocutore (es. traduce dettagli tecnici per i non addetti ai lavori, prepara dati per i decisori) e assicura che il messaggio arrivi correttamente. Agisce attivamente come legame tra i reparti e abbatte i silos. In caso di conflitti o malintesi nel team, assume un ruolo di mediazione e cerca una soluzione comune ("Win-Win"), invece di voler avere ragione. Fornisce feedback costruttivi e orientati allo sviluppo che aiutano gli altri a migliorare. La collaborazione con questa persona rende l'intero ambiente misurabilmente pi√π efficiente e motivato.`, 
                  example: `Interfaccia: Modera in caso di conflitto tra produzione e servizio, crea regolamentazione. | Contabilit√†: Spiega temi finance in modo che anche non-commerciali capiscano e possano decidere. | HR: Media in conflitto di team, trova soluzione accettata da entrambe le parti. | Controlling: Prepara numeri per direzione in modo che decisioni siano possibili direttamente.` 
                },
                5: { 
                  text: `Il collaboratore stabilisce nuovi standard di collaborazione che vanno oltre il proprio team (es. avvio di formati di scambio regolari tra le sedi di Sulzberg e Campogalliano o tra Sales e Tecnica). Vive i valori Fast, Fair, Personal in modo cos√¨ esemplare da fungere da modello e trascinare gli altri. Crea una rete di fiducia nell'intera azienda e la utilizza per risolvere problemi complessi e interfunzionali in modo rapido e non burocratico. Viene coinvolto come mentore o mediatore in situazioni comunicative difficili (es. processi di cambiamento, crisi). Si assicura attivamente che parliamo internamente ed esternamente "con una sola voce".`, 
                  example: `HR: Avvia Sounding Board inter-sede per differenze culturali Bolzano/Sulzberg. | Contabilit√†: Stabilisce Finance-Call mensile con tutte le sedi, crea trasparenza. | Assistenza: Introduce protocollo di comunicazione uniforme per area direzione. | Controlling: Crea standard di reporting che permette confrontabilit√† a livello di gruppo.` 
                }
              }
            },
            {
              id: "c3",
              title: "Competenza nel Problem Solving",
              category: "core",
              icon: ShieldAlert,
              definition: `Gestione degli ostacoli. Distinguiamo tra Troubleshooting (sintomi) e ricerca delle cause (radice).`,
              levels: {
                1: { 
                  text: `Il collaboratore riconosce i problemi spesso solo quando sono gi√† degenerati, o ignora segnali di avvertimento evidenti (es. messaggi di errore, reclami clienti, deviazioni di qualit√†). Non mostra iniziativa per la soluzione, ma attende passivamente istruzioni ("Lavoro secondo prescrizione"). Di fronte alle difficolt√† si arrende rapidamente o scarica la responsabilit√† su altri (colleghi, IT, fornitori). Gli errori vengono nascosti o minimizzati invece di parlarne apertamente. Non c'√® apprendimento dagli errori: lo stesso identico problema si verifica ancora e ancora senza che il comportamento venga modificato.`, 
                  example: `Admin: Chiude messaggio errore nell'ERP, a fine mese i numeri non tornano. | Contabilit√†: Ignora solleciti per settimane, fino a minaccia di recupero crediti. | HR: Non vede scadenza contratto a termine, dipendente lavora illegalmente. | Acquisti: Non nota deviazione prezzo, paga troppo per mesi.` 
                },
                2: { 
                  text: `Il collaboratore segnala i problemi ("Qui c'√® qualcosa che non va"), ma contribuisce poco alla soluzione. Si affida molto al responsabile o a colleghi esperti per trovare la via d'uscita dalla crisi. I tentativi di soluzione rimangono spesso in superficie: si combattono i sintomi (es. riavviare semplicemente la macchina, temporeggiare col cliente), ma non le cause reali. Appena sorge un primo ostacolo nella ricerca della soluzione, il processo si ferma. Necessita di istruzioni dettagliate per risolvere anche problemi standard. Manca la visione delle conseguenze: una "soluzione rapida" crea spesso nuovi problemi altrove.`, 
                  example: `Produzione: Riduce velocit√† macchina invece di cercare causa meccanica. | Contabilit√†: Registra differenza su conto transitorio invece di chiarire causa. | HR: Risolve sintomo (approvare straordinari) invece di affrontare causa (sottorganico). | Controlling: Corregge numeri manualmente invece di segnalare errore sistema.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore riconosce tempestivamente i problemi nel proprio ambito di competenza e li affronta autonomamente. Utilizza le informazioni disponibili (dati, manuali, storico) e gli strumenti per trovare soluzioni pragmatiche che funzionano. Distingue con sicurezza cosa pu√≤ risolvere da solo e quando √® necessaria un'escalation ‚Äì informando poi in modo preciso e orientato alla soluzione (arriva con una proposta, non solo con il lamento). Le soluzioni sono solide e sostenibili per il lavoro quotidiano. Rimane capace di agire anche in situazioni stressanti ("Sangue freddo"). Dopo un errore si assume la responsabilit√† ("Accountability") e corregge, invece di cercare scuse.`, 
                  example: `Customer Service: Localizza merce mancante, informa cliente onestamente, risolve conflitto. | Contabilit√†: Chiarisce partite aperte autonomamente con clienti, documenta soluzione. | HR: Trova soluzione pragmatica per conflitto ferie nel team. | Acquisti: Organizza alternativa velocemente in caso di mancata consegna, informa tutti i coinvolti.` 
                },
                4: { 
                  text: `Il collaboratore non risolve solo il problema acuto, ma conduce una ricerca sistematica delle cause (es. metodo "5-Why", analisi dati) per capire perch√© √® successo. Sviluppa misure che impediscono che l'errore si verifichi di nuovo (prevenzione errori). Pensa oltre il proprio ambito: se un problema riguarda le interfacce (es. passaggio Sales a Produzione), questo viene indirizzato e risolto attivamente. Supporta i colleghi in sfide difficili e apporta approcci creativi e non convenzionali quando le soluzioni standard non funzionano. I problemi vengono concepiti come opportunit√† di miglioramento.`, 
                  example: `Logistica: Analizza dati ritardi, adatta processo di ritiro permanentemente. | Contabilit√†: Analizza errori di registrazione ricorrenti, propone modifica processo che elimina fonte errore. | HR: Indaga alta fluttuazione in reparto, identifica problema di leadership, avvia misure. | Controlling: Trova causa calo margini, sviluppa concetto contromisure.` 
                },
                5: { 
                  text: `Il collaboratore identifica problemi complessi e strutturali o rischi che altri non hanno ancora notato e sviluppa concetti completi per risolverli. Le soluzioni hanno spesso un impatto positivo su pi√π reparti o sedi del gruppo (Sulzberg/Bolzano/Campogalliano). Stabilisce nuovi standard o "Best Practices" per la risoluzione dei problemi che vengono adottati in azienda. Trasforma i problemi in vere innovazioni o vantaggi competitivi per Niederwieser. Nelle crisi assume informalmente la guida ("Troubleshooter") e naviga il team con sicurezza attraverso terreni incerti.`, 
                  example: `Quality: Avvia Task-Force per difetti materiali tra sedi. | Contabilit√†: Scopre errore sistematico di fatturazione che costava 50k EUR/anno al gruppo, implementa controllo. | HR: Riconosce deficit strutturale di qualificazione, sviluppa programma formazione per tutte le sedi. | Controlling: Identifica driver di costo nascosti, risparmia 100k EUR/anno con modifica processo.` 
                }
              }
            },
            {
              id: "c4",
              title: "Adattabilit√† & Volont√† di apprendere",
              category: "core",
              icon: BookOpen,
              definition: `Volont√† di adattarsi a nuove condizioni quadro (IT, mercato, processi). 'Growth Mindset' invece di Status Quo.`,
              levels: {
                1: { 
                  text: `Il collaboratore reagisce alle novit√† (es. nuovo software, ristrutturazioni) con aperto rifiuto, cinismo o ostruzionismo. Si aggrappa rigidamente a metodi obsoleti ("Abbiamo sempre fatto cos√¨") e si rifiuta di apprendere nuove abilit√†. I cambiamenti portano a un massiccio calo delle prestazioni o a malumore che contagia il team. Necessita di una sproporzionata opera di convincimento e pressione per attuare anche i minimi adattamenti nel flusso di lavoro. Il feedback sullo sviluppo personale viene ignorato o valutato come un attacco.`, 
                  example: `Magazzino: Si rifiuta di usare nuovi scanner, tiene liste manuali private. | Contabilit√†: Blocca attivamente passaggio ERP, si lamenta rumorosamente di ogni cambiamento. | HR: Rifiuta categoricamente fascicolo personale digitale, insiste sulla carta. | Segreteria: Si rifiuta di imparare nuovo sistema prenotazioni, sabota introduzione.` 
                },
                2: { 
                  text: `Il collaboratore accetta i cambiamenti solo dopo lunga esitazione o mugugni. Aspetta di vedere se la novit√† "rimane davvero" prima di muoversi. L'apprendimento di nuovi compiti o sistemi dura molto pi√π a lungo rispetto a colleghi comparabili, poich√© manca la motivazione interna. Mostra poca iniziativa per l'aggiornamento; nuove conoscenze vengono acquisite solo se esplicitamente ordinate o "pre-digerite". In situazioni di stress o con nuove esigenze poco chiare, ricade rapidamente in vecchi modelli comportamentali inefficienti. L'adattabilit√† non √® sufficiente per fasi dinamiche.`, 
                  example: `Finance: Stampa email nonostante sistema paperless, impara nuovo processo lentamente. | Contabilit√†: Usa nuovo software solo controvoglia, torna subito al vecchio metodo in caso di problemi. | HR: Accetta nuova piattaforma recruiting solo dopo mesi e molto lavoro di convincimento. | Controlling: Crea report parallelamente nel vecchio e nuovo sistema, doppio lavoro.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore gestisce i cambiamenti in modo costruttivo e adatta il suo modo di lavorare alle nuove condizioni. Attua le nuove direttive (es. uso di un nuovo strumento, piano turni modificato) in modo affidabile e senza grandi lamentele. L'inserimento in nuovi temi avviene in tempi adeguati. Riconosce quando mancano conoscenze e utilizza i corsi offerti o gli ausili per colmare la lacuna. Non blocca le innovazioni, ma le supporta nel lavoro quotidiano. Ci si pu√≤ fidare che fornisca stabilmente la sua prestazione anche in un ambiente in evoluzione ("Fair" verso il team).`, 
                  example: `Sales: Partecipa a corso su film sostenibili e consiglia clienti con competenza dalla data stabilita. | Contabilit√†: Si forma su D365 Business Central, utilizza funzioni standard in modo affidabile. | HR: Implementa nuovi requisiti privacy (GDPR) entro le scadenze. | Assistenza: Assume nuovi compiti da ristrutturazione senza lamentarsi.` 
                },
                4: { 
                  text: `Il collaboratore vede i cambiamenti come opportunit√† di miglioramento. Non aspetta i corsi, ma acquisisce nuove conoscenze (es. su nuovi prodotti, trend di mercato o trucchi software) autonomamente. Sperimenta nuovi approcci risolutivi e condivide le scoperte con il team. Nelle fasi di transizione agisce in modo stabilizzante sugli altri e aiuta i colleghi che hanno pi√π difficolt√† con il cambiamento (es. come "Buddy" per nuovi sistemi). Mette in discussione lo status quo in modo costruttivo e fa proposte su come adattarsi meglio alle nuove esigenze.`, 
                  example: `Service: Esplora nuovo CRM prima del corso, aiuta poi colleghi all'avvio. | Contabilit√†: Testa attivamente nuove funzionalit√† ERP, d√† feedback costruttivo a IT, diventa Key-User. | HR: Prova strumenti AI per recruiting autonomamente, valuta utilit√† per team. | Controlling: Costruisce competenze Power BI autonomamente, crea primi dashboard di propria iniziativa.` 
                },
                5: { 
                  text: `Il collaboratore anticipa i cambiamenti necessari spesso prima degli altri e prepara s√© stesso e l'ambiente proattivamente (es. acquisizione di competenze future prima che servano acutamente). Spinge innovazioni che rendono l'azienda pronta per il futuro (es. pilotaggio di modalit√† di lavoro completamente nuove). Stabilisce una cultura dell'apprendimento nel proprio ambito, vivendo gli errori come opportunit√† di apprendimento e incoraggiando gli altri a provare ("Empowerment"). Agisce come faro in grandi progetti strategici (es. armonizzazione delle sedi) e crea entusiasmo per la nuova strada, anche in caso di resistenze iniziali.`, 
                  example: `IT: Avvia autonomamente progetto pilota AI (Copilot), chiarisce privacy, forma altre sedi. | Contabilit√†: Guida introduzione E-Invoicing per il gruppo, diventa esperto interno. | HR: Introduce sistema Performance Management che supporta cambiamento culturale. | Controlling: Implementa Predictive Analytics, rivoluziona forecasting per tutte le sedi.` 
                }
              }
            },
            {
              id: "c5",
              title: "Auto-organizzazione & Affidabilit√†",
              category: "core",
              icon: Clock,
              definition: `Strutturazione del lavoro, priorizzazione e Accountability. Ci si pu√≤ fidare della parola data?`,
              levels: {
                1: { 
                  text: `Il collaboratore lavora in modo asistematico e senza struttura riconoscibile. I compiti vengono dimenticati, le scadenze mancate senza preavviso o gli appuntamenti persi. Si lascia distrarre facilmente e perde il focus sull'essenziale. Il responsabile o i colleghi devono costantemente controllare ("Babysitting") affinch√© i risultati vengano consegnati. Manca la panoramica sui compiti aperti; le promesse vengono fatte con leggerezza e non mantenute. Il posto di lavoro (fisico o digitale) √® disorganizzato, cosicch√© documenti o informazioni importanti non sono a portata di mano. L'inaffidabilit√† pesa massicciamente sul team.`, 
                  example: `Sales: Dimentica rapporti visita, smarrisce fogli con richieste clienti. | Contabilit√†: Dimentica scadenze di pagamento, i solleciti si accumulano. I documenti spariscono nel caos cartaceo. | HR: Manca fine periodo di prova, dimentica trasformazioni contrattuali. Fascicoli del personale incompleti. | Segreteria: Appuntamenti assegnati doppiamente, email importanti senza risposta per giorni.` 
                },
                2: { 
                  text: `Il collaboratore sbriga compiti di routine semplici in modo affidabile, ma va rapidamente in difficolt√† con pi√π compiti paralleli o pressione temporale. Ha difficolt√† a distinguere l'importante dal non importante (fa es. ci√≤ che diverte prima, non ci√≤ che urge). La pianificazione avviene solo a brevissimo termine (giorno per giorno). Quando i tempi si stringono, non lo comunica tempestivamente, ma solo quando il danno √® gi√† fatto. La qualit√† del lavoro soffre per mancanza di cura o gestione del tempo. Necessita di guida regolare e promemoria dal responsabile per rimanere in rotta.`, 
                  example: `Officina: Riordina, anche se riparazione urgente blocca la produzione. | Contabilit√†: Svolge compiti standard, ma va in crisi con lo stress di bilancio, non comunica ritardi. | HR: Elabora candidature per ordine di arrivo invece che per urgenza, top candidato rinuncia. | Acquisti: Nessuna panoramica sugli ordini aperti, le date di consegna vengono controllate solo su richiesta.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore organizza autonomamente la giornata lavorativa e stabilisce priorit√† sensate per urgenza e importanza. Rispetta impegni e scadenze in modo affidabile. Se una scadenza √® a rischio, informa con almeno 48 ore di anticipo proattivamente ("Transparency"). Postazione e sistemi sono strutturati in modo che informazioni importanti siano reperibili in meno di 2 minuti (archiviazione ordinata, liste to-do curate). Si pu√≤ fare affidamento sulla sua parola.`, 
                  example: `Admin: Ha scadenziario digitale sotto controllo (priorit√† codificate per colore). Segnala marted√¨ che chiusura mensile arriver√† 2 giorni dopo per assenza malattia nel team ‚Äì propone contestualmente soluzione (supporto da altra sede).` 
                },
                4: { 
                  text: `Il collaboratore pianifica con anticipo (2-3 mesi) e riconosce colli di bottiglia prima che si verifichino (ferie, scadenze progetti, carenza risorse). Ottimizza attivamente il proprio metodo di lavoro (strumenti digitali, checklist, raggruppamento attivit√† simili). Rimane strutturato anche con carico di lavoro al 120% e consegna risultati puntuali. La sua affidabilit√† lo rende pilastro fisso del team ‚Äì i colleghi sanno: "Con X √® al sicuro."`, 
                  example: `Project Management: Prepara 4 settimane prima delle ferie dossier dettagliato con stato di tutti i progetti, punti aperti e referenti. Predispone attivit√† critiche (briefing di scorta, template decisionali precompilati). Il sostituto pu√≤ subentrare senza interruzioni.` 
                },
                5: { 
                  text: `Il collaboratore sviluppa sistemi organizzativi o flussi di lavoro che aiutano non solo lui/lei, ma l'intero team o reparto a lavorare pi√π efficientemente (es. introduzione di una Kanban-Board, standardizzazione dell'archiviazione per il gruppo). Gestisce pacchetti di compiti altamente complessi con molte dipendenze (es. progetti inter-sede) con sovranit√† e puntualit√†. √à considerato un "porto sicuro" per compiti critici: se se ne occupa lui/lei, il successo √® garantito. Crea spazi per temi strategici e innovazioni attraverso un'eccellente organizzazione.`, 
                  example: `Marketing: Stabilisce tool di pianificazione digitale per tutte le sedi (Sulzberg/BZ/Campo), elimina doppi lavori.` 
                }
              }
            },
            {
              id: "l1",
              title: "Gestione & Sviluppo dei collaboratori",
              category: "leadership",
              icon: Users,
              definition: `Guida, motivazione e sviluppo del team. 'Leadership' invece di solo 'Management'.`,
              levels: {
                1: { 
                  text: `Il manager trascura i suoi compiti principali: i colloqui con i collaboratori (colloquio annuale, check-in) non hanno luogo, sono estremamente in ritardo o vengono sbrigati come fastidioso dovere. Non c'√® feedback costruttivo; la critica avviene spesso in modo non oggettivo o davanti ad altri. I desideri di sviluppo dei collaboratori vengono ignorati o bloccati ("Non abbiamo tempo per questo"). Gli obiettivi vengono comunicati in modo poco chiaro o per nulla, portando a disorientamento. Il comportamento contraddice massicciamente i nostri valori (es. mancanza di rispetto, "Divide and Conquer"). Nel team regna un'atmosfera di paura o indifferenza, portando ad alto turnover o dimissioni interne.`, 
                  example: `Resp. Prod: Annulla colloquio annuale 3 volte, lo fa poi in 15min in piedi. | Resp. Contabilit√†: Non d√† mai feedback, team riceve critiche solo tramite terzi. | Resp. HR: Blocca richieste formazione per principio ('niente budget'), demotiva team. | Resp. Amministrazione: Micromanagement su ogni email, nessuna fiducia nel team.` 
                },
                2: { 
                  text: `Il manager sbriga i doveri amministrativi (approvazione ferie, colloqui formali), ma senza profondit√†. Il feedback c'√® per lo pi√π solo se qualcosa √® andato storto (reattivo), quasi nessuna lode o orientamento per il futuro. Il lavoro di leadership si limita all'assegnazione di compiti ("Micromanagement"), invece di delegare responsabilit√†. I piani di sviluppo (IDP) vengono s√¨ compilati, ma spariscono poi nel cassetto e non vengono seguiti. Il manager si prende troppo poco tempo per il team ("Porta chiusa"). Manca chiarezza e ispirazione; il team lavora "secondo prescrizione", ma non oltre.`, 
                  example: `Team Leader: Usa Copia-Incolla per obiettivi, risponde a desiderio sviluppo vago 'Vediamo'. | Resp. Contabilit√†: Fa colloqui per obbligo, ma senza vero interesse per sviluppo. | Resp. HR: Delega solo compiti di routine, tiene per s√© i progetti interessanti. | Team Leader Admin: Mai loda, raramente critica, team senza orientamento.` 
                },
                3: { 
                  text: `BASELINE: Il manager conduce tutti i colloqui obbligatori (Review, definizione obiettivi) puntualmente, ben preparato e alla pari. Assicura obiettivi e aspettative chiari, cosicch√© ognuno sappia cosa fare. Il feedback avviene regolarmente ed equamente ‚Äì sia positivo che correttivo. Supporta lo sviluppo professionale (es. approvazione corsi) ed √® disponibile per i collaboratori in caso di problemi. Vive i valori "Fast, Fair, Personal" nel quotidiano e garantisce un clima lavorativo stabile e positivo. Tratta tutti i membri del team equamente e senza discriminazioni.`, 
                  example: `Sales Director: Check-in regolari, loda successi, parla apertamente dei deficit. Team conosce obiettivi. | Resp. Contabilit√†: Discute learnings chiusura annuale nel team, pianifica miglioramenti insieme. | Resp. HR: Conduce colloqui sviluppo strutturati, promuove formazione attivamente. | Resp. Reparto: D√† feedback tempestivo e concreto, team sa dove sta.` 
                },
                4: { 
                  text: `Il manager usa la leadership attivamente per rendere i collaboratori migliori. Non delega solo compiti, ma responsabilit√†, per permettere la crescita ("Empowerment"). Conduce regolari colloqui di feedback informali (oltre il processo standard) e usa metodi di coaching per stimolare i collaboratori a trovare soluzioni proprie. Riconosce potenziali proattivamente e propone misure di sviluppo individuali (es. guida progetto, Job Rotation). Crea una cultura di team in cui gli errori vengono discussi apertamente per impararne. Il team si sente supportato e porta prestazioni misurabilmente pi√π alte grazie all'alta motivazione.`, 
                  example: `Resp. IT: Delega guida progetto a talento, d√† feedback specifico, rafforza autostima. | Resp. Contabilit√†: Trasferisce responsabilit√† bilancio a giovane talento, fa coaching se necessario. | Resp. HR: Lascia collaboratore guidare progetto recruiting autonomamente, d√† coaching invece di istruzioni. | Resp. Controlling: Sviluppa High-Potential sistematicamente tramite Job-Enrichment e Mentoring.` 
                },
                5: { 
                  text: `Il manager costruisce sistematicamente successori e sviluppa High-Potentials auch √ºber den eigenen Bedarf hinaus (per il gruppo). √à considerato un mentore nell'intera azienda, il cui consiglio √® cercato anche da collaboratori di altri settori. Crea un ambiente di eccellenza in cui i talenti possono svilupparsi e lega i top performer a lungo termine a Niederwieser. Gestisce la pianificazione del personale strategicamente in modo lungimirante (es. per i prossimi 2-3 anni) e assicura che il team sia pronto per le sfide future della Strategia 2035. Sotto la sua guida nascono innovazioni e risultati sopra la media grazie a effetti sinergici.`, 
                  example: `Manager: Raccomanda proattivamente Top-Mitarbeiter per posizione in altra sede. | Resp. Contabilit√†: Ha sviluppato due successori, uno gi√† di successo in altro reparto. | Resp. HR: Sviluppa talenti oltre il proprio fabbisogno per il gruppo, considerato fucina di talenti. | CFO: Cultura di leadership nell'area √® modello, fluttuazione pi√π bassa nel gruppo.` 
                }
              }
            },
            {
              id: "l2",
              title: "Pensiero strategico",
              category: "leadership",
              icon: Brain,
              definition: `Vedere il 'quadro generale'. Via dal pensiero a silos verso il pensiero di gruppo ('One Niederwieser').`,
              levels: {
                1: { 
                  text: `Il manager agisce quasi esclusivamente in modo reattivo e si perde nel micromanagement del quotidiano ("Firefighting"). Non mostra interesse per la strategia aziendale o non la comprende. Le decisioni vengono prese isolatamente per il proprio reparto, spesso addirittura a svantaggio di altri settori o del gruppo (Subottimizzazione). Pianifica budget e risorse solo per il fabbisogno momentaneo senza lungimiranza. Le iniziative strategiche della direzione vengono ignorate, derise o percepite come "disturbo" per l'operativit√†. Il team non ha orientamento su dove vada il viaggio a lungo termine.`, 
                  example: `Resp. Prod: Produce a magazzino per 100% utilizzo, anche se vendite non vendono il prodotto. | Resp. Contabilit√†: Ottimizza solo i propri KPI, ignora effetti su cashflow del gruppo. | Resp. HR: Recluta senza allineamento con strategia, profili sbagliati vengono assunti. | Controlling: Fornisce solo numeri storici, nessuna analisi orientata al futuro.` 
                },
                2: { 
                  text: `Il manager conosce le parole chiave della strategia (es. sostenibilit√†, crescita), ma non riesce a integrarle nel quotidiano del suo team. La strategia rimane teoria ("Slide sul muro"), mentre operativamente si lavora "come sempre". La pianificazione avviene per lo pi√π solo a breve termine (trimestre/anno). Le connessioni tra reparti o sedi vengono riconosciute solo se esplicitamente segnalate. Aspetta che la strategia venga data "dall'alto", invece di sviluppare proposte per il proprio ambito.`, 
                  example: `Sales: Conosce obiettivo sostenibilit√†, ma guida team ancora solo su quantit√†/fatturato. | Resp. Contabilit√†: Conosce strategia digitalizzazione, ma lavora ancora con liste Excel. | Resp. HR: Sente di Employer Branding, ma non lo implementa nel recruiting. | Controlling: Crea report standard, senza collegarli a obiettivi strategici.` 
                },
                3: { 
                  text: `BASELINE: Il manager deriva logicamente gli obiettivi del suo settore dalla strategia aziendale. Spiega al suo team il "Perch√©" dietro le decisioni e assicura che tutti tirino dalla stessa parte. Considera nella sua pianificazione (budget, personale, capacit√†) un orizzonte di 12-18 mesi. Riconosce trend rilevanti nel proprio ambito (es. digitalizzazione in amministrazione, nuove tecnologie in produzione) e adatta l'orientamento del suo team tempestivamente. Pensa oltre i confini della sede e supporta la harmonizzazione del gruppo ("One Niederwieser"), rispettando standard e promuovendo la cooperazione.`, 
                  example: `Resp. IT: Pianifica budget proattivamente per armonizzazione sistemi ERP (Bolzano/Sulzberg). | Resp. Contabilit√†: Allinea reporting a Strategia 2035, rende progresso misurabile. | Resp. HR: Pianifica sviluppo personale lungo i fabbisogni di competenze strategiche. | Controlling: Sviluppa KPI che operazionalizzano obiettivi strategici.` 
                },
                4: { 
                  text: `Il manager riconosce cambiamenti di mercato o interni prima che diventino ovvi e prepara il suo settore proattivamente. Sviluppa di propria iniziativa proposte strategiche (es. nuovi campi di business, adattamenti strutturali) che vanno oltre il quotidiano. Cerca attivamente sinergie con altre sedi (es. uso comune di risorse tra Sulzberg und Campogalliano) und rompe i silos. Pensa in scenari ("Cosa succederebbe se...") e ha un piano B in tasca. √à apprezzato dai pari come sparring partner strategico.`, 
                  example: `Marketing: Sposta budget su 'campagne soluzioni' prima che il mercato giri. | Resp. Contabilit√†: Anticipa effetti nuova legislazione fiscale, prepara il gruppo. | Resp. HR: Riconosce carenza manodopera specializzata presto, avvia iniziativa Employer Branding. | CFO: Identifica target M&A che chiude gap tecnologico, prepara Due Diligence.` 
                },
                5: { 
                  text: `Il manager sviluppa concetti che cambiano il modello di business o il modo di lavorare dell'intero gruppo in modo sostenibile (es. apertura di un nuovo mercato, introduzione di una tecnologia rivoluzionaria). Le sue idee fluiscono direttamente nello sviluppo della strategia aziendale. Riconosce rischi o opportunit√† distruttivi molto presto e guida l'azienda attraverso decisioni coraggiose in una direzione di successo. √à considerato internamente ed esternamente come precursore ("Thought Leader") e inspira non solo il proprio team, ma l'intera organizzazione a pensare pi√π in grande.`, 
                  example: `Resp. Sede: Elabora Business Case per acquisizione in nicchia, permette ingresso mercato. | Resp. Contabilit√†: Sviluppa concetto Shared-Service per funzioni Finance di tutte le sedi. | Resp. HR: Progetta People Strategy 2035 che convince direzione e diventa delibera CdA. | CFO: Ristruttura finanziamento del gruppo, riduce significativamente costo del capitale.` 
                }
              }
            },
            {
              id: "l3",
              title: "Capacit√† decisionale",
              category: "leadership",
              icon: Target,
              definition: `Decidere tempestivamente e in modo vincolante, anche nell'incertezza. Equilibrio tra analisi e velocit√†.`,
              levels: {
                1: { 
                  text: `Il manager prende decisioni con estrema esitazione o non le prende affatto ("Temporeggiare"). Temi urgenti rimangono fermi, facendo scadere termini o perdere opportunit√†. Richiede per le minime decisioni sempre nuovi dati o delega la decisione al superiore ("Delega di ritorno"), pur di non fare errori. Le decisioni prese vengono riviste immediatamente al minimo vento contrario ("Flip-Flopping"), cosa che disorienta il team. Se una decisione era sbagliata, cerca la colpa negli altri o nelle circostanze, invece di assumersi la responsabilit√†. Manca il coraggio della chiarezza.`, 
                  example: `Acquisti: Non decide per settimane su aumento prezzi, scadenza passa, condizioni peggiorano. | Resp. Contabilit√†: Non riesce a decidere metodo contabile, chiusura annuale si ritarda. | Resp. HR: Rinvia decisione licenziamento low performer per mesi. | Resp. Reparto: Delega ogni decisione verso l'alto, team aspetta costantemente.` 
                },
                2: { 
                  text: `Il manager decide spesso troppo tardi, cosicch√© il team rimane in posizione di attesa. Si affida troppo alla sensazione di pancia o a opinioni singole, invece di consultare fatti e dati disponibili ("Data driven"). Le decisioni vengono prese "nel chiuso della stanza" e presentate al team senza giustificazione. Decisioni difficili o impopolari (es. rifiuti a candidati, stop di progetti) vengono rimandate, nella speranza che il problema si risolva da solo. Il manager necessita di molta rassicurazione dall'alto per sentirsi sicuro.`, 
                  example: `Recruiting: Non riesce a decidere tra candidati, entrambi rinunciano. | Resp. Contabilit√†: Per domande standard chiede sempre rassicurazione al CFO. | Resp. HR: Rivede decisioni al primo vento contrario, team insicuro. | Controlling: Non si fida delle proprie analisi, scala ogni raccomandazione.` 
                },
                3: { 
                  text: `BASELINE: Il manager prende decisioni nel quotidiano tempestivamente e con sicurezza. Pesa opportunit√† e rischi ragionevolmente e utilizza le informazioni esistenti in modo efficiente. Comunica la decisione e il "Perch√©" dietro di essa chiaramente al suo team e alle interfacce interessate. Mantiene la sua decisione anche se c'√® critica, ma √® pronto a correggere la rotta se arrivano nuovi fatti sul tavolo (nessuna testardaggine). Distingue con sicurezza cosa pu√≤ decidere lui stesso e cosa deve essere scalato ‚Äì e fornisce in caso di escalation una chiara raccomandazione.`, 
                  example: `Capoturno: Decide di notte autonomamente riprogrammazione per guasto macchina, informa pianificazione. | Resp. Contabilit√†: Decide autonomamente priorit√† pagamenti in caso di tensione liquidit√†. | Resp. HR: Approva assunzione urgente senza lunghi giri di approvazione. | Controlling: D√† raccomandazione chiara per decisione investimento, la sostiene.` 
                },
                4: { 
                  text: `Il manager rimane capace di agire anche in situazioni confuse, sotto pressione temporale o con informazioni incomplete. Prende decisioni coraggiose ("Courage") per evitare lo stallo und gestisce il rischio attivamente. Coinvolge gli stakeholder rilevanti (es. altre sedi) tempestivamente per assicurare la qualit√† della decisione, ma non si perde in infiniti cicli di coordinamento. Spiega anche decisioni impopolari in modo cos√¨ trasparente und wertsch√§tzend ("Fair") che il team pu√≤ sostenerle.`, 
                  example: `Sales Dir: Rifiuta coraggiosamente grande ordine non profittevole, spiega strategia 'Valore prima di Volume'. | Resp. Contabilit√†: Ferma transazione discutibile nonostante pressione da reparto (Compliance). | Resp. HR: Si separa da High-Performer tossico, anche se doloroso a breve termine. | CFO: Decide in incertezza per investimento, gestisce rischi attivamente.` 
                },
                5: { 
                  text: `Il manager prende decisioni pionieristiche che hanno effetti positivi ben oltre il proprio ambito (es. per l'intero gruppo). In situazioni di crisi prende immediatamente il timone, crea calma und d√† sicurezza und orientamento tramite decisioni chiare. Stabilisce principi o condizioni quadro che permettono ai suoi collaboratori di prendere autonomamente decisioni migliori ("Empowerment"). Ha il coraggio di tagliare rami secchi (es. fermare progetti o prodotti non redditizi) per liberare risorse per il nuovo.`, 
                  example: `IT-Group: In caso di sospetto Cyber taglia subito tutte le connessioni del gruppo, accetta stop produzione. | Resp. Contabilit√†: In crisi ferma tutti i pagamenti non critici, assicura liquidit√† del gruppo. | Resp. HR: Decide rapidamente su cassa integrazione in situazione di crisi, d√† sicurezza al team. | CFO: Interrompe acquisizione fallita nonostante alti costi affondati, protegge gruppo da danni maggiori.` 
                }
              }
            },
            {
              id: "l4",
              title: "Execution & Performance",
              category: "leadership",
              icon: TrendingUp,
              definition: `Trasformare obiettivi in risultati. Usare i dati ('Clarity'), padroneggiare i processi e guidare coerentemente.`,
              levels: {
                1: { 
                  text: `Il manager lavora senza piano o struttura riconoscibile. Progetti e compiti vengono iniziati, ma non portati a termine coerentemente. Non ci sono chiare pietre miliari o responsabilit√†. La prestazione del team non viene misurata o controllata; deviazioni (es. sforamento budget, ritardo termini) si notano solo quando √® troppo tardi. Gli obiettivi vengono mancati regolarmente e chiaramente, ohne dass die F√ºhrungskraft gegensteuert oder die Ursachen analysiert. Es herrscht eine Kultur der Ausreden statt der Ergebnisse.`, 
                  example: `Projektleiter: Software-Rollout Monate √ºberf√§llig. Kein neuer Plan, keine Info an User.` 
                },
                2: { 
                  text: `Il manager si impegna, ma perde spesso il focus nel quotidiano. La pianificazione avviene in modo approssimativo ("Andr√† bene"), rischi o colli di bottiglia non vengono anticipati. Il controllo avviene sporadicamente (es. solo quando il capo chiede), non sistematicamente. Gli obiettivi vengono parzialmente raggiunti, ma spesso solo tramite frenetiche "azioni last-minute" (spegnere incendi) a spese della qualit√† o delle risorse dei collaboratori. Manca trasparenza su dove si trovi veramente il team. I processi non vengono rispettati o costantemente aggirati per forzare risultati a breve termine.`, 
                  example: `Sales: Nota mancato obiettivo solo il 25, fa pressione per deal a basso margine.` 
                },
                3: { 
                  text: `BASELINE: Il manager pianifica compiti e progetti in modo strutturato con tempistiche e risorse realistiche. Definisce chiari criteri di successo (KPI) e controlla il progresso regolarmente (es. in Jour Fixes). In caso di deviazioni interviene tempestivamente e avvia misure correttive per raggiungere ancora l'obiettivo. Assicura che il suo team soddisfi gli obiettivi concordati (Qualit√†, Costi, Tempo) in modo affidabile. Comunica lo stato in modo trasparente ai superiori e alle interfacce. Ci si pu√≤ fidare delle sue promesse ("Fair").`, 
                  example: `Resp. Prod: Organizza subito turno sabato in caso di guasto, informa Vendite proattivamente.` 
                },
                4: { 
                  text: `Il manager non solo amministra, ma ottimizza attivamente. Utilizza dati e indicatori sistematicamente per scoprire inefficienze o colli di bottiglia prima che diventino un problema. Stabilisce routine che assicurano una performance costantemente alta. Fornisce risultati spesso pi√π velocemente ("Fast") o in modo pi√π economico del previsto, senza mettere a rischio la qualit√†. Riesce a mantenere stabile l'operativit√† anche in caso di ostacoli imprevisti (es. ondata di malattia, mancata consegna), perch√© ha pianificato scenari in anticipo.`, 
                  example: `HR: Analizza processo, introduce tool digitale, accorcia 'Time-to-Hire' drasticamente.` 
                },
                5: { 
                  text: `Il manager stabilisce processi Best-Practice che servono da modello per l'intero gruppo (es. un nuovo sistema di reporting che viene poi implementato a Sulzberg e Bolzano). Spinge il miglioramento continuo (KVP) in modo tale da raggiungere salti di performance (es. significativa riduzione della quota scarti o tempo di attraversamento). Crea una cultura di alta prestazione in cui il team si autogestisce e si supera permanentemente. Realizza grandi progetti strategici in "Time, Budget & Quality" e fornisce cos√¨ un contributo diretto al successo aziendale ("1 Result").`, 
                  example: `Logistica: Raggruppa trasporti Sulzberg/Bolzano, riduce costi del 15% con nuovo Cross-Docking.` 
                }
              }
            },
            {
              id: "l5",
              title: "Stakeholder & Risoluzione dei conflitti",
              category: "leadership",
              icon: Award,
              definition: `Curare le relazioni, moderare interessi politici. Costruttore di ponti tra i silos.`,
              levels: {
                1: { 
                  text: `Il manager ignora completamente gli interessi di altri reparti o sedi. Non comunica con stakeholder importanti, portando a sorprese e resistenze. Nei conflitti si comporta in modo distruttivo: cerca colpevoli invece di soluzioni, parla male di altri settori ("Quelli lass√π/laggi√π") o porta avanti conflitti in modo aggressivo e non oggettivo. Alternativamente i conflitti vengono ignorati o attesi finch√© non degenerano. Il comportamento danneggia massicciamente la fiducia e la collaborazione nel gruppo.`, 
                  example: `Resp. Prod: Impreca su 'venditori incapaci' invece di chiarire fattibilit√† direttamente.` 
                },
                2: { 
                  text: `Il manager cura le relazioni solo quando ha acutamente bisogno di qualcosa (transazionale). Dimentica frequentemente di coinvolgere partner rilevanti (es. HR, IT, altre sedi) tempestivamente, ritardando i progetti. Riconosce gaffe politiche spesso troppo tardi. In caso di conflitti reagisce difensivamente o si ritira per "mantenere la pace", anche se sarebbe necessario un chiarimento. Le soluzioni sono spesso compromessi deboli che non soddisfano nessuno. Fa fatica ad assumere la prospettiva dell'interlocutore.`, 
                  example: `Project Leader: Dimentica di informare il consiglio di fabbrica. Ritira progetto offeso in caso di veto.` 
                },
                3: { 
                  text: `BASELINE: Il manager conosce i suoi stakeholder pi√π importanti e li tiene regolarmente informati. Si coordina proattivamente per evitare malintesi. Incontra i partner ‚Äì interni or esterni ‚Äì con rispetto e alla pari. I conflitti vengono affrontati tempestivamente ("Fast") und diskutiert oggettivamente. Rappresenta gli interessi del suo settore, ma √® pronto ad ascoltare argomenti della controparte e trovare soluzioni eque. Assicura che la collaborazione funzioni senza intoppi.`, 
                  example: `Service/Supply: Mostra numeri, concorda oggettivamente scorta minima (Compromesso).` 
                },
                4: { 
                  text: `Il manager costruisce attivamente una rete resiliente oltre i confini del reparto. Anticipa potenziali conflitti (es. colli di bottiglia risorse tra progetti) und moderiert diese pr√§ventiv, bevor sie eskalieren. Comprende i vincoli e gli obiettivi dell'altra parte e offre soluzioni che aiutano entrambi ("Win-Win"). √à apprezzato da altri reparti come partner affidabile che non solo chiede, ma supporta anche. Sa comunicare anche messaggi difficili in modo diplomatico e rispettoso.`, 
                  example: `Quality: Viaggia nelle sedi, modera workshop per standard comune.` 
                },
                5: { 
                  text: `Il manager risolve conflitti complessi e bloccati (es. tensioni culturali tra sedi o guerre di trincea storiche) dove altri hanno fallito. Riesce a orientare interessi diversi verso l'obiettivo strategico comune ("One Niederwieser"). Stabilisce comitati o formati che migliorano strutturalmente lo scambio e la gestione degli stakeholder. Gode della massima fiducia presso la direzione e le rappresentanze dei lavoratori e utilizza questo capitale per il bene dell'azienda. Trasforma avversari in partner.`, 
                  example: `Manager: Rompe vecchi silos, integra team ostili in un'unit√† di successo.` 
                }
              }
            }
          ]
          },
          en: {
            intro: {
              values: [
                { key: "Fast", desc: "We act quickly and solution-oriented.", icon: Zap, color: "text-yellow-600" },
                { key: "Fair", desc: "We work together respectfully and on equal footing.", icon: Scale, color: "text-blue-600" },
                { key: "Personal", desc: "We take responsibility and actively shape things.", icon: Heart, color: "text-red-600" }
              ]
            },
            competencies: [
            {
              id: "c1",
              title: "Technical Expertise & Application",
              category: "core",
              icon: Briefcase,
              definition: `Evaluates specific professional knowledge and its application. It's not just about theoretical ability, but the contribution to process safety and quality.`,
              levels: {
                1: { 
                  text: `The employee lacks the necessary knowledge to perform core tasks. Regular errors jeopardize quality or safety. Requires constant monitoring and correction. Does not independently recognize when to seek help, leading to hidden problems that later have expensive consequences. Instructions are often misunderstood or forgotten. Mistakes are repeated, learning curve remains flat.`, 
                  example: `Machine operator: Repeatedly sets wrong parameters despite standard procedure. | Accounting: Doesn't understand VAT system, repeatedly books incorrectly (standard vs reduced rate), tax notices must be corrected. | HR: Doesn't know notice periods, creates faulty employment contracts requiring correction. | Procurement: Doesn't understand Incoterms, orders with wrong delivery terms (DDP instead of EXW), causing unexpected costs.` 
                },
                2: { 
                  text: `The employee reliably handles standard tasks with established knowledge. When procedures deviate (new products, machine changes, special requests), insecurity arises and support is necessary. Recognizes own limits, but often too late. Learns slowly and needs time with new topics. Work can usually be used, but occasionally requires corrections.`, 
                  example: `Shift worker: Routine runs; struggles with new recipes. | Accounting: Books standard transactions correctly but uncertain with intercompany or foreign currency. | HR: Creates standard references from template, helpless with special cases (termination agreement). | Controlling: Creates standard reports but cannot explain figures in depth.` 
                },
                3: { 
                  text: `BASELINE: Solid and continuously current professional knowledge. Works independently and quality-consciously; delivers consistently reliable work. Proactively fills gaps and stays up-to-date in their field. Actively shares experience with colleagues and asks targeted questions when needed. Acts as a reliable element in daily operations. Contributes good ideas based on practical experience.`, 
                  example: `Maintenance: Identifies cause for repeat failure ‚Äì proposes preventive schedule. | Accounting: Performs month-end close independently and on time, proactively clarifies open items. | HR: Handles personnel cases from hiring to exit legally correct and complete. | Procurement: Negotiates terms within guidelines, keeps supplier master data current, escalates shortages timely.` 
                },
                4: { 
                  text: `Deep specialist knowledge that goes beyond the role. Understands complex connections and draws preventive conclusions. Is frequently consulted by colleagues for support and is considered a mentor. Can translate new technical requirements (e.g., new materials, certifications) quickly into practice. Thinks in processes, not isolated tasks.`, 
                  example: `Quality: Anticipates customer objection before audit by initiating corrective action proactively. | Accounting: Identifies tax optimization potential, proposes restructuring of intercompany relationships. | HR: Develops new onboarding checklist reducing induction time by 30%. | Controlling: Builds dashboard alerting management early to margin decline.` 
                },
                5: { 
                  text: `Recognized across departments as expert and reference. Initiates and leads training measures; develops internal standards. Represents the company externally as technical authority (customer discussions, certifications, trade fairs). Drives innovations and improvements that demonstrably strengthen competitiveness or quality. Shapes the specialized knowledge of the entire area.`, 
                  example: `Process Engineer: Develops recognized procedure for complex laminate; trains colleagues at all locations. | Accounting: Introduces group-wide IFRS reporting, valued by auditors as key contact. | HR: Develops Performance Management System for all locations, becomes internal expert. | Controlling: Establishes Rolling Forecast adopted by management as steering instrument.` 
                }
              }
            },
            {
              id: "c2",
              title: "Communication & Collaboration",
              category: "core",
              icon: MessageCircle,
              definition: `Covers information sharing, knowledge exchange, feedback culture, and cross-departmental cooperation. Essential for breaking down silos.`,
              levels: {
                1: { 
                  text: `Actively refuses to share information or works in a "protective mentality." Colleagues are surprised by important developments because the person didn't inform them. In team situations, an oppressive or dismissive atmosphere arises. Uses language that excludes or attacks others. Ignores requests or gives delayed, incomplete answers. Own performance is prioritized while team needs are neglected.`, 
                  example: `Production: Conceals machine problems, causes delays downstream. | Accounting: Doesn't inform colleagues about changed booking rules, errors accumulate. | HR: Doesn't communicate resignations timely, replacement plans fail. | Procurement: Hides supplier problems, production stops unexpectedly.` 
                },
                2: { 
                  text: `Passes information only upon request or sporadically. Occasionally forgets to inform relevant parties. Uses inefficient channels (e.g., informal instead of written), leading to misunderstandings. May become defensive when receiving feedback or dismisses criticism as personal attacks. Team cooperation depends heavily on mood or is perceived as extra effort.`, 
                  example: `Shift worker: Forgot shift handover entry. | Accounting: Responds to inquiries only after days, blocks approval processes. | HR: Informs about new policies only via circular email without explanation. | Controlling: Delivers numbers without context, recipients don't understand message.` 
                },
                3: { 
                  text: `BASELINE: Proactively informs all relevant people ‚Äì timely, in appropriate form. Gives and receives constructive feedback respectfully. Actively shares knowledge within the team. Uses existing channels (meetings, ticket systems, emails) reliably. Contributes actively in team situations and takes colleagues' perspectives into account. Cooperates appreciatively and smoothly within and outside own team.`, 
                  example: `Maintenance: Emails shift leaders after repair, logs action. | Accounting: Announces month-end deadlines early, coordinates interfaces. | HR: Communicates labor law changes understandably to all managers. | Assistant: Keeps everyone informed about schedule changes.` 
                },
                4: { 
                  text: `Creates understanding across departments and roles: explains backgrounds, invites dialogue, asks for input. Recognizes silos and actively works to break them down. Builds bridges in conflicts and finds constructive solutions. Is a valued sparring partner for ideas. Promotes transparent culture by sharing information broadly and voluntarily.`, 
                  example: `Team Lead: Organizes weekly cross-department briefing. | Accounting: Explains finance topics so non-accountants understand and can decide. | HR: Mediates in team conflict, finds solution both sides accept. | Controlling: Prepares numbers for management enabling direct decisions.` 
                },
                5: { 
                  text: `Establishes new standards for collaboration (processes, tools, meetings) that are adopted by other teams. Recognized mediator for complex interpersonal tensions. Builds a network of trust across all locations. Maintains a feedback culture that promotes continuous improvement and strengthens trust. Represents "Fast, Fair, Personal" in every interaction.`, 
                  example: `Manager: Introduces cross-location video standup. | Accounting: Establishes monthly Finance Call with all locations, creates transparency. | Assistant: Introduces uniform communication protocol for executive area. | Controlling: Creates reporting standard enabling group-wide comparability.` 
                }
              }
            },
            {
              id: "c3",
              title: "Problem-Solving Skills",
              category: "core",
              icon: Lightbulb,
              definition: `Systematic analysis of problems, development of sustainable solutions, and self-responsible action. No passing the buck.`,
              levels: {
                1: { 
                  text: `The employee blocks at the first hurdle. Complains about problems but shows no initiative to solve them. Either does nothing or escalates everything immediately without own contribution. Reacts passively-aggressively when asked to contribute to solutions. Work remains unfinished. At best, fixes symptoms but not root causes. Appears overwhelmed by even minor changes or obstacles.`, 
                  example: `Production: Stops work, waits hours instead of seeking solution. | Accounting: Ignores reminders for weeks until collection agency threatens. | HR: Overlooks fixed-term contract end, employee works illegally. | Procurement: Doesn't notice price deviation, pays too much for months.` 
                },
                2: { 
                  text: `Addresses only symptoms, not root causes ‚Äì problems recur. Escalates too early without own solution attempts or too late so that the situation worsens. Applies known patterns schematically even when inadequate. Does not transfer solutions to other contexts. Requires guidance to analyze situations. Ideas remain superficial.`, 
                  example: `Operator: Replaces same part repeatedly, fails to recognize underlying defect. | Accounting: Books difference to clearing account instead of clarifying cause. | HR: Fixes symptom (approve overtime) instead of addressing cause (understaffing). | Controlling: Corrects numbers manually instead of reporting system error.` 
                },
                3: { 
                  text: `BASELINE: Analyzes problems structurally, identifies causes. Develops independent, pragmatic solutions within own area. Uses existing escalation paths when necessary, but not prematurely. Documents problems and solutions so they remain traceable. Distinguishes urgent from important and acts accordingly. Accepts responsibility for failures and works on their improvement.`, 
                  example: `Shift Lead: Reduces setup time through structured analysis. | Accounting: Clarifies open items independently with customers, documents solution. | HR: Finds pragmatic solution for vacation conflict in team. | Procurement: Quickly organizes alternative for delivery failure, informs all affected.` 
                },
                4: { 
                  text: `Recognizes patterns across cases and derives improvements that go beyond a single incident. Develops alternative solutions and weighs them against each other. Leads team-wide problem analyses (root cause analysis, retrospectives). Makes complex technical or organizational problems understandable. Provides impulses for process optimization.`, 
                  example: `Quality: Leads 5-Why workshop, closes systematic complaints. | Accounting: Analyzes recurring booking errors, proposes process change eliminating error source. | HR: Investigates high turnover in department, identifies leadership problem, initiates measures. | Controlling: Finds cause of margin decline, develops countermeasure concept.` 
                },
                5: { 
                  text: `Solves strategically relevant problems (e.g., cross-location process, major customer complaints, investment decisions). Acts as a role model in crisis situations: remains calm, establishes structure, leads others out of chaos. Recognizes systemic weaknesses that others overlook and initiates structural changes that contribute to sustainable development.`, 
                  example: `Ops Manager: Leads turnaround in failing project, becomes mentor. | Accounting: Uncovers systematic billing error costing group 50k EUR/year, implements control. | HR: Recognizes structural qualification deficit, develops training program for all locations. | Controlling: Identifies hidden cost drivers, saves 100k EUR/year through process change.` 
                }
              }
            },
            {
              id: "c4",
              title: "Adaptability",
              category: "core",
              icon: Brain,
              definition: `Willingness to embrace new processes, technologies, responsibilities. Openness to feedback and personal development.`,
              levels: {
                1: { 
                  text: `Actively resists changes or new processes. Expresses openly negative attitudes: "That's how we've always done it." Shows no interest in own development, ignores training offerings. Stays in comfort zone and avoids learning experiences. Refuses to transfer tasks and behaves in a way that makes change more difficult.`, 
                  example: `Veteran: Refuses to learn new software, blocks colleagues. | Accounting: Actively blocks ERP transition, complains loudly about every change. | HR: Categorically rejects digital personnel file, insists on paper. | Office: Refuses to learn new booking system, sabotages introduction.` 
                },
                2: { 
                  text: `Goes along with changes only under pressure and often half-heartedly. New knowledge is learned slowly; interest in further development is low. Uses training but shows little initiative for independent learning. Sometimes passive when priorities shift. Waits for instructions instead of adapting proactively.`, 
                  example: `Technician: Uses new tool only when forced, needs repeated reminders. | Accounting: Uses new software reluctantly, reverts to old method at first problem. | HR: Accepts new recruiting platform only after months of persuasion. | Controlling: Creates reports in parallel in old and new system, double work.` 
                },
                3: { 
                  text: `BASELINE: Is curious about new topics and approaches. Reflects on own work style and accepts constructive criticism. Responds flexibly to priority changes and adapts without loss of motivation. Uses offered training and implements what was learned. Contributes to continuous improvement, such as suggestions that make daily work easier.`, 
                  example: `Warehouse: Proposes new labeling after logistics training. | Accounting: Trains on D365 Business Central, uses standard functions reliably. | HR: Implements new privacy requirements (GDPR) on schedule. | Assistant: Takes on new tasks from restructuring without complaint.` 
                },
                4: { 
                  text: `Actively seeks new knowledge, recognizes trends, and brings them to the team. Acts as a catalyst for change: convinces skeptics and supports implementation. Creates learning opportunities for self and others. Adapts quickly to fundamental changes without drop in motivation.`, 
                  example: `Team Lead: Introduces new production method from trade fair. | Accounting: Actively tests new ERP features, gives constructive IT feedback, becomes Key-User. | HR: Tries AI recruiting tools independently, evaluates usefulness for team. | Controlling: Builds Power BI skills independently, creates first dashboards on own initiative.` 
                },
                5: { 
                  text: `Anticipates future trends or challenges and prepares the organization. Builds structures that increase adaptability (cross-training, modular processes). Shapes cultural change by embodying openness and learning orientation. Inspires others to embrace change.`, 
                  example: `Plant Manager: Initiates Transformation Workshop, equips plant for Industry 4.0. | Accounting: Drives E-Invoicing introduction for group, becomes internal expert. | HR: Introduces Performance Management System supporting cultural change. | Controlling: Implements Predictive Analytics, revolutionizes forecasting for all locations.` 
                }
              }
            },
            {
              id: "c5",
              title: "Self-Organization",
              category: "core",
              icon: Clock,
              definition: `Time management, prioritization, reliability, resource management. Ensures personal contribution is plannable and predictable.`,
              levels: {
                1: { 
                  text: `Is chaotic: deadlines are frequently missed, tasks are forgotten or handled only partially. Work can hardly be planned for others. No visible priorities ‚Äì works on random items. Commits to things but doesn't keep commitments, causing domino effects. Meetings and work start late, materials are not found.`, 
                  example: `Admin: Forgot important deadline ‚Äì customer loses order. | Accounting: Forgets payment deadlines, reminders pile up. Documents disappear in paper chaos. | HR: Misses probation period ends, forgets contract conversions. Personnel files incomplete. | Office: Appointments double-booked, important emails unanswered for days.` 
                },
                2: { 
                  text: `Requires external structure and guidance to stay organized. Works reasonably well with clear instructions but has difficulties managing own time when given more autonomy. Re-prioritizes only when pointed out. Occasionally shows reactivity in case of overload but no forward-looking capacity management.`, 
                  example: `Assistant: Needs reminders for recurring tasks; forgets follow-ups. | Accounting: Handles standard tasks but struggles under year-end stress, doesn't communicate delays. | HR: Processes applications by arrival order instead of urgency, top candidate withdraws. | Procurement: No overview of open orders, delivery dates checked only when asked.` 
                },
                3: { 
                  text: `BASELINE: Plans work reliably, keeps appointments and deadlines. Prioritizes sensibly and identifies time-critical tasks. Keeps commitments and communicates early when obstacles arise. Works with clear focus and avoids unnecessary distractions. Has a transparent overview of current projects and contributes personal share to team success.`, 
                  example: `Controller: Prepares monthly closing on time, communicates bottleneck proactively.` 
                },
                4: { 
                  text: `Plans ahead, anticipates bottlenecks, and reserves buffers. Relieves others by taking over coordination tasks. Continuously optimizes own ways of working (tools, routines) and shares improvements. Can successfully manage multiple work streams simultaneously without loss of quality.`, 
                  example: `Planner: Synchronizes three parallel projects, avoids bottleneck through early resource coordination.` 
                },
                5: { 
                  text: `Coordinates complex projects across departments or locations and brings them to a successful conclusion on schedule. Establishes standards for self-organization that others adopt (templates, checklists, work principles). Is trusted for particularly complex or ambiguous tasks. Acts as role model for organized and structured work.`, 
                  example: `Project Lead: Coordinates major investment across all locations, delivers on time and under budget.` 
                }
              }
            },
            {
              id: "l1",
              title: "Employee Management & Development",
              category: "leadership",
              icon: Users,
              definition: `Leadership through development ‚Äì motivation, coaching, feedback, personnel development in the team.`,
              levels: {
                1: { 
                  text: `The manager shows no interest in the professional or personal development of their team. Team discussions are avoided or only superficial; annual conversations (if held at all) are formalistic and without value. There's constant micromanagement, creating a climate of distrust and leading to high turnover. High performers leave. Conflicts in the team are ignored or made worse. No succession planning or talent development visible.`, 
                  example: `Shift Lead: Criticizes only, never praises. Demotivates team, increases sick leave.` 
                },
                2: { 
                  text: `The manager holds mandatory conversations but avoids clear, uncomfortable feedback ("uncomfortable conversations"). High performers are insufficiently challenged, low performers not addressed. Development is left to HR or chance. The manager tends to reward loyalty or personal sympathy rather than performance. Team dynamics are hardly shaped, impulses for development are lacking. Little structured follow-up on coaching discussions.`, 
                  example: `Team Lead: Holds annual reviews superficially; forgets development agreements.` 
                },
                3: { 
                  text: `BASELINE: Regular, prepared team discussions with specific feedback (strengths, development areas). Coaching approach: promotes independent solutions instead of just prescribing. Addresses performance differences early and follows up on agreements. Delegates consciously, transfers responsibility for development. Interested in individual career aspirations and promotes appropriate measures (training, projects, mentoring).`, 
                  example: `Manager: Implements monthly feedback loops, prepares successors targeted.` 
                },
                4: { 
                  text: `The manager has a strategic development plan for their team: knows potentials, identifies and develops high performers, supports lateral moves for stagnating employees. Holds difficult conversations (low performance, conflicts) with clear outcome. Creates a learning environment where mistakes are allowed. Attracts and retains talents. Engages personally in mentoring and is valued for it.`, 
                  example: `Department Head: Promotes talent visibly, makes own team diverse and resilient.` 
                },
                5: { 
                  text: `Creates a sustainable leadership culture: the manager develops successors who themselves become excellent leaders. Exports best practices for people development to other locations. Has an outstanding record for talent retention and employee satisfaction. Is internally and externally known as employer of choice advocate. Leaves behind a sustainably strong team.`, 
                  example: `Director: Builds talent factory ‚Äì team members develop into successful leaders.` 
                }
              }
            },
            {
              id: "l2",
              title: "Strategic Thinking",
              category: "leadership",
              icon: TrendingUp,
              definition: `Thinking ahead: understands competitive environment, develops foresight, initiates strategically.`,
              levels: {
                1: { 
                  text: `The manager is trapped in tunnel vision. Works purely reactively, always on the next acute fire without understanding context. Strategic topics (strategy 2035, market changes, competitive position) are ignored or not even understood. Sees neither risks nor opportunities at the horizon. Decisions are short-term and not aligned with the bigger picture. Doesn't communicate company goals to the team.`, 
                  example: `Manager: Focuses only on delivery pressure; ignores changing customer requirements.` 
                },
                2: { 
                  text: `The manager understands strategic guidelines but hardly translates them into own area. Operational day-to-day dominates thinking. Rarely links decisions to the strategic context or larger goals. Reacts to external changes (customer requirements, market shifts) only with delay. Rarely brings own ideas for strategic improvement.`, 
                  example: `Sales Lead: Focuses on ongoing business; misses emerging product trend.` 
                },
                3: { 
                  text: `BASELINE: The manager translates company strategy into tangible goals for their team. Shows connections to the bigger picture. Recognizes strategic developments (e.g., sustainability, automation) and aligns own planning accordingly. Actively informs themselves about customer, market, and industry trends. Makes strategic statements comprehensible for the team.`, 
                  example: `Production: Aligns shift planning to known plant strategy, takes capacity reserves.` 
                },
                4: { 
                  text: `The manager anticipates developments (technology, customer, competitive situation) and proactively builds competencies or capacities. Challenges the status quo ("What if...?") and brings substantiated proposals for improvement or innovation. Thinks in scenarios and prepares alternatives. Continuously brings external impulses (trade fairs, networks, publications) into the team.`, 
                  example: `Operations: Initiates automation pilot before cost pressure occurs.` 
                },
                5: { 
                  text: `The manager shapes strategic direction for their area or beyond ‚Äì develops new business models, negotiates partnerships, or leads M&A projects. Is involved in strategic decision-making of the group. Has a broad overview of the competitive situation and contributes recognized impulses. Is a thought leader who influences direction inside and outside the organization.`, 
                  example: `Division Lead: Develops new service offering, opens new revenue stream.` 
                }
              }
            },
            {
              id: "l3",
              title: "Decision-Making",
              category: "leadership",
              icon: ShieldAlert,
              definition: `Deciding under uncertainty, courage for risky decisions, transparency about what and why.`,
              levels: {
                1: { 
                  text: `The manager chronically avoids decisions. Every somewhat significant question is escalated upward. Employees remain in limbo, initiative is blocked. If decisions are made, they are reversed at the smallest resistance. Taking responsibility is refused; in case of failures, blame is shifted to others. Decisions are not communicated transparently ‚Äì the team doesn't know what applies and why.`, 
                  example: `Manager: Keeps everything in limbo, escalates everything. Team frustrated.` 
                },
                2: { 
                  text: `The manager makes decisions when information situation is almost perfect, but hesitates when data are ambiguous. Avoids politically sensitive decisions. Sticks too long to wrong decisions because of loss aversion or not to appear inconsistent. Doesn't always communicate decisions clearly or justifies them insufficiently. Risk considerations are superficial.`, 
                  example: `Team Lead: Holds back project budget until last minute; misses deadline.` 
                },
                3: { 
                  text: `BASELINE: The manager makes decisions within their mandate in a timely and transparent manner. Weighs risks and opportunities, documents considerations, and stands by results. Communicates decisions clearly ‚Äì everyone knows what applies and why. Accepts that some decisions turn out wrong and draws learnings from this.`, 
                  example: `Shift Lead: Decides on overtime with clear reasoning, stands by when questioned.` 
                },
                4: { 
                  text: `The manager makes uncomfortable decisions (layoffs, reprioritization, investment stop) when necessary, even if these are unpopular. Intelligently manages risk: takes calculated risks for improvement without gambling. Shows courage to decide without full consensus when time is of the essence. Weighs costs of delaying decisions.`, 
                  example: `Plant Manager: Decides on shift restructuring ‚Äì communicates personally, accompanies change.` 
                },
                5: { 
                  text: `The manager makes strategic, far-reaching decisions with courage and clarity ‚Äì including in ambiguous situations or under high political pressure. Is known for principled decision-making that is later validated. Maintains decision quality even in crisis mode (no panic decisions). Actively seeks feedback on decision quality.`, 
                  example: `Director: Decides on fundamental reorientation during market downturn ‚Äì leads restructuring successfully.` 
                }
              }
            },
            {
              id: "l4",
              title: "Execution & Performance Management",
              category: "leadership",
              icon: Target,
              definition: `Achieving results, consistent follow-through, demanding and supporting. Getting things done.`,
              levels: {
                1: { 
                  text: `The manager neither sets clear goals nor follows up on them. Expectations are unclear, performance is neither measured nor addressed. Promises to customers, management, or other stakeholders are frequently broken or missed ‚Äì without consequences. No prioritization recognizable. In the team, anything goes; low performers run with no response. Meetings end without clear actions.`, 
                  example: `Manager: Tolerates delay after delay; customer loses trust.` 
                },
                2: { 
                  text: `Goals are stated but not consistently followed up. The manager remembers agreements only when already off track. Feedback on performance gaps is superficial or avoided. Requires only under pressure, then too harshly; no balance. Responds to performance problems too late or not at all. Tracking in meetings is unstructured.`, 
                  example: `Team Lead: Lets quota slip, only notices at month end.` 
                },
                3: { 
                  text: `BASELINE: The manager sets clear, understandable goals for their team. Expectations are transparent, performance is regularly discussed. Requires adherence to agreements and addresses deviations early. Supports team in goal achievement but doesn't take over responsibility. Distinguishes conscious goal adjustment from failure. Establishes a reliable progress tracking.`, 
                  example: `Production: Visualizes weekly targets, follows up on deviations, supports team.` 
                },
                4: { 
                  text: `The manager is rigorously consistent but without demotivating. Balances pressure and support. Establishes a performance culture where everyone gives their best. Reduces KPI blind spots through targeted measurement concepts. Proactively identifies risks for goal achievement and initiates countermeasures. Can simultaneously track multiple important initiatives.`, 
                  example: `Operations: Drives cost optimization, celebrates milestones, maintains team morale.` 
                },
                5: { 
                  text: `The manager establishes a cross-site performance culture that sets standards for the group. Leads major initiatives with strategic significance and track record of success. Is known for delivering what is promised. Shapes improvement practices (OKR, KPIs, retros) that are adopted by other areas. Develops leaders who bring the same rigor.`, 
                  example: `VP: Drives group-wide Lean initiative; measurable productivity gains.` 
                }
              }
            },
            {
              id: "l5",
              title: "Stakeholder & Conflict Resolution",
              category: "leadership",
              icon: Award,
              definition: `Cultivating relationships, moderating political interests. Bridge builder between silos.`,
              levels: {
                1: { 
                  text: `The manager completely ignores the interests of other departments or locations. Doesn't communicate with important stakeholders, leading to surprises and resistance. In conflicts behaves destructively: searches for culprits instead of solutions, speaks badly about other areas ("Those up/down there") or carries out conflicts aggressively and non-objectively. Alternatively, conflicts are ignored or waited out until they escalate. Behavior massively damages trust and cooperation in the group.`, 
                  example: `Prod Manager: Curses about 'incompetent sales' instead of clarifying feasibility directly.` 
                },
                2: { 
                  text: `The manager cultivates relationships only when acutely needing something (transactional). Frequently forgets to involve relevant partners (e.g., HR, IT, other locations) in time, delaying projects. Recognizes political faux pas often too late. In case of conflicts reacts defensively or withdraws to "keep the peace" even when clarification would be necessary. Solutions are often weak compromises that satisfy no one. Struggles to take the counterpart's perspective.`, 
                  example: `Project Lead: Forgets to inform works council. Withdraws project offended at veto.` 
                },
                3: { 
                  text: `BASELINE: The manager knows their most important stakeholders and keeps them regularly informed. Coordinates proactively to avoid misunderstandings. Meets partners ‚Äì internal or external ‚Äì with respect and on equal footing. Conflicts are addressed in a timely manner ("Fast") and discussed objectively. Represents the interests of their area, but is ready to listen to counterarguments and find fair solutions. Ensures cooperation runs smoothly.`, 
                  example: `Service/Supply: Shows figures, agrees objectively on minimum stock (Compromise).` 
                },
                4: { 
                  text: `The manager actively builds a resilient network beyond department boundaries. Anticipates potential conflicts (e.g., resource bottlenecks between projects) and moderates them preventively before they escalate. Understands the constraints and goals of the other side and offers solutions that help both ("Win-Win"). Is appreciated by other departments as a reliable partner who not only asks but also supports. Can communicate even difficult messages diplomatically and respectfully.`, 
                  example: `Quality: Travels to locations, moderates workshop for common standard.` 
                },
                5: { 
                  text: `The manager resolves complex, stuck conflicts (e.g., cultural tensions between locations or historical turf wars) where others have failed. Succeeds in aligning diverse interests toward the common strategic goal ("One Niederwieser"). Establishes committees or formats that structurally improve exchange and stakeholder management. Enjoys highest trust with management and employee representatives and uses this capital for the company's good. Transforms adversaries into partners.`, 
                  example: `Manager: Breaks old silos, integrates hostile teams into successful unit.` 
                }
              }
            }
          ]
          }
        };

        // --- PRODUCTION/LOGISTICS COMPETENCY DATA ---
        // Separate Kompetenzdaten f√ºr Produktion & Logistik (keine Leadership-Kompetenzen)
        const APP_DATA_PRODUCTION = {
          de: {
            intro: {
              title: "Produktion & Logistik",
              subtitle: "BARS-Bewertungsleitfaden",
              description: "Dieser Leitfaden hilft Ihnen, das Arbeitsverhalten Ihrer Mitarbeitenden in Produktion und Logistik objektiv und nachvollziehbar einzusch√§tzen.",
              selfAssessmentNote: "Hinweis: In der Produktion wird die Selbsteinsch√§tzung des Mitarbeiters direkt im Gespr√§ch abgefragt, um unmittelbar darauf eingehen zu k√∂nnen.",
              rules: [
                { title: "Beobachten statt interpretieren", desc: "Bewerten Sie nur, was Sie tats√§chlich gesehen haben. K√∂nnen Sie ein konkretes Beispiel aus den letzten 12 Monaten nennen?" },
                { title: "Typisches Verhalten bewerten", desc: "Die Bewertung soll das regelm√§√üig gezeigte Verhalten abbilden, nicht Ausnahmen." },
                { title: "Stufe 3 ist der Standard", desc: "Baseline bedeutet: Der Mitarbeiter erf√ºllt die Anforderungen seiner Position zuverl√§ssig und selbstst√§ndig." }
              ]
            },
            competencies: [
              {
                id: "pc1",
                title: "Fachkompetenz & Qualit√§t",
                category: "core",
                icon: Briefcase,
                definition: "Sichere Maschinenbedienung, Arbeit nach Vorschrift, Einhaltung von Hygiene- und Sicherheitsstandards, Qualit√§tsbewusstsein.",
                observationTips: [
                  "Schichtwechsel: Ist die Maschine korrekt eingestellt und √ºbergabef√§hig?",
                  "St√∂rungsfall: Wird nach Arbeitsanweisung reagiert und dokumentiert?",
                  "Routinekontrolle: Wird pers√∂nliche Schutzausr√ºstung durchg√§ngig getragen?",
                  "Qualit√§tspr√ºfung: Werden Abweichungen eigenst√§ndig erkannt und gemeldet?",
                  "Logistik: Kommissioniergenauigkeit, korrekte Buchungen, Ladungssicherung"
                ],
                levels: {
                  1: { 
                    text: "Arbeitet wiederholt fehlerhaft oder unsicher und verursacht vermeidbaren Ausschuss oder Qualit√§tsprobleme. H√§lt Sicherheitsvorschriften (PSA, Schutzeinrichtungen) trotz Hinweisen nicht konsequent ein. Erkennt Qualit√§tsabweichungen nicht oder meldet sie nicht. Bedient die Anlage nicht nach Vorgabe und verursacht Maschinensch√§den oder Stillst√§nde durch Fehlbedienung.",
                    example: "Extrusion: Ignoriert Temperaturwarnungen, Folie rei√üt mehrfach. | Druck: Startet Produktion trotz sichtbarer Farbabweichung. | Hei√üsiegelung: Siegelnaht undicht, wird erst bei Endkontrolle entdeckt. | Allgemein: Tr√§gt trotz Aufforderung keinen Geh√∂rschutz."
                  },
                  2: { 
                    text: "Beherrscht die Standardabl√§ufe an der zugewiesenen Anlage und arbeitet sicherheitsbewusst nach Vorschrift. F√ºhrt die vorgeschriebenen Qualit√§tspr√ºfungen (Sichtpr√ºfung, Ma√ükontrolle, Siegelnahtpr√ºfung) gewissenhaft durch und dokumentiert die Ergebnisse. Produziert im Normalbetrieb mit akzeptabler Ausschussquote innerhalb der Vorgaben. Bei Abweichungen vom Standard (Materialwechsel, Produktumstellung, ungewohnte St√∂rungen) holt er/sie Unterst√ºtzung vom Schichtleiter oder erfahrenen Kollegen. Der Unterschied zu Stufe 3: Arbeitet sicher im NORMALBETRIEB, braucht bei Abweichungen noch UNTERST√úTZUNG.",
                    example: "Extrusion: F√ºhrt Schichtdickenmessung korrekt durch, ruft bei Abweichung den Einrichter. | Druck: Pr√ºft Farbmuster gegen Referenz, stoppt bei Abweichung und holt Schichtleiter. | Hei√üsiegelung: F√ºhrt Siegelnahtpr√ºfung nach Vorgabe durch. | Unterschied zu Stufe 3: Stufe-3-MA korrigiert Standardabweichungen eigenst√§ndig."
                  },
                  3: { 
                    text: "BASELINE: Bedient die zugewiesene Anlage sicher, selbstst√§ndig und effizient. F√ºhrt alle vorgeschriebenen Qualit√§tspr√ºfungen eigenverantwortlich durch und erkennt Abweichungen zuverl√§ssig. Korrigiert Standardabweichungen (Temperatur, Geschwindigkeit, Spannung) selbstst√§ndig nach Parametervorgabe. Die Ausschussquote liegt konstant im oder unter dem Zielwert. F√ºhrt Produktwechsel und R√ºstvorg√§nge nach Anleitung selbstst√§ndig durch und h√§lt dabei die R√ºstzeitvorgaben ein. Dokumentiert alle relevanten Daten (BDE/MDE) vollst√§ndig und korrekt. Erkennt, wann technische Unterst√ºtzung n√∂tig ist, und informiert dann pr√§zise.",
                    example: "Extrusion: Korrigiert Schichtdickenabweichung durch Parameteranpassung im erlaubten Bereich. R√ºstet Materialwechsel in Zielzeit. | Druck: F√ºhrt Farbkorrektur bei leichter Abweichung selbstst√§ndig durch. Register stimmen durchgehend. | Hei√üsiegelung: Erkennt Siegelnahtprobleme sofort, passt Temperatur/Druck an. | Logistik: Kommissioniert fehlerfrei, Buchungen im System aktuell."
                  },
                  4: { 
                    text: "Arbeitet sehr pr√§zise und vorausschauend an der Anlage. Erkennt beginnende Qualit√§tsprobleme fr√ºhzeitig (bevor Ausschuss entsteht) durch aufmerksame Beobachtung von Prozessparametern, Ger√§uschen oder Optik. Versteht die Zusammenh√§nge zwischen Einstellparametern und Produktqualit√§t (das 'Warum' hinter den Vorgaben). Optimiert R√ºstzeiten durch gute Vorbereitung und effiziente Abl√§ufe. Kann auch bei schwierigen Materialien oder Produkten zuverl√§ssig Qualit√§t liefern. Erkennt Verschlei√üerscheinungen und meldet Wartungsbedarf proaktiv, bevor Ausf√§lle entstehen.",
                    example: "Extrusion: H√∂rt leichte Ver√§nderung im Extruderger√§usch, meldet Lagerverschlei√ü bevor Ausfall. | Druck: Erkennt an minimaler Farbdriftung, dass Rakelzustand pr√ºfenswert ist. | Hei√üsiegelung: Bemerkt, dass Siegelbalken nachgeheizt werden muss, bevor erste Fehlsiegelung auftritt. | Unterschreitet R√ºstzeitvorgaben regelm√§√üig."
                  },
                  5: { 
                    text: "Ist fachliche Autorit√§t im Bereich und wird von Kollegen und Vorgesetzten bei schwierigen Fragen konsultiert. Beherrscht mehrere Anlagen (Springer-Funktion) und kann flexibel eingesetzt werden. Arbeitet neue Kollegen qualifiziert ein und gibt sein Wissen systematisch weiter. Entwickelt eigenst√§ndig Verbesserungsvorschl√§ge, die nachweislich Qualit√§t verbessern oder Ausschuss reduzieren. Tr√§gt aktiv zur Prozessoptimierung bei und arbeitet konstruktiv mit Technik und QS zusammen. F√§hrt neue Produkte oder Rezepturen eigenst√§ndig ein.",
                    example: "Extrusion: Ist Go-to-Person f√ºr schwierige Materialien. Hat Verbesserungsvorschlag eingereicht, der Ausschuss um 15% reduziert hat. | Druck: Beherrscht alle Druckmaschinen, wird bei Anfahrproblemen gerufen. | Hei√üsiegelung: Kann alle Beuteltypen fahren, optimiert eigenst√§ndig neue Produkte. | Wird von anderen Schichten bei Problemen kontaktiert."
                  }
                }
              },
              {
                id: "pc2",
                title: "Kommunikation & Zusammenarbeit",
                category: "core",
                icon: MessageCircle,
                definition: "Qualit√§t der Schicht√ºbergabe, Informationsweitergabe, Hilfsbereitschaft, konstruktiver Umgangston.",
                observationTips: [
                  "Schicht√ºbergabe: Sind alle relevanten Informationen vollst√§ndig dokumentiert?",
                  "Engpasssituation: Wird Kollegen unaufgefordert geholfen?",
                  "Konflikt: Wie wird mit Meinungsverschiedenheiten umgegangen?",
                  "Neue Kollegen: Werden sie aktiv integriert?"
                ],
                levels: {
                  1: { 
                    text: "Kommuniziert wichtige Informationen nicht oder unvollst√§ndig. Verl√§sst den Arbeitsplatz bei Schichtende ohne ordentliche √úbergabe, sodass der Nachfolger nicht informiert ist √ºber laufende Auftr√§ge, Probleme oder Maschinenstatus. Gibt relevante Beobachtungen (St√∂rungen, Qualit√§tsprobleme, Sicherheitsrisiken) nicht weiter. Arbeitet isoliert und unterst√ºtzt Kollegen auch bei offensichtlichem Bedarf nicht. Reagiert auf Kritik oder Hinweise abweisend.",
                    example: "Schicht√ºbergabe: Geht p√ºnktlich ohne Info √ºber laufenden Fehler - Nachfolger produziert Ausschuss. | Teamarbeit: Sieht, dass Kollege Material braucht, hilft aber nicht. | St√∂rung: Meldet Maschinenproblem nicht, wartet bis Schichtende. | Sicherheit: Bemerkt √ñllache, informiert niemanden."
                  },
                  2: { 
                    text: "F√ºhrt die Schicht√ºbergabe durch und gibt die wesentlichen Informationen weiter (laufender Auftrag, Maschinenstatus, bekannte Probleme). Bei Details muss der Nachfolger manchmal nachfragen. Dokumentiert Produktionsdaten (BDE) vollst√§ndig. Ist freundlich und hilfsbereit, wenn Kollegen um Unterst√ºtzung bitten. Arbeitet konstruktiv im Team. Meldet St√∂rungen und Qualit√§tsprobleme dem Schichtleiter. Die proaktive Information ohne explizite Nachfrage entwickelt sich noch. Der Unterschied zu Stufe 3: Gibt Infos weiter WENN GEFRAGT oder bei offensichtlicher Relevanz - noch nicht durchgehend proaktiv und vollst√§ndig.",
                    example: "Schicht√ºbergabe: Kerninfos werden √ºbergeben; bei speziellen Themen muss Nachfolger nachfragen. | Teamarbeit: Hilft gerne, wenn er/sie angesprochen wird. | Dokumentation: BDE-Eingaben vollst√§ndig und zeitnah. | Unterschied zu Stufe 3: Stufe-3-MA √ºbergibt so vollst√§ndig, dass keine Nachfragen n√∂tig sind."
                  },
                  3: { 
                    text: "BASELINE: Macht p√ºnktliche, vollst√§ndige Schicht√ºbergabe: laufende Auftr√§ge, Maschinenstatus, aufgetretene Probleme, offene Punkte - der Nachfolger ist vollst√§ndig im Bild und muss nicht nachfragen. Dokumentiert alle relevanten Daten (BDE/MDE, Qualit√§tsprotokolle) vollst√§ndig, korrekt und zeitnah. Ist freundlich und hilfsbereit. Unterst√ºtzt Kollegen im eigenen Bereich auch unaufgefordert, wenn er/sie sieht, dass Hilfe ben√∂tigt wird. Informiert Schichtleiter und QS proaktiv √ºber relevante Beobachtungen. Kommuniziert respektvoll und konstruktiv, auch bei Meinungsverschiedenheiten.",
                    example: "Schicht√ºbergabe: Nachfolger kann sofort weiterarbeiten, alle Infos sind da. | Teamarbeit: Sieht, dass Kollege Material braucht, holt es unaufgefordert. | Dokumentation: BDE immer aktuell, QS-Protokolle vollst√§ndig. | Kommunikation: Bei Problemen sachlich, ohne Schuldzuweisung."
                  },
                  4: { 
                    text: "Erkennt Unterst√ºtzungsbedarf auch au√üerhalb des eigenen direkten Bereichs und bietet Hilfe an. Gibt Wissen aktiv und strukturiert an Kollegen weiter (zeigt Handgriffe, erkl√§rt Zusammenh√§nge). Informiert die Folgeschicht m√ºndlich √ºber wichtige Besonderheiten, die √ºber die Standard√ºbergabe hinausgehen. Kommuniziert proaktiv mit anderen Abteilungen (QS, Technik, Logistik), wenn √ºbergreifende Themen anstehen. Ist Ansprechpartner f√ºr neue Kollegen und unterst√ºtzt deren Integration.",
                    example: "Schicht√ºbergabe: Ruft bei kritischen Themen den Nachfolger sogar an, wenn er selbst frei hat. | Wissenstransfer: Erkl√§rt Kollegen, WARUM bestimmte Einstellungen wichtig sind. | Vernetzung: Stimmt sich mit QS ab, bevor Grenzwerte erreicht werden. | Neue Kollegen: Nimmt sie unter die Fittiche."
                  },
                  5: { 
                    text: "F√∂rdert aktiv den Teamzusammenhalt und sorgt f√ºr eine positive Arbeitsatmosph√§re. Vermittelt bei Konflikten zwischen Kollegen und findet konstruktive L√∂sungen. Integriert neue Kollegen schnell ins Team und sorgt daf√ºr, dass sie sich wohlf√ºhlen. Treibt den Informationsaustausch zwischen Schichten und Bereichen aktiv voran. Wird von Kollegen als Vertrauensperson gesehen und bei schwierigen Themen angesprochen. Gibt konstruktives Feedback und nimmt selbst Feedback offen an.",
                    example: "Teambuilding: Schlichtet Streit zwischen Kollegen sachlich und fair. | Integration: Neue Kollegen f√ºhlen sich nach wenigen Tagen als Teil des Teams. | Schicht√ºbergreifend: Hat Kommunikationsroutine zwischen Schichten verbessert. | Vertrauen: Kollegen kommen mit Problemen zu ihm/ihr."
                  }
                }
              },
              {
                id: "pc3",
                title: "Probleml√∂sung",
                category: "core",
                icon: Lightbulb,
                definition: "Umgang mit St√∂rungen und Fehlern, eigenst√§ndige L√∂sungsfindung, systematische Ursachenanalyse, Beitrag zur kontinuierlichen Verbesserung.",
                observationTips: [
                  "Maschinenstillstand: Wie schnell und angemessen wird reagiert?",
                  "Wiederkehrende Probleme: Wird nach Ursachen gesucht?",
                  "Verbesserungsvorschl√§ge: Werden welche eingebracht?"
                ],
                levels: {
                  1: { 
                    text: "Ignoriert Probleme oder meldet sie nicht, auch wenn sie offensichtlich sind. Wartet bei St√∂rungen passiv, ohne zu handeln oder Hilfe zu holen. Vertuscht eigene Fehler, statt sie zu melden und daraus zu lernen. Macht bei wiederkehrenden Problemen immer die gleichen Fehler, ohne aus Erfahrung zu lernen. Gibt bei Schwierigkeiten schnell auf oder schiebt Verantwortung auf andere.",
                    example: "Maschinenst√∂rung: Maschine steht - wartet ohne zu handeln oder zu melden, bis Schichtleiter es bemerkt. | Qualit√§tsproblem: Produziert trotz erkennbarer Abweichung weiter. | Eigene Fehler: Versteckt Ausschuss statt ihn zu melden. | Wiederholung: Macht denselben Bedienungsfehler immer wieder."
                  },
                  2: { 
                    text: "Erkennt Probleme und St√∂rungen zuverl√§ssig und meldet sie zeitnah dem Schichtleiter oder der Technik - ein wichtiger erster Beitrag zur Probleml√∂sung. Beschreibt dabei das Problem pr√§zise: Was ist passiert? Wann? Was wurde bereits versucht? Bei bekannten, dokumentierten St√∂rungen (z.B. Materialstau, einfache Fehlermeldungen) versucht er/sie diese nach Checkliste oder Arbeitsanweisung selbst zu beheben. Holt bei Unsicherheit oder komplexeren Problemen Unterst√ºtzung. Der Unterschied zu Stufe 3: L√∂st bekannte Probleme nach ANLEITUNG, bei unbekannten Problemen prim√§r MELDUNG und Unterst√ºtzung holen.",
                    example: "Maschinenstau: Erkennt Stau, versucht Behebung nach Checkliste. Wenn das nicht klappt: ruft Technik mit Info 'Stau an Position X, Schritte Y+Z versucht'. | Qualit√§tsproblem: Erkennt Abweichung, informiert Schichtleiter pr√§zise. | Unterschied zu Stufe 3: Stufe-3-MA analysiert auch unbekannte Probleme eigenst√§ndig."
                  },
                  3: { 
                    text: "BASELINE: L√∂st allt√§gliche Produktions- und Maschinenprobleme selbstst√§ndig und z√ºgig (Materialstau beheben, Parameteranpassungen, kleinere St√∂rungen). Analysiert bei Problemen systematisch die m√∂glichen Ursachen, bevor er/sie handelt. Unterscheidet sicher, was er/sie selbst l√∂sen kann und wann Technik oder Schichtleiter eingeschaltet werden m√ºssen - informiert dann aber pr√§zise und l√∂sungsorientiert (nicht nur 'Maschine kaputt', sondern 'Symptom X, vermutlich Ursache Y, Vorschlag Z'). Dokumentiert aufgetretene Probleme und L√∂sungen f√ºr die Schicht√ºbergabe.",
                    example: "Maschinenst√∂rung: Analysiert systematisch (Fehlermeldung lesen, Sichtpr√ºfung, typische Ursachen pr√ºfen), behebt selbstst√§ndig oder eskaliert mit klarer Diagnose. | Qualit√§tsproblem: Findet Ursache (z.B. Temperaturabweichung), korrigiert Parameter. | Dokumentation: Tr√§gt Problem und L√∂sung ins Schichtbuch ein."
                  },
                  4: { 
                    text: "Sucht nicht nur nach schnellen L√∂sungen, sondern nach Ursachen, um Wiederholung zu verhindern. Erkennt Muster bei wiederkehrenden Problemen und dokumentiert Beobachtungen f√ºr systematische Analyse. Arbeitet konstruktiv mit Technik und QS zusammen, um nachhaltige L√∂sungen zu finden. Denkt √ºber die akute L√∂sung hinaus: Was m√ºssen wir √§ndern, damit das nicht wieder passiert? Gibt Erkenntnisse aus Probleml√∂sungen an Kollegen weiter.",
                    example: "Ursachenanalyse: Bemerkt, dass St√∂rung immer bei bestimmtem Material auftritt - dokumentiert und meldet an Technik f√ºr grundlegende L√∂sung. | Pr√§vention: Schl√§gt Anpassung der Wartungsintervalle vor, nachdem Verschlei√ü Probleme verursacht hat. | Wissenstransfer: Erkl√§rt Kollegen, wie er/sie das Problem gel√∂st hat."
                  },
                  5: { 
                    text: "Analysiert hartn√§ckige, komplexe Probleme systematisch (z.B. mit 5-Why, Ishikawa) und findet nachhaltige L√∂sungen. Reicht KVP-Vorschl√§ge ein, die nachweislich Probleme dauerhaft beseitigen oder Prozesse verbessern. Wird bei schwierigen St√∂rungen als Experte hinzugezogen. Arbeitet proaktiv an der Verbesserung von Arbeitsanweisungen und Checklisten mit, basierend auf Praxiserfahrung. Teilt sein Probleml√∂sungswissen systematisch mit Kollegen.",
                    example: "KVP: Hat Verbesserungsvorschlag eingereicht, der wiederkehrende St√∂rung dauerhaft behoben hat. | Expertise: Wird von Technik bei komplexen Problemen als Praxis-Experte hinzugezogen. | Dokumentation: Hat Fehlerbehebungs-Checkliste auf Basis eigener Erfahrung verbessert."
                  }
                }
              },
              {
                id: "pc4",
                title: "Anpassungsf√§higkeit & Flexibilit√§t",
                category: "core",
                icon: BookOpen,
                definition: "Umgang mit Ver√§nderungen, Bereitschaft zur √úbernahme neuer Aufgaben, Lernbereitschaft.",
                observationTips: [
                  "Neue Arbeitsanweisung: Wie schnell und bereitwillig wird sie umgesetzt?",
                  "Personalengpass: Wird Flexibilit√§t gezeigt?",
                  "Schulungsangebote: Werden sie wahrgenommen?"
                ],
                levels: {
                  1: { 
                    text: "Lehnt Ver√§nderungen aktiv ab und √§u√üert sich wiederholt negativ √ºber neue Anforderungen, Prozesse oder Systeme. Weigert sich, andere als die gewohnten Aufgaben zu √ºbernehmen oder an anderen Arbeitspl√§tzen einzuspringen. Zeigt kein Interesse an Weiterbildung oder dem Erlernen neuer F√§higkeiten. Blockiert Verbesserungen durch Widerstand oder passive Verweigerung. Besteht auf 'Das haben wir schon immer so gemacht.'",
                    example: "Ver√§nderung: √Ñu√üert sich wiederholt negativ √ºber neue Software/Prozesse, demotiviert Kollegen. | Flexibilit√§t: Weigert sich, bei Personalengpass an anderer Linie einzuspringen. | Weiterbildung: Lehnt Schulungsangebot ab. | Einstellung: 'Das ist nicht meine Aufgabe.'"
                  },
                  2: { 
                    text: "Steht Neuerungen grunds√§tzlich offen gegen√ºber und setzt neue Anweisungen um. F√ºr die Einarbeitung in neue Abl√§ufe, Maschinen oder Systeme ben√∂tigt er/sie EINWEISUNG durch Schichtleiter oder erfahrene Kollegen - selbstst√§ndiges Einarbeiten nur nach schriftlicher Anweisung ist noch schwierig. Setzt √Ñnderungen nach erfolgter Einweisung dann aber zuverl√§ssig und korrekt um. Bei kurzfristigen √Ñnderungen (z.B. Schichtplan, Auftragsreihenfolge) zeigt er/sie Verst√§ndnis f√ºr betriebliche Notwendigkeiten. Der Unterschied zu Stufe 3: Braucht EINWEISUNG f√ºr Neues; arbeitet sich noch nicht selbstst√§ndig ein.",
                    example: "Neue Maschine: Braucht Einweisung vom Schichtleiter; nur Dokumentation lesen reicht noch nicht. Danach: zuverl√§ssige Bedienung. | Schichtplan: Springt bei Personalengpass ein, wenn Schichtleiter darum bittet. | Unterschied zu Stufe 3: Stufe-3-MA liest neue Arbeitsanweisung und setzt sie nach kurzer R√ºckfrage selbstst√§ndig um."
                  },
                  3: { 
                    text: "BASELINE: Steht Ver√§nderungen offen und konstruktiv gegen√ºber. Arbeitet sich in neue Arbeitsanweisungen, Prozesse oder Systeme nach Dokumentation und kurzer Einweisung selbstst√§ndig ein. Springt bei Bedarf an anderen Arbeitspl√§tzen im gleichen Bereich ein und √ºbernimmt Vertretungen. Setzt neue Vorgaben z√ºgig und ohne gro√üe Diskussion um. Nimmt Schulungsangebote wahr und wendet das Gelernte an. Passt sich an wechselnde Anforderungen (Auftrags√§nderungen, Priorit√§tenwechsel) flexibel an.",
                    example: "Einarbeitung: Liest neue Arbeitsanweisung, probiert unter Aufsicht, arbeitet dann selbstst√§ndig. | Flexibilit√§t: √úbernimmt bei Krankheit Vertretung an Nachbarmaschine nach kurzer Einweisung. | √Ñnderungen: Akzeptiert kurzfristige Auftrags√§nderungen ohne Murren. | Schulung: Wendet neues Wissen aus Schulung im Alltag an."
                  },
                  4: { 
                    text: "√úbernimmt proaktiv neue Aufgaben und Verantwortungen, ohne gefragt zu werden. Fragt aktiv nach Lernm√∂glichkeiten und Schulungen, um sich weiterzuentwickeln. Passt sich sehr schnell an neue Situationen an und ist auch bei unvorhergesehenen √Ñnderungen sofort produktiv. Ist bereit, in anderen Bereichen zu lernen und sich zu qualifizieren. Unterst√ºtzt Kollegen bei der Einarbeitung in Neuerungen und hilft bei der Akzeptanz von Ver√§nderungen.",
                    example: "Proaktivit√§t: Fragt von sich aus nach Einarbeitung an neuer Anlage. | Schnelle Anpassung: Nach einem Tag Einweisung produktiv einsetzbar. | Bereichs√ºbergreifend: L√§sst sich freiwillig f√ºr anderen Bereich qualifizieren. | Unterst√ºtzung: Hilft skeptischen Kollegen, Vorteile neuer Prozesse zu sehen."
                  },
                  5: { 
                    text: "Ist als Allrounder an mehreren Anlagen/in mehreren Bereichen qualifiziert und √ºberall produktiv einsetzbar (Springer-Funktion). Wird gezielt bei Anlaufphasen, neuen Produkten oder kritischen Situationen eingesetzt. Treibt Verbesserungen und Ver√§nderungen aktiv voran und ist Multiplikator f√ºr neue Methoden und Prozesse. Hilft Kollegen, Ver√§nderungsskepsis zu √ºberwinden, und nimmt sie mit. Ist offen f√ºr v√∂llig neue Aufgaben auch au√üerhalb des bisherigen T√§tigkeitsbereichs.",
                    example: "Springer: Kann an 3+ verschiedenen Anlagen selbstst√§ndig arbeiten. | Anlauf: Wird bei neuen Produkten/Rezepturen zum Einfahren eingesetzt. | Multiplikator: Kollegen verlieren durch ihn/sie Skepsis gegen√ºber Neuem. | Flexibilit√§t: √úbernimmt tempor√§r auch Aufgaben in anderen Abteilungen."
                  }
                }
              },
              {
                id: "pc5",
                title: "Selbstorganisation",
                category: "core",
                icon: Clock,
                definition: "Einhaltung von 5S-Standards, P√ºnktlichkeit, Sauberkeit am Arbeitsplatz, vorausschauende Arbeitsvorbereitung.",
                observationTips: [
                  "Schichtbeginn: Ist der Mitarbeiter p√ºnktlich und startklar?",
                  "Arbeitsplatz bei Schichtende: In welchem Zustand wird er √ºbergeben?",
                  "Pausenzeiten: Werden sie eingehalten?",
                  "Materialverf√ºgbarkeit: Wurde vorausschauend vorbereitet?"
                ],
                levels: {
                  1: { 
                    text: "Arbeitsplatz ist regelm√§√üig unordentlich und entspricht nicht dem 5S-Standard. Werkzeuge und Materialien sind nicht an ihrem Platz, was die Arbeit verz√∂gert und Unfallrisiken birgt. Kommt wiederholt unp√ºnktlich zur Schicht oder ist bei Schichtbeginn nicht einsatzbereit. √úberzieht Pausen ohne Absprache, sodass die Maschine stillsteht oder Kollegen einspringen m√ºssen. Bereitet Material nicht vor, sodass Stillst√§nde durch fehlendes Material entstehen.",
                    example: "Ordnung: Nachfolger muss erst aufr√§umen, bevor er arbeiten kann. Werkzeuge liegen herum. | P√ºnktlichkeit: Kommt mehrfach im Monat zu sp√§t ohne Vorwarnung. | Pausen: √úberzieht Pause um 15 Minuten, Kollege muss l√§nger an Maschine bleiben. | Vorbereitung: Material alle - Maschine steht."
                  },
                  2: { 
                    text: "Ist p√ºnktlich und h√§lt den Arbeitsplatz grunds√§tzlich ordentlich - der 5S-Standard wird √úBERWIEGEND eingehalten, mit gelegentlichen Erinnerungen durch den Schichtleiter (z.B. bei 5S-Rundg√§ngen). Material und Werkzeuge werden f√ºr den Arbeitseinsatz vorbereitet. H√§lt Pausenzeiten ein. Bei hoher Auslastung oder Stress kann die Vorbereitung manchmal knapper werden oder die Ordnung etwas leiden. Der Unterschied zu Stufe 3: H√§lt Ordnung mit GELEGENTLICHER ERINNERUNG; bei Stufe 3 EIGENST√ÑNDIG und auch unter Stress.",
                    example: "Ordnung: Arbeitsplatz meist ordentlich; bei 5S-Audit gelegentlich Hinweise n√∂tig. | Vorbereitung: Material vorbereitet; bei Hochbetrieb manchmal knapp. | P√ºnktlichkeit: Zuverl√§ssig p√ºnktlich und startklar. | Unterschied zu Stufe 3: Stufe-3-MA h√§lt 5S auch ohne Erinnerung und bei Stress."
                  },
                  3: { 
                    text: "BASELINE: Ist p√ºnktlich, vorbereitet und bei Schichtbeginn sofort einsatzbereit. H√§lt den 5S-Standard eigenst√§ndig und konsequent ein - auch ohne Kontrolle und auch unter Zeitdruck. Werkzeuge und Materialien sind immer an ihrem Platz, der Arbeitsbereich ist sicher und aufger√§umt. Bereitet Material vorausschauend vor, sodass keine Stillst√§nde durch fehlendes Material entstehen. Organisiert Pausenvertretung zuverl√§ssig. Dokumentiert vollst√§ndig und aktuell. Der Arbeitsplatz ist am Schichtende √ºbergabefertig.",
                    example: "5S: Arbeitsplatz entspricht bei jeder Kontrolle dem Standard. | Vorbereitung: Material f√ºr n√§chsten Auftrag liegt bereit, Werkzeuge gepr√ºft. | Pausenvertretung: Kl√§rt Vertretung selbst, Maschine steht nie wegen Pause. | √úbergabe: Nachfolger findet aufger√§umten, dokumentierten Arbeitsplatz vor."
                  },
                  4: { 
                    text: "Nutzt Leerlaufzeiten (z.B. w√§hrend Maschinenlauf) sinnvoll f√ºr Vorbereitung, Ordnung oder Dokumentation. Organisiert Materialnachschub so vorausschauend, dass nie ein Engpass entsteht. Arbeitsplatz bleibt auch nach stressigen Phasen aufger√§umt und sicher. Plant eigene Arbeit vorausschauend und ber√ºcksichtigt dabei Abh√§ngigkeiten (z.B. Vorarbeiten f√ºr Folgeschicht). Optimiert eigene Arbeitsabl√§ufe kontinuierlich f√ºr mehr Effizienz.",
                    example: "Leerlaufnutzung: Bereitet w√§hrend Maschinenlauf Material f√ºr n√§chsten Auftrag vor. | Vorausschau: Bestellt Material nach, bevor es knapp wird. | Stressresistenz: Arbeitsplatz auch nach 12-Stunden-Schicht aufger√§umt. | Effizienz: Hat eigene R√ºstroutine optimiert, spart dadurch Zeit."
                  },
                  5: { 
                    text: "Hat den eigenen Arbeitsplatz so optimiert, dass er als Musterbeispiel f√ºr 5S und effiziente Organisation gilt. Wird bei 5S-Audits als Vorbild genannt. Entwickelt Ideen zur Arbeitsplatzorganisation, die auch anderen Kollegen helfen (z.B. bessere Werkzeuganordnung, Visualisierungen). Teilt seine Organisationsmethoden mit Kollegen. Denkt √ºber den eigenen Arbeitsplatz hinaus und unterst√ºtzt die kontinuierliche Verbesserung im gesamten Bereich.",
                    example: "Vorbild: Arbeitsplatz wird bei 5S-Schulungen als Best Practice gezeigt. | Verbesserung: Hat Werkzeugboard entwickelt, das jetzt alle nutzen. | Wissenstransfer: Zeigt neuen Kollegen effiziente Arbeitsorganisation. | Bereichsoptimierung: Hat Vorschlag f√ºr bessere Materialbereitstellung gemacht."
                  }
                }
              }
            ]
          },
          it: {
            intro: {
              title: "Produzione & Logistica",
              subtitle: "Guida alla Valutazione BARS",
              description: "Questa guida vi aiuta a valutare il comportamento lavorativo dei vostri collaboratori in produzione e logistica in modo oggettivo e trasparente.",
              selfAssessmentNote: "Nota: In produzione l'autovalutazione del collaboratore viene richiesta direttamente durante il colloquio, per potervi rispondere immediatamente.",
              rules: [
                { title: "Osservare invece di interpretare", desc: "Valutate solo quello che avete effettivamente osservato. Potete citare un esempio concreto degli ultimi 12 mesi?" },
                { title: "Valutare il comportamento tipico", desc: "La valutazione deve riflettere il comportamento mostrato regolarmente, non le eccezioni." },
                { title: "Il livello 3 √® lo standard", desc: "Baseline significa: Il collaboratore soddisfa i requisiti della sua posizione in modo affidabile e autonomo." }
              ]
            },
            competencies: [
              {
                id: "pc1",
                title: "Competenza Tecnica & Qualit√†",
                category: "core",
                icon: Briefcase,
                definition: "Conduzione sicura delle macchine, lavoro secondo le istruzioni, rispetto degli standard di igiene e sicurezza, consapevolezza della qualit√†.",
                observationTips: [
                  "Cambio turno: La macchina √® impostata correttamente e pronta per il passaggio?",
                  "Guasto: Si reagisce e documenta secondo le istruzioni?",
                  "Controllo di routine: I DPI vengono indossati costantemente?",
                  "Controllo qualit√†: Le deviazioni vengono riconosciute e segnalate autonomamente?",
                  "Logistica: Precisione di picking, registrazioni corrette, fissaggio del carico"
                ],
                levels: {
                  1: { 
                    text: "Lavora ripetutamente in modo errato o insicuro e causa scarti evitabili o problemi di qualit√†. Non rispetta costantemente le norme di sicurezza (DPI, dispositivi di protezione) nonostante i richiami. Non riconosce le deviazioni di qualit√† o non le segnala. Non utilizza l'impianto secondo le istruzioni e causa danni alle macchine o fermi per errori di utilizzo.",
                    example: "Estrusione: Ignora gli allarmi di temperatura, il film si rompe ripetutamente. | Stampa: Avvia la produzione nonostante evidenti deviazioni di colore. | Termosaldatura: Saldatura non ermetica, scoperta solo al controllo finale. | Generale: Non indossa protezioni acustiche nelle aree rumorose."
                  },
                  2: { 
                    text: "Padroneggia le procedure standard sull'impianto assegnato e lavora in sicurezza secondo le istruzioni. Esegue i controlli qualit√† prescritti (controllo visivo, dimensionale, verifica saldatura) con cura e documenta i risultati. Produce nel funzionamento normale con percentuale di scarto accettabile. In caso di deviazioni dallo standard (cambio materiale, cambio prodotto, guasti insoliti) chiede supporto al capoturno o colleghi esperti. La differenza con il Livello 3: Lavora sicuro nel FUNZIONAMENTO NORMALE, necessita ancora SUPPORTO in caso di deviazioni.",
                    example: "Estrusione: Esegue correttamente la misurazione dello spessore, chiama il tecnico in caso di deviazione. | Stampa: Controlla il campione colore rispetto al riferimento, ferma e chiama il capoturno in caso di deviazione. | Termosaldatura: Esegue il controllo saldatura secondo le istruzioni. | Differenza Livello 3: Il collaboratore Livello 3 corregge autonomamente le deviazioni standard."
                  },
                  3: { 
                    text: "BASELINE: Utilizza l'impianto assegnato in modo sicuro, autonomo ed efficiente. Esegue tutti i controlli qualit√† prescritti in autonomia e riconosce le deviazioni in modo affidabile. Corregge autonomamente le deviazioni standard (temperatura, velocit√†, tensione) secondo i parametri. La percentuale di scarto √® costantemente entro o sotto il target. Esegue cambi prodotto e attrezzaggi autonomamente secondo le istruzioni rispettando i tempi previsti. Documenta tutti i dati rilevanti (BDE/MDE) in modo completo e corretto. Riconosce quando serve supporto tecnico e informa in modo preciso.",
                    example: "Estrusione: Corregge la deviazione di spessore con regolazione parametri nel range consentito. Esegue cambio materiale nei tempi target. | Stampa: Esegue autonomamente la correzione colore per piccole deviazioni. Registro sempre allineato. | Termosaldatura: Riconosce subito problemi di saldatura, regola temperatura/pressione. | Logistica: Picking senza errori, registrazioni a sistema aggiornate."
                  },
                  4: { 
                    text: "Lavora con grande precisione e in modo proattivo all'impianto. Riconosce precocemente i problemi di qualit√† emergenti (prima che si generi scarto) attraverso l'osservazione attenta dei parametri di processo, rumori o aspetto. Comprende le correlazioni tra parametri e qualit√† del prodotto (il 'perch√©' dietro le istruzioni). Ottimizza i tempi di attrezzaggio con buona preparazione e procedure efficienti. Fornisce qualit√† affidabile anche con materiali o prodotti difficili. Riconosce segni di usura e segnala proattivamente necessit√† di manutenzione.",
                    example: "Estrusione: Percepisce leggera variazione nel rumore dell'estrusore, segnala usura cuscinetto prima del guasto. | Stampa: Riconosce dalla minima deriva colore che la racla va controllata. | Termosaldatura: Nota che la barra va riscaldata prima del primo difetto di saldatura. | Supera regolarmente i tempi target di attrezzaggio."
                  },
                  5: { 
                    text: "√à autorit√† tecnica nel reparto e viene consultato da colleghi e superiori per questioni difficili. Padroneggia diversi impianti (funzione jolly) ed √® impiegabile in modo flessibile. Forma nuovi colleghi in modo qualificato e trasferisce il suo know-how sistematicamente. Sviluppa autonomamente proposte di miglioramento che aumentano la qualit√† o riducono gli scarti. Contribuisce attivamente all'ottimizzazione dei processi e collabora costruttivamente con tecnici e QC. Avvia autonomamente nuovi prodotti o ricette.",
                    example: "Estrusione: √à il riferimento per materiali difficili. Ha presentato una proposta di miglioramento che ha ridotto gli scarti del 15%. | Stampa: Padroneggia tutte le macchine da stampa, viene chiamato per problemi di avviamento. | Termosaldatura: Sa gestire tutti i tipi di busta, ottimizza autonomamente nuovi prodotti. | Viene contattato da altri turni per problemi."
                  }
                }
              },
              {
                id: "pc2",
                title: "Comunicazione & Collaborazione",
                category: "core",
                icon: MessageCircle,
                definition: "Qualit√† del passaggio turno, trasmissione delle informazioni, disponibilit√† ad aiutare, tono costruttivo.",
                observationTips: [
                  "Passaggio turno: Tutte le informazioni rilevanti sono completamente documentate?",
                  "Situazione critica: Si aiutano i colleghi spontaneamente?",
                  "Conflitto: Come si gestiscono le divergenze di opinione?",
                  "Nuovi colleghi: Vengono integrati attivamente?"
                ],
                levels: {
                  1: { 
                    text: "Non comunica informazioni importanti o le comunica in modo incompleto. Lascia il posto di lavoro a fine turno senza passaggio consegne adeguato, cos√¨ il successore non √® informato su ordini in corso, problemi o stato macchina. Non trasmette osservazioni rilevanti (guasti, problemi qualit√†, rischi sicurezza). Lavora isolato e non supporta i colleghi anche quando serve evidentemente. Reagisce in modo negativo a critiche o suggerimenti.",
                    example: "Passaggio turno: Va via puntuale senza informare di un guasto in corso - il successore produce scarto. | Team: Vede che il collega ha bisogno di materiale, ma non aiuta. | Guasto: Non segnala problema macchina, aspetta fine turno. | Sicurezza: Nota pozza d'olio, non informa nessuno."
                  },
                  2: { 
                    text: "Esegue il passaggio turno e trasmette le informazioni essenziali (ordine in corso, stato macchina, problemi noti). Per i dettagli il successore deve a volte chiedere. Documenta i dati di produzione (BDE) completamente. √à cordiale e disponibile quando i colleghi chiedono supporto. Lavora costruttivamente in team. Segnala guasti e problemi qualit√† al capoturno. L'informazione proattiva senza richiesta esplicita √® ancora in sviluppo. La differenza con il Livello 3: Trasmette info SE RICHIESTO o quando evidentemente rilevante - non ancora costantemente proattivo e completo.",
                    example: "Passaggio turno: Trasmesse le info principali; per temi specifici il successore deve chiedere. | Team: Aiuta volentieri se interpellato. | Documentazione: Registrazioni BDE complete e puntuali. | Differenza Livello 3: Il Livello 3 consegna in modo cos√¨ completo che non servono domande."
                  },
                  3: { 
                    text: "BASELINE: Esegue passaggio turno puntuale e completo: ordini in corso, stato macchina, problemi verificatisi, punti aperti - il successore √® completamente informato e non deve chiedere. Documenta tutti i dati rilevanti (BDE/MDE, protocolli qualit√†) in modo completo, corretto e puntuale. √à cordiale e disponibile. Supporta i colleghi nel proprio reparto anche spontaneamente quando vede che serve aiuto. Informa proattivamente capoturno e QC su osservazioni rilevanti. Comunica in modo rispettoso e costruttivo, anche in caso di divergenze.",
                    example: "Passaggio turno: Il successore pu√≤ continuare subito, tutte le info sono presenti. | Team: Vede che il collega ha bisogno di materiale, lo procura spontaneamente. | Documentazione: BDE sempre aggiornato, protocolli QC completi. | Comunicazione: In caso di problemi rimane obiettivo, senza attribuire colpe."
                  },
                  4: { 
                    text: "Riconosce necessit√† di supporto anche fuori dal proprio reparto diretto e offre aiuto. Trasferisce know-how in modo attivo e strutturato ai colleghi (mostra procedure, spiega correlazioni). Informa il turno successivo verbalmente su particolarit√† importanti oltre il passaggio standard. Comunica proattivamente con altri reparti (QC, tecnici, logistica) quando ci sono temi trasversali. √à riferimento per nuovi colleghi e supporta la loro integrazione.",
                    example: "Passaggio turno: Per temi critici chiama il successore anche quando √® libero. | Trasferimento know-how: Spiega ai colleghi PERCH√â certe impostazioni sono importanti. | Networking: Si coordina con QC prima che vengano raggiunti i limiti. | Nuovi colleghi: Li prende sotto la sua ala, risponde pazientemente."
                  },
                  5: { 
                    text: "Promuove attivamente la coesione del team e crea un'atmosfera di lavoro positiva. Media nei conflitti tra colleghi e trova soluzioni costruttive. Integra rapidamente i nuovi colleghi nel team e fa in modo che si sentano a loro agio. Promuove attivamente lo scambio di informazioni tra turni e reparti. √à visto come persona di fiducia dai colleghi e interpellato per questioni difficili. D√† feedback costruttivo e accetta apertamente il feedback.",
                    example: "Team building: Risolve discussioni tra colleghi in modo obiettivo e giusto. | Integrazione: Nuovi colleghi si sentono parte del team dopo pochi giorni. | Tra turni: Ha migliorato la routine di comunicazione tra turni. | Fiducia: I colleghi vengono da lui/lei con problemi, anche personali."
                  }
                }
              },
              {
                id: "pc3",
                title: "Problem Solving",
                category: "core",
                icon: Lightbulb,
                definition: "Gestione di guasti ed errori, ricerca autonoma di soluzioni, analisi sistematica delle cause, contributo al miglioramento continuo.",
                observationTips: [
                  "Fermo macchina: Con quanta rapidit√† e in modo appropriato si reagisce?",
                  "Problemi ricorrenti: Si cercano le cause?",
                  "Proposte di miglioramento: Vengono presentate?"
                ],
                levels: {
                  1: { 
                    text: "Ignora i problemi o non li segnala, anche quando sono evidenti. In caso di guasti aspetta passivamente senza agire o chiedere aiuto. Nasconde i propri errori invece di segnalarli e imparare. Per problemi ricorrenti fa sempre gli stessi errori senza imparare dall'esperienza. Si arrende facilmente di fronte alle difficolt√† o scarica la responsabilit√† su altri.",
                    example: "Guasto macchina: La macchina √® ferma - aspetta senza agire o segnalare finch√© il capoturno non se ne accorge. | Problema qualit√†: Continua a produrre nonostante deviazione evidente. | Errori propri: Nasconde lo scarto invece di segnalarlo. | Ripetizione: Fa sempre lo stesso errore di utilizzo."
                  },
                  2: { 
                    text: "Riconosce problemi e guasti in modo affidabile e li segnala tempestivamente al capoturno o ai tecnici - un contributo importante alla risoluzione. Descrive il problema in modo preciso: Cosa √® successo? Quando? Cosa si √® gi√† provato? Per guasti noti e documentati (es. inceppamento materiale, messaggi errore semplici) cerca di risolverli secondo checklist o istruzioni. In caso di incertezza o problemi pi√π complessi chiede supporto. La differenza con il Livello 3: Risolve problemi noti secondo ISTRUZIONI, per problemi sconosciuti principalmente SEGNALAZIONE e richiesta supporto.",
                    example: "Inceppamento: Riconosce l'inceppamento, tenta risoluzione secondo checklist. Se non funziona: chiama tecnico con info 'Inceppamento in posizione X, provati passi Y+Z'. | Problema qualit√†: Riconosce deviazione, informa capoturno in modo preciso. | Differenza Livello 3: Il Livello 3 analizza anche problemi sconosciuti autonomamente."
                  },
                  3: { 
                    text: "BASELINE: Risolve autonomamente e rapidamente i problemi quotidiani di produzione e macchina (eliminare inceppamenti, regolazioni parametri, guasti minori). Analizza sistematicamente le possibili cause prima di agire. Distingue con sicurezza cosa pu√≤ risolvere da solo e quando servono tecnici o capoturno - in quel caso informa in modo preciso e orientato alla soluzione (non solo 'macchina rotta', ma 'Sintomo X, probabilmente causa Y, proposta Z'). Documenta problemi e soluzioni per il passaggio turno.",
                    example: "Guasto macchina: Analizza sistematicamente (legge messaggio errore, controllo visivo, verifica cause tipiche), risolve autonomamente o escala con diagnosi chiara. | Problema qualit√†: Trova la causa (es. deviazione temperatura), corregge parametri. | Documentazione: Registra problema e soluzione nel libro turno."
                  },
                  4: { 
                    text: "Non cerca solo soluzioni rapide, ma le cause per prevenire il ripetersi. Riconosce pattern nei problemi ricorrenti e documenta osservazioni per analisi sistematica. Collabora costruttivamente con tecnici e QC per trovare soluzioni sostenibili. Pensa oltre la soluzione immediata: Cosa dobbiamo cambiare perch√© non succeda pi√π? Condivide le conoscenze acquisite dalla risoluzione problemi con i colleghi.",
                    example: "Analisi cause: Nota che il guasto si verifica sempre con un certo materiale - documenta e segnala ai tecnici per soluzione strutturale. | Prevenzione: Propone adeguamento intervalli manutenzione dopo che l'usura ha causato problemi. | Trasferimento know-how: Spiega ai colleghi come ha risolto il problema."
                  },
                  5: { 
                    text: "Analizza problemi complessi e persistenti in modo sistematico (es. con 5-Why, Ishikawa) e trova soluzioni durature. Presenta proposte di miglioramento (KVP) che eliminano definitivamente problemi o migliorano processi. Viene consultato come esperto per guasti difficili. Contribuisce proattivamente al miglioramento di istruzioni e checklist basandosi sull'esperienza pratica. Condivide sistematicamente il suo know-how di problem solving.",
                    example: "KVP: Ha presentato proposta di miglioramento che ha eliminato definitivamente un guasto ricorrente. | Expertise: Viene consultato dai tecnici come esperto pratico per problemi complessi. | Documentazione: Ha migliorato la checklist risoluzione guasti basandosi sulla propria esperienza."
                  }
                }
              },
              {
                id: "pc4",
                title: "Adattabilit√† & Flessibilit√†",
                category: "core",
                icon: BookOpen,
                definition: "Gestione dei cambiamenti, disponibilit√† ad assumere nuovi compiti, volont√† di apprendere.",
                observationTips: [
                  "Nuova istruzione di lavoro: Con quanta rapidit√† e volont√† viene implementata?",
                  "Carenza di personale: Si dimostra flessibilit√†?",
                  "Offerte formative: Vengono colte?"
                ],
                levels: {
                  1: { 
                    text: "Rifiuta attivamente i cambiamenti e si esprime ripetutamente in modo negativo su nuove richieste, processi o sistemi. Si rifiuta di assumere compiti diversi da quelli abituali o di intervenire in altre postazioni. Non mostra interesse per la formazione o l'apprendimento di nuove competenze. Blocca i miglioramenti con resistenza o rifiuto passivo. Insiste sul 'Abbiamo sempre fatto cos√¨.'",
                    example: "Cambiamento: Si esprime ripetutamente in modo negativo su nuovo software/processi, demotiva i colleghi. | Flessibilit√†: Si rifiuta di intervenire su altra linea in caso di carenza personale. | Formazione: Rifiuta l'offerta di corso. | Atteggiamento: 'Non √® compito mio.'"
                  },
                  2: { 
                    text: "√à fondamentalmente aperto alle novit√† e applica le nuove istruzioni. Per l'addestramento su nuove procedure, macchine o sistemi necessita di ISTRUZIONI da capoturno o colleghi esperti - l'apprendimento autonomo solo da documentazione scritta √® ancora difficile. Dopo l'addestramento applica le modifiche in modo affidabile e corretto. In caso di cambiamenti a breve termine (es. piano turni, sequenza ordini) mostra comprensione per le necessit√† aziendali. La differenza con il Livello 3: Ha bisogno di ADDESTRAMENTO per le novit√†; non si forma ancora autonomamente.",
                    example: "Nuova macchina: Ha bisogno di addestramento dal capoturno; leggere solo la documentazione non basta ancora. Poi: utilizzo affidabile. | Piano turni: Interviene in caso di carenza se il capoturno lo chiede. | Differenza Livello 3: Il Livello 3 legge nuova istruzione e la applica dopo breve verifica autonomamente."
                  },
                  3: { 
                    text: "BASELINE: √à aperto e costruttivo verso i cambiamenti. Si forma autonomamente su nuove istruzioni, processi o sistemi dopo documentazione e breve addestramento. Interviene quando serve in altre postazioni nello stesso reparto e assume sostituzioni. Applica nuove disposizioni rapidamente e senza grandi discussioni. Partecipa alle offerte formative e applica quanto appreso. Si adatta in modo flessibile a requisiti variabili (modifiche ordini, cambio priorit√†).",
                    example: "Formazione: Legge nuova istruzione, prova sotto supervisione, poi lavora autonomamente. | Flessibilit√†: Assume sostituzione su macchina vicina in caso di malattia dopo breve addestramento. | Cambiamenti: Accetta modifiche ordini a breve termine senza lamentarsi. | Corso: Applica le nuove conoscenze nel quotidiano."
                  },
                  4: { 
                    text: "Assume proattivamente nuovi compiti e responsabilit√† senza essere chiesto. Chiede attivamente opportunit√† di apprendimento e formazione per svilupparsi. Si adatta molto rapidamente a nuove situazioni ed √® subito produttivo anche con cambiamenti imprevisti. √à disposto a formarsi e qualificarsi in altri reparti. Supporta i colleghi nell'addestramento alle novit√† e aiuta nell'accettazione dei cambiamenti.",
                    example: "Proattivit√†: Chiede spontaneamente addestramento su nuovo impianto. | Adattamento rapido: Dopo un giorno di addestramento √® impiegabile produttivamente. | Trasversale: Si fa qualificare volontariamente per altro reparto. | Supporto: Aiuta colleghi scettici a vedere i vantaggi dei nuovi processi."
                  },
                  5: { 
                    text: "√à qualificato come jolly su pi√π impianti/in pi√π reparti ed √® impiegabile produttivamente ovunque (funzione jolly). Viene impiegato miratamente in fasi di avviamento, nuovi prodotti o situazioni critiche. Promuove attivamente miglioramenti e cambiamenti ed √® moltiplicatore per nuovi metodi e processi. Aiuta i colleghi a superare lo scetticismo verso i cambiamenti. √à aperto a compiti completamente nuovi anche fuori dall'ambito attuale.",
                    example: "Jolly: Pu√≤ lavorare autonomamente su 3+ impianti diversi. | Avviamento: Viene impiegato per l'avviamento di nuovi prodotti/ricette. | Moltiplicatore: I colleghi perdono lo scetticismo grazie a lui/lei. | Flessibilit√†: Assume temporaneamente anche compiti in altri reparti."
                  }
                }
              },
              {
                id: "pc5",
                title: "Auto-organizzazione",
                category: "core",
                icon: Clock,
                definition: "Rispetto degli standard 5S, puntualit√†, pulizia del posto di lavoro, preparazione previdente del lavoro.",
                observationTips: [
                  "Inizio turno: Il collaboratore √® puntuale e pronto?",
                  "Posto di lavoro a fine turno: In che stato viene lasciato?",
                  "Pause: Vengono rispettate?",
                  "Disponibilit√† materiale: √à stato preparato in anticipo?"
                ],
                levels: {
                  1: { 
                    text: "Il posto di lavoro √® regolarmente disordinato e non rispetta lo standard 5S. Utensili e materiali non sono al loro posto, causando ritardi e rischi di infortunio. Arriva ripetutamente in ritardo al turno o non √® pronto all'inizio turno. Sfora le pause senza accordo, causando fermi macchina o necessit√† di copertura dei colleghi. Non prepara il materiale, causando fermi per mancanza.",
                    example: "Ordine: Il successore deve prima riordinare prima di poter lavorare. Utensili sparsi. | Puntualit√†: Arriva in ritardo pi√π volte al mese senza preavviso. | Pause: Sfora la pausa di 15 minuti, il collega deve restare alla macchina. | Preparazione: Materiale esaurito - macchina ferma."
                  },
                  2: { 
                    text: "√à puntuale e mantiene il posto di lavoro fondamentalmente ordinato - lo standard 5S viene rispettato PREVALENTEMENTE, con occasionali promemoria dal capoturno (es. durante i giri 5S). Materiale e utensili vengono preparati per il lavoro. Rispetta i tempi di pausa. In caso di alto carico o stress la preparazione pu√≤ a volte essere pi√π stretta o l'ordine un po' soffrire. La differenza con il Livello 3: Mantiene l'ordine con PROMEMORIA OCCASIONALI; al Livello 3 AUTONOMAMENTE e anche sotto stress.",
                    example: "Ordine: Posto di lavoro per lo pi√π ordinato; occasionali osservazioni agli audit 5S. | Preparazione: Materiale preparato; in caso di picchi a volte stretto. | Puntualit√†: Affidabilmente puntuale e pronto. | Differenza Livello 3: Il Livello 3 mantiene 5S anche senza promemoria e sotto stress."
                  },
                  3: { 
                    text: "BASELINE: √à puntuale, preparato e subito operativo all'inizio turno. Mantiene lo standard 5S autonomamente e costantemente - anche senza controllo e anche sotto pressione. Utensili e materiali sono sempre al loro posto, l'area di lavoro √® sicura e ordinata. Prepara il materiale in anticipo cos√¨ non ci sono fermi per mancanza. Organizza la copertura pause in modo affidabile. Documenta in modo completo e aggiornato. Il posto di lavoro a fine turno √® pronto per il passaggio.",
                    example: "5S: Il posto di lavoro rispetta lo standard ad ogni controllo. | Preparazione: Il materiale per l'ordine successivo √® pronto, utensili verificati. | Copertura pause: Organizza la copertura da solo, macchina mai ferma per pausa. | Passaggio: Il successore trova posto ordinato e documentato."
                  },
                  4: { 
                    text: "Utilizza i tempi morti (es. durante il funzionamento macchina) in modo sensato per preparazione, ordine o documentazione. Organizza il rifornimento materiale in modo cos√¨ previdente che non ci sono mai carenze. Il posto di lavoro rimane ordinato e sicuro anche dopo fasi stressanti. Pianifica il proprio lavoro in anticipo considerando le interdipendenze (es. lavori preparatori per turno successivo). Ottimizza continuamente le proprie procedure per maggiore efficienza.",
                    example: "Uso tempi morti: Durante il funzionamento macchina prepara materiale per ordine successivo. | Previsione: Riordina materiale prima che scarseggi. | Resistenza stress: Posto ordinato anche dopo turno di 12 ore. | Efficienza: Ha ottimizzato la propria routine di attrezzaggio, risparmia tempo."
                  },
                  5: { 
                    text: "Ha ottimizzato il proprio posto di lavoro cos√¨ che viene citato come esempio per 5S e organizzazione efficiente. Viene menzionato come modello negli audit 5S. Sviluppa idee per l'organizzazione del posto di lavoro che aiutano anche altri colleghi (es. migliore disposizione utensili, visualizzazioni). Condivide i suoi metodi organizzativi con i colleghi. Pensa oltre il proprio posto e supporta il miglioramento continuo in tutto il reparto.",
                    example: "Modello: Il posto di lavoro viene mostrato come best practice nelle formazioni 5S. | Miglioramento: Ha sviluppato pannello utensili che ora usano tutti. | Trasferimento know-how: Mostra ai nuovi colleghi l'organizzazione efficiente del lavoro. | Ottimizzazione reparto: Ha proposto miglioramento per l'approvvigionamento materiale implementato in tutto il reparto."
                  }
                }
              }
            ]
          },
          en: {
            intro: {
              title: "Production & Logistics",
              subtitle: "BARS Assessment Guide",
              description: "This guide helps you objectively and transparently assess the work behavior of your employees in production and logistics.",
              selfAssessmentNote: "Note: In production, the employee's self-assessment is requested directly during the conversation to address it immediately.",
              rules: [
                { title: "Observe instead of interpret", desc: "Only assess what you have actually observed. Can you cite a concrete example from the last 12 months?" },
                { title: "Assess typical behavior", desc: "The assessment should reflect regularly shown behavior, not exceptions." },
                { title: "Level 3 is the standard", desc: "Baseline means: The employee fulfills the requirements of their position reliably and independently." }
              ]
            },
            competencies: [
              {
                id: "pc1",
                title: "Technical Competence & Quality",
                category: "core",
                icon: Briefcase,
                definition: "Safe machine operation, work according to instructions, compliance with hygiene and safety standards, quality awareness.",
                observationTips: [
                  "Shift change: Is the machine correctly set up and ready for handover?",
                  "Malfunction: Is the response and documentation according to instructions?",
                  "Routine check: Is personal protective equipment worn consistently?",
                  "Quality check: Are deviations independently recognized and reported?",
                  "Logistics: Picking accuracy, correct bookings, load securing"
                ],
                levels: {
                  1: { 
                    text: "Works repeatedly incorrectly or unsafely and causes avoidable scrap or quality problems. Does not consistently follow safety regulations (PPE, protective devices) despite reminders. Does not recognize quality deviations or fails to report them. Does not operate the equipment according to instructions and causes machine damage or stoppages through misuse.",
                    example: "Extrusion: Ignores temperature warnings, film tears repeatedly. | Printing: Starts production despite visible color deviation. | Heat sealing: Seal not airtight, only discovered at final inspection. | General: Does not wear hearing protection in noisy areas despite reminders."
                  },
                  2: { 
                    text: "Masters standard procedures on assigned equipment and works safely according to instructions. Performs prescribed quality checks (visual inspection, dimensional control, seal inspection) diligently and documents results. Produces in normal operation with acceptable scrap rate within targets. For deviations from standard (material change, product changeover, unusual faults) seeks support from shift leader or experienced colleagues. The difference to Level 3: Works safely in NORMAL OPERATION, still needs SUPPORT for deviations.",
                    example: "Extrusion: Performs thickness measurement correctly, calls technician for deviations. | Printing: Checks color sample against reference, stops and calls shift leader for deviations. | Heat sealing: Performs seal inspection according to instructions. | Difference to Level 3: Level 3 employee corrects standard deviations independently."
                  },
                  3: { 
                    text: "BASELINE: Operates assigned equipment safely, independently and efficiently. Performs all prescribed quality checks autonomously and reliably recognizes deviations. Corrects standard deviations (temperature, speed, tension) independently according to parameters. Scrap rate is consistently at or below target. Performs product changes and setups independently according to instructions, meeting setup time targets. Documents all relevant data completely and correctly. Recognizes when technical support is needed and then informs precisely.",
                    example: "Extrusion: Corrects thickness deviation by parameter adjustment within allowed range. Completes material change within target time. | Printing: Performs color correction for minor deviations independently. Registration consistently accurate. | Heat sealing: Recognizes seal problems immediately, adjusts temperature/pressure. | Logistics: Picks without errors, system bookings up to date."
                  },
                  4: { 
                    text: "Works very precisely and proactively on equipment. Recognizes emerging quality problems early (before scrap occurs) through careful observation of process parameters, sounds or appearance. Understands the relationships between settings and product quality (the 'why' behind instructions). Optimizes setup times through good preparation and efficient procedures. Delivers reliable quality even with difficult materials or products. Recognizes wear signs and proactively reports maintenance needs before failures occur.",
                    example: "Extrusion: Hears slight change in extruder sound, reports bearing wear before failure. | Printing: Recognizes from minimal color drift that doctor blade condition should be checked. | Heat sealing: Notices sealing bar needs reheating before first seal defect occurs. | Regularly beats setup time targets."
                  },
                  5: { 
                    text: "Is technical authority in the area and is consulted by colleagues and supervisors for difficult questions. Masters multiple machines (multi-skilled) and can be deployed flexibly. Trains new colleagues competently and systematically transfers knowledge. Independently develops improvement suggestions that demonstrably improve quality or reduce scrap. Actively contributes to process optimization and works constructively with technicians and QC. Independently starts up new products or recipes.",
                    example: "Extrusion: Is go-to person for difficult materials. Submitted improvement suggestion that reduced scrap by 15%. | Printing: Masters all printing machines, called for startup problems. | Heat sealing: Can run all bag types, independently optimizes new products. | Gets contacted by other shifts for problems."
                  }
                }
              },
              {
                id: "pc2",
                title: "Communication & Collaboration",
                category: "core",
                icon: MessageCircle,
                definition: "Quality of shift handover, information sharing, helpfulness, constructive tone.",
                observationTips: [
                  "Shift handover: Are all relevant information completely documented?",
                  "Bottleneck situation: Are colleagues helped spontaneously?",
                  "Conflict: How are disagreements handled?",
                  "New colleagues: Are they actively integrated?"
                ],
                levels: {
                  1: { 
                    text: "Does not communicate important information or communicates incompletely. Leaves workplace at shift end without proper handover, so successor is not informed about ongoing orders, problems or machine status. Does not pass on relevant observations. Works in isolation and does not support colleagues even when obviously needed. Reacts negatively to criticism or suggestions.",
                    example: "Shift handover: Leaves on time without info about ongoing fault - successor produces scrap. | Teamwork: Sees colleague needs material but does not help. | Fault: Does not report machine problem, waits until shift end. | Safety: Notices oil puddle, informs no one."
                  },
                  2: { 
                    text: "Performs shift handover and passes on essential information (current order, machine status, known problems). For details, successor sometimes has to ask. Documents production data completely. Is friendly and helpful when colleagues ask for support. Works constructively in team. Reports faults and quality problems to shift leader. Proactive information without explicit request is still developing. The difference to Level 3: Passes on info IF ASKED or when obviously relevant - not yet consistently proactive and complete.",
                    example: "Shift handover: Core info passed on; successor must ask for special topics. | Teamwork: Gladly helps when approached. | Documentation: Production data entries complete and timely. | Difference to Level 3: Level 3 hands over so completely that no questions are needed."
                  },
                  3: { 
                    text: "BASELINE: Makes punctual, complete shift handover: current orders, machine status, problems occurred, open items - successor is fully informed and does not need to ask. Documents all relevant data completely, correctly and timely. Is friendly and helpful. Supports colleagues in own area also unprompted when seeing help is needed. Proactively informs shift leader and QC about relevant observations. Communicates respectfully and constructively.",
                    example: "Shift handover: Successor can continue immediately, all info is there. | Teamwork: Sees colleague needs material, fetches it unprompted. | Documentation: Production data always current, QC protocols complete. | Communication: Stays objective on problems, no blame."
                  },
                  4: { 
                    text: "Recognizes support needs also outside own direct area and offers help. Actively and systematically transfers knowledge to colleagues (shows techniques, explains relationships). Verbally informs next shift about important specifics beyond standard handover. Proactively communicates with other departments when cross-functional topics arise. Is point of contact for new colleagues and supports their integration.",
                    example: "Shift handover: For critical topics even calls successor when off duty. | Knowledge transfer: Explains to colleagues WHY certain settings are important. | Networking: Coordinates with QC before limits are reached. | New colleagues: Takes them under wing, answers questions patiently."
                  },
                  5: { 
                    text: "Actively promotes team cohesion and ensures positive working atmosphere. Mediates in conflicts between colleagues and finds constructive solutions. Quickly integrates new colleagues into the team. Actively drives information exchange between shifts and areas. Is seen as trusted person by colleagues and approached for difficult topics. Gives constructive feedback and openly accepts feedback.",
                    example: "Team building: Resolves disputes between colleagues objectively and fairly. | Integration: New colleagues feel part of team after few days. | Cross-shift: Has improved communication routine between shifts. | Trust: Colleagues come with problems, even personal ones."
                  }
                }
              },
              {
                id: "pc3",
                title: "Problem Solving",
                category: "core",
                icon: Lightbulb,
                definition: "Handling of malfunctions and errors, independent solution finding, systematic root cause analysis, contribution to continuous improvement.",
                observationTips: [
                  "Machine stoppage: How quickly and appropriately is the response?",
                  "Recurring problems: Are causes being investigated?",
                  "Improvement suggestions: Are any submitted?"
                ],
                levels: {
                  1: { 
                    text: "Ignores problems or does not report them, even when obvious. Waits passively during faults without acting or getting help. Hides own mistakes instead of reporting and learning from them. Makes the same errors repeatedly for recurring problems without learning from experience. Gives up quickly when facing difficulties or shifts responsibility to others.",
                    example: "Machine fault: Machine is down - waits without acting or reporting until shift leader notices. | Quality problem: Continues producing despite obvious deviation. | Own errors: Hides scrap instead of reporting. | Repetition: Makes same operating error repeatedly."
                  },
                  2: { 
                    text: "Reliably recognizes problems and faults and reports them promptly to shift leader or technicians - an important first contribution to problem solving. Describes the problem precisely: What happened? When? What was already tried? For known, documented faults tries to fix according to checklist or instructions. For uncertainty or more complex problems, gets support. The difference to Level 3: Solves known problems according to INSTRUCTIONS, for unknown problems primarily REPORTING and getting support.",
                    example: "Material jam: Recognizes jam, attempts fix per checklist. If that does not work: calls technician with info. | Quality problem: Recognizes deviation, informs shift leader precisely. | Difference to Level 3: Level 3 also analyzes unknown problems independently."
                  },
                  3: { 
                    text: "BASELINE: Solves everyday production and machine problems independently and promptly (clearing jams, parameter adjustments, minor faults). Systematically analyzes possible causes before acting. Reliably distinguishes what can be solved alone and when technicians or shift leader are needed - then informs precisely and solution-oriented. Documents problems and solutions for shift handover.",
                    example: "Machine fault: Analyzes systematically, fixes independently or escalates with clear diagnosis. | Quality problem: Finds cause (e.g. temperature deviation), corrects parameters. | Documentation: Records problem and solution in shift log."
                  },
                  4: { 
                    text: "Does not just seek quick fixes but root causes to prevent recurrence. Recognizes patterns in recurring problems and documents observations for systematic analysis. Works constructively with technicians and QC to find sustainable solutions. Thinks beyond immediate solution. Shares insights from problem solving with colleagues.",
                    example: "Root cause analysis: Notices fault always occurs with certain material - documents and reports to technicians for structural solution. | Prevention: Suggests maintenance interval adjustment after wear caused problems. | Knowledge transfer: Explains to colleagues how problem was solved."
                  },
                  5: { 
                    text: "Systematically analyzes stubborn, complex problems (e.g. with 5-Why, Ishikawa) and finds lasting solutions. Submits improvement suggestions that demonstrably eliminate problems permanently or improve processes. Is consulted as expert for difficult faults. Proactively contributes to improving work instructions and checklists based on practical experience. Systematically shares problem-solving knowledge.",
                    example: "Improvement: Submitted suggestion that permanently fixed recurring fault. | Expertise: Gets consulted by technicians as practical expert for complex problems. | Documentation: Improved troubleshooting checklist based on own experience."
                  }
                }
              },
              {
                id: "pc4",
                title: "Adaptability & Flexibility",
                category: "core",
                icon: BookOpen,
                definition: "Handling of changes, willingness to take on new tasks, learning readiness.",
                observationTips: [
                  "New work instruction: How quickly and willingly is it implemented?",
                  "Staff shortage: Is flexibility shown?",
                  "Training offers: Are they taken up?"
                ],
                levels: {
                  1: { 
                    text: "Actively rejects changes and repeatedly expresses negativity about new requirements, processes or systems. Refuses to take on tasks other than usual or to help at other workstations. Shows no interest in training or learning new skills. Blocks improvements through resistance or passive refusal. Insists on 'We have always done it this way.'",
                    example: "Change: Repeatedly negative about new software/processes, demotivates colleagues. | Flexibility: Refuses to help at other line during staff shortage. | Training: Declines training offer. | Attitude: 'That is not my job.'"
                  },
                  2: { 
                    text: "Is fundamentally open to new things and implements new instructions. For training on new procedures, machines or systems, needs INSTRUCTION from shift leader or experienced colleagues - independent learning from written documentation alone is still difficult. After instruction, implements changes reliably and correctly. For short-term changes shows understanding for operational needs. The difference to Level 3: Needs INSTRUCTION for new things; does not yet learn independently.",
                    example: "New machine: Needs instruction from shift leader; just reading documentation is not enough yet. Then: reliable operation. | Shift plan: Helps during staff shortage when shift leader asks. | Difference to Level 3: Level 3 reads new instruction and implements after brief check independently."
                  },
                  3: { 
                    text: "BASELINE: Is open and constructive toward changes. Learns new instructions, processes or systems independently after documentation and brief instruction. Helps at other workstations in same area when needed and covers absences. Implements new requirements promptly without much discussion. Attends training and applies what is learned. Adapts flexibly to changing requirements.",
                    example: "Learning: Reads new instruction, tries under supervision, then works independently. | Flexibility: Covers at neighboring machine during sickness after brief instruction. | Changes: Accepts short-term order changes without complaint. | Training: Applies new knowledge from training in daily work."
                  },
                  4: { 
                    text: "Proactively takes on new tasks and responsibilities without being asked. Actively asks for learning opportunities and training to develop. Adapts very quickly to new situations and is immediately productive even with unforeseen changes. Is willing to learn and qualify in other areas. Supports colleagues in adapting to new things and helps with acceptance of changes.",
                    example: "Proactivity: Asks unprompted for training on new equipment. | Quick adaptation: Productively deployable after one day of instruction. | Cross-functional: Voluntarily qualifies for other area. | Support: Helps skeptical colleagues see benefits of new processes."
                  },
                  5: { 
                    text: "Is qualified as multi-skilled on several machines/in several areas and productively deployable everywhere. Is specifically deployed during startups, new products or critical situations. Actively drives improvements and changes and is multiplier for new methods and processes. Helps colleagues overcome change skepticism. Is open to completely new tasks even outside previous scope.",
                    example: "Multi-skilled: Can work independently on 3+ different machines. | Startup: Gets deployed for new product/recipe startups. | Multiplier: Colleagues lose skepticism through them. | Flexibility: Temporarily takes on tasks in other departments."
                  }
                }
              },
              {
                id: "pc5",
                title: "Self-Organization",
                category: "core",
                icon: Clock,
                definition: "Compliance with 5S standards, punctuality, workplace cleanliness, forward-looking work preparation.",
                observationTips: [
                  "Shift start: Is the employee punctual and ready?",
                  "Workplace at shift end: In what condition is it handed over?",
                  "Break times: Are they observed?",
                  "Material availability: Was it prepared in advance?"
                ],
                levels: {
                  1: { 
                    text: "Workplace is regularly messy and does not meet 5S standard. Tools and materials are not in place, causing work delays and accident risks. Repeatedly arrives late to shift or is not ready at shift start. Exceeds breaks without agreement, causing machine downtime or colleagues having to cover. Does not prepare material, causing stoppages from shortages.",
                    example: "Order: Successor must first clean up before working. Tools lying around. | Punctuality: Arrives late multiple times per month without warning. | Breaks: Exceeds break by 15 minutes, colleague must stay at machine longer. | Preparation: Material out - machine stops."
                  },
                  2: { 
                    text: "Is punctual and keeps workplace basically tidy - 5S standard is MOSTLY maintained, with occasional reminders from shift leader. Material and tools are prepared for work. Keeps to break times. During high workload or stress, preparation may sometimes be tighter or order may suffer slightly. The difference to Level 3: Maintains order with OCCASIONAL REMINDERS; at Level 3 INDEPENDENTLY and also under stress.",
                    example: "Order: Workplace mostly tidy; occasional notes at 5S audits. | Preparation: Material prepared; sometimes tight during peaks. | Punctuality: Reliably punctual and ready. | Difference to Level 3: Level 3 maintains 5S without reminders and under stress."
                  },
                  3: { 
                    text: "BASELINE: Is punctual, prepared and immediately ready at shift start. Maintains 5S standard independently and consistently - even without supervision and under time pressure. Tools and materials are always in place, work area is safe and tidy. Prepares material proactively so no stoppages from shortages. Reliably organizes break coverage. Documents completely and currently. Workplace is handover-ready at shift end.",
                    example: "5S: Workplace meets standard at every check. | Preparation: Material for next order ready, tools checked. | Break coverage: Arranges coverage himself, machine never stops for break. | Handover: Successor finds tidy, documented workplace."
                  },
                  4: { 
                    text: "Uses idle times sensibly for preparation, order or documentation. Organizes material resupply so proactively that shortages never occur. Workplace stays tidy and safe even after stressful phases. Plans own work ahead considering dependencies. Continuously optimizes own workflows for more efficiency.",
                    example: "Idle time use: Prepares material for next order during machine run. | Foresight: Reorders material before it runs low. | Stress resistance: Workplace tidy even after 12-hour shift. | Efficiency: Has optimized own setup routine, saves time."
                  },
                  5: { 
                    text: "Has optimized own workplace to be model example for 5S and efficient organization. Is mentioned as role model in 5S audits. Develops ideas for workplace organization that help other colleagues too. Shares organizational methods with colleagues. Thinks beyond own workplace and supports continuous improvement across the area.",
                    example: "Role model: Workplace shown as best practice in 5S training. | Improvement: Developed tool board that everyone now uses. | Knowledge transfer: Shows new colleagues efficient work organization. | Area optimization: Made suggestion for better material provision implemented across area."
                  }
                }
              }
            ]
          }
        };

        // --- QUIZ DATA (Removed, but keeping definition for completeness) ---
        const QUIZ_QUESTIONS = { de: [], it: [], en: [] }; // Leeren, da Quiz entfernt wird

        // --- REACT COMPONENT ---

        // ============================================
        // PRINT LAYOUT COMPONENT - Professioneller PDF-Export
        // ============================================
        // =====================================================
        // UNIVERSAL PDF PRINT LAYOUT COMPONENT
        // Erstellt professionelle DIN A4 PDFs f√ºr alle Dokumenttypen
        // Alle Ma√üe in PIXEL f√ºr html2pdf.js Kompatibilit√§t
        // A4 Content-Breite: 680px (794px - 2√ó57px R√§nder)
        // =====================================================
        const PrintLayout = ({ type, data, lang }) => {
          const e = React.createElement;
          
          // === KONSTANTEN f√ºr Layout (alle in px) ===
          const CONTENT_WIDTH = 680; // A4 abzgl. 15mm R√§nder beidseitig
          const PADDING = 40;
          const PRIMARY_COLOR = '#243186';
          const ACCENT_COLOR = '#6EBD84';
          
          // === Texte f√ºr verschiedene Sprachen ===
          const texts = {
            de: {
              coverTitle: type === 'goals' ? 'Zielvereinbarung' : type === 'review' ? 'Leistungsbeurteilung' : 'Selbstreflexion',
              coverSubtitle: 'Performance Management',
              period: 'Bewertungszeitraum',
              employee: 'Mitarbeiter/in',
              manager: 'F√ºhrungskraft',
              position: 'Position',
              department: 'Abteilung',
              date: 'Datum',
              confidential: 'Vertraulich - Nur f√ºr den internen Gebrauch',
              goals: 'Ziele',
              weight: 'Gew.',
              target: 'Zielwert / Beschreibung',
              achievement: 'Erreichung',
              barsScore: 'BARS',
              development: 'Entwicklungsma√ünahmen',
              measure: 'Ma√ünahme',
              responsible: 'Verantwortlich',
              deadline: 'Termin',
              signatures: 'Unterschriften',
              signatureNote: 'Mit ihrer Unterschrift best√§tigen beide Parteien die Kenntnisnahme und Zustimmung.',
              dateSignature: 'Datum, Unterschrift',
              plannedBonus: 'Geplanter Bonus bei 100%',
              coreComp: 'Kern-Kompetenzen',
              leadComp: 'F√ºhrungs-Kompetenzen',
              competency: 'Kompetenz',
              rating: 'Rating',
              comment: 'Begr√ºndung',
              strengths: 'St√§rken & Entwicklungsfelder',
              professional: 'Fachliche St√§rken',
              personal: 'Pers√∂nliche St√§rken',
              devAreas: 'Entwicklungsbereiche',
              gpsResult: 'GPS Ergebnis'
            },
            it: {
              coverTitle: type === 'goals' ? 'Accordo sugli Obiettivi' : type === 'review' ? 'Valutazione delle Prestazioni' : 'Autovalutazione',
              coverSubtitle: 'Performance Management',
              period: 'Periodo di valutazione',
              employee: 'Collaboratore',
              manager: 'Responsabile',
              position: 'Posizione',
              department: 'Reparto',
              date: 'Data',
              confidential: 'Riservato - Solo per uso interno',
              goals: 'Obiettivi',
              weight: 'Peso',
              target: 'Valore target / Descrizione',
              achievement: 'Raggiungimento',
              barsScore: 'BARS',
              development: 'Misure di sviluppo',
              measure: 'Misura',
              responsible: 'Responsabile',
              deadline: 'Scadenza',
              signatures: 'Firme',
              signatureNote: "Con la firma, entrambe le parti confermano la presa visione e l'accordo.",
              dateSignature: 'Data, Firma',
              plannedBonus: 'Bonus previsto al 100%',
              coreComp: 'Competenze Core',
              leadComp: 'Competenze di Leadership',
              competency: 'Competenza',
              rating: 'Valutazione',
              comment: 'Motivazione',
              strengths: 'Punti di forza e Aree di sviluppo',
              professional: 'Punti di forza professionali',
              personal: 'Punti di forza personali',
              devAreas: 'Aree di sviluppo',
              gpsResult: 'Risultato GPS'
            },
            en: {
              coverTitle: type === 'goals' ? 'Goal Agreement' : type === 'review' ? 'Performance Review' : 'Self-Reflection',
              coverSubtitle: 'Performance Management',
              period: 'Review Period',
              employee: 'Employee',
              manager: 'Manager',
              position: 'Position',
              department: 'Department',
              date: 'Date',
              confidential: 'Confidential - Internal Use Only',
              goals: 'Goals',
              weight: 'Weight',
              target: 'Target Value / Description',
              achievement: 'Achievement',
              barsScore: 'BARS',
              development: 'Development Measures',
              measure: 'Measure',
              responsible: 'Responsible',
              deadline: 'Deadline',
              signatures: 'Signatures',
              signatureNote: 'With their signature, both parties confirm acknowledgment and agreement.',
              dateSignature: 'Date, Signature',
              plannedBonus: 'Planned Bonus at 100%',
              coreComp: 'Core Competencies',
              leadComp: 'Leadership Competencies',
              competency: 'Competency',
              rating: 'Rating',
              comment: 'Comment',
              strengths: 'Strengths & Development Areas',
              professional: 'Professional Strengths',
              personal: 'Personal Strengths',
              devAreas: 'Development Areas',
              gpsResult: 'GPS Result'
            }
          };
          
          const t = texts[lang] || texts.de;
          const currentDate = new Date().toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB');
          
          // === HELPER FUNCTIONS ===
          const formatNumber = (num) => new Intl.NumberFormat(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB').format(num);
          
          const safeText = (str) => str || '‚Äì';
          
          const getBarsScore = (achievement) => {
            const pct = parseFloat(achievement) || 0;
            if (pct >= 130) return 5;
            if (pct >= 111) return 4;
            if (pct >= 90) return 3;
            if (pct >= 70) return 2;
            return 1;
          };
          
          const getRatingColor = (rating) => {
            const r = parseInt(rating) || 3;
            if (r <= 1) return '#dc2626';
            if (r === 2) return '#f59e0b';
            if (r === 3) return '#3b82f6';
            if (r === 4) return '#22c55e';
            return '#059669';
          };

          // === REUSABLE COMPONENTS ===
          
          // PDF Header (f√ºr alle Seiten nach Cover)
          const PageHeader = ({ showEmployee = true }) => e('div', { 
            style: { 
              display: 'flex', 
              justifyContent: 'space-between', 
              alignItems: 'center', 
              marginBottom: '20px', 
              paddingBottom: '12px', 
              borderBottom: '2px solid ' + PRIMARY_COLOR,
              width: '100%'
            }
          },
            e('div', null,
              e('div', { style: { color: PRIMARY_COLOR, fontSize: '20px', fontWeight: 700, letterSpacing: '-0.5px' } }, 'niederwieser'),
              e('div', { style: { color: ACCENT_COLOR, fontSize: '9px', marginTop: '2px', letterSpacing: '2px', fontWeight: 600 } }, 'PERFORMANCE MANAGEMENT')
            ),
            showEmployee && e('div', { style: { textAlign: 'right' } },
              e('div', { style: { color: '#475569', fontSize: '11px' } }, data.employee || '‚Äì'),
              e('div', { style: { color: '#94a3b8', fontSize: '10px', marginTop: '2px' } }, data.period || new Date().getFullYear())
            )
          );
          
          // Section Header
          const SectionHeader = ({ title, color = PRIMARY_COLOR, score = null }) => e('div', {
            style: {
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              background: '#f8fafc',
              padding: '10px 14px',
              borderLeft: '4px solid ' + color,
              marginBottom: '12px',
              pageBreakAfter: 'avoid'
            }
          },
            e('div', { style: { fontSize: '14px', fontWeight: 600, color: color } }, title),
            score !== null && e('span', { 
              style: { 
                background: color === ACCENT_COLOR ? '#dcfce7' : '#dbeafe',
                color: color === ACCENT_COLOR ? '#166534' : '#1e40af',
                padding: '4px 12px',
                borderRadius: '12px',
                fontSize: '11px',
                fontWeight: 700
              }
            }, 'Score: ' + score.toFixed(2))
          );
          
          // Text Display Block (ersetzt textarea/input)
          const TextBlock = ({ content, minHeight = 30 }) => e('div', {
            style: {
              padding: '10px 12px',
              border: '1px solid #e2e8f0',
              borderRadius: '4px',
              background: '#fafafa',
              minHeight: minHeight + 'px',
              fontSize: '11px',
              lineHeight: 1.5,
              whiteSpace: 'pre-wrap',
              wordWrap: 'break-word',
              overflowWrap: 'break-word',
              color: '#334155'
            }
          }, content || '‚Äì');

          // === COVER PAGE ===
          const CoverPage = () => e('div', { 
            style: { 
              pageBreakAfter: 'always', 
              minHeight: '900px',
              display: 'flex',
              flexDirection: 'column',
              padding: PADDING + 'px',
              boxSizing: 'border-box',
              width: CONTENT_WIDTH + 'px'
            }
          },
            // Logo & Branding
            e('div', { style: { marginBottom: '60px' } },
              e('div', { style: { color: PRIMARY_COLOR, fontSize: '36px', fontWeight: 700, letterSpacing: '-1px' } }, 'niederwieser'),
              e('div', { style: { color: ACCENT_COLOR, fontSize: '11px', marginTop: '4px', fontWeight: 600, letterSpacing: '2px' } }, 'FLEXIBLE FOOD PACKAGING')
            ),
            
            // Haupttitel
            e('div', { style: { flex: 1, display: 'flex', flexDirection: 'column', justifyContent: 'center' } },
              e('div', { style: { 
                background: 'linear-gradient(135deg, ' + PRIMARY_COLOR + ' 0%, #1a2564 100%)', 
                color: 'white', 
                padding: '30px 40px',
                borderRadius: '8px',
                marginBottom: '40px'
              }},
                e('div', { style: { fontSize: '28px', fontWeight: 700 } }, t.coverTitle),
                e('div', { style: { fontSize: '14px', marginTop: '8px', opacity: 0.9 } }, t.coverSubtitle)
              ),
              
              // Stammdaten-Box
              e('div', { style: { 
                background: '#f8fafc', 
                border: '1px solid #e2e8f0',
                borderRadius: '6px',
                padding: '24px 30px'
              }},
                e('div', { style: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' } },
                  e('div', null,
                    e('div', { style: { color: '#64748b', fontSize: '10px', marginBottom: '4px', textTransform: 'uppercase', letterSpacing: '1px' } }, t.employee),
                    e('div', { style: { color: '#1e293b', fontSize: '14px', fontWeight: 600 } }, data.employee || '‚Äì')
                  ),
                  e('div', null,
                    e('div', { style: { color: '#64748b', fontSize: '10px', marginBottom: '4px', textTransform: 'uppercase', letterSpacing: '1px' } }, t.manager),
                    e('div', { style: { color: '#1e293b', fontSize: '14px', fontWeight: 600 } }, data.manager || '‚Äì')
                  ),
                  e('div', null,
                    e('div', { style: { color: '#64748b', fontSize: '10px', marginBottom: '4px', textTransform: 'uppercase', letterSpacing: '1px' } }, t.position),
                    e('div', { style: { color: '#1e293b', fontSize: '12px' } }, data.position || '‚Äì')
                  ),
                  e('div', null,
                    e('div', { style: { color: '#64748b', fontSize: '10px', marginBottom: '4px', textTransform: 'uppercase', letterSpacing: '1px' } }, t.period),
                    e('div', { style: { color: '#1e293b', fontSize: '12px' } }, data.period || new Date().getFullYear())
                  )
                )
              )
            ),
            
            // Footer
            e('div', { style: { textAlign: 'center', paddingTop: '30px', borderTop: '1px solid #e2e8f0' } },
              e('div', { style: { color: '#dc2626', fontSize: '10px', fontWeight: 600, marginBottom: '4px' } }, t.confidential),
              e('div', { style: { color: '#cbd5e1', fontSize: '9px' } }, t.date + ': ' + currentDate)
            )
          );

          // === GOALS PAGE ===
          const GoalsPage = () => {
            if (!data.goals || data.goals.length === 0) return null;
            
            const validGoals = data.goals.filter(g => g && g.name);
            if (validGoals.length === 0) return null;
            
            const totalWeight = validGoals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
            const showAchievement = type === 'review' || type === 'self';
            
            return e('div', { 
              style: { 
                pageBreakAfter: 'always', 
                padding: PADDING + 'px',
                width: CONTENT_WIDTH + 'px'
              }
            },
              e(PageHeader),
              
              e(SectionHeader, { 
                title: t.goals, 
                color: '#1e40af',
                score: showAchievement ? (data.wasScore || null) : null
              }),
              
              // Ziele Tabelle
              e('table', { style: { width: '100%', borderCollapse: 'collapse', fontSize: '11px', tableLayout: 'fixed' } },
                e('colgroup', null,
                  e('col', { style: { width: showAchievement ? '40%' : '45%' } }),
                  e('col', { style: { width: '10%' } }),
                  showAchievement && e('col', { style: { width: '12%' } }),
                  showAchievement && e('col', { style: { width: '8%' } }),
                  e('col', { style: { width: showAchievement ? '30%' : '45%' } })
                ),
                e('thead', null,
                  e('tr', { style: { background: '#1e40af', color: 'white' } },
                    e('th', { style: { padding: '8px 10px', textAlign: 'left', fontWeight: 600 } }, t.goals),
                    e('th', { style: { padding: '8px 6px', textAlign: 'center', fontWeight: 600 } }, t.weight),
                    showAchievement && e('th', { style: { padding: '8px 6px', textAlign: 'center', fontWeight: 600 } }, t.achievement),
                    showAchievement && e('th', { style: { padding: '8px 6px', textAlign: 'center', fontWeight: 600 } }, t.barsScore),
                    e('th', { style: { padding: '8px 10px', textAlign: 'left', fontWeight: 600 } }, t.target)
                  )
                ),
                e('tbody', null,
                  validGoals.map((goal, idx) => 
                    e('tr', { key: idx, style: { background: idx % 2 === 0 ? '#ffffff' : '#f8fafc', pageBreakInside: 'avoid' } },
                      e('td', { style: { padding: '8px 10px', borderBottom: '1px solid #e2e8f0', verticalAlign: 'top', whiteSpace: 'pre-wrap', wordWrap: 'break-word' } }, goal.name || '‚Äì'),
                      e('td', { style: { padding: '8px 6px', borderBottom: '1px solid #e2e8f0', textAlign: 'center', verticalAlign: 'top' } },
                        e('span', { style: { background: '#dbeafe', color: '#1e40af', padding: '2px 6px', borderRadius: '8px', fontWeight: 700, fontSize: '10px' } }, (goal.weight || 0) + '%')
                      ),
                      showAchievement && e('td', { style: { padding: '8px 6px', borderBottom: '1px solid #e2e8f0', textAlign: 'center', verticalAlign: 'top' } }, (goal.achievement || 0) + '%'),
                      showAchievement && e('td', { style: { padding: '8px 6px', borderBottom: '1px solid #e2e8f0', textAlign: 'center', verticalAlign: 'top' } },
                        e('span', { style: { 
                          display: 'inline-block',
                          width: '22px', 
                          height: '22px', 
                          lineHeight: '22px',
                          background: getRatingColor(getBarsScore(goal.achievement)),
                          color: 'white',
                          borderRadius: '50%',
                          fontWeight: 700,
                          fontSize: '11px'
                        }}, getBarsScore(goal.achievement))
                      ),
                      e('td', { style: { padding: '8px 10px', borderBottom: '1px solid #e2e8f0', color: '#475569', fontSize: '10px', verticalAlign: 'top', whiteSpace: 'pre-wrap', wordWrap: 'break-word' } }, goal.target || '‚Äì')
                    )
                  )
                )
              ),
              
              // Gewichtungs-Summe
              e('div', { style: { 
                marginTop: '12px', 
                textAlign: 'right',
                padding: '8px 12px',
                background: totalWeight === 100 ? '#dcfce7' : '#fef9c3',
                borderRadius: '4px',
                fontSize: '11px',
                fontWeight: 600,
                color: totalWeight === 100 ? '#166534' : '#854d0e'
              }}, t.weight + ': ' + totalWeight + '%'),
              
              // Bonus Info
              data.plannedBonus && e('div', { style: { 
                marginTop: '16px', 
                padding: '14px 18px', 
                background: 'linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%)', 
                border: '1px solid #6ee7b7',
                borderRadius: '6px',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }},
                e('span', { style: { fontSize: '12px', color: '#065f46', fontWeight: 600 } }, t.plannedBonus + ':'),
                e('span', { style: { fontSize: '20px', fontWeight: 900, color: '#065f46' } }, formatNumber(data.plannedBonus) + ' ‚Ç¨')
              )
            );
          };

          // === COMPETENCIES PAGE ===
          const CompetenciesPage = () => {
            if (type === 'goals') return null;
            
            const coreComps = data.coreCompetencies || data.coreList || [];
            const leadComps = data.leadershipCompetencies || data.leadList || [];
            
            if (coreComps.length === 0 && leadComps.length === 0) return null;
            
            const renderCompTable = (comps, title, color, score) => {
              if (!comps || comps.length === 0) return null;
              
              return e('div', { style: { marginBottom: '20px' } },
                e(SectionHeader, { title, color, score }),
                e('table', { style: { width: '100%', borderCollapse: 'collapse', fontSize: '11px', tableLayout: 'fixed' } },
                  e('colgroup', null,
                    e('col', { style: { width: '28%' } }),
                    e('col', { style: { width: '12%' } }),
                    e('col', { style: { width: '60%' } })
                  ),
                  e('thead', null,
                    e('tr', { style: { background: color, color: 'white' } },
                      e('th', { style: { padding: '8px 10px', textAlign: 'left', fontWeight: 600 } }, t.competency),
                      e('th', { style: { padding: '8px 6px', textAlign: 'center', fontWeight: 600 } }, t.rating),
                      e('th', { style: { padding: '8px 10px', textAlign: 'left', fontWeight: 600 } }, t.comment)
                    )
                  ),
                  e('tbody', null,
                    comps.map((comp, idx) => 
                      e('tr', { key: idx, style: { background: idx % 2 === 0 ? '#ffffff' : (color === ACCENT_COLOR ? '#f0fdf4' : '#f8fafc'), pageBreakInside: 'avoid' } },
                        e('td', { style: { padding: '8px 10px', borderBottom: '1px solid #e2e8f0', fontWeight: 500, verticalAlign: 'top' } }, comp.name || '‚Äì'),
                        e('td', { style: { padding: '8px 6px', borderBottom: '1px solid #e2e8f0', textAlign: 'center', verticalAlign: 'top' } },
                          e('span', { style: { 
                            display: 'inline-block',
                            width: '24px', 
                            height: '24px', 
                            lineHeight: '24px',
                            background: getRatingColor(comp.rating),
                            color: 'white',
                            borderRadius: '50%',
                            fontWeight: 700,
                            fontSize: '12px'
                          }}, comp.rating || 3)
                        ),
                        e('td', { style: { padding: '8px 10px', borderBottom: '1px solid #e2e8f0', fontSize: '10px', color: '#475569', verticalAlign: 'top', whiteSpace: 'pre-wrap', wordWrap: 'break-word' } }, comp.comment || '‚Äì')
                      )
                    )
                  )
                )
              );
            };
            
            return e('div', { 
              style: { 
                pageBreakAfter: 'always', 
                padding: PADDING + 'px',
                width: CONTENT_WIDTH + 'px'
              }
            },
              e(PageHeader),
              renderCompTable(coreComps, t.coreComp, ACCENT_COLOR, data.wieCoreScore),
              renderCompTable(leadComps, t.leadComp, '#059669', data.wieLeadScore)
            );
          };

          // === GPS RESULT PAGE ===
          const GPSPage = () => {
            if (type === 'goals' || !data.gps) return null;
            
            return e('div', { 
              style: { 
                pageBreakAfter: 'always', 
                padding: PADDING + 'px',
                width: CONTENT_WIDTH + 'px'
              }
            },
              e(PageHeader),
              
              // GPS Score Box
              e('div', { style: { 
                margin: '30px 0',
                padding: '30px',
                background: 'linear-gradient(135deg, ' + PRIMARY_COLOR + ' 0%, #1a2564 100%)',
                borderRadius: '8px',
                textAlign: 'center',
                pageBreakInside: 'avoid'
              }},
                e('div', { style: { fontSize: '11px', color: 'rgba(255,255,255,0.7)', textTransform: 'uppercase', letterSpacing: '2px', marginBottom: '8px' } }, 
                  type === 'self' ? 'SELF-ASSESSMENT GPS' : 'GLOBAL PERFORMANCE SCORE'
                ),
                e('div', { style: { fontSize: '56px', fontWeight: 900, color: 'white', margin: '10px 0' } }, 
                  (data.gps || 0).toFixed(2)
                ),
                e('div', { style: { fontSize: '12px', color: ACCENT_COLOR, fontWeight: 600 } }, 
                  data.gpsFormula || '(WAS 50% + WIE 50%)'
                )
              ),
              
              // St√§rken
              data.strengths1 && e('div', { style: { marginTop: '24px' } },
                e(SectionHeader, { title: t.strengths, color: PRIMARY_COLOR }),
                e('div', { style: { marginBottom: '16px' } },
                  e('div', { style: { fontSize: '11px', fontWeight: 600, color: '#334155', marginBottom: '6px' } }, t.professional),
                  e(TextBlock, { content: data.strengths1, minHeight: 40 })
                ),
                data.strengths2 && e('div', null,
                  e('div', { style: { fontSize: '11px', fontWeight: 600, color: '#334155', marginBottom: '6px' } }, t.personal),
                  e(TextBlock, { content: data.strengths2, minHeight: 40 })
                )
              )
            );
          };

          // === DEVELOPMENT PAGE ===
          const DevelopmentPage = () => {
            if (!data.devPlan || data.devPlan.length === 0) return null;
            
            const validDev = data.devPlan.filter(d => d && d.measure);
            if (validDev.length === 0) return null;
            
            return e('div', { 
              style: { 
                pageBreakAfter: 'always', 
                padding: PADDING + 'px',
                width: CONTENT_WIDTH + 'px'
              }
            },
              e(PageHeader),
              e(SectionHeader, { title: t.development, color: ACCENT_COLOR }),
              
              e('table', { style: { width: '100%', borderCollapse: 'collapse', fontSize: '11px', tableLayout: 'fixed' } },
                e('colgroup', null,
                  e('col', { style: { width: '55%' } }),
                  e('col', { style: { width: '25%' } }),
                  e('col', { style: { width: '20%' } })
                ),
                e('thead', null,
                  e('tr', { style: { background: '#166534', color: 'white' } },
                    e('th', { style: { padding: '8px 10px', textAlign: 'left', fontWeight: 600 } }, t.measure),
                    e('th', { style: { padding: '8px 10px', textAlign: 'left', fontWeight: 600 } }, t.responsible),
                    e('th', { style: { padding: '8px 10px', textAlign: 'center', fontWeight: 600 } }, t.deadline)
                  )
                ),
                e('tbody', null,
                  validDev.map((dev, idx) => 
                    e('tr', { key: idx, style: { background: idx % 2 === 0 ? '#ffffff' : '#f0fdf4', pageBreakInside: 'avoid' } },
                      e('td', { style: { padding: '8px 10px', borderBottom: '1px solid #e2e8f0', verticalAlign: 'top', whiteSpace: 'pre-wrap', wordWrap: 'break-word' } }, dev.measure || '‚Äì'),
                      e('td', { style: { padding: '8px 10px', borderBottom: '1px solid #e2e8f0', verticalAlign: 'top' } }, dev.responsible || '‚Äì'),
                      e('td', { style: { padding: '8px 10px', borderBottom: '1px solid #e2e8f0', textAlign: 'center', verticalAlign: 'top' } }, dev.deadline || '‚Äì')
                    )
                  )
                )
              )
            );
          };

          // === SIGNATURE PAGE ===
          const SignaturePage = () => e('div', { 
            style: { 
              padding: PADDING + 'px',
              width: CONTENT_WIDTH + 'px'
            }
          },
            e(PageHeader),
            
            // Unterschriften Box
            e('div', { style: { 
              marginTop: '30px',
              padding: '24px 30px', 
              border: '2px solid ' + PRIMARY_COLOR, 
              borderRadius: '8px'
            }},
              e('div', { style: { fontSize: '14px', marginBottom: '12px', color: PRIMARY_COLOR, fontWeight: 600, textAlign: 'center' } }, t.signatures),
              e('div', { style: { fontSize: '11px', color: '#64748b', textAlign: 'center', marginBottom: '40px' } }, t.signatureNote),
              
              e('div', { style: { display: 'flex', justifyContent: 'space-between', marginTop: '50px' } },
                e('div', { style: { width: '42%', textAlign: 'center' } },
                  e('div', { style: { borderBottom: '2px solid #1e293b', height: '50px' } }),
                  e('div', { style: { marginTop: '8px', fontSize: '11px', color: '#64748b' } }, t.employee),
                  e('div', { style: { marginTop: '2px', fontSize: '9px', color: '#94a3b8' } }, t.dateSignature)
                ),
                e('div', { style: { width: '42%', textAlign: 'center' } },
                  e('div', { style: { borderBottom: '2px solid #1e293b', height: '50px' } }),
                  e('div', { style: { marginTop: '8px', fontSize: '11px', color: '#64748b' } }, t.manager),
                  e('div', { style: { marginTop: '2px', fontSize: '9px', color: '#94a3b8' } }, t.dateSignature)
                )
              )
            ),
            
            // Footer
            e('div', { style: { marginTop: '50px', paddingTop: '12px', borderTop: '1px solid #e2e8f0', textAlign: 'center' } },
              e('div', { style: { fontSize: '10px', color: '#94a3b8' } }, 
                'Niederwieser Group | ' + t.coverSubtitle + ' | ' + currentDate
              ),
              e('div', { style: { fontSize: '9px', color: '#cbd5e1', marginTop: '4px' } }, t.confidential)
            )
          );

          // === MAIN RENDER ===
          return e('div', { 
            id: 'print-layout-container',
            className: 'pdf-mode',
            style: { 
              fontFamily: 'Arial, Helvetica, sans-serif',
              fontSize: '12px',
              color: '#1e293b',
              background: 'white',
              width: CONTENT_WIDTH + 'px',
              maxWidth: CONTENT_WIDTH + 'px'
            }
          },
            e(CoverPage),
            e(GoalsPage),
            type !== 'goals' && e(CompetenciesPage),
            type !== 'goals' && e(GPSPage),
            e(DevelopmentPage),
            e(SignaturePage)
          );
        };

        // === ZIELVEREINBARUNG COMPONENT (Simplified Goal Agreement) ===
        const Zielvereinbarung = ({ lang, onSaveTeam, onCancel }) => {
            const t = FORM_TEXT[lang] || FORM_TEXT['de'];
            const formRef = useRef(null);

            
            // === TEAM CONTEXT ===
            const [teamContext, setTeamContext] = useState(null);
            const [teamButtonsVisible, setTeamButtonsVisible] = useState(false);
            
            useEffect(() => {
              const ctx = localStorage.getItem('nw_current_employee');
              devLog('üîç Zielvereinbarung useEffect triggered (v90)');
              devLog('   localStorage nw_current_employee:', ctx ? 'found' : 'not found');
              
              if (ctx) {
                try {
                  const data = JSON.parse(ctx);
                  devLog('‚úì Parsed team context:', data);
                  devLog('   employee:', data.employee?.name);
                  devLog('   existingData:', data.existingData ? 'present' : 'none');
                  
                  setTeamContext(data);
                  setTeamButtonsVisible(true);
                  devLog('‚úì teamButtonsVisible set to TRUE');
                  
                  // Load existing data if available
                  if (data.existingData) {
                    const existing = data.existingData;
                    devLog('üìÇ Loading existing data...');
                    devLog('   - goals:', existing.goals?.length || 0);
                    devLog('   - devPlan:', existing.devPlan?.length || 0);
                    devLog('   - devGoals:', existing.devGoals?.length || 0);
                    devLog('   - formData:', existing.formData ? Object.keys(existing.formData) : 'none');
                    
                    // Set form data - KORRIGIERT: Alle Felder laden
                    setFormData(prev => ({
                      ...prev,
                      employee: existing.employeeName || data.employee?.name || prev.employee,
                      position: existing.position || data.employee?.position || prev.position,
                      manager: existing.formData?.manager || existing.managerName || prev.manager,
                      date: existing.formData?.date || (existing.updatedAt ? existing.updatedAt.split('T')[0] : prev.date),
                      plannedBonus: existing.formData?.plannedBonus || ''
                    }));
                    
                    // KORRIGIERT: Goals laden - auch bei leerem Array
                    if (Array.isArray(existing.goals)) {
                      if (existing.goals.length > 0) {
                        devLog('   ‚úì Loading', existing.goals.length, 'existing goals');
                        setGoals(existing.goals);
                      } else {
                        devLog('   ‚ÑπÔ∏è Goals array is empty, using defaults');
                        setGoals([
                          { id: 101, name: '', weight: 60, target: '', type: 'performance' },
                          { id: 102, name: '', weight: 40, target: '', type: 'performance' }
                        ]);
                      }
                    }
                    
                    // KORRIGIERT: devPlan laden - auch bei leerem Array
                    if (Array.isArray(existing.devPlan)) {
                      if (existing.devPlan.length > 0) {
                        devLog('   ‚úì Loading', existing.devPlan.length, 'existing devPlan items');
                        setDevPlan(existing.devPlan);
                      } else {
                        devLog('   ‚ÑπÔ∏è devPlan array is empty, using default');
                        setDevPlan([{ id: 201, measure: '', responsible: '', deadline: '' }]);
                      }
                    }
                    
                    // KORRIGIERT: devGoals laden - auch bei leerem Array
                    if (Array.isArray(existing.devGoals)) {
                      if (existing.devGoals.length > 0) {
                        devLog('   ‚úì Loading', existing.devGoals.length, 'existing devGoals');
                        setDevGoals(existing.devGoals);
                      } else {
                        devLog('   ‚ÑπÔ∏è devGoals array is empty, using default');
                        setDevGoals([{ id: 301, name: '', target: '', deadline: '', category: 'skill' }]);
                      }
                    }
                    
                    devLog('üìÇ Existing data loading complete');
                  } else if (data.employee) {
                    // New appraisal - set employee data only
                    devLog('‚ÑπÔ∏è New appraisal - setting employee data');
                    setFormData(prev => ({
                      ...prev,
                      employee: data.employee.name || prev.employee,
                      position: data.employee.position || prev.position,
                      manager: data.managerName || prev.manager // v92: Manager-Name aus Context setzen
                    }));
                  }
                } catch (e) {
                  console.error('‚ùå Error loading team context:', e);
                }
              }
            }, []);
            
            // === LADE VERKN√úPFTE BEURTEILUNG (D.2 Entwicklungsfelder) ===
            useEffect(() => {
              const loadLinkedReview = async () => {
                if (!db || !teamContext?.employee?.id) return;
                
                setIsLoadingReview(true);
                try {
                  const employeeId = teamContext.employee.id;
                  devLog('üîç Suche Beurteilung f√ºr Employee:', employeeId);
                  
                  // Lade letzte Beurteilung f√ºr diesen Mitarbeiter aus teamAppraisals
                  const reviewSnapshot = await db.collection('teamAppraisals')
                    .where('employeeId', '==', employeeId)
                    .where('type', '==', 'review')
                    .orderBy('createdAt', 'desc')
                    .limit(1)
                    .get();
                  
                  if (!reviewSnapshot.empty) {
                    const reviewData = { id: reviewSnapshot.docs[0].id, ...reviewSnapshot.docs[0].data() };
                    devLog('üìã Verkn√ºpfte Beurteilung gefunden:', reviewData);
                    devLog('   devPlan:', reviewData.devPlan);
                    devLog('   formData.strengths2:', reviewData.formData?.strengths2);
                    setLinkedReview(reviewData);
                  } else {
                    // Fallback: Versuche ohne type-Filter (f√ºr alte Beurteilungen)
                    devLog('‚ÑπÔ∏è Keine Beurteilung mit type=review, versuche Fallback...');
                    const fallbackSnapshot = await db.collection('teamAppraisals')
                      .where('employeeId', '==', employeeId)
                      .orderBy('createdAt', 'desc')
                      .limit(5)
                      .get();
                    
                    // Filtere nach Reviews (nicht goals)
                    const reviews = fallbackSnapshot.docs
                      .map(doc => ({ id: doc.id, ...doc.data() }))
                      .filter(a => a.type !== 'goals');
                    
                    if (reviews.length > 0) {
                      devLog('üìã Fallback Beurteilung gefunden:', reviews[0]);
                      setLinkedReview(reviews[0]);
                    } else {
                      devLog('‚ÑπÔ∏è Keine Beurteilung f√ºr diesen Mitarbeiter gefunden');
                      setLinkedReview(null);
                    }
                  }
                } catch (err) {
                  console.error('‚ùå Fehler beim Laden der Beurteilung:', err);
                  // Bei Index-Fehler: Versuche einfachere Query
                  try {
                    devLog('üîÑ Versuche einfache Query ohne orderBy...');
                    const employeeIdForQuery = teamContext.employee?.id || teamContext.existingData?.employeeId;
                    if (!employeeIdForQuery) return;
                    
                    const simpleSnapshot = await db.collection('teamAppraisals')
                      .where('employeeId', '==', employeeIdForQuery)
                      .get();
                    
                    const reviews = simpleSnapshot.docs
                      .map(doc => ({ id: doc.id, ...doc.data() }))
                      .filter(a => a.type !== 'goals')
                      .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    
                    if (reviews.length > 0) {
                      devLog('üìã Einfache Query erfolgreich:', reviews[0]);
                      setLinkedReview(reviews[0]);
                    } else {
                      setLinkedReview(null);
                    }
                  } catch (err2) {
                    console.error('‚ùå Auch einfache Query fehlgeschlagen:', err2);
                    setLinkedReview(null);
                  }
                }
                setIsLoadingReview(false);
              };
              
              if (db && teamContext) {
                loadLinkedReview();
              }
            }, [db, teamContext]);
            
            const handleSaveTeamAppraisal = async (status) => {
              if (!teamContext || !onSaveTeam) {
                showToast(getText(lang, 'Team-Kontext fehlt!', 'Contesto team mancante!', 'Team context missing!'), 'error');
                return;
              }
              
              setIsSaving(true); // v92: Doppelklick-Schutz
              hasUnsavedChanges.current = false; // v92: beforeunload deaktivieren
              
              // F√ºr Zielvereinbarungen: kein GPS-Score berechnen
              const appraisal = {
                id: teamContext.appraisalId,
                type: 'goals', // WICHTIG: Typ auf 'goals' setzen
                employeeId: teamContext.employee?.id || teamContext.existingData?.employeeId || '',
                employeeName: teamContext.employee?.name || teamContext.existingData?.employeeName || formData.employee || '',
                position: teamContext.employee?.position || teamContext.existingData?.position || formData.position || '',
                period: teamContext.period || new Date().getFullYear(),
                status: status,
                createdAt: teamContext.existingData?.createdAt || new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                
                // === ZIELE ===
                goals: goals,
                
                // === ENTWICKLUNG - BEIDE Varianten speichern ===
                devPlan: devPlan,       // F√ºr Kompatibilit√§t mit Leistungsbeurteilung
                devGoals: devGoals,     // NEU: Entwicklungsziele f√ºr Zielvereinbarung
                
                // === FORMULAR-DATEN (explizit alle Felder) ===
                formData: {
                  ...formData,
                  employee: formData.employee || '',
                  position: formData.position || '',
                  manager: formData.manager || '',
                  date: formData.date || '',
                  plannedBonus: formData.plannedBonus || ''
                },
                
                // WICHTIG: Manager-Referenz beibehalten (f√ºr Sichtbarkeit!)
                managerId: teamContext.existingData?.managerId || teamContext.managerId || null,
                managerName: teamContext.existingData?.managerName || teamContext.managerName || formData.manager || '',
                // F√ºr Zielvereinbarungen keine GPS-relevanten Scores
                gpsScore: 0,
                wasScore: 0,
                wieCoreScore: 0,
                wieLeaderScore: 0
              };
              
              // Debug-Log - ERWEITERT f√ºr v90
              devLog('üíæ Speichere Zielvereinbarung (v90):', {
                status,
                id: appraisal.id,
                goalsCount: goals.length,
                goalsWithContent: goals.filter(g => g.name).length,
                devGoalsCount: devGoals.length,
                devGoalsWithContent: devGoals.filter(d => d.name).length,
                devPlanCount: devPlan.length,
                devPlanWithContent: devPlan.filter(d => d.measure).length,
                totalWeight: goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0),
                // Detaillierte devGoals f√ºr Debugging
                devGoals: devGoals.map(d => ({ 
                  id: d.id, 
                  name: d.name ? d.name.substring(0, 30) + '...' : '(empty)',
                  category: d.category
                }))
              });
              
              try {
                await onSaveTeam(appraisal);
              } catch (err) {
                hasUnsavedChanges.current = true; // v92: Dirty-Flag zur√ºcksetzen bei Fehler
                setIsSaving(false);
              }
            };
            
            const handleCancelTeam = () => {
              if (confirm(lang === 'de' ? 'Abbrechen? √Ñnderungen gehen verloren.' : lang === 'it' ? 'Annullare? Le modifiche andranno perse.' : 'Cancel? Changes will be lost.')) {
                hasUnsavedChanges.current = false; // v92
                localStorage.removeItem('nw_current_employee');
                if (onCancel) onCancel();
              }
            };
            
            const [isGenerating, setIsGenerating] = useState(false);
            const [isSaving, setIsSaving] = useState(false); // v92: Doppelklick-Schutz
            
            // v92: Unsaved Changes Protection (beforeunload)
            const hasUnsavedChanges = React.useRef(false);
            React.useEffect(() => {
              const handler = (e) => {
                if (hasUnsavedChanges.current) {
                  e.preventDefault();
                  e.returnValue = '';
                }
              };
              window.addEventListener('beforeunload', handler);
              return () => window.removeEventListener('beforeunload', handler);
            }, []);
            
            const [formData, setFormData] = useState({
                employee: '', 
                position: '', 
                manager: '', 
                date: new Date().toISOString().split('T')[0],
                plannedBonus: ''  // Geplanter Bonus (100%)
            });
            
            const [goals, setGoals] = useState([
                { id: 101, name: '', weight: 60, target: '', type: 'performance' },
                { id: 102, name: '', weight: 40, target: '', type: 'performance' }
            ]);
            
            // NEU: Entwicklungsziele (Development Goals) - nicht GPS-relevant
            const [devGoals, setDevGoals] = useState([
                { id: 301, name: '', target: '', deadline: '', category: 'skill' }
            ]);
            
            // SMART-Validierung f√ºr Ziele - gro√üz√ºgig und mehrsprachig (DE/IT/EN)
            const validateSMART = (goal) => {
              const checks = {
                specific: false,
                measurable: false,
                achievable: false,
                relevant: false,
                timeBound: false
              };
              const tips = [];
              
              const name = (goal.name || '').toLowerCase();
              const target = (goal.target || '').toLowerCase();
              const combined = name + ' ' + target;
              
              // S - Spezifisch: Sehr gro√üz√ºgig - >15 Zeichen oder Aktionsverb
              const specificKeywords = [
                // Deutsch
                'erh√∂hen', 'reduzieren', 'verbessern', 'steigern', 'senken', 'erreichen', 'implementieren', 
                'einf√ºhren', 'abschlie√üen', 'entwickeln', 'optimieren', 'umsetzen', 'sicherstellen', 
                'gew√§hrleisten', 'aufbauen', 'erstellen', 'durchf√ºhren', 'ausbauen', 'etablieren',
                'st√§rken', 'f√∂rdern', 'erweitern', 'reduzierung', 'steigerung', 'verbesserung',
                // Englisch
                'increase', 'reduce', 'improve', 'achieve', 'implement', 'complete', 'develop', 
                'optimize', 'ensure', 'build', 'create', 'execute', 'establish', 'enhance', 
                'strengthen', 'expand', 'deliver', 'launch', 'maintain', 'grow', 'decrease',
                // Italienisch
                'aumentare', 'ridurre', 'migliorare', 'raggiungere', 'implementare', 'completare',
                'sviluppare', 'ottimizzare', 'garantire', 'costruire', 'creare', 'eseguire',
                'stabilire', 'rafforzare', 'espandere', 'consegnare', 'lanciare', 'mantenere'
              ];
              checks.specific = specificKeywords.some(kw => combined.includes(kw)) || combined.length > 15;
              if (!checks.specific) tips.push(lang === 'de' ? 'Ziel konkretisieren' : lang === 'it' ? 'Concretizzare' : 'Be specific');
              
              // M - Messbar: Gro√üz√ºgig - Zahl, %, ‚Ç¨, oder messbare Begriffe
              const hasNumbers = /\d+/.test(combined);
              const hasPercent = /%|prozent|percent|percento|pro\s*cento/.test(combined);
              const hasCurrency = /‚Ç¨|¬£|\$|eur|euro|chf|usd|\d+\s*(k|tsd|mio|mln|m|bn)/.test(combined);
              const measurableTerms = [
                // Deutsch
                'quote', 'rate', 'anzahl', 'st√ºck', 'stunden', 'tage', 'menge', 'level', 'stufe', 
                'score', 'index', 'grad', 'punkte', 'kunden', 'kunde', 'projekt', 'auftr√§ge', 
                'umsatz', 'kosten', 'budget', 'mitarbeiter', 'einheiten', 'prozess', 'fehler',
                'reklamation', 'lieferung', 'bestellung', 'auftrag', 'termin', 'qualit√§t',
                // Englisch
                'number', 'quantity', 'amount', 'points', 'customers', 'customer', 'project',
                'orders', 'revenue', 'sales', 'cost', 'budget', 'employees', 'units', 'process',
                'errors', 'complaints', 'delivery', 'order', 'deadline', 'quality', 'target',
                'goal', 'kpi', 'metric', 'ratio', 'margin', 'profit', 'growth',
                // Italienisch
                'numero', 'quantit√†', 'importo', 'punti', 'clienti', 'cliente', 'progetto',
                'ordini', 'fatturato', 'vendite', 'costo', 'costi', 'dipendenti', 'unit√†',
                'processo', 'errori', 'reclami', 'consegna', 'ordine', 'scadenza', 'qualit√†'
              ];
              const hasMeasurable = measurableTerms.some(term => combined.includes(term));
              checks.measurable = hasNumbers || hasPercent || hasCurrency || hasMeasurable;
              if (!checks.measurable) tips.push(lang === 'de' ? 'Kennzahl erg√§nzen' : lang === 'it' ? 'Aggiungere metrica' : 'Add metric');
              
              // A - Erreichbar: Fast immer erf√ºllt, nur bei extremen Aussagen nicht
              const extremeValues = /1000\s*%|verzehnfachen|verdreifachen|triple|quadruple|decuple/.test(combined);
              checks.achievable = !extremeValues;
              // Kein Tipp f√ºr "Achievable" - zu subjektiv
              
              // R - Relevant: Hat Gewichtung > 0?
              checks.relevant = (parseFloat(goal.weight) || 0) > 0;
              if (!checks.relevant) tips.push(lang === 'de' ? 'Gewichtung setzen' : lang === 'it' ? 'Impostare peso' : 'Set weight');
              
              // T - Terminiert: Sehr flexibel - Jahr, Quartal, Monat, Zeitwort
              const timePatterns = [
                /20\d{2}/, // 2024, 2025, etc.
                /'\d{2}/, // '24, '25
                /q[1-4]/i, // Q1, Q2, q3, q4
                /h[1-2]/i, // H1, H2 (Halbjahr)
                /\d{1,2}[\.\-\/]\d{1,2}/, // 15.03, 31/12
                /\d{1,2}\.\d{4}/, // 12.2025
              ];
              const hasTimePattern = timePatterns.some(p => p.test(combined));
              
              const timeWords = [
                // Deutsch
                'januar', 'februar', 'm√§rz', 'april', 'mai', 'juni', 'juli', 'august', 
                'september', 'oktober', 'november', 'dezember', 'quartal', 'halbjahr',
                'jahresende', 'monatsende', 'ende', 'bis', 'ab', 'innerhalb', 'binnen',
                // Englisch  
                'january', 'february', 'march', 'april', 'may', 'june', 'july', 'august',
                'september', 'october', 'november', 'december', 'quarter', 'half-year',
                'year-end', 'month-end', 'end of', 'by', 'until', 'within', 'deadline',
                'eoy', 'eoq', 'eom', // End of Year/Quarter/Month
                // Italienisch
                'gennaio', 'febbraio', 'marzo', 'aprile', 'maggio', 'giugno', 'luglio',
                'agosto', 'settembre', 'ottobre', 'novembre', 'dicembre', 'trimestre',
                'semestre', 'fine anno', 'fine mese', 'entro', 'fino a', 'scadenza'
              ];
              const hasTimeWord = timeWords.some(w => combined.includes(w));
              
              checks.timeBound = hasTimePattern || hasTimeWord || goal.deadline;
              if (!checks.timeBound) tips.push(lang === 'de' ? 'Termin angeben' : lang === 'it' ? 'Indicare quando' : 'Add deadline');
              
              const score = Object.values(checks).filter(Boolean).length;
              const isValid = score >= 4;
              
              return { checks, score, isValid, tips };
            };
            
            const [devPlan, setDevPlan] = useState([
                { id: 201, measure: '', responsible: '', deadline: '' }
            ]);
            
            // === LINKED REVIEW (Verkn√ºpfte Leistungsbeurteilung) ===
            const [linkedReview, setLinkedReview] = useState(null);
            const [isLoadingReview, setIsLoadingReview] = useState(false);

            // BUGFIX v93: Synchronisiere devPlan mit der aktuellsten Beurteilung
            // Wenn die Beurteilung nach dem letzten Speichern der Zielvereinbarung ge√§ndert wurde,
            // zeigt das Formular sonst veraltete Ma√ünahmen an
            useEffect(() => {
              if (linkedReview?.devPlan?.length > 0 && linkedReview.devPlan.some(d => d.measure)) {
                devLog('üîÑ Sync devPlan mit aktueller Beurteilung:', linkedReview.devPlan.length, 'Ma√ünahmen');
                setDevPlan(linkedReview.devPlan.map(d => ({ ...d })));
              }
            }, [linkedReview]);

            const handleFormChange = (field, val) => { hasUnsavedChanges.current = true; setFormData({...formData, [field]: val}); };
            
            // Hilfsfunktion: Tausenderpunkte aus Eingabe entfernen (1.000 ‚Üí 1000)
            const parseGermanNumber = (str) => {
                if (!str) return '';
                // Entferne Tausenderpunkte und ersetze Komma durch Punkt f√ºr Dezimalzahlen
                return str.replace(/\./g, '').replace(',', '.');
            };
            
            // Hilfsfunktion: Zahl mit Tausenderpunkten formatieren (1000 ‚Üí 1.000)
            const formatGermanNumber = (num) => {
                if (!num && num !== 0) return '';
                const numStr = String(num).replace(/[^\d]/g, '');
                if (!numStr) return '';
                return Number(numStr).toLocaleString('de-DE');
            };
            
            // Handler f√ºr Bonus-Feld mit Tausenderpunkt-Unterst√ºtzung
            const handleBonusChange = (val) => {
                // Erlaube nur Zahlen und Punkte
                const cleanVal = val.replace(/[^\d.]/g, '');
                // Speichere den rohen Wert ohne Formatierung f√ºr die Berechnung
                const numericVal = parseGermanNumber(cleanVal);
                hasUnsavedChanges.current = true; // v92
                setFormData({...formData, plannedBonus: numericVal});
            };
            
            // Formatierter Bonus f√ºr die Anzeige
            const displayBonus = formData.plannedBonus ? formatGermanNumber(formData.plannedBonus) : '';
            
            const updateItem = (list, setList, id, field, val) => {
                hasUnsavedChanges.current = true; // v92
                setList(list.map(i => {
                    if (i.id !== id) return i;
                    // Parse numeric fields to ensure calculations work correctly
                    if (field === 'weight') {
                        return { ...i, [field]: parseFloat(val) || 0 };
                    }
                    return { ...i, [field]: val };
                }));
            };
            const addItem = (list, setList, template) => { hasUnsavedChanges.current = true; setList([...list, { ...template, id: Date.now() }]); };
            const removeItem = (list, setList, id) => { hasUnsavedChanges.current = true; setList(list.filter(i => i.id !== id)); };

            const handleDownloadPDF = () => {
                if (!window.html2pdf) {
                    showToast(getText(lang, "PDF-Bibliothek nicht geladen. Bitte Seite neu laden.", "Libreria PDF non caricata. Ricaricare la pagina.", "PDF library not loaded. Please reload the page."), "error");
                    return;
                }
                
                setIsGenerating(true);
                
                setTimeout(() => {
                    try {
                        const pdfContainer = document.createElement('div');
                        pdfContainer.style.cssText = `
                            width: 190mm;
                            box-sizing: border-box;
                            padding: 10mm 15mm;
                            background: white;
                            font-family: Arial, sans-serif;
                            color: #1e293b;
                            font-size: 10pt;
                            line-height: 1.5;
                        `;
                        
                        const formatDate = (dateStr) => {
                            if (!dateStr) return '‚Äì';
                            const parts = dateStr.split('-');
                            if (parts.length === 3) return `${parts[2]}.${parts[1]}.${parts[0]}`;
                            return dateStr;
                        };
                        
                        // Professionelles PDF Layout
                        const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
                        
                        let pdfHTML = `
                            <!-- HEADER mit Logo-Stil -->
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 3px solid #243186;">
                              <div>
                                <h1 style="color: #243186; font-size: 28pt; margin: 0; font-weight: 700; letter-spacing: -0.5px;">nƒ±ederwƒ±eser</h1>
                                <p style="color: #6EBD84; font-size: 9pt; margin: 3px 0 0 0; font-weight: 600; letter-spacing: 2px;">FLEXIBLE FOOD PACKAGING</p>
                              </div>
                              <div style="text-align: right;">
                                <p style="font-size: 8pt; color: #64748b; margin: 0;">Dokumentdatum</p>
                                <p style="font-size: 10pt; font-weight: 600; margin: 2px 0 0 0;">${formatDate(formData.date)}</p>
                              </div>
                            </div>
                            
                            <!-- DOKUMENTTITEL -->
                            <div style="text-align: center; margin-bottom: 25px;">
                              <h2 style="color: #243186; font-size: 20pt; margin: 0 0 5px 0; font-weight: 700;">${lang === 'de' ? 'Zielvereinbarung' : lang === 'it' ? 'Accordo sugli Obiettivi' : 'Goal Agreement'}</h2>
                              <p style="color: #6EBD84; font-size: 11pt; margin: 0; font-weight: 600;">Annual Performance Review | Strategie 2035</p>
                            </div>
                            
                            <!-- TEIL A: GESPR√ÑCHSDATEN -->
                            <div style="margin-bottom: 20px; page-break-inside: avoid;">
                              <div style="background: linear-gradient(90deg, #243186 0%, #3b4a9e 100%); color: white; padding: 8px 15px; border-radius: 4px 4px 0 0;">
                                <h3 style="font-size: 11pt; margin: 0; font-weight: 600;">${t.partA || 'Teil A: Gespr√§chsdaten'}</h3>
                              </div>
                              <table style="width: 100%; border-collapse: collapse; border: 1px solid #e2e8f0; border-top: none;">
                                <tr>
                                  <td style="padding: 10px 15px; width: 25%; background: #f8fafc; border-right: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0;">
                                    <span style="font-size: 8pt; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px;">${t.employee || 'Mitarbeiter:in'}</span>
                                  </td>
                                  <td style="padding: 10px 15px; width: 25%; font-weight: 600; border-right: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0;">${formData.employee || '‚Äì'}</td>
                                  <td style="padding: 10px 15px; width: 25%; background: #f8fafc; border-right: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0;">
                                    <span style="font-size: 8pt; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px;">${t.manager || 'F√ºhrungskraft'}</span>
                                  </td>
                                  <td style="padding: 10px 15px; width: 25%; font-weight: 600; border-bottom: 1px solid #e2e8f0;">${formData.manager || '‚Äì'}</td>
                                </tr>
                                <tr>
                                  <td style="padding: 10px 15px; background: #f8fafc; border-right: 1px solid #e2e8f0;">
                                    <span style="font-size: 8pt; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px;">${t.position || 'Position'}</span>
                                  </td>
                                  <td style="padding: 10px 15px; font-weight: 600; border-right: 1px solid #e2e8f0;">${formData.position || '‚Äì'}</td>
                                  <td style="padding: 10px 15px; background: #f8fafc; border-right: 1px solid #e2e8f0;">
                                    <span style="font-size: 8pt; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px;">${t.date || 'Gespr√§chsdatum'}</span>
                                  </td>
                                  <td style="padding: 10px 15px; font-weight: 600;">${formatDate(formData.date)}</td>
                                </tr>
                              </table>
                            </div>
                            
                            <!-- ZIELDEFINITION -->
                            <div style="margin-bottom: 20px; page-break-inside: avoid;">
                              <div style="background: linear-gradient(90deg, #0891b2 0%, #06b6d4 100%); color: white; padding: 8px 15px; border-radius: 4px 4px 0 0; display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="font-size: 11pt; margin: 0; font-weight: 600;">${lang === 'de' ? 'Zieldefinition' : lang === 'it' ? 'Definizione degli Obiettivi' : 'Goal Definition'}</h3>
                                ${plannedBonusNum > 0 ? `<span style="font-size: 9pt; font-weight: 600; background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 4px;">${lang === 'de' ? 'Geplanter Bonus bei 100%' : lang === 'it' ? 'Bonus previsto al 100%' : 'Planned Bonus at 100%'}: ${Number(plannedBonusNum).toLocaleString('de-DE')} ‚Ç¨</span>` : ''}
                              </div>
                              <table style="width: 100%; border-collapse: collapse; border: 1px solid #e2e8f0; border-top: none;">
                                <thead>
                                  <tr style="background: #f1f5f9;">
                                    <th style="padding: 10px 15px; text-align: left; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #0891b2; width: ${plannedBonusNum > 0 ? '35%' : '40%'};">${t.goalName || 'Zielbezeichnung'}</th>
                                    <th style="padding: 10px 15px; text-align: center; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #0891b2; width: 12%;">${t.weight || 'Gewicht'} %</th>
                                    ${plannedBonusNum > 0 ? `<th style="padding: 10px 15px; text-align: center; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #0891b2; width: 13%; color: #065f46;">${lang === 'de' ? 'Bonus ‚Ç¨' : 'Bonus ‚Ç¨'}</th>` : ''}
                                    <th style="padding: 10px 15px; text-align: left; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #0891b2; width: ${plannedBonusNum > 0 ? '40%' : '45%'};">${lang === 'de' ? 'Zielwert / Beschreibung' : 'Target / Description'}</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  ${goals.length > 0 && goals.some(g => g.name) ? goals.map((g, idx) => {
                                    const goalBonus = plannedBonusNum > 0 ? Math.round(plannedBonusNum * (parseFloat(g.weight) || 0) / 100) : 0;
                                    return `
                                    <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'};">
                                      <td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">${g.name || '‚Äì'}</td>
                                      <td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 700; color: #0891b2;">${g.weight || 0}%</td>
                                      ${plannedBonusNum > 0 ? `<td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 600; color: #065f46; background: ${idx % 2 === 0 ? '#f0fdf4' : '#ecfdf5'};">${goalBonus > 0 ? Number(goalBonus).toLocaleString('de-DE') + ' ‚Ç¨' : '‚Äì'}</td>` : ''}
                                      <td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; vertical-align: top; white-space: pre-wrap;">${g.target || '‚Äì'}</td>
                                    </tr>`;
                                  }).join('') : `
                                    <tr>
                                      <td colspan="${plannedBonusNum > 0 ? '4' : '3'}" style="padding: 20px 15px; text-align: center; color: #94a3b8; font-style: italic;">
                                        ${lang === 'de' ? 'Noch keine Ziele definiert' : 'No goals defined yet'}
                                      </td>
                                    </tr>
                                  `}
                                </tbody>
                              </table>
                            </div>
                            
                            <!-- ENTWICKLUNGSZIELE (devGoals - aktuelle Daten) -->
                            <div style="margin-bottom: 20px; page-break-inside: avoid;">
                              <div style="background: linear-gradient(90deg, #7c3aed 0%, #8b5cf6 100%); color: white; padding: 8px 15px; border-radius: 4px 4px 0 0;">
                                <h3 style="font-size: 11pt; margin: 0; font-weight: 600;">${lang === 'de' ? 'Entwicklungsziele' : lang === 'it' ? 'Obiettivi di Sviluppo' : 'Development Goals'}</h3>
                              </div>
                              <div style="padding: 10px 15px; background: #faf5ff; border: 1px solid #e2e8f0; border-top: none;">
                                <p style="font-size: 9pt; color: #7c3aed; margin: 0;">${lang === 'de' ? 'Pers√∂nliche und fachliche Weiterentwicklung (nicht GPS-relevant)' : lang === 'it' ? 'Crescita personale e professionale (non rilevante per GPS)' : 'Personal and professional development (not GPS-relevant)'}</p>
                              </div>
                              <table style="width: 100%; border-collapse: collapse; border: 1px solid #e2e8f0; border-top: none;">
                                <thead>
                                  <tr style="background: #f1f5f9;">
                                    <th style="padding: 10px 15px; text-align: left; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #7c3aed; width: 30%;">${lang === 'de' ? 'Entwicklungsziel' : lang === 'it' ? 'Obiettivo sviluppo' : 'Development Goal'}</th>
                                    <th style="padding: 10px 15px; text-align: left; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #7c3aed; width: 15%;">${lang === 'de' ? 'Kategorie' : lang === 'it' ? 'Categoria' : 'Category'}</th>
                                    <th style="padding: 10px 15px; text-align: left; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #7c3aed; width: 35%;">${lang === 'de' ? 'Erfolgskriterium' : lang === 'it' ? 'Criterio di successo' : 'Success Criteria'}</th>
                                    <th style="padding: 10px 15px; text-align: left; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #7c3aed; width: 20%;">${lang === 'de' ? 'Bis wann' : lang === 'it' ? 'Entro quando' : 'Deadline'}</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  ${devGoals.length > 0 && devGoals.some(d => d.name) ? devGoals.map((d, idx) => `
                                    <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'};">
                                      <td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; vertical-align: top; white-space: pre-wrap;">${d.name || '‚Äì'}</td>
                                      <td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">${d.category === 'skill' ? (lang === 'de' ? 'Fachlich' : lang === 'it' ? 'Tecnico' : 'Skill') : d.category === 'leadership' ? (lang === 'de' ? 'F√ºhrung' : lang === 'it' ? 'Leadership' : 'Leadership') : d.category === 'personal' ? (lang === 'de' ? 'Pers√∂nlich' : lang === 'it' ? 'Personale' : 'Personal') : (d.category || '‚Äì')}</td>
                                      <td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; vertical-align: top; white-space: pre-wrap;">${d.target || '‚Äì'}</td>
                                      <td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">${d.deadline ? formatDate(d.deadline) : '‚Äì'}</td>
                                    </tr>
                                  `).join('') : `
                                    <tr>
                                      <td colspan="4" style="padding: 20px 15px; text-align: center; color: #94a3b8; font-style: italic;">
                                        ${lang === 'de' ? 'Noch keine Entwicklungsziele definiert' : lang === 'it' ? 'Nessun obiettivo di sviluppo definito' : 'No development goals defined yet'}
                                      </td>
                                    </tr>
                                  `}
                                </tbody>
                              </table>
                            </div>
                            
                            
                            ${(() => {
                              // BUGFIX v93: Verwende aktuelle Ma√ünahmen aus der verkn√ºpften Beurteilung (linkedReview),
                              // nicht die alte Kopie aus devPlan (die beim Speichern der Zielvereinbarung eingefroren wurde)
                              const currentDevPlan = (linkedReview?.devPlan?.length > 0 && linkedReview.devPlan.some(d => d.measure))
                                ? linkedReview.devPlan
                                : devPlan;
                              return currentDevPlan.length > 0 && currentDevPlan.some(d => d.measure) ? `
                            <!-- D.2 ENTWICKLUNGSMASSNAHMEN (aus Leistungsbeurteilung) -->
                            <div style="margin-bottom: 20px; page-break-inside: avoid;">
                              <div style="background: linear-gradient(90deg, #92400e 0%, #b45309 100%); color: white; padding: 8px 15px; border-radius: 4px 4px 0 0;">
                                <h3 style="font-size: 11pt; margin: 0; font-weight: 600;">${lang === 'de' ? 'Entwicklungsma√ünahmen (aus Leistungsbeurteilung)' : lang === 'it' ? 'Misure di sviluppo (dalla valutazione)' : 'Development Measures (from Performance Review)'}</h3>
                              </div>
                              <table style="width: 100%; border-collapse: collapse; border: 1px solid #e2e8f0; border-top: none;">
                                <thead>
                                  <tr style="background: #f1f5f9;">
                                    <th style="padding: 10px 15px; text-align: left; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #b45309; width: 50%;">${t.measure || 'Ma√ünahme'}</th>
                                    <th style="padding: 10px 15px; text-align: left; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #b45309; width: 30%;">${t.responsible || 'Verantwortlich'}</th>
                                    <th style="padding: 10px 15px; text-align: left; font-weight: 700; font-size: 9pt; border-bottom: 2px solid #b45309; width: 20%;">${t.deadline || 'Umsetzung bis'}</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  ${currentDevPlan.filter(d => d.measure).map((d, idx) => `
                                    <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'};">
                                      <td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; vertical-align: top; white-space: pre-wrap;">${d.measure || '‚Äì'}</td>
                                      <td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">${d.responsible || '‚Äì'}</td>
                                      <td style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">${d.deadline ? formatDate(d.deadline) : '‚Äì'}</td>
                                    </tr>
                                  `).join('')}
                                </tbody>
                              </table>
                            </div>
                            ` : '';
                            })()}
                            
                            <!-- TEIL G: UNTERSCHRIFTEN -->
                            <div style="margin-top: 30px; page-break-inside: avoid;">
                              <div style="background: linear-gradient(90deg, #243186 0%, #3b4a9e 100%); color: white; padding: 8px 15px; border-radius: 4px 4px 0 0;">
                                <h3 style="font-size: 11pt; margin: 0; font-weight: 600;">${t.partH || 'Teil G: Unterschriften & Einverst√§ndnis'}</h3>
                              </div>
                              <div style="border: 1px solid #e2e8f0; border-top: none; padding: 30px 20px;">
                                <p style="font-size: 9pt; color: #64748b; margin: 0 0 30px 0; text-align: center;">
                                  ${lang === 'de' ? 'Mit unseren Unterschriften best√§tigen wir die gemeinsame Vereinbarung der oben genannten Ziele.' : 'With our signatures, we confirm the mutual agreement of the above-mentioned goals.'}
                                </p>
                                <div style="display: flex; justify-content: space-around; margin-top: 40px;">
                                  <div style="width: 40%; text-align: center;">
                                    <div style="border-bottom: 2px solid #1e293b; height: 40px; margin-bottom: 10px;"></div>
                                    <p style="font-size: 9pt; color: #64748b; margin: 0;">${t.employee || 'Mitarbeiter:in (Name, Vorname)'}</p>
                                  </div>
                                  <div style="width: 40%; text-align: center;">
                                    <div style="border-bottom: 2px solid #1e293b; height: 40px; margin-bottom: 10px;"></div>
                                    <p style="font-size: 9pt; color: #64748b; margin: 0;">${t.manager || 'F√ºhrungskraft (Name, Vorname)'}</p>
                                  </div>
                                </div>
                              </div>
                            </div>
                        `;
                        
                        pdfContainer.innerHTML = pdfHTML;
                        document.body.appendChild(pdfContainer);
                        
                        const opt = {
                            margin: [10, 10, 15, 10],
                            filename: `Zielvereinbarung_${(formData.employee || 'Export').replace(/[^a-z0-9√§√∂√º√ü]/gi, '_')}_${new Date().toISOString().split('T')[0]}.pdf`,
                            image: { type: 'jpeg', quality: 0.98 },
                            html2canvas: { 
                                scale: 2,
                                useCORS: true,
                                logging: false,
                                backgroundColor: '#ffffff'
                            },
                            jsPDF: { 
                                unit: 'mm', 
                                format: 'a4', 
                                orientation: 'portrait'
                            }
                        };
                        
                        window.html2pdf()
                            .set(opt)
                            .from(pdfContainer)

                            .save()
                            .then(() => {
                                document.body.removeChild(pdfContainer);
                                setIsGenerating(false);
                            })
                            .catch(err => {
                                console.error('PDF Error:', err);
                                showToast(getText(lang, "PDF-Export fehlgeschlagen", "Errore export PDF", "PDF export failed"), "error");
                                if (document.body.contains(pdfContainer)) {
                                    document.body.removeChild(pdfContainer);
                                }
                                setIsGenerating(false);
                            });
                            
                    } catch (error) {
                        console.error('PDF Generation Error:', error);
                        showToast(getText(lang, "PDF-Export fehlgeschlagen", "Errore export PDF", "PDF export failed"), "error");
                        setIsGenerating(false);
                    }
                }, 300);
            };

            const renderGoalRow = (item) => {
                const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
                const goalBonus = plannedBonusNum > 0 ? (plannedBonusNum * (parseFloat(item.weight) || 0) / 100) : 0;
                const smart = validateSMART(item);
                
                return e('tr', { key: item.id, className: "break-inside-avoid" },
                    e('td', { className: "p-2 border align-top" }, 
                        e('textarea', { 
                            className: "w-full bg-transparent outline-none font-medium resize-none", 
                            value: item.name, 
                            rows: 2,
                            placeholder: lang === 'de' ? 'Zielbezeichnung...' : lang === 'it' ? 'Nome obiettivo...' : 'Goal name...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'name', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border text-center w-20 align-top" }, 
                        e('div', { className: "flex items-center justify-center" },
                            e('input', { 
                                type: "number", 
                                className: "w-full bg-transparent outline-none text-right pr-1", 
                                value: item.weight, 
                                onChange: (ev) => updateItem(goals, setGoals, item.id, 'weight', ev.target.value) 
                            }), 
                            e('span', null, "%")
                        )
                    ),
                    // Bonus-Spalte (nur wenn Bonus eingegeben)
                    plannedBonusNum > 0 && e('td', { className: "p-2 border text-center w-24 align-top bg-emerald-50" }, 
                        e('span', { className: "font-semibold text-emerald-700" }, 
                            goalBonus > 0 ? `${formatGermanNumber(goalBonus.toFixed(0))} ‚Ç¨` : '‚Äì'
                        )
                    ),
                    e('td', { className: "p-2 border align-top" }, 
                        e('input', { 
                            className: "w-full bg-transparent outline-none", 
                            value: item.target, 
                            placeholder: lang === 'de' ? 'z.B. 500.000‚Ç¨, 95% Qualit√§t, bis Q2...' : lang === 'it' ? 'es. 500.000‚Ç¨, 95% qualit√†, entro Q2...' : 'e.g. 500,000‚Ç¨, 95% quality, by Q2...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'target', ev.target.value) 
                        }),
                        // SMART-Check: Nur Tipps anzeigen wenn Verbesserungsbedarf besteht
                        smart.tips.length > 0 && (item.name || item.target) && e('div', { 
                            className: 'mt-1 text-[10px] text-slate-500 no-print border-l-2 border-amber-400 pl-2 py-0.5 bg-amber-50/50'
                        },
                            smart.tips.map((tip, i) => e('span', { key: i }, 
                                i > 0 ? ' ¬∑ ' : '', 
                                tip
                            ))
                        )
                    ),
                    e('td', { className: "p-2 border text-center no-print w-10 align-top" }, 
                        e('button', { 
                            onClick: () => removeItem(goals, setGoals, item.id), 
                            className: "text-red-400 hover:text-red-600 hover:bg-red-50 p-1 rounded transition-colors",
                            title: lang === 'de' ? 'Ziel entfernen' : lang === 'it' ? 'Rimuovi obiettivo' : 'Remove goal'
                        }, e(Trash2, { size: 16 }))
                    )
                );
            };
            
            // === MOBILE KARTEN-ANSICHT F√úR ZIELE ===
            const renderGoalCard = (item, index) => {
                const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
                const goalBonus = plannedBonusNum > 0 ? (plannedBonusNum * (parseFloat(item.weight) || 0) / 100) : 0;
                
                return e('div', { 
                    key: item.id, 
                    className: 'bg-white border border-slate-200 rounded-xl p-4 shadow-sm'
                },
                    // Header mit Nummer und L√∂schen
                    e('div', { className: 'flex justify-between items-center mb-3' },
                        e('span', { className: 'bg-[#243186] text-white text-xs font-bold px-2 py-1 rounded' },
                            `${lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'} ${index + 1}`
                        ),
                        e('button', { 
                            onClick: () => removeItem(goals, setGoals, item.id), 
                            className: 'text-red-400 hover:text-red-600 hover:bg-red-50 p-1.5 rounded transition-colors',
                            title: lang === 'de' ? 'Ziel entfernen' : lang === 'it' ? 'Rimuovi obiettivo' : 'Remove goal'
                        }, e(Trash2, { size: 18 }))
                    ),
                    
                    // Zielbezeichnung
                    e('div', { className: 'mb-3' },
                        e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, 
                            t.goalName
                        ),
                        e('textarea', { 
                            className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm resize-none focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                            value: item.name, 
                            rows: 2,
                            placeholder: lang === 'de' ? 'Zielbezeichnung eingeben...' : lang === 'it' ? 'Inserisci nome obiettivo...' : 'Enter goal name...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'name', ev.target.value) 
                        })
                    ),
                    
                    // Gewichtung & Bonus in einer Zeile
                    e('div', { className: 'grid grid-cols-2 gap-3 mb-3' },
                        // Gewichtung
                        e('div', null,
                            e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, 
                                t.weight
                            ),
                            e('div', { className: 'flex items-center border border-slate-200 rounded-lg overflow-hidden' },
                                e('input', { 
                                    type: 'number', 
                                    className: 'flex-1 p-2 text-center text-lg font-bold outline-none', 
                                    value: item.weight, 
                                    onChange: (ev) => updateItem(goals, setGoals, item.id, 'weight', ev.target.value) 
                                }),
                                e('span', { className: 'bg-slate-100 px-3 py-2 text-slate-600 font-medium' }, '%')
                            )
                        ),
                        // Bonus (falls vorhanden)
                        plannedBonusNum > 0 && e('div', null,
                            e('label', { className: 'text-xs font-medium text-emerald-600 block mb-1' }, 
                                'Bonus'
                            ),
                            e('div', { className: 'bg-emerald-50 border border-emerald-200 rounded-lg p-2 text-center' },
                                e('span', { className: 'text-lg font-bold text-emerald-700' }, 
                                    goalBonus > 0 ? `${formatGermanNumber(goalBonus.toFixed(0))} ‚Ç¨` : '‚Äì'
                                )
                            )
                        )
                    ),
                    
                    // Zielwert
                    e('div', null,
                        e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, 
                            lang === 'de' ? 'Zielwert / Beschreibung' : lang === 'it' ? 'Valore target' : 'Target Value'
                        ),
                        e('input', { 
                            type: 'text',
                            className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                            value: item.target, 
                            placeholder: lang === 'de' ? 'z.B. 500.000‚Ç¨, 95% Qualit√§t...' : lang === 'it' ? 'es. 500.000‚Ç¨, 95% qualit√†...' : 'e.g. 500,000‚Ç¨, 95% quality...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'target', ev.target.value) 
                        }),
                        // SMART-Tipps (Mobile) - nur wenn Verbesserungsbedarf
                        (() => {
                            const smart = validateSMART(item);
                            return smart.tips.length > 0 && (item.name || item.target) && e('div', { 
                                className: 'mt-1 text-[10px] text-slate-500 border-l-2 border-amber-400 pl-2 py-0.5 bg-amber-50/50'
                            },
                                smart.tips.join(' ¬∑ ')
                            );
                        })()
                    )
                );
            };

            const renderDevRow = (item) => (
                e('tr', { key: item.id, className: "break-inside-avoid" },
                    e('td', { className: "p-2 border align-top" }, 
                        e('textarea', { 
                            className: "w-full bg-transparent outline-none resize-none overflow-hidden min-h-[2rem]", 
                            value: item.measure, 
                            placeholder: "...", 
                            rows: 1,
                            style: { whiteSpace: 'pre-wrap', wordWrap: 'break-word' },
                            onChange: (ev) => {
                                updateItem(devPlan, setDevPlan, item.id, 'measure', ev.target.value);
                                // Auto-grow: H√∂he anpassen
                                ev.target.style.height = 'auto';
                                ev.target.style.height = ev.target.scrollHeight + 'px';
                            },
                            onInput: (ev) => {
                                ev.target.style.height = 'auto';
                                ev.target.style.height = ev.target.scrollHeight + 'px';
                            }
                        })
                    ),
                    e('td', { className: "p-2 border align-top" }, 
                        e('input', { 
                            className: "w-full bg-transparent outline-none", 
                            value: item.responsible, 
                            placeholder: "...", 
                            onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'responsible', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border align-top" }, 
                        e('input', { 
                            type: "date", 
                            className: "w-full bg-transparent outline-none", 
                            value: item.deadline, 
                            onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'deadline', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border text-center no-print w-8 align-top" }, 
                        e('button', { 
                            onClick: () => removeItem(devPlan, setDevPlan, item.id), 
                            className: "text-slate-300 hover:text-red-500" 
                        }, e(Trash2, { size: 14 }))
                    )
                )
            );
            
            // === MOBILE KARTE F√úR ENTWICKLUNGSMASSNAHMEN ===
            const renderDevCardZiel = (item, index) => {
                return e('div', { 
                    key: item.id, 
                    className: 'bg-white border border-slate-200 rounded-xl p-4 shadow-sm break-inside-avoid'
                },
                    e('div', { className: 'flex justify-between items-center mb-3' },
                        e('span', { className: 'bg-emerald-100 text-emerald-700 text-xs font-bold px-2 py-1 rounded' },
                            `${lang === 'de' ? 'Ma√ünahme' : lang === 'it' ? 'Misura' : 'Measure'} ${index + 1}`
                        ),
                        e('button', { 
                            onClick: () => removeItem(devPlan, setDevPlan, item.id), 
                            className: 'text-slate-400 hover:text-red-500 p-1'
                        }, e(Trash2, { size: 16 }))
                    ),
                    e('div', { className: 'space-y-3' },
                        e('div', null,
                            e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.measure),
                            e('textarea', { 
                                className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none resize-none', 
                                value: item.measure, 
                                placeholder: '...', 
                                rows: 2,
                                style: { whiteSpace: 'pre-wrap', wordWrap: 'break-word', minHeight: '60px' },
                                onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'measure', ev.target.value) 
                            })
                        ),
                        e('div', { className: 'grid grid-cols-2 gap-3' },
                            e('div', null,
                                e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.responsible),
                                e('input', { 
                                    type: 'text',
                                    className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                                    value: item.responsible, 
                                    placeholder: '...', 
                                    onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'responsible', ev.target.value) 
                                })
                            ),
                            e('div', null,
                                e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.deadline),
                                e('input', { 
                                    type: 'date',
                                    className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                                    value: item.deadline, 
                                    onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'deadline', ev.target.value) 
                                })
                            )
                        )
                    )
                );
            };

            return e('div', { ref: formRef, className: "max-w-5xl mx-auto space-y-8 pb-20" },
                
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100" },
                    e('div', { className: "flex justify-between items-start mb-6" },
                        e('div', null, 
                            e('h1', { className: "text-3xl font-bold", style: { color: "#243186" } }, "nƒ±ederwƒ±eser"), 
                            e('span', { className: "text-sm tracking-wider font-medium", style: { color: "#6EBD84" } }, "FLEXIBLE FOOD PACKAGING")
                        ),
                        e('button', { 
                            onClick: handleDownloadPDF, 
                            disabled: isGenerating || isLoadingReview, 
                            className: "no-print flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-2xl hover:bg-blue-700 transition-colors disabled:opacity-50" 
                        }, 
                            isGenerating ? e(Loader2, { className: "animate-spin", size: 18 }) : isLoadingReview ? e(Loader2, { className: "animate-spin", size: 18 }) : e(Download, { size: 18 }), 
                            isGenerating ? t.generating : isLoadingReview ? (lang === 'de' ? 'Lade Daten...' : 'Loading...') : t.print
                        )
                    ),
                    e('div', { className: "border-b-2 border-slate-100 mb-4" }),
                    
                    // === DEBUG: Check Team Buttons ===
                    (() => {
                      devLog('üé® Rendering form - teamButtonsVisible:', teamButtonsVisible, 'teamContext:', teamContext);
                      return null;
                    })(),
                    
                    // === TEAM BUTTONS (wenn teamContext) ===
                    teamButtonsVisible && teamContext && e('div', {
                      className: 'mb-6 p-5 bg-gradient-to-r from-[#243186] to-[#1a2564] rounded-xl shadow-2xl border-2 border-[#6EBD84]'
                    },
                      e('div', { className: 'flex flex-col gap-4' },
                        e('div', { className: 'flex justify-between items-start' },
                          e('div', { className: 'text-white' },
                            e('h2', { className: 'text-3xl font-bold mb-1', style: { color: '#6EBD84' } }, 
                              teamContext.employee?.name || teamContext.existingData?.employeeName || getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee')
                            ),
                            e('p', { className: 'text-blue-200 text-base font-semibold' }, 
                              (teamContext.employee?.position || teamContext.existingData?.position || '') + (teamContext.employee?.department ? ' ‚Ä¢ ' + teamContext.employee.department : '')
                            ),
                            e('p', { className: 'text-blue-100 text-sm mt-2 font-medium' }, 
                              (lang === 'de' ? 'Bewertungszeitraum: ' : lang === 'it' ? 'Periodo: ' : 'Assessment period: ') + (teamContext.period || new Date().getFullYear())
                            )
                          ),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'text-white/80 hover:text-white transition-colors text-4xl leading-none font-bold'
                          }, '√ó')
                        ),
                        e('div', { className: 'grid grid-cols-3 gap-4 mt-2' },
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('draft'),
                            type: 'button',
                            disabled: isSaving,
                            className: `py-4 px-5 rounded-xl font-bold text-base transition-all shadow-lg ${isSaving ? 'bg-slate-400 text-slate-200 cursor-not-allowed' : 'bg-slate-200 hover:bg-slate-300 text-slate-900 transform hover:scale-105'}`
                          }, isSaving ? '‚è≥ ...' : 'üíæ ' + (lang === 'de' ? 'Als Entwurf' : lang === 'it' ? 'Bozza' : 'Save Draft')),
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('completed'),
                            type: 'button',
                            disabled: isSaving,
                            className: `py-4 px-5 rounded-xl font-bold text-base transition-all shadow-lg ${isSaving ? 'bg-green-300 text-green-100 cursor-not-allowed' : 'bg-[#6EBD84] hover:bg-[#5da872] text-white transform hover:scale-105'}`
                          }, isSaving ? '‚è≥ ...' : '‚úì ' + (lang === 'de' ? 'Abschlie√üen' : lang === 'it' ? 'Completa' : 'Complete')),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'border-2 border-white/40 text-white py-4 px-5 rounded-xl font-bold hover:bg-white/20 transition-all shadow-lg text-base'
                          }, lang === 'de' ? 'Abbrechen' : lang === 'it' ? 'Annulla' : 'Cancel')
                        )
                      )
                    ),
                    
                    // === VERSION HISTORY DROPDOWN (IMMER anzeigen wenn teamContext) ===
                    teamButtonsVisible && teamContext && e('div', {
                      className: 'mb-6 p-4 ' + (teamContext?.existingData?.versionHistory?.length > 0 ? 'bg-amber-50 border-2 border-amber-300' : 'bg-slate-50 border border-slate-200') + ' rounded-xl'
                    },
                      e('div', { className: 'flex items-center gap-3 flex-wrap' },
                        e('span', { className: (teamContext?.existingData?.versionHistory?.length > 0 ? 'text-amber-800' : 'text-slate-600') + ' font-bold flex items-center gap-2' },
                          'üìö ',
                          lang === 'de' ? 'Versionshistorie:' : lang === 'it' ? 'Cronologia versioni:' : 'Version history:'
                        ),
                        
                        // Wenn Versionen vorhanden - Dropdown anzeigen
                        teamContext?.existingData?.versionHistory && teamContext.existingData.versionHistory.length > 0 
                          ? e('select', {
                              className: 'flex-1 min-w-[200px] p-2 border border-amber-400 rounded-lg bg-white text-sm',
                              onChange: (ev) => {
                                const idx = parseInt(ev.target.value);
                                if (idx >= 0 && teamContext.existingData.versionHistory[idx]) {
                                  const version = teamContext.existingData.versionHistory[idx];
                                  const confirmMsg = lang === 'de' 
                                    ? `Version vom ${new Date(version.savedAt).toLocaleString('de-DE')} wiederherstellen?\n\nGPS: ${(version.gpsScore || 0).toFixed(2)}\nZiele: ${(version.goals || []).length}\n\nAchtung: Aktuelle Eingaben werden √ºberschrieben!`
                                    : `Restore version from ${new Date(version.savedAt).toLocaleString()}?\n\nGPS: ${(version.gpsScore || 0).toFixed(2)}\nGoals: ${(version.goals || []).length}\n\nWarning: Current inputs will be overwritten!`;
                                  
                                  if (confirm(confirmMsg)) {
                                    devLog('üìö Restoring version:', version);
                                    
                                    if (version.goals && Array.isArray(version.goals)) {
                                      setGoals(version.goals);
                                    }
                                    
                                    if (version.coreScores) {
                                      const defs = DEFAULTS[lang] || DEFAULTS['de'];
                                      const restoredCore = defs.core.map(c => ({
                                        ...c,
                                        rating: version.coreScores[c.id] !== undefined ? version.coreScores[c.id] : c.rating,
                                        comment: version.coreComments?.[c.id] || ''
                                      }));
                                      setCoreList(restoredCore);
                                    }
                                    
                                    if (version.leaderScores) {
                                      const defs = DEFAULTS[lang] || DEFAULTS['de'];
                                      const restoredLead = defs.lead.map(c => ({
                                        ...c,
                                        rating: version.leaderScores[c.id] !== undefined ? version.leaderScores[c.id] : c.rating,
                                        comment: version.leaderComments?.[c.id] || ''
                                      }));
                                      setLeadList(restoredLead);
                                    }
                                    
                                    if (version.formData) {
                                      setFormData(prev => ({ ...prev, ...version.formData }));
                                    }
                                    
                                    if (version.careerChecks) {
                                      setCareerChecks(version.careerChecks);
                                    }
                                    
                                    if (version.devPlan) {
                                      setDevPlan(version.devPlan);
                                    }
                                    
                                    if (version.devGoals) {
                                      setDevGoals(version.devGoals);
                                    }
                                    
                                    showToast(lang === 'de' ? 'Version wiederhergestellt! Bitte speichern Sie um die √Ñnderungen zu behalten.' : '‚úÖ Version restored! Please save to keep the changes.', 'warning');
                                  }
                                  ev.target.value = '';
                                }
                              },
                              defaultValue: ''
                            },
                              e('option', { value: '', disabled: true }, 
                                lang === 'de' ? '-- Version ausw√§hlen --' : lang === 'it' ? '-- Seleziona versione --' : '-- Select version --'
                              ),
                              teamContext.existingData.versionHistory.map((v, idx) => 
                                e('option', { key: idx, value: idx },
                                  new Date(v.savedAt).toLocaleString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-US', {
                                    day: '2-digit',
                                    month: '2-digit',
                                    year: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                  }) + ' ‚Ä¢ GPS: ' + (v.gpsScore || 0).toFixed(2) + ' ‚Ä¢ ' + (v.goals?.length || 0) + ' ' + (lang === 'de' ? 'Ziele' : 'Goals')
                                )
                              )
                            )
                          // Wenn KEINE Versionen vorhanden - Info anzeigen
                          : e('span', { className: 'text-slate-500 text-sm italic' },
                              lang === 'de' 
                                ? 'Noch keine Versionen gespeichert. Versionen werden automatisch beim Speichern erstellt.' 
                                : 'No versions saved yet. Versions are automatically created when saving.'
                            ),
                        
                        // Anzahl Versionen anzeigen
                        teamContext?.existingData?.versionHistory?.length > 0 && e('span', { className: 'text-amber-600 text-xs' },
                          '(' + teamContext.existingData.versionHistory.length + ' ' + (lang === 'de' ? 'Versionen' : 'versions') + ')'
                        )
                      )
                    ),
                    
                    e('h2', { className: "text-2xl font-bold", style: { color: "#243186" } }, lang === 'de' ? 'Zielvereinbarung' : lang === 'it' ? 'Accordo sugli obiettivi' : 'Goal Agreement'),
                    e('p', { className: "font-medium", style: { color: "#6EBD84" } }, t.headerSubtitle)
                ),

                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partA),
                    e('div', { className: "grid grid-cols-2 gap-6" },
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.employee), e('input', { type: "text", value: formData.employee, onChange: (ev) => handleFormChange('employee', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.manager), e('input', { type: "text", value: formData.manager, onChange: (ev) => handleFormChange('manager', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.position), e('input', { type: "text", value: formData.position, onChange: (ev) => handleFormChange('position', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.date), e('input', { type: "date", value: formData.date, onChange: (ev) => handleFormChange('date', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" }))
                    )
                ),

                e('div', { className: "bg-white p-4 md:p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, lang === 'de' ? 'Zieldefinition' : lang === 'it' ? 'Definizione degli obiettivi' : 'Goal Definition'),
                    
                    // === DESKTOP: Tabellen-Ansicht (hidden on mobile) ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm" },
                            e('thead', { className: "bg-slate-50 text-left" }, 
                                e('tr', null, 
                                    e('th', { className: "p-2 border w-1/3" }, t.goalName), 
                                    e('th', { className: "p-2 border w-20" }, t.weight), 
                                    // Bonus-Spalte Header (nur wenn Bonus eingegeben)
                                    parseFloat(formData.plannedBonus) > 0 && e('th', { className: "p-2 border w-24 bg-emerald-50 text-emerald-700" }, lang === 'de' ? 'Bonus ‚Ç¨' : lang === 'it' ? 'Bonus ‚Ç¨' : 'Bonus ‚Ç¨'),
                                    e('th', { className: "p-2 border" }, lang === 'de' ? 'Zielwert / Beschreibung' : lang === 'it' ? 'Valore target / Descrizione' : 'Target Value / Description'), 
                                    e('th', { className: "p-2 border no-print w-8" }, "")
                                )
                            ),
                            e('tbody', null, goals.map(item => renderGoalRow(item)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht (hidden on desktop) ===
                    e('div', { className: 'md:hidden space-y-4' },
                        goals.map((item, index) => renderGoalCard(item, index)),
                        // Gewichtungs-Summe f√ºr Mobile
                        e('div', { 
                            className: `mt-3 p-3 rounded-lg flex items-center justify-between ${
                                goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0) === 100 
                                    ? 'bg-green-50 border border-green-200' 
                                    : 'bg-amber-50 border border-amber-200'
                            }`
                        },
                            e('span', { className: 'font-semibold text-sm' }, 
                                lang === 'de' ? 'Gewichtungssumme:' : lang === 'it' ? 'Somma ponderazioni:' : 'Weight Sum:'
                            ),
                            e('span', { className: 'text-xl font-bold' }, 
                                `${goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0)}%`
                            )
                        )
                    ),
                    
                    e('button', { 
                        onClick: () => addItem(goals, setGoals, {name:'', weight:0, target:''}), 
                        className: "no-print mt-3 text-xs flex items-center gap-1 text-blue-600" 
                    }, e(PlusCircle, {size:14}), t.addGoal),
                    
                    // Geplanter Bonus (100%) Feld
                    e('div', { className: "mt-6 pt-4 border-t border-slate-200" },
                        e('div', { className: "flex items-center gap-4" },
                            e('label', { className: "text-sm font-semibold text-slate-700 whitespace-nowrap" }, 
                                lang === 'de' ? 'Geplanter Bonus (100%):' : lang === 'it' ? 'Bonus previsto (100%):' : 'Planned Bonus (100%):'
                            ),
                            e('div', { className: "relative w-48" },
                                e('input', { 
                                    type: "text", 
                                    value: displayBonus,
                                    onChange: (ev) => handleBonusChange(ev.target.value),
                                    placeholder: lang === 'de' ? 'z.B. 5.000' : lang === 'it' ? 'es. 5.000' : 'e.g. 5,000',
                                    className: "w-full border border-slate-300 rounded-lg px-3 py-2 pr-8 outline-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] text-right font-medium"
                                }),
                                e('span', { className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium" }, '‚Ç¨')
                            ),
                            e('span', { className: "text-xs text-slate-400" }, 
                                lang === 'de' ? '(Tausenderpunkte erlaubt: 1.000 = 1000)' : lang === 'it' ? '(Punti per migliaia: 1.000 = 1000)' : '(Thousands separators allowed: 1,000 = 1000)'
                            )
                        )
                    )
                ),

                // === VERKN√úPFTE BEURTEILUNG: ENTWICKLUNGSFELDER AUS D.2 ===
                linkedReview && linkedReview.devPlan?.filter(d => d.measure).length > 0 && e('div', { 
                    className: "no-print bg-gradient-to-r from-amber-50 to-orange-50 p-4 md:p-6 rounded-3xl shadow-lg border-2 border-amber-200 break-inside-avoid mb-6" 
                },
                    e('div', { className: 'flex items-center justify-between mb-4' },
                        e('h3', { className: "text-lg font-bold text-amber-800 flex items-center gap-2" }, 
                            e('span', { className: 'text-2xl' }, 'üìã'),
                            lang === 'de' ? 'Entwicklungsma√ünahmen aus letzter Beurteilung (D.2)' 
                            : lang === 'it' ? 'Misure di sviluppo dall\'ultima valutazione (D.2)' 
                            : 'Development Measures from Last Review (D.2)'
                        ),
                        e('span', { className: 'text-xs text-amber-600 bg-amber-100 px-2 py-1 rounded-full' },
                            new Date(linkedReview.updatedAt || linkedReview.createdAt).toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB')
                        )
                    ),
                    e('p', { className: 'text-sm text-amber-700 mb-4' },
                        lang === 'de' ? 'Diese Ma√ünahmen wurden in der letzten Leistungsbeurteilung definiert. Sie k√∂nnen als Entwicklungsziele √ºbernommen werden.'
                        : lang === 'it' ? 'Queste misure sono state definite nell\'ultima valutazione. Possono essere trasferite come obiettivi di sviluppo.'
                        : 'These measures were defined in the last review. They can be transferred as development goals.'
                    ),
                    
                    // D.2 Ma√ünahmen Tabelle
                    e('div', { className: 'bg-white rounded-xl p-4 border border-amber-200 mb-4' },
                        e('table', { className: 'w-full text-sm' },
                            e('thead', { className: 'bg-amber-50' },
                                e('tr', null,
                                    e('th', { className: 'p-2 text-left text-amber-800 text-xs font-semibold' }, 
                                        lang === 'de' ? 'Ma√ünahme' : lang === 'it' ? 'Misura' : 'Measure'),
                                    e('th', { className: 'p-2 text-left text-amber-800 text-xs font-semibold w-32' }, 
                                        lang === 'de' ? 'Verantwortlich' : lang === 'it' ? 'Responsabile' : 'Responsible'),
                                    e('th', { className: 'p-2 text-left text-amber-800 text-xs font-semibold w-28' }, 
                                        lang === 'de' ? 'Termin' : lang === 'it' ? 'Scadenza' : 'Deadline')
                                )
                            ),
                            e('tbody', null,
                                linkedReview.devPlan.filter(d => d.measure).map((d, idx) =>
                                    e('tr', { key: idx, className: 'border-t border-amber-100' },
                                        e('td', { className: 'p-2 text-slate-700' }, d.measure),
                                        e('td', { className: 'p-2 text-slate-600' }, d.responsible || '-'),
                                        e('td', { className: 'p-2 text-slate-600' }, 
                                            d.deadline ? new Date(d.deadline).toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB') : '-'
                                        )
                                    )
                                )
                            )
                        )
                    ),
                    
                    // √úbernahme-Buttons
                    e('div', { className: 'flex flex-wrap gap-3' },
                        // Button: Alle als Entwicklungsziele √ºbernehmen
                        linkedReview.devPlan?.filter(d => d.measure).length > 0 && e('button', {
                            className: 'flex items-center gap-2 px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors text-sm font-medium',
                            onClick: () => {
                                const confirmMsg = lang === 'de' 
                                    ? 'Alle Entwicklungsma√ünahmen aus der Beurteilung als neue Entwicklungsziele √ºbernehmen?' 
                                    : lang === 'it' 
                                        ? 'Trasferire tutte le misure di sviluppo dalla valutazione come nuovi obiettivi di sviluppo?'
                                        : 'Transfer all development measures from the review as new development goals?';
                                if (confirm(confirmMsg)) {
                                    const newDevGoals = linkedReview.devPlan.filter(d => d.measure).map((d, idx) => ({
                                        id: Date.now() + idx,
                                        name: d.measure,
                                        target: '',
                                        deadline: d.deadline || '',
                                        category: 'skill'
                                    }));
                                    setDevGoals(prev => [...prev.filter(g => g.name), ...newDevGoals]);
                                }
                            }
                        }, 
                            e('span', null, '‚ûï'),
                            lang === 'de' ? 'Alle √ºbernehmen' : lang === 'it' ? 'Trasferisci tutti' : 'Transfer All'
                        ),
                        
                        // Einzelne Ma√ünahmen
                        linkedReview.devPlan?.filter(d => d.measure).map((d, idx) =>
                            e('button', {
                                key: idx,
                                className: 'flex items-center gap-1 px-3 py-1.5 bg-white border border-amber-300 text-amber-700 rounded-lg hover:bg-amber-50 transition-colors text-xs',
                                onClick: () => {
                                    const newGoal = {
                                        id: Date.now(),
                                        name: d.measure,
                                        target: '',
                                        deadline: d.deadline || '',
                                        category: 'skill'
                                    };
                                    setDevGoals(prev => [...prev.filter(g => g.name), newGoal]);
                                }
                            },
                                e('span', null, '+'),
                                d.measure.length > 30 ? d.measure.substring(0, 30) + '...' : d.measure
                            )
                        )
                    )
                ),
                
                // Loading-Indikator
                isLoadingReview && e('div', { className: 'no-print text-center py-4 text-slate-500' },
                    e('span', { className: 'animate-pulse' }, '‚è≥ '),
                    lang === 'de' ? 'Lade verkn√ºpfte Beurteilung...' : lang === 'it' ? 'Caricamento valutazione collegata...' : 'Loading linked review...'
                ),
                
                // Info wenn keine Beurteilung gefunden (nur im Team-Kontext)
                !isLoadingReview && !linkedReview && teamContext && e('div', { 
                    className: 'no-print bg-slate-50 border border-slate-200 rounded-xl p-4 mb-6 text-sm text-slate-600'
                },
                    e('span', { className: 'font-semibold' }, 'üí° '),
                    lang === 'de' ? 'Keine vorherige Leistungsbeurteilung gefunden. Die Entwicklungsziele k√∂nnen manuell erfasst werden.'
                    : lang === 'it' ? 'Nessuna valutazione delle prestazioni precedente trovata. Gli obiettivi di sviluppo possono essere inseriti manualmente.'
                    : 'No previous performance review found. Development goals can be entered manually.'
                ),

                e('div', { className: "bg-white p-4 md:p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, 
                        lang === 'de' ? 'Entwicklungsziele (nicht GPS-relevant)' : lang === 'it' ? 'Obiettivi di sviluppo (non rilevanti per GPS)' : 'Development Goals (not GPS-relevant)'
                    ),
                    e('p', { className: "text-xs text-slate-500 mb-4 bg-blue-50 p-3 rounded-lg" }, 
                        lang === 'de' ? 'Hinweis: Entwicklungsziele dienen der pers√∂nlichen und fachlichen Weiterentwicklung. Sie flie√üen NICHT in die GPS-Berechnung oder den Bonus ein, sondern unterst√ºtzen die langfristige Karriereentwicklung.' 
                        : lang === 'it' ? 'Nota: Gli obiettivi di sviluppo servono per la crescita personale e professionale. NON influenzano il calcolo GPS o il bonus, ma supportano lo sviluppo di carriera a lungo termine.'
                        : 'Note: Development goals serve personal and professional growth. They do NOT affect GPS calculation or bonus, but support long-term career development.'
                    ),
                    
                    // Entwicklungsziele Tabelle (Desktop) - mit flexiblen Zellen
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm mb-2 table-fixed" },
                            e('thead', { className: "bg-purple-50 text-left" }, 
                                e('tr', null, 
                                    e('th', { className: "p-2 border w-[35%]" }, lang === 'de' ? 'Entwicklungsziel' : lang === 'it' ? 'Obiettivo sviluppo' : 'Development Goal'), 
                                    e('th', { className: "p-2 border w-[15%]" }, lang === 'de' ? 'Kategorie' : lang === 'it' ? 'Categoria' : 'Category'),
                                    e('th', { className: "p-2 border w-[30%]" }, lang === 'de' ? 'Erfolgskriterium' : lang === 'it' ? 'Criterio di successo' : 'Success Criteria'), 
                                    e('th', { className: "p-2 border w-[12%]" }, lang === 'de' ? 'Bis wann' : lang === 'it' ? 'Entro quando' : 'Deadline'),
                                    e('th', { className: "p-2 border no-print w-[8%]" }, "")
                                )
                            ),
                            e('tbody', null, devGoals.map((item, idx) => 
                                e('tr', { key: item.id, className: "break-inside-avoid" },
                                    e('td', { className: "p-2 border align-top" }, 
                                        e('textarea', { 
                                            className: "w-full bg-transparent outline-none resize-none overflow-hidden min-h-[60px]", 
                                            value: item.name, 
                                            placeholder: lang === 'de' ? 'z.B. Projektmanagement-Zertifizierung...' : 'e.g. Project management certification...',
                                            style: { height: 'auto' },
                                            onInput: (ev) => {
                                                ev.target.style.height = 'auto';
                                                ev.target.style.height = ev.target.scrollHeight + 'px';
                                            },
                                            onChange: (ev) => {
                                                const newList = devGoals.map(g => g.id === item.id ? {...g, name: ev.target.value} : g);
                                                setDevGoals(newList);
                                            },
                                            ref: (el) => {
                                                if (el) {
                                                    el.style.height = 'auto';
                                                    el.style.height = el.scrollHeight + 'px';
                                                }
                                            }
                                        })
                                    ),
                                    e('td', { className: "p-2 border align-top" }, 
                                        e('select', {
                                            value: item.category || 'skill',
                                            className: "w-full bg-transparent outline-none text-sm",
                                            onChange: (ev) => {
                                                const newList = devGoals.map(g => g.id === item.id ? {...g, category: ev.target.value} : g);
                                                setDevGoals(newList);
                                            }
                                        },
                                            e('option', { value: 'skill' }, lang === 'de' ? 'Fachkompetenz' : lang === 'it' ? 'Competenza tecnica' : 'Technical Skill'),
                                            e('option', { value: 'leadership' }, lang === 'de' ? 'F√ºhrung' : lang === 'it' ? 'Leadership' : 'Leadership'),
                                            e('option', { value: 'certification' }, lang === 'de' ? 'Zertifizierung' : lang === 'it' ? 'Certificazione' : 'Certification'),
                                            e('option', { value: 'career' }, lang === 'de' ? 'Karriere' : lang === 'it' ? 'Carriera' : 'Career'),
                                            e('option', { value: 'soft' }, lang === 'de' ? 'Soft Skills' : lang === 'it' ? 'Soft Skills' : 'Soft Skills')
                                        )
                                    ),
                                    e('td', { className: "p-2 border align-top" }, 
                                        e('textarea', { 
                                            className: "w-full bg-transparent outline-none resize-none overflow-hidden min-h-[60px]", 
                                            value: item.target,
                                            placeholder: lang === 'de' ? 'Woran messen wir den Erfolg?' : 'How do we measure success?',
                                            style: { height: 'auto' },
                                            onInput: (ev) => {
                                                ev.target.style.height = 'auto';
                                                ev.target.style.height = ev.target.scrollHeight + 'px';
                                            },
                                            onChange: (ev) => {
                                                const newList = devGoals.map(g => g.id === item.id ? {...g, target: ev.target.value} : g);
                                                setDevGoals(newList);
                                            },
                                            ref: (el) => {
                                                if (el) {
                                                    el.style.height = 'auto';
                                                    el.style.height = el.scrollHeight + 'px';
                                                }
                                            }
                                        })
                                    ),
                                    e('td', { className: "p-2 border align-top" }, 
                                        e('input', { 
                                            type: "date",
                                            className: "w-full bg-transparent outline-none text-sm",
                                            value: item.deadline || '',
                                            onChange: (ev) => {
                                                const newList = devGoals.map(g => g.id === item.id ? {...g, deadline: ev.target.value} : g);
                                                setDevGoals(newList);
                                            }
                                        })
                                    ),
                                    e('td', { className: "p-2 border text-center no-print align-top" }, 
                                        e('button', { 
                                            onClick: () => setDevGoals(devGoals.filter(g => g.id !== item.id)), 
                                            className: "text-slate-300 hover:text-red-500" 
                                        }, e(Trash2, { size: 14 }))
                                    )
                                )
                            ))
                        )
                    ),
                    
                    // Entwicklungsziele Karten (Mobile)
                    e('div', { className: 'md:hidden space-y-4' },
                        devGoals.map((item, idx) => 
                            e('div', { key: item.id, className: 'bg-purple-50 border border-purple-200 rounded-xl p-4' },
                                e('div', { className: 'flex justify-between items-center mb-3' },
                                    e('span', { className: 'bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded' }, 
                                        (lang === 'de' ? 'Entwicklung ' : 'Dev ') + (idx + 1)
                                    ),
                                    e('button', { 
                                        onClick: () => setDevGoals(devGoals.filter(g => g.id !== item.id)),
                                        className: 'text-slate-400 hover:text-red-500'
                                    }, e(Trash2, { size: 16 }))
                                ),
                                e('div', { className: 'space-y-3' },
                                    e('textarea', { 
                                        className: 'w-full bg-white rounded-lg p-3 text-sm resize-none border',
                                        value: item.name,
                                        rows: 2,
                                        placeholder: lang === 'de' ? 'Entwicklungsziel...' : 'Development goal...',
                                        onChange: (ev) => {
                                            const newList = devGoals.map(g => g.id === item.id ? {...g, name: ev.target.value} : g);
                                            setDevGoals(newList);
                                        }
                                    }),
                                    e('div', { className: 'grid grid-cols-2 gap-2' },
                                        e('select', {
                                            value: item.category || 'skill',
                                            className: 'bg-white rounded-lg p-2 text-sm border',
                                            onChange: (ev) => {
                                                const newList = devGoals.map(g => g.id === item.id ? {...g, category: ev.target.value} : g);
                                                setDevGoals(newList);
                                            }
                                        },
                                            e('option', { value: 'skill' }, lang === 'de' ? 'Fachkompetenz' : lang === 'it' ? 'Competenza tecnica' : 'Technical Skill'),
                                            e('option', { value: 'leadership' }, lang === 'de' ? 'F√ºhrung' : lang === 'it' ? 'Leadership' : 'Leadership'),
                                            e('option', { value: 'certification' }, lang === 'de' ? 'Zertifizierung' : lang === 'it' ? 'Certificazione' : 'Certification'),
                                            e('option', { value: 'career' }, lang === 'de' ? 'Karriere' : lang === 'it' ? 'Carriera' : 'Career'),
                                            e('option', { value: 'soft' }, lang === 'de' ? 'Soft Skills' : lang === 'it' ? 'Soft Skills' : 'Soft Skills')
                                        ),
                                        e('input', {
                                            type: 'date',
                                            value: item.deadline || '',
                                            className: 'bg-white rounded-lg p-2 text-sm border',
                                            onChange: (ev) => {
                                                const newList = devGoals.map(g => g.id === item.id ? {...g, deadline: ev.target.value} : g);
                                                setDevGoals(newList);
                                            }
                                        })
                                    )
                                )
                            )
                        )
                    ),
                    
                    e('button', { 
                        onClick: () => setDevGoals([...devGoals, { id: Date.now(), name: '', target: '', deadline: '', category: 'skill' }]), 
                        className: "no-print mt-3 text-xs flex items-center gap-1 text-purple-600 hover:text-purple-800" 
                    }, e(PlusCircle, {size:14}), lang === 'de' ? 'Entwicklungsziel hinzuf√ºgen' : lang === 'it' ? 'Aggiungi obiettivo sviluppo' : 'Add development goal')
                ),

                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-8 border-b pb-2" }, t.partH),
                    e('div', { className: "grid grid-cols-2 gap-12" },
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.employee)),
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.manager))
                    )
                )
            );
        };

        // === APPRAISAL FORM COMPONENT ===
        const AppraisalForm = ({ lang, onSaveTeam, onCancel, db, setActiveView }) => {
            devLog('üîÑ AppraisalForm wird gerendert...');
            devLog('   Props:', { lang, onSaveTeam: !!onSaveTeam, onCancel: !!onCancel, db: !!db });
            
            const t = FORM_TEXT[lang] || FORM_TEXT['de'];
            const defs = DEFAULTS[lang] || DEFAULTS['de'];
            const formRef = useRef(null);
            
            devLog('   t loaded:', !!t);
            devLog('   defs loaded:', !!defs, defs ? { coreCount: defs.core?.length, leadCount: defs.lead?.length } : null);
            
            // === LADE EXISTIERENDE DATEN VOR STATE-INITIALISIERUNG ===
            const initialContext = useMemo(() => {
              const ctx = safeLocalStorage.getItem('nw_current_employee', null);
              devLog('üìÇ Initial context from localStorage:', ctx ? 'found' : 'not found');
              if (ctx?.existingData) {
                devLog('   existingData found:', {
                  employeeName: ctx.existingData.employeeName,
                  coreScores: ctx.existingData.coreScores,
                  goals: ctx.existingData.goals?.length
                });
              }
              return ctx;
            }, []);
            
            // Initialisiere Core-List mit existierenden Scores falls vorhanden
            const getInitialCoreList = () => {
              const base = defs.core || [];
              if (initialContext?.existingData?.coreScores && typeof initialContext.existingData.coreScores === 'object') {
                const scores = initialContext.existingData.coreScores;
                const comments = initialContext.existingData.coreComments || {};
                devLog('   ‚úì Initializing coreList with', Object.keys(scores).length, 'existing scores');
                return base.map(c => ({
                  ...c,
                  rating: scores[c.id] !== undefined ? scores[c.id] : c.rating,
                  comment: comments[c.id] || ''
                }));
              }
              devLog('   ‚ÑπÔ∏è Initializing coreList with defaults');
              return base.map(c => ({ ...c, comment: '' }));
            };
            
            // Initialisiere Lead-List mit existierenden Scores falls vorhanden
            const getInitialLeadList = () => {
              const base = defs.lead || [];
              if (initialContext?.existingData?.leaderScores && typeof initialContext.existingData.leaderScores === 'object') {
                const scores = initialContext.existingData.leaderScores;
                const comments = initialContext.existingData.leaderComments || {};
                devLog('   ‚úì Initializing leadList with', Object.keys(scores).length, 'existing scores');
                return base.map(c => ({
                  ...c,
                  rating: scores[c.id] !== undefined ? scores[c.id] : c.rating,
                  comment: comments[c.id] || ''
                }));
              }
              devLog('   ‚ÑπÔ∏è Initializing leadList with defaults');
              return base.map(c => ({ ...c, comment: '' }));
            };
            
            // Initialisiere Goals mit existierenden Daten falls vorhanden
            const getInitialGoals = () => {
              if (initialContext?.existingData?.goals && Array.isArray(initialContext.existingData.goals)) {
                devLog('   ‚úì Initializing goals with', initialContext.existingData.goals.length, 'existing items');
                return initialContext.existingData.goals;
              }
              devLog('   ‚ÑπÔ∏è Initializing goals as empty array');
              return [];
            };
            
            // NEU: Initialisiere DevPlan korrekt
            const getInitialDevPlan = () => {
              if (initialContext?.existingData?.devPlan && Array.isArray(initialContext.existingData.devPlan)) {
                if (initialContext.existingData.devPlan.length > 0) {
                  devLog('   ‚úì Initializing devPlan with', initialContext.existingData.devPlan.length, 'existing items');
                  return initialContext.existingData.devPlan;
                }
              }
              devLog('   ‚ÑπÔ∏è Initializing devPlan with default item');
              return [{ id: 201, measure: '', responsible: '', deadline: '' }];
            };
            
            // Initialisiere FormData mit existierenden Daten falls vorhanden
            const getInitialFormData = () => {
              const base = {
                employee: '',
                position: '',
                manager: '',
                date: new Date().toISOString().split('T')[0],
                strengths1: '',
                strengths2: '',
                careerComment: '',
                feedbackQ1: '',
                feedbackQ2: '',
                feedbackQ3: '',
                feedbackQ4: '',
                feedbackQ5: '',
                feedbackQ6: '',
                feedbackQ7: 0,
                plannedBonus: ''
              };
              
              // KORRIGIERT: Bessere Pr√ºfung und vollst√§ndiges Laden aller Felder
              if (initialContext?.existingData) {
                const ex = initialContext.existingData;
                const fd = ex.formData || {};
                
                devLog('   ‚úì Initializing formData from existingData');
                devLog('     formData fields:', Object.keys(fd));
                
                const result = {
                  employee: ex.employeeName || fd.employee || initialContext.employee?.name || base.employee,
                  position: ex.position || fd.position || initialContext.employee?.position || base.position,
                  manager: fd.manager || ex.managerName || base.manager,
                  date: fd.date || (ex.updatedAt ? ex.updatedAt.split('T')[0] : base.date),
                  // KRITISCH: Alle Textfelder explizit laden mit !== undefined Pr√ºfung
                  strengths1: fd.strengths1 !== undefined ? fd.strengths1 : base.strengths1,
                  strengths2: fd.strengths2 !== undefined ? fd.strengths2 : base.strengths2,
                  careerComment: fd.careerComment !== undefined ? fd.careerComment : base.careerComment,
                  feedbackQ1: fd.feedbackQ1 !== undefined ? fd.feedbackQ1 : base.feedbackQ1,
                  feedbackQ2: fd.feedbackQ2 !== undefined ? fd.feedbackQ2 : base.feedbackQ2,
                  feedbackQ3: fd.feedbackQ3 !== undefined ? fd.feedbackQ3 : base.feedbackQ3,
                  feedbackQ4: fd.feedbackQ4 !== undefined ? fd.feedbackQ4 : base.feedbackQ4,
                  feedbackQ5: fd.feedbackQ5 !== undefined ? fd.feedbackQ5 : base.feedbackQ5,
                  feedbackQ6: fd.feedbackQ6 !== undefined ? fd.feedbackQ6 : base.feedbackQ6,
                  feedbackQ7: fd.feedbackQ7 !== undefined ? fd.feedbackQ7 : base.feedbackQ7,
                  plannedBonus: fd.plannedBonus !== undefined ? fd.plannedBonus : base.plannedBonus
                };
                
                devLog('     Loaded values:', {
                  strengths1: result.strengths1 ? result.strengths1.substring(0, 30) + '...' : '(empty)',
                  strengths2: result.strengths2 ? result.strengths2.substring(0, 30) + '...' : '(empty)',
                  plannedBonus: result.plannedBonus || '(empty)'
                });
                
                return result;
              }
              
              // Fallback f√ºr neue Appraisals (nur Employee-Daten)
              if (initialContext?.employee) {
                devLog('   ‚ÑπÔ∏è New appraisal - loading employee data only');
                return {
                  ...base,
                  employee: initialContext.employee.name || '',
                  position: initialContext.employee.position || '',
                  manager: initialContext.managerName || '' // v92: Manager-Name aus Context setzen
                };
              }
              
              devLog('   ‚ö†Ô∏è No context found - using defaults');
              return base;
            };
            
            const [isManager, setIsManager] = useState(initialContext?.existingData?.includeLeadership || false);
            const [isGenerating, setIsGenerating] = useState(false);
            const [isSaving, setIsSaving] = useState(false); // v92: Doppelklick-Schutz
            const [formType, setFormType] = useState('manager'); // 'self' or 'manager'
            
            // v92: Unsaved Changes Protection (beforeunload)
            const hasUnsavedChanges = React.useRef(false);
            React.useEffect(() => {
              const handler = (e) => {
                if (hasUnsavedChanges.current) {
                  e.preventDefault();
                  e.returnValue = '';
                }
              };
              window.addEventListener('beforeunload', handler);
              return () => window.removeEventListener('beforeunload', handler);
            }, []);
            
            // === LINKED SELF ASSESSMENT (Selbstreflexion des Mitarbeiters) ===
            const [linkedSelfAssessment, setLinkedSelfAssessment] = useState(null);
            const [showSelfAssessmentHint, setShowSelfAssessmentHint] = useState(true);
            const [isRefreshingSelf, setIsRefreshingSelf] = useState(false);
            
            // Funktion zum Laden/Refresh der Selbstreflexion
            const refreshLinkedSelfAssessment = async (employeeId, employeeEmail) => {
              if (!db || (!employeeId && !employeeEmail)) return;
              setIsRefreshingSelf(true);
              try {
                // Suche nach Selbstreflexion (type: 'self' oder 'self_assessment')
                // Strategie: Erst nach employeeId, dann nach employeeEmail suchen
                let allSelf = [];
                let pdfSelf = null;
                
                // 1. Suche nach employeeId (klassische Verkn√ºpfung)
                if (employeeId) {
                  const byIdSnapshot = await db.collection('teamAppraisals')
                    .where('employeeId', '==', employeeId)
                    .get();
                  const allDocs = byIdSnapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                  
                  // Digitale Selbstreflexionen (OHNE isPdfUpload)
                  allSelf = allDocs.filter(a => 
                    (a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection' || a.type === 'self_assessment_standalone') &&
                    !a.isPdfUpload
                  );
                  
                  // PDF-Selbstreflexion (separat)
                  pdfSelf = allDocs.find(a => a.type === 'self_pdf' || a.isPdfUpload === true);
                }
                
                // 2. Falls nichts gefunden und Email vorhanden: Suche nach employeeEmail
                if (allSelf.length === 0 && employeeEmail) {
                  const byEmailSnapshot = await db.collection('teamAppraisals')
                    .where('employeeEmail', '==', employeeEmail)
                    .get();
                  const allDocs = byEmailSnapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                  
                  allSelf = allDocs.filter(a => 
                    (a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection' || a.type === 'self_assessment_standalone') &&
                    !a.isPdfUpload
                  );
                  
                  if (!pdfSelf) {
                    pdfSelf = allDocs.find(a => a.type === 'self_pdf' || a.isPdfUpload === true);
                  }
                }
                
                if (allSelf.length > 0) {
                  // Sortiere nach Datum (neueste zuerst)
                  allSelf.sort((a, b) => {
                    const dateA = a.updatedAt || a.createdAt || '0';
                    const dateB = b.updatedAt || b.createdAt || '0';
                    return dateB.localeCompare(dateA);
                  });
                  const selfAssessment = allSelf[0];
                  // F√ºge PDF-Info hinzu falls vorhanden
                  if (pdfSelf) {
                    selfAssessment._hasPdf = true;
                    selfAssessment._pdfFileName = pdfSelf.pdfFileName;
                    selfAssessment._pdfUrl = pdfSelf.pdfUrl || pdfSelf.pdfData; // Support both URL and Base64
                  }
                  devLog('üîÑ Selbstreflexion refreshed:', selfAssessment, pdfSelf ? '(+ PDF)' : '');
                  setLinkedSelfAssessment(selfAssessment);
                } else if (pdfSelf) {
                  // Nur PDF vorhanden - zeige Hinweis
                  devLog('üìÑ Nur PDF-Selbstreflexion gefunden:', pdfSelf.pdfFileName);
                  setLinkedSelfAssessment({
                    _isPdfOnly: true,
                    pdfFileName: pdfSelf.pdfFileName,
                    pdfUrl: pdfSelf.pdfUrl || pdfSelf.pdfData, // Support both URL and Base64
                    employeeName: pdfSelf.employeeName,
                    createdAt: pdfSelf.createdAt
                  });
                } else {
                  devLog('‚ÑπÔ∏è Keine Selbstreflexion gefunden f√ºr', employeeId, employeeEmail);
                  setLinkedSelfAssessment(null);
                }
              } catch (err) {
                console.error('‚ùå Fehler beim Laden der Selbstreflexion:', err);
              }
              setIsRefreshingSelf(false);
            };
            
            // === TEAM CONTEXT ===
            const [teamContext, setTeamContext] = useState(initialContext);
            const [teamButtonsVisible, setTeamButtonsVisible] = useState(!!initialContext);
            
            const [formData, setFormData] = useState(getInitialFormData);
            
            const [careerChecks, setCareerChecks] = useState(
              initialContext?.existingData?.careerChecks || [false, false, false, false, false]
            );
            const [goals, setGoals] = useState(getInitialGoals);
            const [devPlan, setDevPlan] = useState(getInitialDevPlan);
            const [coreList, setCoreList] = useState(getInitialCoreList);
            const [leadList, setLeadList] = useState(getInitialLeadList);
            
            devLog('   States initialized:', {
              hasExistingData: !!initialContext?.existingData,
              formDataEmployee: formData.employee,
              goalsCount: goals.length,
              coreListCount: coreList.length,
              devPlanCount: devPlan.length
            });
            
            // Hilfsfunktion: Tausenderpunkte aus Eingabe entfernen (1.000 ‚Üí 1000)
            const parseGermanNumber = (str) => {
                if (!str) return '';
                return str.replace(/\./g, '').replace(',', '.');
            };
            
            // Hilfsfunktion: Zahl mit Tausenderpunkten formatieren (1000 ‚Üí 1.000)
            const formatGermanNumber = (num) => {
                if (!num && num !== 0) return '';
                const numStr = String(num).replace(/[^\d]/g, '');
                if (!numStr) return '';
                return Number(numStr).toLocaleString('de-DE');
            };
            
            // Handler f√ºr Bonus-Feld mit Tausenderpunkt-Unterst√ºtzung
            const handleBonusChange = (val) => {
                const cleanVal = val.replace(/[^\d.]/g, '');
                const numericVal = parseGermanNumber(cleanVal);
                setFormData({...formData, plannedBonus: numericVal});
            };
            
            // Formatierter Bonus f√ºr die Anzeige
            const displayBonus = formData.plannedBonus ? formatGermanNumber(formData.plannedBonus) : '';

            // === TEAM CONTEXT EFFECT (nur f√ºr Selbstreflexions-Suche) ===
            useEffect(() => {
              devLog('üîç AppraisalForm useEffect - initialContext:', !!initialContext);
              
              // Da initialContext bereits beim State-Setup verwendet wird,
              // brauchen wir hier nur noch die Selbstreflexions-Suche
              if (initialContext?.employee?.id || initialContext?.employee?.email) {
                devLog('   üîé Suche nach verkn√ºpfter Selbstreflexion...');
                refreshLinkedSelfAssessment(initialContext.employee.id, initialContext.employee.email);
              }
              
              // Logge die geladenen Daten
              if (initialContext?.existingData) {
                devLog('üìÇ HR EDIT MODE - Daten wurden beim Initialisieren geladen:');
                devLog('   - Employee:', formData.employee);
                devLog('   - Goals:', goals.length, 'Ziele');
                devLog('   - Core scores:', coreList.map(c => `${c.id}:${c.rating}`).join(', '));
                devLog('   - isManager:', isManager);
              }
            }, []);
            
            // === REAL-TIME LISTENER f√ºr Selbstreflexions-Updates ===
            useEffect(() => {
              if (!db) return;
              
              const employeeId = initialContext?.employee?.id;
              const employeeEmail = initialContext?.employee?.email;
              
              // Mindestens eine Identifikation ben√∂tigt
              if (!employeeId && !employeeEmail) return;
              
              devLog('üëÇ Setting up real-time listener for self-assessment updates');
              devLog('   employeeId:', employeeId);
              devLog('   employeeEmail:', employeeEmail);
              
              // Funktion zum Verarbeiten von Snapshot-Ergebnissen
              const processSelfAssessments = (docs) => {
                if (!docs || docs.length === 0) {
                  devLog('‚ÑπÔ∏è Keine Selbstreflexion im Snapshot');
                  return;
                }
                
                // Filtere nach Selbstreflexionen (nicht PDF)
                const selfDocs = docs
                  .map(doc => ({ id: doc.id, ...doc.data() }))
                  .filter(a => 
                    (a.type === 'self' || a.type === 'self_assessment' || 
                     a.type === 'self-reflection' || a.type === 'self_assessment_standalone') &&
                    !a.isPdfUpload
                  );
                
                if (selfDocs.length > 0) {
                  // Sortiere nach Datum (neueste zuerst)
                  selfDocs.sort((a, b) => {
                    const dateA = a.updatedAt || a.createdAt || '0';
                    const dateB = b.updatedAt || b.createdAt || '0';
                    return dateB.localeCompare(dateA);
                  });
                  
                  const latestSelf = selfDocs[0];
                  devLog('üîÑ Real-time update: Neueste Selbstreflexion:', {
                    id: latestSelf.id,
                    updatedAt: latestSelf.updatedAt || latestSelf.createdAt,
                    employeeName: latestSelf.employeeName
                  });
                  
                  // Pr√ºfe ob PDF vorhanden
                  const pdfDoc = docs
                    .map(doc => ({ id: doc.id, ...doc.data() }))
                    .find(a => a.type === 'self_pdf' || a.isPdfUpload === true);
                  
                  if (pdfDoc) {
                    latestSelf._hasPdf = true;
                    latestSelf._pdfFileName = pdfDoc.pdfFileName;
                    latestSelf._pdfUrl = pdfDoc.pdfUrl || pdfDoc.pdfData;
                  }
                  
                  setLinkedSelfAssessment(latestSelf);
                }
              };
              
              // Erstelle Listener(s)
              const unsubscribers = [];
              
              // Listener 1: Nach employeeId (Prim√§r)
              if (employeeId) {
                const unsubById = db.collection('teamAppraisals')
                  .where('employeeId', '==', employeeId)
                  .onSnapshot(
                    (snapshot) => {
                      devLog('üì° Snapshot by employeeId:', snapshot.docs.length, 'docs');
                      processSelfAssessments(snapshot.docs);
                    },
                    (err) => console.error('‚ùå Listener error (by ID):', err)
                  );
                unsubscribers.push(unsubById);
              }
              
              // Listener 2: Nach employeeEmail (Fallback - nur wenn keine ID)
              if (employeeEmail && !employeeId) {
                const unsubByEmail = db.collection('teamAppraisals')
                  .where('employeeEmail', '==', employeeEmail)
                  .onSnapshot(
                    (snapshot) => {
                      devLog('üì° Snapshot by employeeEmail:', snapshot.docs.length, 'docs');
                      processSelfAssessments(snapshot.docs);
                    },
                    (err) => console.error('‚ùå Listener error (by Email):', err)
                  );
                unsubscribers.push(unsubByEmail);
              }
              
              // Cleanup
              return () => {
                devLog('üîá Cleaning up', unsubscribers.length, 'real-time listener(s)');
                unsubscribers.forEach(unsub => unsub());
              };
            }, [db, initialContext?.employee?.id, initialContext?.employee?.email]);
            
            // === TEAM SAVE HANDLER ===
            const handleSaveTeamAppraisal = async (status) => {
              if (!teamContext || !onSaveTeam) {
                showToast(getText(lang, 'Team-Kontext fehlt!', 'Contesto team mancante!', 'Team context missing!'), 'error');
                return;
              }
              
              setIsSaving(true); // v92: Doppelklick-Schutz
              hasUnsavedChanges.current = false; // v92: beforeunload deaktivieren
              
              // === BERECHNE SCORES DIREKT BEIM SPEICHERN (f√ºr Konsistenz) ===
              // WAS Score berechnen
              const calculateWASForSave = () => {
                let sum = 0, weight = 0;
                goals.forEach(g => {
                  const w = parseFloat(g.weight) || 0;
                  if(w > 0) { sum += getBarsScore(g.achievement) * (w/100); weight += w; }
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
              };
              
              // WIE Score berechnen
              const calculateWIEForSave = (list) => {
                let sum = 0, weight = 0;
                list.forEach(i => {
                  const w = parseFloat(i.weight) || 0;
                  sum += i.rating * (w/100);
                  weight += w;
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
              };
              
              const currentWasScore = calculateWASForSave();
              const currentWieCoreScore = calculateWIEForSave(coreList);
              const currentWieLeadScore = calculateWIEForSave(leadList);
              const currentTotalGoalWeight = goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
              
              // GPS berechnen
              let currentFinalGPS;
              if (goals.length === 0 || currentTotalGoalWeight === 0) {
                currentFinalGPS = isManager 
                  ? (currentWieCoreScore * 0.5) + (currentWieLeadScore * 0.5)
                  : currentWieCoreScore;
              } else {
                currentFinalGPS = isManager 
                  ? (currentWasScore * 0.5) + (currentWieCoreScore * 0.25) + (currentWieLeadScore * 0.25)
                  : (currentWasScore * 0.5) + (currentWieCoreScore * 0.5);
              }
              
              // Collect core scores
              const coreScoresObj = {};
              const coreCommentsObj = {};
              coreList.forEach(c => {
                coreScoresObj[c.id] = c.rating;
                coreCommentsObj[c.id] = c.comment || '';
              });
              
              // Collect leader scores
              const leaderScoresObj = {};
              const leaderCommentsObj = {};
              leadList.forEach(c => {
                leaderScoresObj[c.id] = c.rating;
                leaderCommentsObj[c.id] = c.comment || '';
              });
              
              // === VERSION HISTORY: Speichere aktuelle Version beim Abschlie√üen ===
              let versionHistory = teamContext.existingData?.versionHistory || [];
              
              // Speichere Version wenn existierende Daten vorhanden sind (nicht nur bei completed)
              if (teamContext.existingData && (teamContext.existingData.gpsScore > 0 || (teamContext.existingData.goals && teamContext.existingData.goals.length > 0) || teamContext.existingData.coreScores)) {
                // Erstelle Snapshot der VORHERIGEN Version (bevor wir speichern)
                const previousVersion = {
                  savedAt: new Date().toISOString(),
                  savedStatus: teamContext.existingData.status || 'unknown',
                  gpsScore: teamContext.existingData.gpsScore || 0,
                  wasScore: teamContext.existingData.wasScore || 0,
                  wieCoreScore: teamContext.existingData.wieCoreScore || 0,
                  wieLeaderScore: teamContext.existingData.wieLeaderScore || 0,
                  goals: JSON.parse(JSON.stringify(teamContext.existingData.goals || [])),
                  coreScores: { ...teamContext.existingData.coreScores },
                  coreComments: { ...teamContext.existingData.coreComments },
                  leaderScores: { ...teamContext.existingData.leaderScores },
                  leaderComments: { ...teamContext.existingData.leaderComments },
                  formData: { ...teamContext.existingData.formData },
                  careerChecks: teamContext.existingData.careerChecks,
                  devPlan: teamContext.existingData.devPlan
                };
                
                // Nur hinzuf√ºgen wenn sich was ge√§ndert hat (GPS unterschiedlich oder erste Version)
                const lastVersion = versionHistory[0];
                const hasChanged = !lastVersion || 
                  Math.abs((lastVersion.gpsScore || 0) - (previousVersion.gpsScore || 0)) > 0.01 ||
                  JSON.stringify(lastVersion.goals) !== JSON.stringify(previousVersion.goals) ||
                  JSON.stringify(lastVersion.coreScores) !== JSON.stringify(previousVersion.coreScores);
                
                if (hasChanged) {
                  versionHistory = [previousVersion, ...versionHistory].slice(0, 15); // Max 15 Versionen
                  devLog('üìö Version History: Neue Version gespeichert, Total:', versionHistory.length);
                }
              }
              
              const appraisal = {
                id: teamContext.appraisalId || teamContext.existingData?.id,
                type: 'review',
                employeeId: teamContext.employee?.id || teamContext.existingData?.employeeId || '',
                employeeName: teamContext.employee?.name || teamContext.existingData?.employeeName || formData.employee || '',
                position: teamContext.employee?.position || teamContext.existingData?.position || formData.position || '',
                period: teamContext.period || new Date().getFullYear(),
                status: status,
                createdAt: teamContext.existingData?.createdAt || new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                goals: goals,
                coreScores: coreScoresObj,
                coreComments: coreCommentsObj,
                leaderScores: leaderScoresObj,
                leaderComments: leaderCommentsObj,
                includeLeadership: isManager,
                wasScore: currentWasScore,
                wieCoreScore: currentWieCoreScore,
                wieLeaderScore: currentWieLeadScore,
                gpsScore: currentFinalGPS,
                formData: formData,
                careerChecks: careerChecks,
                devPlan: devPlan,
                versionHistory: versionHistory, // NEU: Versionshistorie
                // WICHTIG: Manager-Referenz beibehalten (f√ºr Sichtbarkeit!)
                managerId: teamContext.existingData?.managerId || teamContext.managerId || null,
                managerName: teamContext.existingData?.managerName || teamContext.managerName || formData.manager || ''
              };
              
              // Debug-Log
              devLog('üíæ Speichere Review:', {
                status,
                goals: goals.length,
                wasScore: currentWasScore.toFixed(2),
                wieCoreScore: currentWieCoreScore.toFixed(2),
                wieLeadScore: currentWieLeadScore.toFixed(2),
                gpsScore: currentFinalGPS.toFixed(2),
                versionHistoryCount: versionHistory.length
              });
              
              try {
                await onSaveTeam(appraisal);
              } catch (err) {
                hasUnsavedChanges.current = true; // v92: Dirty-Flag zur√ºcksetzen bei Fehler
                setIsSaving(false);
              }
            };
            
            // === TEAM CANCEL HANDLER ===
            const handleCancelTeam = () => {
              if (confirm(lang === 'de' ? 'Abbrechen? √Ñnderungen gehen verloren.' : lang === 'it' ? 'Annullare? Le modifiche andranno perse.' : 'Cancel? Changes will be lost.')) {
                hasUnsavedChanges.current = false; // v92
                localStorage.removeItem('nw_current_employee');
                if (onCancel) onCancel();
              }
            };
            
            // === VERSION HISTORY STATE & FUNKTIONEN ===
            const [showVersionHistory, setShowVersionHistory] = useState(false);
            const [previewVersion, setPreviewVersion] = useState(null); // F√ºr Vorschau-Modal
            const versionHistory = teamContext?.existingData?.versionHistory || [];
            
            // Funktion: Version wiederherstellen (wird aus Modal aufgerufen)
            const restoreVersion = (version) => {
              // Goals wiederherstellen
              if (version.goals && Array.isArray(version.goals)) {
                setGoals(version.goals);
              }
              
              // Core Scores wiederherstellen
              if (version.coreScores) {
                setCoreList(prev => prev.map(c => ({
                  ...c,
                  rating: version.coreScores[c.id] !== undefined ? version.coreScores[c.id] : c.rating,
                  comment: version.coreComments?.[c.id] || ''
                })));
              }
              
              // Leader Scores wiederherstellen
              if (version.leaderScores) {
                setLeadList(prev => prev.map(c => ({
                  ...c,
                  rating: version.leaderScores[c.id] !== undefined ? version.leaderScores[c.id] : c.rating,
                  comment: version.leaderComments?.[c.id] || ''
                })));
              }
              
              // FormData wiederherstellen
              if (version.formData) {
                setFormData(prev => ({ ...prev, ...version.formData }));
              }
              
              // Career & Dev wiederherstellen
              if (version.careerChecks) setCareerChecks(version.careerChecks);
              if (version.devPlan) setDevPlan(version.devPlan);
              
              setPreviewVersion(null);
              setShowVersionHistory(false);
              showToast(lang === 'de' ? 'Version wiederhergestellt! Bitte speichern Sie die √Ñnderungen.' : 'Version restored! Please save your changes.', 'warning');
            };
            
            // === VERSION PREVIEW MODAL COMPONENT ===
            const VersionPreviewModal = ({ version, onClose, onRestore }) => {
              if (!version) return null;
              
              const versionDate = new Date(version.savedAt);
              const versionGoals = version.goals || [];
              const versionCoreScores = version.coreScores || {};
              const versionCoreComments = version.coreComments || {};
              const versionLeaderScores = version.leaderScores || {};
              const versionLeaderComments = version.leaderComments || {};
              
              // Aktuellen Stand f√ºr Vergleich
              const currentGoals = goals || [];
              const currentCoreScores = {};
              const currentCoreComments = {};
              coreList.forEach(c => {
                currentCoreScores[c.id] = c.rating;
                currentCoreComments[c.id] = c.comment || '';
              });
              const currentLeaderScores = {};
              const currentLeaderComments = {};
              leadList.forEach(c => {
                currentLeaderScores[c.id] = c.rating;
                currentLeaderComments[c.id] = c.comment || '';
              });
              
              // Hilfsfunktion f√ºr √Ñnderungs-Badge
              const ChangeBadge = ({ current, saved }) => {
                if (current === saved || (!current && !saved)) return null;
                return e('span', { className: 'ml-2 px-1.5 py-0.5 bg-orange-100 text-orange-700 text-xs rounded font-medium' }, 
                  '‚ö° ' + (lang === 'de' ? 'ge√§ndert' : 'changed')
                );
              };
              
              return e('div', { 
                className: 'fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4',
                onClick: (ev) => ev.target === ev.currentTarget && onClose()
              },
                e('div', { 
                  className: 'bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col'
                },
                  // Header
                  e('div', { className: 'bg-gradient-to-r from-amber-500 to-amber-600 text-white p-6' },
                    e('div', { className: 'flex justify-between items-start' },
                      e('div', null,
                        e('h2', { className: 'text-2xl font-bold flex items-center gap-3' },
                          e(Clock, { size: 28 }),
                          lang === 'de' ? 'Versions-Vorschau' : 'Version Preview'
                        ),
                        e('p', { className: 'text-amber-100 mt-2 text-lg' },
                          versionDate.toLocaleDateString('de-DE', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' }) +
                          ' um ' + versionDate.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }) + ' Uhr'
                        )
                      ),
                      e('button', {
                        onClick: onClose,
                        className: 'text-white/80 hover:text-white text-3xl leading-none'
                      }, '√ó')
                    ),
                    // Score Zusammenfassung
                    e('div', { className: 'flex gap-4 mt-4' },
                      e('div', { className: 'bg-white/20 rounded-lg px-4 py-2' },
                        e('div', { className: 'text-2xl font-bold' }, (version.gpsScore || 0).toFixed(2)),
                        e('div', { className: 'text-xs text-amber-100' }, 'GPS Score')
                      ),
                      e('div', { className: 'bg-white/20 rounded-lg px-4 py-2' },
                        e('div', { className: 'text-2xl font-bold' }, (version.wasScore || 0).toFixed(2)),
                        e('div', { className: 'text-xs text-amber-100' }, 'WAS')
                      ),
                      e('div', { className: 'bg-white/20 rounded-lg px-4 py-2' },
                        e('div', { className: 'text-2xl font-bold' }, (version.wieCoreScore || 0).toFixed(2)),
                        e('div', { className: 'text-xs text-amber-100' }, 'WIE')
                      ),
                      versionGoals.length > 0 && e('div', { className: 'bg-white/20 rounded-lg px-4 py-2' },
                        e('div', { className: 'text-2xl font-bold' }, versionGoals.length),
                        e('div', { className: 'text-xs text-amber-100' }, lang === 'de' ? 'Ziele' : 'Goals')
                      )
                    )
                  ),
                  
                  // Content (scrollbar)
                  e('div', { className: 'flex-1 overflow-y-auto p-6 space-y-6' },
                    
                    // Ziele
                    versionGoals.length > 0 && e('div', { className: 'bg-blue-50 rounded-xl p-4 border border-blue-200' },
                      e('h3', { className: 'font-bold text-blue-800 mb-3 flex items-center gap-2' },
                        e(Target, { size: 18 }),
                        lang === 'de' ? 'Ziele in dieser Version' : 'Goals in this version',
                        ' (',  versionGoals.length, ')'
                      ),
                      e('div', { className: 'space-y-2' },
                        versionGoals.map((goal, idx) => 
                          e('div', { key: idx, className: 'bg-white rounded-lg p-3 border border-blue-100' },
                            e('div', { className: 'flex justify-between items-start' },
                              e('div', { className: 'flex-1' },
                                e('p', { className: 'font-medium text-slate-800' }, goal.name || '(Kein Name)'),
                                goal.description && e('p', { className: 'text-sm text-slate-600 mt-1' }, goal.description)
                              ),
                              e('div', { className: 'text-right ml-4' },
                                e('span', { className: 'px-2 py-1 bg-blue-100 text-blue-700 rounded text-sm font-semibold' },
                                  (goal.weight || 0) + '%'
                                ),
                                goal.achievement && e('span', { className: 'ml-2 px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-sm' },
                                  goal.achievement + '%'
                                )
                              )
                            )
                          )
                        )
                      )
                    ),
                    
                    // Keine Ziele
                    versionGoals.length === 0 && e('div', { className: 'bg-slate-50 rounded-xl p-4 border border-slate-200 text-center text-slate-500' },
                      lang === 'de' ? 'Keine Ziele in dieser Version gespeichert' : 'No goals saved in this version'
                    ),
                    
                    // Kernkompetenzen
                    Object.keys(versionCoreScores).length > 0 && e('div', { className: 'bg-emerald-50 rounded-xl p-4 border border-emerald-200' },
                      e('h3', { className: 'font-bold text-emerald-800 mb-3 flex items-center gap-2' },
                        e(Star, { size: 18 }),
                        lang === 'de' ? 'Kernkompetenzen (WIE)' : 'Core Competencies'
                      ),
                      e('div', { className: 'grid md:grid-cols-2 gap-2' },
                        Object.entries(versionCoreScores).map(([id, rating]) => {
                          const comp = CORE_COMPETENCIES_CALC.find(c => c.id === id) || { name: id };
                          const comment = versionCoreComments[id] || '';
                          const currentRating = currentCoreScores[id];
                          const hasChanged = currentRating !== undefined && currentRating !== rating;
                          
                          return e('div', { 
                            key: id, 
                            className: 'bg-white rounded-lg p-3 border ' + (hasChanged ? 'border-orange-300' : 'border-emerald-100')
                          },
                            e('div', { className: 'flex justify-between items-center' },
                              e('span', { className: 'text-sm text-slate-700' }, comp.name),
                              e('div', { className: 'flex items-center gap-2' },
                                e('span', { 
                                  className: 'px-2 py-1 rounded text-sm font-bold ' + 
                                    (rating >= 4 ? 'bg-emerald-100 text-emerald-700' : 
                                     rating >= 3 ? 'bg-blue-100 text-blue-700' : 
                                     rating >= 2 ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700')
                                }, 'Level ' + rating),
                                hasChanged && e('span', { className: 'text-xs text-orange-600' }, 
                                  '(aktuell: ' + currentRating + ')'
                                )
                              )
                            ),
                            comment && e('p', { className: 'text-xs text-slate-500 mt-1 italic' }, 'üí¨ ' + comment)
                          );
                        })
                      )
                    ),
                    
                    // F√ºhrungskompetenzen
                    Object.keys(versionLeaderScores).length > 0 && e('div', { className: 'bg-purple-50 rounded-xl p-4 border border-purple-200' },
                      e('h3', { className: 'font-bold text-purple-800 mb-3 flex items-center gap-2' },
                        e(Award, { size: 18 }),
                        lang === 'de' ? 'F√ºhrungskompetenzen' : 'Leadership Competencies'
                      ),
                      e('div', { className: 'grid md:grid-cols-2 gap-2' },
                        Object.entries(versionLeaderScores).map(([id, rating]) => {
                          const comp = LEADERSHIP_COMPETENCIES_CALC.find(c => c.id === id) || { name: id };
                          const comment = versionLeaderComments[id] || '';
                          const currentRating = currentLeaderScores[id];
                          const hasChanged = currentRating !== undefined && currentRating !== rating;
                          
                          return e('div', { 
                            key: id, 
                            className: 'bg-white rounded-lg p-3 border ' + (hasChanged ? 'border-orange-300' : 'border-purple-100')
                          },
                            e('div', { className: 'flex justify-between items-center' },
                              e('span', { className: 'text-sm text-slate-700' }, comp.name),
                              e('div', { className: 'flex items-center gap-2' },
                                e('span', { 
                                  className: 'px-2 py-1 rounded text-sm font-bold ' + 
                                    (rating >= 4 ? 'bg-emerald-100 text-emerald-700' : 
                                     rating >= 3 ? 'bg-blue-100 text-blue-700' : 
                                     rating >= 2 ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700')
                                }, 'Level ' + rating),
                                hasChanged && e('span', { className: 'text-xs text-orange-600' }, 
                                  '(aktuell: ' + currentRating + ')'
                                )
                              )
                            ),
                            comment && e('p', { className: 'text-xs text-slate-500 mt-1 italic' }, 'üí¨ ' + comment)
                          );
                        })
                      )
                    ),
                    
                    // Hinweis-Box
                    e('div', { className: 'bg-amber-50 border border-amber-300 rounded-xl p-4' },
                      e('div', { className: 'flex items-start gap-3' },
                        e(AlertTriangle, { size: 20, className: 'text-amber-600 flex-shrink-0 mt-0.5' }),
                        e('div', null,
                          e('p', { className: 'font-semibold text-amber-800' },
                            lang === 'de' ? 'Was passiert beim Wiederherstellen?' : 'What happens when restoring?'
                          ),
                          e('ul', { className: 'text-sm text-amber-700 mt-2 space-y-1' },
                            e('li', null, '‚Ä¢ ' + (lang === 'de' ? 'Alle aktuellen Eingaben werden mit dieser Version √ºberschrieben' : 'All current entries will be overwritten with this version')),
                            e('li', null, '‚Ä¢ ' + (lang === 'de' ? 'Die √Ñnderungen sind erst nach dem Speichern dauerhaft' : 'Changes are permanent only after saving')),
                            e('li', null, '‚Ä¢ ' + (lang === 'de' ? 'Sie k√∂nnen vor dem Speichern noch Anpassungen vornehmen' : 'You can make adjustments before saving'))
                          )
                        )
                      )
                    )
                  ),
                  
                  // Footer mit Buttons
                  e('div', { className: 'border-t bg-slate-50 p-4 flex justify-between items-center' },
                    e('button', {
                      onClick: onClose,
                      className: 'px-6 py-3 bg-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-300 transition-all'
                    }, lang === 'de' ? '‚Üê Zur√ºck zur Auswahl' : '‚Üê Back to selection'),
                    e('button', {
                      onClick: () => onRestore(version),
                      className: 'px-6 py-3 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-xl font-bold hover:from-amber-600 hover:to-amber-700 transition-all flex items-center gap-2 shadow-lg'
                    },
                      e(RotateCcw, { size: 18 }),
                      lang === 'de' ? 'Diese Version jetzt wiederherstellen' : 'Restore this version now'
                    )
                  )
                )
              );
            };

            useEffect(() => {
                setCoreList(prev => prev.map((p, i) => {
                    if (defs.core[i]) {
                        return {
                            ...p,
                            name: lang === 'it' && CORE_COMPETENCIES_CALC[i].nameIt ? 
                                CORE_COMPETENCIES_CALC[i].nameIt : 
                                CORE_COMPETENCIES_CALC[i].name
                        };
                    }
                    return p;
                }));
                setLeadList(prev => prev.map((p, i) => {
                    if (defs.lead[i]) {
                        return {
                            ...p,
                            name: lang === 'it' && LEADERSHIP_COMPETENCIES_CALC[i].nameIt ? 
                                LEADERSHIP_COMPETENCIES_CALC[i].nameIt : 
                                LEADERSHIP_COMPETENCIES_CALC[i].name
                        };
                    }
                    return p;
                }));
            }, [lang]);

            const calculateWAS = () => {
                let sum = 0, weight = 0;
                goals.forEach(g => {
                    const w = parseFloat(g.weight) || 0;
                    if(w > 0) { sum += getBarsScore(g.achievement) * (w/100); weight += w; }
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
            };

            const calculateWIE = (list) => {
                let sum = 0, weight = 0;
                list.forEach(i => {
                    const w = parseFloat(i.weight) || 0;
                    sum += i.rating * (w/100);
                    weight += w;
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
            };

            const wasScore = calculateWAS();
            const wieCoreScore = calculateWIE(coreList);
            const wieLeadScore = calculateWIE(leadList);
            
            // === HALO-EFFEKT ERKENNUNG ===
            // Warnung wenn alle Core-Kompetenzen exakt gleich bewertet wurden
            const coreRatings = coreList.map(c => c.rating).filter(r => r > 0);
            const allCoreRatingsSame = coreRatings.length >= 5 && coreRatings.every(r => r === coreRatings[0]);
            const haloEffectWarning = allCoreRatingsSame && coreRatings.length >= 5;
            
            // === GAP-ANALYSE (Selbst vs. Fremd) ===
            // Berechne Gaps f√ºr alle Kompetenzen
            const calculateGaps = () => {
              if (!linkedSelfAssessment) return {};
              const selfScores = linkedSelfAssessment.selfCoreScores || {};
              const gaps = {};
              
              // Core Kompetenzen
              const idMapping = { fach: 'c1', komm: 'c2', prob: 'c3', adapt: 'c4', orga: 'c5' };
              coreList.forEach(c => {
                const selfKey = idMapping[c.id] || c.id;
                const selfScore = selfScores[selfKey] || selfScores[c.id];
                if (selfScore && c.rating) {
                  const gap = c.rating - selfScore;
                  if (Math.abs(gap) > 1) {
                    gaps[c.id] = { 
                      gap, 
                      selfScore, 
                      fkScore: c.rating,
                      direction: gap > 0 ? 'fk_higher' : 'self_higher'
                    };
                  }
                }
              });
              
              // Leader Kompetenzen (falls vorhanden)
              if (linkedSelfAssessment.selfLeaderScores) {
                const selfLeaderScores = linkedSelfAssessment.selfLeaderScores;
                const leaderMapping = { lead: 'l1', strat: 'l2', decide: 'l3', exec: 'l4', stake: 'l5' };
                leadList.forEach(c => {
                  const selfKey = leaderMapping[c.id] || c.id;
                  const selfScore = selfLeaderScores[selfKey] || selfLeaderScores[c.id];
                  if (selfScore && c.rating) {
                    const gap = c.rating - selfScore;
                    if (Math.abs(gap) > 1) {
                      gaps[c.id] = { 
                        gap, 
                        selfScore, 
                        fkScore: c.rating,
                        direction: gap > 0 ? 'fk_higher' : 'self_higher'
                      };
                    }
                  }
                });
              }
              
              return gaps;
            };
            const competencyGaps = calculateGaps();
            const hasSignificantGaps = Object.keys(competencyGaps).length > 0;
            
            // Calculate total goal weight for validation
            const totalGoalWeight = goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
            
            // === BONUS-BERECHNUNG ===
            // Bonus basiert auf Gewichtung und Zielerreichung pro Ziel
            // Max. 100% Auszahlung pro Ziel (keine √úberschreitung)
            const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
            
            // Berechne Bonus pro Ziel und Gesamtauszahlung
            const bonusPerGoal = goals.map(g => {
                const weight = parseFloat(g.weight) || 0;
                const achievement = parseFloat(g.achievement) || 0;
                const goalBonus = plannedBonusNum * (weight / 100);
                // Auszahlung gedeckelt auf 100% Zielerreichung
                const achievementFactor = Math.min(achievement / 100, 1.0);
                const payout = goalBonus * achievementFactor;
                return {
                    goalName: g.name,
                    weight: weight,
                    achievement: achievement,
                    goalBonus: goalBonus,
                    achievementFactor: achievementFactor,
                    payout: payout
                };
            });
            
            const totalBonusPayout = bonusPerGoal.reduce((sum, b) => sum + b.payout, 0);
            const bonusPayoutPercentage = plannedBonusNum > 0 ? (totalBonusPayout / plannedBonusNum * 100) : 0;
            
            // GPS-Berechnung: Wenn keine Ziele vorhanden, nur WIE-Kompetenzen (100%)
            // Fix: Pr√ºfe ob Leadership-Scores tats√§chlich > 0 sind bevor sie einflie√üen
            let finalGPS;
            const hasLeadershipScores = isManager && wieLeadScore > 0;
            
            if (goals.length === 0 || totalGoalWeight === 0) {
                // Keine Ziele: GPS = 100% WIE
                if (isManager && hasLeadershipScores) {
                    finalGPS = (wieCoreScore * 0.5) + (wieLeadScore * 0.5);
                } else {
                    // Nur Core-Kompetenzen (auch f√ºr Manager ohne Leadership-Bewertung)
                    finalGPS = wieCoreScore;
                }
            } else {
                // Mit Zielen: Standard-Formel
                if (isManager && hasLeadershipScores) {
                    finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.25) + (wieLeadScore * 0.25);
                } else {
                    // Standard f√ºr MA oder Manager ohne Leadership-Bewertung
                    finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.5);
                }
            }

            const handleFormChange = (field, val) => { hasUnsavedChanges.current = true; setFormData({...formData, [field]: val}); };
            const updateItem = (list, setList, id, field, val) => {
                hasUnsavedChanges.current = true; // v92
                setList(list.map(i => {
                    if (i.id !== id) return i;
                    // Parse numeric fields to ensure calculations work correctly
                    if (field === 'weight' || field === 'achievement') {
                        return { ...i, [field]: parseFloat(val) || 0 };
                    }
                    if (field === 'rating') {
                        return { ...i, [field]: parseInt(val) || 3 };
                    }
                    return { ...i, [field]: val };
                }));
            };
            const addItem = (list, setList, template) => { hasUnsavedChanges.current = true; setList([...list, { ...template, id: Date.now() }]); };
            const removeItem = (list, setList, id) => { hasUnsavedChanges.current = true; setList(list.filter(i => i.id !== id)); };
            const toggleCareer = (index) => {
                hasUnsavedChanges.current = true; // v92
                const newChecks = [...careerChecks];
                newChecks[index] = !newChecks[index];
                setCareerChecks(newChecks);
            };

            const handleDownloadPDF = () => {
                if (!window.html2pdf) {
                    showToast(getText(lang, "PDF-Bibliothek nicht geladen. Bitte Seite neu laden.", "Libreria PDF non caricata. Ricaricare la pagina.", "PDF library not loaded. Please reload the page."), "error");
                    return;
                }
                
                // === HELPER F√úR DYNAMISCHE KOMPETENZ-NAMEN √úBERSETZUNG (PDF) ===
                const getTranslatedCompNamePDF = (compId) => {
                  const coreComp = CORE_COMPETENCIES_CALC.find(c => c.id === compId);
                  const leadComp = LEADERSHIP_COMPETENCIES_CALC.find(c => c.id === compId);
                  const comp = coreComp || leadComp;
                  
                  if (!comp) return compId; // Fallback
                  
                  if (lang === 'it' && comp.nameIt) return comp.nameIt;
                  if (lang === 'en' && comp.nameEn) return comp.nameEn;
                  return comp.name;
                };
                
                // Validierung: Warnung bei sehr langen Texten (arbeitsrechtlich relevant!)
                const feedbackTexts = [
                    formData.strengths1, formData.strengths2,
                    formData.feedbackQ1, formData.feedbackQ2, formData.feedbackQ3,
                    formData.feedbackQ4, formData.feedbackQ5, formData.feedbackQ6, formData.feedbackQ7,
                    formData.careerComment
                ].filter(Boolean);
                const totalFeedbackLength = feedbackTexts.reduce((sum, t) => sum + t.length, 0);
                const coreCommentLength = coreList.reduce((sum, c) => sum + (c.comment || '').length, 0);
                const leadCommentLength = leadList.reduce((sum, c) => sum + (c.comment || '').length, 0);
                const totalTextLength = totalFeedbackLength + coreCommentLength + leadCommentLength;
                
                if (totalTextLength > 8000) {
                    const proceed = confirm(lang === 'de' 
                        ? `‚ö†Ô∏è Arbeitsrechtlicher Hinweis\n\nDas Dokument enth√§lt sehr viel Text (${Math.round(totalTextLength/1000)}k Zeichen).\n\nBei extrem langen Texten k√∂nnen Seitenumbr√ºche problematisch sein ‚Äì Text k√∂nnte abgeschnitten werden.\n\n‚úì Pr√ºfen Sie das PDF nach dem Download auf Vollst√§ndigkeit\n‚úì Formulieren Sie ggf. pr√§gnanter\n\nTrotzdem fortfahren?`
                        : lang === 'it'
                        ? `‚ö†Ô∏è Avviso legale\n\nIl documento contiene molto testo (${Math.round(totalTextLength/1000)}k caratteri).\n\nCon testi molto lunghi, le interruzioni di pagina possono causare problemi ‚Äì il testo potrebbe essere tagliato.\n\n‚úì Verifichi il PDF dopo il download\n‚úì Formuli in modo pi√π conciso se necessario\n\nContinuare comunque?`
                        : `‚ö†Ô∏è Legal Notice\n\nDocument contains a lot of text (${Math.round(totalTextLength/1000)}k characters).\n\nWith very long texts, page breaks may cause issues ‚Äì text could be cut off.\n\n‚úì Check the PDF for completeness after download\n‚úì Consider more concise wording\n\nProceed anyway?`
                    );
                    if (!proceed) return;
                }
                
                setIsGenerating(true);
                
                setTimeout(() => {
                    let pdfContainer = null;
                    try {
                        pdfContainer = document.createElement('div');
                        // Container erstellen - Breite angepasst f√ºr bessere Darstellung
                        pdfContainer.style.cssText = `
                            width: 190mm;
                            box-sizing: border-box;
                            padding: 10mm;
                            background: white;
                            font-family: Arial, sans-serif;
                            color: #1e293b;
                            font-size: 10pt;
                            line-height: 1.4;
                        `;
                        
                        const currentDate = new Date().toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
                        
                        // Formatiere das Bewertungsdatum korrekt (von YYYY-MM-DD zu DD.MM.YYYY)
                        const formatDateForPDF = (dateStr) => {
                            if (!dateStr) return '‚Äì';
                            const parts = dateStr.split('-');
                            if (parts.length === 3) {
                                return `${parts[2]}.${parts[1]}.${parts[0]}`;
                            }
                            return dateStr;
                        };
                        const formattedPeriod = formatDateForPDF(formData.date);
                        
                        // Profil-Text k√ºrzen f√ºr PDF
                        const profileShort = isManager 
                            ? (lang === 'de' ? 'FK (50/25/25)' : lang === 'it' ? 'Dir. (50/25/25)' : 'Mgr (50/25/25)')
                            : (lang === 'de' ? 'MA (50/50)' : lang === 'it' ? 'Coll. (50/50)' : 'Emp (50/50)');
                        
                        // Professional PDF Layout
                        let pdfHTML = `
                            <!-- HEADER -->
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #243186;">
                                <div style="flex: 1;">
                                    <h1 style="color: #243186; font-size: 26pt; margin: 0; font-weight: 700; letter-spacing: -0.5px;">nƒ±ederwƒ±eser</h1>
                                    <p style="color: #6EBD84; font-size: 8pt; margin: 2px 0 0 0; font-weight: 600; letter-spacing: 1.5px;">FLEXIBLE FOOD PACKAGING</p>
                                </div>
                                <div style="text-align: right; flex-shrink: 0; padding-left: 10px;">
                                    <p style="font-size: 8pt; color: #64748b; margin: 0;">Dok.: ${currentDate}</p>
                                    <p style="font-size: 8pt; color: #64748b; margin: 2px 0 0 0;">${lang === 'de' ? 'Periode' : lang === 'it' ? 'Periodo' : 'Period'}: ${formattedPeriod}</p>
                                </div>
                            </div>
                            
                            <!-- DOCUMENT TITLE -->
                            <div style="background: linear-gradient(135deg, #243186 0%, #1a2564 100%); color: white; padding: 15px 20px; margin-bottom: 20px; border-radius: 4px;">
                                <h2 style="margin: 0; font-size: 16pt; font-weight: 600;">${t.headerTitle}</h2>
                                <p style="margin: 5px 0 0 0; font-size: 11pt; opacity: 0.9;">${t.headerSubtitle}</p>
                            </div>
                            
                            <!-- TEIL A: STAMMDATEN -->
                            <div style="margin-bottom: 20px; page-break-inside: avoid;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partA}</h3>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                                    <tr>
                                        <td style="padding: 8px 10px; width: 22%; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.employee}</span>
                                        </td>
                                        <td style="padding: 8px 10px; width: 28%; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.employee || '‚Äì'}</td>
                                        <td style="padding: 8px 10px; width: 22%; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.manager}</span>
                                        </td>
                                        <td style="padding: 8px 10px; width: 28%; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.manager || '‚Äì'}</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px 10px; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.position}</span>
                                        </td>
                                        <td style="padding: 8px 10px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.position || '‚Äì'}</td>
                                        <td style="padding: 8px 10px; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.profile}</span>
                                        </td>
                                        <td style="padding: 8px 10px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${profileShort}</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- TEIL B: ZIELERREICHUNG -->
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #3b82f6; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #1e40af; font-weight: 600;">${t.partB}</h3>
                                    <span style="background: #dbeafe; color: #1e40af; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                                        Score: ${wasScore.toFixed(2)}
                                    </span>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #1e40af; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.goalName}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 65px;">${t.weight}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 75px;">${t.achievement}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 50px;">BARS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${goals.map((g, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${g.name || '‚Äì'}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 600; vertical-align: top;">${g.weight}%</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                                    <span style="background: ${g.achievement >= 100 ? '#dcfce7' : g.achievement >= 70 ? '#fef9c3' : '#fee2e2'}; color: ${g.achievement >= 100 ? '#166534' : g.achievement >= 70 ? '#854d0e' : '#dc2626'}; padding: 2px 8px; border-radius: 10px; font-weight: 600;">
                                                        ${g.achievement}%
                                                    </span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 700; font-size: 11pt; vertical-align: top;">${getBarsScore(g.achievement)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                                
                                ${plannedBonusNum > 0 && goals.length > 0 ? `
                                <!-- BONUS-BERECHNUNG -->
                                <div style="margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 1px solid #6ee7b7; border-radius: 6px;">
                                    <h4 style="font-size: 11pt; font-weight: 700; color: #065f46; margin: 0 0 12px 0; display: flex; align-items: center;">
                                        üí∞ ${lang === 'de' ? 'Bonus-Berechnung' : lang === 'it' ? 'Calcolo Bonus' : 'Bonus Calculation'}
                                    </h4>
                                    <table style="width: 100%; border-collapse: collapse; font-size: 9pt;">
                                        <thead>
                                            <tr style="background: rgba(6, 95, 70, 0.1);">
                                                <th style="padding: 8px; text-align: left; color: #065f46; font-weight: 600;">${lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'}</th>
                                                <th style="padding: 8px; text-align: center; color: #065f46; font-weight: 600; width: 60px;">${lang === 'de' ? 'Gewicht' : lang === 'it' ? 'Peso' : 'Weight'}</th>
                                                <th style="padding: 8px; text-align: right; color: #065f46; font-weight: 600; width: 80px;">${lang === 'de' ? 'Anteil' : lang === 'it' ? 'Quota' : 'Share'}</th>
                                                <th style="padding: 8px; text-align: center; color: #065f46; font-weight: 600; width: 70px;">${lang === 'de' ? 'Erreicht' : lang === 'it' ? 'Raggiunto' : 'Achieved'}</th>
                                                <th style="padding: 8px; text-align: right; color: #065f46; font-weight: 600; width: 90px;">${lang === 'de' ? 'Auszahlung' : lang === 'it' ? 'Pagamento' : 'Payout'}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${bonusPerGoal.map((b, idx) => `
                                                <tr style="border-top: 1px solid #a7f3d0;">
                                                    <td style="padding: 8px; color: #334155;">${b.goalName || (lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal') + ' ' + (idx + 1)}</td>
                                                    <td style="padding: 8px; text-align: center; color: #64748b;">${b.weight}%</td>
                                                    <td style="padding: 8px; text-align: right; color: #64748b;">${formatGermanNumber(b.goalBonus.toFixed(0))} ‚Ç¨</td>
                                                    <td style="padding: 8px; text-align: center;">
                                                        <span style="padding: 2px 6px; border-radius: 10px; font-size: 8pt; font-weight: 600; background: ${b.achievement >= 100 ? '#dcfce7' : b.achievement >= 70 ? '#fef9c3' : '#fee2e2'}; color: ${b.achievement >= 100 ? '#166534' : b.achievement >= 70 ? '#854d0e' : '#dc2626'};">
                                                            ${b.achievement}%
                                                        </span>
                                                    </td>
                                                    <td style="padding: 8px; text-align: right; font-weight: 700; color: #065f46;">${formatGermanNumber(b.payout.toFixed(0))} ‚Ç¨</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 12px; margin-top: 12px; border-top: 2px solid #6ee7b7;">
                                        <div>
                                            <span style="font-size: 9pt; color: #065f46;">${lang === 'de' ? 'Geplanter Bonus:' : lang === 'it' ? 'Bonus previsto:' : 'Planned Bonus:'}</span>
                                            <span style="font-weight: 700; margin-left: 5px;">${formatGermanNumber(plannedBonusNum.toFixed(0))} ‚Ç¨</span>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 8pt; color: #059669;">${lang === 'de' ? 'Tats√§chliche Auszahlung' : lang === 'it' ? 'Pagamento effettivo' : 'Actual Payout'}</div>
                                            <div style="font-size: 18pt; font-weight: 900; color: #065f46;">${formatGermanNumber(totalBonusPayout.toFixed(0))} ‚Ç¨</div>
                                            <div style="font-size: 8pt; font-weight: 600; color: ${bonusPayoutPercentage >= 100 ? '#16a34a' : bonusPayoutPercentage >= 70 ? '#ca8a04' : '#dc2626'};">
                                                (${bonusPayoutPercentage.toFixed(1)}% ${lang === 'de' ? 'vom Zielbonus' : lang === 'it' ? 'del target' : 'of target bonus'})
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                            
                            <!-- TEIL C: WIE-KOMPETENZEN (CORE) -->
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #6EBD84; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #166534; font-weight: 600;">${t.partC}</h3>
                                    <span style="background: #dcfce7; color: #166534; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                                        Score: ${wieCoreScore.toFixed(2)}
                                    </span>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #166534; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 30%;">${t.compName}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 60px;">${t.rating}</th>
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.comment}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${coreList.map((c, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f0fdf4'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-weight: 500; vertical-align: top;">${getTranslatedCompNamePDF(c.id)}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                                    <span style="display: inline-block; width: 24px; height: 24px; line-height: 24px; background: #166534; color: white; border-radius: 50%; font-weight: 700; font-size: 10pt;">${c.rating}</span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-size: 9pt; color: #475569; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${c.comment || '‚Äì'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            
                            ${isManager ? `
                            <!-- TEIL C: WIE-KOMPETENZEN (LEADERSHIP) -->
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #059669; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #059669; font-weight: 600;">${t.partCLead}</h3>
                                    <span style="background: #d1fae5; color: #059669; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                                        Score: ${wieLeadScore.toFixed(2)}
                                    </span>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #059669; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 30%;">${t.compName}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 60px;">${t.rating}</th>
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.comment}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${leadList.map((l, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#ecfdf5'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-weight: 500; vertical-align: top;">${getTranslatedCompNamePDF(l.id)}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                                    <span style="display: inline-block; width: 24px; height: 24px; line-height: 24px; background: #059669; color: white; border-radius: 50%; font-weight: 700; font-size: 10pt;">${l.rating}</span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-size: 9pt; color: #475569; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${l.comment || '‚Äì'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            ` : ''}
                            
                            <!-- GPS ERGEBNIS -->
                            <div style="margin-bottom: 20px; padding: 25px; background: linear-gradient(135deg, #243186 0%, #1a2564 100%); border-radius: 8px; text-align: center; page-break-inside: avoid;">
                                <p style="font-size: 10pt; color: rgba(255,255,255,0.7); margin: 0 0 5px 0; text-transform: uppercase; letter-spacing: 2px;">FINAL GPS</p>
                                <p style="font-size: 52pt; font-weight: 900; margin: 10px 0; color: white;">${finalGPS.toFixed(2)}</p>
                                <p style="font-size: 10pt; color: #6EBD84; font-weight: 600; margin: 10px 0 0 0;">
                                    ${goals.length === 0 || totalGoalWeight === 0
                                        ? (isManager 
                                            ? (lang === 'de' ? '(100% WIE: 50% Kern + 50% Leadership)' : lang === 'it' ? '(100% COME: 50% Core + 50% Leadership)' : '(100% HOW: 50% Core + 50% Leadership)')
                                            : (lang === 'de' ? '(100% WIE: Kern-Kompetenzen)' : lang === 'it' ? '(100% COME: Competenze Core)' : '(100% HOW: Core Competencies)'))
                                        : (isManager 
                                            ? '(WAS 50% + WIE Core 25% + WIE Lead 25%)' 
                                            : '(WAS 50% + WIE Core 50%)')}
                                </p>
                                ${goals.length === 0 ? `<p style="font-size: 9pt; color: #fbbf24; margin-top: 8px;">‚ö†Ô∏è ${lang === 'de' ? 'Ohne Zielvereinbarung' : lang === 'it' ? 'Senza accordo obiettivi' : 'Without Goal Agreement'}</p>` : ''}
                            </div>
                            
                            <!-- TEIL D: ST√ÑRKEN & ENTWICKLUNG -->
                            <div style="margin-bottom: 20px;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partD}</h3>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <p style="font-weight: 600; margin: 0 0 5px 0; font-size: 10pt; color: #334155;">${t.strengthsProfessional}</p>
                                    <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; min-height: 40px; word-wrap: break-word; overflow-wrap: break-word; white-space: pre-wrap; font-size: 10pt; line-height: 1.4;">${formData.strengths1 || '‚Äì'}</div>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <p style="font-weight: 600; margin: 0 0 5px 0; font-size: 10pt; color: #334155;">${t.strengthsPersonal}</p>
                                    <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; min-height: 40px; word-wrap: break-word; overflow-wrap: break-word; white-space: pre-wrap; font-size: 10pt; line-height: 1.4;">${formData.strengths2 || '‚Äì'}</div>
                                </div>
                                
                                <p style="font-weight: 600; margin: 15px 0 8px 0; font-size: 11pt; color: #243186;">${t.development}</p>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #243186; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.measure}</th>
                                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 120px;">${t.responsible}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 85px;">${t.deadline}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${devPlan.map((d, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top; word-wrap: break-word; overflow-wrap: break-word; white-space: pre-wrap;">${d.measure || '‚Äì'}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">${d.responsible || '‚Äì'}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">${d.deadline || '‚Äì'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- TEIL E: KARRIEREPERSPEKTIVEN -->
                            <div style="margin-bottom: 20px; page-break-inside: avoid;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partE}</h3>
                                </div>
                                <p style="font-size: 9pt; color: #64748b; margin-bottom: 8px;">${t.careerIntro}</p>
                                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
                                    ${t.careerOptions.map((opt, i) => careerChecks[i] ? `
                                        <span style="padding: 6px 12px; background: #dcfce7; border: 1px solid #86efac; border-radius: 20px; font-size: 9pt; color: #166534;">‚úì ${opt}</span>
                                    ` : '').join('') || `<span style="font-size: 9pt; color: #94a3b8; font-style: italic;">${lang === 'de' ? 'Keine Auswahl getroffen' : lang === 'it' ? 'Nessuna selezione' : 'No selection made'}</span>`}
                                </div>
                                <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; font-size: 9pt; word-wrap: break-word; white-space: pre-wrap; min-height: 40px;">
                                    ${formData.careerComment || `<span style="color: #94a3b8; font-style: italic;">${lang === 'de' ? 'Kein Kommentar' : lang === 'it' ? 'Nessun commento' : 'No comment'}</span>`}
                                </div>
                            </div>
                            
                            <!-- TEIL F: FEEDBACK -->
                            <div style="margin-bottom: 20px;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partF}</h3>
                                </div>
                                <p style="font-size: 9pt; color: #64748b; margin-bottom: 12px;">${t.feedbackIntro}</p>
                                
                                ${[
                                    { q: t.feedbackQ1, a: formData.feedbackQ1 },
                                    { q: t.feedbackQ2, a: formData.feedbackQ2 },
                                    { q: t.feedbackQ3, a: formData.feedbackQ3 },
                                    { q: t.feedbackQ4, a: formData.feedbackQ4 },
                                    { q: t.feedbackQ5, a: formData.feedbackQ5 },
                                    { q: t.feedbackQ6, a: formData.feedbackQ6 },
                                    { q: t.feedbackQ7, a: formData.feedbackQ7 }
                                ].map(item => {
                                    // Erlaube Seitenumbruch bei langen Antworten (>200 Zeichen)
                                    const isLongText = (item.a || '').length > 200;
                                    return `
                                    <div style="margin-bottom: 10px; ${isLongText ? '' : 'page-break-inside: avoid;'}">
                                        <p style="font-weight: 600; margin: 0 0 4px 0; font-size: 9pt; color: #334155; page-break-after: avoid;">${item.q}</p>
                                        <div style="padding: 8px 10px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; font-size: 9pt; min-height: 20px; word-wrap: break-word; white-space: pre-wrap; overflow-wrap: break-word; orphans: 3; widows: 3;">${item.a || '‚Äì'}</div>
                                    </div>
                                `}).join('')}
                            </div>
                            
                            <!-- TEIL H: UNTERSCHRIFTEN (niemals umbrechen) -->
                            <div style="margin-top: 30px; padding: 20px; border: 2px solid #243186; border-radius: 6px; page-break-inside: avoid; break-inside: avoid;">
                                <h3 style="font-size: 12pt; margin: 0 0 25px 0; color: #243186; font-weight: 600; text-align: center;">${t.partH}</h3>
                                <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                                    <div style="width: 42%; text-align: center;">
                                        <div style="border-bottom: 2px solid #1e293b; height: 60px;"></div>
                                        <p style="margin: 8px 0 0 0; font-size: 9pt; color: #64748b;">${t.employee}</p>
                                        <p style="margin: 2px 0 0 0; font-size: 8pt; color: #94a3b8;">${lang === 'de' ? 'Datum, Unterschrift' : lang === 'it' ? 'Data, Firma' : 'Date, Signature'}</p>
                                    </div>
                                    <div style="width: 42%; text-align: center;">
                                        <div style="border-bottom: 2px solid #1e293b; height: 60px;"></div>
                                        <p style="margin: 8px 0 0 0; font-size: 9pt; color: #64748b;">${t.manager}</p>
                                        <p style="margin: 2px 0 0 0; font-size: 8pt; color: #94a3b8;">${lang === 'de' ? 'Datum, Unterschrift' : lang === 'it' ? 'Data, Firma' : 'Date, Signature'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- FOOTER -->
                            <div style="margin-top: 30px; padding-top: 10px; border-top: 1px solid #e2e8f0; text-align: center;">
                                <p style="font-size: 8pt; color: #94a3b8; margin: 0;">
                                    Niederwieser Group | ${lang === 'de' ? 'Performance Management System' : lang === 'it' ? 'Sistema di Gestione delle Performance' : 'Performance Management System'} | ${currentDate}
                                </p>
                                <p style="font-size: 7pt; color: #cbd5e1; margin: 3px 0 0 0;">
                                    ${lang === 'de' ? 'Dieses Dokument ist vertraulich und nur f√ºr den internen Gebrauch bestimmt.' : lang === 'it' ? 'Questo documento √® riservato e destinato esclusivamente all\'uso interno.' : 'This document is confidential and intended for internal use only.'}
                                </p>
                            </div>
                        `;
                        
                        pdfContainer.innerHTML = pdfHTML;
                        
                        document.body.appendChild(pdfContainer);
                        
                        const opt = {
                            margin: 10,
                            filename: `Performance_Review_${(formData.employee || 'Export').replace(/[^a-z0-9√§√∂√º√ü]/gi, '_')}.pdf`,
                            image: { type: 'jpeg', quality: 0.95 },
                            html2canvas: { 
                                scale: 2,
                                useCORS: true,
                                logging: false,
                                backgroundColor: '#ffffff'
                            },
                            jsPDF: { 
                                unit: 'mm', 
                                format: 'a4', 
                                orientation: 'portrait'
                            }
                        };
                        
                        window.html2pdf()
                            .set(opt)
                            .from(pdfContainer)
                            .save()
                            .then(() => {
                                document.body.removeChild(pdfContainer);
                                setIsGenerating(false);
                            })
                            .catch(err => {
                                console.error('PDF Error:', err);
                                showToast(getText(lang, "PDF-Export fehlgeschlagen", "Errore export PDF", "PDF export failed"), "error");
                                if (document.body.contains(pdfContainer)) {
                                    document.body.removeChild(pdfContainer);
                                }
                                setIsGenerating(false);
                            });
                            
                    } catch (error) {
                        console.error('PDF Generation Error:', error);
                        showToast(getText(lang, "PDF-Export fehlgeschlagen", "Errore export PDF", "PDF export failed"), "error");
                        setIsGenerating(false);
                    }
                }, 300);
            };

            const renderRow = (item, setList, list, isGoal) => {
                // === DYNAMISCHE KOMPETENZ-NAMEN √úBERSETZUNG ===
                const getTranslatedName = () => {
                  if (isGoal) return item.name; // Ziele werden nicht √ºbersetzt
                  
                  // Finde die Kompetenz in den Konstanten anhand der ID
                  const coreComp = CORE_COMPETENCIES_CALC.find(c => c.id === item.id);
                  const leadComp = LEADERSHIP_COMPETENCIES_CALC.find(c => c.id === item.id);
                  const comp = coreComp || leadComp;
                  
                  if (!comp) return item.name; // Fallback
                  
                  // W√§hle den korrekten Sprachschl√ºssel
                  if (lang === 'it' && comp.nameIt) return comp.nameIt;
                  if (lang === 'en' && comp.nameEn) return comp.nameEn;
                  return comp.name; // Default: Deutsch
                };
                const translatedName = getTranslatedName();
                
                // Hole MA-Selbsteinsch√§tzung f√ºr diese Kompetenz (falls vorhanden)
                const getSelfScore = () => {
                  if (!linkedSelfAssessment || isGoal) return null;
                  const selfScores = linkedSelfAssessment.selfCoreScores || {};
                  const selfLeaderScores = linkedSelfAssessment.selfLeaderScores || {};
                  const selfCoreComments = linkedSelfAssessment.selfCoreComments || {};
                  const selfLeaderComments = linkedSelfAssessment.selfLeaderComments || {};
                  
                  // Mapping: item.id (fach, komm, prob, adapt, orga) ‚Üí selfScores Key (c1, c2, c3, c4, c5)
                  const idMapping = { fach: 'c1', komm: 'c2', prob: 'c3', adapt: 'c4', orga: 'c5' };
                  const leaderMapping = { lead: 'l1', strat: 'l2', decide: 'l3', exec: 'l4', stake: 'l5' };
                  
                  // Check if it's a leadership competency
                  const isLeader = ['lead', 'strat', 'decide', 'exec', 'stake', 'l1', 'l2', 'l3', 'l4', 'l5'].includes(item.id);
                  const selfKey = isLeader 
                    ? (leaderMapping[item.id] || item.id)
                    : (idMapping[item.id] || item.id);
                  const scores = isLeader ? selfLeaderScores : selfScores;
                  const selfComments = isLeader ? selfLeaderComments : selfCoreComments;
                  
                  return {
                    score: scores[selfKey] || scores[item.id] || null,
                    comment: selfComments[selfKey] || selfComments[item.id] || null
                  };
                };
                const selfData = getSelfScore();
                
                // Gap-Analyse f√ºr diese Kompetenz
                const gapData = competencyGaps[item.id];
                const hasGap = gapData && Math.abs(gapData.gap) > 1;
                
                return e(React.Fragment, { key: item.id },
                    e('tr', { 
                      className: `break-inside-avoid ${hasGap ? 'ring-2 ring-amber-400 ring-inset bg-amber-50/50' : ''}`
                    },
                        e('td', { className: "p-2 border align-top" }, 
                            isGoal 
                                ? e('div', null,
                                    e('textarea', { 
                                        className: "w-full bg-transparent outline-none font-medium resize-none", 
                                        value: item.name, 
                                        rows: 2,
                                        placeholder: lang === 'de' ? 'Zielbezeichnung...' : lang === 'it' ? 'Nome obiettivo...' : 'Goal name...',
                                        onChange: (ev) => updateItem(list, setList, item.id, 'name', ev.target.value) 
                                    })
                                  )
                                : e('div', null,
                                    e('span', { className: "font-medium text-slate-800" }, translatedName),
                                    // Gap-Warnung als Hinweis unter dem Namen
                                    hasGap && e('div', { 
                                      className: 'mt-1 text-xs px-2 py-1 rounded bg-amber-100 text-amber-800 border-l-3 border-amber-500 no-print flex items-start gap-1.5'
                                    },
                                      e('span', { className: 'text-amber-600 flex-shrink-0' }, '‚ö†Ô∏è'),
                                      e('span', null,
                                        lang === 'de' 
                                          ? `Gap: MA sieht sich bei ${gapData.selfScore}, Sie bei ${gapData.fkScore}. Fragen Sie nach konkreten Beispielen!`
                                          : lang === 'it'
                                          ? `Gap: MA si vede a ${gapData.selfScore}, Lei a ${gapData.fkScore}. Chieda esempi concreti!`
                                          : `Gap: Employee rates ${gapData.selfScore}, you rate ${gapData.fkScore}. Ask for specific examples!`
                                      )
                                    )
                                  )
                        ),
                        isGoal && e('td', { className: "p-2 border text-center w-16 align-top" }, 
                            e('div', { className: "flex items-center justify-center" },
                                e('input', { type: "number", className: "w-full bg-transparent outline-none text-right pr-1", value: item.weight, onChange: (ev) => updateItem(list, setList, item.id, 'weight', ev.target.value) }), e('span', null, "%")
                            )
                        ),
                        isGoal && e('td', { className: "p-2 border text-center w-16 align-top" }, 
                            e('div', { className: "flex items-center justify-center" },
                                e('input', { type: "number", className: "w-full bg-transparent outline-none text-right pr-1", value: item.achievement, onChange: (ev) => updateItem(list, setList, item.id, 'achievement', ev.target.value) }), e('span', null, "%")
                            )
                        ),
                        e('td', { className: `p-2 border text-center w-24 font-bold align-top ${hasGap ? 'bg-amber-100' : 'bg-slate-50'}` }, 
                            isGoal ? getBarsScore(item.achievement) : 
                            e('div', { className: 'flex flex-col items-center gap-1' },
                              e('select', { 
                                className: `bg-transparent w-full text-center outline-none font-bold ${hasGap ? 'text-amber-700' : ''}`, 
                                value: item.rating, 
                                onChange: (ev) => updateItem(list, setList, item.id, 'rating', parseInt(ev.target.value)) 
                              }, 
                                  [1,2,3,4,5].map(n => e('option', {key:n, value:n}, n))),
                              // MA-Selbsteinsch√§tzung Badge (falls vorhanden)
                              selfData && selfData.score && e('div', { 
                                className: `text-xs px-2 py-0.5 rounded font-medium mt-1 no-print ${hasGap ? 'bg-amber-200 text-amber-800' : 'bg-teal-100 text-teal-700'}`,
                                title: lang === 'de' 
                                  ? (hasGap ? `Abweichung: ${Math.abs(gapData.gap)} Stufen - Gespr√§chsbedarf!` : 'Selbsteinsch√§tzung des Mitarbeiters')
                                  : (hasGap ? `Scostamento: ${Math.abs(gapData.gap)} livelli - da discutere!` : 'Autovalutazione del collaboratore')
                              }, 'MA: ', selfData.score)
                            )
                        ),
                        !isGoal && e('td', { className: "p-2 border align-top", style: { maxWidth: '400px', overflow: 'hidden' } }, 
                            e('div', null,
                              e('textarea', { 
                                className: "w-full bg-transparent outline-none resize-vertical text-sm competency-comment-textarea", 
                                rows: 2, 
                                value: item.comment, 
                                placeholder: "...", 
                                style: { minHeight: '40px', whiteSpace: 'pre-wrap', wordWrap: 'break-word' },
                                onChange: (ev) => updateItem(list, setList, item.id, 'comment', ev.target.value) 
                              }),
                              // MA-Kommentar Hinweis (falls vorhanden) - VOLLST√ÑNDIG anzeigen
                              selfData && selfData.comment && e('div', { 
                                className: 'mt-1 text-xs text-teal-600 bg-teal-50 p-1.5 rounded border-l-2 border-teal-400 no-print',
                                style: { maxHeight: '150px', overflowY: 'auto', overflowX: 'hidden', whiteSpace: 'pre-wrap', wordWrap: 'break-word', wordBreak: 'break-all' }
                              }, 
                                e('span', { className: 'font-medium' }, 'MA: '),
                                selfData.comment
                              )
                            )
                        ),
                        // L√∂schen-Button f√ºr Ziele
                        isGoal && e('td', { className: "p-2 border text-center no-print w-8 align-top" }, 
                            e('button', { 
                                onClick: () => removeItem(list, setList, item.id), 
                                className: "text-slate-300 hover:text-red-500 transition-colors",
                                title: lang === 'de' ? 'Ziel l√∂schen' : lang === 'it' ? 'Elimina obiettivo' : 'Delete Goal'
                            }, e(Trash2, { size: 14 }))
                        )
                    ),
                    !isGoal && item.rating && (() => {
                        // Map competency id to BARS key
                        const compKey = item.id === 'fach' || (typeof item.id === 'string' && item.id.length <= 10) ? item.id : 
                                       CORE_COMPETENCIES_CALC.find(c => c.name === item.name || c.nameIt === item.name)?.id ||
                                       LEADERSHIP_COMPETENCIES_CALC.find(c => c.name === item.name || c.nameIt === item.name)?.id;
                        const description = compKey && t.barsCompetency && t.barsCompetency[compKey] ? 
                                           t.barsCompetency[compKey][item.rating] : 
                                           '';
                        return description ? e('tr', { className: "break-inside-avoid no-print" },
                            e('td', { colSpan: 4, className: "px-2 py-1 border-l border-r bg-blue-50 text-xs text-blue-700 italic" },
                                description
                            )
                        ) : null;
                    })()
                );
            };
            
            const renderDevRow = (item) => (
                e('tr', { key: item.id, className: "break-inside-avoid" },
                    e('td', { className: "p-2 border align-top" }, 
                        e('textarea', { 
                            className: "w-full bg-transparent outline-none resize-none overflow-hidden min-h-[2rem]", 
                            value: item.measure, 
                            placeholder: "...", 
                            rows: 1,
                            style: { whiteSpace: 'pre-wrap', wordWrap: 'break-word' },
                            onChange: (ev) => {
                                updateItem(devPlan, setDevPlan, item.id, 'measure', ev.target.value);
                                // Auto-grow: H√∂he anpassen
                                ev.target.style.height = 'auto';
                                ev.target.style.height = ev.target.scrollHeight + 'px';
                            },
                            onInput: (ev) => {
                                ev.target.style.height = 'auto';
                                ev.target.style.height = ev.target.scrollHeight + 'px';
                            }
                        })
                    ),
                    e('td', { className: "p-2 border align-top" }, 
                        e('input', { className: "w-full bg-transparent outline-none", value: item.responsible, placeholder: "...", onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'responsible', ev.target.value) })
                    ),
                    e('td', { className: "p-2 border align-top" }, 
                        e('input', { type: "date", className: "w-full bg-transparent outline-none", value: item.deadline, onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'deadline', ev.target.value) })
                    ),
                    e('td', { className: "p-2 border text-center no-print w-8 align-top" }, 
                        e('button', { onClick: () => removeItem(devPlan, setDevPlan, item.id), className: "text-slate-300 hover:text-red-500" }, e(Trash2, { size: 14 }))
                    )
                )
            );
            
            // === MOBILE KARTEN-KOMPONENTEN F√úR APPRAISAL FORM ===
            
            // Mobile Karte f√ºr Ziele (WAS)
            const renderGoalCardAppraisal = (item, index) => {
                const barsScore = getBarsScore(item.achievement);
                return e('div', { 
                    key: item.id, 
                    className: 'bg-white border border-slate-200 rounded-xl p-4 shadow-sm'
                },
                    // Header
                    e('div', { className: 'flex justify-between items-center mb-3' },
                        e('span', { className: 'bg-[#243186] text-white text-xs font-bold px-2 py-1 rounded' },
                            `${lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'} ${index + 1}`
                        ),
                        e('div', { className: 'flex items-center gap-2' },
                            e('span', { className: `text-lg font-bold px-2 py-0.5 rounded ${
                                barsScore >= 4 ? 'bg-green-100 text-green-700' :
                                barsScore >= 3 ? 'bg-blue-100 text-blue-700' :
                                barsScore >= 2 ? 'bg-amber-100 text-amber-700' :
                                'bg-red-100 text-red-700'
                            }` }, barsScore),
                            e('button', { 
                                onClick: () => removeItem(goals, setGoals, item.id), 
                                className: 'text-red-400 hover:text-red-600 hover:bg-red-50 p-1.5 rounded transition-colors',
                                title: lang === 'de' ? 'Ziel entfernen' : lang === 'it' ? 'Rimuovi obiettivo' : 'Remove goal'
                            }, e(Trash2, { size: 18 }))
                        )
                    ),
                    // Zielbezeichnung
                    e('div', { className: 'mb-3' },
                        e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.goalName),
                        e('textarea', { 
                            className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm resize-none focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                            value: item.name, 
                            rows: 2,
                            placeholder: lang === 'de' ? 'Zielbezeichnung...' : lang === 'it' ? 'Nome obiettivo...' : 'Goal name...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'name', ev.target.value) 
                        })
                    ),
                    // Gewichtung & Erreichung
                    e('div', { className: 'grid grid-cols-2 gap-3' },
                        e('div', null,
                            e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.weight),
                            e('div', { className: 'flex items-center border border-slate-200 rounded-lg overflow-hidden' },
                                e('input', { 
                                    type: 'number', 
                                    className: 'flex-1 p-2 text-center text-lg font-bold outline-none', 
                                    value: item.weight, 
                                    onChange: (ev) => updateItem(goals, setGoals, item.id, 'weight', ev.target.value) 
                                }),
                                e('span', { className: 'bg-slate-100 px-3 py-2 text-slate-600 font-medium' }, '%')
                            )
                        ),
                        e('div', null,
                            e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.achievement),
                            e('div', { className: 'flex items-center border border-slate-200 rounded-lg overflow-hidden' },
                                e('input', { 
                                    type: 'number', 
                                    className: 'flex-1 p-2 text-center text-lg font-bold outline-none', 
                                    value: item.achievement, 
                                    onChange: (ev) => updateItem(goals, setGoals, item.id, 'achievement', ev.target.value) 
                                }),
                                e('span', { className: 'bg-slate-100 px-3 py-2 text-slate-600 font-medium' }, '%')
                            )
                        )
                    )
                );
            };
            
            // Mobile Karte f√ºr Kompetenzen (WIE)
            const renderCompetencyCard = (item, setList, list, isLeadership = false) => {
                // === DYNAMISCHE KOMPETENZ-NAMEN √úBERSETZUNG ===
                const getTranslatedName = () => {
                  const coreComp = CORE_COMPETENCIES_CALC.find(c => c.id === item.id);
                  const leadComp = LEADERSHIP_COMPETENCIES_CALC.find(c => c.id === item.id);
                  const comp = coreComp || leadComp;
                  
                  if (!comp) return item.name; // Fallback
                  
                  if (lang === 'it' && comp.nameIt) return comp.nameIt;
                  if (lang === 'en' && comp.nameEn) return comp.nameEn;
                  return comp.name;
                };
                const translatedName = getTranslatedName();
                
                const getSelfScore = () => {
                    if (!linkedSelfAssessment) return null;
                    const selfScores = linkedSelfAssessment.selfCoreScores || {};
                    const selfLeaderScores = linkedSelfAssessment.selfLeaderScores || {};
                    const selfCoreComments = linkedSelfAssessment.selfCoreComments || {};
                    const selfLeaderComments = linkedSelfAssessment.selfLeaderComments || {};
                    const idMapping = { fach: 'c1', komm: 'c2', prob: 'c3', adapt: 'c4', orga: 'c5' };
                    const leaderMapping = { lead: 'l1', strat: 'l2', decide: 'l3', exec: 'l4', stake: 'l5' };
                    const isLeader = ['lead', 'strat', 'decide', 'exec', 'stake', 'l1', 'l2', 'l3', 'l4', 'l5'].includes(item.id);
                    const selfKey = isLeader ? (leaderMapping[item.id] || item.id) : (idMapping[item.id] || item.id);
                    const scores = isLeader ? selfLeaderScores : selfScores;
                    const selfComments = isLeader ? selfLeaderComments : selfCoreComments;
                    return { score: scores[selfKey] || scores[item.id] || null, comment: selfComments[selfKey] || selfComments[item.id] || null };
                };
                const selfData = getSelfScore();
                const gapData = competencyGaps[item.id];
                const hasGap = gapData && Math.abs(gapData.gap) > 1;
                
                // Get BARS description
                const compKey = item.id;
                const description = compKey && t.barsCompetency && t.barsCompetency[compKey] ? t.barsCompetency[compKey][item.rating] : '';
                
                return e('div', { 
                    key: item.id, 
                    className: `bg-white border rounded-xl p-4 shadow-sm ${hasGap ? 'border-amber-400 ring-2 ring-amber-200' : 'border-slate-200'}`
                },
                    // Header mit Name und Rating
                    e('div', { className: 'flex justify-between items-start mb-3' },
                        e('div', { className: 'flex-1' },
                            e('span', { className: `text-xs font-bold px-2 py-0.5 rounded mb-1 inline-block ${isLeadership ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'}` },
                                isLeadership ? (lang === 'de' ? 'F√ºhrung' : lang === 'it' ? 'Leadership' : 'Leadership') : (lang === 'de' ? 'Kern' : lang === 'it' ? 'Core' : 'Core')
                            ),
                            e('h4', { className: 'font-bold text-slate-800 mt-1' }, translatedName)
                        ),
                        // Rating Auswahl
                        e('div', { className: 'flex flex-col items-center' },
                            e('select', { 
                                className: `text-2xl font-bold p-2 rounded-lg border-2 outline-none ${
                                    item.rating >= 4 ? 'border-green-300 bg-green-50 text-green-700' :
                                    item.rating >= 3 ? 'border-blue-300 bg-blue-50 text-blue-700' :
                                    item.rating >= 2 ? 'border-amber-300 bg-amber-50 text-amber-700' :
                                    'border-red-300 bg-red-50 text-red-700'
                                }`, 
                                value: item.rating, 
                                onChange: (ev) => updateItem(list, setList, item.id, 'rating', parseInt(ev.target.value)) 
                            }, [1,2,3,4,5].map(n => e('option', {key:n, value:n}, n))),
                            selfData && selfData.score && e('div', { 
                                className: `text-xs px-2 py-0.5 rounded font-medium mt-1 ${hasGap ? 'bg-amber-200 text-amber-800' : 'bg-teal-100 text-teal-700'}`
                            }, 'MA: ', selfData.score)
                        )
                    ),
                    
                    // Gap-Warnung
                    hasGap && e('div', { className: 'mb-3 p-2 bg-amber-100 border-l-4 border-amber-500 rounded text-xs text-amber-800' },
                        '‚ö†Ô∏è ', lang === 'de' 
                            ? `Abweichung: MA sieht sich bei ${gapData.selfScore}, Sie bei ${gapData.fkScore}`
                            : `Gap: MA si vede a ${gapData.selfScore}, Lei a ${gapData.fkScore}`
                    ),
                    
                    // BARS Beschreibung
                    description && e('div', { className: 'mb-3 p-3 bg-slate-50 rounded-lg border border-slate-200' },
                        e('p', { className: 'text-xs text-slate-500 font-medium mb-1' }, 'BARS'),
                        e('p', { className: 'text-sm text-slate-700 italic' }, description)
                    ),
                    
                    // Kommentar
                    e('div', null,
                        e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, 
                            lang === 'de' ? 'Begr√ºndung / Beispiele' : lang === 'it' ? 'Motivazione / Esempi' : 'Justification / Examples'
                        ),
                        e('textarea', { 
                            className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm resize-vertical focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none competency-comment-textarea', 
                            rows: 3, 
                            value: item.comment, 
                            placeholder: lang === 'de' ? 'Konkrete Beispiele...' : lang === 'it' ? 'Esempi concreti...' : 'Specific examples...', 
                            style: { minHeight: '60px', whiteSpace: 'pre-wrap', wordWrap: 'break-word' },
                            onChange: (ev) => updateItem(list, setList, item.id, 'comment', ev.target.value) 
                        }),
                        // MA-Kommentar VOLLST√ÑNDIG anzeigen mit Scroll
                        selfData && selfData.comment && e('div', { 
                            className: 'mt-2 text-xs text-teal-600 bg-teal-50 p-2 rounded border-l-2 border-teal-400',
                            style: { maxHeight: '150px', overflowY: 'auto', overflowX: 'hidden', whiteSpace: 'pre-wrap', wordWrap: 'break-word', wordBreak: 'break-all' }
                        }, 
                            e('span', { className: 'font-medium' }, 'MA: '),
                            selfData.comment
                        )
                    )
                );
            };
            
            // Mobile Karte f√ºr Entwicklungsma√ünahmen
            const renderDevCard = (item, index) => {
                return e('div', { 
                    key: item.id, 
                    className: 'bg-white border border-slate-200 rounded-xl p-4 shadow-sm break-inside-avoid'
                },
                    e('div', { className: 'flex justify-between items-center mb-3' },
                        e('span', { className: 'bg-emerald-100 text-emerald-700 text-xs font-bold px-2 py-1 rounded' },
                            `${lang === 'de' ? 'Ma√ünahme' : lang === 'it' ? 'Misura' : 'Measure'} ${index + 1}`
                        ),
                        e('button', { 
                            onClick: () => removeItem(devPlan, setDevPlan, item.id), 
                            className: 'text-slate-400 hover:text-red-500 p-1'
                        }, e(Trash2, { size: 16 }))
                    ),
                    e('div', { className: 'space-y-3' },
                        e('div', null,
                            e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.measure),
                            e('textarea', { 
                                className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none resize-none', 
                                value: item.measure, 
                                placeholder: '...', 
                                rows: 2,
                                style: { whiteSpace: 'pre-wrap', wordWrap: 'break-word', minHeight: '60px' },
                                onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'measure', ev.target.value) 
                            })
                        ),
                        e('div', { className: 'grid grid-cols-2 gap-3' },
                            e('div', null,
                                e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.responsible),
                                e('input', { 
                                    type: 'text',
                                    className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                                    value: item.responsible, 
                                    placeholder: '...', 
                                    onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'responsible', ev.target.value) 
                                })
                            ),
                            e('div', null,
                                e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.deadline),
                                e('input', { 
                                    type: 'date',
                                    className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                                    value: item.deadline, 
                                    onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'deadline', ev.target.value) 
                                })
                            )
                        )
                    )
                );
            };

            // Error Boundary f√ºr Debugging
            try {
            
            // === SPLIT-SCREEN SIDEBAR COMPONENT (NUR DESKTOP) ===
            // Sidebar wurde entfernt - Selbstreflexion wird nur noch im Banner angezeigt
            const SelfAssessmentSidebar = () => null;
            
            // === MAIN LAYOUT ===
            return e('div', { className: '' },
              
              // Hauptformular
              e('div', { ref: formRef, className: "max-w-5xl mx-auto space-y-8 pb-20 flex-1" },
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100" },
                    e('div', { className: "flex justify-between items-start mb-6" },
                        e('div', null, 
                            e('h1', { className: "text-3xl font-bold", style: { color: "#243186" } }, "nƒ±ederwƒ±eser"), 
                            e('span', { className: "text-sm tracking-wider font-medium", style: { color: "#6EBD84" } }, "FLEXIBLE FOOD PACKAGING")
                        ),
                        e('button', { onClick: handleDownloadPDF, disabled: isGenerating, className: "no-print flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-2xl hover:bg-blue-700 transition-colors disabled:opacity-50" }, 
                            isGenerating ? e(Loader2, { className: "animate-spin", size: 18 }) : e(Download, { size: 18 }), 
                            isGenerating ? t.generating : t.print
                        )
                    ),
                    e('div', { className: "border-b-2 border-slate-100 mb-4" }),
                    
                    // === TEAM BUTTONS (wenn teamContext) ===
                    teamButtonsVisible && teamContext && e('div', {
                      className: 'mb-6 p-5 bg-gradient-to-r from-[#243186] to-[#1a2564] rounded-xl shadow-2xl border-2 border-[#6EBD84]'
                    },
                      e('div', { className: 'flex flex-col gap-4' },
                        e('div', { className: 'flex justify-between items-start' },
                          e('div', { className: 'text-white' },
                            e('h2', { className: 'text-2xl font-bold mb-1', style: { color: '#6EBD84' } }, 
                              teamContext.employee?.name || teamContext.existingData?.employeeName || formData.employee || getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee')
                            ),
                            e('p', { className: 'text-blue-200 text-sm font-medium' }, 
                              (teamContext.employee?.position || teamContext.existingData?.position || formData.position || '') + (teamContext.employee?.department ? ' ‚Ä¢ ' + teamContext.employee.department : '')
                            ),
                            e('p', { className: 'text-blue-100 text-xs mt-1' }, 
                              (lang === 'de' ? 'Bewertungszeitraum: ' : lang === 'it' ? 'Periodo: ' : 'Assessment period: ') + (teamContext.period || new Date().getFullYear())
                            )
                          ),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'text-white/80 hover:text-white transition-colors text-2xl leading-none font-bold'
                          }, '√ó')
                        ),
                        e('div', { className: 'grid grid-cols-3 gap-3 mt-2' },
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('draft'),
                            type: 'button',
                            disabled: isSaving,
                            className: `py-3 px-4 rounded-lg font-bold text-sm transition-all shadow-lg flex items-center justify-center gap-2 ${isSaving ? 'bg-slate-400 text-slate-200 cursor-not-allowed' : 'bg-slate-200 hover:bg-slate-300 text-slate-900'}`
                          }, isSaving ? '‚è≥ ...' : 'üíæ ', isSaving ? '' : (lang === 'de' ? 'Entwurf speichern' : lang === 'it' ? 'Salva bozza' : 'Save Draft')),
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('completed'),
                            type: 'button',
                            disabled: isSaving,
                            className: `py-3 px-4 rounded-lg font-bold text-sm transition-all shadow-lg flex items-center justify-center gap-2 ${isSaving ? 'bg-green-300 text-green-100 cursor-not-allowed' : 'bg-[#6EBD84] hover:bg-[#5da872] text-white'}`
                          }, isSaving ? '‚è≥ ...' : '‚úì ', isSaving ? '' : (lang === 'de' ? 'Abschlie√üen' : lang === 'it' ? 'Completa' : 'Complete')),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'border-2 border-white/40 text-white py-3 px-4 rounded-lg font-bold hover:bg-white/20 transition-all shadow-lg text-sm'
                          }, lang === 'de' ? 'Abbrechen' : lang === 'it' ? 'Annulla' : 'Cancel')
                        )
                      )
                    ),
                    
                    // === SELBSTREFLEXION VERKN√úPFUNGS-BANNER (kompakt & smart) ===
                    // NUR anzeigen wenn teamContext existiert (Manager bewertet MA)
                    linkedSelfAssessment && showSelfAssessmentHint && teamContext && e('div', {
                      className: 'mt-4 p-3 bg-teal-50 border-2 border-teal-300 rounded-xl no-print',
                      'data-no-print': 'true',
                      style: { WebkitPrintColorAdjust: 'exact' }
                    },
                      e('div', { className: 'flex items-center justify-between gap-3 flex-wrap' },
                        // Linke Seite: Info
                        e('div', { className: 'flex items-center gap-3 flex-1 min-w-0' },
                          e('div', { className: 'bg-teal-500 text-white p-2 rounded-full flex-shrink-0' },
                            e(Users, { size: 16 })
                          ),
                          e('div', { className: 'min-w-0' },
                            e('p', { className: 'font-bold text-teal-800 text-sm truncate' },
                              `‚ú® ${lang === 'de' ? 'Selbstreflexion von' : lang === 'it' ? 'Autovalutazione di' : 'Self-Reflection from'} ${linkedSelfAssessment.employeeName}`
                            ),
                            e('p', { className: 'text-xs text-teal-600 flex items-center gap-2 flex-wrap' },
                              e('span', null, 
                                new Date(linkedSelfAssessment.submittedAt || linkedSelfAssessment.createdAt).toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB')
                              ),
                              e('span', { className: 'px-1.5 py-0.5 bg-teal-100 rounded text-teal-700 font-medium' }, 'MA: X'),
                              e('span', null, '='),
                              e('span', null, lang === 'de' ? 'Selbsteinsch√§tzung' : lang === 'it' ? 'Autoval.' : 'Self-rating')
                            )
                          )
                        ),
                        // Rechte Seite: Buttons
                        e('div', { className: 'flex items-center gap-2 flex-shrink-0' },
                          // Vollst√§ndig ansehen Button
                          e('button', {
                            onClick: () => {
                              localStorage.setItem('nw_view_self_assessment', JSON.stringify(linkedSelfAssessment));
                              const baseUrl = window.location.href.split('?')[0];
                              window.open(baseUrl + '?view=viewSelfAssessment', '_blank', 'noopener');
                            },
                            className: 'px-3 py-1.5 bg-teal-600 text-white rounded-lg text-xs font-semibold hover:bg-teal-700 transition-all flex items-center gap-1.5 shadow-sm'
                          }, 
                            e(Eye, { size: 14 }),
                            e(ExternalLink, { size: 10, className: 'opacity-70' }),
                            lang === 'de' ? '√ñffnen' : lang === 'it' ? 'Apri' : 'Open'
                          ),
                          // Refresh-Button
                          e('button', {
                            onClick: () => (teamContext?.employee?.id || teamContext?.employee?.email) && refreshLinkedSelfAssessment(teamContext.employee.id, teamContext.employee.email),
                            disabled: isRefreshingSelf,
                            className: 'p-1.5 bg-teal-100 text-teal-700 rounded-lg hover:bg-teal-200 transition-colors disabled:opacity-50',
                            title: lang === 'de' ? 'Aktualisieren' : lang === 'it' ? 'Aggiorna' : 'Refresh'
                          }, 
                            isRefreshingSelf ? e(Loader2, { size: 14, className: 'animate-spin' }) : e(RefreshCw, { size: 14 })
                          ),
                          // Schlie√üen-Button
                          e('button', {
                            onClick: () => setShowSelfAssessmentHint(false),
                            className: 'p-1.5 text-teal-400 hover:text-teal-600 hover:bg-teal-100 rounded-lg transition-colors',
                            title: lang === 'de' ? 'Ausblenden' : lang === 'it' ? 'Nascondi' : 'Hide'
                          }, e(X, { size: 14 }))
                        )
                      )
                    ),
                    
                    // === HINWEIS: KEINE SELBSTREFLEXION VORHANDEN ===
                    // NUR anzeigen wenn: teamContext existiert UND formType 'manager'
                    !linkedSelfAssessment && showSelfAssessmentHint && teamContext && formType === 'manager' && e('div', {
                      className: 'mt-4 p-4 bg-amber-50 border-2 border-amber-200 rounded-xl no-print',
                      'data-no-print': 'true',
                      style: { WebkitPrintColorAdjust: 'exact' }
                    },
                      e('div', { className: 'flex items-start justify-between' },
                        e('div', { className: 'flex items-center gap-3' },
                          e('div', { className: 'bg-amber-100 p-2 rounded-full' },
                            e(AlertCircle, { size: 20, className: 'text-amber-600' })
                          ),
                          e('div', null,
                            e('p', { className: 'font-bold text-amber-800' },
                              lang === 'de' ? 'üìã Keine Selbstreflexion eingereicht' : lang === 'it' ? 'üìã Nessuna autovalutazione inviata' : 'üìã No Self-Reflection Submitted'
                            ),
                            e('p', { className: 'text-sm text-amber-600' },
                              lang === 'de' 
                                ? 'Der Mitarbeiter hat noch keine Selbstreflexion ausgef√ºllt. Sie k√∂nnen den Selbstreflexions-Link √ºber "Team-√úbersicht" versenden.'
                                : lang === 'it' 
                                ? 'Il collaboratore non ha ancora compilato l\'autovalutazione. Puoi inviare il link tramite "Panoramica team".'
                                : 'The employee has not yet completed a self-reflection. You can send the self-reflection link via "Team Overview".'
                            )
                          )
                        ),
                        e('button', {
                          onClick: () => setShowSelfAssessmentHint(false),
                          className: 'text-amber-400 hover:text-amber-600 transition-colors'
                        }, e(X, { size: 18 }))
                      )
                    ),
                    
                    e('h2', { className: "text-2xl font-bold", style: { color: "#243186" } }, t.headerTitle),
                    e('p', { className: "font-medium", style: { color: "#6EBD84" } }, t.headerSubtitle)
                ),
                
                // === BARS-REFERENZ INFO-BLOCK (analog Selbstreflexionsbogen) ===
                e('div', { className: 'no-print mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl shadow-sm' },
                  e('div', { className: 'flex items-start gap-3' },
                    e('div', { className: 'bg-blue-500 text-white p-2 rounded-xl flex-shrink-0' },
                      e(Info, { size: 20 })
                    ),
                    e('div', { className: 'flex-1' },
                      e('h4', { className: 'font-bold text-blue-800 mb-1' },
                        lang === 'de' ? 'üìä Verhaltensanker (BARS) als Referenz √∂ffnen' 
                          : lang === 'it' ? 'üìä Apri gli ancoraggi comportamentali (BARS) come riferimento'
                          : 'üìä Open Behavioral Anchors (BARS) as Reference'
                      ),
                      e('p', { className: 'text-sm text-blue-700 mb-3' },
                        lang === 'de' 
                          ? 'Um die Kompetenzen korrekt zu bewerten, k√∂nnen Sie die detaillierten Verhaltensanker (Stufen 1-5) in einem separaten Fenster √∂ffnen.'
                          : lang === 'it'
                          ? 'Per valutare correttamente le competenze, puoi aprire gli ancoraggi comportamentali dettagliati (livelli 1-5) in una finestra separata.'
                          : 'To correctly assess competencies, you can open the detailed behavioral anchors (levels 1-5) in a separate window.'
                      ),
                      e('div', { className: 'flex flex-wrap gap-2' },
                        // Button: Kompetenzen √∂ffnen
                        e('button', {
                          onClick: () => {
                            const baseUrl = window.location.href.split('?')[0];
                            const competencyUrl = baseUrl + '?view=competencies';
                            window.open(competencyUrl, '_blank', 'noopener,noreferrer');
                          },
                          className: 'px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl text-sm font-semibold hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2'
                        },
                          e(ExternalLink, { size: 14 }),
                          lang === 'de' ? 'Kompetenzen √∂ffnen' : lang === 'it' ? 'Apri competenze' : 'Open Competencies'
                        ),
                        // Button: Link kopieren
                        e('button', {
                          onClick: () => {
                            const baseUrl = window.location.href.split('?')[0];
                            const competencyUrl = baseUrl + '?view=competencies';
                            navigator.clipboard.writeText(competencyUrl).then(() => {
                              showToast(lang === 'de' ? 'Link kopiert!' : lang === 'it' ? 'Link copiato!' : 'Link copied!', 'success');
                            });
                          },
                          className: 'px-4 py-2 bg-white text-blue-600 border border-blue-300 rounded-xl text-sm font-medium hover:bg-blue-50 transition-all flex items-center gap-2'
                        },
                          e(Copy, { size: 14 }),
                          lang === 'de' ? 'Link kopieren' : lang === 'it' ? 'Copia link' : 'Copy Link'
                        )
                      ),
                      e('p', { className: 'text-xs text-blue-500 mt-2 italic' },
                        lang === 'de' ? 'üí° Tipp: Ordnen Sie beide Fenster nebeneinander an f√ºr optimales Arbeiten.'
                          : lang === 'it' ? 'üí° Suggerimento: Disponi entrambe le finestre affiancate per un lavoro ottimale.'
                          : 'üí° Tip: Arrange both windows side by side for optimal workflow.'
                      )
                    )
                  )
                ),
                
                // === VERSION HISTORY BANNER (nur wenn Versionen vorhanden) ===
                versionHistory.length > 0 && teamContext && e('div', { 
                  className: 'no-print bg-amber-50 border-2 border-amber-300 rounded-xl p-4 mb-4'
                },
                  e('div', { className: 'flex items-center justify-between flex-wrap gap-3' },
                    e('div', { className: 'flex items-center gap-3' },
                      e('div', { className: 'bg-amber-500 text-white p-2 rounded-full' },
                        e(Clock, { size: 18 })
                      ),
                      e('div', null,
                        e('p', { className: 'font-bold text-amber-800' },
                          lang === 'de' ? 'üìö Versionshistorie verf√ºgbar' : lang === 'it' ? 'üìö Storico versioni disponibile' : 'üìö Version History Available'
                        ),
                        e('p', { className: 'text-xs text-amber-600' },
                          versionHistory.length + (lang === 'de' ? ' fr√ºhere Version(en) gespeichert' : ' previous version(s) saved')
                        )
                      )
                    ),
                    e('button', {
                      onClick: () => setShowVersionHistory(!showVersionHistory),
                      className: 'px-4 py-2 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-all flex items-center gap-2'
                    },
                      showVersionHistory ? e(ChevronUp, { size: 16 }) : e(ChevronDown, { size: 16 }),
                      showVersionHistory 
                        ? (lang === 'de' ? 'Ausblenden' : 'Hide') 
                        : (lang === 'de' ? 'Versionen anzeigen' : 'Show versions')
                    )
                  ),
                  
                  // Version List (wenn aufgeklappt)
                  showVersionHistory && e('div', { className: 'mt-4 border-t border-amber-200 pt-4' },
                    e('p', { className: 'text-sm text-amber-700 mb-3' },
                      'üëÜ ' + (lang === 'de' ? 'Klicken Sie auf eine Version um die Details anzusehen' : 'Click on a version to see details')
                    ),
                    e('div', { className: 'space-y-2 max-h-64 overflow-y-auto' },
                      versionHistory.map((version, idx) => 
                        e('div', { 
                          key: idx, 
                          onClick: () => setPreviewVersion(version),
                          className: 'flex items-center justify-between bg-white rounded-lg p-3 border border-amber-200 hover:border-amber-500 hover:shadow-md transition-all cursor-pointer group'
                        },
                          e('div', { className: 'flex items-center gap-4' },
                            e('div', { className: 'text-center bg-amber-100 group-hover:bg-amber-200 rounded-lg p-2 transition-colors' },
                              e('div', { className: 'text-lg font-bold text-amber-700' }, 
                                new Date(version.savedAt).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' })
                              ),
                              e('div', { className: 'text-xs text-slate-500' }, 
                                new Date(version.savedAt).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })
                              )
                            ),
                            e('div', null,
                              e('div', { className: 'flex items-center gap-2' },
                                e('span', { className: 'px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-sm font-semibold' },
                                  'GPS: ' + (version.gpsScore || 0).toFixed(2)
                                ),
                                version.goals && version.goals.length > 0 && e('span', { className: 'px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs' },
                                  version.goals.length + ' ' + (lang === 'de' ? 'Ziele' : 'goals')
                                ),
                                Object.keys(version.coreScores || {}).length > 0 && e('span', { className: 'px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs' },
                                  Object.keys(version.coreScores).length + ' ' + (lang === 'de' ? 'Bewertungen' : 'ratings')
                                )
                              ),
                              e('div', { className: 'text-xs text-slate-500 mt-1' },
                                'WAS: ' + (version.wasScore || 0).toFixed(2) + ' | WIE: ' + (version.wieCoreScore || 0).toFixed(2)
                              )
                            )
                          ),
                          e('div', { className: 'flex items-center gap-2 text-amber-600 group-hover:text-amber-700' },
                            e(Eye, { size: 18 }),
                            e('span', { className: 'text-sm font-medium' }, lang === 'de' ? 'Vorschau' : 'Preview')
                          )
                        )
                      )
                    ),
                    e('p', { className: 'text-xs text-amber-600 mt-3 italic' },
                      'üí° ' + (lang === 'de' 
                        ? 'In der Vorschau k√∂nnen Sie alle Details pr√ºfen bevor Sie wiederherstellen.'
                        : 'In the preview you can check all details before restoring.')
                    )
                  )
                ),
                
                // === VERSION PREVIEW MODAL ===
                previewVersion && e(VersionPreviewModal, {
                  version: previewVersion,
                  onClose: () => setPreviewVersion(null),
                  onRestore: restoreVersion
                }),
                
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partA),
                    
                    // === PROFIL-AUSWAHL (Mitarbeiter/F√ºhrungskraft) - PROMINENTER (analog Selbstreflexionsbogen) ===
                    e('div', { className: 'no-print mb-6 p-4 bg-gradient-to-r from-[#E8F5ED] to-[#F0F9F4] border-2 border-[#6EBD84] rounded-xl' },
                      e('div', { className: 'flex items-center gap-2 mb-3' },
                        e('span', { className: 'text-lg' }, 'üë§'),
                        e('span', { className: 'font-bold text-[#243186]' }, 
                          lang === 'de' ? 'Profil des Mitarbeiters:' : lang === 'it' ? 'Profilo del collaboratore:' : 'Employee Profile:'
                        )
                      ),
                      e('div', { className: 'flex flex-col sm:flex-row gap-3' },
                        // Mitarbeitende Option
                        e('label', { 
                          className: `flex-1 flex items-center gap-3 p-3 rounded-lg cursor-pointer border-2 transition-all ${
                            !isManager 
                              ? 'bg-white border-[#243186] shadow-md' 
                              : 'bg-white/50 border-slate-200 hover:border-slate-300'
                          }`
                        }, 
                          e('input', { 
                            type: 'radio', 
                            checked: !isManager, 
                            onChange: () => setIsManager(false),
                            className: 'w-5 h-5 text-[#243186]'
                          }), 
                          e('div', null,
                            e('span', { className: 'font-semibold text-slate-800 block' }, 
                              lang === 'de' ? 'Mitarbeitende/r' : lang === 'it' ? 'Collaboratore/trice' : 'Employee'
                            ),
                            e('span', { className: 'text-xs text-slate-500' }, 
                              lang === 'de' ? '50% WAS + 50% Kern-Kompetenzen' : lang === 'it' ? '50% COSA + 50% Competenze base' : '50% WHAT + 50% Core Competencies'
                            )
                          )
                        ),
                        // F√ºhrungskraft Option
                        e('label', { 
                          className: `flex-1 flex items-center gap-3 p-3 rounded-lg cursor-pointer border-2 transition-all ${
                            isManager 
                              ? 'bg-white border-[#6EBD84] shadow-md' 
                              : 'bg-white/50 border-slate-200 hover:border-slate-300'
                          }`
                        }, 
                          e('input', { 
                            type: 'radio', 
                            checked: isManager, 
                            onChange: () => setIsManager(true),
                            className: 'w-5 h-5 text-[#6EBD84]'
                          }), 
                          e('div', null,
                            e('span', { className: 'font-semibold text-slate-800 block' }, 
                              lang === 'de' ? 'F√ºhrungskraft' : lang === 'it' ? 'Manager' : 'Manager'
                            ),
                            e('span', { className: 'text-xs text-slate-500' }, 
                              lang === 'de' ? '50% WAS + 25% Kern + 25% Leadership' : lang === 'it' ? '50% COSA + 25% Base + 25% Leadership' : '50% WHAT + 25% Core + 25% Leadership'
                            )
                          )
                        )
                      ),
                      // Hinweis wenn F√ºhrungskraft gew√§hlt
                      isManager && e('div', { className: 'mt-3 text-sm text-[#059669] bg-white/80 p-2 rounded-lg flex items-center gap-2' },
                        e('span', null, '‚úÖ'),
                        lang === 'de' 
                          ? 'Bei F√ºhrungskr√§ften werden auch die 5 Leadership-Kompetenzen (Teil C.2) bewertet' 
                          : lang === 'it'
                          ? 'Per i manager vengono valutate anche le 5 competenze di leadership (Parte C.2)'
                          : 'For managers, the 5 leadership competencies (Part C.2) are also evaluated'
                      )
                    ),
                    
                    // === KOMPETENZ-REFERENZ HINWEIS (kompakt) ===
                    e('div', { className: 'no-print mb-6 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl flex items-center justify-between gap-3' },
                      e('div', { className: 'flex items-center gap-2 text-sm text-blue-700' },
                        e('span', { className: 'text-lg' }, 'üìò'),
                        e('span', null, 
                          lang === 'de' ? 'Verhaltensanker (BARS) als Referenz √∂ffnen:' 
                            : lang === 'it' ? 'Apri gli ancoraggi comportamentali (BARS) come riferimento:'
                            : 'Open behavioral anchors (BARS) as reference:'
                        )
                      ),
                      e('button', {
                        onClick: () => {
                          const baseUrl = window.location.href.split('?')[0];
                          const competencyUrl = baseUrl + '?view=competencies';
                          window.open(competencyUrl, '_blank', 'noopener,noreferrer');
                        },
                        className: 'px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-xl text-sm font-medium hover:from-blue-600 hover:to-indigo-600 transition-all flex items-center gap-2 shadow-md'
                      },
                        e(BookOpen, { size: 16 }),
                        e(ExternalLink, { size: 12, className: 'opacity-70' }),
                        lang === 'de' ? 'Kompetenzen' : lang === 'it' ? 'Competenze' : 'Competencies'
                      )
                    ),
                    
                    e('div', { className: "hidden print:block pdf-only mb-4 font-bold" }, `${t.profile}: ${isManager ? t.roleMgr : t.roleEmp}`),
                    e('div', { className: "grid grid-cols-2 gap-6" },
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.employee), e('input', { type: "text", value: formData.employee, onChange: (ev) => handleFormChange('employee', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.manager), e('input', { type: "text", value: formData.manager, onChange: (ev) => handleFormChange('manager', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.position), e('input', { type: "text", value: formData.position, onChange: (ev) => handleFormChange('position', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.date), e('input', { type: "date", value: formData.date, onChange: (ev) => handleFormChange('date', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" }))
                    )
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('div', { className: "flex justify-between items-center mb-4 border-b pb-2" },
                        e('h3', { className: "text-lg font-bold text-slate-700" }, t.partB),
                        e('span', { className: "bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-bold" }, 
                            goals.length > 0 ? `Score: ${wasScore.toFixed(2)}` : (lang === 'de' ? 'Keine Ziele (nur WIE)' : lang === 'it' ? 'Nessun obiettivo (solo COME)' : 'No goals (HOW only)')
                        )
                    ),
                    // NEUER HINWEIS: Keine Ziele vorhanden
                    e('div', { className: "no-print mb-4 p-4 rounded-lg bg-amber-50 border border-amber-200" },
                        e('div', { className: "flex items-start gap-3" },
                            e(Info, { size: 20, className: "text-amber-600 mt-0.5 flex-shrink-0" }),
                            e('div', null,
                                e('p', { className: "text-sm font-semibold text-amber-800 mb-1" }, 
                                    lang === 'de' ? 'Keine Zielvereinbarung vorhanden?' : lang === 'it' ? 'Nessun accordo sugli obiettivi?' : 'No Goal Agreement found?'
                                ),
                                e('p', { className: "text-xs text-amber-700" }, 
                                    lang === 'de' 
                                        ? 'Falls f√ºr diesen Mitarbeiter keine Ziele vereinbart wurden, l√∂schen Sie bitte alle Zeilen mit dem üóëÔ∏è-Button. Der GPS wird dann automatisch nur aus Teil C (Kompetenzen = 100%) berechnet.'
                                        : 'Se non sono stati concordati obiettivi per questo collaboratore, eliminare tutte le righe con il pulsante üóëÔ∏è. Il GPS verr√† calcolato automaticamente solo dalla Parte C (Competenze = 100%).'
                                )
                            )
                        )
                    ),
                    
                    // === NEU: ZIEL-√úBERNAHME AUS SELBSTREFLEXION (IDIOTENSICHER) ===
                    linkedSelfAssessment?.goals?.length > 0 && !linkedSelfAssessment.noGoalsMode && e('div', { 
                      className: 'mb-4 p-4 bg-indigo-50 border-2 border-indigo-300 rounded-xl no-print', 
                      'data-no-print': 'true' 
                    },
                      // Header mit prominentem Button
                      e('div', { className: 'flex items-center justify-between mb-4 pb-3 border-b border-indigo-200' },
                        e('div', { className: 'flex items-center gap-2' },
                          e('div', { className: 'w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center' },
                            e(Users, { size: 16, className: 'text-white' })
                          ),
                          e('div', null,
                            e('span', { className: 'text-sm font-bold text-indigo-900 block' }, 
                              lang === 'de' ? 'Ziele aus Selbstreflexion verf√ºgbar' : 
                              lang === 'it' ? 'Obiettivi disponibili dall\'autovalutazione' : 
                              'Goals available from self-reflection'
                            ),
                            e('span', { className: 'text-xs text-indigo-600' }, 
                              `${linkedSelfAssessment.goals.length} ${lang === 'de' ? 'Ziele vom Mitarbeiter' : lang === 'it' ? 'obiettivi dal collaboratore' : 'goals from employee'}`
                            )
                          )
                        ),
                        // PROMINENTER BUTTON - ersetzt bestehende Ziele
                        e('button', { 
                          type: 'button',
                          className: 'text-sm bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-md font-semibold',
                          onClick: () => {
                            // Warnung wenn bereits Ziele existieren
                            const hasExistingGoals = goals.length > 0 && goals.some(g => g.name?.trim());
                            
                            if (hasExistingGoals) {
                              const confirmMsg = lang === 'de' 
                                ? `Sie haben bereits ${goals.length} Ziel(e) eingetragen. Diese werden durch die ${linkedSelfAssessment.goals.length} Ziele aus der Selbstreflexion ERSETZT. Fortfahren?`
                                : lang === 'it'
                                ? `Hai gi√† ${goals.length} obiettivo/i. Saranno SOSTITUITI con i ${linkedSelfAssessment.goals.length} obiettivi dell'autovalutazione. Continuare?`
                                : `You have ${goals.length} goal(s). These will be REPLACED with the ${linkedSelfAssessment.goals.length} goals from self-reflection. Continue?`;
                              
                              if (!confirm(confirmMsg)) return;
                            }
                            
                            // ERSETZE alle Ziele (nicht hinzuf√ºgen!)
                            const selfGoals = linkedSelfAssessment.goals.map((g, idx) => ({
                              id: Date.now() + idx,
                              name: g.name || '',
                              weight: g.weight || 0,
                              achievement: g.achievement || 0,
                              comment: g.comment || ''
                            }));
                            setGoals(selfGoals);
                            
                            // Erfolgsmeldung
                            const successMsg = lang === 'de' 
                              ? `‚úÖ ${selfGoals.length} Ziele aus Selbstreflexion √ºbernommen`
                              : lang === 'it'
                              ? `‚úÖ ${selfGoals.length} obiettivi importati dall'autovalutazione`
                              : `‚úÖ ${selfGoals.length} goals imported from self-reflection`;
                            
                            const toast = document.createElement('div');
                            toast.textContent = successMsg;
                            toast.style.cssText = 'position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:#4f46e5;color:white;padding:12px 24px;border-radius:8px;font-weight:600;z-index:99999;box-shadow:0 4px 20px rgba(79,70,229,0.4);';
                            document.body.appendChild(toast);
                            setTimeout(() => toast.remove(), 2500);
                            
                            devLog('‚úÖ Ziele aus Selbstreflexion ERSETZT:', selfGoals.length);
                          }
                        }, 
                          e(Copy, { size: 16 }), 
                          lang === 'de' ? 'Ziele √ºbernehmen' : 
                          lang === 'it' ? 'Importa obiettivi' : 
                          'Import goals'
                        )
                      ),
                      
                      // Kompakte Vorschau der Ziele
                      e('div', { className: 'space-y-2 max-h-48 overflow-y-auto' },
                        linkedSelfAssessment.goals.map((g, idx) => 
                          e('div', { 
                            key: idx, 
                            className: 'flex items-center gap-3 p-2 bg-white rounded-lg border border-indigo-100'
                          },
                            e('span', { className: 'w-6 h-6 rounded-full bg-indigo-100 text-indigo-700 text-xs font-bold flex items-center justify-center flex-shrink-0' }, idx + 1),
                            e('div', { className: 'flex-1 min-w-0' },
                              e('span', { className: 'text-sm text-slate-800 block truncate' }, g.name || '-'),
                              e('div', { className: 'flex items-center gap-2 text-xs text-slate-500' },
                                e('span', null, `${g.weight || 0}%`),
                                g.achievement > 0 && e('span', { className: 'text-indigo-600' }, 
                                  `‚Ä¢ MA: ${g.achievement}%`
                                )
                              )
                            )
                          )
                        )
                      ),
                      
                      // Hinweis
                      e('div', { className: 'mt-3 p-2 bg-indigo-100 rounded-lg text-xs text-indigo-700 flex items-start gap-2' },
                        e(Info, { size: 14, className: 'flex-shrink-0 mt-0.5' }),
                        e('span', null,
                          lang === 'de' 
                            ? 'Die √úbernahme ersetzt alle bestehenden Ziele. Die Selbsteinsch√§tzung des Mitarbeiters wird als Ausgangswert √ºbernommen ‚Äì Sie k√∂nnen alle Werte anschlie√üend anpassen.'
                            : lang === 'it'
                            ? 'L\'importazione sostituisce tutti gli obiettivi esistenti. L\'autovalutazione del collaboratore viene importata come valore iniziale ‚Äì potete modificare tutti i valori successivamente.'
                            : 'Import replaces all existing goals. The employee\'s self-assessment is imported as starting value ‚Äì you can adjust all values afterwards.'
                        )
                      )
                    ),
                    
                    // === DESKTOP: Tabellen-Ansicht (hidden on mobile) ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm" },
                            e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, 
                                e('th', { className: "p-2 border w-1/3" }, t.goalName), 
                                e('th', { className: "p-2 border" }, t.weight), 
                                e('th', { className: "p-2 border" }, t.achievement), 
                                e('th', { className: "p-2 border" }, "BARS"),
                                e('th', { className: "p-2 border no-print w-8" }, "")
                            )),
                            e('tbody', null, goals.map(item => renderRow(item, setGoals, goals, true)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht (hidden on desktop) ===
                    e('div', { className: 'md:hidden space-y-4' },
                        goals.map((item, index) => renderGoalCardAppraisal(item, index)),
                        goals.length > 0 && e('div', { 
                            className: `mt-3 p-3 rounded-lg flex items-center justify-between ${
                                totalGoalWeight === 100 ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'
                            }`
                        },
                            e('span', { className: 'font-semibold text-sm' }, 
                                lang === 'de' ? 'Gewichtungssumme:' : lang === 'it' ? 'Somma pesi:' : 'Weight Sum:'
                            ),
                            e('span', { className: `text-xl font-bold ${totalGoalWeight === 100 ? 'text-green-700' : 'text-amber-700'}` }, 
                                `${totalGoalWeight}%`
                            )
                        )
                    ),
                    
                    e('button', { onClick: () => addItem(goals, setGoals, {name:'', weight:0, achievement:0}), className: "no-print mt-3 text-xs flex items-center gap-1 text-blue-600" }, e(PlusCircle, {size:14}), t.addGoal),
                    
                    // === GOAL-OVERLOAD INDIKATOR ===
                    goals.length > 0 && e('div', { 
                        className: `no-print mt-4 p-4 rounded-xl border-2 flex items-center gap-3 ${
                            goals.length >= 1 && goals.length <= 2 
                                ? 'bg-amber-50 border-amber-300' 
                                : goals.length >= 3 && goals.length <= 6 
                                    ? 'bg-green-50 border-green-300' 
                                    : 'bg-red-50 border-red-300'
                        }`
                    },
                        // Icon
                        e('div', { 
                            className: `w-10 h-10 rounded-full flex items-center justify-center text-white text-lg font-bold ${
                                goals.length >= 1 && goals.length <= 2 
                                    ? 'bg-amber-500' 
                                    : goals.length >= 3 && goals.length <= 6 
                                        ? 'bg-green-500' 
                                        : 'bg-red-500'
                            }`
                        }, goals.length),
                        // Text
                        e('div', { className: 'flex-1' },
                            e('div', { 
                                className: `font-bold text-sm ${
                                    goals.length >= 1 && goals.length <= 2 
                                        ? 'text-amber-800' 
                                        : goals.length >= 3 && goals.length <= 6 
                                            ? 'text-green-800' 
                                            : 'text-red-800'
                                }`
                            }, 
                                goals.length >= 1 && goals.length <= 2 
                                    ? (lang === 'de' ? 'Zielanzahl: Wenig Fokus?' : lang === 'it' ? 'Numero obiettivi: Poco focus?' : 'Goal Count: Too few?')
                                    : goals.length >= 3 && goals.length <= 6 
                                        ? (lang === 'de' ? 'Zielanzahl: Ideal!' : lang === 'it' ? 'Numero obiettivi: Ideale!' : 'Goal Count: Ideal!')
                                        : (lang === 'de' ? 'Zielanzahl: Verzettelungsgefahr!' : lang === 'it' ? 'Numero obiettivi: Rischio dispersione!' : 'Goal Count: Overload Risk!')
                            ),
                            e('div', { 
                                className: `text-xs mt-1 ${
                                    goals.length >= 1 && goals.length <= 2 
                                        ? 'text-amber-700' 
                                        : goals.length >= 3 && goals.length <= 6 
                                            ? 'text-green-700' 
                                            : 'text-red-700'
                                }`
                            }, 
                                goals.length >= 1 && goals.length <= 2 
                                    ? (lang === 'de' 
                                        ? '1-2 Ziele k√∂nnen auf zu wenig strategischen Fokus hindeuten. Sind alle wichtigen Bereiche abgedeckt?' 
                                        : lang === 'it' 
                                            ? '1-2 obiettivi potrebbero indicare poco focus strategico. Tutte le aree importanti sono coperte?' 
                                            : '1-2 goals may indicate insufficient strategic focus. Are all important areas covered?')
                                    : goals.length >= 3 && goals.length <= 6 
                                        ? (lang === 'de' 
                                            ? '3-6 Ziele sind optimal f√ºr Fokus und Umsetzbarkeit. Gute Balance!' 
                                            : lang === 'it' 
                                                ? '3-6 obiettivi sono ottimali per focus e realizzabilit√†. Buon equilibrio!' 
                                                : '3-6 goals are optimal for focus and achievability. Good balance!')
                                        : (lang === 'de' 
                                            ? '7+ Ziele bergen die Gefahr der Verzettelung. Bitte priorisieren und konsolidieren!' 
                                            : lang === 'it' 
                                                ? '7+ obiettivi rischiano la dispersione. Per favore priorizzare e consolidare!' 
                                                : '7+ goals risk fragmentation. Please prioritize and consolidate!')
                            )
                        ),
                        // Empfehlung
                        e('div', { className: 'text-right' },
                            e('div', { className: 'text-xs text-slate-500' }, 
                                lang === 'de' ? 'Empfohlen' : lang === 'it' ? 'Consigliato' : 'Recommended'
                            ),
                            e('div', { className: 'font-bold text-green-700' }, '3-6')
                        )
                    ),
                    
                    goals.length === 0 && e('div', { 
                        className: 'text-sm p-4 mt-3 rounded-lg bg-green-50 text-green-700 border border-green-200'
                    }, 
                        e('div', { className: "flex items-center gap-2" },
                            e(CheckCircle2, { size: 18 }),
                            e('span', { className: "font-semibold" },
                                lang === 'de' 
                                    ? '‚úì GPS wird zu 100% aus WIE-Kompetenzen berechnet'
                                    : '‚úì GPS calcolato al 100% dalle competenze COME'
                            )
                        ),
                        e('p', { className: "text-xs mt-1 ml-6" },
                            lang === 'de'
                                ? isManager 
                                    ? 'Formel: 50% Kern-Kompetenzen + 50% Leadership-Kompetenzen'
                                    : 'Formel: 100% Kern-Kompetenzen'
                                : isManager
                                    ? 'Formula: 50% Competenze Core + 50% Competenze Leadership'
                                    : 'Formula: 100% Competenze Core'
                        )
                    ),
                    goals.length > 0 && totalGoalWeight !== 100 && e('div', { 
                        className: `no-print text-sm p-3 mt-3 rounded-lg ${
                            totalGoalWeight > 100 ? 'bg-red-50 text-red-700 border border-red-200' : 
                            'bg-yellow-50 text-yellow-700 border border-yellow-200'
                        }`
                    }, 
                        `${t.totalWeight}: ${totalGoalWeight}% ${totalGoalWeight !== 100 ? `(${t.shouldBe100})` : ''}`
                    ),
                    
                    // Geplanter Bonus (100%) Feld und Berechnung
                    e('div', { className: "mt-6 pt-4 border-t border-slate-200" },
                        // Eingabefeld f√ºr geplanten Bonus
                        e('div', { className: "flex items-center gap-4 mb-4" },
                            e('label', { className: "text-sm font-semibold text-slate-700 whitespace-nowrap" }, 
                                lang === 'de' ? 'Geplanter Bonus (100%):' : lang === 'it' ? 'Bonus previsto (100%):' : 'Planned Bonus (100%):'
                            ),
                            e('div', { className: "relative w-48" },
                                e('input', { 
                                    type: "text", 
                                    value: displayBonus,
                                    onChange: (ev) => handleBonusChange(ev.target.value),
                                    placeholder: lang === 'de' ? 'z.B. 5.000' : lang === 'it' ? 'es. 5.000' : 'e.g. 5,000',
                                    className: "w-full border border-slate-300 rounded-lg px-3 py-2 pr-8 outline-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] text-right font-medium"
                                }),
                                e('span', { className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium" }, '‚Ç¨')
                            ),
                            e('span', { className: "text-xs text-slate-400" }, 
                                lang === 'de' ? '(Tausenderpunkte erlaubt)' : lang === 'it' ? '(Punti per migliaia)' : '(Thousands separators allowed)'
                            )
                        ),
                        
                        // Bonus-Berechnung anzeigen (nur wenn Bonus eingegeben)
                        plannedBonusNum > 0 && goals.length > 0 && e('div', { className: "bg-gradient-to-r from-emerald-50 to-green-50 p-4 rounded-xl border border-emerald-200" },
                            e('h4', { className: "font-bold text-emerald-800 mb-3 flex items-center gap-2" },
                                e(Calculator, { size: 18 }),
                                lang === 'de' ? 'Bonus-Berechnung' : lang === 'it' ? 'Calcolo Bonus' : 'Bonus Calculation'
                            ),
                            
                            // Tabelle mit Bonus pro Ziel
                            e('table', { className: "w-full text-sm mb-3" },
                                e('thead', { className: "bg-emerald-100/50" },
                                    e('tr', null,
                                        e('th', { className: "p-2 text-left text-emerald-800 font-semibold" }, 
                                            lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'),
                                        e('th', { className: "p-2 text-center text-emerald-800 font-semibold w-20" }, 
                                            lang === 'de' ? 'Gewicht' : lang === 'it' ? 'Peso' : 'Weight'),
                                        e('th', { className: "p-2 text-right text-emerald-800 font-semibold w-24" }, 
                                            lang === 'de' ? 'Anteil' : lang === 'it' ? 'Quota' : 'Share'),
                                        e('th', { className: "p-2 text-center text-emerald-800 font-semibold w-20" }, 
                                            lang === 'de' ? 'Erreicht' : lang === 'it' ? 'Raggiunto' : 'Achieved'),
                                        e('th', { className: "p-2 text-right text-emerald-800 font-semibold w-28" }, 
                                            lang === 'de' ? 'Auszahlung' : lang === 'it' ? 'Pagamento' : 'Payout')
                                    )
                                ),
                                e('tbody', null,
                                    bonusPerGoal.map((b, idx) => 
                                        e('tr', { key: idx, className: "border-t border-emerald-200" },
                                            e('td', { className: "p-2 text-slate-700" }, 
                                                b.goalName || `${lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'} ${idx + 1}`
                                            ),
                                            e('td', { className: "p-2 text-center text-slate-600" }, `${b.weight}%`),
                                            e('td', { className: "p-2 text-right text-slate-600" }, 
                                                `${formatGermanNumber(b.goalBonus.toFixed(0))} ‚Ç¨`
                                            ),
                                            e('td', { className: "p-2 text-center" },
                                                e('span', { 
                                                    className: `px-2 py-0.5 rounded text-xs font-medium ${
                                                        b.achievement >= 100 ? 'bg-green-100 text-green-800' :
                                                        b.achievement >= 70 ? 'bg-yellow-100 text-yellow-800' :
                                                        'bg-red-100 text-red-800'
                                                    }`
                                                }, `${b.achievement}%`)
                                            ),
                                            e('td', { className: "p-2 text-right font-semibold text-emerald-700" }, 
                                                `${formatGermanNumber(b.payout.toFixed(0))} ‚Ç¨`
                                            )
                                        )
                                    )
                                )
                            ),
                            
                            // Summenzeile
                            e('div', { className: "flex justify-between items-center pt-3 border-t-2 border-emerald-300" },
                                e('div', { className: "text-sm text-emerald-800" },
                                    e('span', { className: "font-medium" }, 
                                        lang === 'de' ? 'Geplant: ' : lang === 'it' ? 'Previsto: ' : 'Planned: '
                                    ),
                                    e('span', { className: "font-bold" }, `${formatGermanNumber(plannedBonusNum.toFixed(0))} ‚Ç¨`)
                                ),
                                e('div', { className: "text-right" },
                                    e('div', { className: "text-xs text-emerald-600 mb-1" },
                                        lang === 'de' ? 'Tats√§chliche Auszahlung:' : lang === 'it' ? 'Pagamento effettivo:' : 'Actual Payout:'
                                    ),
                                    e('div', { className: "text-2xl font-black text-emerald-700" },
                                        `${formatGermanNumber(totalBonusPayout.toFixed(0))} ‚Ç¨`
                                    ),
                                    e('div', { className: `text-xs font-medium ${bonusPayoutPercentage >= 100 ? 'text-green-600' : bonusPayoutPercentage >= 70 ? 'text-yellow-600' : 'text-red-600'}` },
                                        `(${bonusPayoutPercentage.toFixed(1)}% ${lang === 'de' ? 'vom Zielbonus' : lang === 'it' ? 'del bonus target' : 'of target bonus'})`
                                    )
                                )
                            ),
                            
                            // Hinweis bei >100% Zielerreichung
                            bonusPerGoal.some(b => b.achievement > 100) && e('div', { className: "mt-3 p-2 bg-blue-50 border border-blue-200 rounded-lg text-xs text-blue-700" },
                                lang === 'de' 
                                    ? 'üí° Hinweis: Bei >100% Zielerreichung wird der Bonus auf max. 100% des Ziel-Anteils gedeckelt.'
                                    : 'üí° Nota: Con >100% di raggiungimento, il bonus √® limitato al max. 100% della quota obiettivo.'
                            )
                        )
                    )
                ),
                
                // === HALO-EFFEKT WARNUNG ===
                haloEffectWarning && e('div', { 
                  className: "bg-amber-50 border-2 border-amber-400 rounded-xl p-4 no-print",
                  'data-no-print': 'true',
                  style: { WebkitPrintColorAdjust: 'exact' }
                },
                  e('div', { className: "flex items-start gap-3" },
                    e('div', { className: "text-2xl flex-shrink-0" }, "üé≠"),
                    e('div', null,
                      e('div', { className: "font-bold text-amber-800 mb-1" }, 
                        lang === 'de' ? 'M√∂glicher Halo-Effekt' : lang === 'it' ? 'Possibile Effetto Halo' : 'Possible Halo Effect'
                      ),
                      e('div', { className: "text-sm text-amber-700" },
                        lang === 'de' 
                          ? `Alle 5 Core-Kompetenzen wurden mit Level ${coreRatings[0]} bewertet. Es ist unwahrscheinlich, dass jemand in allen Bereichen exakt gleich stark ist. Wo liegen echte St√§rken, wo Entwicklungsfelder?`
                          : lang === 'it'
                          ? `Tutte le 5 competenze core sono valutate livello ${coreRatings[0]}. √à improbabile che qualcuno sia uguale in tutte le aree. Dove sono i punti di forza, dove le aree di sviluppo?`
                          : `All 5 core competencies rated at level ${coreRatings[0]}. It's unlikely someone performs exactly the same in all areas. Where are real strengths, where development areas?`
                      )
                    )
                  )
                ),
                
                // === GAP-ANALYSE SUMMARY ===
                hasSignificantGaps && linkedSelfAssessment && e('div', { 
                  className: "bg-purple-50 border-2 border-purple-400 rounded-xl p-4 no-print",
                  'data-no-print': 'true',
                  style: { WebkitPrintColorAdjust: 'exact' }
                },
                  e('div', { className: "flex items-start gap-3" },
                    e('div', { className: "text-2xl flex-shrink-0" }, "üîç"),
                    e('div', null,
                      e('div', { className: "font-bold text-purple-800 mb-1" }, 
                        lang === 'de' 
                          ? `${Object.keys(competencyGaps).length} Wahrnehmungs-Gap${Object.keys(competencyGaps).length > 1 ? 's' : ''}`
                          : lang === 'it'
                          ? `${Object.keys(competencyGaps).length} gap di percezione`
                          : `${Object.keys(competencyGaps).length} perception gap${Object.keys(competencyGaps).length > 1 ? 's' : ''}`
                      ),
                      e('div', { className: "text-sm text-purple-700 mb-2" },
                        lang === 'de' 
                          ? 'Bei den gelb markierten Kompetenzen weicht Ihre Einsch√§tzung um >1 Stufe vom Selbstbild ab. Nutzen Sie das Gespr√§ch zum Abgleich.'
                          : lang === 'it'
                          ? 'Nelle competenze evidenziate in giallo, la valutazione differisce di >1 livello. Usi il colloquio per allineare.'
                          : 'For yellow-marked competencies, your rating differs by >1 level from self-assessment. Use the conversation to align.'
                      ),
                      e('div', { className: "text-xs text-purple-600 bg-purple-100 p-2 rounded italic" },
                        lang === 'de' 
                          ? 'üí° "K√∂nnen Sie mir ein konkretes Beispiel nennen, wo Sie das gezeigt haben?"'
                          : lang === 'it'
                          ? 'üí° "Pu√≤ darmi un esempio concreto in cui lo ha dimostrato?"'
                          : 'üí° "Can you give me a specific example where you demonstrated this?"'
                      )
                    )
                  )
                ),
                
                e('div', { className: "bg-white p-4 md:p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('div', { className: "flex justify-between items-center mb-4 border-b pb-2" },
                        e('h3', { className: "text-lg font-bold text-slate-700" }, t.partC),
                        e('span', { className: "bg-[#E8F5ED] text-[#4D9360] px-2 py-1 rounded text-xs font-bold" }, `Score: ${wieCoreScore.toFixed(2)}`)
                    ),
                    
                    // === DESKTOP: Tabellen-Ansicht ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm" },
                            e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, 
                                e('th', { className: "p-2 border" }, t.compName), 
                                e('th', { className: "p-2 border w-24" }, t.rating), 
                                e('th', { className: "p-2 border" }, t.comment)
                            )),
                            e('tbody', null, coreList.map(item => renderRow(item, setCoreList, coreList, false)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht ===
                    e('div', { className: 'md:hidden space-y-4' },
                        coreList.map(item => renderCompetencyCard(item, setCoreList, coreList, false))
                    ),
                    
                    e('button', { onClick: () => addItem(coreList, setCoreList, {name:'', weight:20, rating:3, comment:''}), className: "no-print mt-3 text-xs flex items-center gap-1 text-[#6EBD84]" }, e(PlusCircle, {size:14}), t.addComp)
                ),
                isManager && e('div', { className: "bg-white p-4 md:p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('div', { className: "flex justify-between items-center mb-4 border-b pb-2" },
                        e('h3', { className: "text-lg font-bold text-[#5CA872]" }, t.partCLead),
                        e('span', { className: "bg-[#E8F5ED] text-[#4D9360] px-2 py-1 rounded text-xs font-bold" }, `Score: ${wieLeadScore.toFixed(2)}`)
                    ),
                    
                    // === DESKTOP: Tabellen-Ansicht ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm" },
                            e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, 
                                e('th', { className: "p-2 border" }, t.compName), 
                                e('th', { className: "p-2 border w-24" }, t.rating), 
                                e('th', { className: "p-2 border" }, t.comment)
                            )),
                            e('tbody', null, leadList.map(item => renderRow(item, setLeadList, leadList, false)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht ===
                    e('div', { className: 'md:hidden space-y-4' },
                        leadList.map(item => renderCompetencyCard(item, setLeadList, leadList, true))
                    ),
                    
                    e('button', { onClick: () => addItem(leadList, setLeadList, {name:'', weight:20, rating:3, comment:''}), className: "no-print mt-3 text-xs flex items-center gap-1 text-[#6EBD84]" }, e(PlusCircle, {size:14}), t.addComp)
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partC3),
                    e('div', { className: "bg-slate-50 p-6 rounded-xl text-center border border-slate-200" },
                        e('div', { className: "text-sm text-slate-500 uppercase tracking-widest mb-2" }, "Final GPS"),
                        e('div', { className: "text-5xl font-black text-slate-800" }, finalGPS.toFixed(2)),
                        e('div', { className: "mt-2 font-medium text-[#6EBD84]" }, 
                            goals.length === 0 || totalGoalWeight === 0
                                ? (isManager 
                                    ? (lang === 'de' ? '(100% WIE: 50% Kern + 50% Leadership)' : lang === 'it' ? '(100% COME: 50% Core + 50% Leadership)' : '(100% HOW: 50% Core + 50% Leadership)')
                                    : (lang === 'de' ? '(100% WIE: Kern-Kompetenzen)' : lang === 'it' ? '(100% COME: Competenze Core)' : '(100% HOW: Core Competencies)'))
                                : (isManager 
                                    ? '(WAS 50% + WIE Core 25% + WIE Lead 25%)' 
                                    : '(WAS 50% + WIE Core 50%)')
                        ),
                        goals.length === 0 && e('div', { className: "mt-3 text-xs text-amber-600 bg-amber-50 px-3 py-1 rounded-full inline-block" },
                            lang === 'de' ? '‚ö†Ô∏è Ohne Zielvereinbarung' : lang === 'it' ? '‚ö†Ô∏è Senza accordo obiettivi' : '‚ö†Ô∏è Without Goal Agreement'
                        ),
                        // === NEU: GPS Konfidenz-Anzeige ===
                        (() => {
                          const confidence = calculateGPSConfidence(goals, coreList, leadList, isManager);
                          return e('div', { 
                            className: `mt-4 px-4 py-2 rounded-lg inline-flex items-center gap-2 no-print ${confidence.bgColor}`,
                            'data-no-print': 'true'
                          },
                            e('span', { className: confidence.color }, confidence.icon),
                            e('span', { className: `text-sm font-medium ${confidence.color}` },
                              lang === 'de' ? `Bewertungs-Vollst√§ndigkeit: ${confidence.label.de}` 
                                : lang === 'it' ? `Completezza valutazione: ${confidence.label.it}`
                                : `Assessment completeness: ${confidence.label.en}`
                            ),
                            e('span', { className: `text-xs ${confidence.color} opacity-75` }, `(${Math.round(confidence.score)}%)`)
                          );
                        })()
                    )
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partD),
                    e('div', { className: "mb-6" },
                        e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.strengthsProfessional),
                        // MA-Selbstreflexion Hinweis f√ºr St√§rken
                        linkedSelfAssessment && linkedSelfAssessment.formData?.strengths1 && e('div', { 
                          className: 'mb-2 p-3 bg-teal-50 border border-teal-200 rounded-lg text-sm no-print',
                          'data-no-print': 'true',
                          style: { WebkitPrintColorAdjust: 'exact' }
                        },
                          e('div', { className: 'flex items-center gap-2 text-teal-700 font-medium mb-1' },
                            e(Users, { size: 14 }),
                            lang === 'de' ? 'Selbsteinsch√§tzung MA (St√§rken):' : lang === 'it' ? 'Autovalutazione MA (Punti di forza):' : 'Employee Self-Assessment (Strengths):'
                          ),
                          e('p', { 
                            className: 'text-teal-600 text-xs',
                            style: { whiteSpace: 'pre-wrap', wordWrap: 'break-word', wordBreak: 'break-all', overflowWrap: 'break-word' }
                          }, 
                            linkedSelfAssessment.formData.strengths1
                          )
                        ),
                        e('textarea', { 
                          className: `w-full border rounded p-2 text-sm ${(formData.strengths1 || '').length > 1500 ? 'border-amber-400 bg-amber-50' : 'border-slate-300'}`, 
                          rows: 3, 
                          value: formData.strengths1, 
                          onChange: (ev) => handleFormChange('strengths1', ev.target.value) 
                        }),
                        e('label', { className: "block text-sm font-bold mt-4 mb-1 text-slate-700" }, t.strengthsPersonal),
                        // MA-Selbstreflexion Hinweis f√ºr Entwicklungsfelder
                        linkedSelfAssessment && linkedSelfAssessment.formData?.strengths2 && e('div', { 
                          className: 'mb-2 p-3 bg-teal-50 border border-teal-200 rounded-lg text-sm no-print',
                          'data-no-print': 'true',
                          style: { WebkitPrintColorAdjust: 'exact' }
                        },
                          e('div', { className: 'flex items-center gap-2 text-teal-700 font-medium mb-1' },
                            e(Users, { size: 14 }),
                            lang === 'de' ? 'Selbsteinsch√§tzung MA (Entwicklungsfelder):' : lang === 'it' ? 'Autovalutazione MA (Aree di sviluppo):' : 'Employee Self-Assessment (Development Areas):'
                          ),
                          e('p', { 
                            className: 'text-teal-600 text-xs',
                            style: { whiteSpace: 'pre-wrap', wordWrap: 'break-word', wordBreak: 'break-all', overflowWrap: 'break-word' }
                          }, 
                            linkedSelfAssessment.formData.strengths2
                          )
                        ),
                        e('textarea', { 
                          className: 'w-full border rounded p-2 text-sm border-slate-300', 
                          rows: 3, 
                          value: formData.strengths2, 
                          onChange: (ev) => handleFormChange('strengths2', ev.target.value) 
                        })
                    ),
                    // MA-W√ºnsche anzeigen (falls vorhanden)
                    e('h4', { className: "font-bold text-slate-700 mb-2" }, t.development),
                    e('p', { className: "text-xs text-slate-500 mb-2" }, t.devIntro),
                    
                    // === DESKTOP: Tabellen-Ansicht ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm mb-2" },
                            e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, e('th', { className: "p-2 border" }, t.measure), e('th', { className: "p-2 border" }, t.responsible), e('th', { className: "p-2 border" }, t.deadline), e('th', { className: "p-2 border no-print" }, ""))),
                            e('tbody', null, devPlan.map(item => renderDevRow(item)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht ===
                    e('div', { className: 'md:hidden space-y-4' },
                        devPlan.map((item, index) => renderDevCard(item, index))
                    ),
                    
                    e('button', { onClick: () => addItem(devPlan, setDevPlan, {measure:'', responsible:'', deadline:''}), className: "no-print mt-2 text-xs flex items-center gap-1 text-blue-600" }, e(PlusCircle, {size:14}), t.addDev)
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partE),
                    e('p', { className: "text-xs text-slate-500 mb-4" }, t.careerIntro),
                    
                    // === KARRIERE-OPTIONEN MIT √úBERNAHME ===
                    e('div', { className: 'mb-4' },
                      e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, 
                        lang === 'de' ? 'Karriereziele:' : lang === 'it' ? 'Obiettivi di carriera:' : 'Career Goals:'
                      ),
                      // MA-Auswahl anzeigen (falls vorhanden)
                      linkedSelfAssessment?.careerChecks?.some(c => c) && e('div', { 
                        className: 'mb-3 p-3 bg-indigo-50 border border-indigo-200 rounded-lg no-print', 
                        'data-no-print': 'true' 
                      },
                        e('div', { className: 'flex items-center justify-between mb-2' },
                          e('span', { className: 'text-xs font-medium text-indigo-700 flex items-center gap-1' }, 
                            e(Users, { size: 12 }), 
                            lang === 'de' ? 'Auswahl des Mitarbeiters:' : lang === 'it' ? 'Scelta del collaboratore:' : 'Employee Selection:'
                          ),
                          e('button', { 
                            type: 'button',
                            className: 'text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded flex items-center gap-1 transition-colors',
                            onClick: () => setCareerChecks([...linkedSelfAssessment.careerChecks])
                          }, e(Copy, { size: 12 }), lang === 'de' ? '√úbernehmen' : lang === 'it' ? 'Riprendi' : 'Copy')
                        ),
                        e('div', { className: 'flex flex-wrap gap-2' },
                          t.careerOptions.map((opt, idx) => 
                            linkedSelfAssessment.careerChecks[idx] && e('span', { key: idx, className: 'bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full text-xs' },
                              '‚úì ', opt
                            )
                          )
                        )
                      ),
                      // FK-Checkboxen
                      e('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-2" },
                        t.careerOptions.map((opt, i) => 
                          e('label', { key: i, className: `flex items-center gap-2 text-sm p-2 border rounded cursor-pointer hover:bg-slate-50 ${careerChecks[i] ? 'bg-green-50 border-green-300' : ''}` },
                            e('input', { type: "checkbox", checked: careerChecks[i], onChange: () => toggleCareer(i), className: 'w-4 h-4 accent-[#6EBD84]' }), opt
                          )
                        )
                      )
                    ),
                    
                    // === KARRIERE-KOMMENTAR MIT √úBERNAHME ===
                    e('div', { className: 'mb-4' },
                      e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, t.comments),
                      linkedSelfAssessment?.formData?.careerComment && e('div', { 
                        className: 'mb-2 p-3 bg-indigo-50 border border-indigo-200 rounded-lg no-print', 
                        'data-no-print': 'true' 
                      },
                        e('div', { className: 'flex items-center justify-between mb-1' },
                          e('span', { className: 'text-xs font-medium text-indigo-700 flex items-center gap-1' }, 
                            e(Users, { size: 12 }), 
                            lang === 'de' ? 'Kommentar des Mitarbeiters:' : lang === 'it' ? 'Commento del collaboratore:' : 'Employee Comment:'
                          ),
                          e('button', { 
                            type: 'button',
                            className: 'text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded flex items-center gap-1 transition-colors',
                            onClick: () => handleFormChange('careerComment', linkedSelfAssessment.formData.careerComment)
                          }, e(Copy, { size: 12 }), lang === 'de' ? '√úbernehmen' : lang === 'it' ? 'Riprendi' : 'Copy')
                        ),
                        e('p', { className: 'text-indigo-600 text-xs', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all' } }, linkedSelfAssessment.formData.careerComment)
                      ),
                      e('textarea', { 
                        className: "w-full border border-slate-300 rounded p-2 text-sm", 
                        rows: 2, 
                        value: formData.careerComment, 
                        onChange: (ev) => handleFormChange('careerComment', ev.target.value),
                        placeholder: lang === 'de' ? 'Ihre Dokumentation...' : lang === 'it' ? 'La sua documentazione...' : 'Your documentation...'
                      })
                    ),
                    
                    // === W√úNSCHE F√úR KOMMENDES JAHR MIT √úBERNAHME ===
                    e('div', null,
                      e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, 
                        lang === 'de' ? 'W√ºnsche f√ºr das kommende Jahr:' : lang === 'it' ? 'Desideri per il prossimo anno:' : 'Wishes for Next Year:'
                      ),
                      linkedSelfAssessment?.formData?.wishesNextYear && e('div', { 
                        className: 'mb-2 p-3 bg-indigo-50 border border-indigo-200 rounded-lg no-print', 
                        'data-no-print': 'true' 
                      },
                        e('div', { className: 'flex items-center justify-between mb-1' },
                          e('span', { className: 'text-xs font-medium text-indigo-700 flex items-center gap-1' }, 
                            e(Users, { size: 12 }), 
                            lang === 'de' ? 'Antwort des Mitarbeiters:' : lang === 'it' ? 'Risposta del collaboratore:' : 'Employee Response:'
                          ),
                          e('button', { 
                            type: 'button',
                            className: 'text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded flex items-center gap-1 transition-colors',
                            onClick: () => handleFormChange('wishesNextYear', linkedSelfAssessment.formData.wishesNextYear)
                          }, e(Copy, { size: 12 }), lang === 'de' ? '√úbernehmen' : lang === 'it' ? 'Riprendi' : 'Copy')
                        ),
                        e('p', { className: 'text-indigo-600 text-xs', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all' } }, linkedSelfAssessment.formData.wishesNextYear)
                      ),
                      e('textarea', { 
                        className: "w-full border border-slate-300 rounded p-2 text-sm", 
                        rows: 2, 
                        value: formData.wishesNextYear || '', 
                        onChange: (ev) => handleFormChange('wishesNextYear', ev.target.value),
                        placeholder: lang === 'de' ? 'Ihre Dokumentation...' : lang === 'it' ? 'La sua documentazione...' : 'Your documentation...'
                      })
                    )
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partF),
                    e('p', { className: "text-xs text-slate-500 mb-4" }, t.feedbackIntro),
                    // === FREIES FEEDBACK AN FK (falls vorhanden) ===
                    linkedSelfAssessment?.formData?.feedbackManager && e('div', { 
                      className: 'mb-6 p-4 bg-blue-50 border-2 border-blue-300 rounded-xl no-print',
                      'data-no-print': 'true'
                    },
                      e('p', { className: 'text-xs font-bold text-blue-700 mb-2 flex items-center gap-1' }, 
                        e(MessageCircle, { size: 14 }), 
                        lang === 'de' ? 'üí¨ Freies Feedback des Mitarbeiters an Sie:' : lang === 'it' ? 'üí¨ Feedback libero del collaboratore per Lei:' : 'üí¨ Free Feedback from Employee to You:'
                      ),
                      e('p', { className: 'text-blue-600 text-sm bg-white p-3 rounded', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all' } }, linkedSelfAssessment.formData.feedbackManager)
                    ),
                    e('div', { className: "space-y-5" },
                        // === Q1: Unterst√ºtzung ===
                        e('div', { className: 'border-b border-slate-100 pb-4' }, 
                            e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, t.feedbackQ1),
                            linkedSelfAssessment?.formData?.feedbackQ1 && e('div', { className: 'mb-2 p-3 bg-indigo-50 border border-indigo-200 rounded-lg no-print', 'data-no-print': 'true' },
                              e('div', { className: 'flex items-center justify-between mb-1' },
                                e('span', { className: 'text-xs font-medium text-indigo-700 flex items-center gap-1' }, e(Users, { size: 12 }), lang === 'de' ? 'Antwort des Mitarbeiters:' : lang === 'it' ? 'Risposta del collaboratore:' : 'Employee Response:'),
                                e('button', { 
                                  type: 'button',
                                  className: 'text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded flex items-center gap-1 transition-colors',
                                  onClick: () => handleFormChange('feedbackQ1', linkedSelfAssessment.formData.feedbackQ1)
                                }, e(Copy, { size: 12 }), lang === 'de' ? '√úbernehmen' : lang === 'it' ? 'Riprendi' : 'Copy')
                              ),
                              e('p', { className: 'text-indigo-600 text-xs', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all' } }, linkedSelfAssessment.formData.feedbackQ1)
                            ),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ1, onChange: (ev) => handleFormChange('feedbackQ1', ev.target.value), placeholder: lang === 'de' ? 'Ihre Dokumentation...' : lang === 'it' ? 'La sua documentazione...' : 'Your documentation...' })
                        ),
                        // === Q2: Verbesserungsvorschl√§ge ===
                        e('div', { className: 'border-b border-slate-100 pb-4' }, 
                            e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, t.feedbackQ2),
                            linkedSelfAssessment?.formData?.feedbackQ2 && e('div', { className: 'mb-2 p-3 bg-indigo-50 border border-indigo-200 rounded-lg no-print', 'data-no-print': 'true' },
                              e('div', { className: 'flex items-center justify-between mb-1' },
                                e('span', { className: 'text-xs font-medium text-indigo-700 flex items-center gap-1' }, e(Users, { size: 12 }), lang === 'de' ? 'Antwort des Mitarbeiters:' : lang === 'it' ? 'Risposta del collaboratore:' : 'Employee Response:'),
                                e('button', { 
                                  type: 'button',
                                  className: 'text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded flex items-center gap-1 transition-colors',
                                  onClick: () => handleFormChange('feedbackQ2', linkedSelfAssessment.formData.feedbackQ2)
                                }, e(Copy, { size: 12 }), lang === 'de' ? '√úbernehmen' : lang === 'it' ? 'Riprendi' : 'Copy')
                              ),
                              e('p', { className: 'text-indigo-600 text-xs', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all' } }, linkedSelfAssessment.formData.feedbackQ2)
                            ),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ2, onChange: (ev) => handleFormChange('feedbackQ2', ev.target.value), placeholder: lang === 'de' ? 'Ihre Dokumentation...' : lang === 'it' ? 'La sua documentazione...' : 'Your documentation...' })
                        ),
                        // === Q3: Schwierigkeiten ===
                        e('div', { className: 'border-b border-slate-100 pb-4' }, 
                            e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, t.feedbackQ3),
                            linkedSelfAssessment?.formData?.feedbackQ3 && e('div', { className: 'mb-2 p-3 bg-indigo-50 border border-indigo-200 rounded-lg no-print', 'data-no-print': 'true' },
                              e('div', { className: 'flex items-center justify-between mb-1' },
                                e('span', { className: 'text-xs font-medium text-indigo-700 flex items-center gap-1' }, e(Users, { size: 12 }), lang === 'de' ? 'Antwort des Mitarbeiters:' : lang === 'it' ? 'Risposta del collaboratore:' : 'Employee Response:'),
                                e('button', { 
                                  type: 'button',
                                  className: 'text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded flex items-center gap-1 transition-colors',
                                  onClick: () => handleFormChange('feedbackQ3', linkedSelfAssessment.formData.feedbackQ3)
                                }, e(Copy, { size: 12 }), lang === 'de' ? '√úbernehmen' : lang === 'it' ? 'Riprendi' : 'Copy')
                              ),
                              e('p', { className: 'text-indigo-600 text-xs', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all' } }, linkedSelfAssessment.formData.feedbackQ3)
                            ),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ3, onChange: (ev) => handleFormChange('feedbackQ3', ev.target.value), placeholder: lang === 'de' ? 'Ihre Dokumentation...' : lang === 'it' ? 'La sua documentazione...' : 'Your documentation...' })
                        ),
                        // === Q4: Erfolgsmoment ===
                        e('div', { className: 'border-b border-slate-100 pb-4' }, 
                            e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, t.feedbackQ4),
                            linkedSelfAssessment?.formData?.feedbackQ4 && e('div', { className: 'mb-2 p-3 bg-indigo-50 border border-indigo-200 rounded-lg no-print', 'data-no-print': 'true' },
                              e('div', { className: 'flex items-center justify-between mb-1' },
                                e('span', { className: 'text-xs font-medium text-indigo-700 flex items-center gap-1' }, e(Users, { size: 12 }), lang === 'de' ? 'Antwort des Mitarbeiters:' : lang === 'it' ? 'Risposta del collaboratore:' : 'Employee Response:'),
                                e('button', { 
                                  type: 'button',
                                  className: 'text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded flex items-center gap-1 transition-colors',
                                  onClick: () => handleFormChange('feedbackQ4', linkedSelfAssessment.formData.feedbackQ4)
                                }, e(Copy, { size: 12 }), lang === 'de' ? '√úbernehmen' : lang === 'it' ? 'Riprendi' : 'Copy')
                              ),
                              e('p', { className: 'text-indigo-600 text-xs', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all' } }, linkedSelfAssessment.formData.feedbackQ4)
                            ),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ4, onChange: (ev) => handleFormChange('feedbackQ4', ev.target.value), placeholder: lang === 'de' ? 'Ihre Dokumentation...' : lang === 'it' ? 'La sua documentazione...' : 'Your documentation...' })
                        ),
                        // === Q5: Strategiewahrnehmung ===
                        e('div', { className: 'border-b border-slate-100 pb-4' }, 
                            e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, t.feedbackQ5),
                            linkedSelfAssessment?.formData?.feedbackQ5 && e('div', { className: 'mb-2 p-3 bg-indigo-50 border border-indigo-200 rounded-lg no-print', 'data-no-print': 'true' },
                              e('div', { className: 'flex items-center justify-between mb-1' },
                                e('span', { className: 'text-xs font-medium text-indigo-700 flex items-center gap-1' }, e(Users, { size: 12 }), lang === 'de' ? 'Antwort des Mitarbeiters:' : lang === 'it' ? 'Risposta del collaboratore:' : 'Employee Response:'),
                                e('button', { 
                                  type: 'button',
                                  className: 'text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded flex items-center gap-1 transition-colors',
                                  onClick: () => handleFormChange('feedbackQ5', linkedSelfAssessment.formData.feedbackQ5)
                                }, e(Copy, { size: 12 }), lang === 'de' ? '√úbernehmen' : lang === 'it' ? 'Riprendi' : 'Copy')
                              ),
                              e('p', { className: 'text-indigo-600 text-xs', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all' } }, linkedSelfAssessment.formData.feedbackQ5)
                            ),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ5, onChange: (ev) => handleFormChange('feedbackQ5', ev.target.value), placeholder: lang === 'de' ? 'Ihre Dokumentation...' : lang === 'it' ? 'La sua documentazione...' : 'Your documentation...' })
                        ),
                        // === Q6: Projektvorschl√§ge ===
                        e('div', { className: 'border-b border-slate-100 pb-4' }, 
                            e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, t.feedbackQ6),
                            linkedSelfAssessment?.formData?.feedbackQ6 && e('div', { className: 'mb-2 p-3 bg-indigo-50 border border-indigo-200 rounded-lg no-print', 'data-no-print': 'true' },
                              e('div', { className: 'flex items-center justify-between mb-1' },
                                e('span', { className: 'text-xs font-medium text-indigo-700 flex items-center gap-1' }, e(Users, { size: 12 }), lang === 'de' ? 'Antwort des Mitarbeiters:' : lang === 'it' ? 'Risposta del collaboratore:' : 'Employee Response:'),
                                e('button', { 
                                  type: 'button',
                                  className: 'text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded flex items-center gap-1 transition-colors',
                                  onClick: () => handleFormChange('feedbackQ6', linkedSelfAssessment.formData.feedbackQ6)
                                }, e(Copy, { size: 12 }), lang === 'de' ? '√úbernehmen' : lang === 'it' ? 'Riprendi' : 'Copy')
                              ),
                              e('p', { className: 'text-indigo-600 text-xs', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all' } }, linkedSelfAssessment.formData.feedbackQ6)
                            ),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ6, onChange: (ev) => handleFormChange('feedbackQ6', ev.target.value), placeholder: lang === 'de' ? 'Ihre Dokumentation...' : lang === 'it' ? 'La sua documentazione...' : 'Your documentation...' })
                        ),
                        // === Q7: Work-Life-Balance ===
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, t.feedbackQ7),
                            linkedSelfAssessment?.formData?.feedbackQ7 && e('div', { className: 'mb-2 p-3 bg-indigo-50 border border-indigo-200 rounded-lg no-print flex items-center justify-between', 'data-no-print': 'true' },
                              e('span', { className: 'text-xs font-medium text-indigo-700 flex items-center gap-1' }, 
                                e(Users, { size: 12 }), 
                                lang === 'de' ? 'Bewertung des Mitarbeiters:' : lang === 'it' ? 'Valutazione del collaboratore:' : 'Employee Rating:',
                                e('span', { className: 'ml-2 font-bold text-indigo-800' }, '‚≠ê ' + linkedSelfAssessment.formData.feedbackQ7 + '/5')
                              ),
                              e('button', { 
                                type: 'button',
                                className: 'text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded flex items-center gap-1 transition-colors',
                                onClick: () => handleFormChange('feedbackQ7', linkedSelfAssessment.formData.feedbackQ7)
                              }, e(Copy, { size: 12 }), lang === 'de' ? '√úbernehmen' : lang === 'it' ? 'Riprendi' : 'Copy')
                            ),
                            e('div', { className: "flex gap-4" },
                                [1,2,3,4,5].map(n => 
                                    e('label', { key: n, className: "flex items-center gap-1 cursor-pointer" },
                                        e('input', { type: "radio", name: "balance", value: n, checked: formData.feedbackQ7 == n, onChange: (ev) => handleFormChange('feedbackQ7', ev.target.value) }), n
                                    )
                                )
                            )
                        )
                    )
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-8 border-b pb-2" }, t.partH),
                    e('div', { className: "grid grid-cols-2 gap-12" },
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.employee)),
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.manager))
                    )
                )
              )
            );
            } catch (renderError) {
                console.error('AppraisalForm render error:', renderError);
                return e('div', { className: 'p-8 bg-red-50 rounded-xl border-2 border-red-300' },
                    e('h2', { className: 'text-xl font-bold text-red-700 mb-4' }, '‚ö†Ô∏è Fehler beim Laden des Formulars'),
                    e('p', { className: 'text-red-600 mb-2' }, 'Error: ' + renderError.message),
                    e('pre', { className: 'text-xs bg-red-100 p-4 rounded overflow-auto' }, renderError.stack),
                    e('button', { 
                        onClick: onCancel,
                        className: 'mt-4 px-4 py-2 bg-red-600 text-white rounded-lg'
                    }, getText(lang, 'Zur√ºck', 'Indietro', 'Back'))
                );
            }
        };

        // === HELP CHAT / SMART HR COPILOT ===
        // === KNOWLEDGE BASE ===
        const KNOWLEDGE_BASE = {
          // A. Strategie & Werte
          strategy: {
            name: { de: 'Strategie 2035', it: 'Strategia 2035', en: 'Strategy 2035' },
            goal: { de: 'Smartest Solution Provider', it: 'Smartest Solution Provider', en: 'Smartest Solution Provider' },
            description: {
              de: 'Unser Ziel ist die Entwicklung zum "Smartest Solution Provider" bis 2035. Wir setzen auf Innovation, Nachhaltigkeit und exzellente Kundenbeziehungen.',
              it: 'Il nostro obiettivo √® diventare il "Smartest Solution Provider" entro il 2035. Puntiamo su innovazione, sostenibilit√† ed eccellenti relazioni con i clienti.',
              en: 'Our goal is to become the "Smartest Solution Provider" by 2035. We focus on innovation, sustainability, and excellent customer relationships.'
            }
          },
          values: {
            fast: {
              de: { name: 'Fast', desc: 'Wir agieren schnell und l√∂sungsorientiert. Geschwindigkeit ist ein Wettbewerbsvorteil.' },
              it: { name: 'Fast', desc: 'Agiamo velocemente e orientati alle soluzioni. La velocit√† √® un vantaggio competitivo.' },
              en: { name: 'Fast', desc: 'We act quickly and solution-oriented. Speed is a competitive advantage.' }
            },
            fair: {
              de: { name: 'Fair', desc: 'Wir arbeiten respektvoll und auf Augenh√∂he zusammen. Transparenz und Ehrlichkeit sind uns wichtig.' },
              it: { name: 'Fair', desc: 'Lavoriamo con rispetto e alla pari. Trasparenza e onest√† sono importanti per noi.' },
              en: { name: 'Fair', desc: 'We work respectfully and as equals. Transparency and honesty are important to us.' }
            },
            personal: {
              de: { name: 'Personal', desc: 'Wir √ºbernehmen Verantwortung und gestalten aktiv. Jeder Einzelne macht den Unterschied.' },
              it: { name: 'Personal', desc: 'Ci assumiamo responsabilit√† e contribuiamo attivamente. Ogni individuo fa la differenza.' },
              en: { name: 'Personal', desc: 'We take responsibility and actively contribute. Every individual makes a difference.' }
            }
          },
          
          // B. GPS-Formel
          gps: {
            formula: {
              de: 'GPS = (WAS + WIE) √∑ 2',
              it: 'GPS = (COSA + COME) √∑ 2',
              en: 'GPS = (WHAT + HOW) √∑ 2'
            },
            profiles: {
              employee: {
                de: '50% WAS (Ziele) + 50% WIE (5 Kern-Kompetenzen)',
                it: '50% COSA (Obiettivi) + 50% COME (5 Competenze Core)',
                en: '50% WHAT (Goals) + 50% HOW (5 Core Competencies)'
              },
              leader: {
                de: '50% WAS (Ziele) + 25% WIE (Kern) + 25% WIE (Leadership)',
                it: '50% COSA (Obiettivi) + 25% COME (Core) + 25% COME (Leadership)',
                en: '50% WHAT (Goals) + 25% HOW (Core) + 25% HOW (Leadership)'
              }
            },
            ratings: [
              { range: '4.51-5.00', rating: 5, name: { de: 'Outstanding', it: 'Outstanding', en: 'Outstanding' }, consequence: { de: 'Top Bonus / Gehaltssprung', it: 'Top Bonus / Aumento significativo', en: 'Top Bonus / Salary Jump' }},
              { range: '3.51-4.50', rating: 4, name: { de: 'Exceeds Expectations', it: 'Supera le aspettative', en: 'Exceeds Expectations' }, consequence: { de: 'Basis-Bonus / Erh√∂hung', it: 'Bonus base / Aumento', en: 'Base Bonus / Increase' }},
              { range: '2.51-3.50', rating: 3, name: { de: 'Meets Expectations', it: 'Soddisfa le aspettative', en: 'Meets Expectations' }, consequence: { de: 'Baseline / Standard', it: 'Baseline / Standard', en: 'Baseline / Standard' }},
              { range: '1.51-2.50', rating: 2, name: { de: 'Needs Improvement', it: 'Da migliorare', en: 'Needs Improvement' }, consequence: { de: 'PIP / Enge F√ºhrung', it: 'PIP / Supervisione stretta', en: 'PIP / Close Management' }},
              { range: '0.00-1.50', rating: 1, name: { de: 'Does Not Meet', it: 'Non soddisfa', en: 'Does Not Meet' }, consequence: { de: 'Eskalation / HR-Gespr√§ch', it: 'Escalation / Colloquio HR', en: 'Escalation / HR Meeting' }}
            ]
          },
          
          // C. Zielerreichung
          goalAchievement: {
            conversion: [
              { percent: '‚â•130%', score: 5, desc: { de: 'Herausragend √ºbertroffen', it: 'Eccezionalmente superato', en: 'Exceptionally exceeded' }},
              { percent: '111-129%', score: 4, desc: { de: 'Deutlich √ºbertroffen', it: 'Nettamente superato', en: 'Clearly exceeded' }},
              { percent: '90-110%', score: 3, desc: { de: 'Baseline erreicht ‚úì', it: 'Baseline raggiunta ‚úì', en: 'Baseline achieved ‚úì' }},
              { percent: '70-89%', score: 2, desc: { de: 'Teilweise erreicht', it: 'Parzialmente raggiunto', en: 'Partially achieved' }},
              { percent: '<70%', score: 1, desc: { de: 'Nicht erreicht', it: 'Non raggiunto', en: 'Not achieved' }}
            ]
          },
          
          // D. Kompetenzen
          competencies: {
            core: [
              { id: 'c1', key: 'fach', name: { de: 'Fachkompetenz & Anwendung', it: 'Competenza Tecnica', en: 'Technical Expertise' },
                keywords: ['fach', 'technical', 'tecnic', 'expertise', 'wissen', 'knowledge', 'qualit√§t', 'quality', 'prozess'],
                desc: { de: 'Fachwissen, Prozesssicherheit, Qualit√§t, Weitergabe von Wissen. Nicht nur Theorie, sondern praktische Anwendung!', it: 'Conoscenza tecnica, sicurezza dei processi, qualit√†, trasferimento di conoscenze.', en: 'Technical knowledge, process safety, quality, knowledge transfer.' }},
              { id: 'c2', key: 'komm', name: { de: 'Kommunikation & Zusammenarbeit', it: 'Comunicazione & Collaborazione', en: 'Communication & Collaboration' },
                keywords: ['kommunikation', 'communication', 'comunicazione', 'zusammenarbeit', 'collabor', 'team', 'one niederwieser', 'phone before email', 'silo'],
                desc: { de: '"One Niederwieser" Mindset, Silos abbauen, "Phone before Email", proaktiver Informationsfluss.', it: 'Mentalit√† "One Niederwieser", eliminare i silos, "Phone before Email", flusso informativo proattivo.', en: '"One Niederwieser" mindset, breaking silos, "Phone before Email", proactive information flow.' }},
              { id: 'c3', key: 'prob', name: { de: 'Probleml√∂sekompetenz', it: 'Capacit√† di Problem Solving', en: 'Problem Solving' },
                keywords: ['problem', 'l√∂sung', 'solution', 'soluzione', 'root cause', 'ursache', 'troubleshoot', 'analyse', 'analysis'],
                desc: { de: 'Root Cause Analysis statt nur Symptome bek√§mpfen. Eigenst√§ndigkeit bei der L√∂sungsfindung.', it: 'Root Cause Analysis invece di combattere solo i sintomi. Autonomia nella ricerca di soluzioni.', en: 'Root Cause Analysis instead of just fighting symptoms. Independence in finding solutions.' }},
              { id: 'c4', key: 'adapt', name: { de: 'Anpassungsf√§higkeit', it: 'Adattabilit√†', en: 'Adaptability' },
                keywords: ['anpass', 'adapt', 'adatt', 'change', 'ver√§nder', 'cambio', 'growth mindset', 'flexib', 'agil', 'agile', 'neu', 'new'],
                desc: { de: 'Growth Mindset, positiver Umgang mit Ver√§nderung, Bereitschaft neue Tools und Methoden zu lernen.', it: 'Growth Mindset, approccio positivo al cambiamento, disponibilit√† ad apprendere nuovi strumenti.', en: 'Growth Mindset, positive approach to change, willingness to learn new tools and methods.' }},
              { id: 'c5', key: 'orga', name: { de: 'Selbstorganisation', it: 'Auto-organizzazione', en: 'Self-Organization' },
                keywords: ['selbstorganisation', 'self-organiz', 'auto-organiz', 'priorit', 'deadline', 'zuverl√§ss', 'reliab', 'affidabil', 'struktur', 'time management'],
                desc: { de: 'Priorisierung, Einhaltung von Deadlines, Zuverl√§ssigkeit, strukturiertes Arbeiten.', it: 'Prioritizzazione, rispetto delle scadenze, affidabilit√†, lavoro strutturato.', en: 'Prioritization, meeting deadlines, reliability, structured work.' }}
            ],
            leadership: [
              { id: 'l1', key: 'lead', name: { de: 'Mitarbeiterf√ºhrung', it: 'Gestione Personale', en: 'People Management' },
                keywords: ['mitarbeiterf√ºhrung', 'people management', 'gestione personale', 'coaching', 'feedback', 'entwicklung', 'development', 'sviluppo', 'empower', 'delegation'],
                desc: { de: 'Coaching, regelm√§√üiges Feedback, Entwicklung f√∂rdern, Empowerment durch Delegation.', it: 'Coaching, feedback regolare, promuovere lo sviluppo, empowerment attraverso la delega.', en: 'Coaching, regular feedback, fostering development, empowerment through delegation.' }},
              { id: 'l2', key: 'strat', name: { de: 'Strategisches Denken', it: 'Pensiero Strategico', en: 'Strategic Thinking' },
                keywords: ['strateg', 'big picture', 'langfrist', 'long-term', 'lungo termine', 'trend', 'vision', 'zukunft', 'future', 'futuro'],
                desc: { de: 'Big Picture verstehen, langfristige Planung, Trends erkennen und antizipieren.', it: 'Capire il Big Picture, pianificazione a lungo termine, riconoscere e anticipare i trend.', en: 'Understanding the Big Picture, long-term planning, recognizing and anticipating trends.' }},
              { id: 'l3', key: 'decide', name: { de: 'Entscheidungsf√§higkeit', it: 'Capacit√† Decisionale', en: 'Decision Making' },
                keywords: ['entscheid', 'decision', 'decis', 'mut', 'courage', 'coraggio', 'risiko', 'risk', 'rischio', 'geschwindigkeit', 'speed'],
                desc: { de: 'Mut (Courage), schnelle Entscheidungen, kalkuliertes Risiko-Management.', it: 'Coraggio, decisioni rapide, gestione calcolata del rischio.', en: 'Courage, quick decisions, calculated risk management.' }},
              { id: 'l4', key: 'exec', name: { de: 'Execution', it: 'Execution', en: 'Execution' },
                keywords: ['execution', 'umsetz', 'implement', 'kpi', 'performance', 'ergebnis', 'result', 'risultato', 'deliver'],
                desc: { de: 'KPIs definieren und tracken, konsequente Umsetzung, Performance-Kultur etablieren.', it: 'Definire e tracciare KPI, implementazione coerente, stabilire una cultura della performance.', en: 'Defining and tracking KPIs, consistent implementation, establishing performance culture.' }},
              { id: 'l5', key: 'stake', name: { de: 'Stakeholder-Management', it: 'Gestione Stakeholder', en: 'Stakeholder Management' },
                keywords: ['stakeholder', 'konflikt', 'conflict', 'conflitto', 'netzwerk', 'network', 'rete', 'diplomat', 'verhandl', 'negotiat', 'negozia'],
                desc: { de: 'Konfliktl√∂sung, Netzwerke aufbauen und pflegen, diplomatisches Geschick.', it: 'Risoluzione dei conflitti, costruire e mantenere reti, abilit√† diplomatica.', en: 'Conflict resolution, building and maintaining networks, diplomatic skills.' }}
            ]
          },
          
          // E. Kalibrierung & Archetypen (mit psychologisch fundierten F√ºhrungsempfehlungen)
          calibration: {
            archetypes: {
              roleModel: { 
                name: { de: 'Role Model', it: 'Role Model', en: 'Role Model' }, 
                desc: { 
                  de: 'High WAS + High WIE. Vorbild & Leistungstr√§ger. ‚Üí Karriereperspektive kl√§ren, als Mentor einsetzen, Retention sichern!', 
                  it: 'High COSA + High COME. Modello & top performer. ‚Üí Chiarire prospettive, usare come mentor, assicurare retention!', 
                  en: 'High WHAT + High HOW. Role model & top performer. ‚Üí Clarify career path, deploy as mentor, secure retention!' 
                }
              },
              hiddenGem: { 
                name: { de: 'Hidden Gem', it: 'Hidden Gem', en: 'Hidden Gem' }, 
                desc: { 
                  de: 'Low WAS + High WIE. Tolles Verhalten, Ziele unklar. ‚Üí SMART-Ziele setzen, Quick Wins erm√∂glichen, Selbstwirksamkeit st√§rken!', 
                  it: 'Low COSA + High COME. Ottimo comportamento, obiettivi poco chiari. ‚Üí Obiettivi SMART, quick wins, rafforzare autoefficacia!', 
                  en: 'Low WHAT + High HOW. Great behavior, unclear goals. ‚Üí Set SMART goals, enable quick wins, boost self-efficacy!' 
                }
              },
              soloStar: { 
                name: { de: 'Solo Star', it: 'Solo Star', en: 'Solo Star' }, 
                desc: { 
                  de: 'High WAS + Low WIE. Ergebnisse top, Verhalten kritisch. ‚Üí Feedback zu Wirkung geben, Konsequenzen aufzeigen, Verhaltenscoaching!', 
                  it: 'High COSA + Low COME. Risultati top, comportamento critico. ‚Üí Feedback su impatto, mostrare conseguenze, coaching comportamentale!', 
                  en: 'High WHAT + Low HOW. Top results, critical behavior. ‚Üí Feedback on impact, show consequences, behavioral coaching!' 
                }
              },
              actionRequired: { 
                name: { de: 'Handlungsbedarf', it: 'Azione Richiesta', en: 'Action Required' }, 
                desc: { 
                  de: 'Low WAS + Low WIE. ‚Üí Ursache kl√§ren (K√∂nnen/Wollen/D√ºrfen), 90-Tage-Plan, w√∂chentliche Check-ins, Rollenpassung pr√ºfen.', 
                  it: 'Low COSA + Low COME. ‚Üí Chiarire causa (capacit√†/volont√†/contesto), piano 90 giorni, check-in settimanali, verificare ruolo.', 
                  en: 'Low WHAT + Low HOW. ‚Üí Clarify root cause (skill/will/context), 90-day plan, weekly check-ins, review role fit.' 
                }
              },
              solidBackbone: { 
                name: { de: 'Solid Backbone', it: 'Solid Backbone', en: 'Solid Backbone' }, 
                desc: { 
                  de: 'Rating 3 ‚Äì das R√ºckgrat! ‚Üí Wertsch√§tzung zeigen, nicht nur "Stars" loben. Stabilit√§t anerkennen, individuelle St√§rken nutzen.', 
                  it: 'Rating 3 ‚Äì la spina dorsale! ‚Üí Mostrare apprezzamento, non solo le "star". Riconoscere stabilit√†, usare punti di forza.', 
                  en: 'Rating 3 ‚Äì the backbone! ‚Üí Show appreciation, not just "stars". Recognize stability, leverage individual strengths.' 
                }
              }
            },
            killerCriteria: {
              de: 'Killer Criteria Warnung: Wenn GPS > 2.5, aber "Kommunikation" ODER "Mitarbeiterf√ºhrung" auf Level 1 bewertet wurde. Diese Kompetenzen sind kulturkritisch!',
              it: 'Avviso Killer Criteria: Se GPS > 2.5, ma "Comunicazione" O "Gestione Personale" √® valutata al livello 1. Queste competenze sono critiche per la cultura!',
              en: 'Killer Criteria Warning: If GPS > 2.5, but "Communication" OR "People Management" is rated at level 1. These competencies are culture-critical!'
            }
          }
        };
        
        // === WORKFLOW ANSWERS - Deep App Knowledge ===
        const WORKFLOW_ANSWERS = {
          selfReflection: {
            de: {
              title: 'üìù Selbstreflexion starten',
              text: `**So funktioniert's:**

1. Gehe zu **"Team-√úbersicht"** in der Navigation
2. Klicke beim Mitarbeiter auf **"üîó Selbstreflexions-Link erstellen"**
3. Der Link wird automatisch in die Zwischenablage kopiert
4. Sende den Link per E-Mail oder Teams an den MA

**Erinnerung senden:**
‚Ä¢ Klicke auf den **"Erinnern"**-Button beim eingeladenen MA
‚Ä¢ Der Link wird erneut kopiert ‚Äì sende ihn nochmals

**Wichtig:**
‚Ä¢ Der MA kann den Link **ohne Login** √∂ffnen
‚Ä¢ Er sieht NUR seine eigene Selbsteinsch√§tzung
‚Ä¢ Die Ergebnisse erscheinen automatisch in deiner Bewertung`
            },
            it: {
              title: 'üìù Avviare autovalutazione',
              text: `**Come funziona:**

1. Vai a **"Panoramica team"** nella navigazione
2. Clicca su **"üîó Crea link autovalutazione"** per il collaboratore
3. Il link viene copiato automaticamente negli appunti
4. Invia il link via email o Teams al collaboratore

**Inviare promemoria:**
‚Ä¢ Clicca sul pulsante **"Ricorda"** per il collaboratore invitato
‚Ä¢ Il link viene ricopiato ‚Äì invialo di nuovo

**Importante:**
‚Ä¢ Il collaboratore pu√≤ aprire il link **senza login**
‚Ä¢ Vede SOLO la sua autovalutazione
‚Ä¢ I risultati appaiono automaticamente nella tua valutazione`
            },
            en: {
              title: 'üìù Start Self-Reflection',
              text: `**How it works:**

1. Go to **"My Team"** in the navigation
2. Click **"üîó Create self-reflection link"** for the employee
3. The link is automatically copied to clipboard
4. Send the link via email or Teams to the employee

**Send reminder:**
‚Ä¢ Click the **"Remind"** button for the invited employee
‚Ä¢ The link is copied again ‚Äì send it once more

**Important:**
‚Ä¢ The employee can open the link **without login**
‚Ä¢ They see ONLY their self-assessment
‚Ä¢ Results automatically appear in your appraisal

üí° If an email is on file, you can also use the üìß button.`
            }
          },
          
          saveDraftVsComplete: {
            de: {
              title: 'üíæ Entwurf vs. Abschlie√üen',
              text: `**"Als Entwurf speichern" (üíæ):**
‚Ä¢ Speichert den aktuellen Stand
‚Ä¢ Bleibt **editierbar**
‚Ä¢ GPS wird vorl√§ufig berechnet
‚Ä¢ Ideal f√ºr mehrt√§gige Bewertungen

**"Bewertung abschlie√üen" (‚úÖ):**
‚Ä¢ **Fixiert** die Bewertung endg√ºltig
‚Ä¢ Berechnet den finalen GPS-Score
‚Ä¢ Danach ist **keine √Ñnderung** mehr m√∂glich
‚Ä¢ Wird in HR-Reports aufgenommen

‚ö†Ô∏è Erst abschlie√üen, wenn das Feedbackgespr√§ch gef√ºhrt wurde!`
            },
            it: {
              title: 'üíæ Bozza vs. Completare',
              text: `**"Salva come bozza" (üíæ):**
‚Ä¢ Salva lo stato attuale
‚Ä¢ Rimane **modificabile**
‚Ä¢ GPS calcolato provvisoriamente
‚Ä¢ Ideale per valutazioni su pi√π giorni

**"Completa valutazione" (‚úÖ):**
‚Ä¢ **Fissa** la valutazione definitivamente
‚Ä¢ Calcola il GPS finale
‚Ä¢ Dopo **non √® pi√π modificabile**
‚Ä¢ Viene inclusa nei report HR

‚ö†Ô∏è Completa solo dopo il colloquio di feedback!`
            },
            en: {
              title: 'üíæ Draft vs. Complete',
              text: `**"Save as Draft" (üíæ):**
‚Ä¢ Saves current progress
‚Ä¢ Remains **editable**
‚Ä¢ GPS calculated provisionally
‚Ä¢ Ideal for multi-day evaluations

**"Complete Appraisal" (‚úÖ):**
‚Ä¢ **Locks** the appraisal permanently
‚Ä¢ Calculates final GPS score
‚Ä¢ **No changes** possible afterwards
‚Ä¢ Included in HR reports

‚ö†Ô∏è Only complete after the feedback conversation!`
            }
          },
          
          excelExport: {
            de: {
              title: 'üìä Excel Export',
              text: `**So exportierst du alle Daten:**

1. Gehe zum **HR Dashboard** (nur f√ºr HR-Admins)
2. Klicke auf **"üìä Excel Export"**
3. Eine CSV-Datei wird heruntergeladen

**Enthaltene Daten:**
‚Ä¢ Alle Mitarbeiter mit GPS, WAS, WIE Scores
‚Ä¢ Einzelne Kompetenz-Scores (C1-C5, L1-L5)
‚Ä¢ Freitexte: St√§rken, Karriere-Kommentar, W√ºnsche
‚Ä¢ Feedback an FK
‚Ä¢ Status (Entwurf/Fertig) und Zeitstempel

üí° Die CSV √∂ffnet sich direkt in Excel mit korrekten Umlauten.`
            },
            it: {
              title: 'üìä Export Excel',
              text: `**Come esportare tutti i dati:**

1. Vai alla **Dashboard HR** (solo per admin HR)
2. Clicca su **"üìä Esporta Excel"**
3. Viene scaricato un file CSV

**Dati inclusi:**
‚Ä¢ Tutti i collaboratori con GPS, COSA, COME Scores
‚Ä¢ Singoli punteggi competenze (C1-C5, L1-L5)
‚Ä¢ Testi liberi: Punti di forza, Commento carriera, Desideri
‚Ä¢ Feedback al responsabile
‚Ä¢ Stato (Bozza/Completato) e timestamp

üí° Il CSV si apre direttamente in Excel con caratteri corretti.`
            },
            en: {
              title: 'üìä Excel Export',
              text: `**How to export all data:**

1. Go to **HR Dashboard** (HR admins only)
2. Click **"üìä Excel Export"**
3. A CSV file will download

**Included data:**
‚Ä¢ All employees with GPS, WHAT, HOW scores
‚Ä¢ Individual competency scores (C1-C5, L1-L5)
‚Ä¢ Free text: Strengths, Career comment, Wishes
‚Ä¢ Feedback to manager
‚Ä¢ Status (Draft/Complete) and timestamps

üí° The CSV opens directly in Excel with correct characters.`
            }
          },
          
          statusColors: {
            de: {
              title: 'üö¶ Status-Farben erkl√§rt',
              text: `**In der Team-√úbersicht:**

üü¢ **Gr√ºn** = Bewertung abgeschlossen
üü° **Gelb** = Entwurf vorhanden (in Arbeit)
‚ö™ **Grau** = Noch keine Bewertung gestartet

**In der Kalibrierung (9-Box):**

üü¢ **Gr√ºne Bubble** = Rating 4-5 (Top Performer)
üîµ **Blaue gestrichelte Zone** = Solid Backbone (Rating 3)
üü† **Orange Bubble** = Rating 2 (Entwicklungsbedarf)
üî¥ **Rote Bubble** = Rating 1 (Handlungsbedarf)

üí° Bubble-Gr√∂√üe = GPS-Score (gr√∂√üer = h√∂her)`
            },
            it: {
              title: 'üö¶ Colori di stato spiegati',
              text: `**Nella panoramica team:**

üü¢ **Verde** = Valutazione completata
üü° **Giallo** = Bozza presente (in corso)
‚ö™ **Grigio** = Nessuna valutazione iniziata

**Nella calibrazione (9-Box):**

üü¢ **Bolla verde** = Rating 4-5 (Top Performer)
üîµ **Zona tratteggiata blu** = Solid Backbone (Rating 3)
üü† **Bolla arancione** = Rating 2 (Da sviluppare)
üî¥ **Bolla rossa** = Rating 1 (Azione richiesta)

üí° Dimensione bolla = GPS Score (pi√π grande = pi√π alto)`
            },
            en: {
              title: 'üö¶ Status Colors Explained',
              text: `**In team overview:**

üü¢ **Green** = Appraisal completed
üü° **Yellow** = Draft exists (in progress)
‚ö™ **Gray** = No appraisal started yet

**In calibration (9-Box):**

üü¢ **Green bubble** = Rating 4-5 (Top Performer)
üîµ **Blue dashed zone** = Solid Backbone (Rating 3)
üü† **Orange bubble** = Rating 2 (Development needed)
üî¥ **Red bubble** = Rating 1 (Action required)

üí° Bubble size = GPS score (larger = higher)`
            }
          },
          
          barsLevels: {
            de: {
              title: 'üìè BARS-Level erkl√§rt',
              text: `**Die 5 Bewertungsstufen:**

**Level 1** ‚ùå Ungen√ºgend
Grundanforderungen nicht erf√ºllt

**Level 2** ‚ö†Ô∏è Verbesserungsw√ºrdig  
Routine ok, bei Spezialf√§llen Probleme

**Level 3** ‚úÖ Erf√ºllt Erwartungen (BASELINE)
Konstant gute Leistung - DAS IST DER STANDARD!

**Level 4** ‚≠ê √úbertrifft Erwartungen
Proaktiv, "Go-to-Person" im Team

**Level 5** üèÜ Herausragend
Gruppenweiter Impact, Rollenmodell

üí° Level 3 ist KEINE schlechte Bewertung - es ist die Baseline!`
            },
            it: {
              title: 'üìè Livelli BARS spiegati',
              text: `**I 5 livelli di valutazione:**

**Livello 1** ‚ùå Insufficiente
Requisiti base non soddisfatti

**Livello 2** ‚ö†Ô∏è Da migliorare
Routine ok, problemi con casi speciali

**Livello 3** ‚úÖ Soddisfa le aspettative (BASELINE)
Performance costante - QUESTO √à LO STANDARD!

**Livello 4** ‚≠ê Supera le aspettative
Proattivo, "Go-to-Person" nel team

**Livello 5** üèÜ Eccellente
Impatto di gruppo, Role Model

üí° Livello 3 NON √® una valutazione negativa - √® la baseline!`
            },
            en: {
              title: 'üìè BARS Levels Explained',
              text: `**The 5 rating levels:**

**Level 1** ‚ùå Unsatisfactory
Basic requirements not met

**Level 2** ‚ö†Ô∏è Needs Improvement
Routine ok, problems with special cases

**Level 3** ‚úÖ Meets Expectations (BASELINE)
Consistent good performance - THIS IS THE STANDARD!

**Level 4** ‚≠ê Exceeds Expectations
Proactive, "Go-to-Person" in team

**Level 5** üèÜ Outstanding
Group-wide impact, Role Model

üí° Level 3 is NOT a bad rating - it's the baseline!`
            }
          },
          
          nineBox: {
            de: {
              title: 'üìä 9-Box Grid erkl√§rt',
              text: `**Das Bubble Chart zeigt 4 Quadranten:**

**Oben rechts** ‚≠ê Role Model
High WAS + High WIE
‚Üí Bef√∂rdern, als Mentor einsetzen

**Oben links** üíé Hidden Gem  
Low WAS + High WIE
‚Üí Klarere Ziele setzen

**Unten rechts** üéØ Solo Star
High WAS + Low WIE
‚Üí Verhaltens-Coaching

**Unten links** üö® Handlungsbedarf
Low WAS + Low WIE
‚Üí PIP oder Rollenpassung pr√ºfen

**Mitte (gestrichelt)** üîµ Solid Backbone
Das stabile R√ºckgrat - Wertsch√§tzung zeigen!`
            },
            it: {
              title: 'üìä 9-Box Grid spiegato',
              text: `**Il Bubble Chart mostra 4 quadranti:**

**In alto a destra** ‚≠ê Role Model
High COSA + High COME
‚Üí Promuovere, usare come mentore

**In alto a sinistra** üíé Hidden Gem
Low COSA + High COME
‚Üí Obiettivi pi√π chiari

**In basso a destra** üéØ Solo Star
High COSA + Low COME
‚Üí Coaching comportamentale

**In basso a sinistra** üö® Azione richiesta
Low COSA + Low COME
‚Üí PIP o verificare ruolo

**Centro (tratteggiato)** üîµ Solid Backbone
Spina dorsale stabile - Mostrare apprezzamento!`
            },
            en: {
              title: 'üìä 9-Box Grid Explained',
              text: `**The Bubble Chart shows 4 quadrants:**

**Top right** ‚≠ê Role Model
High WHAT + High HOW
‚Üí Promote, use as mentor

**Top left** üíé Hidden Gem
Low WHAT + High HOW
‚Üí Set clearer goals

**Bottom right** üéØ Solo Star
High WHAT + Low HOW
‚Üí Behavioral coaching

**Bottom left** üö® Action Required
Low WHAT + Low HOW
‚Üí PIP or review role fit

**Center (dashed)** üîµ Solid Backbone
Stable backbone - Show appreciation!`
            }
          },
          
          smartGoals: {
            de: {
              title: 'üéØ SMART Ziele',
              text: `**Gute Ziele sind SMART:**

**S**pezifisch
Was genau soll erreicht werden?

**M**essbar  
Wie wird Erfolg gemessen? (KPI, %)

**A**ttraktiv
Ist das Ziel motivierend?

**R**ealistisch
Ist es erreichbar mit den Ressourcen?

**T**erminiert
Bis wann? (Deadline)

**Beispiel:**
‚ùå "Umsatz steigern"
‚úÖ "Umsatz in Q2 um 10% steigern durch 5 Neukunden"`
            },
            it: {
              title: 'üéØ Obiettivi SMART',
              text: `**Buoni obiettivi sono SMART:**

**S**pecifico
Cosa deve essere raggiunto esattamente?

**M**isurabile
Come viene misurato il successo? (KPI, %)

**A**ccettabile
L'obiettivo √® motivante?

**R**ealistico
√à raggiungibile con le risorse?

**T**emporizzato
Entro quando? (Scadenza)

**Esempio:**
‚ùå "Aumentare il fatturato"
‚úÖ "Aumentare il fatturato del 10% in Q2 con 5 nuovi clienti"`
            },
            en: {
              title: 'üéØ SMART Goals',
              text: `**Good goals are SMART:**

**S**pecific
What exactly should be achieved?

**M**easurable
How is success measured? (KPI, %)

**A**chievable
Is the goal motivating?

**R**ealistic
Is it achievable with resources?

**T**ime-bound
By when? (Deadline)

**Example:**
‚ùå "Increase sales"
‚úÖ "Increase Q2 sales by 10% through 5 new customers"`
            }
          },
          
          goalWeighting: {
            de: {
              title: '‚öñÔ∏è Ziel-Gewichtung',
              text: `**So funktioniert die Gewichtung:**

‚Ä¢ Jedes Ziel erh√§lt eine Gewichtung (%)
‚Ä¢ Alle Gewichtungen m√ºssen **100%** ergeben
‚Ä¢ Die Zielerreichung wird gewichtet verrechnet

**Beispiel:**
Ziel 1: 50% Gewichtung, 120% erreicht ‚Üí 60 Punkte
Ziel 2: 30% Gewichtung, 100% erreicht ‚Üí 30 Punkte  
Ziel 3: 20% Gewichtung, 80% erreicht ‚Üí 16 Punkte
**Gesamt: 106%** ‚Üí Score 3-4

üí° Wichtigere Ziele h√∂her gewichten!`
            },
            it: {
              title: '‚öñÔ∏è Ponderazione obiettivi',
              text: `**Come funziona la ponderazione:**

‚Ä¢ Ogni obiettivo riceve una ponderazione (%)
‚Ä¢ Tutte le ponderazioni devono sommare a **100%**
‚Ä¢ Il raggiungimento viene calcolato ponderato

**Esempio:**
Obiettivo 1: 50% peso, 120% raggiunto ‚Üí 60 punti
Obiettivo 2: 30% peso, 100% raggiunto ‚Üí 30 punti
Obiettivo 3: 20% peso, 80% raggiunto ‚Üí 16 punti
**Totale: 106%** ‚Üí Score 3-4

üí° Ponderare di pi√π gli obiettivi pi√π importanti!`
            },
            en: {
              title: '‚öñÔ∏è Goal Weighting',
              text: `**How weighting works:**

‚Ä¢ Each goal gets a weight (%)
‚Ä¢ All weights must total **100%**
‚Ä¢ Achievement is calculated weighted

**Example:**
Goal 1: 50% weight, 120% achieved ‚Üí 60 points
Goal 2: 30% weight, 100% achieved ‚Üí 30 points
Goal 3: 20% weight, 80% achieved ‚Üí 16 points
**Total: 106%** ‚Üí Score 3-4

üí° Weight more important goals higher!`
            }
          }
        };
        
        // === SUGGESTED CHIPS per View ===
        const VIEW_CHIPS = {
          team: [
            { de: 'üîó Link generieren?', it: 'üîó Generare link?', en: 'üîó Generate link?', query: 'selbstreflexion link' },
            { de: '‚ûï Neuer MA', it: '‚ûï Nuovo collab.', en: '‚ûï New employee', query: 'mitarbeiter anlegen' },
            { de: 'üö¶ Status Farben', it: 'üö¶ Colori stato', en: 'üö¶ Status colors', query: 'status farben' }
          ],
          zielvereinbarung: [
            { de: 'üéØ SMART Ziele', it: 'üéØ Obiettivi SMART', en: 'üéØ SMART Goals', query: 'smart ziele' },
            { de: '‚öñÔ∏è Gewichtung', it: '‚öñÔ∏è Ponderazione', en: '‚öñÔ∏è Weighting', query: 'gewichtung' },
            { de: 'üí∞ Bonus?', it: 'üí∞ Bonus?', en: 'üí∞ Bonus?', query: 'bonus gehalt' }
          ],
          teamcalibration: [
            { de: 'üìä 4 Quadranten', it: 'üìä 4 Quadranti', en: 'üìä 4 Quadrants', query: '9 box grid' },
            { de: 'üîµ Solid Backbone', it: 'üîµ Solid Backbone', en: 'üîµ Solid Backbone', query: 'solid backbone' },
            { de: '‚ö†Ô∏è Warnungen?', it: '‚ö†Ô∏è Avvisi?', en: '‚ö†Ô∏è Warnings?', query: 'killer criteria' }
          ],
          formular: [
            { de: 'üìè BARS Level', it: 'üìè Livelli BARS', en: 'üìè BARS Levels', query: 'bars level' },
            { de: 'üíæ Entwurf?', it: 'üíæ Bozza?', en: 'üíæ Draft?', query: 'entwurf speichern' },
            { de: 'üìä GPS Formel', it: 'üìä Formula GPS', en: 'üìä GPS Formula', query: 'gps formel' }
          ],
          dashboard: [
            { de: 'üöÄ Schnellstart', it: 'üöÄ Avvio rapido', en: 'üöÄ Quick start', query: 'wie starte ich' },
            { de: 'üìä GPS erkl√§rt', it: 'üìä GPS spiegato', en: 'üìä GPS explained', query: 'gps' },
            { de: 'üéØ Kompetenzen', it: 'üéØ Competenze', en: 'üéØ Competencies', query: 'kompetenzen √ºbersicht' }
          ],
          hrdashboard: [
            { de: 'üìä Excel Export', it: 'üìä Export Excel', en: 'üìä Excel Export', query: 'excel export' },
            { de: 'üìà Kalibrierung', it: 'üìà Calibrazione', en: 'üìà Calibration', query: 'kalibrierung' },
            { de: '‚ö†Ô∏è Killer Criteria', it: '‚ö†Ô∏è Killer Criteria', en: '‚ö†Ô∏è Killer Criteria', query: 'killer criteria' }
          ]
        };
        
        function HelpChat({ lang, setActiveView, activeView, setSelectedCompetencyId }) {
          const [isOpen, setIsOpen] = useState(false);
          const [messages, setMessages] = useState([]);
          const [inputValue, setInputValue] = useState('');
          const [isTyping, setIsTyping] = useState(false);
          const messagesEndRef = React.useRef(null);
          
          // Scroll to bottom when new messages arrive
          React.useEffect(() => {
            if (messagesEndRef.current) {
              messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
            }
          }, [messages]);
          
          // Kontextsensitive Willkommensnachricht
          const getWelcomeMessage = () => {
            const contextMsg = {
              team: { de: 'Du bist im Team-Bereich. Brauchst du Hilfe beim Einladen oder Link erstellen?', it: 'Sei nella sezione team. Hai bisogno di aiuto per invitare o creare link?', en: 'You\'re in the team section. Need help inviting or creating links?' },
              formular: { de: 'Du f√ºllst gerade eine Bewertung aus. Frag mich zu den BARS-Leveln!', it: 'Stai compilando una valutazione. Chiedimi dei livelli BARS!', en: 'You\'re filling out an appraisal. Ask me about BARS levels!' },
              teamcalibration: { de: 'Willkommen zur Kalibrierung! Ich erkl√§re dir gerne das 9-Box Grid.', it: 'Benvenuto alla calibrazione! Ti spiego volentieri il 9-Box Grid.', en: 'Welcome to calibration! I\'ll gladly explain the 9-Box Grid.' },
              zielvereinbarung: { de: 'Du bist bei den Zielen. Soll ich SMART erkl√§ren?', it: 'Sei negli obiettivi. Devo spiegare SMART?', en: 'You\'re in goals. Shall I explain SMART?' },
              hrdashboard: { de: 'Du bist im HR Dashboard. Ich kann dir beim Export helfen!', it: 'Sei nella Dashboard HR. Posso aiutarti con l\'export!', en: 'You\'re in the HR Dashboard. I can help with exports!' }
            };
            
            const context = contextMsg[activeView];
            const baseMsg = {
              de: 'üëã Hallo! Ich bin dein HR-Copilot.\n\n',
              it: 'üëã Ciao! Sono il tuo HR-Copilot.\n\n',
              en: 'üëã Hello! I\'m your HR Copilot.\n\n'
            };
            
            if (context) {
              return baseMsg[lang] + context[lang];
            }
            
            return baseMsg[lang] + (lang === 'de' 
              ? 'Ich kenne die App in- und auswendig. Frag mich zu:\n‚Ä¢ Workflows (Selbstreflexion, Speichern)\n‚Ä¢ GPS-Berechnung & BARS-Level\n‚Ä¢ Kompetenzen & Archetypen'
              : lang === 'it' ? 'Conosco l\'app a fondo. Chiedimi di:\n‚Ä¢ Workflow (Autovalutazione, Salvare)\n‚Ä¢ Calcolo GPS & Livelli BARS\n‚Ä¢ Competenze & Archetipi'
              : 'I know the app inside out. Ask me about:\n‚Ä¢ Workflows (Self-reflection, Saving)\n‚Ä¢ GPS calculation & BARS levels\n‚Ä¢ Competencies & Archetypes');
          };
          
          // Initial welcome message
          React.useEffect(() => {
            if (isOpen && messages.length === 0) {
              setMessages([{ type: 'bot', text: getWelcomeMessage(), actions: getQuickActions() }]);
            }
          }, [isOpen, activeView]);
          
          // Reset chat
          const resetChat = () => {
            setMessages([{ type: 'bot', text: getWelcomeMessage(), actions: getQuickActions() }]);
          };
          
          // Quick Actions
          const getQuickActions = () => [
            { label: lang === 'de' ? 'üìä GPS' : lang === 'it' ? 'üìä GPS' : 'üìä GPS', action: () => handleQuickAction('gps formel') },
            { label: lang === 'de' ? 'üìù Workflow' : lang === 'it' ? 'üìù Workflow' : 'üìù Workflow', action: () => handleQuickAction('prozess workflow') },
            { label: lang === 'de' ? 'üéØ Kompetenzen' : lang === 'it' ? 'üéØ Competenze' : 'üéØ Competencies', action: () => handleQuickAction('kompetenzen √ºbersicht') }
          ];
          
          // Get chips for current view
          const getCurrentChips = () => {
            return VIEW_CHIPS[activeView] || VIEW_CHIPS.dashboard;
          };
          
          const handleQuickAction = (query) => {
            setInputValue('');
            const userMsg = { type: 'user', text: query };
            setMessages(prev => [...prev, userMsg]);
            setIsTyping(true);
            
            setTimeout(() => {
              const response = analyzeInput(query);
              setMessages(prev => [...prev, { type: 'bot', text: response.text, actions: response.actions }]);
              setIsTyping(false);
            }, 600);
          };
          
          // Smart Brain - Analyze input with Workflow Knowledge
          const analyzeInput = (text) => {
            const input = text.toLowerCase().trim();
            const KB = KNOWLEDGE_BASE;
            const WF = WORKFLOW_ANSWERS;
            
            // === WORKFLOW: SELBSTREFLEXION ===
            if (input.match(/selbstreflexion|self.?reflect|autovalutazione|link.*send|link.*erst|einlad|invit|mitarbeiter.*perspektive/)) {
              const ans = WF.selfReflection[lang] || WF.selfReflection.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? 'üë• Zum Team' : lang === 'it' ? 'üë• Vai al team' : 'üë• Go to Team', action: () => { setActiveView('teamoverview'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: ENTWURF VS ABSCHLIESSEN ===
            if (input.match(/entwurf|draft|bozza|speicher.*unterschied|abschlie|complet|finaliz|status.*unterschied/)) {
              const ans = WF.saveDraftVsComplete[lang] || WF.saveDraftVsComplete.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === WORKFLOW: EXCEL EXPORT ===
            if (input.match(/excel|export|csv|download|herunterlad|scarica/)) {
              const ans = WF.excelExport[lang] || WF.excelExport.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? 'HR Dashboard' : lang === 'it' ? 'Dashboard HR' : 'HR Dashboard', action: () => { setActiveView('hrdashboard'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: STATUS FARBEN ===
            if (input.match(/status.*farb|color|colori|ampel|gr√ºn|gelb|rot|verde|giallo|rosso|green|yellow|red/)) {
              const ans = WF.statusColors[lang] || WF.statusColors.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === WORKFLOW: BARS LEVEL ===
            if (input.match(/bars|level|stufe|livello|bewertungsstufe|1-5|skala|scala|scale|baseline/)) {
              const ans = WF.barsLevels[lang] || WF.barsLevels.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === WORKFLOW: 9-BOX GRID ===
            if (input.match(/9.?box|nine.?box|quadrant|bubble.*chart|grid|verteilung|distribu/)) {
              const ans = WF.nineBox[lang] || WF.nineBox.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? 'üìä Zur Kalibrierung' : lang === 'it' ? 'üìä Vai alla calibrazione' : 'üìä Go to Calibration', action: () => { setActiveView('teamcalibration'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: SMART ZIELE ===
            if (input.match(/smart|ziel.*setzen|obiettiv.*definir|goal.*set/)) {
              const ans = WF.smartGoals[lang] || WF.smartGoals.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? 'üìã Zielvereinbarung' : lang === 'it' ? 'üìã Obiettivi' : 'üìã Goals', action: () => { setActiveView('zielvereinbarung'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: GEWICHTUNG ===
            if (input.match(/gewicht|weight|ponder|prozent.*ziel|percent.*goal/)) {
              const ans = WF.goalWeighting[lang] || WF.goalWeighting.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === HILFE / WAS KANNST DU ===
            if (input.match(/hilfe|help|aiuto|was kannst|cosa puoi|what can|was wei√üt|wie starte|come inizi|how.*start/)) {
              return {
                text: lang === 'de' 
                  ? `üß† **Ich bin dein HR-Copilot!**\n\nIch kenne die App und alle Workflows:\n\n**üìã Prozesse:**\n‚Ä¢ Selbstreflexion starten & Link senden\n‚Ä¢ Mitarbeiter mit anderer FK teilen\n‚Ä¢ Entwurf vs. Abschlie√üen\n‚Ä¢ Excel Export\n\n**üìä Bewertung:**\n‚Ä¢ GPS-Formel & Rating-Skala\n‚Ä¢ BARS-Level (1-5)\n‚Ä¢ Alle 10 Kompetenzen\n\n**üìà Kalibrierung:**\n‚Ä¢ 9-Box Grid & 4 Archetypen\n‚Ä¢ Killer Criteria\n‚Ä¢ Status-Farben\n\n**‚ö° Strategie:**\n‚Ä¢ Strategie 2035\n‚Ä¢ Werte: Fast, Fair, Personal\n\nüí° Frag mich z.B.:\n‚Ä¢ "Wie teile ich einen Mitarbeiter?"\n‚Ä¢ "Wie sende ich den Selbstreflexions-Link?"`
                  : lang === 'it' ? `üß† **Sono il tuo HR-Copilot!**\n\nConosco l'app e tutti i workflow:\n\n**üìã Processi:**\n‚Ä¢ Avviare autovalutazione & inviare link\n‚Ä¢ Condividere collaboratore con altro manager\n‚Ä¢ Bozza vs. Completare\n‚Ä¢ Export Excel\n\n**üìä Valutazione:**\n‚Ä¢ Formula GPS & Scala Rating\n‚Ä¢ Livelli BARS (1-5)\n‚Ä¢ Tutte le 10 competenze\n\n**üìà Calibrazione:**\n‚Ä¢ 9-Box Grid & 4 Archetipi\n‚Ä¢ Killer Criteria\n‚Ä¢ Colori stato\n\n**‚ö° Strategia:**\n‚Ä¢ Strategia 2035\n‚Ä¢ Valori: Fast, Fair, Personal\n\nüí° Chiedimi ad es.:\n‚Ä¢ "Come condivido un collaboratore?"\n‚Ä¢ "Come invio il link autovalutazione?"`
                  : `üß† **I'm your HR Copilot!**\n\nI know the app and all workflows:\n\n**üìã Processes:**\n‚Ä¢ Start self-reflection & send link\n‚Ä¢ Share employee with other manager\n‚Ä¢ Draft vs. Complete\n‚Ä¢ Excel Export\n\n**üìä Evaluation:**\n‚Ä¢ GPS formula & Rating scale\n‚Ä¢ BARS levels (1-5)\n‚Ä¢ All 10 competencies\n\n**üìà Calibration:**\n‚Ä¢ 9-Box Grid & 4 Archetypes\n‚Ä¢ Killer Criteria\n‚Ä¢ Status colors\n\n**‚ö° Strategy:**\n‚Ä¢ Strategy 2035\n‚Ä¢ Values: Fast, Fair, Personal\n\nüí° Ask me e.g.:\n‚Ä¢ "How do I share an employee?"\n‚Ä¢ "How do I send the self-reflection link?"`,
                actions: getQuickActions()
              };
            }
            
            // === KONTEXT-SENSITIVIT√ÑT: Proaktive Tipps je nach View ===
            if (input.match(/tipp|tip|consiglio|wo bin ich|where am i|dove sono/)) {
              const contextTips = {
                team: { de: 'üë• **Du bist im Team-Bereich**\n\nHier kannst du:\n‚Ä¢ Mitarbeiter anlegen\n‚Ä¢ Selbstreflexions-Links erstellen\n‚Ä¢ Bewertungen starten\n\nüí° Tipp: Klicke auf "üîó" um einen Link zu generieren!', it: 'üë• **Sei nella sezione team**\n\nQui puoi:\n‚Ä¢ Creare collaboratori\n‚Ä¢ Generare link autovalutazione\n‚Ä¢ Avviare valutazioni\n\nüí° Suggerimento: Clicca "üîó" per generare un link!', en: 'üë• **You\'re in the team section**\n\nHere you can:\n‚Ä¢ Create employees\n‚Ä¢ Generate self-reflection links\n‚Ä¢ Start appraisals\n\nüí° Tip: Click "üîó" to generate a link!' },
                formular: { de: 'üìù **Du f√ºllst eine Bewertung aus**\n\nüí° Tipps:\n‚Ä¢ Level 3 ist die Baseline (nicht schlecht!)\n‚Ä¢ Nutze "Entwurf" f√ºr mehrt√§gige Bewertungen\n‚Ä¢ Konkrete Beispiele in Freitexten nennen', it: 'üìù **Stai compilando una valutazione**\n\nüí° Suggerimenti:\n‚Ä¢ Livello 3 √® la baseline (non negativo!)\n‚Ä¢ Usa "Bozza" per valutazioni su pi√π giorni\n‚Ä¢ Cita esempi concreti nei testi liberi', en: 'üìù **You\'re filling out an appraisal**\n\nüí° Tips:\n‚Ä¢ Level 3 is the baseline (not bad!)\n‚Ä¢ Use "Draft" for multi-day evaluations\n‚Ä¢ Mention concrete examples in free text' },
                teamcalibration: { de: 'üìä **Du bist in der Kalibrierung**\n\nüí° Tipps:\n‚Ä¢ Achte auf "Killer Criteria" Warnungen\n‚Ä¢ Solid Backbone (Rating 3) ist das R√ºckgrat\n‚Ä¢ Nutze die Peer-Learning Matches!', it: 'üìä **Sei nella calibrazione**\n\nüí° Suggerimenti:\n‚Ä¢ Fai attenzione agli avvisi "Killer Criteria"\n‚Ä¢ Solid Backbone (Rating 3) √® la spina dorsale\n‚Ä¢ Usa i match Peer-Learning!', en: 'üìä **You\'re in calibration**\n\nüí° Tips:\n‚Ä¢ Watch for "Killer Criteria" warnings\n‚Ä¢ Solid Backbone (Rating 3) is the backbone\n‚Ä¢ Use the Peer-Learning matches!' }
              };
              
              const tip = contextTips[activeView];
              if (tip) {
                return { text: tip[lang] || tip.de, actions: [] };
              }
            }
            
            // === BONUS / GEHALT ===
            if (input.match(/bonus|gehalt|salary|stipendio|verg√ºtung|compensation|geld|money|soldi/)) {
              const g = KB.gps;
              const ratingsText = g.ratings.map(r => `‚Ä¢ ${r.range}: **${r.name[lang] || r.name.de}** ‚Üí ${r.consequence[lang] || r.consequence.de}`).join('\n');
              return {
                text: lang === 'de' 
                  ? `üí∞ **GPS ‚Üí Verg√ºtung**\n\nDer GPS-Score ist mit der variablen Verg√ºtung verkn√ºpft:\n\n${ratingsText}\n\nüìå Die genauen Betr√§ge sind in der Compensation Policy definiert.`
                  : lang === 'it' ? `üí∞ **GPS ‚Üí Compensazione**\n\nIl GPS Score √® collegato alla retribuzione variabile:\n\n${ratingsText}\n\nüìå Gli importi esatti sono definiti nella Compensation Policy.`
                  : `üí∞ **GPS ‚Üí Compensation**\n\nThe GPS score is linked to variable compensation:\n\n${ratingsText}\n\nüìå Exact amounts are defined in the Compensation Policy.`,
                actions: [{ label: lang === 'de' ? 'üìä GPS Details' : lang === 'it' ? 'üìä Dettagli GPS' : 'üìä GPS Details', action: () => { setActiveView('gpsexplainer'); setIsOpen(false); }}]
              };
            }
            
            // === KILLER CRITERIA ===
            if (input.match(/killer|kritisch|critical|critico|warnung|warning|avviso|level 1|stufe 1/)) {
              return {
                text: lang === 'de' 
                  ? `‚ö†Ô∏è **Killer Criteria**\n\n${KB.calibration.killerCriteria.de}\n\n**Warum?**\nKommunikation und F√ºhrung sind kulturkritisch. Ein "Solo Star" mit Top-Ergebnissen aber toxischem Verhalten schadet dem Team.\n\nüìå Das System zeigt automatisch eine gelbe Warnung an.`
                  : lang === 'it' ? `‚ö†Ô∏è **Killer Criteria**\n\n${KB.calibration.killerCriteria.it}\n\n**Perch√©?**\nComunicazione e leadership sono critiche per la cultura. Un "Solo Star" con top risultati ma comportamento tossico danneggia il team.\n\nüìå Il sistema mostra automaticamente un avviso giallo.`
                  : `‚ö†Ô∏è **Killer Criteria**\n\n${KB.calibration.killerCriteria.en}\n\n**Why?**\nCommunication and leadership are culture-critical. A "Solo Star" with top results but toxic behavior harms the team.\n\nüìå The system automatically shows a yellow warning.`,
                actions: []
              };
            }
            
            // === GPS FORMEL ===
            if (input.match(/gps|berechnung|formel|calcolo|formula|calculation|score|50.*50|wie.*berechnet/)) {
              const g = KB.gps;
              return {
                text: lang === 'de' 
                  ? `üìä **GPS = Global Performance Score**\n\n**Formel:** ${g.formula.de}\n\n**Mitarbeiter:**\n${g.profiles.employee.de}\n\n**F√ºhrungskr√§fte:**\n${g.profiles.leader.de}\n\nüí° Beide Dimensionen (WAS + WIE) z√§hlen je 50%!`
                  : lang === 'it' ? `üìä **GPS = Global Performance Score**\n\n**Formula:** ${g.formula.it}\n\n**Collaboratore:**\n${g.profiles.employee.it}\n\n**Manager:**\n${g.profiles.leader.it}\n\nüí° Entrambe le dimensioni (COSA + COME) contano 50% ciascuna!`
                  : `üìä **GPS = Global Performance Score**\n\n**Formula:** ${g.formula.en}\n\n**Employee:**\n${g.profiles.employee.en}\n\n**Manager:**\n${g.profiles.leader.en}\n\nüí° Both dimensions (WHAT + HOW) count 50% each!`,
                actions: [{ label: lang === 'de' ? 'üîç GPS Explainer' : lang === 'it' ? 'üîç GPS Explainer' : 'üîç GPS Explainer', action: () => { setActiveView('gpsexplainer'); setIsOpen(false); }}]
              };
            }
            
            // === STRATEGIE 2035 ===
            if (input.match(/strategie|strategy|strategia|2035|smartest|solution provider/)) {
              return {
                text: lang === 'de' 
                  ? `üöÄ **${KB.strategy.name.de}**\n\n**Ziel:** "${KB.strategy.goal.de}"\n\n${KB.strategy.description.de}\n\nDie Strategie wird durch unsere Werte Fast, Fair, Personal gelebt.`
                  : lang === 'it' ? `üöÄ **${KB.strategy.name.it}**\n\n**Obiettivo:** "${KB.strategy.goal.it}"\n\n${KB.strategy.description.it}\n\nLa strategia viene vissuta attraverso i nostri valori Fast, Fair, Personal.`
                  : `üöÄ **${KB.strategy.name.en}**\n\n**Goal:** "${KB.strategy.goal.en}"\n\n${KB.strategy.description.en}\n\nThe strategy is lived through our values Fast, Fair, Personal.`,
                actions: [{ label: lang === 'de' ? '‚ö° Werte' : lang === 'it' ? '‚ö° Valori' : '‚ö° Values', action: () => handleQuickAction('werte') }]
              };
            }
            
            // === WERTE ===
            if (input.match(/wert|value|valor|fast|fair|personal|kultur|culture/)) {
              const v = KB.values;
              return {
                text: lang === 'de' 
                  ? `‚ö° **Unsere Werte**\n\nüèÉ **${v.fast.de.name}**\n${v.fast.de.desc}\n\n‚öñÔ∏è **${v.fair.de.name}**\n${v.fair.de.desc}\n\nüí™ **${v.personal.de.name}**\n${v.personal.de.desc}`
                  : lang === 'it' ? `‚ö° **I nostri valori**\n\nüèÉ **${v.fast.it.name}**\n${v.fast.it.desc}\n\n‚öñÔ∏è **${v.fair.it.name}**\n${v.fair.it.desc}\n\nüí™ **${v.personal.it.name}**\n${v.personal.it.desc}`
                  : `‚ö° **Our Values**\n\nüèÉ **${v.fast.en.name}**\n${v.fast.en.desc}\n\n‚öñÔ∏è **${v.fair.en.name}**\n${v.fair.en.desc}\n\nüí™ **${v.personal.en.name}**\n${v.personal.en.desc}`,
                actions: []
              };
            }
            
            // === ARCHETYPEN ===
            if (input.match(/archetyp|archetype|archetipo|role model|hidden gem|solo star|handlungsbedarf|action required|solid backbone|backbone/)) {
              const arch = KB.calibration.archetypes;
              return {
                text: lang === 'de' 
                  ? `üìà **Die 4 Archetypen + Solid Backbone**\n\n‚≠ê **Role Model:** ${arch.roleModel.desc.de}\n\nüíé **Hidden Gem:** ${arch.hiddenGem.desc.de}\n\nüéØ **Solo Star:** ${arch.soloStar.desc.de}\n\nüö® **Handlungsbedarf:** ${arch.actionRequired.desc.de}\n\n‚úÖ **Solid Backbone:** ${arch.solidBackbone.desc.de}`
                  : lang === 'it' ? `üìà **I 4 Archetipi + Solid Backbone**\n\n‚≠ê **Role Model:** ${arch.roleModel.desc.it}\n\nüíé **Hidden Gem:** ${arch.hiddenGem.desc.it}\n\nüéØ **Solo Star:** ${arch.soloStar.desc.it}\n\nüö® **Azione Richiesta:** ${arch.actionRequired.desc.it}\n\n‚úÖ **Solid Backbone:** ${arch.solidBackbone.desc.it}`
                  : `üìà **The 4 Archetypes + Solid Backbone**\n\n‚≠ê **Role Model:** ${arch.roleModel.desc.en}\n\nüíé **Hidden Gem:** ${arch.hiddenGem.desc.en}\n\nüéØ **Solo Star:** ${arch.soloStar.desc.en}\n\nüö® **Action Required:** ${arch.actionRequired.desc.en}\n\n‚úÖ **Solid Backbone:** ${arch.solidBackbone.desc.en}`,
                actions: [{ label: lang === 'de' ? 'üìä Kalibrierung' : lang === 'it' ? 'üìä Calibrazione' : 'üìä Calibration', action: () => { setActiveView('teamcalibration'); setIsOpen(false); }}]
              };
            }
            
            // === EINZELNE KOMPETENZEN ===
            const allComps = [...KB.competencies.core, ...KB.competencies.leadership];
            for (const comp of allComps) {
              if (comp.keywords.some(kw => input.includes(kw))) {
                const isLeadership = KB.competencies.leadership.includes(comp);
                return {
                  text: lang === 'de' 
                    ? `${isLeadership ? 'üëî' : 'üéØ'} **${comp.name.de}**\n${isLeadership ? '(Leadership-Kompetenz)' : '(Core-Kompetenz)'}\n\n${comp.desc.de}\n\nüìå Bewertung auf der BARS-Skala 1-5.`
                    : lang === 'it' ? `${isLeadership ? 'üëî' : 'üéØ'} **${comp.name.it}**\n${isLeadership ? '(Competenza Leadership)' : '(Competenza Core)'}\n\n${comp.desc.it}\n\nüìå Valutazione sulla scala BARS 1-5.`
                    : `${isLeadership ? 'üëî' : 'üéØ'} **${comp.name.en}**\n${isLeadership ? '(Leadership Competency)' : '(Core Competency)'}\n\n${comp.desc.en}\n\nüìå Evaluation on BARS scale 1-5.`,
                  actions: [{ 
                    label: lang === 'de' ? 'üîç Details' : lang === 'it' ? 'üîç Dettagli' : 'üîç Details', 
                    action: () => { if(setSelectedCompetencyId) setSelectedCompetencyId(comp.id); setActiveView('detail'); setIsOpen(false); }
                  }]
                };
              }
            }
            
            // === KOMPETENZEN √úBERSICHT ===
            if (input.match(/kompetenz|competenc|abilit|skill|alle|tutt|all|√ºbersicht|overview/)) {
              const coreNames = KB.competencies.core.map(c => c.name[lang] || c.name.de).join(', ');
              const leaderNames = KB.competencies.leadership.map(c => c.name[lang] || c.name.de).join(', ');
              return {
                text: lang === 'de' 
                  ? `üìö **Alle 10 Kompetenzen**\n\nüéØ **5 Core:**\n${coreNames}\n\nüëî **5 Leadership:**\n${leaderNames}\n\nFrag mich nach einer bestimmten Kompetenz!`
                  : lang === 'it' ? `üìö **Tutte le 10 Competenze**\n\nüéØ **5 Core:**\n${coreNames}\n\nüëî **5 Leadership:**\n${leaderNames}\n\nChiedimi di una competenza specifica!`
                  : `üìö **All 10 Competencies**\n\nüéØ **5 Core:**\n${coreNames}\n\nüëî **5 Leadership:**\n${leaderNames}\n\nAsk me about a specific competency!`,
                actions: [{ label: lang === 'de' ? 'üìã Liste' : lang === 'it' ? 'üìã Lista' : 'üìã List', action: () => { setActiveView('list'); setIsOpen(false); }}]
              };
            }
            
            // === PROZESS / WORKFLOW ALLGEMEIN ===
            if (input.match(/prozess|workflow|ablauf|processo|flusso|wie.*funktioniert|come.*funziona|schritt|step/)) {
              return {
                text: lang === 'de' 
                  ? `‚öôÔ∏è **Bewertungs-Workflow**\n\n**Der typische Ablauf:**\n\n1Ô∏è‚É£ **Team:** Mitarbeiter anlegen\n2Ô∏è‚É£ **Link:** Selbstreflexions-Link senden\n3Ô∏è‚É£ **Bewertung:** WAS + WIE bewerten\n4Ô∏è‚É£ **GPS:** Wird automatisch berechnet\n5Ô∏è‚É£ **Gespr√§ch:** Feedbackgespr√§ch f√ºhren\n6Ô∏è‚É£ **Abschluss:** Bewertung finalisieren\n\nüí° Frag mich zu einem Schritt f√ºr Details!`
                  : lang === 'it' ? `‚öôÔ∏è **Workflow di valutazione**\n\n**Il flusso tipico:**\n\n1Ô∏è‚É£ **Team:** Creare collaboratore\n2Ô∏è‚É£ **Link:** Inviare link autovalutazione\n3Ô∏è‚É£ **Valutazione:** Valutare COSA + COME\n4Ô∏è‚É£ **GPS:** Calcolato automaticamente\n5Ô∏è‚É£ **Colloquio:** Condurre feedback\n6Ô∏è‚É£ **Conclusione:** Finalizzare\n\nüí° Chiedimi di un passo per dettagli!`
                  : `‚öôÔ∏è **Appraisal Workflow**\n\n**The typical flow:**\n\n1Ô∏è‚É£ **Team:** Create employee\n2Ô∏è‚É£ **Link:** Send self-reflection link\n3Ô∏è‚É£ **Evaluation:** Evaluate WHAT + HOW\n4Ô∏è‚É£ **GPS:** Calculated automatically\n5Ô∏è‚É£ **Meeting:** Conduct feedback\n6Ô∏è‚É£ **Completion:** Finalize\n\nüí° Ask me about a step for details!`,
                actions: []
              };
            }
            
            // === MITARBEITER ANLEGEN ===
            if (input.match(/mitarbeiter.*anleg|collaborator.*crea|employee.*creat|neuer.*ma|nuovo.*collab|new.*employ/)) {
              return {
                text: lang === 'de' 
                  ? `‚ûï **Neuen Mitarbeiter anlegen**\n\n1. Gehe zu **"Team-√úbersicht"**\n2. Klicke auf **"‚ûï Mitarbeiter hinzuf√ºgen"**\n3. F√ºlle Name, Position, E-Mail aus\n4. W√§hle: F√ºhrungskraft? (Ja/Nein)\n\n**Automatisch erstellt:**\n‚Ä¢ Pers√∂nlicher Zugangs-Link\n‚Ä¢ Selbstreflexions-Formular\n\nüí° E-Mail ist optional, erm√∂glicht aber automatische Einladung.`
                  : lang === 'it' ? `‚ûï **Creare nuovo collaboratore**\n\n1. Vai a **"Panoramica team"**\n2. Clicca su **"‚ûï Aggiungi collaboratore"**\n3. Compila Nome, Posizione, Email\n4. Scegli: Manager? (S√¨/No)\n\n**Creato automaticamente:**\n‚Ä¢ Link di accesso personale\n‚Ä¢ Modulo autovalutazione\n\nüí° Email √® opzionale, ma permette invito automatico.`
                  : `‚ûï **Create new employee**\n\n1. Go to **"Team Overview"**\n2. Click **"‚ûï Add employee"**\n3. Fill in Name, Position, Email\n4. Choose: Manager? (Yes/No)\n\n**Automatically created:**\n‚Ä¢ Personal access link\n‚Ä¢ Self-reflection form\n\nüí° Email is optional, but enables automatic invitation.`,
                actions: [{ label: lang === 'de' ? 'üë• Zum Team' : lang === 'it' ? 'üë• Vai al team' : 'üë• Go to Team', action: () => { setActiveView('teamoverview'); setIsOpen(false); }}]
              };
            }
            
            // === MITARBEITER TEILEN ===
            if (input.match(/teilen|share|condivid|mitarbeiter.*teilen|share.*employee|condivid.*collabor|zweite.*f√ºhrung|andere.*fk|co-manage|gemeinsam.*verwalten/)) {
              return {
                text: lang === 'de' 
                  ? `üîó **Mitarbeiter mit anderer F√ºhrungskraft teilen**\n\n**So geht's:**\n\n1Ô∏è‚É£ Gehe zu **"Team-√úbersicht"**\n\n2Ô∏è‚É£ Finde den Mitarbeiter und klicke auf **"üë• Teilen"** (Share-Icon)\n\n3Ô∏è‚É£ Gib die **E-Mail-Adresse** der anderen F√ºhrungskraft ein\n\n4Ô∏è‚É£ Klicke **"Teilen & Link generieren"**\n\n5Ô∏è‚É£ **Zwei Optionen:**\n   ‚Ä¢ **"Link kopieren"** ‚Üí per Teams/WhatsApp versenden\n   ‚Ä¢ **"Per E-Mail senden"** ‚Üí √∂ffnet E-Mail-Programm mit vorausgef√ºllter Nachricht\n\n**Was passiert?**\n‚Ä¢ Die andere FK erh√§lt den Link\n‚Ä¢ Nach Login sieht sie den geteilten Mitarbeiter\n‚Ä¢ Beide FKs k√∂nnen die Beurteilung sehen und bearbeiten\n\nüí° Die andere FK muss sich mit der angegebenen E-Mail einloggen!`
                  : lang === 'it' ? `üîó **Condividere collaboratore con altro manager**\n\n**Ecco come:**\n\n1Ô∏è‚É£ Vai a **"Panoramica team"**\n\n2Ô∏è‚É£ Trova il collaboratore e clicca su **"üë• Condividi"** (icona Share)\n\n3Ô∏è‚É£ Inserisci l'**indirizzo email** dell'altro manager\n\n4Ô∏è‚É£ Clicca **"Condividi & genera link"**\n\n5Ô∏è‚É£ **Due opzioni:**\n   ‚Ä¢ **"Copia link"** ‚Üí invia via Teams/WhatsApp\n   ‚Ä¢ **"Invia via email"** ‚Üí apre programma email con messaggio precompilato\n\n**Cosa succede?**\n‚Ä¢ L'altro manager riceve il link\n‚Ä¢ Dopo login vede il collaboratore condiviso\n‚Ä¢ Entrambi possono vedere e modificare la valutazione\n\nüí° L'altro manager deve accedere con l'email specificata!`
                  : `üîó **Share employee with another manager**\n\n**Here's how:**\n\n1Ô∏è‚É£ Go to **"Team Overview"**\n\n2Ô∏è‚É£ Find the employee and click **"üë• Share"** (Share icon)\n\n3Ô∏è‚É£ Enter the **email address** of the other manager\n\n4Ô∏è‚É£ Click **"Share & Generate Link"**\n\n5Ô∏è‚É£ **Two options:**\n   ‚Ä¢ **"Copy Link"** ‚Üí send via Teams/WhatsApp\n   ‚Ä¢ **"Send via Email"** ‚Üí opens email program with pre-filled message\n\n**What happens?**\n‚Ä¢ The other manager receives the link\n‚Ä¢ After login they see the shared employee\n‚Ä¢ Both managers can view and edit the appraisal\n\nüí° The other manager must log in with the specified email!`,
                actions: [{ label: lang === 'de' ? 'üë• Zum Team' : lang === 'it' ? 'üë• Vai al team' : 'üë• Go to Team', action: () => { setActiveView('teamoverview'); setIsOpen(false); }}]
              };
            }
            
            // === SELBSTREFLEXION LINK VERSENDEN ===
            if (input.match(/selbstreflexion.*versend|selbstreflexion.*link|autovalutazione.*inviar|autovalutazione.*link|self.*reflection.*send|self.*reflection.*link|link.*senden|link.*generier|wie.*schicke.*selbst|come.*invio.*auto/)) {
              return {
                text: lang === 'de' 
                  ? `üìß **Selbstreflexions-Link an Mitarbeiter senden**\n\n**So geht's:**\n\n1Ô∏è‚É£ Gehe zu **"Team-√úbersicht"**\n\n2Ô∏è‚É£ Finde den Mitarbeiter\n\n3Ô∏è‚É£ Klicke auf das **"üîó" Symbol** (Link-Icon)\n\n4Ô∏è‚É£ Ein Link wird generiert - **zwei Optionen:**\n   ‚Ä¢ **"Link kopieren"** ‚Üí per Teams/WhatsApp versenden\n   ‚Ä¢ **"Per E-Mail senden"** ‚Üí √∂ffnet E-Mail-Programm mit vorausgef√ºllter Nachricht\n\n**Was der Mitarbeiter erh√§lt:**\n‚Ä¢ Einen personalisierten Link\n‚Ä¢ Zugang zum Selbstreflexions-Formular\n‚Ä¢ Kann alle Teile ausf√ºllen (Ziele, Kompetenzen, Feedback)\n\n**Nach dem Ausf√ºllen:**\n‚Ä¢ Die Selbstreflexion erscheint automatisch bei dir\n‚Ä¢ Du siehst sie in der Sidebar beim Beurteilungsbogen\n‚Ä¢ Du kannst sie mit der eigenen Bewertung vergleichen\n\nüí° Der Mitarbeiter braucht kein Login - der Link ist sein Zugang!`
                  : lang === 'it' ? `üìß **Inviare link autovalutazione al collaboratore**\n\n**Ecco come:**\n\n1Ô∏è‚É£ Vai a **"Panoramica team"**\n\n2Ô∏è‚É£ Trova il collaboratore\n\n3Ô∏è‚É£ Clicca sul simbolo **"üîó"** (icona Link)\n\n4Ô∏è‚É£ Viene generato un link - **due opzioni:**\n   ‚Ä¢ **"Copia link"** ‚Üí invia via Teams/WhatsApp\n   ‚Ä¢ **"Invia via email"** ‚Üí apre programma email con messaggio precompilato\n\n**Cosa riceve il collaboratore:**\n‚Ä¢ Un link personalizzato\n‚Ä¢ Accesso al modulo di autovalutazione\n‚Ä¢ Pu√≤ compilare tutte le parti (Obiettivi, Competenze, Feedback)\n\n**Dopo la compilazione:**\n‚Ä¢ L'autovalutazione appare automaticamente da te\n‚Ä¢ La vedi nella sidebar del modulo di valutazione\n‚Ä¢ Puoi confrontarla con la tua valutazione\n\nüí° Il collaboratore non ha bisogno di login - il link √® il suo accesso!`
                  : `üìß **Send self-reflection link to employee**\n\n**Here's how:**\n\n1Ô∏è‚É£ Go to **"Team Overview"**\n\n2Ô∏è‚É£ Find the employee\n\n3Ô∏è‚É£ Click the **"üîó" symbol** (Link icon)\n\n4Ô∏è‚É£ A link is generated - **two options:**\n   ‚Ä¢ **"Copy Link"** ‚Üí send via Teams/WhatsApp\n   ‚Ä¢ **"Send via Email"** ‚Üí opens email program with pre-filled message\n\n**What the employee receives:**\n‚Ä¢ A personalized link\n‚Ä¢ Access to the self-reflection form\n‚Ä¢ Can fill in all parts (Goals, Competencies, Feedback)\n\n**After completion:**\n‚Ä¢ The self-reflection appears automatically for you\n‚Ä¢ You see it in the sidebar of the appraisal form\n‚Ä¢ You can compare it with your own evaluation\n\nüí° The employee doesn't need a login - the link is their access!`,
                actions: [{ label: lang === 'de' ? 'üë• Zum Team' : lang === 'it' ? 'üë• Vai al team' : 'üë• Go to Team', action: () => { setActiveView('teamoverview'); setIsOpen(false); }}]
              };
            }
            
            // === FALLBACK ===
            return {
              text: lang === 'de' 
                ? `ü§î Dazu habe ich keine spezifische Antwort.\n\n**Versuch es mit:**\n‚Ä¢ "Selbstreflexion starten"\n‚Ä¢ "Entwurf vs. Abschlie√üen"\n‚Ä¢ "BARS Level erkl√§rt"\n‚Ä¢ "9-Box Grid"\n‚Ä¢ Name einer Kompetenz\n\nüí° Oder tippe "Hilfe" f√ºr eine √úbersicht!`
                : lang === 'it' ? `ü§î Non ho una risposta specifica.\n\n**Prova con:**\n‚Ä¢ "Avviare autovalutazione"\n‚Ä¢ "Bozza vs. Completare"\n‚Ä¢ "Livelli BARS spiegati"\n‚Ä¢ "9-Box Grid"\n‚Ä¢ Nome di una competenza\n\nüí° Oppure scrivi "Aiuto" per una panoramica!`
                : `ü§î I don't have a specific answer for that.\n\n**Try:**\n‚Ä¢ "Start self-reflection"\n‚Ä¢ "Draft vs. Complete"\n‚Ä¢ "BARS levels explained"\n‚Ä¢ "9-Box Grid"\n‚Ä¢ Name of a competency\n\nüí° Or type "Help" for an overview!`,
              actions: getQuickActions()
            };
          };
          
          // Handle send message
          const handleSend = () => {
            if (!inputValue.trim()) return;
            
            const userMsg = { type: 'user', text: inputValue };
            setMessages(prev => [...prev, userMsg]);
            setInputValue('');
            setIsTyping(true);
            
            setTimeout(() => {
              const response = analyzeInput(inputValue);
              setMessages(prev => [...prev, { type: 'bot', text: response.text, actions: response.actions }]);
              setIsTyping(false);
            }, 600);
          };
          
          const handleKeyPress = (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              handleSend();
            }
          };
          
          return React.createElement(React.Fragment, null,
            // Floating Action Button - APPLE STYLE mit Blur
            React.createElement('button', {
              onClick: () => setIsOpen(!isOpen),
              className: `fixed bottom-6 right-6 z-50 w-16 h-16 rounded-full flex items-center justify-center transition-all duration-500 ease-out ${
                isOpen 
                  ? 'bg-slate-800/90 backdrop-blur-xl rotate-180 scale-90' 
                  : 'bg-gradient-to-br from-[#243186] to-[#1a2460] hover:scale-110 hover:shadow-2xl'
              }`,
              style: { 
                boxShadow: isOpen 
                  ? '0 8px 32px rgba(0,0,0,0.3)' 
                  : '0 8px 40px rgba(36, 49, 134, 0.5), 0 0 0 4px rgba(255,255,255,0.1)',
                backdropFilter: isOpen ? 'blur(20px)' : 'none'
              }
            },
              isOpen 
                ? React.createElement(X, { size: 26, className: 'text-white' })
                : React.createElement(MessageCircle, { size: 26, className: 'text-white' })
            ),
            
            // Chat Window - Apple Style
            isOpen && React.createElement('div', {
              className: 'fixed bottom-28 right-6 z-50 w-80 md:w-96 bg-white/95 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/50 overflow-hidden',
              style: { 
                maxHeight: '70vh',
                boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255,255,255,0.1)'
              }
            },
              // Header with Reset Button
              React.createElement('div', { 
                className: 'px-5 py-4 flex items-center gap-3 border-b border-slate-100',
                style: { background: 'linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(248,250,252,1) 100%)' }
              },
                React.createElement('div', { 
                  className: 'w-11 h-11 rounded-2xl bg-gradient-to-br from-[#243186] to-[#1a2460] flex items-center justify-center shadow-lg shadow-[#243186]/30'
                },
                  React.createElement(Sparkles, { size: 20, className: 'text-white' })
                ),
                React.createElement('div', { className: 'flex-1' },
                  React.createElement('h3', { className: 'font-semibold text-slate-900 text-sm' }, 
                    lang === 'de' ? 'HR-Copilot' : lang === 'it' ? 'HR-Copilot' : 'HR Copilot'
                  ),
                  React.createElement('p', { className: 'text-xs text-slate-500' },
                    lang === 'de' ? 'Ich kenne die App!' : lang === 'it' ? 'Conosco l\'app!' : 'I know the app!'
                  )
                ),
                // Reset Button
                React.createElement('button', {
                  onClick: resetChat,
                  className: 'w-8 h-8 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors',
                  title: lang === 'de' ? 'Chat zur√ºcksetzen' : lang === 'it' ? 'Resetta chat' : 'Reset chat'
                },
                  React.createElement(RotateCcw, { size: 14, className: 'text-slate-500' })
                ),
                // Close Button
                React.createElement('button', {
                  onClick: () => setIsOpen(false),
                  className: 'w-8 h-8 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors'
                },
                  React.createElement(X, { size: 16, className: 'text-slate-500' })
                )
              ),
              
              // Messages
              React.createElement('div', { 
                className: 'p-4 space-y-3 overflow-y-auto',
                style: { maxHeight: '320px', minHeight: '180px' }
              },
                ...messages.map((msg, idx) => 
                  React.createElement('div', { 
                    key: idx,
                    className: `flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`
                  },
                    React.createElement('div', { 
                      className: `max-w-[85%] rounded-2xl px-4 py-2.5 ${msg.type === 'user' ? 'bg-slate-100 text-slate-800 rounded-br-md' : 'bg-gradient-to-br from-[#243186] to-[#3b4cad] text-white rounded-bl-md'}`
                    },
                      React.createElement('p', { 
                        className: 'text-sm whitespace-pre-line',
                        style: { lineHeight: '1.5' }
                      }, msg.text),
                      msg.actions && msg.actions.length > 0 && React.createElement('div', { className: 'mt-2 flex flex-wrap gap-1.5' },
                        ...msg.actions.map((action, i) => 
                          React.createElement('button', {
                            key: i,
                            onClick: action.action,
                            className: `px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${msg.type === 'user' ? 'bg-slate-200 text-slate-700 hover:bg-slate-300' : 'bg-white/20 text-white hover:bg-white/30'}`
                          }, action.label)
                        )
                      )
                    )
                  )
                ),
                // Typing indicator
                isTyping && React.createElement('div', { className: 'flex justify-start' },
                  React.createElement('div', { className: 'bg-slate-100 rounded-2xl rounded-bl-md px-4 py-3' },
                    React.createElement('div', { className: 'flex gap-1' },
                      React.createElement('span', { className: 'w-2 h-2 bg-slate-400 rounded-full animate-bounce', style: { animationDelay: '0ms' } }),
                      React.createElement('span', { className: 'w-2 h-2 bg-slate-400 rounded-full animate-bounce', style: { animationDelay: '150ms' } }),
                      React.createElement('span', { className: 'w-2 h-2 bg-slate-400 rounded-full animate-bounce', style: { animationDelay: '300ms' } })
                    )
                  )
                ),
                React.createElement('div', { ref: messagesEndRef })
              ),
              
              // Suggested Chips (context-aware)
              React.createElement('div', { 
                className: 'px-3 py-2 border-t border-slate-100 bg-slate-50/50 overflow-x-auto flex gap-2',
                style: { scrollbarWidth: 'none', msOverflowStyle: 'none' }
              },
                ...getCurrentChips().map((chip, idx) =>
                  React.createElement('button', {
                    key: idx,
                    onClick: () => handleQuickAction(chip.query),
                    className: 'whitespace-nowrap px-3 py-1.5 rounded-full text-xs font-medium bg-white border border-slate-200 text-slate-600 hover:bg-slate-100 hover:border-slate-300 transition-colors'
                  }, chip[lang] || chip.de)
                )
              ),
              
              // Input
              React.createElement('div', { className: 'p-3 border-t border-slate-100 bg-white' },
                React.createElement('div', { className: 'flex gap-2' },
                  React.createElement('input', {
                    type: 'text',
                    value: inputValue,
                    onChange: (e) => setInputValue(e.target.value),
                    onKeyPress: handleKeyPress,
                    placeholder: lang === 'de' ? 'Frag mich...' : lang === 'it' ? 'Chiedimi...' : 'Ask me...',
                    className: 'flex-1 px-4 py-2.5 rounded-xl border border-slate-200 text-sm focus:outline-none focus:ring-2 focus:ring-[#243186]/30 focus:border-[#243186]'
                  }),
                  React.createElement('button', {
                    onClick: handleSend,
                    disabled: !inputValue.trim(),
                    className: 'w-10 h-10 rounded-xl bg-[#6EBD84] text-white flex items-center justify-center hover:bg-[#5da872] transition-colors disabled:opacity-50 disabled:cursor-not-allowed'
                  },
                    React.createElement(Send, { size: 18 })
                  )
                )
              )
            )
          );
        }

        function PerformanceApp() {
          const [activeView, setActiveView] = useState('dashboard');
          const [teamViewMode, setTeamViewMode] = useState('cards'); // 'cards' oder 'list'
          const [goalsDashboardSelectedId, setGoalsDashboardSelectedId] = useState(null); // Ausgew√§hlter Mitarbeiter im Goals Dashboard
          const [competencyArea, setCompetencyArea] = useState(null); // null = Auswahl, 'admin' oder 'production'
          const [detailAreaContext, setDetailAreaContext] = useState('admin'); // F√ºr Detailansicht

          // === FIREBASE AUTH STATE ===
          const [user, setUser] = useState(null);
          const [authLoading, setAuthLoading] = useState(true);
          const [accessCodeChecking, setAccessCodeChecking] = useState(false); // NEU: Pr√ºft ob AccessCode-Check l√§uft
          
          // === GUEST MODE STATE (f√ºr Selbstreflexion via Link) ===
          const [guestMode, setGuestMode] = useState(false);
          const [guestEmployee, setGuestEmployee] = useState(null);
          const [guestManagerId, setGuestManagerId] = useState(null); // userId der FK f√ºr Firestore-Zugriff
          
          // === GUEST FORM STATES (f√ºr Selbstreflexion-Formular) ===
          const [guestFormData, setGuestFormData] = useState({
            strengths1: '',
            strengths2: '',
            wishesNextYear: '',
            feedbackManager: '',
            additionalComments: ''
          });
          const [guestCoreScores, setGuestCoreScores] = useState({ c1: 3, c2: 3, c3: 3, c4: 3, c5: 3 });
          const [guestCoreComments, setGuestCoreComments] = useState({ c1: '', c2: '', c3: '', c4: '', c5: '' });
          const [guestFormStep, setGuestFormStep] = useState(1);
          const [guestFormSaving, setGuestFormSaving] = useState(false);
          const [guestFormSubmitted, setGuestFormSubmitted] = useState(false);
          const [guestLastAutoSave, setGuestLastAutoSave] = useState(null);
          const [guestShowDraftRecovery, setGuestShowDraftRecovery] = useState(false);
          const [guestExistingAssessment, setGuestExistingAssessment] = useState(null);
          const [guestShowDuplicateWarning, setGuestShowDuplicateWarning] = useState(false);
          
          // === IMPORT SELF-ASSESSMENT STATE ===
          const [showImportModal, setShowImportModal] = useState(false);
          const [importData, setImportData] = useState(null);
          const [importStatus, setImportStatus] = useState(null); // null, 'success', 'error'
          
          // === PENDING SELF-ASSESSMENTS STATE (f√ºr FK beim Login) ===
          const [pendingSelfAssessments, setPendingSelfAssessments] = useState([]);
          const [showPendingModal, setShowPendingModal] = useState(false);
          const [claimingPending, setClaimingPending] = useState(false);
          
          // === SHARE MODAL STATE (f√ºr Mitarbeiter teilen) ===
          const [shareModalOpen, setShareModalOpen] = useState(false);
          const [shareModalMember, setShareModalMember] = useState(null);
          const [shareModalEmail, setShareModalEmail] = useState('');
          const [shareModalLink, setShareModalLink] = useState('');
          const [shareModalStep, setShareModalStep] = useState(1); // 1 = Email eingeben, 2 = Link anzeigen
          
          // === GUEST FORM useEffects (Draft Recovery & Auto-Save) ===
          // Draft Recovery beim Laden des Guest Forms
          useEffect(() => {
            if (!guestMode || !guestEmployee) return;
            
            const draftId = `guest_${guestEmployee.id}_${new Date().getFullYear()}`;
            const loadedDraft = DraftManager.loadDraft(draftId);
            
            if (loadedDraft && loadedDraft.guestFormData) {
              setGuestShowDraftRecovery(true);
              window._tempDraft = loadedDraft;
            }
            
            // Pr√ºfe auf existierende Selbstreflexion
            const checkExisting = async () => {
              if (!db) return;
              const result = await checkExistingSelfAssessment(
                db, 
                guestEmployee.id, 
                new Date().getFullYear().toString()
              );
              if (result.exists) {
                setGuestExistingAssessment(result);
                setGuestShowDuplicateWarning(true);
              }
            };
            checkExisting();
          }, [guestMode, guestEmployee, db]);
          
          // Auto-Save f√ºr Guest Form alle 30 Sekunden
          useEffect(() => {
            if (!guestMode || !guestEmployee) return;
            
            const hasContent = guestFormData.strengths1 || guestFormData.strengths2 || 
                               guestFormData.wishesNextYear || guestFormData.feedbackManager ||
                               Object.values(guestCoreScores).some(v => v !== 3) ||
                               Object.values(guestCoreComments).some(v => v?.trim());
            
            if (!hasContent) return;
            
            const draftId = `guest_${guestEmployee.id}_${new Date().getFullYear()}`;
            const autoSaveInterval = setInterval(() => {
              DraftManager.saveDraft(draftId, {
                guestFormData,
                selfCoreScores: guestCoreScores,
                selfCoreComments: guestCoreComments,
                currentStep: guestFormStep
              });
              setGuestLastAutoSave(Date.now());
            }, 30000);
            
            return () => clearInterval(autoSaveInterval);
          }, [guestMode, guestEmployee, guestFormData, guestCoreScores, guestCoreComments, guestFormStep]);
          
          // === BUBBLE CHART TOOLTIP STATE ===
          const [bubbleTooltip, setBubbleTooltip] = useState(null);
          
          // === TEAM CALIBRATION STATES ===
          const [calibrationSort, setCalibrationSort] = useState({ field: 'name', direction: 'asc' }); // Sortierung
          const [calibrationFilter, setCalibrationFilter] = useState('all'); // 'all', 'completed', 'draft'
          const [calibrationNotes, setCalibrationNotes] = useState({}); // { reviewId: 'Notiz...' }
          const [editingNoteId, setEditingNoteId] = useState(null); // ID der gerade bearbeiteten Notiz
          
          // === MIGRATION STATE ===
          const [migrationStatus, setMigrationStatus] = useState(null); // null, 'pending', 'done', 'error'
          const [migrationResult, setMigrationResult] = useState(null); // { members: X, appraisals: Y }
          
          // === IMPORT SELF-ASSESSMENT FROM URL ===
          useEffect(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const importSelfParam = urlParams.get('import_self');
            const viewParam = urlParams.get('view');
            
            // NEU: Pr√ºfe auf view=competencies Parameter (f√ºr Verhaltensanker-Referenz)
            if (viewParam === 'competencies') {
              devLog('üìö View-Parameter erkannt: √ñffne Kompetenz-Liste');
              setActiveView('list');
              // URL bereinigen (Parameter entfernen)
              const cleanUrl = window.location.href.split('?')[0];
              window.history.replaceState({}, document.title, cleanUrl);
              return; // Fr√ºh beenden, kein Import n√∂tig
            }
            
            // NEU: Pr√ºfe auf view=viewSelfAssessment Parameter (f√ºr "Vollst√§ndig ansehen" in neuem Tab)
            if (viewParam === 'viewSelfAssessment') {
              devLog('üëÅÔ∏è View-Parameter erkannt: √ñffne Selbstreflexions-Ansicht');
              // Warte kurz bis localStorage geladen ist
              setTimeout(() => {
                setActiveView('viewSelfAssessment');
              }, 100);
              // URL bereinigen (Parameter entfernen)
              const cleanUrl = window.location.href.split('?')[0];
              window.history.replaceState({}, document.title, cleanUrl);
              return;
            }
            
            if (importSelfParam) {
              try {
                const decoded = JSON.parse(decodeURIComponent(atob(importSelfParam)));
                devLog('üì• Import-Daten aus URL gefunden:', decoded);
                setImportData(decoded);
                setShowImportModal(true);
                
                // URL bereinigen (Parameter entfernen)
                const cleanUrl = window.location.href.split('?')[0];
                window.history.replaceState({}, document.title, cleanUrl);
              } catch (err) {
                console.error('‚ùå Fehler beim Dekodieren der Import-Daten:', err);
              }
            }
          }, []);
          
          // === EVENT LISTENER f√ºr View-Wechsel aus Kind-Komponenten ===
          useEffect(() => {
            const handleViewSelfAssessment = () => {
              setActiveView('viewSelfAssessment');
            };
            window.addEventListener('viewSelfAssessment', handleViewSelfAssessment);
            return () => window.removeEventListener('viewSelfAssessment', handleViewSelfAssessment);
          }, []);
          
          // === MIGRATION FUNCTION: localStorage ‚Üí Firestore ===
          // Migriert alte lokale Daten in die Cloud beim ersten Login
          const migrateLocalDataToFirebase = async (currentUser) => {
            // Guard: Nur f√ºr echte User (nicht anonym), nur wenn DB verf√ºgbar
            if (!currentUser || !db || currentUser.isAnonymous) {
              return { migrated: false, members: 0, appraisals: 0 };
            }
            
            // Check: Bereits migriert?
            const migrationKey = `nw_migrated_${currentUser.uid}`;
            if (localStorage.getItem(migrationKey)) {
              devLog('‚ÑπÔ∏è Migration bereits durchgef√ºhrt f√ºr User:', currentUser.uid);
              return { migrated: false, members: 0, appraisals: 0, reason: 'already_migrated' };
            }
            
            // Alte Daten laden
            const localMembersRaw = localStorage.getItem('nw_team_members');
            const localAppraisalsRaw = localStorage.getItem('nw_team_appraisals');
            
            const localMembers = localMembersRaw ? JSON.parse(localMembersRaw) : [];
            const localAppraisals = localAppraisalsRaw ? JSON.parse(localAppraisalsRaw) : [];
            
            // Keine Daten vorhanden?
            if (localMembers.length === 0 && localAppraisals.length === 0) {
              devLog('‚ÑπÔ∏è Keine lokalen Daten zum Migrieren gefunden.');
              localStorage.setItem(migrationKey, 'true');
              return { migrated: false, members: 0, appraisals: 0, reason: 'no_data' };
            }
            
            devLog('üîÑ Starte Migration:', localMembers.length, 'Mitarbeiter,', localAppraisals.length, 'Bewertungen');
            setMigrationStatus('pending');
            
            try {
              // Hilfsfunktion: AccessCode generieren (gleiche Logik wie in addTeamMember)
              const generateMigrationAccessCode = () => {
                if (typeof crypto !== 'undefined' && crypto.randomUUID) {
                  return crypto.randomUUID();
                }
                // Sicherer Fallback mit crypto.getRandomValues
                if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
                  const array = new Uint8Array(16);
                  crypto.getRandomValues(array);
                  const hex = Array.from(array, b => b.toString(16).padStart(2, '0')).join('');
                  return `${hex.slice(0,8)}-${hex.slice(8,12)}-${hex.slice(12,16)}-${hex.slice(16,20)}-${hex.slice(20,32)}`;
                }
                // Letzter Fallback
                return 'xxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'.replace(/x/g, () => 
                  Math.floor(Math.random() * 16).toString(16)
                );
              };
              
              // Mapping: alte lokale ID ‚Üí neue Firestore ID
              // Wichtig f√ºr die Verkn√ºpfung von Appraisals mit Mitarbeitern
              const idMapping = {};
              
              let memberCount = 0;
              let appraisalCount = 0;
              
              // === SCHRITT 1: Mitarbeiter migrieren ===
              for (const member of localMembers) {
                try {
                  const oldId = member.id;
                  
                  // Neues Dokument mit allen erforderlichen Feldern
                  const newMemberData = {
                    userId: currentUser.uid,
                    name: member.name || 'Unbekannt',
                    position: member.position || '',
                    department: member.department || '',
                    accessCode: generateMigrationAccessCode(), // NEU: F√ºr Selbstreflexions-Link
                    createdAt: member.createdAt || new Date().toISOString(),
                    migratedAt: new Date().toISOString(),
                    migratedFromLocal: true
                  };
                  
                  // In Firestore speichern
                  const docRef = await db.collection('teamMembers').add(newMemberData);
                  
                  // ID-Mapping speichern
                  idMapping[oldId] = docRef.id;
                  memberCount++;
                  
                  devLog(`  ‚úì Mitarbeiter migriert (${oldId} ‚Üí ${docRef.id})`);
                } catch (memberError) {
                  devError('  ‚úó Fehler bei Migration:', memberError);
                }
              }
              
              // === SCHRITT 2: Bewertungen/Appraisals migrieren ===
              for (const appraisal of localAppraisals) {
                try {
                  const oldEmployeeId = appraisal.employeeId;
                  const newEmployeeId = idMapping[oldEmployeeId] || oldEmployeeId;
                  
                  // Neues Dokument mit allen erforderlichen Feldern
                  const newAppraisalData = {
                    ...appraisal, // Alle bestehenden Daten √ºbernehmen
                    userId: currentUser.uid,
                    employeeId: newEmployeeId, // Aktualisierte ID
                    type: appraisal.type || 'review', // Fallback f√ºr alte Daten ohne Typ
                    createdAt: appraisal.createdAt || new Date().toISOString(),
                    migratedAt: new Date().toISOString(),
                    migratedFromLocal: true
                  };
                  
                  // Alte lokale ID entfernen (Firestore generiert eigene)
                  delete newAppraisalData.id;
                  
                  // In Firestore speichern
                  await db.collection('teamAppraisals').add(newAppraisalData);
                  appraisalCount++;
                  
                  devLog(`  ‚úì Bewertung migriert (${appraisal.type || 'review'})`);
                } catch (appraisalError) {
                  console.error(`  ‚úó Fehler bei Bewertung:`, appraisalError);
                }
              }
              
              // === SCHRITT 3: Aufr√§umen ===
              // Migration als abgeschlossen markieren (User-spezifisch)
              localStorage.setItem(migrationKey, 'true');
              
              // Alte Daten als Backup umbenennen (nicht l√∂schen, zur Sicherheit)
              if (localMembersRaw) {
                localStorage.setItem('nw_team_members_backup', localMembersRaw);
                localStorage.removeItem('nw_team_members');
              }
              if (localAppraisalsRaw) {
                localStorage.setItem('nw_team_appraisals_backup', localAppraisalsRaw);
                localStorage.removeItem('nw_team_appraisals');
              }
              
              devLog('‚úÖ Migration abgeschlossen:', memberCount, 'Mitarbeiter,', appraisalCount, 'Bewertungen');
              
              const result = { migrated: true, members: memberCount, appraisals: appraisalCount };
              setMigrationResult(result);
              setMigrationStatus('done');
              
              return result;
              
            } catch (error) {
              console.error('‚ùå Migration fehlgeschlagen:', error);
              setMigrationStatus('error');
              return { migrated: false, members: 0, appraisals: 0, error: error.message };
            }
          };
          
          // Auth State Listener (erweitert um Migration)
          // WICHTIG: Pr√ºft zuerst ob ein accessCode in der URL ist
          React.useEffect(() => {
            if (!auth) {
              setAuthLoading(false);
              return;
            }
            
            // Pr√ºfe ZUERST ob ein accessCode in der URL ist
            const params = new URLSearchParams(window.location.search);
            const hasAccessCode = params.get('accessCode');
            
            if (hasAccessCode) {
              // AccessCode vorhanden - setze Flag und warte auf checkAccessCode
              devLog('üîó AccessCode in URL erkannt, warte auf Pr√ºfung...');
              setAccessCodeChecking(true);
              // authLoading bleibt true bis checkAccessCode fertig ist
            }
            
            const unsubscribe = auth.onAuthStateChanged(async (currentUser) => {
              setUser(currentUser);
              
              // Debug-Log f√ºr Auth-Status
              if (currentUser) {
                addDebugLog('success', `Angemeldet: ${currentUser.email || 'Anonym'}`);
              } else {
                addDebugLog('warning', 'Abgemeldet');
              }
              
              // Migration beim ersten Login durchf√ºhren (nur f√ºr echte User)
              if (currentUser && !currentUser.isAnonymous && db) {
                try {
                  const result = await migrateLocalDataToFirebase(currentUser);
                  if (result.migrated && (result.members > 0 || result.appraisals > 0)) {
                    devLog('üéâ Daten erfolgreich migriert:', result);
                    addDebugLog('success', `Migration: ${result.members} MA, ${result.appraisals} Bewertungen`);
                    // Benutzerfreundliche Erfolgsmeldung
                    setTimeout(() => {
                      const alertMsg = lang === 'en'
                        ? `‚ú® Welcome back!\n\nWe have successfully transferred your local data to the cloud:\n‚Ä¢ ${result.members} employees\n‚Ä¢ ${result.appraisals} appraisals\n\nYour data is now securely stored in Firebase and accessible from any device.`
                        : lang === 'it'
                          ? `‚ú® Bentornato!\n\nAbbiamo trasferito con successo i tuoi dati locali nel cloud:\n‚Ä¢ ${result.members} collaboratori\n‚Ä¢ ${result.appraisals} valutazioni\n\nI tuoi dati sono ora salvati in Firebase e accessibili da qualsiasi dispositivo.`
                          : `‚ú® Willkommen zur√ºck!\n\nWir haben Ihre lokalen Daten erfolgreich in die Cloud √ºbertragen:\n‚Ä¢ ${result.members} Mitarbeiter\n‚Ä¢ ${result.appraisals} Bewertungen\n\nIhre Daten sind jetzt sicher in Firebase gespeichert und von jedem Ger√§t abrufbar.`;
                      showToast(alertMsg, "info");
                    }, 500); // Kurze Verz√∂gerung damit UI fertig geladen ist
                  }
                } catch (migrationError) {
                  console.error('Migration error:', migrationError);
                  addDebugLog('error', `Migration fehlgeschlagen: ${migrationError.message}`);
                }
                
                // === NEU: Pr√ºfe auf wartende Selbstreflexionen (pendingForEmail) ===
                try {
                  const userEmail = currentUser.email?.toLowerCase();
                  if (userEmail) {
                    devLog('üîç Pr√ºfe auf wartende Selbstreflexionen');
                    const pendingSnapshot = await db.collection('teamAppraisals')
                      .where('pendingForEmail', '==', userEmail)
                      .where('pendingStatus', '==', 'pending_claim')
                      .get();
                    
                    if (!pendingSnapshot.empty) {
                      const pendingCount = pendingSnapshot.size;
                      const pendingDocs = pendingSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                      devLog(`üì• ${pendingCount} wartende Selbstreflexion(en) gefunden!`);
                      
                      // Speichere pending Daten f√ºr Modal
                      setPendingSelfAssessments(pendingDocs);
                      setShowPendingModal(true);
                    }
                  }
                } catch (pendingError) {
                  console.error('Fehler beim Pr√ºfen wartender Selbstreflexionen:', pendingError);
                }
              }
              
              // WICHTIG: authLoading nur auf false setzen wenn KEIN accessCode-Check l√§uft
              // Wenn accessCode vorhanden, wird authLoading von checkAccessCode gesteuert
              if (!hasAccessCode) {
                setAuthLoading(false);
              }
            });
            return () => unsubscribe();
          }, [db]);
          
          // === ACCESS CODE CHECK (f√ºr Gast-Modus via Link) ===
          // WICHTIG: Auch eingeloggte User k√∂nnen Selbstreflexion ausf√ºllen (FK ist auch MA f√ºr seinen Vorgesetzten)
          React.useEffect(() => {
            const checkAccessCode = async () => {
              const params = new URLSearchParams(window.location.search);
              const code = params.get('accessCode');
              
              if (!code) {
                // Kein AccessCode - nichts zu tun
                setAccessCodeChecking(false);
                return;
              }
              
              // Warte auf db und auth - WICHTIG: Nicht fr√ºh returnen ohne State zu setzen
              if (!db || !auth) {
                devLog('‚è≥ Warte auf Firebase... (db:', !!db, ', auth:', !!auth, ')');
                // Nicht accessCodeChecking auf false setzen - useEffect wird erneut aufgerufen wenn db/auth bereit
                return;
              }
              
              devLog('üîó AccessCode Check startet:', code);
              setAccessCodeChecking(true);
              
              try {
                // Warte kurz auf Auth-State (wichtig f√ºr anonyme Authentifizierung)
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Hole aktuellen User direkt von Firebase Auth
                let currentUser = auth.currentUser;
                
                // Wenn KEIN User eingeloggt ist ‚Üí Anonymen Login f√ºr Firestore-Zugriff
                if (!currentUser) {
                  devLog('üîê Kein User eingeloggt, starte anonyme Authentifizierung...');
                  const userCredential = await auth.signInAnonymously();
                  currentUser = userCredential.user;
                  devLog('‚úì Anonymer Login erfolgreich');
                } else {
                  devLog('‚úì User bereits eingeloggt');
                }
                
                // Firestore-Query um Mitarbeiter zu finden
                devLog('üîç Suche Mitarbeiter mit accessCode...');
                const snapshot = await db.collection('teamMembers')
                  .where('accessCode', '==', code)
                  .limit(1)
                  .get();
                
                if (snapshot.empty) {
                  devLog('‚ùå Kein Mitarbeiter mit diesem accessCode gefunden:', code);
                  // Bei ung√ºltigem Code: Nur anonymen User ausloggen
                  if (currentUser?.isAnonymous) {
                    await auth.signOut();
                  }
                  showToast(lang === 'de' 
                    ? 'Ung√ºltiger oder abgelaufener Link' 
                    : lang === 'it'
                    ? 'Link non valido o scaduto'
                    : 'Invalid or expired link', 'error');
                  // URL bereinigen
                  window.history.replaceState({}, document.title, window.location.pathname);
                  setAccessCodeChecking(false);
                  setAuthLoading(false);
                  return;
                }
                
                const employeeDoc = snapshot.docs[0];
                const employeeData = {
                  id: employeeDoc.id,
                  ...employeeDoc.data()
                };
                
                devLog('‚úì Mitarbeiter gefunden');
                
                // Aktiviere Gast-Modus (funktioniert auch f√ºr eingeloggte User)
                // Der "Gast-Modus" bedeutet hier: Selbstreflexions-Ansicht
                setGuestMode(true);
                setGuestEmployee(employeeData);
                setGuestManagerId(employeeData.userId); // Die userId ist die des Managers
                setActiveView('guestWelcome');
                setAccessCodeChecking(false);
                setAuthLoading(false);
                
              } catch (error) {
                console.error('‚ùå Fehler beim Laden des Mitarbeiters:', error);
                // Bei Fehler: Nur anonymen User ausloggen
                if (auth.currentUser?.isAnonymous) {
                  try { await auth.signOut(); } catch (e) { /* ignore */ }
                }
                showToast(lang === 'de' 
                  ? 'Fehler beim Laden' 
                  : lang === 'it'
                  ? 'Errore di caricamento'
                  : 'Error loading', 'error');
                window.history.replaceState({}, document.title, window.location.pathname);
                setAccessCodeChecking(false);
                setAuthLoading(false);
              }
            };
            
            checkAccessCode();
          }, [db, auth]); // Nur einmal beim Start, wenn db und auth verf√ºgbar
          
          // === TEAM STATES ===
          const [teamMembers, setTeamMembers] = useState([]);
          const [teamAppraisals, setTeamAppraisals] = useState([]);
          const [firestoreLoading, setFirestoreLoading] = useState(false);
          
          // === DEBUG MODE STATE ===
          const [debugMode, setDebugMode] = useState(false);
          const [debugLogs, setDebugLogs] = useState([]);
          
          // Debug-Logger Funktion
          const addDebugLog = (type, message, data = null) => {
            const timestamp = new Date().toLocaleTimeString('de-DE');
            const logEntry = { timestamp, type, message, data };
            setDebugLogs(prev => [...prev.slice(-50), logEntry]); // Behalte nur die letzten 50 Logs
            
            // Auch in Console loggen
            const emoji = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            devLog(`[DEBUG ${timestamp}] ${emoji} ${message}`, data || '');
          };
          
          // Debug-Panel Komponente
          const DebugPanel = () => {
            if (!debugMode) return null;
            
            const firebaseStatus = {
              db: !!db,
              auth: !!auth,
              user: !!user,
              userEmail: user?.email || 'Nicht eingeloggt',
              userId: user?.uid?.slice(0, 8) + '...' || '-',
              isAnonymous: user?.isAnonymous || false
            };
            
            const dataStatus = {
              teamMembers: teamMembers.length,
              teamAppraisals: teamAppraisals.length,
              guestMode: guestMode,
              activeView: activeView
            };
            
            const storageInfo = {
              localStorage: Object.keys(localStorage).filter(k => k.startsWith('nw_')).length + ' Eintr√§ge',
              sessionStorage: Object.keys(sessionStorage).length + ' Eintr√§ge'
            };
            
            return React.createElement('div', {
              className: 'fixed bottom-4 right-4 z-[9999] w-96 max-h-[80vh] bg-slate-900 text-white rounded-2xl shadow-2xl overflow-hidden',
              style: { fontFamily: 'monospace', fontSize: '11px' }
            },
              // Header
              React.createElement('div', { className: 'bg-slate-800 px-4 py-3 flex items-center justify-between border-b border-slate-700' },
                React.createElement('div', { className: 'flex items-center gap-2' },
                  React.createElement('span', { className: 'text-lg' }, 'üîß'),
                  React.createElement('span', { className: 'font-bold text-sm' }, 'Debug Panel')
                ),
                React.createElement('button', {
                  onClick: () => setDebugMode(false),
                  className: 'text-slate-400 hover:text-white transition-colors text-lg'
                }, '√ó')
              ),
              
              // Content
              React.createElement('div', { className: 'p-4 space-y-4 max-h-[60vh] overflow-y-auto' },
                // Firebase Status
                React.createElement('div', null,
                  React.createElement('h3', { className: 'text-xs font-bold text-slate-400 uppercase mb-2' }, 'üî• Firebase Status'),
                  React.createElement('div', { className: 'bg-slate-800 rounded-lg p-3 space-y-1' },
                    React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, 'Datenbank:'),
                      React.createElement('span', { className: firebaseStatus.db ? 'text-green-400' : 'text-red-400' }, 
                        firebaseStatus.db ? '‚úì Verbunden' : '‚úó Nicht verbunden'
                      )
                    ),
                    React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, 'Auth:'),
                      React.createElement('span', { className: firebaseStatus.auth ? 'text-green-400' : 'text-red-400' }, 
                        firebaseStatus.auth ? '‚úì Aktiv' : '‚úó Inaktiv'
                      )
                    ),
                    React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, 'User:'),
                      React.createElement('span', { className: firebaseStatus.user ? 'text-green-400' : 'text-amber-400' }, 
                        firebaseStatus.user ? firebaseStatus.userEmail : 'Nicht eingeloggt'
                      )
                    ),
                    firebaseStatus.user && React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, 'User ID:'),
                      React.createElement('span', { className: 'text-blue-400' }, firebaseStatus.userId)
                    ),
                    firebaseStatus.isAnonymous && React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, 'Typ:'),
                      React.createElement('span', { className: 'text-amber-400' }, '‚ö†Ô∏è Anonym (Daten gehen verloren!)')
                    )
                  )
                ),
                
                // Daten Status
                React.createElement('div', null,
                  React.createElement('h3', { className: 'text-xs font-bold text-slate-400 uppercase mb-2' }, 'üìä Daten Status'),
                  React.createElement('div', { className: 'bg-slate-800 rounded-lg p-3 space-y-1' },
                    React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, 'Team-Mitglieder:'),
                      React.createElement('span', { className: 'text-cyan-400' }, dataStatus.teamMembers)
                    ),
                    React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, getText(lang, 'Beurteilungen:', 'Valutazioni:', 'Assessments:')),
                      React.createElement('span', { className: 'text-cyan-400' }, dataStatus.teamAppraisals)
                    ),
                    React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, 'Aktive Ansicht:'),
                      React.createElement('span', { className: 'text-purple-400' }, dataStatus.activeView)
                    ),
                    React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, 'Gast-Modus:'),
                      React.createElement('span', { className: dataStatus.guestMode ? 'text-amber-400' : 'text-slate-500' }, 
                        dataStatus.guestMode ? '‚úì Aktiv' : 'Nein'
                      )
                    )
                  )
                ),
                
                // Storage Info
                React.createElement('div', null,
                  React.createElement('h3', { className: 'text-xs font-bold text-slate-400 uppercase mb-2' }, 'üíæ Storage'),
                  React.createElement('div', { className: 'bg-slate-800 rounded-lg p-3 space-y-1' },
                    React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, 'localStorage (nw_*):'),
                      React.createElement('span', { className: 'text-slate-300' }, storageInfo.localStorage)
                    ),
                    React.createElement('div', { className: 'flex justify-between' },
                      React.createElement('span', { className: 'text-slate-400' }, 'sessionStorage:'),
                      React.createElement('span', { className: 'text-slate-300' }, storageInfo.sessionStorage)
                    )
                  )
                ),
                
                // Letzte Logs
                React.createElement('div', null,
                  React.createElement('h3', { className: 'text-xs font-bold text-slate-400 uppercase mb-2' }, 'üìù Letzte Aktivit√§ten'),
                  React.createElement('div', { className: 'bg-slate-800 rounded-lg p-3 max-h-32 overflow-y-auto space-y-1' },
                    debugLogs.length === 0 
                      ? React.createElement('span', { className: 'text-slate-500 italic' }, getText(lang, 'Keine Aktivit√§ten...', 'Nessuna attivit√†...', 'No activities...'))
                      : debugLogs.slice().reverse().map((log, i) => 
                          React.createElement('div', { key: i, className: 'text-xs border-b border-slate-700 pb-1 mb-1 last:border-0' },
                            React.createElement('span', { className: 'text-slate-500' }, log.timestamp + ' '),
                            React.createElement('span', { 
                              className: log.type === 'success' ? 'text-green-400' : 
                                        log.type === 'error' ? 'text-red-400' : 
                                        log.type === 'warning' ? 'text-amber-400' : 'text-blue-400'
                            }, log.message)
                          )
                        )
                  )
                ),
                
                // Actions
                React.createElement('div', { className: 'flex gap-2 flex-wrap' },
                  React.createElement('button', {
                    onClick: () => {
                      addDebugLog('info', 'Manueller Firebase-Test...');
                      if (db && user) {
                        db.collection('teamMembers').where('userId', '==', user.uid).get()
                          .then(snap => addDebugLog('success', `Firebase OK: ${snap.size} Mitglieder gefunden`))
                          .catch(err => addDebugLog('error', `Firebase Fehler: ${err.message}`));
                      } else {
                        addDebugLog('warning', 'DB oder User nicht verf√ºgbar');
                      }
                    },
                    className: 'px-2 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs'
                  }, 'üîÑ Test Firebase'),
                  React.createElement('button', {
                    onClick: () => {
                      setDebugLogs([]);
                      addDebugLog('info', 'Logs gel√∂scht');
                    },
                    className: 'px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs'
                  }, 'üóëÔ∏è Logs l√∂schen'),
                  React.createElement('button', {
                    onClick: () => {
                      const debugInfo = {
                        timestamp: new Date().toISOString(),
                        firebase: { db: !!db, auth: !!auth, user: user?.email },
                        data: { members: teamMembers.length, appraisals: teamAppraisals.length },
                        logs: debugLogs
                      };
                      navigator.clipboard.writeText(JSON.stringify(debugInfo, null, 2));
                      addDebugLog('success', 'Debug-Info kopiert!');
                    },
                    className: 'px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs'
                  }, 'üìã Kopieren')
                )
              )
            );
          };
          
          // Debug-Button (schwebt unten rechts)
          const DebugButton = () => {
            if (debugMode) return null;
            return React.createElement('button', {
              onClick: () => setDebugMode(true),
              className: 'fixed bottom-4 right-4 z-[9998] w-10 h-10 bg-slate-800 hover:bg-slate-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110',
              title: getText(lang, 'Debug-Panel √∂ffnen', 'Apri pannello debug', 'Open debug panel')
            }, 'üîß');
          };
          
          // === MEMOIZED CALIBRATION DATA (Performance-Optimierung) ===
          // Diese Berechnungen sind teuer und werden nur bei √Ñnderungen der Abh√§ngigkeiten neu berechnet
          const calibrationData = useMemo(() => {
            // Fr√ºhzeitiger Return wenn keine Daten
            if (!teamAppraisals || teamAppraisals.length === 0) {
              return { employeeData: [], teamAvg: null, allReviews: [], hasAnyLeadership: false, filteredReviews: [] };
            }
            
            const allReviews = teamAppraisals.filter(a => a.type === 'review' || !a.type);
            const hasAnyLeadership = allReviews.some(r => r.includeLeadership && r.leaderScores);
            
            // Filtere Reviews
            const filteredReviews = (() => {
              if (calibrationFilter === 'completed') return allReviews.filter(r => r.status === 'completed');
              if (calibrationFilter === 'draft') return allReviews.filter(r => r.status === 'draft' || !r.status);
              return allReviews;
            })();
            
            // Bereite Mitarbeiter-Daten auf (teure Operation)
            const employeeData = filteredReviews.map(review => {
              const member = teamMembers.find(m => m.id === review.employeeId);
              const name = review.employeeName || member?.name || 'Unknown';
              const wasScore = review.wasScore || 0;
              
              // Normalisiere Core Scores
              const rawCoreScores = review.coreScores || {};
              const coreKeys = Object.keys(rawCoreScores);
              const coreValues = Object.values(rawCoreScores).filter(v => typeof v === 'number' && v > 0);
              const isNumericKeys = coreKeys.length > 0 && coreKeys.every(k => !isNaN(parseFloat(k)));
              
              let coreScores;
              if (isNumericKeys && coreValues.length >= 5) {
                const sortedKeys = coreKeys.sort();
                coreScores = { fach: rawCoreScores[sortedKeys[0]] || 0, komm: rawCoreScores[sortedKeys[1]] || 0, prob: rawCoreScores[sortedKeys[2]] || 0, adapt: rawCoreScores[sortedKeys[3]] || 0, orga: rawCoreScores[sortedKeys[4]] || 0 };
              } else {
                coreScores = { fach: rawCoreScores.fach || rawCoreScores.c1 || 0, komm: rawCoreScores.komm || rawCoreScores.c2 || 0, prob: rawCoreScores.prob || rawCoreScores.c3 || 0, adapt: rawCoreScores.adapt || rawCoreScores.c4 || 0, orga: rawCoreScores.orga || rawCoreScores.c5 || 0 };
              }
              
              // Normalisiere Leader Scores
              const rawLeaderScores = review.leaderScores || {};
              const leaderKeys = Object.keys(rawLeaderScores);
              const leaderValues = Object.values(rawLeaderScores).filter(v => typeof v === 'number' && v > 0);
              const isNumericLeaderKeys = leaderKeys.length > 0 && leaderKeys.every(k => !isNaN(parseFloat(k)));
              
              let leaderScores;
              if (isNumericLeaderKeys && leaderValues.length >= 5) {
                const sortedKeys = leaderKeys.sort();
                leaderScores = { lead: rawLeaderScores[sortedKeys[0]] || 0, strat: rawLeaderScores[sortedKeys[1]] || 0, decide: rawLeaderScores[sortedKeys[2]] || 0, exec: rawLeaderScores[sortedKeys[3]] || 0, stake: rawLeaderScores[sortedKeys[4]] || 0 };
              } else {
                leaderScores = { lead: rawLeaderScores.lead || rawLeaderScores.l1 || 0, strat: rawLeaderScores.strat || rawLeaderScores.l2 || 0, decide: rawLeaderScores.decide || rawLeaderScores.l3 || 0, exec: rawLeaderScores.exec || rawLeaderScores.l4 || 0, stake: rawLeaderScores.stake || rawLeaderScores.l5 || 0 };
              }
              
              // WIE Durchschnitt
              const allWieScores = [...Object.values(coreScores).filter(v => v > 0), ...(review.includeLeadership ? Object.values(leaderScores).filter(v => v > 0) : [])];
              const wieAvg = allWieScores.length > 0 ? allWieScores.reduce((s, v) => s + v, 0) / allWieScores.length : 0;
              
              return { id: review.id, employeeId: review.employeeId, name, status: review.status, gps: review.gpsScore || 0, wasScore, wieAvg, coreScores, leaderScores, includeLeadership: review.includeLeadership };
            })
            // Sortierung
            .sort((a, b) => {
              let comparison = 0;
              switch (calibrationSort.field) {
                case 'name': comparison = a.name.localeCompare(b.name); break;
                case 'gps': comparison = a.gps - b.gps; break;
                case 'was': comparison = a.wasScore - b.wasScore; break;
                case 'wie': comparison = a.wieAvg - b.wieAvg; break;
                default: comparison = a.name.localeCompare(b.name);
              }
              return calibrationSort.direction === 'desc' ? -comparison : comparison;
            });
            
            // Team-Durchschnitte (teure Operation)
            const calcAvg = (arr) => arr.length > 0 ? arr.reduce((s, v) => s + v, 0) / arr.length : 0;
            const coreCompIds = ['fach', 'komm', 'prob', 'adapt', 'orga'];
            const leaderCompIds = ['lead', 'strat', 'decide', 'exec', 'stake'];
            
            const teamAvg = {
              gps: calcAvg(employeeData.map(e => e.gps).filter(v => v > 0)),
              was: calcAvg(employeeData.map(e => e.wasScore).filter(v => v > 0)),
              wie: calcAvg(employeeData.map(e => e.wieAvg).filter(v => v > 0)),
              core: {},
              leader: {}
            };
            
            coreCompIds.forEach(id => { teamAvg.core[id] = calcAvg(employeeData.map(e => e.coreScores[id]).filter(v => v > 0)); });
            if (hasAnyLeadership) {
              leaderCompIds.forEach(id => { teamAvg.leader[id] = calcAvg(employeeData.filter(e => e.includeLeadership).map(e => e.leaderScores[id]).filter(v => v > 0)); });
            }
            
            return { employeeData, teamAvg, allReviews, hasAnyLeadership, filteredReviews };
          }, [teamAppraisals, teamMembers, calibrationFilter, calibrationSort]);
          
          // === MEMOIZED PEER-LEARNING MATCHES (Performance-Optimierung) ===
          const peerLearningMatches = useMemo(() => {
            const { employeeData, hasAnyLeadership } = calibrationData;
            if (!employeeData || employeeData.length < 2) return [];
            
            const coreCompIds = ['fach', 'komm', 'prob', 'adapt', 'orga'];
            const leaderCompIds = ['lead', 'strat', 'decide', 'exec', 'stake'];
            const allCompIds = [...coreCompIds, ...(hasAnyLeadership ? leaderCompIds : [])];
            
            const allMatches = [];
            allCompIds.forEach(compId => {
              const isLeadership = leaderCompIds.includes(compId);
              const mentors = [];
              const mentees = [];
              
              employeeData.forEach(emp => {
                const score = isLeadership ? (emp.includeLeadership ? emp.leaderScores[compId] : 0) : emp.coreScores[compId];
                if (score >= 4) mentors.push({ name: emp.name, score, employeeId: emp.employeeId });
                else if (score > 0 && score <= 2) mentees.push({ name: emp.name, score, employeeId: emp.employeeId });
              });
              
              if (mentors.length > 0 && mentees.length > 0) {
                mentors.sort((a, b) => b.score - a.score);
                mentees.sort((a, b) => a.score - b.score);
                const mentor = mentors[0];
                const mentee = mentees[0];
                if (mentor.employeeId !== mentee.employeeId) {
                  allMatches.push({ mentor, mentee, compId, isLeadership, scoreDiff: mentor.score - mentee.score });
                }
              }
            });
            
            allMatches.sort((a, b) => b.scoreDiff - a.scoreDiff);
            return allMatches.slice(0, 3);
          }, [calibrationData]);
          
          // === HR ADMIN STATES ===
          const [isHRAdmin, setIsHRAdmin] = useState(false);
          const [allCompanyAppraisals, setAllCompanyAppraisals] = useState([]);
          const [allCompanyMembers, setAllCompanyMembers] = useState([]);
          const [hrDataLoading, setHRDataLoading] = useState(false);
          const [hrFilter, setHrFilter] = useState('all');
          const [hrSearch, setHrSearch] = useState('');
          const [hrLocationFilter, setHrLocationFilter] = useState('all'); // NEU: Standort-Filter
          const [hrGpsFilter, setHrGpsFilter] = useState('all'); // NEU: GPS-Range Filter
          
          // NEU: State f√ºr Kalibrierungs-Auswahl (welche Beurteilungen in Analyse einbeziehen)
          const [hrSelectedAppraisals, setHrSelectedAppraisals] = useState(new Set()); // Set von Appraisal-IDs
          const [hrSelectAll, setHrSelectAll] = useState(true); // Standard: alle ausw√§hlen
          const [hrManagerFilter, setHrManagerFilter] = useState('all'); // Filter nach Manager
          
          // NEU: State f√ºr Normalverteilungs-Analyse (Typ-Filter: Review vs. Selbstreflexion)
          const [hrCalibrationTypeFilter, setHrCalibrationTypeFilter] = useState('review'); // 'review', 'self', 'all'
          const [hrCalibrationSelectedIds, setHrCalibrationSelectedIds] = useState(new Set()); // Individuelle Auswahl
          const [hrCalibrationSelectAll, setHrCalibrationSelectAll] = useState(true); // Alle ausw√§hlen
          
          // NEU: State f√ºr Rater-Bias Mitarbeiter-Filter
          const [hrRaterBiasEmployeeFilter, setHrRaterBiasEmployeeFilter] = useState('all'); // 'all' oder Mitarbeiter-Name
          const [hrRaterBiasSelectedEmployees, setHrRaterBiasSelectedEmployees] = useState(new Set()); // Mehrfachauswahl Mitarbeiter
          const [hrRaterBiasSelectAllEmployees, setHrRaterBiasSelectAllEmployees] = useState(true); // Alle Mitarbeiter einbeziehen
          
          // NEU: State f√ºr Kompetenz-Radar (Spider Chart)
          const [hrRadarSelectedEmployees, setHrRadarSelectedEmployees] = useState([]); // Array von Appraisal-IDs (max 5)
          const [hrRadarShowLeadership, setHrRadarShowLeadership] = useState(false); // F√ºhrungskompetenzen anzeigen
          
          // NEU: State f√ºr Compensation & Benefits (Salary Review)
          const [compBudget, setCompBudget] = useState(100000); // Gesamtbudget in ‚Ç¨
          const [compEmployees, setCompEmployees] = useState([]); // Array von {id, name, position, currentSalary, gpsScore, discretionaryPercent, discretionaryFixed, jobGrade}
          const [compImportFromReviews, setCompImportFromReviews] = useState(false); // Import von Reviews
          
          // === NEU: SALARY REVIEW ACCESS SYSTEM ===
          // Rollen: 'hr_admin' (Vollzugriff), 'executive' (alle MA sehen/bearbeiten), 'manager' (nur eigene MA)
          const [salaryReviewAccess, setSalaryReviewAccess] = useState([]); // Array von {email, role, grantedBy, grantedAt, teamMemberIds?}
          const [salaryReviewHistory, setSalaryReviewHistory] = useState([]); // Array von {employeeId, changes: [{field, oldValue, newValue, changedBy, changedAt}]}
          const [showSalaryReviewWelcome, setShowSalaryReviewWelcome] = useState(false); // Welcome-Modal f√ºr neue Benutzer
          const [salaryReviewUserRole, setSalaryReviewUserRole] = useState(null); // Aktuelle Rolle des Users
          const [salaryReviewInviteModal, setShowSalaryReviewInviteModal] = useState(false); // Einladungs-Modal
          const [registeredUsers, setRegisteredUsers] = useState([]); // Liste aller registrierten Benutzer aus Firebase
          const [salaryReviewPendingSave, setSalaryReviewPendingSave] = useState(false); // Speichern pending
          
          // NEU: Sortierung und Filter f√ºr Salary Review
          const [salaryReviewSort, setSalaryReviewSort] = useState({ field: 'name', direction: 'asc' }); // Sortierung
          const [salaryReviewFilter, setSalaryReviewFilter] = useState(''); // Suchfilter
          const [salaryReviewAutoSaveTimer, setSalaryReviewAutoSaveTimer] = useState(null); // Auto-Save Timer
          const [showRecTable, setShowRecTable] = useState(false); // Empfehlungstabelle anzeigen
          
          // Salary Review Access Check
          const checkSalaryReviewAccess = (email) => {
            if (!email) return null;
            const emailLower = email.toLowerCase();
            // HR Admins haben immer Vollzugriff
            if (HR_ADMIN_EMAILS.includes(emailLower)) {
              return { role: 'hr_admin', canViewAll: true, canEditAll: true, canInvite: true, accessSalary: true, accessGoals: true };
            }
            // Pr√ºfe in der Access-Liste
            const access = salaryReviewAccess.find(a => a.email.toLowerCase() === emailLower);
            if (!access) return null;
            
            // Access-Flags auslesen (Default: true f√ºr R√ºckw√§rtskompatibilit√§t)
            const accessSalary = access.accessSalary !== false;
            const accessGoals = access.accessGoals !== false;
            
            if (access.role === 'executive') {
              return { role: 'executive', canViewAll: true, canEditAll: true, canInvite: false, accessSalary, accessGoals };
            }
            if (access.role === 'manager') {
              return { 
                role: 'manager', 
                canViewAll: false, 
                canEditAll: false, 
                canInvite: false,
                allowedEmployeeIds: access.teamMemberIds || [],
                accessSalary,
                accessGoals
              };
            }
            return null;
          };
          
          // Salary Review: √Ñnderung protokollieren
          const logSalaryChange = (employeeId, employeeName, field, oldValue, newValue, changedByEmail) => {
            const newEntry = {
              id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
              employeeId: employeeId,
              employeeName: employeeName,
              field: field,
              oldValue: oldValue,
              newValue: newValue,
              changedBy: changedByEmail,
              changedAt: new Date().toISOString()
            };
            setSalaryReviewHistory(prev => [...prev, newEntry]);
            return newEntry;
          };
          
          // Formatierung f√ºr History-Anzeige
          const formatFieldName = (field) => {
            const names = {
              'baseSalary': 'Jahresgehalt',
              'currentBonus': 'Aktueller Bonus',
              'increasePercent': 'Erh√∂hung %',
              'newBonus': 'Neuer Bonus',
              'currentSalary': 'Aktuelles Gehalt',
              'gpsScore': 'GPS-Score',
              'discretionaryPercent': 'Diskretion√§r %',
              'discretionaryFixed': 'Diskretion√§r ‚Ç¨',
              'jobGrade': 'Job Grade',
              'name': 'Name',
              'position': 'Position',
              'department': 'Abteilung'
            };
            return names[field] || field;
          };
          
          // === GEHALTSB√ÑNDER (Salary Bands) nach Job Grade ===
          // Typische Struktur f√ºr ein mittelst√§ndisches Unternehmen
          const SALARY_BANDS = {
            'P1': { name: 'Produktion Einstieg', min: 28000, mid: 32000, max: 36000 },
            'P2': { name: 'Produktion Erfahren', min: 32000, mid: 38000, max: 44000 },
            'P3': { name: 'Produktion Senior/Spezialist', min: 38000, mid: 45000, max: 52000 },
            'T1': { name: 'Technik/Verwaltung Einstieg', min: 35000, mid: 42000, max: 49000 },
            'T2': { name: 'Technik/Verwaltung Erfahren', min: 42000, mid: 52000, max: 62000 },
            'T3': { name: 'Technik/Verwaltung Senior', min: 52000, mid: 65000, max: 78000 },
            'M1': { name: 'Management Teamleiter', min: 55000, mid: 68000, max: 81000 },
            'M2': { name: 'Management Abteilungsleiter', min: 70000, mid: 85000, max: 100000 },
            'M3': { name: 'Management Bereichsleiter', min: 90000, mid: 110000, max: 130000 },
            'E1': { name: 'Executive/GL', min: 120000, mid: 150000, max: 180000 }
          };
          
          // Compa-Ratio berechnen: Aktuelles Gehalt / Midpoint √ó 100
          const calculateCompaRatio = (salary, jobGrade) => {
            if (!salary || !jobGrade || !SALARY_BANDS[jobGrade]) return null;
            const midpoint = SALARY_BANDS[jobGrade].mid;
            return (salary / midpoint) * 100;
          };
          
          // Compa-Ratio Interpretation
          const getCompaRatioInfo = (ratio) => {
            if (!ratio) return { status: 'unknown', color: 'gray', label: '‚Äî', recommendation: '' };
            if (ratio < 80) return { 
              status: 'critical-low', 
              color: 'red', 
              label: 'Stark unter Markt',
              recommendation: 'Priorit√§re Erh√∂hung empfohlen',
              bg: 'bg-red-100 text-red-700'
            };
            if (ratio < 90) return { 
              status: 'below', 
              color: 'orange', 
              label: 'Unter Markt',
              recommendation: '√úberdurchschnittliche Erh√∂hung pr√ºfen',
              bg: 'bg-orange-100 text-orange-700'
            };
            if (ratio <= 110) return { 
              status: 'at-market', 
              color: 'green', 
              label: 'Am Markt',
              recommendation: 'GPS-basierte Standarderh√∂hung',
              bg: 'bg-green-100 text-green-700'
            };
            if (ratio <= 120) return { 
              status: 'above', 
              color: 'blue', 
              label: '√úber Markt',
              recommendation: 'Moderate Erh√∂hung oder Entwicklung',
              bg: 'bg-blue-100 text-blue-700'
            };
            return { 
              status: 'critical-high', 
              color: 'purple', 
              label: 'Stark √ºber Markt',
              recommendation: 'Minimale/keine Erh√∂hung, Bef√∂rderung pr√ºfen',
              bg: 'bg-purple-100 text-purple-700'
            };
          };
          
          // NEU: HR Admin Sub-Tab Navigation
          const [hrSubTab, setHrSubTab] = useState('overview'); // 'overview', 'calibration', 'rater-bias'
          
          // NEU: State f√ºr aufgeklappte Beurteilung in Versions-Tab
          const [expandedVersionAppraisal, setExpandedVersionAppraisal] = useState(null);
          // NEU: State f√ºr Version-Detail-Modal (zeigt alle Kommentare etc.)
          const [hrVersionDetailModal, setHrVersionDetailModal] = useState(null); // { version, employeeName, appraisalId }
          
          // NEU: States f√ºr Ansehen/L√∂schen von Beurteilungen im HR-Dashboard
          const [hrViewAppraisal, setHrViewAppraisal] = useState(null); // Aktuell angezeigte Beurteilung
          const [hrEditAppraisal, setHrEditAppraisal] = useState(null); // Beurteilung zum Bearbeiten (HR Admin)
          const [hrDeleteConfirm, setHrDeleteConfirm] = useState(null); // Zu l√∂schende Beurteilung (Best√§tigung)
          const [hrRecalculating, setHrRecalculating] = useState(false); // GPS-Neuberechnung l√§uft
          
          // Funktion: GPS-Score f√ºr eine Beurteilung berechnen
          const calculateGPSForAppraisal = (appraisal) => {
            // Hole Core-Scores (aus selfCoreScores oder coreScores)
            const coreScores = appraisal.selfCoreScores || appraisal.coreScores || {};
            const coreValues = Object.values(coreScores).filter(v => typeof v === 'number' && v > 0);
            const wieCoreScore = coreValues.length > 0 ? coreValues.reduce((s, v) => s + v, 0) / coreValues.length : 0;
            
            // Hole Leader-Scores (aus selfLeaderScores oder leaderScores)
            const leaderScores = appraisal.selfLeaderScores || appraisal.leaderScores || {};
            const leaderValues = Object.values(leaderScores).filter(v => typeof v === 'number' && v > 0);
            const wieLeadScore = leaderValues.length > 0 ? leaderValues.reduce((s, v) => s + v, 0) / leaderValues.length : 0;
            const hasLeadership = appraisal.isManager || appraisal.includeLeadership || leaderValues.length > 0;
            
            // WAS Score aus Zielen
            let wasScore = appraisal.wasScore || 0;
            if (!wasScore && appraisal.goals && appraisal.goals.length > 0) {
              const goals = appraisal.goals;
              const totalWeight = goals.reduce((s, g) => s + (g.weight || 0), 0);
              if (totalWeight > 0) {
                wasScore = goals.reduce((s, g) => s + ((g.achievement || 0) * (g.weight || 0) / totalWeight), 0);
              }
            }
            
            // GPS berechnen
            let finalGPS = 0;
            if (wasScore > 0) {
              // WAS ist in Prozent (0-200), konvertiere zu 1-5 Skala
              const wasConverted = Math.min(5, Math.max(1, wasScore / 100 * 5));
              if (hasLeadership && wieLeadScore > 0) {
                finalGPS = (wasConverted * 0.5) + (wieCoreScore * 0.25) + (wieLeadScore * 0.25);
              } else if (wieCoreScore > 0) {
                finalGPS = (wasConverted * 0.5) + (wieCoreScore * 0.5);
              } else {
                finalGPS = wasConverted;
              }
            } else {
              // Nur WIE (keine Ziele)
              if (hasLeadership && wieLeadScore > 0) {
                finalGPS = (wieCoreScore * 0.5) + (wieLeadScore * 0.5);
              } else {
                finalGPS = wieCoreScore;
              }
            }
            
            return {
              gpsScore: finalGPS,
              wieCoreScore: wieCoreScore,
              wieLeadScore: hasLeadership ? wieLeadScore : null,
              wasScore: wasScore
            };
          };
          
          // Funktion: GPS f√ºr alle Beurteilungen ohne GPS neu berechnen
          const recalculateAllGPS = async () => {
            if (!db || hrRecalculating) return;
            
            setHrRecalculating(true);
            let updated = 0;
            
            try {
              for (const appraisal of allCompanyAppraisals) {
                // Pr√ºfe ob GPS fehlt aber Kompetenz-Daten vorhanden sind
                const hasCoreData = appraisal.selfCoreScores || appraisal.coreScores;
                const needsRecalc = (!appraisal.gpsScore || appraisal.gpsScore === 0) && hasCoreData;
                
                if (needsRecalc) {
                  const scores = calculateGPSForAppraisal(appraisal);
                  
                  if (scores.gpsScore > 0) {
                    await db.collection('teamAppraisals').doc(appraisal.id).update({
                      gpsScore: scores.gpsScore,
                      wieCoreScore: scores.wieCoreScore,
                      wieLeadScore: scores.wieLeadScore,
                      wasScore: scores.wasScore,
                      updatedAt: new Date().toISOString()
                    });
                    updated++;
                    devLog('‚úÖ GPS neu berechnet f√ºr:', appraisal.employeeName || appraisal.id, '‚Üí', scores.gpsScore.toFixed(2));
                  }
                }
              }
              
              showToast(lang === 'de' 
                ? `GPS-Neuberechnung: ${updated} aktualisiert`
                : `GPS recalculation: ${updated} updated`, 'success'
              );
            } catch (err) {
              console.error('GPS Recalc Error:', err);
              showToast(getText(lang, 'Ein Fehler ist aufgetreten', 'Si √® verificato un errore', 'An error occurred'), 'error');
            }
            
            setHrRecalculating(false);
          };
          
          // Funktion: Beurteilung l√∂schen
          const deleteHRAppraisal = async (appraisalId) => {
            if (!db || !appraisalId) return;
            
            try {
              await db.collection('teamAppraisals').doc(appraisalId).delete();
              devLog('üóëÔ∏è Beurteilung gel√∂scht:', appraisalId);
              setHrDeleteConfirm(null);
            } catch (err) {
              console.error('Delete Error:', err);
              showToast(getText(lang, 'Fehler beim L√∂schen', 'Errore durante eliminazione', 'Error deleting'), 'error');
            }
          };
          
          // === BACKUP & RESTORE FUNKTIONEN ===
          
          // Backup: Alle Daten als JSON exportieren
          const exportFullBackup = async () => {
            if (!db || !isHRAdmin) {
              showToast('Nur HR Admins k√∂nnen Backups erstellen', 'warning');
              return;
            }
            
            try {
              devLog('üì¶ Erstelle vollst√§ndiges Backup...');
              
              // Lade alle Collections
              const appraisalsSnap = await db.collection('teamAppraisals').get();
              const membersSnap = await db.collection('teamMembers').get();
              const salaryDataSnap = await db.collection('salaryReviewData').get();
              const salaryAccessSnap = await db.collection('salaryReviewAccess').get();
              
              const backup = {
                exportedAt: new Date().toISOString(),
                exportedBy: user?.email,
                version: 'v83',
                data: {
                  teamAppraisals: appraisalsSnap.docs.map(d => ({ id: d.id, ...d.data() })),
                  teamMembers: membersSnap.docs.map(d => ({ id: d.id, ...d.data() })),
                  salaryReviewData: salaryDataSnap.docs.map(d => ({ id: d.id, ...d.data() })),
                  salaryReviewAccess: salaryAccessSnap.docs.map(d => ({ id: d.id, ...d.data() }))
                }
              };
              
              // Als JSON-Datei herunterladen
              const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `niederwieser_backup_${new Date().toISOString().split('T')[0]}_${Date.now()}.json`;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
              
              devLog('‚úÖ Backup erstellt:', backup.data.teamAppraisals.length, 'Appraisals,', backup.data.teamMembers.length, 'Members');
              showToast(`Backup erstellt: ${backup.data.teamAppraisals.length} Beurteilungen, ${backup.data.teamMembers.length} Mitarbeiter`, "success");
              
            } catch (err) {
              console.error('Backup Error:', err);
              showToast('Fehler beim Backup', 'error');
            }
          };
          
          // Restore: Einzelne Beurteilung aus Backup wiederherstellen
          const restoreAppraisalFromBackup = async (appraisalData) => {
            if (!db || !isHRAdmin) {
              showToast('Nur HR Admins k√∂nnen Daten wiederherstellen', 'warning');
              return;
            }
            
            try {
              const docId = appraisalData.id;
              const dataToRestore = { ...appraisalData };
              delete dataToRestore.id; // ID nicht in Daten speichern
              dataToRestore.restoredAt = new Date().toISOString();
              dataToRestore.restoredBy = user?.email;
              
              await db.collection('teamAppraisals').doc(docId).set(dataToRestore, { merge: false });
              devLog('‚úÖ Beurteilung wiederhergestellt:', docId);
              return true;
            } catch (err) {
              console.error('Restore Error:', err);
              showToast('Fehler beim Wiederherstellen', 'error');
              return false;
            }
          };
          
          // Restore Modal State
          const [showRestoreModal, setShowRestoreModal] = useState(false);
          const [restoreData, setRestoreData] = useState(null);
          const [restorePreview, setRestorePreview] = useState([]);
          
          // Backup-Datei laden und analysieren
          const loadBackupFile = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const backup = JSON.parse(e.target.result);
                setRestoreData(backup);
                setRestorePreview(backup.data?.teamAppraisals || []);
                devLog('üì¶ Backup geladen:', backup.exportedAt, '-', backup.data?.teamAppraisals?.length, 'Appraisals');
              } catch (err) {
                showToast('Fehler beim Laden der Backup-Datei', 'error');
              }
            };
            reader.readAsText(file);
          };
          
          // Alle Appraisals aus Backup wiederherstellen
          const restoreAllFromBackup = async () => {
            if (!restoreData || !db || !isHRAdmin) return;
            
            const confirmMsg = `ACHTUNG: Dies wird ${restoreData.data.teamAppraisals.length} Beurteilungen wiederherstellen/√ºberschreiben!\n\nBackup vom: ${restoreData.exportedAt}\n\nFortfahren?`;
            if (!confirm(confirmMsg)) return;
            
            try {
              let restored = 0;
              let errors = 0;
              
              for (const appraisal of restoreData.data.teamAppraisals) {
                try {
                  const success = await restoreAppraisalFromBackup(appraisal);
                  if (success) restored++;
                  else errors++;
                } catch (err) {
                  errors++;
                  console.error('Restore error for', appraisal.id, err);
                }
              }
              
              showToast(`Wiederherstellung: ${restored} erfolgreich, ${errors} fehlgeschlagen`, restored > 0 ? "success" : "warning");
              setShowRestoreModal(false);
              setRestoreData(null);
              
            } catch (err) {
              showToast('Fehler bei der Wiederherstellung', 'error');
            }
          };
          
          // === FUNKTION: Versionshistorie f√ºr alle Beurteilungen initialisieren ===
          const initializeVersionHistoryForAll = async () => {
            if (!db || !isHRAdmin) {
              showToast('Nur HR Admins k√∂nnen die Versionshistorie initialisieren', 'warning');
              return;
            }
            
            const confirmMsg = `Diese Funktion erstellt f√ºr ALLE ${allCompanyAppraisals.length} Beurteilungen eine initiale Version als Sicherung.\n\nDies sollte einmalig ausgef√ºhrt werden, um bestehende Daten zu sichern.\n\nFortfahren?`;
            if (!confirm(confirmMsg)) return;
            
            try {
              let updated = 0;
              let skipped = 0;
              let errors = 0;
              
              for (const appraisal of allCompanyAppraisals) {
                try {
                  // Pr√ºfe ob bereits eine Versionshistorie existiert
                  if (appraisal.versionHistory && appraisal.versionHistory.length > 0) {
                    skipped++;
                    continue;
                  }
                  
                  // Pr√ºfe ob relevante Daten vorhanden sind
                  const hasData = appraisal.gpsScore > 0 || 
                                  (appraisal.goals && appraisal.goals.length > 0) || 
                                  appraisal.coreScores ||
                                  (appraisal.formData && Object.keys(appraisal.formData).length > 0);
                  
                  if (!hasData) {
                    skipped++;
                    continue;
                  }
                  
                  // Erstelle initiale Version
                  const initialVersion = {
                    savedAt: appraisal.updatedAt || appraisal.createdAt || new Date().toISOString(),
                    savedStatus: appraisal.status || 'unknown',
                    initializedBy: 'HR Admin - Bulk Initialize',
                    gpsScore: appraisal.gpsScore || 0,
                    wasScore: appraisal.wasScore || 0,
                    wieCoreScore: appraisal.wieCoreScore || 0,
                    wieLeaderScore: appraisal.wieLeaderScore || appraisal.wieLeadScore || 0,
                    goals: appraisal.goals ? JSON.parse(JSON.stringify(appraisal.goals)) : [],
                    coreScores: appraisal.coreScores ? { ...appraisal.coreScores } : {},
                    coreComments: appraisal.coreComments ? { ...appraisal.coreComments } : {},
                    leaderScores: appraisal.leaderScores ? { ...appraisal.leaderScores } : {},
                    leaderComments: appraisal.leaderComments ? { ...appraisal.leaderComments } : {},
                    formData: appraisal.formData ? { ...appraisal.formData } : {},
                    careerChecks: appraisal.careerChecks,
                    devPlan: appraisal.devPlan
                  };
                  
                  // Speichere in Firebase
                  await db.collection('teamAppraisals').doc(appraisal.id).update({
                    versionHistory: [initialVersion]
                  });
                  
                  updated++;
                  devLog('üìö Version History initialisiert f√ºr:', appraisal.employeeName || appraisal.id);
                  
                } catch (err) {
                  errors++;
                  console.error('Error initializing version for', appraisal.id, err);
                }
              }
              
              showToast(`Versionshistorie: ${updated} aktualisiert, ${skipped} √ºbersprungen`, updated > 0 ? "success" : "info");
              
            } catch (err) {
              showToast('Fehler bei der Initialisierung', 'error');
            }
          };
          
          // === AUTOMATISCHE MANAGER-ID REPARATUR (l√§uft still im Hintergrund) ===
          // Diese Funktion repariert Beurteilungen, bei denen userId/managerId fehlt oder falsch ist
          // Sie l√§uft automatisch wenn HR-Daten geladen werden - KEINE Benutzerinteraktion n√∂tig
          const autoRepairManagerIdsRef = React.useRef(false); // Verhindert mehrfaches Ausf√ºhren
          
          React.useEffect(() => {
            // Nur f√ºr HR Admins und nur einmal ausf√ºhren
            if (!db || !isHRAdmin || !user || guestMode) return;
            if (autoRepairManagerIdsRef.current) return;
            if (allCompanyAppraisals.length === 0 || allCompanyMembers.length === 0) return;
            
            // Markiere als gestartet
            autoRepairManagerIdsRef.current = true;
            
            const runAutoRepair = async () => {
              try {
                devLog('üîß [Auto-Repair] Starte automatische userId/managerId Pr√ºfung...');
                
                // 1. Erstelle Employee ‚Üí Manager Mapping aus teamMembers
                // WICHTIG: userId im teamMember ist die ID des MANAGERS (Besitzer)
                const employeeToManager = {};
                allCompanyMembers.forEach(member => {
                  if (member.id && member.userId) {
                    employeeToManager[member.id] = {
                      managerId: member.userId, // Das ist die korrekte Manager-UID
                      managerName: member.managerName || null
                    };
                  }
                });
                
                devLog('üîß [Auto-Repair] Mapping erstellt:', Object.keys(employeeToManager).length, 'Mitarbeiter');
                
                // 2. Finde Beurteilungen die repariert werden m√ºssen
                const needsRepair = [];
                
                for (const appraisal of allCompanyAppraisals) {
                  if (!appraisal.employeeId) continue;
                  
                  const mapping = employeeToManager[appraisal.employeeId];
                  if (!mapping) continue;
                  
                  const correctManagerId = mapping.managerId;
                  const currentUserId = appraisal.userId;
                  const currentManagerId = appraisal.managerId;
                  
                  // Reparatur n√∂tig wenn:
                  // - userId fehlt oder ist falsch (KRITISCH - bestimmt Sichtbarkeit!)
                  // - managerId fehlt oder ist falsch
                  const userIdWrong = !currentUserId || currentUserId !== correctManagerId;
                  const managerIdWrong = !currentManagerId || currentManagerId !== correctManagerId;
                  
                  if (userIdWrong || managerIdWrong) {
                    needsRepair.push({
                      appraisal,
                      correctManagerId,
                      currentUserId: currentUserId || 'MISSING',
                      currentManagerId: currentManagerId || 'MISSING',
                      userIdWrong,
                      managerIdWrong
                    });
                  }
                }
                
                if (needsRepair.length === 0) {
                  devLog('‚úÖ [Auto-Repair] Alle userId/managerId sind korrekt - keine Reparatur n√∂tig');
                  return;
                }
                
                devLog(`üîß [Auto-Repair] ${needsRepair.length} Beurteilungen m√ºssen repariert werden`);
                
                // 3. Repariere still im Hintergrund
                let repaired = 0;
                let errors = 0;
                
                for (const { appraisal, correctManagerId, currentUserId, currentManagerId, userIdWrong, managerIdWrong } of needsRepair) {
                  try {
                    // SICHERHEIT: Nur userId und managerId werden ge√§ndert, NICHTS wird gel√∂scht
                    const updateData = {
                      // KRITISCH: userId muss korrekt sein f√ºr Query .where('userId', '==', ...)
                      userId: correctManagerId,
                      managerId: correctManagerId,
                      // Audit-Trail f√ºr Nachverfolgbarkeit
                      _autoRepairedAt: new Date().toISOString(),
                      _autoRepairedUserIdFrom: currentUserId,
                      _autoRepairedManagerIdFrom: currentManagerId,
                      _autoRepairedBy: 'system_auto_repair_v94'
                    };
                    
                    await db.collection('teamAppraisals').doc(appraisal.id).update(updateData);
                    
                    repaired++;
                    devLog(`  ‚úì Repariert: ${appraisal.id}`);
                    devLog(`    userId updated`);
                    devLog(`    managerId updated`);
                    
                  } catch (err) {
                    errors++;
                    console.warn(`  ‚úó Fehler bei ${appraisal.id}:`, err.message);
                  }
                }
                
                devLog(`‚úÖ [Auto-Repair] Abgeschlossen: ${repaired} repariert, ${errors} Fehler`);
                
                // Optional: Zeige dezente Benachrichtigung wenn Reparaturen durchgef√ºhrt wurden
                if (repaired > 0) {
                  addDebugLog('success', `Auto-Repair: ${repaired} Dokumente korrigiert (userId + managerId)`);
                }
                
              } catch (err) {
                console.error('‚ùå [Auto-Repair] Fehler:', err);
              }
            };
            
            // Starte Reparatur nach kurzer Verz√∂gerung (damit alle Daten geladen sind)
            const timer = setTimeout(runAutoRepair, 2000);
            return () => clearTimeout(timer);
            
          }, [isHRAdmin, allCompanyAppraisals, allCompanyMembers, db, user, guestMode]);
          
          // === MANUELLE REPARATUR-FUNKTION (f√ºr HR Dashboard - mit Bericht) ===
          const repairManagerIds = async () => {
            if (!db || !isHRAdmin) {
              showToast('Nur HR Admins k√∂nnen Manager-IDs reparieren', 'warning');
              return;
            }
            
            const confirmMsg = `üîß BESITZER-REPARATUR (userId + managerId)\n\nDieses Tool analysiert alle Beurteilungen und korrigiert:\n‚Ä¢ userId (bestimmt welcher Manager das Dokument sieht)\n‚Ä¢ managerId (Referenz zum Manager)\n\n‚úÖ SICHERHEIT:\n‚Ä¢ Es werden NUR userId und managerId korrigiert\n‚Ä¢ KEINE Daten werden gel√∂scht\n‚Ä¢ Jede √Ñnderung wird protokolliert\n‚Ä¢ Originalwerte werden gespeichert\n\nFortfahren?`;
            if (!confirm(confirmMsg)) return;
            
            try {
              devLog('üîß Starte Besitzer-Analyse (userId + managerId)...');
              
              // 1. Lade alle teamMembers (Mitarbeiter ‚Üí Manager Zuordnung)
              const teamMembersSnap = await db.collection('teamMembers').get();
              const employeeToManager = {};
              
              teamMembersSnap.docs.forEach(doc => {
                const data = doc.data();
                const employeeId = doc.id;
                const managerId = data.userId; // userId im teamMember = Manager-UID
                
                if (employeeId && managerId) {
                  employeeToManager[employeeId] = {
                    managerId: managerId,
                    managerEmail: data.managerEmail || null,
                    employeeName: data.name || 'Unbekannt'
                  };
                }
              });
              
              devLog('üìã Employee-Manager Mapping geladen:', Object.keys(employeeToManager).length, 'Eintr√§ge');
              
              // 2. Analysiere alle Beurteilungen
              let repaired = 0;
              let alreadyCorrect = 0;
              let noMapping = 0;
              let errors = 0;
              const repairLog = [];
              
              for (const appraisal of allCompanyAppraisals) {
                try {
                  const employeeId = appraisal.employeeId;
                  
                  if (!employeeId) {
                    noMapping++;
                    repairLog.push({
                      employee: appraisal.employeeName || 'Unbekannt',
                      status: '‚ö†Ô∏è Keine employeeId',
                      action: '√úbersprungen'
                    });
                    continue;
                  }
                  
                  const mapping = employeeToManager[employeeId];
                  
                  if (!mapping) {
                    noMapping++;
                    repairLog.push({
                      employee: appraisal.employeeName || employeeId,
                      status: '‚ö†Ô∏è Kein Mapping',
                      action: 'Mitarbeiter nicht in teamMembers'
                    });
                    continue;
                  }
                  
                  const correctManagerId = mapping.managerId;
                  const currentUserId = appraisal.userId;
                  const currentManagerId = appraisal.managerId;
                  
                  // Pr√ºfe ob beide korrekt sind
                  const userIdCorrect = currentUserId === correctManagerId;
                  const managerIdCorrect = currentManagerId === correctManagerId;
                  
                  if (userIdCorrect && managerIdCorrect) {
                    alreadyCorrect++;
                    continue;
                  }
                  
                  // Reparatur durchf√ºhren - NUR userId und managerId √§ndern, NICHTS l√∂schen
                  devLog(`üîß Repariere: ${appraisal.id}`);
                  devLog(`   userId updated`);
                  devLog(`   managerId updated`);
                  
                  await db.collection('teamAppraisals').doc(appraisal.id).update({
                    userId: correctManagerId,
                    managerId: correctManagerId,
                    // Audit-Trail
                    _repairedAt: new Date().toISOString(),
                    _repairedUserIdFrom: currentUserId || 'MISSING',
                    _repairedManagerIdFrom: currentManagerId || 'MISSING',
                    _repairedBy: user?.email || 'HR Admin'
                  });
                  
                  repaired++;
                  repairLog.push({
                    employee: appraisal.employeeName || employeeId,
                    status: '‚úÖ Repariert',
                    action: `userId: ${currentUserId || 'FEHLT'} ‚Üí ${correctManagerId}`
                  });
                  
                } catch (err) {
                  errors++;
                  console.error('Fehler bei Reparatur:', appraisal.id, err);
                  repairLog.push({
                    employee: appraisal.employeeName || appraisal.id,
                    status: '‚ùå Fehler',
                    action: err.message
                  });
                }
              }
              
              // 3. Detaillierten Bericht anzeigen
              devLog('üîß Reparatur abgeschlossen:', { repaired, alreadyCorrect, noMapping, errors });
              console.table(repairLog);
              
              const resultMsg = `‚úÖ BESITZER-REPARATUR ABGESCHLOSSEN\n\n` +
                `üìä ERGEBNIS:\n` +
                `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n` +
                `üîß Repariert:        ${repaired}\n` +
                `‚úì  Bereits korrekt:  ${alreadyCorrect}\n` +
                `‚ö†Ô∏è  Kein Mapping:     ${noMapping}\n` +
                `‚ùå Fehler:           ${errors}\n` +
                `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n` +
                `üìù Gesamt gepr√ºft:   ${allCompanyAppraisals.length}\n\n` +
                (repaired > 0 
                  ? `Die F√ºhrungskr√§fte k√∂nnen ihre Beurteilungen jetzt wieder sehen!\n\nüìã Details in der Browser-Konsole (F12)`
                  : `Alle Besitzer-Zuordnungen waren bereits korrekt.`);
              
              showToast(resultMsg, "info");
              
            } catch (err) {
              console.error('Besitzer-Reparatur fehlgeschlagen:', err);
              showToast('Fehler bei der Analyse', 'error');
            }
          };
          
          // === HR PDF/PRINT EXPORT FUNKTIONEN ===
          const exportHRAppraisalAsPDF = async (appraisal) => {
            if (!window.html2pdf) {
              showToast(getText(lang, 'PDF-Export nicht verf√ºgbar', 'Export PDF non disponibile', 'PDF export not available'), 'error');
              return;
            }
            
            devLog('üìÑ PDF Export f√ºr HR Dashboard:', appraisal);
            devLog('üìÑ Vollst√§ndige Appraisal-Daten:', JSON.stringify(appraisal, null, 2));
            
            const employeeName = appraisal.employeeName || appraisal.formData?.employee || appraisal.selfFormData?.employee || 'Unbekannt';
            const isSelf = appraisal.type === 'self' || appraisal.type === 'self_assessment' || appraisal.type === 'self-reflection' || appraisal.type === 'self_assessment_standalone';
            const docType = isSelf 
              ? (lang === 'de' ? 'Selbstreflexion' : lang === 'it' ? 'Autovalutazione' : 'Self-Reflection')
              : (lang === 'de' ? 'Leistungsbeurteilung' : lang === 'it' ? 'Valutazione delle prestazioni' : 'Performance Review');
            const filename = (isSelf ? getText(lang, 'Selbstreflexion', 'Autovalutazione', 'Self-Reflection') : getText(lang, 'Beurteilung', 'Valutazione', 'Review')) + '_' + employeeName.replace(/[^a-z0-9√§√∂√º√ü]/gi, '_') + '.pdf';
            
            const gps = appraisal.gpsScore || 0;
            const wasScore = appraisal.wasScore || 0;
            const wieScore = appraisal.wieCoreScore || appraisal.wieScore || 0;
            const wieLeaderScore = appraisal.wieLeaderScore || 0;
            const position = appraisal.formData?.position || appraisal.selfFormData?.position || appraisal.position || '';
            const manager = appraisal.formData?.manager || appraisal.selfFormData?.manager || '';
            const dateStr = new Date().toLocaleDateString('de-DE');
            const reviewDate = appraisal.formData?.date || appraisal.selfFormData?.date || '';
            
            // Daten je nach Typ (Self vs Review)
            const formData = isSelf ? (appraisal.selfFormData || appraisal.formData || {}) : (appraisal.formData || {});
            const goals = appraisal.goals || [];
            
            // Scores und Kommentare - unterschiedlich f√ºr Self vs Review
            const coreScores = isSelf ? (appraisal.selfCoreScores || {}) : (appraisal.coreScores || {});
            const coreComments = isSelf ? (appraisal.selfCoreComments || {}) : (appraisal.coreComments || {});
            const leaderScores = isSelf ? (appraisal.selfLeaderScores || {}) : (appraisal.leaderScores || {});
            const leaderComments = isSelf ? (appraisal.selfLeaderComments || {}) : (appraisal.leaderComments || {});
            
            // GPS Farbe und Note
            const gpsColor = gps >= 4.51 ? '#16a34a' : (gps >= 3.51 ? '#059669' : (gps >= 2.51 ? '#2563eb' : (gps >= 1.51 ? '#d97706' : (gps > 0 ? '#dc2626' : '#64748b'))));
            const gpsNote = gps >= 4.51 ? '5 - Outstanding' : (gps >= 3.51 ? '4 - Exceeds' : (gps >= 2.51 ? '3 - Meets' : (gps >= 1.51 ? '2 - Needs Improvement' : '1 - Does Not Meet')));
            
            // Container erstellen
            const pdfContainer = document.createElement('div');
            pdfContainer.style.cssText = 'width: 190mm; box-sizing: border-box; padding: 10mm 12mm; background: white; font-family: Arial, sans-serif; color: #1e293b; font-size: 10pt; line-height: 1.4;';
            
            // Kompetenz-Score Lookup Helper - erweitert f√ºr alle m√∂glichen Keys
            const getScore = (scores, keys) => {
              if (!scores) return 0;
              for (let k of keys) {
                if (scores[k] !== undefined && scores[k] > 0) return scores[k];
              }
              return 0;
            };
            
            const getComment = (comments, keys) => {
              if (!comments) return '';
              for (let k of keys) {
                if (comments[k] && comments[k].trim()) return comments[k];
              }
              return '';
            };
            
            // Escape HTML f√ºr sichere Ausgabe
            const escapeHtml = (text) => {
              if (!text) return '';
              return String(text)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
            };
            
            // HTML aufbauen
            let pdfHTML = '';
            
            // === HEADER ===
            pdfHTML += '<div style="margin-bottom: 15px; border-bottom: 3px solid #243186; padding-bottom: 12px;">';
            pdfHTML += '<table style="width: 100%;"><tr>';
            pdfHTML += '<td style="vertical-align: top;">';
            pdfHTML += '<h1 style="color: #243186; font-size: 22pt; margin: 0 0 3px 0; font-weight: bold;">nƒ±ederwƒ±eser</h1>';
            pdfHTML += '<p style="color: #6EBD84; font-size: 9pt; margin: 0; font-weight: 600; letter-spacing: 1px;">FLEXIBLE FOOD PACKAGING</p>';
            pdfHTML += '</td>';
            pdfHTML += '<td style="vertical-align: top; text-align: right;">';
            pdfHTML += '<h2 style="color: #243186; font-size: 16pt; margin: 0 0 5px 0;">' + docType + '</h2>';
            pdfHTML += '<p style="color: #64748b; font-size: 9pt; margin: 0;">Performance Review ' + new Date().getFullYear() + '</p>';
            pdfHTML += '<p style="color: #64748b; font-size: 9pt; margin: 2px 0 0 0;">Export: ' + dateStr + '</p>';
            pdfHTML += '</td></tr></table>';
            pdfHTML += '</div>';
            
            // === MITARBEITER INFO ===
            pdfHTML += '<div style="margin-bottom: 12px; padding: 10px; border: 1px solid #e2e8f0; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 4px;">';
            pdfHTML += '<table style="width: 100%; border-collapse: collapse;">';
            pdfHTML += '<tr>';
            pdfHTML += '<td style="padding: 4px 8px; width: 25%;"><span style="font-size: 8pt; color: #64748b; text-transform: uppercase;">Mitarbeiter</span><br/><strong style="font-size: 12pt; color: #1e293b;">' + escapeHtml(employeeName) + '</strong></td>';
            pdfHTML += '<td style="padding: 4px 8px; width: 25%;"><span style="font-size: 8pt; color: #64748b; text-transform: uppercase;">Position</span><br/><strong style="color: #1e293b;">' + escapeHtml(position || '‚Äì') + '</strong></td>';
            if (manager) {
              pdfHTML += '<td style="padding: 4px 8px; width: 25%;"><span style="font-size: 8pt; color: #64748b; text-transform: uppercase;">F√ºhrungskraft</span><br/><strong style="color: #1e293b;">' + escapeHtml(manager) + '</strong></td>';
            }
            pdfHTML += '<td style="padding: 4px 8px; width: 25%;"><span style="font-size: 8pt; color: #64748b; text-transform: uppercase;">Status</span><br/><strong style="color: ' + (appraisal.status === 'completed' ? '#059669' : '#d97706') + ';">' + (appraisal.status === 'completed' ? '‚úì Abgeschlossen' : '‚úé Entwurf') + '</strong></td>';
            pdfHTML += '</tr></table></div>';
            
            // === GPS SCORE BOX ===
            pdfHTML += '<div style="margin-bottom: 12px; padding: 15px; background: ' + gpsColor + '; color: white; text-align: center; border-radius: 6px;">';
            pdfHTML += '<p style="margin: 0 0 3px 0; font-size: 10pt; opacity: 0.9;">Global Performance Score (GPS)</p>';
            pdfHTML += '<p style="margin: 0; font-size: 32pt; font-weight: bold;">' + (gps > 0 ? gps.toFixed(2) : '‚Äì') + '</p>';
            if (gps > 0) pdfHTML += '<p style="margin: 5px 0 0 0; font-size: 11pt; opacity: 0.9;">' + gpsNote + '</p>';
            pdfHTML += '<div style="margin-top: 10px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.3); display: flex; justify-content: center; gap: 40px;">';
            pdfHTML += '<span style="font-size: 10pt;">WAS (50%): <strong>' + (wasScore > 0 ? (wasScore > 5 ? wasScore.toFixed(0) + '%' : wasScore.toFixed(2)) : '‚Äì') + '</strong></span>';
            pdfHTML += '<span style="font-size: 10pt;">WIE (50%): <strong>' + (wieScore > 0 ? wieScore.toFixed(2) : '‚Äì') + '</strong></span>';
            if (wieLeaderScore > 0) pdfHTML += '<span style="font-size: 10pt;">WIE-FK: <strong>' + wieLeaderScore.toFixed(2) + '</strong></span>';
            pdfHTML += '</div></div>';
            
            // === ZIELE ===
            if (goals.length > 0) {
              pdfHTML += '<div style="margin-bottom: 12px; padding: 10px; border: 1px solid #e2e8f0; border-radius: 4px; page-break-inside: avoid;">';
              pdfHTML += '<h3 style="font-size: 12pt; margin: 0 0 8px 0; color: #243186; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px;">üéØ Ziele (WAS-Komponente)</h3>';
              pdfHTML += '<table style="width: 100%; border-collapse: collapse; font-size: 9pt;">';
              pdfHTML += '<thead><tr style="background: #f8fafc;">';
              pdfHTML += '<th style="border: 1px solid #cbd5e1; padding: 5px; text-align: center; width: 30px;">#</th>';
              pdfHTML += '<th style="border: 1px solid #cbd5e1; padding: 5px; text-align: left;">Ziel</th>';
              pdfHTML += '<th style="border: 1px solid #cbd5e1; padding: 5px; text-align: center; width: 60px;">Gewicht</th>';
              pdfHTML += '<th style="border: 1px solid #cbd5e1; padding: 5px; text-align: center; width: 70px;">Erreichung</th>';
              pdfHTML += '</tr></thead><tbody>';
              goals.forEach((g, i) => {
                const ach = g.achievement || g.a || 0;
                const achColor = ach >= 100 ? '#059669' : (ach >= 80 ? '#2563eb' : '#d97706');
                pdfHTML += '<tr>';
                pdfHTML += '<td style="border: 1px solid #cbd5e1; padding: 5px; text-align: center;">' + (i+1) + '</td>';
                pdfHTML += '<td style="border: 1px solid #cbd5e1; padding: 5px;">' + escapeHtml(g.name || g.n || '‚Äì') + '</td>';
                pdfHTML += '<td style="border: 1px solid #cbd5e1; padding: 5px; text-align: center;">' + (g.weight || g.w || 0) + '%</td>';
                pdfHTML += '<td style="border: 1px solid #cbd5e1; padding: 5px; text-align: center; font-weight: bold; color: ' + achColor + ';">' + ach + '%</td>';
                pdfHTML += '</tr>';
              });
              pdfHTML += '</tbody></table></div>';
            }
            
            // === KERNKOMPETENZEN MIT BEWERTUNGEN UND KOMMENTAREN ===
            const coreCompDefs = [
              {keys: ['fach', 'c1', 'C1', 'fachkompetenz'], label: 'Fachkompetenz & Anwendung', short: 'Fach'},
              {keys: ['komm', 'c2', 'C2', 'kommunikation'], label: 'Kommunikation & Zusammenarbeit', short: 'Komm'},
              {keys: ['prob', 'c3', 'C3', 'problemloesung'], label: 'Probleml√∂sekompetenz', short: 'Prob'},
              {keys: ['adapt', 'c4', 'C4', 'anpassung'], label: 'Anpassungsf√§higkeit', short: 'Adapt'},
              {keys: ['orga', 'c5', 'C5', 'selbstorganisation'], label: 'Selbstorganisation', short: 'Orga'}
            ];
            
            const hasAnyCoreScore = coreCompDefs.some(c => getScore(coreScores, c.keys) > 0);
            
            if (hasAnyCoreScore || Object.keys(coreScores).length > 0) {
              pdfHTML += '<div style="margin-bottom: 12px; padding: 10px; border: 1px solid #e2e8f0; border-radius: 4px; page-break-inside: avoid;">';
              pdfHTML += '<h3 style="font-size: 12pt; margin: 0 0 8px 0; color: #243186; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px;">üí° Kernkompetenzen (WIE-Komponente)</h3>';
              
              // Score-√úbersicht
              pdfHTML += '<table style="width: 100%; border-collapse: collapse; margin-bottom: 10px;"><tr>';
              coreCompDefs.forEach(comp => {
                const score = getScore(coreScores, comp.keys);
                const color = score >= 4 ? '#059669' : (score >= 3 ? '#2563eb' : (score >= 2 ? '#d97706' : '#94a3b8'));
                pdfHTML += '<td style="width: 20%; text-align: center; padding: 3px;">';
                pdfHTML += '<div style="background: #f8fafc; padding: 8px 5px; border-radius: 4px; border: 1px solid #e2e8f0;">';
                pdfHTML += '<p style="margin: 0 0 3px 0; font-size: 8pt; color: #64748b;">' + comp.short + '</p>';
                pdfHTML += '<p style="margin: 0; font-size: 18pt; font-weight: bold; color: ' + color + ';">' + (score > 0 ? score.toFixed(1) : '‚Äì') + '</p>';
                pdfHTML += '</div></td>';
              });
              pdfHTML += '</tr></table>';
              
              // Detaillierte Kommentare
              const hasAnyComment = coreCompDefs.some(c => getComment(coreComments, c.keys));
              if (hasAnyComment) {
                pdfHTML += '<div style="background: #f8fafc; padding: 8px; border-radius: 4px; font-size: 9pt;">';
                pdfHTML += '<p style="margin: 0 0 5px 0; font-weight: bold; color: #475569;">Kommentare zu Kernkompetenzen:</p>';
                coreCompDefs.forEach(comp => {
                  const comment = getComment(coreComments, comp.keys);
                  const score = getScore(coreScores, comp.keys);
                  if (comment || score > 0) {
                    pdfHTML += '<div style="margin-bottom: 5px; padding: 5px; background: white; border-left: 3px solid #243186; border-radius: 2px;">';
                    pdfHTML += '<strong style="color: #243186;">' + comp.label + ' (' + (score > 0 ? score.toFixed(1) : '‚Äì') + '):</strong> ';
                    pdfHTML += '<span style="color: #475569;">' + escapeHtml(comment || 'Kein Kommentar') + '</span>';
                    pdfHTML += '</div>';
                  }
                });
                pdfHTML += '</div>';
              }
              pdfHTML += '</div>';
            }
            
            // === F√úHRUNGSKOMPETENZEN MIT BEWERTUNGEN UND KOMMENTAREN ===
            const leaderCompDefs = [
              {keys: ['lead', 'l1', 'L1', 'mitarbeiterfuehrung'], label: 'Mitarbeiterf√ºhrung & -entwicklung', short: 'Lead'},
              {keys: ['strat', 'l2', 'L2', 'strategisch'], label: 'Strategisches Denken', short: 'Strat'},
              {keys: ['decide', 'l3', 'L3', 'entscheidung'], label: 'Entscheidungsf√§higkeit', short: 'Decide'},
              {keys: ['exec', 'l4', 'L4', 'umsetzung'], label: 'Umsetzungsst√§rke', short: 'Exec'},
              {keys: ['stake', 'l5', 'L5', 'stakeholder'], label: 'Stakeholder-Management', short: 'Stake'}
            ];
            
            const hasAnyLeaderScore = leaderCompDefs.some(c => getScore(leaderScores, c.keys) > 0);
            
            if (hasAnyLeaderScore || (Object.keys(leaderScores).length > 0 && Object.values(leaderScores).some(v => v > 0))) {
              pdfHTML += '<div style="margin-bottom: 12px; padding: 10px; border: 1px solid #e9d5ff; border-radius: 4px; background: #faf5ff; page-break-inside: avoid;">';
              pdfHTML += '<h3 style="font-size: 12pt; margin: 0 0 8px 0; color: #7c3aed; border-bottom: 1px solid #e9d5ff; padding-bottom: 5px;">üëî F√ºhrungskompetenzen</h3>';
              
              // Score-√úbersicht
              pdfHTML += '<table style="width: 100%; border-collapse: collapse; margin-bottom: 10px;"><tr>';
              leaderCompDefs.forEach(comp => {
                const score = getScore(leaderScores, comp.keys);
                const color = score >= 4 ? '#7c3aed' : (score >= 3 ? '#8b5cf6' : (score >= 2 ? '#a78bfa' : '#c4b5fd'));
                pdfHTML += '<td style="width: 20%; text-align: center; padding: 3px;">';
                pdfHTML += '<div style="background: white; padding: 8px 5px; border-radius: 4px; border: 1px solid #e9d5ff;">';
                pdfHTML += '<p style="margin: 0 0 3px 0; font-size: 8pt; color: #7c3aed;">' + comp.short + '</p>';
                pdfHTML += '<p style="margin: 0; font-size: 18pt; font-weight: bold; color: ' + color + ';">' + (score > 0 ? score.toFixed(1) : '‚Äì') + '</p>';
                pdfHTML += '</div></td>';
              });
              pdfHTML += '</tr></table>';
              
              // Detaillierte Kommentare
              const hasAnyLeaderComment = leaderCompDefs.some(c => getComment(leaderComments, c.keys));
              if (hasAnyLeaderComment) {
                pdfHTML += '<div style="background: white; padding: 8px; border-radius: 4px; font-size: 9pt;">';
                pdfHTML += '<p style="margin: 0 0 5px 0; font-weight: bold; color: #7c3aed;">Kommentare zu F√ºhrungskompetenzen:</p>';
                leaderCompDefs.forEach(comp => {
                  const comment = getComment(leaderComments, comp.keys);
                  const score = getScore(leaderScores, comp.keys);
                  if (comment || score > 0) {
                    pdfHTML += '<div style="margin-bottom: 5px; padding: 5px; background: #faf5ff; border-left: 3px solid #7c3aed; border-radius: 2px;">';
                    pdfHTML += '<strong style="color: #7c3aed;">' + comp.label + ' (' + (score > 0 ? score.toFixed(1) : '‚Äì') + '):</strong> ';
                    pdfHTML += '<span style="color: #475569;">' + escapeHtml(comment || 'Kein Kommentar') + '</span>';
                    pdfHTML += '</div>';
                  }
                });
                pdfHTML += '</div>';
              }
              pdfHTML += '</div>';
            }
            
            // === TEXTFELDER - ST√ÑRKEN & ENTWICKLUNG ===
            const hasStrengths = formData.strengths1 || formData.strengths2;
            if (hasStrengths) {
              pdfHTML += '<div style="margin-bottom: 12px; padding: 10px; border: 1px solid #e2e8f0; border-radius: 4px; page-break-inside: avoid;">';
              pdfHTML += '<h3 style="font-size: 12pt; margin: 0 0 8px 0; color: #243186; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px;">üí™ St√§rken & Entwicklungsfelder</h3>';
              pdfHTML += '<table style="width: 100%; border-collapse: collapse;"><tr>';
              pdfHTML += '<td style="width: 50%; vertical-align: top; padding-right: 10px;">';
              pdfHTML += '<div style="background: #f0fdf4; padding: 8px; border-radius: 4px; border-left: 3px solid #22c55e; min-height: 60px;">';
              pdfHTML += '<p style="margin: 0 0 5px 0; font-weight: bold; color: #166534; font-size: 9pt;">St√§rken:</p>';
              pdfHTML += '<p style="margin: 0; font-size: 9pt; color: #334155; white-space: pre-wrap;">' + escapeHtml(formData.strengths1 || getText(lang, 'Keine Angabe', 'Non specificato', 'Not specified')) + '</p>';
              pdfHTML += '</div></td>';
              pdfHTML += '<td style="width: 50%; vertical-align: top; padding-left: 10px;">';
              pdfHTML += '<div style="background: #fef3c7; padding: 8px; border-radius: 4px; border-left: 3px solid #f59e0b; min-height: 60px;">';
              pdfHTML += '<p style="margin: 0 0 5px 0; font-weight: bold; color: #92400e; font-size: 9pt;">Entwicklungsfelder:</p>';
              pdfHTML += '<p style="margin: 0; font-size: 9pt; color: #334155; white-space: pre-wrap;">' + escapeHtml(formData.strengths2 || getText(lang, 'Keine Angabe', 'Non specificato', 'Not specified')) + '</p>';
              pdfHTML += '</div></td>';
              pdfHTML += '</tr></table></div>';
            }
            
            // === KARRIERE-KOMMENTAR ===
            if (formData.careerComment || formData.career) {
              pdfHTML += '<div style="margin-bottom: 12px; padding: 10px; border: 1px solid #dbeafe; border-radius: 4px; background: #eff6ff; page-break-inside: avoid;">';
              pdfHTML += '<h3 style="font-size: 11pt; margin: 0 0 5px 0; color: #1d4ed8;">üöÄ Karriere & Entwicklung</h3>';
              pdfHTML += '<p style="margin: 0; font-size: 9pt; color: #334155; white-space: pre-wrap;">' + escapeHtml(formData.careerComment || formData.career || '') + '</p>';
              pdfHTML += '</div>';
            }
            
            // === FEEDBACK-FRAGEN (Q1-Q7) ===
            const feedbackQuestions = [
              {key: 'feedbackQ1', label: lang === 'de' ? 'Was lief gut in der Zusammenarbeit?' : 'What went well?'},
              {key: 'feedbackQ2', label: lang === 'de' ? 'Was k√∂nnte verbessert werden?' : 'What could be improved?'},
              {key: 'feedbackQ3', label: lang === 'de' ? 'Welche Unterst√ºtzung wird ben√∂tigt?' : 'What support is needed?'},
              {key: 'feedbackQ4', label: lang === 'de' ? 'Welche Weiterbildung ist geplant?' : 'What training is planned?'},
              {key: 'feedbackQ5', label: lang === 'de' ? 'Karrierew√ºnsche?' : 'Career aspirations?'},
              {key: 'feedbackQ6', label: lang === 'de' ? 'Sonstiges Feedback?' : 'Other feedback?'},
              {key: 'feedbackQ7', label: lang === 'de' ? 'Gesamtzufriedenheit (1-10)' : 'Overall satisfaction (1-10)'}
            ];
            
            const hasFeedback = feedbackQuestions.some(q => formData[q.key]);
            if (hasFeedback) {
              pdfHTML += '<div style="margin-bottom: 12px; padding: 10px; border: 1px solid #e2e8f0; border-radius: 4px; page-break-inside: avoid;">';
              pdfHTML += '<h3 style="font-size: 12pt; margin: 0 0 8px 0; color: #243186; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px;">üí¨ Feedback & Anmerkungen</h3>';
              feedbackQuestions.forEach(q => {
                const value = formData[q.key];
                if (value) {
                  pdfHTML += '<div style="margin-bottom: 8px;">';
                  pdfHTML += '<p style="margin: 0 0 3px 0; font-weight: bold; color: #475569; font-size: 9pt;">' + q.label + '</p>';
                  if (q.key === 'feedbackQ7') {
                    pdfHTML += '<p style="margin: 0; font-size: 14pt; font-weight: bold; color: #243186;">' + value + '/10</p>';
                  } else {
                    pdfHTML += '<p style="margin: 0; font-size: 9pt; color: #334155; white-space: pre-wrap; background: #f8fafc; padding: 5px; border-radius: 3px;">' + escapeHtml(value) + '</p>';
                  }
                  pdfHTML += '</div>';
                }
              });
              pdfHTML += '</div>';
            }
            
            // === ALLGEMEINES FEEDBACK (f√ºr √§ltere Formulare) ===
            if (formData.feedbackManager || formData.feedback) {
              pdfHTML += '<div style="margin-bottom: 12px; padding: 10px; border: 1px solid #f3e8ff; border-radius: 4px; background: #faf5ff; page-break-inside: avoid;">';
              pdfHTML += '<h3 style="font-size: 11pt; margin: 0 0 5px 0; color: #7c3aed;">üìù Feedback F√ºhrungskraft</h3>';
              pdfHTML += '<p style="margin: 0; font-size: 9pt; color: #334155; white-space: pre-wrap;">' + escapeHtml(formData.feedbackManager || formData.feedback || '') + '</p>';
              pdfHTML += '</div>';
            }
            
            // === META-INFORMATIONEN ===
            pdfHTML += '<div style="margin-top: 15px; padding: 8px; background: #f1f5f9; border-radius: 4px; font-size: 8pt; color: #64748b;">';
            pdfHTML += '<table style="width: 100%;"><tr>';
            pdfHTML += '<td>ID: ' + (appraisal.id ? appraisal.id.substring(0, 12) + '...' : '‚Äì') + '</td>';
            pdfHTML += '<td>Typ: ' + (isSelf ? getText(lang, 'Selbstreflexion', 'Autovalutazione', 'Self-Reflection') : getText(lang, 'FK-Beurteilung', 'Valutazione del responsabile', 'Manager Review')) + '</td>';
            pdfHTML += '<td>Erstellt: ' + (appraisal.createdAt ? new Date(appraisal.createdAt).toLocaleDateString('de-DE') : '‚Äì') + '</td>';
            pdfHTML += '<td>Aktualisiert: ' + (appraisal.updatedAt ? new Date(appraisal.updatedAt).toLocaleDateString('de-DE') : '‚Äì') + '</td>';
            pdfHTML += '</tr></table></div>';
            
            // === FOOTER ===
            pdfHTML += '<div style="margin-top: 15px; padding-top: 10px; border-top: 2px solid #243186; text-align: center;">';
            pdfHTML += '<p style="margin: 0; font-size: 9pt; color: #243186; font-weight: bold;">Niederwieser Group ‚Ä¢ Performance Management System</p>';
            pdfHTML += '<p style="margin: 3px 0 0 0; font-size: 8pt; color: #64748b;">Exportiert am ' + dateStr + ' aus dem HR Dashboard</p>';
            pdfHTML += '</div>';
            
            pdfContainer.innerHTML = pdfHTML;
            document.body.appendChild(pdfContainer);
            
            const opt = {
              margin: [8, 10, 8, 10],
              filename: filename,
              image: { type: 'jpeg', quality: 0.98 },
              html2canvas: { 
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff',
                letterRendering: true
              },
              jsPDF: { 
                unit: 'mm', 
                format: 'a4', 
                orientation: 'portrait'
              },
              pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };
            
            window.html2pdf()
              .set(opt)
              .from(pdfContainer)
              .save()
              .then(() => {
                document.body.removeChild(pdfContainer);
                devLog('‚úÖ HR Dashboard PDF exportiert:', filename);
              })
              .catch(err => {
                console.error('PDF Error:', err);
                showToast(getText(lang, 'PDF-Export fehlgeschlagen', 'Errore export PDF', 'PDF export failed'), 'error');
                if (document.body.contains(pdfContainer)) {
                  document.body.removeChild(pdfContainer);
                }
              });
          };
          
          const printHRAppraisal = (appraisal) => {
            devLog('üñ®Ô∏è Drucken f√ºr HR Dashboard:', appraisal);
            
            const employeeName = appraisal.employeeName || appraisal.formData?.employee || appraisal.selfFormData?.employee || 'Unbekannt';
            const isSelf = appraisal.type === 'self' || appraisal.type === 'self_assessment' || appraisal.type === 'self-reflection' || appraisal.type === 'self_assessment_standalone';
            const docType = isSelf 
              ? (lang === 'de' ? 'Selbstreflexion' : lang === 'it' ? 'Autovalutazione' : 'Self-Reflection')
              : (lang === 'de' ? 'Leistungsbeurteilung' : lang === 'it' ? 'Valutazione delle prestazioni' : 'Performance Review');
            const gps = appraisal.gpsScore || 0;
            const wasScore = appraisal.wasScore || 0;
            const wieScore = appraisal.wieCoreScore || appraisal.wieScore || 0;
            const wieLeaderScore = appraisal.wieLeaderScore || 0;
            const position = appraisal.formData?.position || appraisal.selfFormData?.position || appraisal.position || '';
            const manager = appraisal.formData?.manager || appraisal.selfFormData?.manager || '';
            const dateStr = new Date().toLocaleDateString('de-DE');
            const goals = appraisal.goals || [];
            
            // Daten je nach Typ
            const formData = isSelf ? (appraisal.selfFormData || appraisal.formData || {}) : (appraisal.formData || {});
            const coreScores = isSelf ? (appraisal.selfCoreScores || {}) : (appraisal.coreScores || {});
            const coreComments = isSelf ? (appraisal.selfCoreComments || {}) : (appraisal.coreComments || {});
            const leaderScores = isSelf ? (appraisal.selfLeaderScores || {}) : (appraisal.leaderScores || {});
            const leaderComments = isSelf ? (appraisal.selfLeaderComments || {}) : (appraisal.leaderComments || {});
            
            const gpsColor = gps >= 4.51 ? '#16a34a' : (gps >= 3.51 ? '#059669' : (gps >= 2.51 ? '#2563eb' : (gps >= 1.51 ? '#d97706' : (gps > 0 ? '#dc2626' : '#64748b'))));
            const gpsNote = gps >= 4.51 ? '5 - Outstanding' : (gps >= 3.51 ? '4 - Exceeds' : (gps >= 2.51 ? '3 - Meets' : (gps >= 1.51 ? '2 - Needs Improvement' : '1 - Does Not Meet')));
            
            // Helper-Funktionen
            const getScore = (scores, keys) => {
              if (!scores) return 0;
              for (let k of keys) {
                if (scores[k] !== undefined && scores[k] > 0) return scores[k];
              }
              return 0;
            };
            
            const getComment = (comments, keys) => {
              if (!comments) return '';
              for (let k of keys) {
                if (comments[k] && comments[k].trim()) return comments[k];
              }
              return '';
            };
            
            const escapeHtml = (text) => {
              if (!text) return '';
              return String(text)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;');
            };
            
            let html = '<div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; color: #1e293b; font-size: 11pt;">';
            
            // Header
            html += '<div style="border-bottom: 3px solid #243186; padding-bottom: 15px; margin-bottom: 20px;">';
            html += '<table style="width: 100%;"><tr>';
            html += '<td><h1 style="color: #243186; font-size: 26px; margin: 0 0 5px 0;">nƒ±ederwƒ±eser</h1>';
            html += '<p style="color: #6EBD84; font-size: 11px; margin: 0; letter-spacing: 1px;">FLEXIBLE FOOD PACKAGING</p></td>';
            html += '<td style="text-align: right;"><h2 style="color: #243186; font-size: 20px; margin: 0;">' + docType + '</h2>';
            html += '<p style="color: #64748b; font-size: 11px; margin: 5px 0 0 0;">Performance Review ' + new Date().getFullYear() + '</p></td>';
            html += '</tr></table></div>';
            
            // Mitarbeiter Info
            html += '<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 12px 15px; margin-bottom: 15px; border-left: 4px solid #243186; border-radius: 4px;">';
            html += '<table style="width: 100%;"><tr>';
            html += '<td style="width: 30%;"><strong style="color: #64748b; font-size: 9px; text-transform: uppercase;">Mitarbeiter</strong><br/><span style="font-size: 14px; font-weight: bold;">' + escapeHtml(employeeName) + '</span></td>';
            html += '<td style="width: 25%;"><strong style="color: #64748b; font-size: 9px; text-transform: uppercase;">Position</strong><br/>' + escapeHtml(position || '‚Äì') + '</td>';
            if (manager) html += '<td style="width: 25%;"><strong style="color: #64748b; font-size: 9px; text-transform: uppercase;">F√ºhrungskraft</strong><br/>' + escapeHtml(manager) + '</td>';
            html += '<td style="width: 20%;"><strong style="color: #64748b; font-size: 9px; text-transform: uppercase;">Status</strong><br/><span style="color: ' + (appraisal.status === 'completed' ? '#059669' : '#d97706') + ';">' + (appraisal.status === 'completed' ? '‚úì Abgeschlossen' : '‚úé Entwurf') + '</span></td>';
            html += '</tr></table></div>';
            
            // GPS Score
            html += '<div style="background: ' + gpsColor + '; color: white; padding: 20px; text-align: center; margin-bottom: 15px; border-radius: 6px;">';
            html += '<p style="margin: 0 0 5px 0; font-size: 12px; opacity: 0.9;">Global Performance Score (GPS)</p>';
            html += '<p style="margin: 0; font-size: 42px; font-weight: bold;">' + (gps > 0 ? gps.toFixed(2) : '‚Äì') + '</p>';
            if (gps > 0) html += '<p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.9;">' + gpsNote + '</p>';
            html += '<div style="margin-top: 10px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.3);">';
            html += '<span style="margin-right: 30px;">WAS (50%): <strong>' + (wasScore > 0 ? (wasScore > 5 ? wasScore.toFixed(0) + '%' : wasScore.toFixed(2)) : '‚Äì') + '</strong></span>';
            html += '<span>WIE (50%): <strong>' + (wieScore > 0 ? wieScore.toFixed(2) : '‚Äì') + '</strong></span>';
            if (wieLeaderScore > 0) html += '<span style="margin-left: 30px;">WIE-FK: <strong>' + wieLeaderScore.toFixed(2) + '</strong></span>';
            html += '</div></div>';
            
            // Ziele
            if (goals.length > 0) {
              html += '<div style="margin-bottom: 15px; page-break-inside: avoid;">';
              html += '<h3 style="color: #243186; margin: 0 0 10px 0; font-size: 14px; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px;">üéØ Ziele (WAS-Komponente)</h3>';
              html += '<table style="width: 100%; border-collapse: collapse; font-size: 10px;">';
              html += '<tr style="background: #f8fafc;"><th style="padding: 6px; border: 1px solid #e2e8f0; text-align: center; width: 30px;">#</th><th style="padding: 6px; border: 1px solid #e2e8f0; text-align: left;">Ziel</th><th style="padding: 6px; border: 1px solid #e2e8f0; text-align: center; width: 60px;">Gewicht</th><th style="padding: 6px; border: 1px solid #e2e8f0; text-align: center; width: 70px;">Erreichung</th></tr>';
              goals.forEach((g, i) => {
                const ach = g.achievement || g.a || 0;
                const achColor = ach >= 100 ? '#059669' : (ach >= 80 ? '#2563eb' : '#d97706');
                html += '<tr><td style="padding: 6px; border: 1px solid #e2e8f0; text-align: center;">' + (i+1) + '</td>';
                html += '<td style="padding: 6px; border: 1px solid #e2e8f0;">' + escapeHtml(g.name || g.n || '‚Äì') + '</td>';
                html += '<td style="padding: 6px; border: 1px solid #e2e8f0; text-align: center;">' + (g.weight || g.w || 0) + '%</td>';
                html += '<td style="padding: 6px; border: 1px solid #e2e8f0; text-align: center; font-weight: bold; color: ' + achColor + ';">' + ach + '%</td></tr>';
              });
              html += '</table></div>';
            }
            
            // Kernkompetenzen
            const coreCompDefs = [
              {keys: ['fach', 'c1', 'C1', 'fachkompetenz'], label: 'Fachkompetenz', short: 'Fach'},
              {keys: ['komm', 'c2', 'C2', 'kommunikation'], label: 'Kommunikation', short: 'Komm'},
              {keys: ['prob', 'c3', 'C3', 'problemloesung'], label: 'Probleml√∂sung', short: 'Prob'},
              {keys: ['adapt', 'c4', 'C4', 'anpassung'], label: 'Anpassungsf√§higkeit', short: 'Adapt'},
              {keys: ['orga', 'c5', 'C5', 'selbstorganisation'], label: 'Selbstorganisation', short: 'Orga'}
            ];
            
            const hasAnyCoreScore = coreCompDefs.some(c => getScore(coreScores, c.keys) > 0);
            if (hasAnyCoreScore || Object.keys(coreScores).length > 0) {
              html += '<div style="margin-bottom: 15px; page-break-inside: avoid;">';
              html += '<h3 style="color: #243186; margin: 0 0 10px 0; font-size: 14px; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px;">üí° Kernkompetenzen (WIE-Komponente)</h3>';
              html += '<table style="width: 100%; margin-bottom: 10px;"><tr>';
              coreCompDefs.forEach(comp => {
                const score = getScore(coreScores, comp.keys);
                const color = score >= 4 ? '#059669' : (score >= 3 ? '#2563eb' : (score >= 2 ? '#d97706' : '#94a3b8'));
                html += '<td style="width: 20%; text-align: center; padding: 5px;">';
                html += '<div style="background: #f8fafc; padding: 10px 5px; border-radius: 4px; border: 1px solid #e2e8f0;">';
                html += '<p style="margin: 0 0 3px 0; font-size: 9px; color: #64748b;">' + comp.short + '</p>';
                html += '<p style="margin: 0; font-size: 20px; font-weight: bold; color: ' + color + ';">' + (score > 0 ? score.toFixed(1) : '‚Äì') + '</p>';
                html += '</div></td>';
              });
              html += '</tr></table>';
              
              // Kommentare
              const hasAnyComment = coreCompDefs.some(c => getComment(coreComments, c.keys));
              if (hasAnyComment) {
                html += '<div style="background: #f8fafc; padding: 8px; border-radius: 4px; font-size: 10px;">';
                coreCompDefs.forEach(comp => {
                  const comment = getComment(coreComments, comp.keys);
                  const score = getScore(coreScores, comp.keys);
                  if (comment) {
                    html += '<div style="margin-bottom: 5px; padding: 5px; background: white; border-left: 3px solid #243186;">';
                    html += '<strong style="color: #243186;">' + comp.label + ' (' + (score > 0 ? score.toFixed(1) : '‚Äì') + '):</strong> ';
                    html += '<span style="color: #475569;">' + escapeHtml(comment) + '</span></div>';
                  }
                });
                html += '</div>';
              }
              html += '</div>';
            }
            
            // F√ºhrungskompetenzen
            const leaderCompDefs = [
              {keys: ['lead', 'l1', 'L1', 'mitarbeiterfuehrung'], label: 'Mitarbeiterf√ºhrung', short: 'Lead'},
              {keys: ['strat', 'l2', 'L2', 'strategisch'], label: 'Strateg. Denken', short: 'Strat'},
              {keys: ['decide', 'l3', 'L3', 'entscheidung'], label: 'Entscheidung', short: 'Decide'},
              {keys: ['exec', 'l4', 'L4', 'umsetzung'], label: 'Umsetzung', short: 'Exec'},
              {keys: ['stake', 'l5', 'L5', 'stakeholder'], label: 'Stakeholder', short: 'Stake'}
            ];
            
            const hasAnyLeaderScore = leaderCompDefs.some(c => getScore(leaderScores, c.keys) > 0);
            if (hasAnyLeaderScore) {
              html += '<div style="margin-bottom: 15px; page-break-inside: avoid; background: #faf5ff; padding: 10px; border-radius: 4px; border: 1px solid #e9d5ff;">';
              html += '<h3 style="color: #7c3aed; margin: 0 0 10px 0; font-size: 14px; border-bottom: 1px solid #e9d5ff; padding-bottom: 5px;">üëî F√ºhrungskompetenzen</h3>';
              html += '<table style="width: 100%; margin-bottom: 10px;"><tr>';
              leaderCompDefs.forEach(comp => {
                const score = getScore(leaderScores, comp.keys);
                const color = score >= 4 ? '#7c3aed' : (score >= 3 ? '#8b5cf6' : (score >= 2 ? '#a78bfa' : '#c4b5fd'));
                html += '<td style="width: 20%; text-align: center; padding: 5px;">';
                html += '<div style="background: white; padding: 10px 5px; border-radius: 4px; border: 1px solid #e9d5ff;">';
                html += '<p style="margin: 0 0 3px 0; font-size: 9px; color: #7c3aed;">' + comp.short + '</p>';
                html += '<p style="margin: 0; font-size: 20px; font-weight: bold; color: ' + color + ';">' + (score > 0 ? score.toFixed(1) : '‚Äì') + '</p>';
                html += '</div></td>';
              });
              html += '</tr></table>';
              
              // Kommentare
              const hasAnyLeaderComment = leaderCompDefs.some(c => getComment(leaderComments, c.keys));
              if (hasAnyLeaderComment) {
                html += '<div style="background: white; padding: 8px; border-radius: 4px; font-size: 10px;">';
                leaderCompDefs.forEach(comp => {
                  const comment = getComment(leaderComments, comp.keys);
                  const score = getScore(leaderScores, comp.keys);
                  if (comment) {
                    html += '<div style="margin-bottom: 5px; padding: 5px; background: #faf5ff; border-left: 3px solid #7c3aed;">';
                    html += '<strong style="color: #7c3aed;">' + comp.label + ' (' + (score > 0 ? score.toFixed(1) : '‚Äì') + '):</strong> ';
                    html += '<span style="color: #475569;">' + escapeHtml(comment) + '</span></div>';
                  }
                });
                html += '</div>';
              }
              html += '</div>';
            }
            
            // St√§rken & Entwicklungsfelder
            if (formData.strengths1 || formData.strengths2) {
              html += '<div style="margin-bottom: 15px; page-break-inside: avoid;">';
              html += '<h3 style="color: #243186; margin: 0 0 10px 0; font-size: 14px; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px;">üí™ St√§rken & Entwicklungsfelder</h3>';
              html += '<table style="width: 100%;"><tr>';
              html += '<td style="width: 50%; vertical-align: top; padding-right: 10px;">';
              html += '<div style="background: #f0fdf4; padding: 10px; border-radius: 4px; border-left: 3px solid #22c55e; min-height: 50px;">';
              html += '<p style="margin: 0 0 5px 0; font-weight: bold; color: #166534; font-size: 10px;">St√§rken:</p>';
              html += '<p style="margin: 0; font-size: 10px; color: #334155; white-space: pre-wrap;">' + escapeHtml(formData.strengths1 || getText(lang, 'Keine Angabe', 'Non specificato', 'Not specified')) + '</p></div></td>';
              html += '<td style="width: 50%; vertical-align: top; padding-left: 10px;">';
              html += '<div style="background: #fef3c7; padding: 10px; border-radius: 4px; border-left: 3px solid #f59e0b; min-height: 50px;">';
              html += '<p style="margin: 0 0 5px 0; font-weight: bold; color: #92400e; font-size: 10px;">Entwicklungsfelder:</p>';
              html += '<p style="margin: 0; font-size: 10px; color: #334155; white-space: pre-wrap;">' + escapeHtml(formData.strengths2 || getText(lang, 'Keine Angabe', 'Non specificato', 'Not specified')) + '</p></div></td>';
              html += '</tr></table></div>';
            }
            
            // Karriere-Kommentar
            if (formData.careerComment || formData.career) {
              html += '<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #dbeafe; border-radius: 4px; background: #eff6ff; page-break-inside: avoid;">';
              html += '<h4 style="font-size: 12px; margin: 0 0 5px 0; color: #1d4ed8;">üöÄ Karriere & Entwicklung</h4>';
              html += '<p style="margin: 0; font-size: 10px; color: #334155; white-space: pre-wrap;">' + escapeHtml(formData.careerComment || formData.career) + '</p>';
              html += '</div>';
            }
            
            // Feedback-Fragen
            const feedbackQuestions = [
              {key: 'feedbackQ1', label: 'Was lief gut in der Zusammenarbeit?'},
              {key: 'feedbackQ2', label: 'Was k√∂nnte verbessert werden?'},
              {key: 'feedbackQ3', label: 'Welche Unterst√ºtzung wird ben√∂tigt?'},
              {key: 'feedbackQ4', label: 'Welche Weiterbildung ist geplant?'},
              {key: 'feedbackQ5', label: 'Karrierew√ºnsche?'},
              {key: 'feedbackQ6', label: 'Sonstiges Feedback?'},
              {key: 'feedbackQ7', label: 'Gesamtzufriedenheit (1-10)'}
            ];
            
            const hasFeedback = feedbackQuestions.some(q => formData[q.key]);
            if (hasFeedback) {
              html += '<div style="margin-bottom: 15px; page-break-inside: avoid;">';
              html += '<h3 style="color: #243186; margin: 0 0 10px 0; font-size: 14px; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px;">üí¨ Feedback & Anmerkungen</h3>';
              feedbackQuestions.forEach(q => {
                const value = formData[q.key];
                if (value) {
                  html += '<div style="margin-bottom: 8px;">';
                  html += '<p style="margin: 0 0 3px 0; font-weight: bold; color: #475569; font-size: 10px;">' + q.label + '</p>';
                  if (q.key === 'feedbackQ7') {
                    html += '<p style="margin: 0; font-size: 16px; font-weight: bold; color: #243186;">' + value + '/10</p>';
                  } else {
                    html += '<p style="margin: 0; font-size: 10px; color: #334155; white-space: pre-wrap; background: #f8fafc; padding: 5px; border-radius: 3px;">' + escapeHtml(value) + '</p>';
                  }
                  html += '</div>';
                }
              });
              html += '</div>';
            }
            
            // Allgemeines Feedback
            if (formData.feedbackManager || formData.feedback) {
              html += '<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #f3e8ff; border-radius: 4px; background: #faf5ff; page-break-inside: avoid;">';
              html += '<h4 style="font-size: 12px; margin: 0 0 5px 0; color: #7c3aed;">üìù Feedback F√ºhrungskraft</h4>';
              html += '<p style="margin: 0; font-size: 10px; color: #334155; white-space: pre-wrap;">' + escapeHtml(formData.feedbackManager || formData.feedback) + '</p>';
              html += '</div>';
            }
            
            // Footer
            html += '<div style="margin-top: 25px; padding-top: 10px; border-top: 2px solid #243186; text-align: center;">';
            html += '<p style="margin: 0; font-size: 10px; color: #243186; font-weight: bold;">Niederwieser Group ‚Ä¢ Performance Management System</p>';
            html += '<p style="margin: 3px 0 0 0; font-size: 9px; color: #64748b;">Gedruckt am ' + dateStr + ' aus dem HR Dashboard</p>';
            html += '</div></div>';
            
            const printWindow = window.open('', '_blank');
            if (!printWindow) {
              showToast(getText(lang, 'Popup-Blocker aktiv', 'Blocco popup attivo', 'Popup blocker active'), 'warning');
              return;
            }
            
            printWindow.document.write('<!DOCTYPE html><html><head><title>' + docType + ' - ' + employeeName + '</title>');
            printWindow.document.write('<style>@media print { body { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; } @page { margin: 12mm; size: A4; } } body { margin: 0; }</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(html);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            
            setTimeout(function() {
              printWindow.print();
            }, 500);
          };
          
          // HR Admin Check
          React.useEffect(() => {
            if (user && user.email) {
              const admin = isUserHRAdmin(user.email);
              setIsHRAdmin(admin);
              if (admin) devLog('üîê HR Admin erkannt');
            } else {
              setIsHRAdmin(false);
            }
          }, [user]);
          
          // === NEU: Salary Review Access System - Lade Berechtigungen ===
          React.useEffect(() => {
            if (!db || !user || !user.email || guestMode) {
              setSalaryReviewAccess([]);
              setSalaryReviewUserRole(null);
              return;
            }
            
            devLog('üí∞ Lade Salary Review Access');
            
            // Lade alle Access-Eintr√§ge (nur HR Admin kann das tun, aber wir laden trotzdem f√ºr den User-Check)
            const unsub = db.collection('salaryReviewAccess').onSnapshot(snap => {
              const accessList = snap.docs.map(d => ({ id: d.id, ...d.data() }));
              setSalaryReviewAccess(accessList);
              
              // WICHTIG: Direkt mit accessList pr√ºfen, nicht mit State (wegen async State-Update)
              const emailLower = user.email.toLowerCase();
              
              // HR Admins haben immer Vollzugriff
              if (HR_ADMIN_EMAILS.includes(emailLower)) {
                const hrAccess = { role: 'hr_admin', canViewAll: true, canEditAll: true, canInvite: true, accessSalary: true, accessGoals: true };
                setSalaryReviewUserRole(hrAccess);
                devLog('üí∞ User ist HR Admin - Vollzugriff');
                return;
              }
              
              // Pr√ºfe in der Access-Liste (direkt mit accessList, nicht State!)
              const access = accessList.find(a => a.email.toLowerCase() === emailLower);
              
              if (!access) {
                setSalaryReviewUserRole(null);
                devLog('üí∞ User hat keinen Zugriff auf Salary Review');
                return;
              }
              
              // Access-Flags auslesen (Default: true f√ºr R√ºckw√§rtskompatibilit√§t)
              const accessSalary = access.accessSalary !== false;
              const accessGoals = access.accessGoals !== false;
              
              let currentAccess = null;
              if (access.role === 'executive') {
                currentAccess = { role: 'executive', canViewAll: true, canEditAll: true, canInvite: false, accessSalary, accessGoals };
              } else if (access.role === 'manager') {
                currentAccess = { 
                  role: 'manager', 
                  canViewAll: false, 
                  canEditAll: false, 
                  canInvite: false,
                  allowedEmployeeIds: access.teamMemberIds || [],
                  accessSalary,
                  accessGoals
                };
              }
              
              setSalaryReviewUserRole(currentAccess);
              
              // Zeige Welcome-Modal wenn Manager zum ersten Mal Zugang bekommt
              if (currentAccess && currentAccess.role === 'manager') {
                const seenKey = 'nw_salary_review_welcome_seen_' + user.email;
                if (!localStorage.getItem(seenKey)) {
                  setShowSalaryReviewWelcome(true);
                  localStorage.setItem(seenKey, 'true');
                }
              }
              
              devLog('üí∞ Salary Review Access geladen:', accessList.length, 'Eintr√§ge');
              devLog('üí∞ User-Rolle:', currentAccess?.role || 'keine', 'accessSalary:', currentAccess?.accessSalary, 'accessGoals:', currentAccess?.accessGoals);
            }, err => {
              console.error('Salary Review Access Error:', err);
            });
            
            return () => unsub();
          }, [user, guestMode]);
          
          // === NEU: Lade registrierte Benutzer f√ºr Zugriffsmanagement ===
          React.useEffect(() => {
            if (!db || !user || guestMode) {
              setRegisteredUsers([]);
              return;
            }
            
            // Nur HR Admins k√∂nnen Benutzer einladen, also nur f√ºr diese laden
            const currentAccess = checkSalaryReviewAccess(user?.email);
            if (!currentAccess || !currentAccess.canInvite) return;
            
            devLog('üë• Lade registrierte Benutzer...');
            
            // Lade registrierte Benutzer aus der registeredUsers Collection
            const unsub = db.collection('registeredUsers').onSnapshot(snap => {
              const users = [];
              const seenEmails = new Set();
              
              snap.docs.forEach(d => {
                const data = d.data();
                if (data.email && !seenEmails.has(data.email.toLowerCase())) {
                  seenEmails.add(data.email.toLowerCase());
                  users.push({
                    email: data.email,
                    name: data.fullName || data.name || data.email.split('@')[0], // v92: fullName bevorzugen
                    uid: data.uid,
                    createdAt: data.createdAt,
                    source: 'registered'
                  });
                }
              });
              
              // Sortiere nach E-Mail
              users.sort((a, b) => a.email.localeCompare(b.email));
              setRegisteredUsers(users);
              devLog('üë• Registrierte Benutzer geladen:', users.length);
            }, err => {
              console.error('Registrierte Benutzer Error:', err);
              // Fallback: Wenn Collection nicht existiert oder Fehler, zeige trotzdem leere Liste
              setRegisteredUsers([]);
            });
            
            return () => unsub();
          }, [user, guestMode, salaryReviewAccess]);
          React.useEffect(() => {
            if (!db || !user || guestMode) {
              setSalaryReviewHistory([]);
              return;
            }
            
            const currentAccess = checkSalaryReviewAccess(user?.email);
            if (!currentAccess) return;
            
            devLog('üìú Lade Salary Review History...');
            
            const unsub = db.collection('salaryReviewHistory')
              .orderBy('changedAt', 'desc')
              .limit(500)
              .onSnapshot(snap => {
                const history = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                setSalaryReviewHistory(history);
                devLog('üìú Salary Review History geladen:', history.length);
              }, err => {
                console.error('Salary Review History Error:', err);
              });
            
            return () => unsub();
          }, [user, guestMode, salaryReviewUserRole]);
          
          // === NEU: Salary Review Data - Lade/Speichere Compensation Daten ===
          // WICHTIG: Kein onSnapshot verwenden! Das √ºberschreibt lokale √Ñnderungen.
          // Stattdessen: Einmaliges Laden beim Start + manuelles Speichern
          const salaryReviewDataLoaded = React.useRef(false);
          
          React.useEffect(() => {
            if (!db || !user || guestMode) return;
            
            const currentAccess = checkSalaryReviewAccess(user?.email);
            if (!currentAccess) return;
            
            // Nur einmal laden - nicht bei jedem Re-Render
            if (salaryReviewDataLoaded.current) {
              devLog('üíæ Salary Review bereits geladen, √ºberspringe');
              return;
            }
            
            devLog('üíæ Lade Salary Review Daten (einmalig)...');
            salaryReviewDataLoaded.current = true;
            
            db.collection('salaryReviewData').doc('current').get()
              .then(doc => {
                if (doc.exists) {
                  const data = doc.data();
                  devLog('üíæ Salary Review Daten geladen:', data.employees?.length || 0, 'Mitarbeiter');
                  if (data.budget !== undefined) setCompBudget(data.budget);
                  if (data.employees && data.employees.length > 0) {
                    setCompEmployees(data.employees);
                  }
                } else {
                  devLog('üíæ Keine Salary Review Daten gefunden');
                }
              })
              .catch(err => {
                console.error('Salary Review Data Error:', err);
              });
            
          }, [user, guestMode, salaryReviewUserRole]);
          
          // === NEU: Salary Review speichern ===
          const saveSalaryReviewData = async (budgetToSave, employeesToSave) => {
            if (!db || !user) return;
            
            const currentAccess = checkSalaryReviewAccess(user.email);
            if (!currentAccess || (!currentAccess.canEditAll && currentAccess.role !== 'manager')) {
              showToast(getText(lang, 'Keine Berechtigung zum Speichern', 'Non autorizzato a salvare', 'Not authorized to save'), 'error');
              return;
            }
            
            setSalaryReviewPendingSave(true);
            devLog('üíæ Speichere Salary Review...', employeesToSave?.length || 0, 'Mitarbeiter');
            
            // WICHTIG: Firebase akzeptiert keine undefined Werte - alle bereinigen
            const sanitizeEmployee = (emp) => {
              const sanitized = {};
              Object.keys(emp).forEach(key => {
                if (emp[key] === undefined) {
                  if (key === 'baseSalary' || key === 'currentBonus' || key === 'gpsScore' || key === 'increasePercent' || key === 'newBonus' || key === 'id') {
                    sanitized[key] = 0;
                  } else {
                    sanitized[key] = '';
                  }
                } else {
                  sanitized[key] = emp[key];
                }
              });
              return sanitized;
            };
            
            const sanitizedEmployees = (employeesToSave || []).map(sanitizeEmployee);
            
            try {
              await db.collection('salaryReviewData').doc('current').set({
                budget: budgetToSave || 0,
                employees: sanitizedEmployees,
                lastModifiedBy: user.email,
                lastModifiedAt: new Date().toISOString()
              });
              
              devLog('‚úÖ Salary Review Daten gespeichert:', sanitizedEmployees?.length || 0, 'Mitarbeiter');
              // Toast-Nachricht
              const toast = document.createElement('div');
              toast.style.cssText = 'position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #059669; color: white; padding: 12px 24px; border-radius: 8px; font-weight: 500; z-index: 9999; animation: slideUp 0.3s ease-out;';
              toast.textContent = '‚úÖ √Ñnderungen gespeichert';
              document.body.appendChild(toast);
              setTimeout(() => toast.remove(), 3000);
              
            } catch (err) {
              console.error('Fehler beim Speichern:', err);
              showToast(getText(lang, 'Fehler beim Speichern', 'Errore durante il salvataggio', 'Error saving'), 'error');
            } finally {
              setSalaryReviewPendingSave(false);
            }
          };
          
          // === NEU: Salary Review Access hinzuf√ºgen/entfernen ===
          const addSalaryReviewAccess = async (email, role, teamMemberIds = [], accessFlags = {}) => {
            if (!db || !isHRAdmin) return;
            
            try {
              const docId = email.toLowerCase().replace(/[^a-z0-9]/g, '_');
              await db.collection('salaryReviewAccess').doc(docId).set({
                email: email.toLowerCase(),
                role: role,
                teamMemberIds: teamMemberIds,
                accessSalary: accessFlags.accessSalary !== false, // Default true
                accessGoals: accessFlags.accessGoals !== false,   // Default true
                grantedBy: user.email,
                grantedAt: new Date().toISOString()
              });
              devLog('‚úÖ Salary Review Access hinzugef√ºgt');
              return true;
            } catch (err) {
              console.error('Fehler beim Hinzuf√ºgen:', err);
              showToast(getText(lang, 'Ein Fehler ist aufgetreten', 'Si √® verificato un errore', 'An error occurred'), 'error');
              return false;
            }
          };
          
          const removeSalaryReviewAccess = async (email) => {
            if (!db || !isHRAdmin) return;
            
            try {
              const docId = email.toLowerCase().replace(/[^a-z0-9]/g, '_');
              await db.collection('salaryReviewAccess').doc(docId).delete();
              devLog('‚úÖ Salary Review Access entfernt');
              return true;
            } catch (err) {
              console.error('Fehler beim Entfernen:', err);
              showToast(getText(lang, 'Ein Fehler ist aufgetreten', 'Si √® verificato un errore', 'An error occurred'), 'error');
              return false;
            }
          };
          
          // === NEU: History-Eintrag speichern ===
          const saveSalaryHistoryEntry = async (entry) => {
            if (!db) return;
            try {
              await db.collection('salaryReviewHistory').add(entry);
            } catch (err) {
              console.error('History-Speicherfehler:', err);
            }
          };
          
          // HR Admin ODER eingeladene Benutzer mit Goals-Zugriff: Lade ALLE Daten
          React.useEffect(() => {
            // Pr√ºfe ob User Zugriff hat (HR Admin oder eingeladen mit Goals-Zugriff)
            const hasAccess = isHRAdmin || (salaryReviewUserRole && (salaryReviewUserRole.accessGoals || salaryReviewUserRole.accessSalary));
            
            if (!hasAccess || !db || guestMode) {
              // Nur zur√ºcksetzen wenn nicht HR Admin (HR Admin Daten sollen erhalten bleiben)
              if (!isHRAdmin) {
                setAllCompanyAppraisals([]);
                setAllCompanyMembers([]);
              }
              return;
            }
            
            setHRDataLoading(true);
            devLog('üìä Lade unternehmensweite Daten f√ºr:', isHRAdmin ? 'HR Admin' : salaryReviewUserRole?.role);
            
            const unsub1 = db.collection('teamAppraisals').onSnapshot(snap => {
              const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
              setAllCompanyAppraisals(data);
              devLog('üìä', isHRAdmin ? 'HR Admin' : 'Invited User', ':', data.length, 'Beurteilungen geladen');
            }, err => console.error('Appraisals error:', err));
            
            const unsub2 = db.collection('teamMembers').onSnapshot(snap => {
              const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
              setAllCompanyMembers(data);
              setHRDataLoading(false);
              devLog('üë•', isHRAdmin ? 'HR Admin' : 'Invited User', ':', data.length, 'Mitarbeiter geladen');
            }, err => { console.error('Members error:', err); setHRDataLoading(false); });
            
            return () => { unsub1(); unsub2(); };
          }, [isHRAdmin, guestMode, salaryReviewUserRole]);
          
          // Firestore Listener f√ºr teamMembers - NUR wenn user eingeloggt UND NICHT Gast-Modus
          React.useEffect(() => {
            // Im Gast-Modus keine Team-Daten laden (anonymer User hat eigene UID)
            if (!user || !db || guestMode) {
              setTeamMembers([]);
              addDebugLog('warning', 'Team-Daten nicht geladen: ' + (!user ? 'Kein User' : !db ? 'Keine DB' : 'Gast-Modus'));
              return;
            }
            
            // Anonyme User ausschlie√üen (haben isAnonymous = true)
            if (user.isAnonymous) {
              setTeamMembers([]);
              addDebugLog('warning', 'Anonymer User - keine Team-Daten');
              return;
            }
            
            setFirestoreLoading(true);
            addDebugLog('info', 'Lade Team-Daten f√ºr: ' + user.email);
            devLog('üîÑ Lade Team-Mitarbeiter f√ºr:', user.email, '(UID:', user.uid, ')');
            
            // === ZWEI SEPARATE REAL-TIME LISTENER ===
            let ownedMembers = [];
            let sharedMembers = [];
            let listenersReady = { owned: false, shared: false };
            let lastValidTeam = []; // Speichere letzten g√ºltigen Zustand
            
            // Funktion zum Kombinieren und Setzen der Mitarbeiter
            const updateCombinedMembers = () => {
              // Warte bis mindestens der owned Listener gefeuert hat
              if (!listenersReady.owned) return;
              
              // Kombiniere und entferne Duplikate (eigene haben Vorrang)
              const ownedIds = new Set(ownedMembers.map(m => m.id));
              const uniqueShared = sharedMembers.filter(m => !ownedIds.has(m.id));
              
              const combined = [...ownedMembers, ...uniqueShared];
              devLog('‚úÖ Team kombiniert:', ownedMembers.length, 'eigene +', uniqueShared.length, 'geteilte =', combined.length, 'gesamt');
              addDebugLog('success', `Team geladen: ${combined.length} Mitarbeiter`);
              
              // WICHTIG: Nur updaten wenn wir Daten haben ODER wenn es der erste Load ist
              // Das verhindert das "Verschwinden" bei tempor√§ren Netzwerk-Problemen
              if (combined.length > 0 || lastValidTeam.length === 0) {
                lastValidTeam = combined;
                setTeamMembers(combined);
              } else {
                devLog('‚ö†Ô∏è Leeres Ergebnis ignoriert - behalte', lastValidTeam.length, 'MA aus Cache');
                addDebugLog('warning', `Leeres Ergebnis ignoriert - ${lastValidTeam.length} MA aus Cache behalten`);
              }
              setFirestoreLoading(false);
            };
            
            // LISTENER 1: Eigene Mitarbeiter (Real-time)
            devLog('üì° Starte Listener 1: Eigene Mitarbeiter');
            const unsubOwned = db.collection('teamMembers')
              .where('userId', '==', user.uid)
              .onSnapshot(async (snapshot) => {
                devLog('üë§ [Listener 1] Eigene Mitarbeiter:', snapshot.docs.length);
                
                // Auto-Fix: Generiere fehlende accessCodes
                const needAccessCode = snapshot.docs.filter(doc => !doc.data().accessCode);
                for (const doc of needAccessCode) {
                  const newCode = generateAccessCode();
                  await db.collection('teamMembers').doc(doc.id).update({ accessCode: newCode });
                  devLog('  üîß AccessCode generiert f√ºr Mitarbeiter');
                }
                
                ownedMembers = snapshot.docs.map(doc => ({
                  id: doc.id,
                  ...doc.data(),
                  accessCode: doc.data().accessCode || 'pending',
                  _isOwner: true
                }));
                
                listenersReady.owned = true;
                updateCombinedMembers();
              }, (err) => {
                console.error('‚ùå [Listener 1] Fehler:', err);
                addDebugLog('error', 'Fehler beim Laden eigener MA: ' + err.message);
                listenersReady.owned = true;
                // Bei Fehler: Nicht setFirestoreLoading(false) - versuche es erneut nach 3 Sekunden
                setTimeout(() => {
                  if (ownedMembers.length === 0) {
                    devLog('üîÑ Retry: Lade eigene Mitarbeiter erneut...');
                    db.collection('teamMembers')
                      .where('userId', '==', user.uid)
                      .get()
                      .then(snap => {
                        if (snap.docs.length > 0) {
                          ownedMembers = snap.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data(),
                            accessCode: doc.data().accessCode || 'pending',
                            _isOwner: true
                          }));
                          updateCombinedMembers();
                        }
                      })
                      .catch(e => console.error('Retry Fehler:', e));
                  }
                }, 3000);
                setFirestoreLoading(false);
              });
            
            // LISTENER 2: Geteilte Mitarbeiter √ºber sharedAccess Collection
            // Diese Collection speichert wer auf welchen Mitarbeiter Zugriff hat
            let unsubShared = () => {};
            
            if (user.email) {
              const userEmailLower = user.email.toLowerCase();
              devLog('üì° Starte Listener 2: Geteilte Mitarbeiter f√ºr:', userEmailLower);
              
              // Methode A: Direkte Abfrage auf teamMembers mit array-contains
              unsubShared = db.collection('teamMembers')
                .where('sharedWith', 'array-contains', userEmailLower)
                .onSnapshot((snapshot) => {
                  devLog('üì• [Listener 2] Geteilte Mitarbeiter gefunden:', snapshot.docs.length);
                  
                  if (snapshot.docs.length === 0) {
                    devLog('   ‚ÑπÔ∏è Keine Treffer f√ºr:', userEmailLower);
                    
                    // Fallback: Versuche auch mit Original-Email (case-sensitive)
                    if (user.email !== userEmailLower) {
                      devLog('   üîÑ Versuche Fallback mit Original-Email:', user.email);
                    }
                  }
                  
                  sharedMembers = snapshot.docs.map(doc => {
                    const data = doc.data();
                    devLog('  ‚úì Shared-Mitarbeiter gefunden');
                    return {
                      id: doc.id,
                      ...data,
                      _isOwner: false,
                      _sharedBy: data.ownerEmail || data.userId, // Bevorzuge E-Mail, Fallback auf userId
                      _sharedWithMe: true
                    };
                  });
                  
                  listenersReady.shared = true;
                  updateCombinedMembers();
                }, (err) => {
                  console.error('‚ùå [Listener 2] Fehler:', err.code, err.message);
                  
                  // Spezifische Fehlerbehandlung
                  if (err.code === 'permission-denied') {
                    console.error('   ‚ö†Ô∏è FIRESTORE RULES PROBLEM!');
                    console.error('   Die Firestore Security Rules blockieren den Zugriff.');
                    console.error('   Bitte Rules anpassen oder sharedAccess Collection verwenden.');
                  }
                  
                  listenersReady.shared = true;
                  updateCombinedMembers();
                });
            } else {
              devLog('‚ö†Ô∏è Keine E-Mail verf√ºgbar - Listener 2 √ºbersprungen');
              listenersReady.shared = true;
              updateCombinedMembers();
            }
            
            // Cleanup: Beide Listener aufr√§umen
            return () => {
              devLog('üßπ R√§ume Listener auf');
              unsubOwned();
              unsubShared();
            };
          }, [user, guestMode]);
          
          // Firestore Listener f√ºr teamAppraisals - NUR wenn user eingeloggt UND NICHT Gast-Modus
          React.useEffect(() => {
            // Im Gast-Modus keine Appraisals laden
            if (!user || !db || guestMode) {
              setTeamAppraisals([]);
              return;
            }
            
            // Anonyme User ausschlie√üen
            if (user.isAnonymous) {
              setTeamAppraisals([]);
              return;
            }
            
            // === CO-MANAGEMENT: Lade Appraisals basierend auf teamMembers ===
            // Wir laden alle Appraisals f√ºr Mitarbeiter, auf die wir Zugriff haben
            // Das bedeutet: Eigene Appraisals PLUS Appraisals f√ºr geteilte Mitarbeiter
            
            let ownedAppraisals = [];
            let employeeBasedAppraisals = []; // Fallback f√ºr besch√§digte Daten
            let sharedAppraisals = [];
            let unsubOwned = () => {};
            let unsubEmployeeBased = [];
            let unsubSharedAppraisals = [];
            
            // 1. Listener f√ºr eigene Appraisals (Standard-Query)
            unsubOwned = db.collection('teamAppraisals')
              .where('userId', '==', user.uid)
              .onSnapshot((snapshot) => {
                ownedAppraisals = snapshot.docs.map(doc => ({
                  id: doc.id,
                  ...doc.data(),
                  _isOwner: true
                }));
                
                // Kombiniere alle Quellen und dedupliziere
                combineAndSetAppraisals();
                
                // Cache f√ºr AppraisalForm (Selbstreflexion-Verkn√ºpfung)
                localStorage.setItem('nw_team_appraisals_cache', JSON.stringify([...ownedAppraisals, ...employeeBasedAppraisals, ...sharedAppraisals]));
              }, (error) => {
                console.error('Firestore teamAppraisals error:', error);
              });
            
            // === FALLBACK-QUERY: Finde Appraisals √ºber employeeId ===
            // Dies findet Dokumente, bei denen userId falsch ist, aber employeeId zu einem 
            // unserer Mitarbeiter geh√∂rt. Diese werden dann automatisch repariert.
            const loadEmployeeBasedAppraisals = async () => {
              // Nur wenn wir eigene Mitarbeiter haben
              const ownedMemberIds = teamMembers.filter(m => m._isOwner).map(m => m.id);
              
              if (ownedMemberIds.length === 0) return;
              
              // Cleanup alte Listener
              unsubEmployeeBased.forEach(unsub => unsub());
              unsubEmployeeBased = [];
              employeeBasedAppraisals = [];
              
              devLog('üîç Fallback-Suche: Pr√ºfe Appraisals f√ºr', ownedMemberIds.length, 'Mitarbeiter');
              
              for (const memberId of ownedMemberIds) {
                const unsub = db.collection('teamAppraisals')
                  .where('employeeId', '==', memberId)
                  .onSnapshot(async (snapshot) => {
                    // Finde Dokumente die NICHT bereits in ownedAppraisals sind
                    const missingAppraisals = snapshot.docs
                      .filter(doc => !ownedAppraisals.some(a => a.id === doc.id))
                      .map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        _isOwner: true,
                        _foundViaEmployeeId: true // Markierung f√ºr Debugging
                      }));
                    
                    if (missingAppraisals.length > 0) {
                      devLog(`‚ö†Ô∏è Gefunden via employeeId (${memberId}):`, missingAppraisals.length, 'Dokumente mit falscher userId');
                      
                      // === AUTO-REPAIR: Korrigiere die falschen userId/managerId ===
                      for (const appraisal of missingAppraisals) {
                        try {
                          // Nur reparieren wenn userId wirklich falsch ist
                          if (appraisal.userId !== user.uid) {
                            devLog(`  üîß Auto-Repair f√ºr Dokument`);
                            devLog('     userId aktualisiert');
                            
                            await db.collection('teamAppraisals').doc(appraisal.id).update({
                              userId: user.uid,
                              managerId: user.uid,
                              _autoRepairedAt: new Date().toISOString(),
                              _autoRepairedUserIdFrom: appraisal.userId || 'MISSING',
                              _autoRepairedBy: 'manager_fallback_query'
                            });
                            
                            devLog('     ‚úÖ Repariert!');
                          }
                        } catch (err) {
                          console.warn(`     ‚ùå Reparatur fehlgeschlagen:`, err.message);
                        }
                      }
                    }
                    
                    // Entferne alte Eintr√§ge f√ºr diesen Mitarbeiter
                    employeeBasedAppraisals = employeeBasedAppraisals.filter(a => a.employeeId !== memberId);
                    
                    // F√ºge gefundene hinzu (die noch nicht in ownedAppraisals sind)
                    const newAppraisals = snapshot.docs
                      .filter(doc => !ownedAppraisals.some(a => a.id === doc.id))
                      .map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        _isOwner: true,
                        _foundViaEmployeeId: true
                      }));
                    
                    employeeBasedAppraisals = [...employeeBasedAppraisals, ...newAppraisals];
                    combineAndSetAppraisals();
                    
                  }, (err) => {
                    console.warn(`Fallback-Query Fehler f√ºr ${memberId}:`, err);
                  });
                
                unsubEmployeeBased.push(unsub);
              }
            };
            
            // Hilfsfunktion: Kombiniere alle Quellen und dedupliziere
            const combineAndSetAppraisals = () => {
              const all = [...ownedAppraisals, ...employeeBasedAppraisals, ...sharedAppraisals];
              // Deduplizieren - bevorzuge ownedAppraisals
              const unique = all.filter((a, i, arr) => arr.findIndex(x => x.id === a.id) === i);
              setTeamAppraisals(unique);
            };
            
            // 2. Lade Appraisals f√ºr geteilte Mitarbeiter (basierend auf employeeId)
            // Wir nutzen die teamMembers, die bereits geladen sind
            const loadSharedAppraisals = async () => {
              // Hole geteilte Mitarbeiter-IDs
              const sharedMemberIds = teamMembers
                .filter(m => !m._isOwner && m._sharedWithMe)
                .map(m => m.id);
              
              if (sharedMemberIds.length === 0) {
                devLog('üìã Keine geteilten Mitarbeiter - √ºberspringe Appraisal-Laden');
                return;
              }
              
              devLog('üìã Lade Appraisals f√ºr geteilte Mitarbeiter:', sharedMemberIds);
              
              // Cleanup alte Listener
              unsubSharedAppraisals.forEach(unsub => unsub());
              unsubSharedAppraisals = [];
              sharedAppraisals = [];
              
              // F√ºr jeden geteilten Mitarbeiter einen Listener erstellen
              // (Firestore erlaubt max 10 Items in 'in' Query, daher einzeln)
              for (const memberId of sharedMemberIds) {
                const unsub = db.collection('teamAppraisals')
                  .where('employeeId', '==', memberId)
                  .onSnapshot((snapshot) => {
                    // Entferne alte Eintr√§ge f√ºr diesen Mitarbeiter
                    sharedAppraisals = sharedAppraisals.filter(a => a.employeeId !== memberId);
                    
                    // F√ºge neue hinzu
                    const newAppraisals = snapshot.docs.map(doc => ({
                      id: doc.id,
                      ...doc.data(),
                      _isOwner: false,
                      _sharedMember: true
                    }));
                    sharedAppraisals = [...sharedAppraisals, ...newAppraisals];
                    
                    // Kombiniere alle Quellen
                    combineAndSetAppraisals();
                    
                    devLog(`‚úÖ Appraisals f√ºr ${memberId}:`, newAppraisals.length);
                  }, (err) => {
                    console.warn(`‚ö†Ô∏è Fehler beim Laden von Appraisals f√ºr ${memberId}:`, err);
                  });
                
                unsubSharedAppraisals.push(unsub);
              }
            };
            
            // Initial laden und bei √Ñnderungen von teamMembers neu laden
            loadSharedAppraisals();
            loadEmployeeBasedAppraisals(); // Fallback-Query f√ºr besch√§digte Daten
            
            return () => {
              unsubOwned();
              unsubEmployeeBased.forEach(unsub => unsub());
              unsubSharedAppraisals.forEach(unsub => unsub());
            };
          }, [user, guestMode, teamMembers]);
          
          const [selectedCompetencyId, setSelectedCompetencyId] = useState(null);
          const [activeScore, setActiveScore] = useState(3);
          
          // Quiz-spezifische States entfernt
          const [lang, setLang] = useState('de'); // 'de' or 'it'
          
          // === TERMIN MODAL STATES (App-Level) ===
          const [scheduleModalOpen, setScheduleModalOpen] = useState(false);
          const [scheduleModalMember, setScheduleModalMember] = useState(null);
          const [scheduleModalDate, setScheduleModalDate] = useState('');
          
          // SAFE DATA ACCESS (Bug Fix)
          const t = UI_TEXT[lang] || UI_TEXT['de']; 
          const data = APP_DATA[lang] || APP_DATA['de']; 

          const navigateToCompetency = (id, area = 'admin') => {
            setSelectedCompetencyId(id);
            setDetailAreaContext(area);
            setActiveScore(3);
            setActiveView('detail');
          };
          
          const getActiveCompetencyData = () => {
            // Je nach Kontext die richtigen Daten laden
            const isProduction = detailAreaContext === 'production';
            const sourceData = isProduction 
              ? (APP_DATA_PRODUCTION[lang] || APP_DATA_PRODUCTION['de'])
              : (data || APP_DATA['de']);
            
            if (!sourceData || !sourceData.competencies) return null;
            return sourceData.competencies.find(c => c.id === selectedCompetencyId);
          };

          // Components
          const ScoreBadge = ({ score, active }) => {
            const colors = {
              1: "bg-red-100 text-red-800 border-red-200",
              2: "bg-orange-100 text-orange-800 border-orange-200",
              3: "bg-green-100 text-green-800 border-green-200",
              4: "bg-blue-100 text-blue-800 border-blue-200",
              5: "bg-[#E8F5ED] text-[#4D9360] border-[#D1EBE0]"
            };
            
            return React.createElement('div', {
              className: `flex items-center justify-center w-10 h-10 rounded-full font-bold border-2 cursor-pointer transition-all ${active ? 'scale-110 shadow-md ring-2 ring-offset-2 ring-[#6EBD84] ' + colors[score] : 'opacity-60 grayscale hover:grayscale-0'}`,
              onClick: () => setActiveScore(score)
            }, score);
          };

          
          // === TEAM FUNCTIONS (mit Firestore) ===
          
          // Hilfsfunktion: Generiere accessCode (crypto.randomUUID mit sicherem Fallback)
          const generateAccessCode = () => {
            // Prim√§r: crypto.randomUUID() (modern, sicher)
            if (typeof crypto !== 'undefined' && crypto.randomUUID) {
              return crypto.randomUUID();
            }
            // Fallback: crypto.getRandomValues (sicherer als Math.random)
            if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
              const array = new Uint8Array(16);
              crypto.getRandomValues(array);
              // Format als UUID-√§hnlicher String
              const hex = Array.from(array, b => b.toString(16).padStart(2, '0')).join('');
              return `${hex.slice(0,8)}-${hex.slice(8,12)}-${hex.slice(12,16)}-${hex.slice(16,20)}-${hex.slice(20,32)}`;
            }
            // Letzter Fallback f√ºr sehr alte Browser (nicht kryptographisch sicher)
            devWarn('Using insecure Math.random() for accessCode - please update browser');
            return 'xxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'.replace(/x/g, () => 
              Math.floor(Math.random() * 16).toString(16)
            );
          };
          
          const addTeamMember = async (data) => {
            if (!user || !db) return;
            
            try {
              const accessCode = generateAccessCode();
              const selfReflectionUrl = window.location.origin + window.location.pathname + '?accessCode=' + accessCode;
              const managerName = getUserDisplayName(user) || 'Your Manager';
              
              // Mitarbeiter in Firestore speichern
              const memberRef = await db.collection('teamMembers').add({
                userId: user.uid,
                ownerEmail: user.email || '', // NEU: E-Mail des Eigent√ºmers speichern f√ºr Sharing-Anzeige
                name: data.name,
                position: data.position,
                email: data.email || '',
                department: data.department || '',
                accessCode: accessCode,
                createdAt: new Date().toISOString(),
                invitedAt: null,  // Wird erst beim Einladen/Link-Erstellen gesetzt
                lastReminderAt: null
              });
              devLog('‚úì Mitarbeiter erstellt mit accessCode:', accessCode);
              
              // SUCCESS FEEDBACK: Toast anzeigen
              const feedbackMsg = lang === 'de' 
                ? `‚úÖ ${data.name} erfolgreich hinzugef√ºgt!` 
                : lang === 'it' 
                ? `‚úÖ ${data.name} aggiunto con successo!` 
                : `‚úÖ ${data.name} added successfully!`;
              
              const toast = document.createElement('div');
              toast.textContent = feedbackMsg;
              toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #059669, #10b981);
                color: white;
                padding: 16px 32px;
                border-radius: 12px;
                font-weight: 600;
                font-size: 16px;
                box-shadow: 0 10px 40px rgba(5, 150, 105, 0.4);
                z-index: 99999;
                animation: slideUp 0.3s ease-out;
              `;
              document.body.appendChild(toast);
              setTimeout(() => {
                toast.style.transition = 'opacity 0.3s, transform 0.3s';
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(-50%) translateY(20px)';
                setTimeout(() => toast.remove(), 300);
              }, 2500);
              
              // Info: Selbstreflexions-Link muss manuell versendet werden
              // (Firebase Trigger Email Extension nicht konfiguriert)
              
              return memberRef.id; // Gebe die ID zur√ºck f√ºr Import-Verkn√ºpfung
            } catch (error) {
              console.error('Error adding team member:', error);
              showToast(lang === 'de' ? 'Fehler beim Speichern' : lang === 'it' ? 'Errore durante il salvataggio' : 'Error saving', 'error');
              return null;
            }
          };
          
          // === IMPORT SELF-ASSESSMENT FROM LINK ===
          const importSelfAssessment = async () => {
            if (!user || !db || !importData) {
              showToast(lang === 'de' ? 'Bitte zuerst einloggen' : lang === 'it' ? 'Effettua prima il login' : 'Please log in first', 'warning');
              return;
            }
            
            try {
              devLog('üì• Importiere Selbstreflexion:', importData);
              
              // 1. Mitarbeiter anlegen (falls noch nicht vorhanden)
              const employeeName = importData.n || 'Unbekannt';
              const employeePosition = importData.p || '';
              const employeeEmail = importData.e || '';
              
              // Pr√ºfe ob Mitarbeiter mit gleicher Email bereits existiert
              let existingMember = null;
              if (employeeEmail) {
                const existingSnapshot = await db.collection('teamMembers')
                  .where('userId', '==', user.uid)
                  .where('email', '==', employeeEmail)
                  .limit(1)
                  .get();
                
                if (!existingSnapshot.empty) {
                  existingMember = { id: existingSnapshot.docs[0].id, ...existingSnapshot.docs[0].data() };
                  devLog('‚úì Mitarbeiter existiert bereits:', existingMember.name);
                }
              }
              
              let memberId;
              if (existingMember) {
                memberId = existingMember.id;
              } else {
                // Neuen Mitarbeiter anlegen
                memberId = await addTeamMember({
                  name: employeeName,
                  position: employeePosition,
                  email: employeeEmail
                });
              }
              
              if (!memberId) {
                throw new Error('Mitarbeiter konnte nicht erstellt werden');
              }
              
              // 2. Selbstreflexion speichern (mit Verkn√ºpfung zum Mitarbeiter)
              const selfCoreScores = {};
              const selfCoreComments = {};
              if (importData.c && importData.c.length > 0) {
                importData.c.forEach(c => {
                  selfCoreScores[c.i] = c.r;
                  selfCoreComments[c.i] = c.t || '';
                });
              }
              
              const selfLeaderScores = {};
              const selfLeaderComments = {};
              if (importData.im && importData.l && importData.l.length > 0) {
                importData.l.forEach(c => {
                  selfLeaderScores[c.i] = c.r;
                  selfLeaderComments[c.i] = c.t || '';
                });
              }
              
              // Berechne Scores
              const coreValues = Object.values(selfCoreScores).filter(v => v > 0);
              const wieCoreScore = coreValues.length > 0 ? coreValues.reduce((s, v) => s + v, 0) / coreValues.length : 0;
              
              let wieLeadScore = null;
              if (importData.im) {
                const leadValues = Object.values(selfLeaderScores).filter(v => v > 0);
                wieLeadScore = leadValues.length > 0 ? leadValues.reduce((s, v) => s + v, 0) / leadValues.length : 0;
              }
              
              // WAS Score aus Zielen
              let wasScore = 0;
              if (importData.g && importData.g.length > 0) {
                const totalWeight = importData.g.reduce((s, g) => s + (g.w || 0), 0);
                if (totalWeight > 0) {
                  wasScore = importData.g.reduce((s, g) => s + ((g.a || 0) * (g.w || 0) / totalWeight), 0);
                }
              }
              
              // GPS berechnen
              let finalGPS;
              if (wasScore > 0) {
                if (importData.im && wieLeadScore !== null) {
                  finalGPS = (wasScore * 0.5 / 100 * 5) + (wieCoreScore * 0.25) + (wieLeadScore * 0.25);
                } else {
                  finalGPS = (wasScore * 0.5 / 100 * 5) + (wieCoreScore * 0.5);
                }
              } else {
                if (importData.im && wieLeadScore !== null) {
                  finalGPS = (wieCoreScore * 0.5) + (wieLeadScore * 0.5);
                } else {
                  finalGPS = wieCoreScore;
                }
              }
              
              const selfAssessmentData = {
                type: 'self_assessment',
                status: 'completed',
                userId: user.uid,
                employeeId: memberId,
                employeeName: employeeName,
                employeeEmail: employeeEmail,
                period: importData.period || new Date().getFullYear().toString(),
                formData: {
                  employee: employeeName,
                  position: employeePosition,
                  manager: importData.m || '',
                  strengths1: importData.s1 || '',
                  strengths2: importData.s2 || '',
                  careerComment: importData.cc || '',
                  // NEU: Teil E und F aus Share-Link
                  wishesNextYear: importData.wn || '',
                  feedbackManager: importData.fm || '',
                  // NEU: Teil F Feedback-Felder (Q1-Q7)
                  feedbackQ1: importData.fq1 || '',
                  feedbackQ2: importData.fq2 || '',
                  feedbackQ3: importData.fq3 || '',
                  feedbackQ4: importData.fq4 || '',
                  feedbackQ5: importData.fq5 || '',
                  feedbackQ6: importData.fq6 || '',
                  feedbackQ7: importData.fq7 || 0
                },
                goals: importData.g ? importData.g.map((g, i) => ({
                  id: i + 1,
                  name: g.n,
                  weight: g.w,
                  achievement: g.a
                })) : [],
                selfCoreScores: selfCoreScores,
                selfCoreComments: selfCoreComments,
                selfLeaderScores: importData.im ? selfLeaderScores : null,
                selfLeaderComments: importData.im ? selfLeaderComments : null,
                devPlan: importData.d ? importData.d.map((d, i) => ({
                  id: i + 1,
                  measure: d.m,
                  responsible: d.r,
                  deadline: d.dl
                })) : [],
                careerChecks: importData.ck || [false, false, false, false, false],
                isManager: importData.im || false,
                wasScore: wasScore,
                wieCoreScore: wieCoreScore,
                wieLeadScore: wieLeadScore,
                gpsScore: finalGPS,
                importedAt: new Date().toISOString(),
                originalTimestamp: importData.ts,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
              };
              
              await db.collection('teamAppraisals').add(selfAssessmentData);
              devLog('‚úÖ Selbstreflexion erfolgreich importiert f√ºr:', employeeName);
              
              setImportStatus('success');
              
              // Nach 2 Sekunden Modal schlie√üen und zur Team√ºbersicht wechseln
              setTimeout(() => {
                setShowImportModal(false);
                setImportData(null);
                setImportStatus(null);
                setActiveView('teamoverview');
              }, 2500);
              
            } catch (error) {
              console.error('‚ùå Fehler beim Import:', error);
              setImportStatus('error');
            }
          };
          
          // === CLAIM PENDING SELF-ASSESSMENTS ===
          // √úbernimmt alle wartenden Selbstreflexionen f√ºr die aktuelle FK
          const claimPendingSelfAssessments = async () => {
            if (!user || !db || pendingSelfAssessments.length === 0) return;
            
            setClaimingPending(true);
            let successCount = 0;
            let errorCount = 0;
            
            try {
              for (const pending of pendingSelfAssessments) {
                try {
                  const employeeName = pending.employeeName || pending.formData?.employee || 'Unbekannt';
                  const employeeEmail = pending.employeeEmail || '';
                  const employeePosition = pending.formData?.position || '';
                  
                  // 1. Pr√ºfe ob Mitarbeiter bereits existiert
                  let memberId = null;
                  if (employeeEmail) {
                    const existingSnapshot = await db.collection('teamMembers')
                      .where('userId', '==', user.uid)
                      .where('email', '==', employeeEmail)
                      .limit(1)
                      .get();
                    
                    if (!existingSnapshot.empty) {
                      memberId = existingSnapshot.docs[0].id;
                    }
                  }
                  
                  // 2. Falls nicht vorhanden: Neuen Mitarbeiter anlegen
                  if (!memberId) {
                    memberId = await addTeamMember({
                      name: employeeName,
                      position: employeePosition,
                      email: employeeEmail
                    });
                  }
                  
                  if (!memberId) {
                    devError('Konnte Mitarbeiter nicht anlegen');
                    errorCount++;
                    continue;
                  }
                  
                  // 3. Selbstreflexion updaten: userId setzen, pendingStatus entfernen
                  await db.collection('teamAppraisals').doc(pending.id).update({
                    userId: user.uid,
                    employeeId: memberId,
                    pendingStatus: 'claimed',
                    claimedAt: new Date().toISOString(),
                    claimedByEmail: user.email
                  });
                  
                  devLog('‚úÖ Selbstreflexion √ºbernommen f√ºr:', employeeName);
                  successCount++;
                  
                } catch (singleError) {
                  console.error('Fehler bei einzelner Selbstreflexion:', singleError);
                  errorCount++;
                }
              }
              
              // 4. Modal schlie√üen und Erfolg anzeigen
              setShowPendingModal(false);
              setPendingSelfAssessments([]);
              
              const message = lang === 'de'
                ? `‚úÖ ${successCount} Selbstreflexion(en) erfolgreich √ºbernommen!${errorCount > 0 ? `\n‚ö†Ô∏è ${errorCount} konnten nicht importiert werden.` : ''}`
                : lang === 'it'
                ? `‚úÖ ${successCount} autovalutazione(i) importata(e) con successo!${errorCount > 0 ? `\n‚ö†Ô∏è ${errorCount} non potevano essere importate.` : ''}`
                : `‚úÖ ${successCount} self-assessment(s) successfully claimed!${errorCount > 0 ? `\n‚ö†Ô∏è ${errorCount} could not be imported.` : ''}`;
              
              showToast(message, "success");
              setActiveView('teamoverview');
              
            } catch (error) {
              console.error('‚ùå Fehler beim √úbernehmen:', error);
              showToast(lang === 'de' ? 'Fehler beim √úbernehmen der Selbstreflexionen' : 'Error claiming self-assessments', 'error');
            }
            
            setClaimingPending(false);
          };
          
          // Hilfsfunktion: Zeitdifferenz formatieren
          const getTimeSinceInvite = (invitedAt) => {
            if (!invitedAt) return null;
            const now = new Date();
            const invited = new Date(invitedAt);
            const diffMs = now - invited;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            
            if (diffDays > 0) {
              return lang === 'de' ? `vor ${diffDays} Tag${diffDays > 1 ? 'en' : ''}` 
                   : lang === 'it' ? `${diffDays} giorn${diffDays > 1 ? 'i' : 'o'} fa`
                   : `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            } else if (diffHours > 0) {
              return lang === 'de' ? `vor ${diffHours} Stunde${diffHours > 1 ? 'n' : ''}`
                   : lang === 'it' ? `${diffHours} or${diffHours > 1 ? 'e' : 'a'} fa`
                   : `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            }
            return lang === 'de' ? 'gerade eben' : lang === 'it' ? 'poco fa' : 'just now';
          };
          
          const deleteTeamMember = async (id) => {
            if (!user || !db) return;
            
            if (confirm(lang === 'de' ? 'Wirklich l√∂schen?' : lang === 'it' ? 'Eliminare?' : 'Delete?')) {
              try {
                // L√∂sche Mitarbeiter
                await db.collection('teamMembers').doc(id).delete();
                
                // L√∂sche zugeh√∂rige Appraisals
                const appraisalsSnapshot = await db.collection('teamAppraisals')
                  .where('userId', '==', user.uid)
                  .where('employeeId', '==', id)
                  .get();
                
                const batch = db.batch();
                appraisalsSnapshot.docs.forEach(doc => {
                  batch.delete(doc.ref);
                });
                await batch.commit();
              } catch (error) {
                console.error('Error deleting team member:', error);
                showToast(lang === 'de' ? 'Fehler beim L√∂schen' : lang === 'it' ? 'Errore durante eliminazione' : 'Error deleting', 'error');
              }
            }
          };
          
          const startTeamAppraisal = (employeeId, period, existingAppraisal = null) => {
            const employee = teamMembers.find(e => e.id === employeeId);
            if (!employee) return;
            
            // Wenn existingAppraisal √ºbergeben wurde, nutze diesen, sonst suche nach Draft
            const existingDraft = existingAppraisal || teamAppraisals.find(
              a => a.employeeId === employeeId && a.period === period && a.status === 'draft' && a.type === 'review'
            );
            
            localStorage.setItem('nw_current_employee', JSON.stringify({
              employee, period,
              type: 'review',
              appraisalId: existingDraft ? existingDraft.id : 'appr_' + Date.now(),
              existingData: existingDraft,
              // WICHTIG: Manager-Referenz f√ºr Sichtbarkeit speichern
              managerId: user?.uid || null,
              managerName: getUserDisplayName(user) // v92: Vollst√§ndiger Name statt Email-Prefix
            }));
            
            setActiveView('formular');
          };
          
          // Neue Funktion f√ºr Zielvereinbarungen
          const startTeamGoalSetting = (employeeId, period, existingGoal = null) => {
            const employee = teamMembers.find(e => e.id === employeeId);
            if (!employee) return;
            
            // Wenn existingGoal √ºbergeben wurde, nutze diesen, sonst suche nach Draft
            const existingDraft = existingGoal || teamAppraisals.find(
              a => a.employeeId === employeeId && a.period === period && a.status === 'draft' && a.type === 'goals'
            );
            
            localStorage.setItem('nw_current_employee', JSON.stringify({
              employee, period,
              type: 'goals',
              appraisalId: existingDraft ? existingDraft.id : 'goal_' + Date.now(),
              existingData: existingDraft,
              // WICHTIG: Manager-Referenz f√ºr Sichtbarkeit speichern
              managerId: user?.uid || null,
              managerName: getUserDisplayName(user) // v92: Vollst√§ndiger Name statt Email-Prefix
            }));
            
            setActiveView('zielvereinbarung');
          };
          
          const saveTeamAppraisal = async (appraisal) => {
            if (!user || !db) {
              addDebugLog('error', 'Speichern fehlgeschlagen: ' + (!user ? 'Kein User' : 'Keine DB'));
              return;
            }
            
            addDebugLog('info', `Speichere ${appraisal.type || 'review'} f√ºr ${appraisal.employeeName || 'Unbekannt'}...`);
            
            try {
              // Pr√ºfe, ob das Dokument bereits existiert
              const docRef = db.collection('teamAppraisals').doc(appraisal.id);
              const docSnap = await docRef.get();
              const existingData = docSnap.exists ? docSnap.data() : null;
              
              // === KRITISCH: userId (Besitzer) korrekt handhaben ===
              // Die userId bestimmt, welcher Manager das Dokument sieht!
              // Sie darf NICHT √ºberschrieben werden wenn HR bearbeitet.
              let correctUserId;
              
              if (existingData?.userId) {
                // Dokument existiert bereits - Besitzer beibehalten!
                correctUserId = existingData.userId;
                devLog('üîí Bestehender Besitzer beibehalten');
              } else if (appraisal.managerId) {
                // Neues Dokument mit managerId - diese als userId nutzen
                correctUserId = appraisal.managerId;
                devLog('üîë Manager-ID als Besitzer gesetzt');
              } else {
                // Fallback: Aktueller User (nur f√ºr neue Dokumente vom Manager selbst)
                correctUserId = user.uid;
                devLog('üë§ Aktueller User als Besitzer');
              }
              
              // Stelle sicher, dass type gesetzt ist (default: 'review')
              const appraisalWithType = {
                ...appraisal,
                type: appraisal.type || 'review',
                // KRITISCH: userId ist der BESITZER (Manager), nicht der aktuelle Bearbeiter
                userId: correctUserId,
                // managerId sollte mit userId √ºbereinstimmen
                managerId: appraisal.managerId || correctUserId,
                // Audit: Wer hat zuletzt bearbeitet?
                lastEditedBy: user.email || user.uid,
                lastEditedAt: new Date().toISOString()
              };
              
              if (docSnap.exists) {
                // Update existierendes Dokument mit merge
                await docRef.set(appraisalWithType, { merge: true });
                devLog('‚úì Dokument aktualisiert:', appraisalWithType.id);
                addDebugLog('success', `Dokument aktualisiert: ${appraisalWithType.id.slice(0, 20)}...`);
              } else {
                // Neues Dokument erstellen
                await docRef.set(appraisalWithType);
                devLog('‚úì Neues Dokument erstellt:', appraisalWithType.id);
                addDebugLog('success', `Neues Dokument erstellt: ${appraisalWithType.id.slice(0, 20)}...`);
              }
              
              // === SMART-SYNC: Termin automatisch √ºbernehmen ===
              // Wenn im Formular ein Datum eingetragen ist, sync es zum teamMember
              if (appraisalWithType.formData?.date && appraisalWithType.employeeId) {
                try {
                  const dateStr = appraisalWithType.formData.date;
                  // Versuche das Datum zu parsen (Format: YYYY-MM-DD oder mit Zeit)
                  let scheduledDate;
                  if (dateStr.includes('T') || dateStr.includes(' ')) {
                    scheduledDate = new Date(dateStr);
                  } else {
                    // Nur Datum - setze auf 10:00 Uhr als Standard
                    scheduledDate = new Date(dateStr + 'T10:00:00');
                  }
                  
                  if (!isNaN(scheduledDate.getTime())) {
                    // Finde den teamMember und aktualisiere scheduledAt
                    const memberRef = db.collection('teamMembers').doc(appraisalWithType.employeeId);
                    await memberRef.update({ 
                      scheduledAt: scheduledDate.toISOString(),
                      scheduledSource: 'form' // Markiere als "aus Formular √ºbernommen"
                    });
                    devLog('üìÖ Smart-Sync: Termin automatisch √ºbernommen:', scheduledDate.toLocaleDateString('de-DE'));
                  }
                } catch (syncError) {
                  console.warn('Smart-Sync Termin konnte nicht √ºbernommen werden:', syncError);
                  // Fehler beim Sync soll Hauptspeicherung nicht blockieren
                }
              }
              // === ENDE SMART-SYNC ===
              
              // Debug-Log
              devLog('üíæ Gespeicherte Daten:', {
                id: appraisalWithType.id,
                type: appraisalWithType.type,
                status: appraisalWithType.status,
                gpsScore: appraisalWithType.gpsScore,
                wasScore: appraisalWithType.wasScore,
                employeeName: appraisalWithType.employeeName
              });
              
              localStorage.removeItem('nw_current_employee');
              
              // Angepasste Meldung je nach Typ
              const typeLabel = appraisalWithType.type === 'goals' 
                ? (lang === 'de' ? 'Zielvereinbarung' : lang === 'it' ? 'Accordo obiettivi' : 'Goal Agreement')
                : (lang === 'de' ? 'Bewertung' : lang === 'it' ? 'Valutazione' : 'Assessment');
              const statusLabel = appraisalWithType.status === 'draft'
                ? (lang === 'de' ? ' (Entwurf)' : lang === 'it' ? ' (Bozza)' : ' (Draft)')
                : (lang === 'de' ? ' abgeschlossen' : lang === 'it' ? ' completato' : ' completed');
              showToast(typeLabel + statusLabel + (lang === 'de' ? ' gespeichert!' : lang === 'it' ? ' salvato!' : ' saved!'), appraisalWithType.status === 'completed' ? 'success' : 'info'); // v92: Toast statt alert
              setActiveView(isHRAdmin ? 'hrdashboard' : 'teamoverview');
            } catch (error) {
              console.error('Error saving appraisal:', error);
              addDebugLog('error', `Speichern fehlgeschlagen: ${error.message}`);
              showToast(lang === 'de' ? 'Fehler beim Speichern!' : lang === 'it' ? 'Errore durante il salvataggio!' : 'Error saving!', 'error'); // v92: Toast statt alert
              throw error; // v93: Re-throw damit Child-Komponente isSaving zur√ºcksetzen kann
            }
          };
          
          const renderTeamOverview = () => {
            // === ERROR BOUNDARY ===
            try {
            // === LOGIN PR√úFUNG ===
            if (!user) {
              return React.createElement(LoginView, { 
                lang: lang, 
                onLoginSuccess: () => {}
              });
            }
            
            // === HELPER FUNCTIONS ===
            const handleLogout = async () => {
              try { await auth.signOut(); setActiveView('dashboard'); } catch (e) { console.error(e); }
            };
            
            // Selbstreflexions-Link generieren
            const getSelfLink = (member) => member.accessCode 
              ? `${window.location.origin}${window.location.pathname}?accessCode=${member.accessCode}` 
              : null;
            
            // E-Mail mit Link √∂ffnen
            const sendEmail = (member) => {
              const link = getSelfLink(member);
              if (!member.email || !link) return;
              
              const subject = encodeURIComponent(
                lang === 'de' ? `Vorbereitung Jahresgespr√§ch ‚Äì Selbstreflexion` : 
                lang === 'it' ? `Preparazione colloquio annuale ‚Äì Autovalutazione` :
                `Annual Review Preparation ‚Äì Self-Reflection`
              );
              
              const body = encodeURIComponent(
                lang === 'de' 
                  ? `Hallo ${member.name},

zur Vorbereitung auf unser Jahresgespr√§ch bitte ich dich, deine Selbstreflexion digital auszuf√ºllen.

üìã SO FUNKTIONIERT'S:
1. Klicke auf den Link unten
2. F√ºlle die Fragen zu deinen St√§rken und Entwicklungsfeldern aus
3. Bewerte deine Kompetenzen selbst ein
4. Klicke am Ende auf "Absenden"

üîó Dein pers√∂nlicher Link (keine Anmeldung n√∂tig):
${link}

‚è∞ Bitte bis eine Woche vor unserem Gespr√§ch ausf√ºllen.

üí° Hinweis: Deine Eingaben werden automatisch gespeichert. Du kannst das Formular auch unterbrechen und sp√§ter fortsetzen.

Bei Fragen melde dich gerne bei mir.

Viele Gr√º√üe`
                  : lang === 'it'
                  ? `Ciao ${member.name},

per prepararti al nostro colloquio annuale, ti chiedo di compilare la tua autovalutazione in formato digitale.

üìã COME FUNZIONA:
1. Clicca sul link qui sotto
2. Compila le domande sui tuoi punti di forza e aree di sviluppo
3. Valuta le tue competenze
4. Clicca su "Invia" alla fine

üîó Il tuo link personale (nessuna registrazione necessaria):
${link}

‚è∞ Ti prego di compilarlo almeno una settimana prima del nostro incontro.

üí° Nota: I tuoi dati vengono salvati automaticamente. Puoi interrompere e riprendere in qualsiasi momento.

Per qualsiasi domanda, non esitare a contattarmi.

Cordiali saluti`
                  : `Hello ${member.name},

To prepare for our annual review meeting, please complete your self-reflection digitally.

üìã HOW IT WORKS:
1. Click on the link below
2. Answer questions about your strengths and development areas
3. Rate your own competencies
4. Click "Submit" at the end

üîó Your personal link (no login required):
${link}

‚è∞ Please complete this at least one week before our meeting.

üí° Note: Your entries are saved automatically. You can pause and continue later.

If you have any questions, feel free to reach out.

Best regards`
              );
              
              window.location.href = `mailto:${member.email}?subject=${subject}&body=${body}`;
            };
            
            // Link kopieren
            const copyLink = (member) => {
              const link = getSelfLink(member);
              if (link) { navigator.clipboard.writeText(link); showToast(lang === 'de' ? 'Link kopiert!' : 'Link copied!', 'success'); }
            };
            
            // === GENERISCHE PDF UPLOAD/DELETE FUNKTIONEN ===
            // docType: 'self' | 'review' | 'goals'
            
            const handlePdfUpload = async (member, file, docType) => {
              const docTypeLabels = {
                self: { de: 'Selbstreflexion', it: 'Autovalutazione', en: 'Self-Reflection' },
                review: { de: 'Beurteilung', it: 'Valutazione', en: 'Review' },
                goals: { de: 'Zielvereinbarung', it: 'Accordo obiettivi', en: 'Goals Agreement' }
              };
              const label = docTypeLabels[docType]?.[lang] || docTypeLabels[docType]?.en || docType;
              
              devLog(`üì§ PDF Upload (${docType}) gestartet`);
              
              if (!file) {
                console.error('‚ùå Keine Datei √ºbergeben');
                return;
              }
              if (!db) {
                console.error('‚ùå Datenbank nicht verf√ºgbar');
                showToast(lang === 'de' ? 'Datenbank nicht verbunden' : lang === 'it' ? 'Database non connesso' : 'Database not connected', 'error');
                return;
              }
              if (!user) {
                console.error('‚ùå Benutzer nicht angemeldet');
                showToast(lang === 'de' ? 'Bitte anmelden' : lang === 'it' ? 'Effettua il login' : 'Please sign in', 'warning');
                return;
              }
              
              // Pr√ºfe ob User wirklich authentifiziert ist (nicht anonym)
              devLog('üë§ User Status:', {
                uid: user.uid,
                email: user.email,
                isAnonymous: user.isAnonymous
              });
              
              if (user.isAnonymous) {
                showToast(lang === 'de' 
                  ? 'PDF-Upload nur f√ºr angemeldete Benutzer' 
                  : lang === 'it'
                  ? 'Upload PDF solo per utenti registrati'
                  : 'PDF upload for logged-in users only', 'warning');
                return;
              }
              
              // Validiere Dateityp
              if (file.type !== 'application/pdf') {
                showToast(lang === 'de' ? 'Bitte nur PDF-Dateien hochladen' : lang === 'it' ? 'Caricare solo file PDF' : 'Please upload PDF files only', 'warning');
                return;
              }
              
              // Validiere Dateigr√∂√üe (max 5 MB)
              const maxSize = 5 * 1024 * 1024;
              if (file.size > maxSize) {
                showToast(lang === 'de' 
                  ? `Datei zu gro√ü (${(file.size/1024/1024).toFixed(1)} MB). Max: 5 MB`
                  : lang === 'it'
                  ? `File troppo grande (${(file.size/1024/1024).toFixed(1)} MB). Max: 5 MB`
                  : `File too large (${(file.size/1024/1024).toFixed(1)} MB). Max: 5 MB`, 'warning'
                );
                return;
              }
              
              try {
                const currentPeriod = new Date().getFullYear().toString();
                const pdfType = `${docType}_pdf`; // 'self_pdf', 'review_pdf', 'goals_pdf'
                
                // Pr√ºfe ob bereits eine PDF existiert
                devLog(`üîç Suche existierende ${docType} PDFs`);
                const existingSnapshot = await db.collection('teamAppraisals')
                  .where('employeeId', '==', member.id)
                  .where('period', '==', currentPeriod)
                  .where('type', '==', pdfType)
                  .get();
                
                if (!existingSnapshot.empty) {
                  const confirmOverwrite = confirm(
                    lang === 'de' 
                      ? `‚ö†Ô∏è Es existiert bereits eine ${label}-PDF f√ºr ${currentPeriod}.\n\nM√∂chten Sie diese ersetzen?`
                      : lang === 'it'
                      ? `‚ö†Ô∏è Esiste gi√† un PDF ${label} per ${currentPeriod}.\n\nVuoi sostituirlo?`
                      : `‚ö†Ô∏è A ${label} PDF already exists for ${currentPeriod}.\n\nReplace it?`
                  );
                  
                  if (!confirmOverwrite) {
                    devLog('‚ùå Upload abgebrochen durch Benutzer');
                    return;
                  }
                  
                  // L√∂sche alte PDFs
                  for (const doc of existingSnapshot.docs) {
                    devLog('üóëÔ∏è L√∂sche alte PDF:', doc.id);
                    await db.collection('teamAppraisals').doc(doc.id).delete();
                  }
                }
                
                // Erstelle eindeutige ID
                const pdfDocId = `${pdfType}_${member.id}_${currentPeriod}`;
                const storagePath = `pdfs/${user.uid}/${pdfDocId}_${Date.now()}.pdf`;
                
                // === UPLOAD ZU FIREBASE STORAGE (f√ºr gro√üe Dateien bis 5 MB) ===
                devLog('‚òÅÔ∏è Lade PDF in Firebase Storage hoch...');
                let pdfUrl = null;
                let storageMethodUsed = 'firebase_storage';
                
                if (storage) {
                  try {
                    const storageRef = storage.ref(storagePath);
                    const uploadTask = await storageRef.put(file);
                    pdfUrl = await uploadTask.ref.getDownloadURL();
                    devLog('‚úÖ PDF in Storage hochgeladen:', storagePath);
                  } catch (storageError) {
                    console.error('‚ö†Ô∏è Storage Upload fehlgeschlagen:', storageError);
                    // Fallback zu Base64 f√ºr kleine Dateien (< 700 KB nach Base64 = ~500 KB original)
                    if (file.size < 500 * 1024) {
                      devLog('üì¶ Fallback: Konvertiere kleine PDF zu Base64...');
                      const base64Data = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result);
                        reader.onerror = () => reject(new Error('Fehler beim Lesen der Datei'));
                        reader.readAsDataURL(file);
                      });
                      pdfUrl = base64Data;
                      storageMethodUsed = 'base64_firestore';
                    } else {
                      throw new Error(lang === 'de' 
                        ? 'Firebase Storage nicht verf√ºgbar. Bitte Administrator kontaktieren.'
                        : lang === 'it'
                        ? 'Firebase Storage non disponibile. Contatta l\'amministratore.'
                        : 'Firebase Storage unavailable. Contact administrator.');
                    }
                  }
                } else {
                  // Kein Storage verf√ºgbar - Fallback f√ºr kleine Dateien
                  if (file.size < 500 * 1024) {
                    devLog('üì¶ Kein Storage - Konvertiere kleine PDF zu Base64...');
                    const base64Data = await new Promise((resolve, reject) => {
                      const reader = new FileReader();
                      reader.onload = () => resolve(reader.result);
                      reader.onerror = () => reject(new Error('Fehler beim Lesen der Datei'));
                      reader.readAsDataURL(file);
                    });
                    pdfUrl = base64Data;
                    storageMethodUsed = 'base64_firestore';
                  } else {
                    throw new Error(lang === 'de' 
                      ? 'F√ºr Dateien > 500 KB wird Firebase Storage ben√∂tigt.'
                      : lang === 'it'
                      ? 'Per file > 500 KB √® necessario Firebase Storage.'
                      : 'Firebase Storage required for files > 500 KB.');
                  }
                }
                
                // Daten-Objekt f√ºr Firestore (nur Metadaten + URL, NICHT die Base64-Daten)
                const pdfUploadData = {
                  id: pdfDocId,
                  type: pdfType,
                  isPdfUpload: true,
                  pdfFileName: file.name,
                  pdfUrl: pdfUrl,  // URL statt pdfData
                  storagePath: storageMethodUsed === 'firebase_storage' ? storagePath : null,
                  pdfSize: file.size,
                  storageMethod: storageMethodUsed,
                  employeeId: member.id,
                  employeeName: member.name,
                  position: member.position || '',
                  department: member.department || '',
                  userId: user.uid,
                  period: currentPeriod,
                  status: 'pdf_uploaded',
                  uploadedBy: user.email || 'F√ºhrungskraft',
                  uploadedAt: new Date().toISOString(),
                  createdAt: new Date().toISOString()
                };
                
                devLog('üíæ Speichere Metadaten in Firestore...');
                await db.collection('teamAppraisals').doc(pdfDocId).set(pdfUploadData);
                
                devLog('‚úÖ PDF erfolgreich hochgeladen:', pdfDocId);
                
                showToast(lang === 'de' 
                  ? `${label}-PDF hochgeladen`
                  : lang === 'it'
                  ? `PDF ${label} caricato`
                  : `${label} PDF uploaded`, 'success'
                );
                
              } catch (error) {
                console.error('‚ùå PDF Upload Fehler:', error);
                
                let errorMsg = lang === 'de'
                  ? '‚ùå Fehler beim Hochladen: ' + (error.message || 'Unbekannter Fehler')
                  : lang === 'it'
                  ? '‚ùå Errore durante il caricamento: ' + (error.message || 'Errore sconosciuto')
                  : '‚ùå Upload error: ' + (error.message || 'Unknown error');
                
                if (error.code === 'permission-denied' || error.message?.includes('permission')) {
                  errorMsg = lang === 'de'
                    ? '‚ùå Keine Berechtigung.\n\nBitte melden Sie sich ab und wieder an.'
                    : lang === 'it'
                    ? '‚ùå Permesso negato.\n\nEffettua logout e login.'
                    : '‚ùå Permission denied.\n\nPlease sign out and sign in again.';
                }
                
                showToast(errorMsg, "error");
              }
            };
            
            // Generische PDF-L√∂schfunktion
            const handleDeletePdf = async (member, docType) => {
              const docTypeLabels = {
                self: { de: 'Selbstreflexion', it: 'Autovalutazione', en: 'Self-Reflection' },
                review: { de: 'Beurteilung', it: 'Valutazione', en: 'Review' },
                goals: { de: 'Zielvereinbarung', it: 'Accordo obiettivi', en: 'Goals Agreement' }
              };
              const label = docTypeLabels[docType]?.[lang] || docTypeLabels[docType]?.en || docType;
              
              // Sicherheitsabfrage
              const confirmed = confirm(
                lang === 'de'
                  ? `‚ö†Ô∏è ${label}-PDF f√ºr "${member.name}" wirklich l√∂schen?\n\nDiese Aktion kann nicht r√ºckg√§ngig gemacht werden.`
                  : lang === 'it'
                  ? `‚ö†Ô∏è Eliminare davvero il PDF ${label} per "${member.name}"?\n\nQuesta azione non pu√≤ essere annullata.`
                  : `‚ö†Ô∏è Really delete ${label} PDF for "${member.name}"?\n\nThis action cannot be undone.`
              );
              
              if (!confirmed) return;
              
              try {
                const currentPeriod = new Date().getFullYear().toString();
                const pdfType = `${docType}_pdf`;
                
                devLog(`üóëÔ∏è L√∂sche ${pdfType}`);
                
                // Finde und l√∂sche das PDF-Dokument
                const snapshot = await db.collection('teamAppraisals')
                  .where('employeeId', '==', member.id)
                  .where('period', '==', currentPeriod)
                  .where('type', '==', pdfType)
                  .get();
                
                if (snapshot.empty) {
                  // Fallback: Suche auch nach isPdfUpload f√ºr alte self-PDFs
                  if (docType === 'self') {
                    const fallbackSnapshot = await db.collection('teamAppraisals')
                      .where('employeeId', '==', member.id)
                      .where('period', '==', currentPeriod)
                      .where('isPdfUpload', '==', true)
                      .get();
                    
                    for (const doc of fallbackSnapshot.docs) {
                      await db.collection('teamAppraisals').doc(doc.id).delete();
                      devLog('‚úÖ (Fallback) PDF gel√∂scht:', doc.id);
                    }
                    
                    if (!fallbackSnapshot.empty) {
                      showToast(lang === 'de' ? 'PDF gel√∂scht' : lang === 'it' ? 'PDF eliminato' : 'PDF deleted', 'success');
                      return;
                    }
                  }
                  
                  showToast(lang === 'de' ? 'Kein PDF gefunden' : lang === 'it' ? 'Nessun PDF trovato' : 'No PDF found', 'info');
                  return;
                }
                
                for (const doc of snapshot.docs) {
                  const docData = doc.data();
                  
                  // L√∂sche auch aus Firebase Storage wenn vorhanden
                  if (docData.storagePath && storage) {
                    try {
                      await storage.ref(docData.storagePath).delete();
                      devLog('‚úÖ PDF aus Storage gel√∂scht:', docData.storagePath);
                    } catch (storageErr) {
                      console.warn('‚ö†Ô∏è Storage-L√∂schung fehlgeschlagen (evtl. bereits gel√∂scht):', storageErr);
                    }
                  }
                  
                  await db.collection('teamAppraisals').doc(doc.id).delete();
                  devLog('‚úÖ PDF-Metadaten gel√∂scht:', doc.id);
                }
                
                showToast(lang === 'de' ? 'PDF gel√∂scht' : lang === 'it' ? 'PDF eliminato' : 'PDF deleted', 'success');
                
              } catch (error) {
                console.error('‚ùå Fehler beim L√∂schen:', error);
                showToast(lang === 'de' 
                  ? 'Fehler beim L√∂schen' 
                  : lang === 'it'
                  ? 'Errore durante l\'eliminazione'
                  : 'Delete error', 'error'
                );
              }
            };
            
            // Hilfsfunktion: PDF in neuem Tab √∂ffnen
            const openPdfInNewTab = async (pdfData, fileName) => {
              try {
                let pdfSource = pdfData.pdfUrl || pdfData.pdfData;
                
                // Falls storagePath vorhanden, hole URL
                if (pdfData.storagePath && storage) {
                  pdfSource = await storage.ref(pdfData.storagePath).getDownloadURL();
                }
                
                if (!pdfSource) {
                  showToast(lang === 'de' ? 'PDF-Daten nicht verf√ºgbar' : lang === 'it' ? 'Dati PDF non disponibili' : 'PDF data not available', 'warning');
                  return;
                }
                
                // √ñffne in neuem Tab
                const newWindow = window.open('', '_blank');
                if (newWindow) {
                  newWindow.document.write(
                    '<html><head><title>' + (fileName || 'PDF') + '</title></head>' +
                    '<body style="margin:0;"><embed width="100%" height="100%" src="' + pdfSource + '" type="application/pdf"></body></html>'
                  );
                } else {
                  // Fallback: Download
                  const link = document.createElement('a');
                  link.href = pdfSource;
                  link.download = fileName || 'Dokument.pdf';
                  link.click();
                }
              } catch (error) {
                console.error('Fehler beim √ñffnen der PDF:', error);
                showToast(lang === 'de' ? 'Fehler beim √ñffnen der PDF' : lang === 'it' ? 'Errore apertura PDF' : 'Error opening PDF', 'error');
              }
            };
            
            // Kompatibilit√§t: Alte Funktion als Wrapper
            const handleSelfReflectionPdfUpload = (member, file) => handlePdfUpload(member, file, 'self');
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // MITARBEITER TEILEN - VEREINFACHTE, ROBUSTE IMPLEMENTIERUNG
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            
            // √ñffne das Share-Modal f√ºr einen Mitarbeiter
            const shareMember = (member) => {
              devLog('üîó shareMember aufgerufen f√ºr:', member.name);
              setShareModalMember(member);
              setShareModalEmail('');
              setShareModalLink('');
              setShareModalStep(1);
              setShareModalOpen(true);
            };
            
            // Einfaches Share Modal - direkt hier definiert f√ºr bessere Lesbarkeit
            const renderShareModal = () => {
              if (!shareModalOpen) return null;
              
              const currentMember = shareModalMember;
              const currentEmail = shareModalEmail;
              const currentLink = shareModalLink;
              const currentStep = shareModalStep;
              
              // Funktion: Teilen ausf√ºhren
              const handleShare = () => {
                devLog('üì§ handleShare aufgerufen');
                
                // Validierung
                if (!currentMember) {
                  showToast(getText(lang, 'Kein Mitarbeiter ausgew√§hlt', 'Nessun collaboratore selezionato', 'No employee selected'), 'warning');
                  return;
                }
                
                const email = (currentEmail || '').trim().toLowerCase();
                devLog('üì§ Share E-Mail');
                
                if (!email) {
                  showToast(lang === 'de' ? 'Bitte E-Mail eingeben' : 'Please enter email', 'warning');
                  return;
                }
                
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                  showToast(lang === 'de' ? 'Ung√ºltige E-Mail-Adresse' : 'Invalid email address', 'warning');
                  return;
                }
                
                // Bereits geteilt? (case-insensitive pr√ºfen)
                const existingShared = (currentMember.sharedWith || []).map(e => e.toLowerCase());
                if (existingShared.includes(email)) {
                  showToast(lang === 'de' ? 'Bereits geteilt' : 'Already shared', 'info');
                  return;
                }
                
                // Firestore Update
                devLog('üîÑ Speichere in Firestore...');
                
                const newSharedWith = [...(currentMember.sharedWith || []), email];
                
                // NEU: Auch ownerEmail speichern (f√ºr bestehende Mitarbeiter die noch keine haben)
                const updateData = {
                  sharedWith: newSharedWith
                };
                
                // Falls ownerEmail noch nicht gesetzt ist, jetzt setzen
                if (!currentMember.ownerEmail && user?.email) {
                  updateData.ownerEmail = user.email;
                  devLog('üìß Setze ownerEmail');
                }
                
                db.collection('teamMembers').doc(currentMember.id).update(updateData)
                .then(() => {
                  devLog('‚úÖ Firestore Update erfolgreich');
                  
                  // Lokalen State aktualisieren
                  setTeamMembers(prev => prev.map(m => 
                    m.id === currentMember.id ? { ...m, sharedWith: newSharedWith } : m
                  ));
                  
                  // Link generieren (einfach - nur App-URL, FK2 muss sich einloggen)
                  const baseUrl = window.location.origin + window.location.pathname;
                  setShareModalLink(baseUrl);
                  setShareModalStep(2);
                  
                  devLog('‚úÖ Teilen erfolgreich');
                })
                .catch((err) => {
                  console.error('‚ùå Firestore Fehler:', err);
                  showToast(lang === 'de' ? 'Fehler beim Speichern' : 'Error saving', 'error');
                });
              };
              
              // Funktion: Link kopieren
              const handleCopyLink = () => {
                const textToCopy = currentLink || window.location.origin + window.location.pathname;
                navigator.clipboard.writeText(textToCopy)
                  .then(() => showToast(lang === 'de' ? 'Link kopiert!' : 'Link copied!', 'success'))
                  .catch(() => {
                    // Fallback
                    const ta = document.createElement('textarea');
                    ta.value = textToCopy;
                    document.body.appendChild(ta);
                    ta.select();
                    document.execCommand('copy');
                    document.body.removeChild(ta);
                    showToast(lang === 'de' ? 'Link kopiert!' : 'Link copied!', 'success');
                  });
              };
              
              // Funktion: Per E-Mail senden
              const handleSendEmail = () => {
                const memberName = currentMember ? currentMember.name : getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee');
                const appUrl = currentLink || window.location.origin + window.location.pathname;
                const subject = encodeURIComponent(
                  lang === 'de' 
                    ? `Einladung: Mitarbeiter "${memberName}" wurde mit Ihnen geteilt`
                    : `Invitation: Employee "${memberName}" shared with you`
                );
                const body = encodeURIComponent(
                  lang === 'de'
                    ? `Hallo,\n\nich habe den Mitarbeiter "${memberName}" im Performance Management System mit Ihnen geteilt.\n\nBitte loggen Sie sich unter folgendem Link ein:\n${appUrl}\n\nNach dem Login sehen Sie den Mitarbeiter in Ihrer Team-√úbersicht.\n\nMit freundlichen Gr√º√üen`
                    : `Hello,\n\nI have shared the employee "${memberName}" with you in the Performance Management System.\n\nPlease log in at:\n${appUrl}\n\nAfter logging in, you will see the employee in your team overview.\n\nBest regards`
                );
                window.open('mailto:' + currentEmail + '?subject=' + subject + '&body=' + body);
              };
              
              // Modal schlie√üen
              const handleClose = () => {
                setShareModalOpen(false);
                setShareModalMember(null);
                setShareModalEmail('');
                setShareModalLink('');
                setShareModalStep(1);
              };
              
              // RENDER MODAL
              return React.createElement('div', {
                className: 'fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4',
                onClick: (e) => { if (e.target === e.currentTarget) handleClose(); }
              },
                React.createElement('div', { 
                  className: 'bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden',
                  onClick: (e) => e.stopPropagation()
                },
                  // Header
                  React.createElement('div', { 
                    className: 'bg-gradient-to-r from-[#243186] to-[#1a2460] text-white p-5'
                  },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                      React.createElement('div', { className: 'flex items-center gap-3' },
                        React.createElement(Users, { size: 22 }),
                        React.createElement('div', null,
                          React.createElement('h3', { className: 'font-bold text-lg' }, 
                            lang === 'de' ? 'Mitarbeiter teilen' : 'Share Employee'
                          ),
                          currentMember && React.createElement('p', { className: 'text-white/80 text-sm' }, 
                            currentMember.name
                          )
                        )
                      ),
                      React.createElement('button', {
                        onClick: handleClose,
                        className: 'text-white/80 hover:text-white p-1'
                      }, React.createElement(X, { size: 22 }))
                    )
                  ),
                  
                  // Content
                  React.createElement('div', { className: 'p-5' },
                    currentStep === 1 ? (
                      // STEP 1: E-Mail eingeben
                      React.createElement('div', { className: 'space-y-4' },
                        React.createElement('p', { className: 'text-slate-600 text-sm' },
                          lang === 'de' 
                            ? 'Geben Sie die E-Mail-Adresse der F√ºhrungskraft ein, die diesen Mitarbeiter mitverwalten soll:'
                            : 'Enter the email of the manager who should co-manage this employee:'
                        ),
                        React.createElement('input', {
                          type: 'email',
                          value: currentEmail,
                          onChange: (e) => setShareModalEmail(e.target.value),
                          onKeyDown: (e) => { if (e.key === 'Enter') handleShare(); },
                          placeholder: 'email@example.com',
                          className: 'w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-[#243186] focus:outline-none text-base',
                          autoFocus: true
                        }),
                        React.createElement('button', {
                          onClick: handleShare,
                          disabled: !currentEmail,
                          className: 'w-full py-3 bg-[#6EBD84] hover:bg-[#5da872] disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2'
                        },
                          React.createElement(Share2, { size: 18 }),
                          lang === 'de' ? 'Teilen' : 'Share'
                        )
                      )
                    ) : (
                      // STEP 2: Erfolg + Link
                      React.createElement('div', { className: 'space-y-4' },
                        // Erfolgs-Banner
                        React.createElement('div', { 
                          className: 'bg-green-50 border border-green-200 rounded-xl p-4 flex items-center gap-3'
                        },
                          React.createElement(CheckCircle2, { size: 24, className: 'text-green-600 flex-shrink-0' }),
                          React.createElement('div', null,
                            React.createElement('p', { className: 'font-bold text-green-800' },
                              lang === 'de' ? 'Erfolgreich geteilt!' : 'Successfully shared!'
                            ),
                            React.createElement('p', { className: 'text-green-600 text-sm' },
                              currentEmail
                            )
                          )
                        ),
                        
                        // Info-Box
                        React.createElement('div', { 
                          className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 text-sm text-blue-800'
                        },
                          React.createElement('p', { className: 'font-medium mb-1' },
                            lang === 'de' ? 'Was passiert jetzt?' : 'What happens now?'
                          ),
                          React.createElement('p', null,
                            lang === 'de' 
                              ? `Wenn sich ${currentEmail} einloggt, sieht diese Person "${currentMember ? currentMember.name : ''}" automatisch in ihrer Team-√úbersicht.`
                              : `When ${currentEmail} logs in, they will automatically see "${currentMember ? currentMember.name : ''}" in their team overview.`
                          )
                        ),
                        
                        // Buttons
                        React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                          React.createElement('button', {
                            onClick: handleCopyLink,
                            className: 'py-3 bg-[#243186] hover:bg-[#1a2460] text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2'
                          },
                            React.createElement(Copy, { size: 16 }),
                            lang === 'de' ? 'Link kopieren' : 'Copy Link'
                          ),
                          React.createElement('button', {
                            onClick: handleSendEmail,
                            className: 'py-3 bg-[#6EBD84] hover:bg-[#5da872] text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2'
                          },
                            React.createElement(Mail, { size: 16 }),
                            lang === 'de' ? 'E-Mail senden' : 'Send Email'
                          )
                        ),
                        
                        // Schlie√üen
                        React.createElement('button', {
                          onClick: handleClose,
                          className: 'w-full py-2 text-slate-500 hover:text-slate-700 text-sm'
                        },
                          lang === 'de' ? 'Schlie√üen' : 'Close'
                        )
                      )
                    )
                  )
                )
              );
            };
            
            // Termin setzen - √∂ffnet Modal statt prompt()
            const scheduleDate = (member) => {
              setScheduleModalMember(member);
              // Pre-fill mit bestehendem Termin oder leer
              // FIX: Verwende lokale Zeit statt UTC f√ºr korrekte Anzeige im datetime-local Input
              let existing = '';
              if (member.scheduledAt) {
                const d = new Date(member.scheduledAt);
                // Format: YYYY-MM-DDTHH:MM f√ºr datetime-local Input (lokale Zeit!)
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                const hours = String(d.getHours()).padStart(2, '0');
                const minutes = String(d.getMinutes()).padStart(2, '0');
                existing = `${year}-${month}-${day}T${hours}:${minutes}`;
              }
              setScheduleModalDate(existing);
              setScheduleModalOpen(true);
            };
            
            // Termin speichern (aus Modal)
            const saveScheduleDate = async () => {
              if (!scheduleModalMember || !scheduleModalDate) {
                setScheduleModalOpen(false);
                return;
              }
              
              const parsed = new Date(scheduleModalDate);
              if (isNaN(parsed)) { 
                showToast(lang === 'de' ? 'Ung√ºltiges Datum' : 'Invalid date', 'warning'); 
                return; 
              }
              
              try {
                await db.collection('teamMembers').doc(scheduleModalMember.id).update({ 
                  scheduledAt: parsed.toISOString(),
                  scheduledSource: 'manual' // Markiere als "manuell gesetzt"
                });
                
                // SUCCESS FEEDBACK
                const feedbackMsg = lang === 'de' 
                  ? `‚úÖ Termin f√ºr ${scheduleModalMember.name} gespeichert!` 
                  : lang === 'it' 
                  ? `‚úÖ Appuntamento per ${scheduleModalMember.name} salvato!` 
                  : `‚úÖ Appointment for ${scheduleModalMember.name} saved!`;
                
                const toast = document.createElement('div');
                toast.textContent = feedbackMsg;
                toast.style.cssText = `
                  position: fixed;
                  bottom: 100px;
                  left: 50%;
                  transform: translateX(-50%);
                  background: linear-gradient(135deg, #059669, #10b981);
                  color: white;
                  padding: 16px 32px;
                  border-radius: 12px;
                  font-weight: 600;
                  font-size: 16px;
                  box-shadow: 0 10px 40px rgba(5, 150, 105, 0.4);
                  z-index: 99999;
                  animation: slideUp 0.3s ease-out;
                `;
                document.body.appendChild(toast);
                setTimeout(() => {
                  toast.style.transition = 'opacity 0.3s, transform 0.3s';
                  toast.style.opacity = '0';
                  toast.style.transform = 'translateX(-50%) translateY(20px)';
                  setTimeout(() => toast.remove(), 300);
                }, 2500);
                
                setScheduleModalOpen(false);
                setScheduleModalMember(null);
              } catch (e) { 
                console.error(e); 
                showToast(lang === 'de' ? 'Fehler beim Speichern' : 'Error saving', 'error');
              }
            };
            
            // Termin l√∂schen
            const deleteScheduleDate = async () => {
              if (!scheduleModalMember) return;
              if (!confirm(lang === 'de' ? 'Termin wirklich l√∂schen?' : 'Really delete appointment?')) return;
              
              try {
                await db.collection('teamMembers').doc(scheduleModalMember.id).update({ 
                  scheduledAt: null,
                  scheduledSource: null,
                  meetingDone: null // Auch meetingDone zur√ºcksetzen
                });
                setScheduleModalOpen(false);
                setScheduleModalMember(null);
              } catch (e) { 
                console.error(e); 
              }
            };
            
            // NEU: "Beurteilungsgespr√§ch gef√ºhrt" Toggle
            const toggleMeetingDone = async (member) => {
              try {
                const newValue = !member.meetingDone;
                await db.collection('teamMembers').doc(member.id).update({ 
                  meetingDone: newValue,
                  meetingDoneAt: newValue ? new Date().toISOString() : null
                });
                devLog(`‚úÖ Beurteilungsgespr√§ch gef√ºhrt`);
              } catch (e) { 
                console.error('Fehler beim Speichern von meetingDone:', e);
              }
            };
            
            // NEU: "Zielvereinbarungsgespr√§ch gef√ºhrt" Toggle
            const toggleGoalMeetingDone = async (member) => {
              try {
                const newValue = !member.goalMeetingDone;
                await db.collection('teamMembers').doc(member.id).update({ 
                  goalMeetingDone: newValue,
                  goalMeetingDoneAt: newValue ? new Date().toISOString() : null
                });
                devLog(`‚úÖ Zielvereinbarungsgespr√§ch gef√ºhrt`);
              } catch (e) { 
                console.error('Fehler beim Speichern von goalMeetingDone:', e);
              }
            };
            
            // Status berechnen
            const getStatus = (member) => {
              const appraisals = teamAppraisals.filter(a => a.employeeId === member.id);
              
              // Finde digitale Selbstreflexion (ohne PDF)
              const digitalSelf = appraisals.find(a => 
                (a.type === 'self' || a.type === 'self-reflection' || a.type === 'self_assessment' || a.type === 'self_assessment_standalone') && 
                !a.isPdfUpload
              );
              
              // Finde PDF-Selbstreflexion
              const pdfSelf = appraisals.find(a => 
                (a.type === 'self_pdf' || (a.isPdfUpload === true && !a.type?.includes('review') && !a.type?.includes('goal')))
              );
              
              // Finde digitale Review (ohne PDF)
              const digitalReview = appraisals.find(a => 
                (a.type === 'review' || (!a.type && !a.isPdfUpload)) && 
                a.type !== 'self' && a.type !== 'self-reflection' && a.type !== 'self_assessment' && a.type !== 'self_assessment_standalone' && 
                a.type !== 'self_pdf' && a.type !== 'review_pdf' && a.type !== 'goals_pdf' &&
                !a.isPdfUpload
              );
              
              // Finde PDF-Review (unterschriebene Beurteilung)
              const pdfReview = appraisals.find(a => a.type === 'review_pdf');
              
              // Finde digitale Goals (ohne PDF)
              const digitalGoals = appraisals.find(a => 
                (a.type === 'goal' || a.type === 'goals') && !a.isPdfUpload
              );
              
              // Finde PDF-Goals (unterschriebene Zielvereinbarung)
              const pdfGoals = appraisals.find(a => a.type === 'goals_pdf');
              
              // Bevorzuge digitale wenn vorhanden, sonst PDF
              const selfReflection = digitalSelf || pdfSelf;
              const review = digitalReview || pdfReview;
              const goals = digitalGoals || pdfGoals;
              
              return {
                self: selfReflection,
                selfDigital: digitalSelf,
                selfPdf: pdfSelf,
                review: review,
                reviewDigital: digitalReview,
                reviewPdf: pdfReview,
                goals: goals,
                goalsDigital: digitalGoals,
                goalsPdf: pdfGoals
              };
            };
            
            // Fortschritt berechnen
            const totalTasks = teamMembers.length * 3;
            let completedTasks = 0;
            teamMembers.forEach(m => {
              const s = getStatus(m);
              if (s.self) completedTasks++;
              if (s.review) completedTasks++;
              if (s.goals) completedTasks++;
            });
            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            // === ERWEITERTE KPIs ===
            const now = new Date();
            const thisWeekEnd = new Date(now);
            thisWeekEnd.setDate(now.getDate() + 7);
            
            // Reviews ausstehend (ohne Review oder nur Entwurf)
            const pendingReviews = teamMembers.filter(m => {
              const s = getStatus(m);
              return !s.review || s.review.status === 'draft';
            }).length;
            
            // Selbstreflexionen fehlen (MA hat noch keine eingereicht)
            const pendingSelfReflections = teamMembers.filter(m => !getStatus(m).self).length;
            
            // Termine diese Woche
            const appointmentsThisWeek = teamMembers.filter(m => {
              if (!m.scheduledAt) return false;
              const d = new Date(m.scheduledAt);
              return d >= now && d <= thisWeekEnd;
            });
            
            // √úberf√§llige Termine (nur wenn Gespr√§ch NICHT gef√ºhrt)
            const overdueAppointments = teamMembers.filter(m => {
              if (!m.scheduledAt) return false;
              if (m.meetingDone === true) return false; // Nicht √ºberf√§llig wenn Gespr√§ch gef√ºhrt
              return new Date(m.scheduledAt) < now;
            });
            
            // GPS-Durchschnitt
            const reviewsWithGPS = teamMembers.map(m => getStatus(m).review).filter(r => r && r.gpsScore);
            const avgGPS = reviewsWithGPS.length > 0 
              ? (reviewsWithGPS.reduce((sum, r) => sum + r.gpsScore, 0) / reviewsWithGPS.length).toFixed(1)
              : null;
            
            // === RENDER ===
            return React.createElement('div', { className: 'space-y-6 pb-10 max-w-5xl mx-auto' },
              
              // === HEADER (Kompakter) ===
              React.createElement('div', { 
                className: 'rounded-3xl p-6 text-white relative overflow-hidden',
                style: { background: 'linear-gradient(135deg, #243186 0%, #1a2563 100%)' }
              },
                // Decorative circles
                React.createElement('div', { 
                  className: 'absolute -right-10 -top-10 w-40 h-40 rounded-full bg-white/5'
                }),
                React.createElement('div', { 
                  className: 'absolute -right-5 -bottom-10 w-32 h-32 rounded-full bg-white/5'
                }),
                
                React.createElement('div', { className: 'relative flex justify-between items-start' },
                  React.createElement('div', null,
                    React.createElement('h1', { className: 'text-2xl font-bold flex items-center gap-3' },
                      React.createElement(Users, { size: 28 }),
                      lang === 'de' ? 'Team-√úbersicht' : lang === 'it' ? 'Panoramica team' : 'Team Overview'
                    ),
                    React.createElement('p', { className: 'text-blue-200 mt-1 text-sm' },
                      `${teamMembers.length} ${lang === 'de' ? 'Mitarbeiter' : 'employees'}`
                    )
                  ),
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    // View Toggle (Karten/Liste)
                    React.createElement('div', { className: 'flex items-center gap-1 bg-white/10 rounded-xl p-1 backdrop-blur-sm' },
                      React.createElement('button', {
                        onClick: () => setTeamViewMode('cards'),
                        className: `px-3 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5 ${teamViewMode === 'cards' ? 'bg-white text-[#243186]' : 'text-white/70 hover:text-white'}`
                      }, React.createElement(LayoutGrid, { size: 14 }), lang === 'de' ? 'Karten' : 'Cards'),
                      React.createElement('button', {
                        onClick: () => setTeamViewMode('list'),
                        className: `px-3 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5 ${teamViewMode === 'list' ? 'bg-white text-[#243186]' : 'text-white/70 hover:text-white'}`
                      }, React.createElement(List, { size: 14 }), lang === 'de' ? 'Liste' : 'List')
                    ),
                    // Logout Button
                    React.createElement('button', {
                      onClick: handleLogout,
                      className: 'px-4 py-2 bg-white/10 hover:bg-white/20 rounded-2xl text-sm flex items-center gap-2 backdrop-blur-sm border border-white/10'
                    }, React.createElement(LogOut, { size: 16 }), getText(lang, 'Abmelden', 'Esci', 'Logout'))
                  )
                ),
                
                // Mini Progress
                teamMembers.length > 0 && React.createElement('div', { className: 'relative mt-4 flex items-center gap-3' },
                  React.createElement('div', { className: 'flex-1 bg-white/20 rounded-full h-2' },
                    React.createElement('div', { 
                      className: 'h-full rounded-full bg-[#6EBD84] transition-all',
                      style: { width: `${progress}%` }
                    })
                  ),
                  React.createElement('span', { className: 'text-sm font-semibold' }, `${progress}%`)
                )
              ),
              
              // === KPI-DASHBOARD CARDS ===
              teamMembers.length > 0 && React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-3' },
                // Card 1: Offene Reviews
                React.createElement('div', { 
                  className: `p-4 rounded-2xl border-2 transition-all cursor-pointer hover:shadow-lg ${
                    pendingReviews > 0 ? 'bg-amber-50 border-amber-200 hover:border-amber-400' : 'bg-green-50 border-green-200'
                  }`,
                  onClick: () => {} // TODO: Filter
                },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('div', { 
                      className: `w-10 h-10 rounded-xl flex items-center justify-center ${
                        pendingReviews > 0 ? 'bg-amber-500 text-white' : 'bg-green-500 text-white'
                      }`
                    }, React.createElement(ClipboardList, { size: 20 })),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, pendingReviews),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        lang === 'de' ? 'Reviews offen' : 'Reviews pending'
                      )
                    )
                  )
                ),
                
                // Card 2: Selbstreflexionen
                React.createElement('div', { 
                  className: `p-4 rounded-2xl border-2 transition-all cursor-pointer hover:shadow-lg ${
                    pendingSelfReflections > 0 ? 'bg-teal-50 border-teal-200 hover:border-teal-400' : 'bg-green-50 border-green-200'
                  }`
                },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('div', { 
                      className: `w-10 h-10 rounded-xl flex items-center justify-center ${
                        pendingSelfReflections > 0 ? 'bg-teal-500 text-white' : 'bg-green-500 text-white'
                      }`
                    }, React.createElement(FileText, { size: 20 })),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, pendingSelfReflections),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        lang === 'de' ? 'Selbstrefl. fehlen' : 'Self-refl. missing'
                      )
                    )
                  )
                ),
                
                // Card 3: Termine diese Woche
                React.createElement('div', { 
                  className: `p-4 rounded-2xl border-2 transition-all cursor-pointer hover:shadow-lg ${
                    overdueAppointments.length > 0 ? 'bg-red-50 border-red-200 hover:border-red-400' :
                    appointmentsThisWeek.length > 0 ? 'bg-blue-50 border-blue-200 hover:border-blue-400' : 
                    'bg-slate-50 border-slate-200'
                  }`
                },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('div', { 
                      className: `w-10 h-10 rounded-xl flex items-center justify-center ${
                        overdueAppointments.length > 0 ? 'bg-red-500 text-white' :
                        appointmentsThisWeek.length > 0 ? 'bg-blue-500 text-white' : 'bg-slate-400 text-white'
                      }`
                    }, React.createElement(Calendar, { size: 20 })),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, 
                        overdueAppointments.length > 0 ? overdueAppointments.length : appointmentsThisWeek.length
                      ),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        overdueAppointments.length > 0 
                          ? (lang === 'de' ? '‚ö†Ô∏è √úberf√§llig!' : '‚ö†Ô∏è Overdue!')
                          : (lang === 'de' ? 'Diese Woche' : 'This week')
                      )
                    )
                  )
                ),
                
                // Card 4: GPS-Durchschnitt
                React.createElement('div', { 
                  className: `p-4 rounded-2xl border-2 transition-all ${
                    avgGPS ? (avgGPS >= 3 ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200') : 'bg-slate-50 border-slate-200'
                  }`
                },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('div', { 
                      className: `w-10 h-10 rounded-xl flex items-center justify-center ${
                        avgGPS ? (avgGPS >= 3 ? 'bg-green-500 text-white' : 'bg-amber-500 text-white') : 'bg-slate-400 text-white'
                      }`
                    }, React.createElement(TrendingUp, { size: 20 })),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, avgGPS || '‚Äî'),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        lang === 'de' ? '√ò GPS-Score' : 'Avg GPS Score'
                      )
                    )
                  )
                )
              ),
              
              // === HILFE-HINWEIS (Chatbot) ===
              teamMembers.length > 0 && React.createElement('div', { 
                className: 'flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-[#243186]/5 to-transparent rounded-2xl border border-[#243186]/10'
              },
                React.createElement('div', { className: 'w-8 h-8 rounded-xl bg-[#243186] flex items-center justify-center' },
                  React.createElement(MessageCircle, { size: 16, className: 'text-white' })
                ),
                React.createElement('div', { className: 'flex-1' },
                  React.createElement('span', { className: 'text-sm text-slate-600' },
                    lang === 'de' 
                      ? 'Brauchst du Hilfe? Der HR-Copilot unten rechts kennt alle Prozesse!' 
                      : 'Need help? The HR Copilot in the bottom right knows all processes!'
                  )
                ),
                React.createElement('div', { className: 'text-xs text-slate-400 animate-bounce' }, 'üëá')
              ),
              
              // === MITARBEITER HINZUF√úGEN (Apple Style) ===
              React.createElement('div', { className: 'bg-white rounded-2xl p-5 shadow-sm border border-slate-100' },
                React.createElement('div', { className: 'flex items-center gap-2 mb-3' },
                  React.createElement(UserPlus, { size: 18, className: 'text-slate-400' }),
                  React.createElement('span', { className: 'font-medium text-slate-700' }, 
                    lang === 'de' ? 'Neuen Mitarbeiter hinzuf√ºgen' : 'Add new employee'
                  )
                ),
                React.createElement('div', { className: 'flex flex-wrap gap-3 items-center' },
                  React.createElement('input', { 
                    id: 'add-name', type: 'text', 
                    placeholder: lang === 'de' ? 'Name *' : 'Name *',
                    className: 'flex-1 min-w-[150px] bg-slate-100 border-transparent rounded-xl px-4 py-2.5 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none transition-all' 
                  }),
                  React.createElement('input', { 
                    id: 'add-pos', type: 'text', 
                    placeholder: lang === 'de' ? 'Position *' : 'Position *',
                    className: 'flex-1 min-w-[150px] bg-slate-100 border-transparent rounded-xl px-4 py-2.5 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none transition-all' 
                  }),
                  React.createElement('input', { 
                    id: 'add-email', type: 'email', 
                    placeholder: getText(lang, 'E-Mail (optional)', 'Email (opzionale)', 'Email (optional)'),
                    className: 'flex-1 min-w-[180px] bg-slate-100 border-transparent rounded-xl px-4 py-2.5 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none transition-all' 
                  }),
                  React.createElement('button', {
                    onClick: () => {
                      const name = document.getElementById('add-name').value.trim();
                      const position = document.getElementById('add-pos').value.trim();
                      const email = document.getElementById('add-email').value.trim();
                      if (name && position) {
                        addTeamMember({ name, position, email });
                        document.getElementById('add-name').value = '';
                        document.getElementById('add-pos').value = '';
                        document.getElementById('add-email').value = '';
                      } else {
                        showToast(lang === 'de' ? 'Name und Position sind Pflichtfelder' : 'Name and position required', 'warning');
                      }
                    },
                    className: 'px-5 py-2.5 bg-[#6EBD84] text-white rounded-xl hover:bg-[#5da872] font-semibold flex items-center gap-2 shadow-lg shadow-[#6EBD84]/30 transition-all hover:scale-105'
                  }, React.createElement(UserPlus, { size: 18 }), lang === 'de' ? 'Hinzuf√ºgen' : 'Add')
                )
              ),
              
              // === MITARBEITER-LISTE (Neu gestaltet) ===
              teamMembers.length === 0 
                ? React.createElement('div', { className: 'bg-slate-50 rounded-2xl p-12 text-center' },
                    React.createElement('div', { className: 'w-16 h-16 mx-auto mb-4 rounded-2xl bg-slate-200 flex items-center justify-center' },
                      React.createElement(Users, { size: 32, className: 'text-slate-400' })
                    ),
                    React.createElement('h3', { className: 'font-semibold text-slate-700 mb-1' }, 
                      lang === 'de' ? 'Noch keine Mitarbeiter' : 'No employees yet'
                    ),
                    React.createElement('p', { className: 'text-sm text-slate-500' },
                      lang === 'de' ? 'F√ºgen Sie oben Ihre Teammitglieder hinzu.' : 'Add your team members above.'
                    )
                  )
                // === LISTENANSICHT (Kompakt mit deutlichem Status) ===
                : teamViewMode === 'list' 
                ? React.createElement('div', { className: 'bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden' },
                    // Table Header
                    React.createElement('div', { className: 'grid grid-cols-12 gap-2 px-4 py-3 bg-slate-100 border-b border-slate-200 text-xs font-bold text-slate-600 uppercase tracking-wide' },
                      React.createElement('div', { className: 'col-span-3' }, lang === 'de' ? 'Mitarbeiter' : 'Employee'),
                      React.createElement('div', { className: 'col-span-3 text-center' }, lang === 'de' ? 'Offene Schritte' : 'Open Steps'),
                      React.createElement('div', { className: 'col-span-1 text-center' }, 'GPS'),
                      React.createElement('div', { className: 'col-span-2 text-center' }, lang === 'de' ? 'Termin' : 'Meeting'),
                      React.createElement('div', { className: 'col-span-3 text-center' }, lang === 'de' ? 'Aktionen' : 'Actions')
                    ),
                    // Table Body
                    teamMembers.map((member, idx) => {
                      const status = getStatus(member);
                      const gps = status.review?.gpsScore;
                      const scheduledDate = member.scheduledAt ? new Date(member.scheduledAt) : null;
                      const meetingDone = member.meetingDone === true;
                      const goalMeetingDone = member.goalMeetingDone === true;
                      const isOverdue = scheduledDate && scheduledDate < now && !meetingDone;
                      const selfLink = getSelfLink(member);
                      
                      // Offene Schritte berechnen
                      const openSteps = [];
                      if (!status.self) openSteps.push({ key: 'self', label: lang === 'de' ? 'Selbstreflexion' : 'Self-Reflection', color: 'bg-amber-100 text-amber-700 border-amber-300' });
                      if (!status.review) openSteps.push({ key: 'review', label: lang === 'de' ? 'Beurteilung' : 'Review', color: 'bg-blue-100 text-blue-700 border-blue-300' });
                      if (!status.goals) openSteps.push({ key: 'goals', label: lang === 'de' ? 'Ziele' : 'Goals', color: 'bg-purple-100 text-purple-700 border-purple-300' });
                      if (!meetingDone) openSteps.push({ key: 'meeting', label: lang === 'de' ? 'Gespr√§ch' : 'Meeting', color: 'bg-cyan-100 text-cyan-700 border-cyan-300' });
                      
                      const isComplete = openSteps.length === 0;
                      
                      return React.createElement('div', { 
                        key: member.id,
                        className: `grid grid-cols-12 gap-2 px-4 py-3 items-center border-b border-slate-100 hover:bg-slate-50 transition-colors ${
                          isComplete ? 'bg-green-50' : isOverdue ? 'bg-red-50' : idx % 2 === 0 ? 'bg-white' : 'bg-slate-50/50'
                        }`
                      },
                        // Name & Position
                        React.createElement('div', { className: 'col-span-3 min-w-0' },
                          React.createElement('div', { className: 'font-semibold text-slate-900 truncate' }, member.name),
                          React.createElement('div', { className: 'text-xs text-slate-500 truncate' }, member.position || '‚Äì')
                        ),
                        // Offene Schritte (DEUTLICH)
                        React.createElement('div', { className: 'col-span-3 flex flex-wrap gap-1 justify-center' },
                          isComplete 
                            ? React.createElement('span', { className: 'text-xs font-bold px-2 py-1 rounded-full bg-green-500 text-white' }, '‚úì Komplett')
                            : openSteps.map(step => 
                                React.createElement('span', { 
                                  key: step.key, 
                                  className: `text-xs font-medium px-2 py-0.5 rounded-full border ${step.color}`
                                }, step.label)
                              )
                        ),
                        // GPS
                        React.createElement('div', { className: 'col-span-1 text-center' },
                          gps 
                            ? React.createElement('span', { 
                                className: `text-xs font-bold px-2 py-1 rounded-full ${gps >= 3 ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'}`
                              }, gps.toFixed(1))
                            : React.createElement('span', { className: 'text-xs text-slate-400' }, '‚Äì')
                        ),
                        // Termin
                        React.createElement('div', { className: 'col-span-2 text-center text-xs' },
                          scheduledDate 
                            ? React.createElement('span', { 
                                className: `font-medium px-2 py-1 rounded ${
                                  meetingDone ? 'bg-green-100 text-green-700' :
                                  isOverdue ? 'bg-red-100 text-red-700 font-bold' : 
                                  'text-slate-600'
                                }`
                              }, scheduledDate.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' }))
                            : React.createElement('span', { className: 'text-slate-400' }, '‚Äì')
                        ),
                        // Aktionen (kompakt)
                        React.createElement('div', { className: 'col-span-3 flex gap-1 justify-center flex-wrap' },
                          // Link senden
                          !status.self && React.createElement('button', {
                            onClick: () => { setShareModalMember(member); setShareModalOpen(true); setShareModalStep(1); setShareModalEmail(''); },
                            className: 'px-2 py-1 text-xs bg-teal-500 text-white rounded hover:bg-teal-600',
                            title: lang === 'de' ? 'Link senden' : 'Send link'
                          }, 'üìß'),
                          // Beurteilung
                          React.createElement('button', {
                            onClick: () => openAppraisal(member),
                            className: 'px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600',
                            title: lang === 'de' ? 'Beurteilung' : 'Review'
                          }, 'üìù'),
                          // Ziele
                          React.createElement('button', {
                            onClick: () => openGoals(member),
                            className: 'px-2 py-1 text-xs bg-purple-500 text-white rounded hover:bg-purple-600',
                            title: lang === 'de' ? 'Ziele' : 'Goals'
                          }, 'üéØ'),
                          // Termin
                          React.createElement('button', {
                            onClick: () => { setScheduleModalOpen(true); setScheduleModalMember(member); setScheduleModalDate(member.scheduledAt?.split('T')[0] || ''); },
                            className: 'px-2 py-1 text-xs bg-amber-500 text-white rounded hover:bg-amber-600',
                            title: lang === 'de' ? 'Termin' : 'Schedule'
                          }, 'üìÖ'),
                          // L√∂schen
                          React.createElement('button', {
                            onClick: () => { setConfirmDelete(member); },
                            className: 'px-2 py-1 text-xs bg-red-100 text-red-600 rounded hover:bg-red-200',
                            title: lang === 'de' ? 'L√∂schen' : 'Delete'
                          }, 'üóëÔ∏è')
                        )
                      );
                    })
                  )

                // === KARTENANSICHT (Detail) ===
                : React.createElement('div', { className: 'space-y-4' },
                    teamMembers.map(member => {
                      const status = getStatus(member);
                      const isOwner = member._isOwner !== false;
                      const isShared = member.sharedWith?.length > 0;
                      const gps = status.review?.gpsScore;
                      const done = [status.self, status.review, status.goals].filter(Boolean).length;
                      const selfLink = getSelfLink(member);
                      
                      // Termin-Status
                      const scheduledDate = member.scheduledAt ? new Date(member.scheduledAt) : null;
                      const meetingDone = member.meetingDone === true; // Beurteilungsgespr√§ch gef√ºhrt
                      const goalMeetingDone = member.goalMeetingDone === true; // Zielvereinbarungsgespr√§ch gef√ºhrt
                      const isOverdue = scheduledDate && scheduledDate < now && !meetingDone; // Nicht √ºberf√§llig wenn Gespr√§ch gef√ºhrt
                      const daysUntil = scheduledDate ? Math.ceil((scheduledDate - now) / (1000 * 60 * 60 * 24)) : null;
                      
                      return React.createElement('div', { 
                        key: member.id,
                        className: `bg-white rounded-2xl shadow-sm border-2 overflow-hidden transition-all hover:shadow-lg ${
                          done === 3 ? 'border-green-300' : 
                          isOverdue ? 'border-red-300' :
                          !isOwner ? 'border-indigo-200' : 
                          'border-slate-200 hover:border-[#6EBD84]'
                        }`
                      },
                        // === HEADER-ZEILE ===
                        React.createElement('div', { 
                          className: `px-5 py-4 flex items-center gap-4 ${
                            done === 3 ? 'bg-green-50' : isOverdue ? 'bg-red-50' : !isOwner ? 'bg-indigo-50' : 'bg-slate-50'
                          }`
                        },
                          // Avatar
                          React.createElement('div', { 
                            className: `w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${
                              done === 3 ? 'bg-green-500 text-white' :
                              gps ? (gps >= 3 ? 'bg-gradient-to-br from-green-400 to-green-600 text-white' : 'bg-gradient-to-br from-amber-400 to-amber-600 text-white') :
                              'bg-slate-200 text-slate-600'
                            }`
                          }, member.name.split(' ').map(n => n[0]).join('').slice(0,2).toUpperCase()),
                          
                          // Name & Info
                          React.createElement('div', { className: 'flex-1 min-w-0' },
                            React.createElement('div', { className: 'flex items-center gap-2 flex-wrap' },
                              React.createElement('span', { className: 'font-semibold text-slate-900 truncate' }, member.name),
                              gps && React.createElement('span', { 
                                className: `text-xs font-bold px-2 py-0.5 rounded-full ${
                                  gps >= 3 ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'
                                }`
                              }, `GPS ${gps.toFixed(1)}`),
                              done === 3 && React.createElement('span', { className: 'text-xs bg-green-500 text-white px-2 py-0.5 rounded-full' }, '‚úì Komplett'),
                              // Geteilt MIT mir (von anderer FK) - Neuer erweiterter Badge
                              !isOwner && React.createElement('span', { 
                                className: 'text-xs bg-indigo-100 text-indigo-600 px-2 py-0.5 rounded-full flex items-center gap-1',
                                title: member._sharedBy 
                                  ? `${lang === 'de' ? 'Geteilt von' : lang === 'it' ? 'Condiviso da' : 'Shared by'}: ${member._sharedBy.includes('@') ? member._sharedBy : (lang === 'de' ? 'Andere F√ºhrungskraft' : lang === 'it' ? 'Altro responsabile' : 'Another manager')}` 
                                  : ''
                              }, 
                                React.createElement(Users2, { size: 10 }),
                                lang === 'de' ? 'Geteilt' : lang === 'it' ? 'Condiviso' : 'Shared'
                              ),
                              // Geteilt VON mir (an andere FK) - Neues Badge
                              isOwner && isShared && React.createElement('span', { 
                                className: 'text-xs bg-purple-100 text-purple-600 px-2 py-0.5 rounded-full flex items-center gap-1',
                                title: member.sharedWith ? `${lang === 'de' ? 'Geteilt mit' : lang === 'it' ? 'Condiviso con' : 'Shared with'}: ${member.sharedWith.join(', ')}` : ''
                              }, 
                                React.createElement(Share2, { size: 10 }),
                                `${lang === 'de' ? 'Geteilt' : lang === 'it' ? 'Condiviso' : 'Shared'} (${member.sharedWith.length})`
                              )
                            ),
                            // Position
                            React.createElement('div', { className: 'text-sm text-slate-500' }, member.position),
                            // === VERBESSERTE SHARING-INFO-ANZEIGE ===
                            // Geteilt MIT mir (von anderer FK)
                            !isOwner && member._sharedBy && React.createElement('div', { 
                              className: 'mt-2 p-2 bg-indigo-50 border border-indigo-200 rounded-lg flex items-center gap-2' 
                            },
                              React.createElement('div', { className: 'w-6 h-6 rounded-full bg-indigo-500 flex items-center justify-center flex-shrink-0' },
                                React.createElement(Users2, { size: 12, className: 'text-white' })
                              ),
                              React.createElement('div', { className: 'text-xs' },
                                React.createElement('span', { className: 'text-indigo-600 font-medium' },
                                  lang === 'de' ? 'Geteilt von: ' : lang === 'it' ? 'Condiviso da: ' : 'Shared by: '
                                ),
                                React.createElement('span', { className: 'text-indigo-800 font-semibold' }, 
                                  // Pr√ºfe ob es eine E-Mail ist (enth√§lt @) oder eine UID
                                  member._sharedBy.includes('@') 
                                    ? member._sharedBy 
                                    : (lang === 'de' ? 'Andere F√ºhrungskraft' : lang === 'it' ? 'Altro responsabile' : 'Another manager')
                                )
                              )
                            ),
                            // Geteilt VON mir (an andere FK)
                            isOwner && isShared && React.createElement('div', { 
                              className: 'mt-2 p-2 bg-purple-50 border border-purple-200 rounded-lg' 
                            },
                              React.createElement('div', { className: 'flex items-center gap-2 mb-1' },
                                React.createElement('div', { className: 'w-6 h-6 rounded-full bg-purple-500 flex items-center justify-center flex-shrink-0' },
                                  React.createElement(Share2, { size: 12, className: 'text-white' })
                                ),
                                React.createElement('span', { className: 'text-xs text-purple-600 font-medium' },
                                  lang === 'de' ? 'Geteilt mit:' : lang === 'it' ? 'Condiviso con:' : 'Shared with:'
                                )
                              ),
                              React.createElement('div', { className: 'flex flex-wrap gap-1 ml-8' },
                                ...member.sharedWith.map((email, idx) => 
                                  React.createElement('span', { 
                                    key: idx,
                                    className: 'text-xs bg-white text-purple-700 px-2 py-0.5 rounded-full border border-purple-200'
                                  }, email)
                                )
                              )
                            )
                          ),
                          
                          // Quick Actions (minimiert)
                          React.createElement('div', { className: 'flex items-center gap-1' },
                            isOwner && React.createElement('button', {
                              onClick: () => shareMember(member),
                              className: `w-8 h-8 rounded-lg flex items-center justify-center transition-all ${isShared ? 'bg-purple-100 text-purple-600' : 'bg-slate-100 text-slate-400 hover:bg-purple-50 hover:text-purple-500'}`,
                              title: lang === 'de' ? 'Teilen' : 'Share'
                            }, React.createElement(Share2, { size: 14 })),
                            // Entfernen-Button: F√ºr eigene MA = L√∂schen, f√ºr geteilte MA = Verkn√ºpfung entfernen
                            React.createElement('button', {
                              onClick: async () => { 
                                if (isOwner) {
                                  // Eigener MA: Komplett l√∂schen
                                  if (confirm(`"${member.name}" ${lang === 'de' ? 'entfernen' : 'remove'}?`)) {
                                    deleteTeamMember(member.id);
                                  }
                                } else {
                                  // Geteilter MA: Nur Verkn√ºpfung entfernen (aus sharedWith Array)
                                  if (confirm(`${lang === 'de' ? 'Geteilten Mitarbeiter aus Ihrer Ansicht entfernen' : 'Remove shared employee from your view'}?`)) {
                                    try {
                                      const currentShared = member.sharedWith || [];
                                      const newShared = currentShared.filter(email => email.toLowerCase() !== user?.email?.toLowerCase());
                                      await db.collection('teamMembers').doc(member.id).update({ sharedWith: newShared });
                                      devLog('Geteilten MA entfernt');
                                    } catch (err) {
                                      console.error('Fehler:', err);
                                      showToast(getText(lang, 'Ein Fehler ist aufgetreten', 'Si √® verificato un errore', 'An error occurred'), 'error');
                                    }
                                  }
                                }
                              },
                              className: 'w-8 h-8 rounded-lg flex items-center justify-center bg-slate-100 text-slate-400 hover:bg-red-50 hover:text-red-500 transition-all',
                              title: isOwner 
                                ? (lang === 'de' ? 'Entfernen' : 'Remove')
                                : (lang === 'de' ? 'Aus meiner Ansicht entfernen' : 'Remove from my view')
                            }, React.createElement(Trash2, { size: 14 }))
                          )
                        ),
                        
                        // === TERMIN-ZEILE (wenn vorhanden oder n√∂tig) ===
                        React.createElement('div', { 
                          className: 'px-5 py-3 border-t border-slate-100 flex items-center gap-3 flex-wrap',
                          style: { background: scheduledDate ? (meetingDone ? '#f0fdf4' : isOverdue ? '#fef2f2' : '#f0f9ff') : '#fafafa' }
                        },
                          // Termin-Info oder CTA
                          scheduledDate 
                            ? React.createElement('div', { 
                                className: `flex items-center gap-2 px-3 py-1.5 rounded-lg cursor-pointer transition-all group ${
                                  meetingDone ? 'bg-green-100 text-green-700 hover:bg-green-200' :
                                  isOverdue ? 'bg-red-100 text-red-700 hover:bg-red-200' : 'bg-blue-100 text-blue-700 hover:bg-blue-200'
                                }`,
                                onClick: () => scheduleDate(member),
                                title: lang === 'de' ? 'Klicken zum Bearbeiten' : lang === 'it' ? 'Clicca per modificare' : 'Click to edit'
                              },
                                meetingDone ? React.createElement(CheckCircle2, { size: 14 }) :
                                member.scheduledSource === 'form' ? React.createElement(FileText, { size: 14 }) : React.createElement(Calendar, { size: 14 }),
                                React.createElement('span', { className: 'text-sm font-medium' },
                                  meetingDone
                                    ? `‚úì ${lang === 'de' ? 'Gespr√§ch gef√ºhrt' : lang === 'it' ? 'Colloquio effettuato' : 'Meeting done'} (${scheduledDate.toLocaleDateString('de-DE')})`
                                    : isOverdue 
                                    ? `‚ö†Ô∏è ${lang === 'de' ? '√úberf√§llig' : lang === 'it' ? 'Scaduto' : 'Overdue'}: ${scheduledDate.toLocaleDateString('de-DE')}`
                                    : daysUntil === 0 
                                      ? `${lang === 'de' ? 'HEUTE' : lang === 'it' ? 'OGGI' : 'TODAY'} ${scheduledDate.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}`
                                      : daysUntil <= 7
                                        ? `${lang === 'de' ? 'In' : lang === 'it' ? 'Tra' : 'In'} ${daysUntil} ${lang === 'de' ? 'Tagen' : lang === 'it' ? 'giorni' : 'days'} ‚Ä¢ ${scheduledDate.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit' })}`
                                        : scheduledDate.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' })
                                ),
                                // Edit Icon als visueller Hinweis
                                React.createElement('span', { className: 'opacity-0 group-hover:opacity-100 transition-opacity text-xs' }, '‚úèÔ∏è')
                              )
                            : React.createElement('button', {
                                onClick: () => scheduleDate(member),
                                className: 'flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-100 text-slate-500 hover:bg-blue-50 hover:text-blue-600 transition-all text-sm'
                              },
                                React.createElement(Calendar, { size: 14 }),
                                lang === 'de' ? 'Termin festlegen' : lang === 'it' ? 'Fissa appuntamento' : 'Schedule meeting'
                              ),
                          
                          // Spacer
                          React.createElement('div', { className: 'flex-1' }),
                          
                          // Einladungslink (wenn Selbstreflexion fehlt)
                          !status.self && selfLink && React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('button', {
                              onClick: () => copyLink(member),
                              className: 'flex items-center gap-1.5 px-3 py-1.5 bg-slate-600 text-white rounded-lg hover:bg-slate-700 text-xs font-medium transition-all'
                            }, React.createElement(Link, { size: 12 }), lang === 'de' ? 'Link f√ºr Selbstreflexion kopieren' : lang === 'it' ? 'Copia link autovalutazione' : 'Copy self-reflection link'),
                            member.email && React.createElement('button', {
                              onClick: () => sendEmail(member),
                              className: 'flex items-center gap-1.5 px-3 py-1.5 bg-teal-600 text-white rounded-lg hover:bg-teal-700 text-xs font-medium transition-all'
                            }, React.createElement(Mail, { size: 12 }), lang === 'de' ? 'Link per E-Mail senden' : lang === 'it' ? 'Invia link via e-mail' : 'Send link via email')
                          )
                        ),
                        
                        // === GESPR√ÑCHE GEF√úHRT - CHECKBOXEN (3-Spalten Grid, b√ºndig zu Karten) ===
                        React.createElement('div', { className: 'px-5 pt-4 pb-2' },
                          React.createElement('div', { className: 'grid grid-cols-3 gap-3' },
                            // SPALTE 1: Leerraum (√ºber Selbstreflexion)
                            React.createElement('div', { className: 'flex items-center justify-center' },
                              React.createElement('span', { className: 'text-xs text-slate-400 italic' },
                                lang === 'de' ? 'Gespr√§che gef√ºhrt:' : lang === 'it' ? 'Colloqui effettuati:' : 'Meetings completed:'
                              )
                            ),
                            // SPALTE 2: Beurteilungsgespr√§ch gef√ºhrt (√ºber Beurteilungs-Karte)
                            React.createElement('div', {
                              onClick: () => toggleMeetingDone(member),
                              className: `p-3 rounded-xl cursor-pointer transition-all border-2 flex items-center gap-3 ${
                                meetingDone 
                                  ? 'bg-gradient-to-r from-green-50 to-emerald-50 border-green-400 shadow-sm' 
                                  : 'bg-slate-50 border-slate-200 hover:border-slate-300 hover:bg-slate-100'
                              }`
                            },
                              // Custom Checkbox Icon
                              React.createElement('div', {
                                className: `w-6 h-6 rounded-md flex items-center justify-center flex-shrink-0 transition-all ${
                                  meetingDone 
                                    ? 'bg-green-500 text-white shadow-sm' 
                                    : 'bg-white border-2 border-slate-300'
                                }`
                              }, meetingDone && React.createElement(Check, { size: 14, strokeWidth: 3 })),
                              // Text + Datum
                              React.createElement('div', { className: 'flex-1 min-w-0' },
                                React.createElement('span', { 
                                  className: `text-sm font-medium block truncate ${meetingDone ? 'text-green-800' : 'text-slate-600'}`
                                },
                                  lang === 'de' ? 'Beurteilungsgespr√§ch' : lang === 'it' ? 'Colloquio valutazione' : 'Review meeting'
                                ),
                                meetingDone && member.meetingDoneAt && React.createElement('span', { 
                                  className: 'text-xs text-green-600'
                                }, new Date(member.meetingDoneAt).toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB'))
                              )
                            ),
                            // SPALTE 3: Zielvereinbarungsgespr√§ch gef√ºhrt (√ºber Ziele-Karte)
                            React.createElement('div', {
                              onClick: () => toggleGoalMeetingDone(member),
                              className: `p-3 rounded-xl cursor-pointer transition-all border-2 flex items-center gap-3 ${
                                goalMeetingDone 
                                  ? 'bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-400 shadow-sm' 
                                  : 'bg-slate-50 border-slate-200 hover:border-slate-300 hover:bg-slate-100'
                              }`
                            },
                              // Custom Checkbox Icon
                              React.createElement('div', {
                                className: `w-6 h-6 rounded-md flex items-center justify-center flex-shrink-0 transition-all ${
                                  goalMeetingDone 
                                    ? 'bg-blue-500 text-white shadow-sm' 
                                    : 'bg-white border-2 border-slate-300'
                                }`
                              }, goalMeetingDone && React.createElement(Check, { size: 14, strokeWidth: 3 })),
                              // Text + Datum
                              React.createElement('div', { className: 'flex-1 min-w-0' },
                                React.createElement('span', { 
                                  className: `text-sm font-medium block truncate ${goalMeetingDone ? 'text-blue-800' : 'text-slate-600'}`
                                },
                                  lang === 'de' ? 'Zielvereinbarung' : lang === 'it' ? 'Accordo obiettivi' : 'Goal agreement'
                                ),
                                goalMeetingDone && member.goalMeetingDoneAt && React.createElement('span', { 
                                  className: 'text-xs text-blue-600'
                                }, new Date(member.goalMeetingDoneAt).toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB'))
                              )
                            )
                          )
                        ),
                        
                        // === STATUS-KARTEN (3 Spalten mit klaren Labels) ===
                        React.createElement('div', { className: 'p-5 grid grid-cols-3 gap-3' },
                          // SELBSTREFLEXION (Verbessert mit 3 Aktionen inkl. PDF-Upload)
                          React.createElement('div', { 
                            className: `p-4 rounded-xl transition-all ${
                              status.self 
                                ? 'bg-teal-50 border-2 border-teal-200' 
                                : 'bg-slate-50 border-2 border-dashed border-slate-200'
                            }`
                          },
                            React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                              React.createElement('div', { 
                                className: `w-8 h-8 rounded-lg flex items-center justify-center ${status.self ? 'bg-teal-500 text-white' : 'bg-slate-200 text-slate-400'}`
                              }, status.self ? React.createElement(CheckCircle2, { size: 16 }) : React.createElement(FileText, { size: 16 })),
                              React.createElement('span', { className: 'font-semibold text-sm text-slate-700' }, 
                                lang === 'de' ? 'Selbstreflexion' : lang === 'it' ? 'Autovalutazione' : 'Self-Reflection'
                              )
                            ),
                            // Status-Label - zeige beide Typen wenn vorhanden
                            React.createElement('div', { className: `text-xs mb-3 space-y-1` },
                              // Digital vorhanden?
                              status.selfDigital && React.createElement('div', { className: 'text-teal-600' },
                                `‚úì ${lang === 'de' ? 'Digital eingegangen' : lang === 'it' ? 'Ricevuta digitale' : 'Digital received'}${status.selfDigital.createdAt || status.selfDigital.submittedAt ? ` ${new Date(status.selfDigital.createdAt || status.selfDigital.submittedAt).toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB')}` : ''}`
                              ),
                              // PDF vorhanden?
                              status.selfPdf && React.createElement('div', { className: 'text-amber-600' },
                                `üìÑ PDF: ${status.selfPdf.pdfFileName || 'Dokument'}`
                              ),
                              // Nichts vorhanden?
                              !status.selfDigital && !status.selfPdf && React.createElement('div', { className: 'text-slate-400' },
                                `‚è≥ ${lang === 'de' ? 'Noch nicht ausgef√ºllt' : lang === 'it' ? 'Non ancora compilata' : 'Not yet completed'}`
                              )
                            ),
                            // === AKTIONS-BUTTONS ===
                            React.createElement('div', { className: 'flex flex-col gap-2 pt-2 border-t border-slate-100' },
                              // Buttons f√ºr Digital-Ansicht (wenn vorhanden)
                              status.selfDigital && React.createElement('button', {
                                onClick: (e) => {
                                  e.stopPropagation();
                                  setActiveView('viewSelfAssessment');
                                  localStorage.setItem('nw_view_self_assessment', JSON.stringify(status.selfDigital));
                                },
                                className: 'w-full py-2 px-3 bg-teal-500 text-white rounded-lg text-xs font-semibold hover:bg-teal-600 transition-all flex items-center justify-center gap-2'
                              }, 
                                React.createElement(Eye, { size: 14 }),
                                lang === 'de' ? 'Digital ansehen' : lang === 'it' ? 'Visualizza digitale' : 'View Digital'
                              ),
                              
                              // PDF-Bereich (wenn vorhanden)
                              status.selfPdf && React.createElement('div', {
                                className: 'w-full bg-amber-50 border border-amber-200 rounded-lg p-2 space-y-2'
                              },
                                // PDF-Info mit L√∂schen-Button
                                React.createElement('div', { className: 'flex items-center gap-2 text-amber-700 text-xs' },
                                  React.createElement(FileText, { size: 14 }),
                                  React.createElement('span', { className: 'truncate flex-1' }, status.selfPdf.pdfFileName || 'Selbstreflexion.pdf'),
                                  React.createElement('span', { className: 'text-amber-500' }, 
                                    status.selfPdf.pdfSize ? (status.selfPdf.pdfSize / 1024 / 1024).toFixed(2) + ' MB' : ''
                                  ),
                                  // L√∂schen-Button
                                  React.createElement('button', {
                                    onClick: (e) => { e.stopPropagation(); handleDeletePdf(member, 'self'); },
                                    className: 'p-1 bg-red-500 text-white rounded hover:bg-red-600 transition-all',
                                    title: lang === 'de' ? 'PDF l√∂schen' : lang === 'it' ? 'Elimina PDF' : 'Delete PDF'
                                  }, React.createElement(Trash2, { size: 10 }))
                                ),
                                // Buttons
                                React.createElement('div', { className: 'flex gap-1' },
                                  // Ansehen-Button (√∂ffnet im neuen Tab)
                                  React.createElement('button', {
                                    onClick: async (e) => {
                                      e.stopPropagation();
                                      openPdfInNewTab(status.selfPdf, status.selfPdf.pdfFileName || 'Selbstreflexion.pdf');
                                    },
                                    className: 'flex-1 py-1.5 px-2 bg-amber-100 text-amber-700 rounded text-xs font-medium hover:bg-amber-200 transition-all flex items-center justify-center gap-1'
                                  }, 
                                    React.createElement(Eye, { size: 12 }),
                                    lang === 'de' ? 'Ansehen' : lang === 'it' ? 'Visualizza' : 'View'
                                  ),
                                  // Download-Button
                                  React.createElement('button', {
                                    onClick: async (e) => {
                                      e.stopPropagation();
                                      try {
                                        let pdfSource = status.selfPdf.pdfUrl || status.selfPdf.pdfData;
                                        
                                        // Wenn storagePath vorhanden, hole frische URL
                                        if (status.selfPdf.storagePath && storage) {
                                          pdfSource = await storage.ref(status.selfPdf.storagePath).getDownloadURL();
                                        }
                                        
                                        if (pdfSource) {
                                          const link = document.createElement('a');
                                          link.href = pdfSource;
                                          link.target = '_blank';
                                          link.download = status.selfPdf.pdfFileName || 'Selbstreflexion.pdf';
                                          link.click();
                                        }
                                      } catch (err) {
                                        console.error('‚ùå Fehler beim Download:', err);
                                        showToast(lang === 'de' ? 'Fehler beim Download' : 'Download error', 'error');
                                      }
                                    },
                                    className: 'flex-1 py-1.5 px-2 bg-amber-500 text-white rounded text-xs font-semibold hover:bg-amber-600 transition-all flex items-center justify-center gap-1'
                                  }, 
                                    React.createElement(Download, { size: 12 }),
                                    lang === 'de' ? 'Download' : lang === 'it' ? 'Scarica' : 'Download'
                                  )
                                )
                              ),
                              
                              // Info wenn nichts vorhanden
                              !status.selfDigital && !status.selfPdf && React.createElement('div', {
                                className: 'w-full py-2 px-3 bg-slate-100 text-slate-500 rounded-lg text-xs text-center'
                              }, 
                                lang === 'de' ? 'Noch keine Daten vorhanden' : lang === 'it' ? 'Nessun dato disponibile' : 'No data available'
                              ),
                              
                              // Button-Reihe 2: Link + E-Mail
                              React.createElement('div', { className: 'flex gap-1' },
                                React.createElement('button', {
                                  onClick: (e) => {
                                    e.stopPropagation();
                                    copyLink(member);
                                  },
                                  className: 'flex-1 py-1.5 px-2 bg-slate-200 text-slate-600 rounded-lg text-xs font-medium hover:bg-slate-300 transition-all flex items-center justify-center gap-1',
                                  title: lang === 'de' ? 'Link f√ºr Selbstreflexion kopieren' : lang === 'it' ? 'Copia link autovalutazione' : 'Copy self-reflection link'
                                }, 
                                  React.createElement(Link, { size: 12 }),
                                  lang === 'de' ? 'SR-Link' : 'Link'
                                ),
                                member.email && React.createElement('button', {
                                  onClick: (e) => {
                                    e.stopPropagation();
                                    sendEmail(member);
                                  },
                                  className: 'flex-1 py-1.5 px-2 bg-[#243186] text-white rounded-lg text-xs font-medium hover:bg-[#1a2563] transition-all flex items-center justify-center gap-1',
                                  title: lang === 'de' ? 'Selbstreflexions-Link per E-Mail senden' : lang === 'it' ? 'Invia link autovalutazione via email' : 'Send self-reflection link via email'
                                }, 
                                  React.createElement(Mail, { size: 12 }),
                                  'E-Mail'
                                )
                              ),
                              // Button 3: PDF Upload (NEU)
                              React.createElement('label', {
                                className: 'w-full py-1.5 px-2 bg-amber-100 text-amber-700 rounded-lg text-xs font-medium hover:bg-amber-200 transition-all flex items-center justify-center gap-1 cursor-pointer',
                                title: lang === 'de' ? 'PDF-Selbstreflexion hochladen' : lang === 'it' ? 'Carica PDF autovalutazione' : 'Upload PDF self-reflection'
                              },
                                React.createElement('input', {
                                  type: 'file',
                                  accept: '.pdf',
                                  className: 'hidden',
                                  onChange: (e) => {
                                    const file = e.target.files?.[0];
                                    if (file) {
                                      handleSelfReflectionPdfUpload(member, file);
                                      e.target.value = ''; // Reset f√ºr erneuten Upload
                                    }
                                  }
                                }),
                                React.createElement(Upload, { size: 12 }),
                                lang === 'de' ? 'PDF hochladen' : lang === 'it' ? 'Carica PDF' : 'Upload PDF'
                              )
                            )
                          ),
                          
                          // BEURTEILUNG
                          React.createElement('div', { 
                            className: `p-4 rounded-xl transition-all hover:shadow-md ${
                              status.review 
                                ? status.review.status === 'completed'
                                  ? 'bg-blue-50 border-2 border-blue-200 hover:border-blue-400'
                                  : 'bg-amber-50 border-2 border-amber-200 hover:border-amber-400'
                                : 'bg-slate-50 border-2 border-dashed border-slate-200 hover:border-blue-400 hover:bg-blue-50'
                            }`
                          },
                            // Klickbarer Header-Bereich f√ºr Navigation
                            React.createElement('div', { 
                              onClick: () => startTeamAppraisal(member.id, new Date().getFullYear().toString(), status.review || null),
                              className: 'cursor-pointer'
                            },
                              React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                                React.createElement('div', { 
                                  className: `w-8 h-8 rounded-lg flex items-center justify-center ${
                                    status.review 
                                      ? status.review.status === 'completed' ? 'bg-blue-500 text-white' : 'bg-amber-500 text-white'
                                      : 'bg-slate-200 text-slate-400'
                                  }`
                                }, 
                                  status.review 
                                    ? status.review.status === 'completed' 
                                      ? React.createElement(CheckCircle2, { size: 16 })
                                      : React.createElement(Edit3, { size: 16 })
                                    : React.createElement(ClipboardList, { size: 16 })
                                ),
                                React.createElement('span', { className: 'font-semibold text-sm text-slate-700' }, 
                                  lang === 'de' ? 'Beurteilung' : lang === 'it' ? 'Valutazione' : 'Review'
                                )
                              ),
                              // Status-Label
                              React.createElement('div', { className: `text-xs ${
                                status.review 
                                  ? status.review.status === 'completed' ? 'text-blue-600' : 'text-amber-600'
                                  : 'text-slate-400'
                              }` },
                                status.review 
                                  ? status.review.status === 'completed'
                                    ? `‚úì ${lang === 'de' ? 'Abgeschlossen' : lang === 'it' ? 'Completato' : 'Completed'}${status.review.gpsScore ? ` ‚Ä¢ GPS ${status.review.gpsScore.toFixed(1)}` : ''}`
                                    : `‚úé ${lang === 'de' ? 'Entwurf gespeichert' : lang === 'it' ? 'Bozza salvata' : 'Draft saved'}`
                                  : `‚óã ${lang === 'de' ? 'Noch nicht begonnen' : lang === 'it' ? 'Non ancora iniziato' : 'Not started'}`
                              ),
                              // CTA
                              React.createElement('div', { className: 'mt-2 pt-2 border-t border-slate-100 text-xs font-medium text-center' },
                                status.review 
                                  ? status.review.status === 'completed'
                                    ? React.createElement('span', { className: 'text-blue-600' }, `‚Üí ${lang === 'de' ? 'Bearbeiten' : lang === 'it' ? 'Modifica' : 'Edit'}`)
                                    : React.createElement('span', { className: 'text-amber-600' }, `‚Üí ${lang === 'de' ? 'Fortsetzen' : lang === 'it' ? 'Continua' : 'Continue'}`)
                                  : React.createElement('span', { className: 'text-[#243186] font-bold' }, `‚Üí ${lang === 'de' ? 'Review starten' : lang === 'it' ? 'Inizia review' : 'Start review'}`)
                              )
                            ),
                            
                            // === PDF CONTROLS F√úR BEURTEILUNG ===
                            React.createElement('div', { className: 'mt-3 pt-3 border-t border-slate-200 space-y-2' },
                              // PDF anzeigen wenn vorhanden
                              status.reviewPdf && React.createElement('div', { 
                                className: 'flex items-center gap-2 bg-blue-100 rounded-lg p-2'
                              },
                                React.createElement('span', { className: 'text-xs truncate flex-1 text-blue-700' }, 
                                  'üìÑ ' + (status.reviewPdf.pdfFileName || getText(lang, 'Beurteilung.pdf', 'Valutazione.pdf', 'Review.pdf'))
                                ),
                                React.createElement('button', {
                                  onClick: (e) => { e.stopPropagation(); openPdfInNewTab(status.reviewPdf, status.reviewPdf.pdfFileName); },
                                  className: 'p-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 transition-all',
                                  title: lang === 'de' ? 'Ansehen' : lang === 'it' ? 'Visualizza' : 'View'
                                }, React.createElement(Eye, { size: 12 })),
                                React.createElement('button', {
                                  onClick: (e) => { e.stopPropagation(); handleDeletePdf(member, 'review'); },
                                  className: 'p-1.5 bg-red-500 text-white rounded hover:bg-red-600 transition-all',
                                  title: lang === 'de' ? 'L√∂schen' : lang === 'it' ? 'Elimina' : 'Delete'
                                }, React.createElement(Trash2, { size: 12 }))
                              ),
                              // Upload Button
                              React.createElement('label', {
                                className: 'w-full py-1.5 px-2 bg-blue-100 text-blue-700 rounded-lg text-xs font-medium hover:bg-blue-200 transition-all flex items-center justify-center gap-1 cursor-pointer',
                                title: lang === 'de' ? 'Unterschriebene Beurteilung hochladen' : lang === 'it' ? 'Carica valutazione firmata' : 'Upload signed review'
                              },
                                React.createElement('input', {
                                  type: 'file',
                                  accept: '.pdf',
                                  className: 'hidden',
                                  onChange: (e) => {
                                    const file = e.target.files?.[0];
                                    if (file) {
                                      handlePdfUpload(member, file, 'review');
                                      e.target.value = '';
                                    }
                                  }
                                }),
                                React.createElement(Upload, { size: 12 }),
                                status.reviewPdf 
                                  ? (lang === 'de' ? 'PDF ersetzen' : lang === 'it' ? 'Sostituisci PDF' : 'Replace PDF')
                                  : (lang === 'de' ? 'PDF hochladen' : lang === 'it' ? 'Carica PDF' : 'Upload PDF')
                              )
                            )
                          ),
                          
                          // ZIELVEREINBARUNG
                          React.createElement('div', { 
                            className: `p-4 rounded-xl transition-all hover:shadow-md ${
                              status.goals 
                                ? 'bg-purple-50 border-2 border-purple-200 hover:border-purple-400' 
                                : 'bg-slate-50 border-2 border-dashed border-slate-200 hover:border-purple-400 hover:bg-purple-50'
                            }`
                          },
                            // Klickbarer Header-Bereich f√ºr Navigation
                            React.createElement('div', { 
                              onClick: () => startTeamGoalSetting(member.id, new Date().getFullYear().toString(), status.goals || null),
                              className: 'cursor-pointer'
                            },
                              React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                                React.createElement('div', { 
                                  className: `w-8 h-8 rounded-lg flex items-center justify-center ${status.goals ? 'bg-purple-500 text-white' : 'bg-slate-200 text-slate-400'}`
                                }, status.goals ? React.createElement(CheckCircle2, { size: 16 }) : React.createElement(Target, { size: 16 })),
                                React.createElement('span', { className: 'font-semibold text-sm text-slate-700' }, 
                                  lang === 'de' ? 'Zielvereinbarung' : lang === 'it' ? 'Accordo obiettivi' : 'Goals'
                                )
                              ),
                              // Status-Label
                              React.createElement('div', { className: `text-xs ${status.goals ? 'text-purple-600' : 'text-slate-400'}` },
                                status.goals 
                                  ? `‚úì ${status.goals.goals?.length || 0} ${lang === 'de' ? 'Ziele definiert' : lang === 'it' ? 'obiettivi definiti' : 'goals defined'}`
                                  : `‚óã ${lang === 'de' ? 'Noch nicht erstellt' : lang === 'it' ? 'Non ancora creato' : 'Not created'}`
                              ),
                              // CTA
                              React.createElement('div', { className: 'mt-2 pt-2 border-t border-slate-100 text-xs font-medium text-center' },
                                status.goals 
                                  ? React.createElement('span', { className: 'text-purple-600' }, `‚Üí ${lang === 'de' ? 'Bearbeiten' : lang === 'it' ? 'Modifica' : 'Edit'}`)
                                  : React.createElement('span', { className: 'text-slate-500' }, `‚Üí ${lang === 'de' ? 'Erstellen' : lang === 'it' ? 'Crea' : 'Create'}`)
                              )
                            ),
                            
                            // === PDF CONTROLS F√úR ZIELVEREINBARUNG ===
                            React.createElement('div', { className: 'mt-3 pt-3 border-t border-slate-200 space-y-2' },
                              // PDF anzeigen wenn vorhanden
                              status.goalsPdf && React.createElement('div', { 
                                className: 'flex items-center gap-2 bg-purple-100 rounded-lg p-2'
                              },
                                React.createElement('span', { className: 'text-xs truncate flex-1 text-purple-700' }, 
                                  'üìÑ ' + (status.goalsPdf.pdfFileName || getText(lang, 'Zielvereinbarung.pdf', 'Obiettivi.pdf', 'Goals.pdf'))
                                ),
                                React.createElement('button', {
                                  onClick: (e) => { e.stopPropagation(); openPdfInNewTab(status.goalsPdf, status.goalsPdf.pdfFileName); },
                                  className: 'p-1.5 bg-purple-500 text-white rounded hover:bg-purple-600 transition-all',
                                  title: lang === 'de' ? 'Ansehen' : lang === 'it' ? 'Visualizza' : 'View'
                                }, React.createElement(Eye, { size: 12 })),
                                React.createElement('button', {
                                  onClick: (e) => { e.stopPropagation(); handleDeletePdf(member, 'goals'); },
                                  className: 'p-1.5 bg-red-500 text-white rounded hover:bg-red-600 transition-all',
                                  title: lang === 'de' ? 'L√∂schen' : lang === 'it' ? 'Elimina' : 'Delete'
                                }, React.createElement(Trash2, { size: 12 }))
                              ),
                              // Upload Button
                              React.createElement('label', {
                                className: 'w-full py-1.5 px-2 bg-purple-100 text-purple-700 rounded-lg text-xs font-medium hover:bg-purple-200 transition-all flex items-center justify-center gap-1 cursor-pointer',
                                title: lang === 'de' ? 'Unterschriebene Zielvereinbarung hochladen' : lang === 'it' ? 'Carica accordo obiettivi firmato' : 'Upload signed goals agreement'
                              },
                                React.createElement('input', {
                                  type: 'file',
                                  accept: '.pdf',
                                  className: 'hidden',
                                  onChange: (e) => {
                                    const file = e.target.files?.[0];
                                    if (file) {
                                      handlePdfUpload(member, file, 'goals');
                                      e.target.value = '';
                                    }
                                  }
                                }),
                                React.createElement(Upload, { size: 12 }),
                                status.goalsPdf 
                                  ? (lang === 'de' ? 'PDF ersetzen' : lang === 'it' ? 'Sostituisci PDF' : 'Replace PDF')
                                  : (lang === 'de' ? 'PDF hochladen' : lang === 'it' ? 'Carica PDF' : 'Upload PDF')
                              )
                            )
                          )
                        ),
                        
                        // === FOOTER: Fortschritt ===
                        React.createElement('div', { className: 'px-5 py-3 bg-slate-50 border-t border-slate-100 flex items-center gap-3' },
                          React.createElement('div', { className: 'flex gap-1 flex-1' },
                            [0, 1, 2].map(i => React.createElement('div', {
                              key: i,
                              className: `h-1.5 flex-1 rounded-full transition-all ${i < done ? (done === 3 ? 'bg-green-500' : 'bg-[#6EBD84]') : 'bg-slate-200'}`
                            }))
                          ),
                          React.createElement('span', { className: `text-xs font-semibold ${done === 3 ? 'text-green-600' : 'text-slate-500'}` },
                            done === 3 ? '‚úì Alles erledigt' : `${done} von 3 erledigt`
                          )
                        )
                      );
                    })
                  ),
              
              // === TERMIN-MODAL (Apple Style) ===
              scheduleModalOpen && React.createElement('div', { 
                className: 'fixed inset-0 z-50 flex items-center justify-center',
                onClick: () => setScheduleModalOpen(false)
              },
                // Backdrop mit Blur
                React.createElement('div', { 
                  className: 'absolute inset-0 bg-black/40 backdrop-blur-sm'
                }),
                // Modal
                React.createElement('div', { 
                  className: 'relative bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/50 p-6 w-full max-w-sm mx-4',
                  onClick: e => e.stopPropagation(),
                  style: { boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)' }
                },
                  // Header
                  React.createElement('div', { className: 'text-center mb-6' },
                    React.createElement('div', { 
                      className: 'w-14 h-14 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/30'
                    },
                      React.createElement(Calendar, { size: 28, className: 'text-white' })
                    ),
                    React.createElement('h3', { className: 'font-semibold text-lg text-slate-900' }, 
                      lang === 'de' ? 'Gespr√§chstermin festlegen' : lang === 'it' ? 'Fissa appuntamento' : 'Schedule Meeting'
                    ),
                    scheduleModalMember && React.createElement('p', { className: 'text-sm text-slate-500 mt-1' }, 
                      scheduleModalMember.name
                    )
                  ),
                  
                  // Aktueller Status (wenn Termin existiert)
                  scheduleModalMember?.scheduledAt && React.createElement('div', { 
                    className: `mb-4 px-3 py-2 rounded-xl text-xs text-center ${
                      scheduleModalMember.meetingDone 
                        ? 'bg-green-50 border border-green-200 text-green-700' 
                        : 'bg-slate-50 border border-slate-200 text-slate-600'
                    }`
                  },
                    scheduleModalMember.meetingDone 
                      ? `‚úì ${lang === 'de' ? 'Gespr√§ch bereits gef√ºhrt' : lang === 'it' ? 'Colloquio gi√† effettuato' : 'Meeting already done'}`
                      : `${lang === 'de' ? 'Aktueller Termin gespeichert' : lang === 'it' ? 'Appuntamento corrente salvato' : 'Current appointment saved'}`
                  ),
                  
                  // Date Input
                  React.createElement('div', { className: 'mb-6' },
                    React.createElement('label', { className: 'block text-xs font-medium text-slate-500 mb-2' },
                      lang === 'de' ? 'Datum & Uhrzeit' : lang === 'it' ? 'Data & Ora' : 'Date & Time'
                    ),
                    React.createElement('input', {
                      type: 'datetime-local',
                      value: scheduleModalDate,
                      onChange: e => setScheduleModalDate(e.target.value),
                      className: 'w-full px-4 py-3 bg-slate-100 border-2 border-transparent rounded-2xl text-slate-900 text-center text-lg font-medium focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none transition-all'
                    }),
                    // Hinweis f√ºr das Datumsformat
                    React.createElement('p', { className: 'text-xs text-slate-400 text-center mt-2' },
                      lang === 'de' ? 'Tipp: Klicken Sie auf das Kalender-Symbol' : lang === 'it' ? 'Suggerimento: Clicca sull\'icona calendario' : 'Tip: Click the calendar icon'
                    )
                  ),
                  
                  // Quelle-Hinweis wenn aus Formular
                  scheduleModalMember?.scheduledSource === 'form' && React.createElement('div', { 
                    className: 'mb-4 px-3 py-2 bg-amber-50 border border-amber-200 rounded-xl text-xs text-amber-700 text-center'
                  },
                    'üìù ' + (lang === 'de' ? 'Automatisch aus Bewertungsbogen √ºbernommen' : lang === 'it' ? 'Importato automaticamente dal modulo' : 'Auto-synced from evaluation form')
                  ),
                  
                  // Buttons
                  React.createElement('div', { className: 'flex gap-3' },
                    // L√∂schen (nur wenn Termin existiert)
                    scheduleModalMember?.scheduledAt && React.createElement('button', {
                      onClick: deleteScheduleDate,
                      className: 'flex-1 py-3 rounded-2xl font-semibold text-red-600 bg-red-50 hover:bg-red-100 transition-colors'
                    }, lang === 'de' ? 'L√∂schen' : lang === 'it' ? 'Elimina' : 'Delete'),
                    
                    // Speichern
                    React.createElement('button', {
                      onClick: saveScheduleDate,
                      disabled: !scheduleModalDate,
                      className: `flex-1 py-3 rounded-2xl font-semibold text-white transition-all ${
                        scheduleModalDate 
                          ? 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/30' 
                          : 'bg-slate-300 cursor-not-allowed'
                      }`
                    }, 
                      React.createElement('span', { className: 'flex items-center justify-center gap-2' },
                        React.createElement(Calendar, { size: 16 }),
                        lang === 'de' ? 'Speichern' : lang === 'it' ? 'Salva' : 'Save'
                      )
                    )
                  ),
                  
                  // Close Button
                  React.createElement('button', {
                    onClick: () => setScheduleModalOpen(false),
                    className: 'absolute top-4 right-4 w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors'
                  },
                    React.createElement(X, { size: 16, className: 'text-slate-500' })
                  )
                )
              ),
              
              // === LEGENDE ===
              teamMembers.length > 0 && React.createElement('div', { className: 'flex flex-wrap gap-4 text-xs text-slate-500 justify-center' },
                React.createElement('span', { className: 'flex items-center gap-1' },
                  React.createElement('span', { className: 'w-3 h-3 rounded bg-teal-100 border border-teal-300' }), getText(lang, 'Selbstreflexion', 'Autovalutazione', 'Self-Reflection')),
                React.createElement('span', { className: 'flex items-center gap-1' },
                  React.createElement('span', { className: 'w-3 h-3 rounded bg-blue-100 border border-blue-300' }), getText(lang, 'Beurteilung', 'Valutazione', 'Review')),
                React.createElement('span', { className: 'flex items-center gap-1' },
                  React.createElement('span', { className: 'w-3 h-3 rounded bg-purple-100 border border-purple-300' }), getText(lang, 'Ziele', 'Obiettivi', 'Goals')),
                React.createElement('span', { className: 'flex items-center gap-1' },
                  React.createElement('span', { className: 'w-3 h-3 rounded bg-indigo-100 border border-indigo-300' }), getText(lang, 'Geteilt', 'Condiviso', 'Shared'))
              ),
              
              // === SHARE MODAL ===
              renderShareModal()
            );
            } catch (renderError) {
              console.error('‚ùå renderTeamOverview ERROR:', renderError);
              return React.createElement('div', { className: 'p-8 bg-red-50 rounded-xl border border-red-200 text-center' },
                React.createElement('h2', { className: 'text-red-700 font-bold text-xl mb-2' }, '‚ö†Ô∏è Rendering-Fehler'),
                React.createElement('p', { className: 'text-red-600 mb-4' }, renderError.message || 'Unbekannter Fehler'),
                React.createElement('pre', { className: 'text-left text-xs bg-red-100 p-4 rounded overflow-auto max-h-40' }, 
                  renderError.stack || 'Kein Stack-Trace verf√ºgbar'
                ),
                React.createElement('button', {
                  onClick: () => window.location.reload(),
                  className: 'mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700'
                }, 'Seite neu laden')
              );
            }
          };
          
          // === NEU: SALARY REVIEW MODULE - Separates Modul mit Berechtigungssystem ===
          
          // === SALARY REVIEW MODULE v37 ===
          // === GOALS DASHBOARD MODULE (v4 - Synchronisiert mit HR Dashboard Logik) ===
          const renderGoalsDashboardModule = () => {
            // Verwende salaryReviewUserRole direkt (bereits korrekt gesetzt)
            const currentAccess = isHRAdmin 
              ? { role: 'hr_admin', canViewAll: true, canEditAll: true, canInvite: true, accessSalary: true, accessGoals: true }
              : salaryReviewUserRole;
              
            if (!currentAccess || !currentAccess.accessGoals) {
              return React.createElement('div', { className: 'p-12 text-center' },
                React.createElement('p', { className: 'text-red-500' }, getText(lang, 'Kein Zugriff auf Goals Dashboard', 'Nessun accesso al Dashboard Obiettivi', 'No access to Goals Dashboard'))
              );
            }
            
            // Daten basierend auf Rolle filtern
            let dataSource = allCompanyAppraisals;
            if (currentAccess.role === 'manager' && currentAccess.allowedEmployeeIds) {
              dataSource = allCompanyAppraisals.filter(a => 
                currentAccess.allowedEmployeeIds.includes(a.employeeId || a.id)
              );
            }
            
            // ============================================================
            // WICHTIG: EXAKT GLEICHE LOGIK WIE HR DASHBOARD
            // Nur Dokumente mit type === 'goals' (streng!)
            // ============================================================
            const goalAppraisals = dataSource.filter(a => a.type === 'goals');
            
            const totalGoalDocs = goalAppraisals.length;
            const completedGoals = goalAppraisals.filter(a => a.status === 'completed');
            const draftGoals = goalAppraisals.filter(a => a.status === 'draft' || a.status !== 'completed');
            
            // Z√§hle alle einzelnen Ziele (EXAKT wie HR Dashboard)
            let allGoals = [];
            let totalWeight = 0;
            let goalsWithWeight = 0;
            
            goalAppraisals.forEach(ga => {
              // Hole Ziele aus goals Array (prim√§r) oder formData.goals (sekund√§r)
              const goalsArray = ga.goals && Array.isArray(ga.goals) ? ga.goals : 
                                 (ga.formData?.goals && Array.isArray(ga.formData.goals) ? ga.formData.goals : []);
              
              goalsArray.forEach((g, idx) => {
                // NUR Ziele mit name (wie HR Dashboard: if (g.name))
                if (g.name || g.title) {
                  allGoals.push({
                    ...g,
                    id: g.id || idx,
                    title: g.name || g.title || '',
                    name: g.name || g.title || '',
                    target: g.target || g.measurable || '',
                    weight: parseFloat(g.weight) || 0,
                    achievement: parseFloat(g.achievement) || 0,
                    employeeName: ga.employeeName || ga.formData?.employee || 'Unbekannt',
                    position: ga.formData?.position || '',
                    appraisalId: ga.id,
                    appraisalStatus: ga.status,
                    updatedAt: ga.updatedAt || ga.createdAt
                  });
                  if (parseFloat(g.weight) > 0) {
                    totalWeight += parseFloat(g.weight) || 0;
                    goalsWithWeight++;
                  }
                }
              });
            });
            
            const avgWeight = goalsWithWeight > 0 ? (totalWeight / goalsWithWeight).toFixed(1) : 0;
            
            // Durchschnittliche Zielerreichung
            let totalAchievement = 0;
            let achievementCount = 0;
            allGoals.forEach(g => {
              if (g.achievement > 0) {
                totalAchievement += g.achievement;
                achievementCount++;
              }
            });
            const avgAchievement = achievementCount > 0 ? (totalAchievement / achievementCount).toFixed(0) : '‚Äì';
            
            // Gruppiere nach Mitarbeiter f√ºr die Liste
            const goalsByEmployee = {};
            goalAppraisals.forEach(ga => {
              const employeeKey = ga.employeeId || ga.id;
              const employeeName = ga.employeeName || ga.formData?.employee || 'Unbekannt';
              
              // Hole Ziele
              const goalsArray = ga.goals && Array.isArray(ga.goals) ? ga.goals : 
                                 (ga.formData?.goals && Array.isArray(ga.formData.goals) ? ga.formData.goals : []);
              
              // Filtere nur Ziele mit Name
              const validGoals = goalsArray.filter(g => g.name || g.title);
              
              goalsByEmployee[employeeKey] = {
                id: ga.id,
                employeeId: employeeKey,
                employeeName: employeeName,
                position: ga.formData?.position || '',
                status: ga.status,
                updatedAt: ga.updatedAt || ga.createdAt,
                goals: validGoals.map((g, idx) => ({
                  id: g.id || idx,
                  title: g.name || g.title || '',
                  name: g.name || g.title || '',
                  target: g.target || g.measurable || '',
                  weight: parseFloat(g.weight) || 0,
                  achievement: parseFloat(g.achievement) || 0
                }))
              };
            });
            
            const employeeList = Object.values(goalsByEmployee);
            
            // Filter-State
            const getFilter = (key, def) => safeLocalStorage.getItem('goalsDash_' + key, def);
            const setFilter = (key, val) => { safeLocalStorage.setItem('goalsDash_' + key, val); window.dispatchEvent(new Event('storage')); };
            
            const searchFilter = getFilter('search', '');
            const statusFilter = getFilter('status', 'all');
            const selectedId = goalsDashboardSelectedId; // Aus PerformanceApp State
            
            // Gefilterte Liste
            const filteredEmployees = employeeList.filter(emp => {
              const matchesSearch = !searchFilter || emp.employeeName.toLowerCase().includes(searchFilter.toLowerCase());
              const matchesStatus = statusFilter === 'all' || 
                (statusFilter === 'completed' && emp.status === 'completed') ||
                (statusFilter === 'draft' && emp.status !== 'completed');
              return matchesSearch && matchesStatus;
            });
            
            // Detail-Modal
            const selectedEmployee = selectedId ? employeeList.find(e => e.id === selectedId) : null;
            
            const renderDetailModal = () => {
              if (!selectedEmployee) return null;
              const goals = selectedEmployee.goals;
              
              return React.createElement('div', { 
                className: 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4',
                onClick: () => setGoalsDashboardSelectedId(null)
              },
                React.createElement('div', { 
                  className: 'bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col',
                  onClick: e => e.stopPropagation()
                },
                  // Header
                  React.createElement('div', { className: 'bg-gradient-to-r from-purple-600 to-purple-800 p-6 text-white flex-shrink-0' },
                    React.createElement('div', { className: 'flex justify-between items-start' },
                      React.createElement('div', null,
                        React.createElement('h2', { className: 'text-xl font-bold' }, selectedEmployee.employeeName),
                        React.createElement('p', { className: 'text-purple-200 text-sm mt-1' },
                          goals.length + ' ' + getText(lang, 'Ziele definiert', 'obiettivi definiti', 'goals defined')
                        ),
                        selectedEmployee.position && React.createElement('p', { className: 'text-purple-200 text-xs mt-1' },
                          selectedEmployee.position
                        )
                      ),
                      React.createElement('button', {
                        onClick: () => setGoalsDashboardSelectedId(null),
                        className: 'text-white/80 hover:text-white text-2xl font-light'
                      }, '√ó')
                    )
                  ),
                  // Goals List (scrollbar)
                  React.createElement('div', { className: 'p-6 space-y-4 overflow-y-auto flex-1' },
                    goals.length === 0 ?
                      React.createElement('p', { className: 'text-slate-500 text-center py-8' },
                        getText(lang, 'Keine Ziele definiert', 'Nessun obiettivo definito', 'No goals defined')
                      ) :
                      goals.map((goal, idx) => 
                        React.createElement('div', { key: idx, className: 'border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow' },
                          React.createElement('div', { className: 'flex items-start gap-3' },
                            React.createElement('div', { className: 'w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-sm flex-shrink-0' }, idx + 1),
                            React.createElement('div', { className: 'flex-1' },
                              React.createElement('h4', { className: 'font-semibold text-slate-800 mb-2' }, goal.title || goal.name),
                              // Messkriterium / Target
                              goal.target && React.createElement('div', { className: 'mb-2' },
                                React.createElement('span', { className: 'text-xs font-medium text-slate-500 uppercase' }, 
                                  getText(lang, 'Messkriterium / Zielwert', 'Criterio di misura', 'Measurement / Target')
                                ),
                                React.createElement('p', { className: 'text-sm text-slate-700 mt-1' }, goal.target)
                              ),
                              // Metadaten
                              React.createElement('div', { className: 'mt-3 pt-3 border-t border-slate-100 flex flex-wrap gap-2' },
                                goal.weight > 0 && React.createElement('span', { className: 'text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded' },
                                  getText(lang, 'Gewichtung', 'Peso', 'Weight') + ': ' + goal.weight + '%'
                                ),
                                goal.achievement > 0 && React.createElement('span', { className: 'text-xs bg-green-100 text-green-700 px-2 py-1 rounded' },
                                  getText(lang, 'Erreichung', 'Raggiungimento', 'Achievement') + ': ' + goal.achievement + '%'
                                )
                              )
                            )
                          )
                        )
                      )
                  )
                )
              );
            };
            
            return React.createElement('div', { className: 'space-y-6' },
              // Header
              React.createElement('div', { className: 'bg-gradient-to-r from-purple-600 to-purple-800 rounded-xl p-6 text-white' },
                React.createElement('h1', { className: 'text-2xl font-bold mb-2' },
                  lang === 'de' ? 'Ziel-Dashboard (MBO)' : lang === 'it' ? 'Dashboard Obiettivi (MBO)' : 'Goals Dashboard (MBO)'
                ),
                React.createElement('p', { className: 'text-purple-100' },
                  lang === 'de' ? 'Unternehmensweite √úbersicht aller Zielvereinbarungen' : 
                  lang === 'it' ? 'Panoramica aziendale di tutti gli accordi sugli obiettivi' : 
                  'Company-wide overview of all goal agreements'
                )
              ),
              
              // KPI Cards (EXAKT wie HR Dashboard)
              React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-4' },
                React.createElement('div', { className: 'bg-white rounded-xl p-5 shadow-sm border border-slate-200' },
                  React.createElement('div', { className: 'text-3xl font-bold text-purple-600' }, totalGoalDocs),
                  React.createElement('div', { className: 'text-sm text-slate-600 mt-1' },
                    lang === 'de' ? 'Zielvereinbarungen' : lang === 'it' ? 'Accordi' : 'Agreements'
                  )
                ),
                React.createElement('div', { className: 'bg-white rounded-xl p-5 shadow-sm border border-slate-200' },
                  React.createElement('div', { className: 'text-3xl font-bold text-green-600' }, completedGoals.length),
                  React.createElement('div', { className: 'text-sm text-slate-600 mt-1' },
                    lang === 'de' ? 'Abgeschlossen' : lang === 'it' ? 'Completati' : 'Completed'
                  )
                ),
                React.createElement('div', { className: 'bg-white rounded-xl p-5 shadow-sm border border-slate-200' },
                  React.createElement('div', { className: 'text-3xl font-bold text-amber-600' }, draftGoals.length),
                  React.createElement('div', { className: 'text-sm text-slate-600 mt-1' },
                    lang === 'de' ? 'Entw√ºrfe' : lang === 'it' ? 'Bozze' : 'Drafts'
                  )
                ),
                React.createElement('div', { className: 'bg-white rounded-xl p-5 shadow-sm border border-slate-200' },
                  React.createElement('div', { className: 'text-3xl font-bold text-blue-600' }, allGoals.length),
                  React.createElement('div', { className: 'text-sm text-slate-600 mt-1' },
                    lang === 'de' ? 'Einzelziele' : lang === 'it' ? 'Obiettivi singoli' : 'Individual Goals'
                  )
                ),
                React.createElement('div', { className: 'bg-white rounded-xl p-5 shadow-sm border border-slate-200' },
                  React.createElement('div', { className: 'text-3xl font-bold text-teal-600' }, avgWeight + '%'),
                  React.createElement('div', { className: 'text-sm text-slate-600 mt-1' },
                    lang === 'de' ? '√ò Gewichtung' : lang === 'it' ? 'Peso medio' : 'Avg Weight'
                  )
                )
              ),
              
              // Filter Section
              React.createElement('div', { className: 'bg-white rounded-xl p-4 shadow-sm border border-slate-200' },
                React.createElement('div', { className: 'flex flex-wrap gap-4 items-center' },
                  // Search
                  React.createElement('div', { className: 'flex-1 min-w-[200px]' },
                    React.createElement('input', {
                      type: 'text',
                      placeholder: lang === 'de' ? 'Mitarbeiter suchen...' : lang === 'it' ? 'Cerca collaboratore...' : 'Search employee...',
                      defaultValue: searchFilter,
                      onChange: e => setFilter('search', e.target.value),
                      className: 'w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500'
                    })
                  ),
                  // Status Filter Dropdown
                  React.createElement('select', {
                    defaultValue: statusFilter,
                    onChange: e => setFilter('status', e.target.value),
                    className: 'px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500'
                  },
                    React.createElement('option', { value: 'all' }, getText(lang, 'Alle Status', 'Tutti gli stati', 'All Status')),
                    React.createElement('option', { value: 'completed' }, getText(lang, 'Abgeschlossen', 'Completati', 'Completed')),
                    React.createElement('option', { value: 'draft' }, getText(lang, 'Offen / Entwurf', 'Aperto / Bozza', 'Open / Draft'))
                  ),
                  // Info
                  React.createElement('span', { className: 'text-sm text-slate-500' },
                    filteredEmployees.length + ' ' + getText(lang, 'Eintr√§ge', 'voci', 'entries')
                  )
                )
              ),
              
              // Goals List with Preview
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden' },
                React.createElement('div', { className: 'p-4 border-b border-slate-200 bg-slate-50' },
                  React.createElement('h2', { className: 'text-lg font-bold text-slate-800' },
                    getText(lang, 'Alle Zielvereinbarungen', 'Tutti gli accordi', 'All Goal Agreements')
                  )
                ),
                filteredEmployees.length === 0 ?
                  React.createElement('div', { className: 'p-8 text-center text-slate-500' },
                    getText(lang, 'Keine Zielvereinbarungen gefunden', 'Nessun accordo trovato', 'No goal agreements found')
                  ) :
                  React.createElement('div', { className: 'divide-y divide-slate-200' },
                    filteredEmployees.map((emp, idx) => {
                      const goals = emp.goals;
                      const previewGoals = goals.slice(0, 3);
                      
                      return React.createElement('div', { 
                        key: idx, 
                        className: 'p-4 hover:bg-purple-50 cursor-pointer transition-colors',
                        onClick: () => setGoalsDashboardSelectedId(emp.id)
                      },
                        React.createElement('div', { className: 'flex justify-between items-start mb-3' },
                          React.createElement('div', null,
                            React.createElement('p', { className: 'font-semibold text-slate-800 text-lg' }, emp.employeeName),
                            React.createElement('p', { className: 'text-sm text-slate-500' }, 
                              goals.length + ' ' + getText(lang, 'Ziele', 'obiettivi', 'goals') +
                              (emp.position ? ' ‚Ä¢ ' + emp.position : '') +
                              (emp.updatedAt ? ' ‚Ä¢ ' + new Date(emp.updatedAt).toLocaleDateString('de-DE') : '')
                            )
                          ),
                          React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('span', { 
                              className: 'px-3 py-1 rounded-full text-xs font-medium ' + 
                                (emp.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700')
                            }, emp.status === 'completed' 
                              ? getText(lang, 'Abgeschlossen', 'Completato', 'Completed')
                              : getText(lang, 'Entwurf', 'Bozza', 'Draft')
                            ),
                            React.createElement('span', { className: 'text-purple-500 text-lg' }, '‚Üí')
                          )
                        ),
                        // Preview der ersten 3 Ziele
                        previewGoals.length > 0 && React.createElement('div', { className: 'space-y-2 ml-1' },
                          previewGoals.map((goal, gIdx) =>
                            React.createElement('div', { key: gIdx, className: 'flex items-start gap-2 text-sm' },
                              React.createElement('span', { className: 'text-purple-500 font-bold flex-shrink-0' }, '‚Ä¢'),
                              React.createElement('span', { className: 'text-slate-700' }, 
                                (goal.title || goal.name).substring(0, 80) +
                                ((goal.title || goal.name).length > 80 ? '...' : '')
                              ),
                              goal.weight > 0 && React.createElement('span', { className: 'text-xs text-slate-400 flex-shrink-0' }, '(' + goal.weight + '%)')
                            )
                          ),
                          goals.length > 3 && React.createElement('div', { className: 'text-xs text-slate-400 italic ml-4' },
                            '+ ' + (goals.length - 3) + ' ' + getText(lang, 'weitere Ziele', 'altri obiettivi', 'more goals')
                          )
                        )
                      );
                    })
                  )
              ),
              
              // Detail Modal
              renderDetailModal()
            );
          };
          
          const renderSalaryReviewModule = () => {
            // Verwende salaryReviewUserRole direkt (bereits korrekt gesetzt)
            const currentAccess = isHRAdmin 
              ? { role: 'hr_admin', canViewAll: true, canEditAll: true, canInvite: true, accessSalary: true, accessGoals: true }
              : salaryReviewUserRole;
              
            if (!currentAccess || !currentAccess.accessSalary) {
              return React.createElement('div', { className: 'text-center py-20' },
                React.createElement('div', { className: 'text-6xl mb-4' }, 'üîí'),
                React.createElement('h2', { className: 'text-xl font-bold text-slate-800 mb-2' }, 
                  lang === 'de' ? 'Kein Zugriff' : lang === 'it' ? 'Accesso negato' : 'Access Denied'),
                React.createElement('p', { className: 'text-slate-600' }, 
                  lang === 'de' ? 'Sie haben keine Berechtigung f√ºr Salary Review.' : lang === 'it' ? 'Non hai i permessi per Salary Review.' : 'You do not have permission for Salary Review.')
              );
            }
            
            const userRole = isHRAdmin ? { role: 'hr_admin', canViewAll: true, canEditAll: true, canInvite: true } : currentAccess;
            const canEdit = userRole.canEditAll || userRole.role === 'manager';
            const canInvite = userRole.canInvite;
            
            const formatEUR = (n) => new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(n || 0);
            const formatEURCompact = (n) => { 
              if (n >= 1000000) return (n/1000000).toFixed(1) + 'M ‚Ç¨';
              if (n >= 1000) return (n/1000).toFixed(0) + 'k ‚Ç¨';
              return n + ' ‚Ç¨';
            };
            
            const getRecommendation = (gps) => {
              if (gps >= 4.51) return { label: '5-7%', color: 'emerald' };
              if (gps >= 3.51) return { label: '3-5%', color: 'green' };
              if (gps >= 2.51) return { label: '2-3%', color: 'blue' };
              if (gps >= 1.51) return { label: '0-1%', color: 'amber' };
              return { label: '0%', color: 'red' };
            };
            
            const calculateIncrease = (emp) => {
              const baseSalary = emp.baseSalary || 0;
              const currentBonus = emp.currentBonus || 0;
              const totalCurrent = baseSalary + currentBonus;
              const increasePercent = emp.increasePercent || 0;
              
              // Neuer Bonus: Wenn explizit gesetzt, verwende diesen Wert, sonst currentBonus
              const newBonusAmount = emp.newBonus !== undefined && emp.newBonus !== null ? emp.newBonus : currentBonus;
              
              // Gehaltserh√∂hung berechnen
              const salaryIncrease = baseSalary * (increasePercent / 100);
              const newBaseSalary = baseSalary + salaryIncrease;
              
              // Total-Berechnungen
              const totalIncrease = salaryIncrease + (newBonusAmount - currentBonus);
              const totalNew = newBaseSalary + newBonusAmount;
              
              return { baseSalary, currentBonus, totalCurrent, salaryIncrease, newBaseSalary, newBonusAmount, totalIncrease, totalNew };
            };
            
            const removeFromReview = (empId) => {
              const confirmMsg = lang === 'de' ? 'Mitarbeiter aus der Gehaltsrunde entfernen?' : lang === 'it' ? 'Rimuovere il dipendente dalla revisione salariale?' : 'Remove employee from salary review?';
              if (confirm(confirmMsg)) {
                const updatedEmployees = compEmployees.filter(e => e.id !== empId);
                setCompEmployees(updatedEmployees);
                triggerAutoSave(compBudget, updatedEmployees);
              }
            };
            
            let visibleEmployees = userRole.canViewAll ? [...compEmployees] : compEmployees.filter(emp => userRole.allowedEmployeeIds?.includes(emp.id));
            
            if (salaryReviewFilter) {
              const search = salaryReviewFilter.toLowerCase();
              visibleEmployees = visibleEmployees.filter(emp => 
                (emp.name || '').toLowerCase().includes(search) || (emp.position || '').toLowerCase().includes(search)
              );
            }
            
            visibleEmployees.sort((a, b) => {
              const calcA = calculateIncrease(a);
              const calcB = calculateIncrease(b);
              let aVal, bVal;
              const field = salaryReviewSort.field;
              if (field === 'name') { aVal = (a.name || '').toLowerCase(); bVal = (b.name || '').toLowerCase(); }
              else if (field === 'gpsScore') { aVal = a.gpsScore || 0; bVal = b.gpsScore || 0; }
              else if (field === 'baseSalary') { aVal = a.baseSalary || 0; bVal = b.baseSalary || 0; }
              else if (field === 'increasePercent') { aVal = a.increasePercent || 0; bVal = b.increasePercent || 0; }
              else if (field === 'newBaseSalary') { aVal = calcA.newBaseSalary; bVal = calcB.newBaseSalary; }
              else if (field === 'totalNew') { aVal = calcA.totalNew; bVal = calcB.totalNew; }
              else { aVal = a[field] || ''; bVal = b[field] || ''; }
              
              if (typeof aVal === 'string') {
                return salaryReviewSort.direction === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
              }
              return salaryReviewSort.direction === 'asc' ? aVal - bVal : bVal - aVal;
            });
            
            let totalCosts = 0, totalNewSalaries = 0, empWithIncrease = 0, highPerformers = 0;
            compEmployees.forEach(emp => {
              const calc = calculateIncrease(emp);
              totalCosts += calc.totalIncrease;
              totalNewSalaries += calc.totalNew;
              if (emp.increasePercent > 0) empWithIncrease++;
              if ((emp.gpsScore || 0) >= 3.51) highPerformers++;
            });
            
            const remaining = compBudget - totalCosts;
            const usedPct = compBudget > 0 ? (totalCosts / compBudget) * 100 : 0;
            const remainingPct = compBudget > 0 ? (remaining / compBudget) * 100 : 100;
            const avgIncrease = compEmployees.length > 0 ? compEmployees.reduce((sum, e) => sum + (e.increasePercent || 0), 0) / compEmployees.length : 0;
            const avgGPS = compEmployees.length > 0 ? compEmployees.reduce((sum, e) => sum + (e.gpsScore || 0), 0) / compEmployees.length : 0;
            const budgetStatus = remaining < 0 ? 'over' : remainingPct < 10 ? 'warning' : 'ok';
            
            const triggerAutoSave = (newBudget, newEmployees) => {
              if (salaryReviewAutoSaveTimer) clearTimeout(salaryReviewAutoSaveTimer);
              setSalaryReviewAutoSaveTimer(setTimeout(() => {
                saveSalaryReviewData(newBudget !== undefined ? newBudget : compBudget, newEmployees || compEmployees);
              }, 2000));
            };
            
            const updateEmployee = (empId, field, newValue) => {
              const emp = compEmployees.find(e => e.id === empId);
              if (!emp) return;
              
              // Wenn "Aktuell"-Werte ge√§ndert werden, automatisch "Neu"-Werte anpassen
              let updatedEmp = { ...emp, [field]: newValue };
              
              // Wenn baseSalary ge√§ndert wird und noch kein increasePercent gesetzt, bleibt newBaseSalary = baseSalary
              // Wenn currentBonus ge√§ndert wird und noch kein newBonus gesetzt, newBonus = currentBonus
              if (field === 'currentBonus' && (emp.newBonus === undefined || emp.newBonus === null)) {
                updatedEmp.newBonus = newValue;
              }
              
              const updatedEmployees = compEmployees.map(e => e.id === empId ? updatedEmp : e);
              setCompEmployees(updatedEmployees);
              triggerAutoSave(compBudget, updatedEmployees);
            };
            
            const SortHeader = ({ field, label, align, cls }) => {
              const isActive = salaryReviewSort.field === field;
              const arrow = isActive ? (salaryReviewSort.direction === 'asc' ? ' ‚Üë' : ' ‚Üì') : '';
              const alignClass = align === 'right' ? 'text-right' : align === 'center' ? 'text-center' : 'text-left';
              return React.createElement('th', { 
                className: 'px-3 py-3 cursor-pointer hover:bg-slate-200 select-none whitespace-nowrap text-xs font-semibold ' + alignClass + ' ' + (cls || '') + (isActive ? ' bg-slate-200' : ''),
                onClick: () => setSalaryReviewSort({ field, direction: isActive && salaryReviewSort.direction === 'asc' ? 'desc' : 'asc' })
              }, label + arrow);
            };
            
            return React.createElement('div', { className: 'space-y-4' },
              
              // STICKY HEADER
              React.createElement('div', { 
                className: 'sticky top-0 z-40 bg-white rounded-xl shadow-lg border-2 p-4 ' + (budgetStatus === 'over' ? 'border-red-400' : budgetStatus === 'warning' ? 'border-amber-400' : 'border-emerald-200'),
                style: budgetStatus === 'over' ? { animation: 'pulse 2s infinite' } : {}
              },
                React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('h2', { className: 'text-lg font-bold text-slate-800' }, 'Salary Review ' + new Date().getFullYear()),
                    React.createElement('span', { 
                      className: 'px-2 py-1 rounded-full text-xs font-medium ' + (userRole.role === 'hr_admin' ? 'bg-purple-100 text-purple-700' : userRole.role === 'executive' ? 'bg-blue-100 text-blue-700' : 'bg-amber-100 text-amber-700')
                    }, userRole.role === 'hr_admin' ? 'HR Admin' : userRole.role === 'executive' ? 'Executive' : 'Manager'),
                    salaryReviewPendingSave && React.createElement('span', { className: 'text-emerald-600 text-xs animate-pulse' }, 
                      lang === 'de' ? '‚óè Speichert...' : lang === 'it' ? '‚óè Salvataggio...' : '‚óè Saving...')
                  ),
                  isHRAdmin && React.createElement('div', { className: 'flex items-center gap-2' },
                    React.createElement('span', { className: 'text-sm text-slate-600' }, 'Budget:'),
                    React.createElement('input', { 
                      type: 'number', value: compBudget, 
                      onChange: (e) => { const newBudget = parseFloat(e.target.value) || 0; setCompBudget(newBudget); triggerAutoSave(newBudget, compEmployees); }, 
                      className: 'w-28 px-2 py-1 text-right font-bold border-2 rounded-lg ' + (budgetStatus === 'over' ? 'border-red-400' : 'border-slate-300'), 
                      min: 0, step: 1000 
                    }),
                    React.createElement('span', { className: 'text-slate-500' }, '‚Ç¨')
                  )
                ),
                // Budget Bar
                React.createElement('div', { className: 'relative mb-3' },
                  React.createElement('div', { className: 'h-6 bg-slate-100 rounded-full overflow-hidden' },
                    React.createElement('div', { 
                      className: 'h-full transition-all duration-300 ' + (budgetStatus === 'over' ? 'bg-red-500' : budgetStatus === 'warning' ? 'bg-amber-500' : 'bg-emerald-500'), 
                      style: { width: Math.min(usedPct, 100) + '%' } 
                    })
                  ),
                  React.createElement('div', { className: 'absolute inset-0 flex items-center justify-between px-3' },
                    React.createElement('span', { className: 'text-xs font-bold ' + (usedPct > 40 ? 'text-white' : 'text-slate-700') }, 
                      formatEUR(totalCosts) + ' ' + (lang === 'de' ? 'geplant' : lang === 'it' ? 'pianificato' : 'planned') + ' (' + usedPct.toFixed(0) + '%)'
                    ),
                    React.createElement('span', { className: 'text-xs font-bold ' + (budgetStatus === 'over' ? 'text-red-700 bg-white/80 px-2 rounded' : 'text-slate-700') }, 
                      budgetStatus === 'over' 
                        ? formatEUR(Math.abs(remaining)) + ' ' + (lang === 'de' ? '√ºber Budget' : lang === 'it' ? 'oltre budget' : 'over budget')
                        : formatEUR(remaining) + ' ' + (lang === 'de' ? 'verf√ºgbar' : lang === 'it' ? 'disponibile' : 'available')
                    )
                  )
                ),
                // KPI Cards
                React.createElement('div', { className: 'grid grid-cols-3 md:grid-cols-6 gap-2' },
                  React.createElement('div', { className: 'bg-slate-50 rounded-lg p-2 text-center' }, 
                    React.createElement('div', { className: 'text-lg font-bold text-slate-800' }, compEmployees.length), 
                    React.createElement('div', { className: 'text-[10px] text-slate-500' }, lang === 'de' ? 'Mitarbeiter' : lang === 'it' ? 'Dipendenti' : 'Employees')
                  ),
                  React.createElement('div', { className: 'bg-emerald-50 rounded-lg p-2 text-center' }, 
                    React.createElement('div', { className: 'text-lg font-bold text-emerald-600' }, avgIncrease.toFixed(1) + '%'), 
                    React.createElement('div', { className: 'text-[10px] text-slate-500' }, lang === 'de' ? '√ò Erh√∂hung' : lang === 'it' ? '√ò Aumento' : '√ò Increase')
                  ),
                  React.createElement('div', { className: 'bg-blue-50 rounded-lg p-2 text-center' }, 
                    React.createElement('div', { className: 'text-lg font-bold text-blue-600' }, avgGPS.toFixed(2)), 
                    React.createElement('div', { className: 'text-[10px] text-slate-500' }, '√ò GPS')
                  ),
                  React.createElement('div', { className: 'bg-green-50 rounded-lg p-2 text-center' }, 
                    React.createElement('div', { className: 'text-lg font-bold text-green-600' }, highPerformers), 
                    React.createElement('div', { className: 'text-[10px] text-slate-500' }, 'Top Performer')
                  ),
                  React.createElement('div', { className: 'bg-purple-50 rounded-lg p-2 text-center' }, 
                    React.createElement('div', { className: 'text-lg font-bold text-purple-600' }, empWithIncrease), 
                    React.createElement('div', { className: 'text-[10px] text-slate-500' }, lang === 'de' ? 'Mit Erh√∂hung' : lang === 'it' ? 'Con aumento' : 'With Increase')
                  ),
                  React.createElement('div', { className: 'bg-amber-50 rounded-lg p-2 text-center' }, 
                    React.createElement('div', { className: 'text-lg font-bold text-amber-600' }, formatEURCompact(totalNewSalaries)), 
                    React.createElement('div', { className: 'text-[10px] text-slate-500' }, lang === 'de' ? 'Gehaltssumme' : lang === 'it' ? 'Totale stipendi' : 'Total Salaries')
                  )
                )
              ),
              
              // EMPFEHLUNGSTABELLE - aufklappbar mit Hinweis
              React.createElement('div', { className: 'bg-gradient-to-r from-blue-50 to-slate-50 rounded-xl shadow-sm border overflow-hidden' },
                React.createElement('button', { 
                  className: 'w-full px-4 py-3 flex items-center justify-between hover:bg-white/50 transition-colors',
                  onClick: () => setShowRecTable(!showRecTable)
                }, 
                  React.createElement('div', { className: 'flex items-center gap-2' },
                    React.createElement('span', { className: 'font-semibold text-slate-800' }, 
                      lang === 'de' ? 'Empfohlene Erh√∂hungen nach GPS' : lang === 'it' ? 'Aumenti raccomandati per GPS' : 'Recommended Increases by GPS'),
                    React.createElement('span', { className: 'text-xs text-slate-500 ml-2' }, 
                      '(' + (lang === 'de' ? 'Klicken zum ' : lang === 'it' ? 'Clicca per ' : 'Click to ') + 
                      (showRecTable ? (lang === 'de' ? 'Schlie√üen' : lang === 'it' ? 'chiudere' : 'close') : (lang === 'de' ? '√ñffnen' : lang === 'it' ? 'aprire' : 'open')) + ')')
                  ),
                  React.createElement('span', { className: 'text-slate-400 text-lg' }, showRecTable ? '‚ñ≤' : '‚ñº')
                ),
                showRecTable && React.createElement('div', { className: 'px-4 pb-4 border-t bg-white' },
                  React.createElement('table', { className: 'w-full text-sm mt-3' },
                    React.createElement('thead', null,
                      React.createElement('tr', { className: 'bg-slate-50' },
                        React.createElement('th', { className: 'px-3 py-2 text-left font-semibold border' }, 'GPS-Score'),
                        React.createElement('th', { className: 'px-3 py-2 text-left font-semibold border' }, 
                          lang === 'de' ? 'Bewertung' : lang === 'it' ? 'Valutazione' : 'Rating'),
                        React.createElement('th', { className: 'px-3 py-2 text-center font-semibold border' }, 
                          lang === 'de' ? 'Empfohlene Erh√∂hung' : lang === 'it' ? 'Aumento raccomandato' : 'Recommended Increase'),
                        React.createElement('th', { className: 'px-3 py-2 text-left font-semibold border' }, 
                          lang === 'de' ? 'Beschreibung' : lang === 'it' ? 'Descrizione' : 'Description')
                      )
                    ),
                    React.createElement('tbody', null,
                      React.createElement('tr', { className: 'bg-emerald-50' },
                        React.createElement('td', { className: 'px-3 py-2 border font-medium' }, '4.51 ‚Äì 5.00'),
                        React.createElement('td', { className: 'px-3 py-2 border' }, React.createElement('span', { className: 'px-2 py-0.5 bg-emerald-200 text-emerald-800 rounded text-xs font-medium' }, 
                          lang === 'de' ? 'Herausragend' : lang === 'it' ? 'Eccezionale' : 'Outstanding')),
                        React.createElement('td', { className: 'px-3 py-2 border text-center font-bold text-emerald-700' }, '5 ‚Äì 7%'),
                        React.createElement('td', { className: 'px-3 py-2 border text-slate-600 text-xs' }, 
                          lang === 'de' ? '√úberdurchschnittliche Erh√∂hung, ggf. Bef√∂rderung pr√ºfen' : lang === 'it' ? 'Aumento superiore alla media, valutare promozione' : 'Above-average increase, consider promotion')
                      ),
                      React.createElement('tr', { className: 'bg-green-50' },
                        React.createElement('td', { className: 'px-3 py-2 border font-medium' }, '3.51 ‚Äì 4.50'),
                        React.createElement('td', { className: 'px-3 py-2 border' }, React.createElement('span', { className: 'px-2 py-0.5 bg-green-200 text-green-800 rounded text-xs font-medium' }, 
                          lang === 'de' ? '√úbertrifft Erwartungen' : lang === 'it' ? 'Supera le aspettative' : 'Exceeds Expectations')),
                        React.createElement('td', { className: 'px-3 py-2 border text-center font-bold text-green-700' }, '3 ‚Äì 5%'),
                        React.createElement('td', { className: 'px-3 py-2 border text-slate-600 text-xs' }, 
                          lang === 'de' ? 'Gute Erh√∂hung zur Anerkennung der Leistung' : lang === 'it' ? 'Buon aumento per riconoscere la performance' : 'Good increase to recognize performance')
                      ),
                      React.createElement('tr', { className: 'bg-blue-50' },
                        React.createElement('td', { className: 'px-3 py-2 border font-medium' }, '2.51 ‚Äì 3.50'),
                        React.createElement('td', { className: 'px-3 py-2 border' }, React.createElement('span', { className: 'px-2 py-0.5 bg-blue-200 text-blue-800 rounded text-xs font-medium' }, 
                          lang === 'de' ? 'Erf√ºllt Erwartungen' : lang === 'it' ? 'Soddisfa le aspettative' : 'Meets Expectations')),
                        React.createElement('td', { className: 'px-3 py-2 border text-center font-bold text-blue-700' }, '2 ‚Äì 3%'),
                        React.createElement('td', { className: 'px-3 py-2 border text-slate-600 text-xs' }, 
                          lang === 'de' ? 'Standard-Inflationsausgleich' : lang === 'it' ? 'Adeguamento standard all\'inflazione' : 'Standard inflation adjustment')
                      ),
                      React.createElement('tr', { className: 'bg-amber-50' },
                        React.createElement('td', { className: 'px-3 py-2 border font-medium' }, '1.51 ‚Äì 2.50'),
                        React.createElement('td', { className: 'px-3 py-2 border' }, React.createElement('span', { className: 'px-2 py-0.5 bg-amber-200 text-amber-800 rounded text-xs font-medium' }, 
                          lang === 'de' ? 'Unter Erwartungen' : lang === 'it' ? 'Sotto le aspettative' : 'Below Expectations')),
                        React.createElement('td', { className: 'px-3 py-2 border text-center font-bold text-amber-700' }, '0 ‚Äì 1%'),
                        React.createElement('td', { className: 'px-3 py-2 border text-slate-600 text-xs' }, 
                          lang === 'de' ? 'Minimale Anpassung, Entwicklungsplan erforderlich' : lang === 'it' ? 'Adeguamento minimo, piano di sviluppo necessario' : 'Minimal adjustment, development plan required')
                      ),
                      React.createElement('tr', { className: 'bg-red-50' },
                        React.createElement('td', { className: 'px-3 py-2 border font-medium' }, '0 ‚Äì 1.50'),
                        React.createElement('td', { className: 'px-3 py-2 border' }, React.createElement('span', { className: 'px-2 py-0.5 bg-red-200 text-red-800 rounded text-xs font-medium' }, 
                          lang === 'de' ? 'Unzureichend' : lang === 'it' ? 'Insufficiente' : 'Insufficient')),
                        React.createElement('td', { className: 'px-3 py-2 border text-center font-bold text-red-700' }, '0%'),
                        React.createElement('td', { className: 'px-3 py-2 border text-slate-600 text-xs' }, 
                          lang === 'de' ? 'Keine Erh√∂hung, PIP (Performance Improvement Plan)' : lang === 'it' ? 'Nessun aumento, PIP (Piano di Miglioramento)' : 'No increase, PIP (Performance Improvement Plan)')
                      )
                    )
                  ),
                  React.createElement('p', { className: 'mt-3 text-xs text-slate-500 italic' }, 
                    lang === 'de' ? 'Diese Werte dienen als Orientierung. Die tats√§chliche Erh√∂hung kann je nach Budget, Marktposition und individueller Situation abweichen.'
                    : lang === 'it' ? 'Questi valori servono come orientamento. L\'aumento effettivo pu√≤ variare in base al budget, alla posizione di mercato e alla situazione individuale.'
                    : 'These values serve as guidance. Actual increases may vary based on budget, market position, and individual circumstances.'
                  )
                )
              ),
              
              // FILTER BAR
              React.createElement('div', { className: 'bg-white rounded-lg shadow-sm border p-2 flex flex-wrap gap-2 items-center' },
                React.createElement('input', { 
                  type: 'text', 
                  placeholder: lang === 'de' ? 'Suche nach Name, Position...' : lang === 'it' ? 'Cerca per nome, posizione...' : 'Search by name, position...', 
                  value: salaryReviewFilter, onChange: (e) => setSalaryReviewFilter(e.target.value), 
                  className: 'flex-1 min-w-[180px] px-3 py-1.5 border rounded-lg text-sm' 
                }),
                isHRAdmin && React.createElement('button', {
                  onClick: () => {
                    const imported = [];
                    allCompanyAppraisals.forEach((a, j) => {
                      if ((a.type === 'review' || !a.type) && a.gpsScore > 0) {
                        imported.push({ 
                          id: Date.now() + j, 
                          name: a.employeeName || (a.formData ? a.formData.employee : '') || 'N/A', 
                          position: (a.formData ? a.formData.position : '') || '', 
                          baseSalary: 0, 
                          currentBonus: 0, 
                          gpsScore: a.gpsScore || 0, 
                          increasePercent: 0, 
                          newBonus: 0 
                        });
                      }
                    });
                    devLog('üì• Import aus Reviews:', imported.length, 'Mitarbeiter');
                    setCompEmployees(imported);
                    triggerAutoSave(compBudget, imported);
                  },
                  className: 'px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700'
                }, lang === 'de' ? 'Import aus Reviews' : lang === 'it' ? 'Importa da Reviews' : 'Import from Reviews'),
                React.createElement('span', { className: 'text-slate-500 text-xs' }, 
                  visibleEmployees.length + ' ' + (lang === 'de' ? 'von' : lang === 'it' ? 'di' : 'of') + ' ' + compEmployees.length)
              ),
              
              // EMPLOYEE TABLE
              visibleEmployees.length > 0 ? React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border overflow-hidden' },
                React.createElement('div', { className: 'overflow-x-auto' },
                  React.createElement('table', { className: 'w-full text-sm' },
                    React.createElement('thead', { className: 'bg-slate-50 border-b-2 border-slate-200' },
                      React.createElement('tr', null,
                        React.createElement('th', { className: 'px-2 py-3 text-left text-xs font-semibold text-slate-500 w-8' }, '#'),
                        React.createElement('th', { className: 'px-3 py-3 text-left text-xs font-semibold text-slate-500 min-w-[160px]' }, 
                          lang === 'de' ? 'Mitarbeiter' : lang === 'it' ? 'Collaboratore' : 'Employee'),
                        React.createElement(SortHeader, { field: 'gpsScore', label: 'GPS', align: 'center', cls: 'w-16' }),
                        React.createElement(SortHeader, { field: 'baseSalary', label: lang === 'de' ? 'Gehalt Aktuell' : lang === 'it' ? 'Stipendio Attuale' : 'Current Salary', align: 'right', cls: 'w-28' }),
                        React.createElement('th', { className: 'px-2 py-3 text-right text-xs font-semibold text-slate-500 w-24' }, 
                          lang === 'de' ? 'Bonus Aktuell' : lang === 'it' ? 'Bonus Attuale' : 'Current Bonus'),
                        React.createElement('th', { className: 'px-2 py-3 text-right text-xs font-semibold text-slate-500 bg-slate-100 w-28' }, 
                          lang === 'de' ? 'Total Aktuell' : lang === 'it' ? 'Totale Attuale' : 'Current Total'),
                        React.createElement(SortHeader, { field: 'increasePercent', label: lang === 'de' ? 'Erh√∂hung %' : lang === 'it' ? 'Aumento %' : 'Increase %', align: 'center', cls: 'bg-emerald-50 w-20' }),
                        React.createElement(SortHeader, { field: 'newBaseSalary', label: lang === 'de' ? 'Gehalt Neu' : lang === 'it' ? 'Stipendio Nuovo' : 'New Salary', align: 'right', cls: 'bg-emerald-50 w-28' }),
                        React.createElement('th', { className: 'px-2 py-3 text-right text-xs font-semibold text-slate-500 bg-emerald-50 w-24' }, 
                          lang === 'de' ? 'Bonus Neu' : lang === 'it' ? 'Bonus Nuovo' : 'New Bonus'),
                        React.createElement(SortHeader, { field: 'totalNew', label: lang === 'de' ? 'Total Neu' : lang === 'it' ? 'Totale Nuovo' : 'New Total', align: 'right', cls: 'bg-emerald-100 w-28' }),
                        React.createElement('th', { className: 'px-1 py-3 w-6' })
                      )
                    ),
                    React.createElement('tbody', null,
                      visibleEmployees.map((emp, idx) => {
                        const calc = calculateIncrease(emp);
                        const rec = getRecommendation(emp.gpsScore || 0);
                        const gpsVal = emp.gpsScore || 0;
                        const gpsColor = gpsVal >= 4.51 ? 'bg-emerald-100 text-emerald-700' : gpsVal >= 3.51 ? 'bg-green-100 text-green-700' : gpsVal >= 2.51 ? 'bg-blue-100 text-blue-700' : gpsVal >= 1.51 ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700';
                        
                        return React.createElement('tr', { key: emp.id, className: 'border-t hover:bg-slate-50 transition-colors' },
                          React.createElement('td', { className: 'px-2 py-2 text-slate-400 text-xs text-center' }, idx + 1),
                          React.createElement('td', { className: 'px-3 py-2' },
                            React.createElement('div', { className: 'font-semibold text-slate-800 text-sm' }, emp.name || '‚Äî'),
                            emp.position && React.createElement('div', { className: 'text-[10px] text-slate-500 truncate max-w-[140px]' }, emp.position)
                          ),
                          React.createElement('td', { className: 'px-2 py-2 text-center' },
                            React.createElement('span', { className: 'px-2 py-0.5 rounded text-xs font-bold ' + gpsColor }, gpsVal.toFixed(2))
                          ),
                          React.createElement('td', { className: 'px-2 py-2 text-right' },
                            canEdit ? React.createElement('input', { 
                              type: 'number', value: emp.baseSalary || '', 
                              onChange: (e) => updateEmployee(emp.id, 'baseSalary', parseFloat(e.target.value) || 0), 
                              className: 'w-24 px-2 py-1 border rounded text-right text-xs', placeholder: '0', min: 0 
                            }) : React.createElement('span', { className: 'text-xs' }, formatEUR(emp.baseSalary))
                          ),
                          React.createElement('td', { className: 'px-2 py-2 text-right' },
                            canEdit ? React.createElement('input', { 
                              type: 'number', value: emp.currentBonus || '', 
                              onChange: (e) => updateEmployee(emp.id, 'currentBonus', parseFloat(e.target.value) || 0), 
                              className: 'w-20 px-2 py-1 border rounded text-right text-xs', placeholder: '0', min: 0 
                            }) : React.createElement('span', { className: 'text-xs' }, formatEUR(emp.currentBonus))
                          ),
                          React.createElement('td', { className: 'px-2 py-2 text-right bg-slate-100/50' },
                            React.createElement('span', { className: 'font-semibold text-slate-700 text-sm' }, formatEUR((emp.baseSalary || 0) + (emp.currentBonus || 0)))
                          ),
                          React.createElement('td', { className: 'px-2 py-2 bg-emerald-50/50 text-center' },
                            canEdit ? React.createElement('input', { 
                              type: 'number', value: emp.increasePercent || '', placeholder: rec.label, 
                              onChange: (e) => updateEmployee(emp.id, 'increasePercent', parseFloat(e.target.value) || 0), 
                              className: 'w-14 px-1 py-1 border-2 border-emerald-400 rounded text-center text-xs font-bold', 
                              title: getText(lang, 'Empfohlen: ', 'Raccomandato: ', 'Recommended: ') + rec.label, step: 0.5, min: 0, max: 30 
                            }) : React.createElement('span', { className: 'font-bold text-xs' }, (emp.increasePercent || 0) + '%')
                          ),
                          React.createElement('td', { className: 'px-2 py-2 text-right bg-emerald-50/50' },
                            React.createElement('div', { className: 'font-semibold text-emerald-700 text-sm' }, formatEUR(calc.newBaseSalary)),
                            calc.salaryIncrease > 0 && React.createElement('div', { className: 'text-[9px] text-emerald-600' }, '+' + formatEUR(calc.salaryIncrease))
                          ),
                          React.createElement('td', { className: 'px-2 py-2 bg-emerald-50/50 text-right' },
                            canEdit ? React.createElement('input', { 
                              type: 'number', value: emp.newBonus !== undefined ? emp.newBonus : (emp.currentBonus || ''), 
                              onChange: (e) => updateEmployee(emp.id, 'newBonus', parseFloat(e.target.value) || 0), 
                              className: 'w-20 px-2 py-1 border-2 border-emerald-400 rounded text-right text-xs', 
                              placeholder: String(emp.currentBonus || 0), min: 0 
                            }) : React.createElement('span', { className: 'text-xs' }, formatEUR(calc.newBonusAmount))
                          ),
                          React.createElement('td', { className: 'px-2 py-2 text-right bg-emerald-100/50' },
                            React.createElement('div', { className: 'font-bold text-sm text-slate-800' }, formatEUR(calc.totalNew)),
                            calc.totalIncrease !== 0 && React.createElement('div', { className: 'text-[9px] font-medium ' + (calc.totalIncrease > 0 ? 'text-emerald-600' : 'text-red-600') }, (calc.totalIncrease > 0 ? '+' : '') + formatEUR(calc.totalIncrease))
                          ),
                          React.createElement('td', { className: 'px-1 py-2 text-center' },
                            canEdit && React.createElement('button', { 
                              onClick: () => removeFromReview(emp.id), 
                              className: 'text-slate-300 hover:text-red-500 transition-colors text-sm', 
                              title: getText(lang, 'Aus Gehaltsrunde entfernen', 'Rimuovi dalla revisione salariale', 'Remove from salary review') 
                            }, '√ó')
                          )
                        );
                      })
                    )
                  )
                )
              ) : React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-12 text-center' },
                React.createElement('h3', { className: 'text-lg font-semibold text-slate-800 mb-2' }, getText(lang, 'Keine Mitarbeiter', 'Nessun collaboratore', 'No Employees')),
                React.createElement('p', { className: 'text-slate-600' }, getText(lang, 'Importieren Sie Mitarbeiter aus den Reviews.', 'Importa collaboratori dalle valutazioni.', 'Import employees from reviews.'))
              ),
              
              // ZUGRIFFSMANAGEMENT
              canInvite && React.createElement('details', { className: 'bg-white rounded-xl shadow-sm border' },
                React.createElement('summary', { className: 'px-4 py-3 cursor-pointer font-semibold text-slate-800 hover:bg-slate-50 text-sm' }, 'Zugriffsmanagement (' + salaryReviewAccess.length + ')'),
                React.createElement('div', { className: 'px-4 pb-4' },
                  React.createElement('button', { onClick: () => setShowSalaryReviewInviteModal(true), className: 'mb-3 px-3 py-1 bg-emerald-600 text-white rounded text-sm' }, '+ Einladen'),
                  salaryReviewAccess.map(a => React.createElement('div', { key: a.id, className: 'flex justify-between items-center py-2 border-t text-sm gap-2' },
                    React.createElement('span', { className: 'flex-1 truncate' }, a.email),
                    React.createElement('div', { className: 'flex items-center gap-1' },
                      // Access Flags anzeigen
                      (a.accessSalary !== false) && React.createElement('span', { className: 'px-1.5 py-0.5 rounded text-[10px] bg-emerald-100 text-emerald-700', title: 'Salary Review' }, 'üí∞'),
                      (a.accessGoals !== false) && React.createElement('span', { className: 'px-1.5 py-0.5 rounded text-[10px] bg-blue-100 text-blue-700', title: 'Goals Dashboard' }, 'üéØ'),
                      React.createElement('span', { className: 'px-2 py-0.5 rounded text-xs ml-1 ' + (a.role === 'executive' ? 'bg-blue-100 text-blue-700' : 'bg-amber-100 text-amber-700') }, a.role)
                    ),
                    React.createElement('button', { onClick: () => removeSalaryReviewAccess(a.email), className: 'text-red-500 text-xs hover:text-red-700 ml-1' }, '√ó')
                  ))
                )
              ),
              
              // INVITE MODAL
                            salaryReviewInviteModal && React.createElement('div', { className: 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4' },
                React.createElement('div', { className: 'bg-white rounded-xl shadow-2xl max-w-md w-full p-5' },
                  React.createElement('h3', { className: 'text-lg font-bold mb-4 flex items-center gap-2' }, 
                    React.createElement(UserPlus, { size: 20, className: 'text-emerald-600' }),
                    lang === 'de' ? 'Benutzer einladen' : 'Invite User'
                  ),
                  
                  // Info-Box
                  React.createElement('div', { className: 'bg-slate-50 rounded-lg p-3 mb-4 text-xs text-slate-600' },
                    React.createElement('p', { className: 'font-semibold mb-1' }, lang === 'de' ? 'Rollen-Erkl√§rung:' : 'Role explanation:'),
                    React.createElement('p', null, '‚Ä¢ ', React.createElement('strong', null, 'Manager'), ': ', lang === 'de' ? 'Sieht nur zugewiesene Mitarbeiter' : 'Sees only assigned employees'),
                    React.createElement('p', null, '‚Ä¢ ', React.createElement('strong', null, 'Executive'), ': ', lang === 'de' ? 'Sieht alle Mitarbeiter der Organisation' : 'Sees all employees in organization')
                  ),
                  
                  // E-Mail Auswahl aus registrierten Benutzern
                  React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, 
                    getText(lang, 'Benutzer ausw√§hlen', 'Seleziona utente', 'Select User')
                  ),
                  React.createElement('div', { className: 'mb-3' },
                    // Dropdown mit registrierten Benutzern
                    registeredUsers.length > 0 
                      ? React.createElement('div', null,
                          React.createElement('select', { 
                            id: 'invite-email-select', 
                            className: 'w-full px-3 py-2 border rounded-lg bg-white mb-2',
                            onChange: (e) => {
                              const customInput = document.getElementById('invite-email-custom');
                              if (customInput) customInput.value = '';
                            }
                          },
                            React.createElement('option', { value: '' }, 
                              getText(lang, '-- Registrierten Benutzer w√§hlen --', '-- Seleziona utente registrato --', '-- Select registered user --')
                            ),
                            // Filtere bereits eingeladene Benutzer heraus
                            registeredUsers
                              .filter(u => !salaryReviewAccess.find(a => a.email.toLowerCase() === u.email.toLowerCase()))
                              .map(u => React.createElement('option', { 
                                key: u.email, 
                                value: u.email 
                              }, u.name + ' (' + u.email + ')'))
                          ),
                          // Info √ºber Anzahl der registrierten Benutzer
                          React.createElement('p', { className: 'text-xs text-slate-500 mb-2' },
                            getText(lang, 
                              registeredUsers.length + ' registrierte Benutzer verf√ºgbar, ' + salaryReviewAccess.length + ' bereits eingeladen',
                              registeredUsers.length + ' utenti registrati disponibili, ' + salaryReviewAccess.length + ' gi√† invitati',
                              registeredUsers.length + ' registered users available, ' + salaryReviewAccess.length + ' already invited'
                            )
                          ),
                          // Oder manuelle Eingabe
                          React.createElement('div', { className: 'flex items-center gap-2 text-xs text-slate-500 my-2' },
                            React.createElement('div', { className: 'flex-1 border-t border-slate-200' }),
                            React.createElement('span', null, getText(lang, 'oder manuell eingeben', 'oppure inserisci manualmente', 'or enter manually')),
                            React.createElement('div', { className: 'flex-1 border-t border-slate-200' })
                          ),
                          React.createElement('input', { 
                            type: 'email', 
                            id: 'invite-email-custom', 
                            placeholder: getText(lang, 'Neue E-Mail-Adresse eingeben...', 'Inserisci nuovo indirizzo email...', 'Enter new email address...'),
                            className: 'w-full px-3 py-2 border rounded-lg text-sm',
                            onChange: (e) => {
                              const select = document.getElementById('invite-email-select');
                              if (select && e.target.value) select.value = '';
                            }
                          })
                        )
                      : React.createElement('div', null,
                          React.createElement('p', { className: 'text-sm text-amber-600 mb-2' },
                            getText(lang, 'Keine registrierten Benutzer gefunden. Geben Sie eine E-Mail-Adresse ein:', 'Nessun utente registrato trovato. Inserisci un indirizzo email:', 'No registered users found. Enter an email address:')
                          ),
                          React.createElement('input', { 
                            type: 'email', 
                            id: 'invite-email-custom', 
                            placeholder: getText(lang, 'E-Mail-Adresse eingeben...', 'Inserisci indirizzo email...', 'Enter email address...'),
                            className: 'w-full px-3 py-2 border rounded-lg'
                          })
                        )
                  ),
                  
                  // Rolle ausw√§hlen
                  React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, lang === 'de' ? 'Rolle' : 'Role'),
                  React.createElement('select', { id: 'invite-role', className: 'w-full px-3 py-2 border rounded-lg mb-3 bg-white' },
                    React.createElement('option', { value: 'manager' }, 'Manager ‚Äì ' + (lang === 'de' ? 'Eingeschr√§nkte Sicht' : 'Limited view')),
                    React.createElement('option', { value: 'executive' }, 'Executive ‚Äì ' + (lang === 'de' ? 'Volle Sicht' : 'Full view'))
                  ),
                  
                  // Zugriff auf (Checkboxen)
                  React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-2' }, lang === 'de' ? 'Zugriff auf:' : 'Access to:'),
                  React.createElement('div', { className: 'space-y-2 mb-4' },
                    React.createElement('label', { className: 'flex items-center gap-2 text-sm cursor-pointer' },
                      React.createElement('input', { type: 'checkbox', id: 'access-salary', defaultChecked: true, className: 'w-4 h-4 rounded text-emerald-600' }),
                      React.createElement('span', null, 'üí∞ Salary Review ', React.createElement('span', { className: 'text-slate-500' }, '(' + (lang === 'de' ? 'Gehaltsdaten' : 'Salary data') + ')'))
                    ),
                    React.createElement('label', { className: 'flex items-center gap-2 text-sm cursor-pointer' },
                      React.createElement('input', { type: 'checkbox', id: 'access-goals', defaultChecked: true, className: 'w-4 h-4 rounded text-purple-600' }),
                      React.createElement('span', null, 'üéØ Goals Dashboard ', React.createElement('span', { className: 'text-slate-500' }, '(' + (lang === 'de' ? 'Ziel√ºbersicht' : 'Goals overview') + ')'))
                    )
                  ),
                  
                  // Buttons
                  React.createElement('div', { className: 'flex gap-2' },
                    React.createElement('button', { 
                      onClick: () => setShowSalaryReviewInviteModal(false), 
                      className: 'flex-1 py-2 border rounded-lg hover:bg-slate-50 transition-colors' 
                    }, lang === 'de' ? 'Abbrechen' : 'Cancel'),
                    React.createElement('button', { 
                      onClick: async () => { 
                        // E-Mail entweder aus Dropdown oder aus manuellem Eingabefeld
                        const selectEl = document.getElementById('invite-email-select');
                        const customEl = document.getElementById('invite-email-custom');
                        const email = (selectEl && selectEl.value) || (customEl && customEl.value) || '';
                        const role = document.getElementById('invite-role').value; 
                        const accessSalary = document.getElementById('access-salary').checked;
                        const accessGoals = document.getElementById('access-goals').checked;
                        if (!email) { showToast(getText(lang, 'Bitte E-Mail eingeben', 'Inserisci un\'email', 'Please enter an email'), 'warning'); return; }
                        if (!accessSalary && !accessGoals) { showToast(getText(lang, 'Bitte mindestens einen Zugriff w√§hlen', 'Seleziona almeno un accesso', 'Please select at least one access'), 'warning'); return; }
                        // Speichere mit Zugriffs-Flags
                        const success = await addSalaryReviewAccess(email, role, [], { accessSalary, accessGoals }); 
                        if (success) setShowSalaryReviewInviteModal(false); 
                      }, 
                      className: 'flex-1 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 transition-colors' 
                    }, lang === 'de' ? 'Einladen' : 'Invite')
                  )
                )
              )
            );
          };
          const renderHRDashboard = () => {
            if (hrDataLoading) {
              return React.createElement('div', { className: 'flex justify-center py-20' },
                React.createElement(Loader2, { className: 'w-12 h-12 animate-spin text-purple-600' })
              );
            }
            
            // Filter
            let filtered = [...allCompanyAppraisals];
            // Type filter
            if (hrFilter === 'completed') filtered = filtered.filter(a => a.status === 'completed');
            if (hrFilter === 'draft') filtered = filtered.filter(a => a.status === 'draft');
            if (hrFilter === 'self') filtered = filtered.filter(a => a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection' || a.type === 'self_assessment_standalone' || a.type === 'self_pdf');
            if (hrFilter === 'reviews') filtered = filtered.filter(a => a.type === 'review' || !a.type);
            if (hrFilter === 'goals') filtered = filtered.filter(a => a.type === 'goals' || a.type === 'goal_agreement');
            
            // Manager filter
            if (hrManagerFilter && hrManagerFilter !== 'all') {
              filtered = filtered.filter(a => (a.formData?.manager || '').toLowerCase().includes(hrManagerFilter.toLowerCase()));
            }
            
            // Location filter
            if (hrLocationFilter && hrLocationFilter !== 'all') {
              filtered = filtered.filter(a => {
                const loc = (a.formData?.location || a.location || '').toLowerCase();
                return loc.includes(hrLocationFilter.toLowerCase());
              });
            }
            
            // GPS filter
            if (hrGpsFilter && hrGpsFilter !== 'all') {
              if (hrGpsFilter === 'high') filtered = filtered.filter(a => a.gpsScore >= 3.51);
              if (hrGpsFilter === 'medium') filtered = filtered.filter(a => a.gpsScore >= 2.51 && a.gpsScore < 3.51);
              if (hrGpsFilter === 'low') filtered = filtered.filter(a => a.gpsScore > 0 && a.gpsScore < 2.51);
              if (hrGpsFilter === 'none') filtered = filtered.filter(a => !a.gpsScore || a.gpsScore === 0);
            }
            
            // Search filter
            if (hrSearch) {
              const s = hrSearch.toLowerCase();
              filtered = filtered.filter(a => 
                (a.employeeName || '').toLowerCase().includes(s) ||
                (a.formData?.employee || '').toLowerCase().includes(s) ||
                (a.formData?.manager || '').toLowerCase().includes(s) ||
                (a.formData?.position || '').toLowerCase().includes(s)
              );
            }
            
            filtered.sort((a, b) => new Date(b.updatedAt || b.createdAt || 0) - new Date(a.updatedAt || a.createdAt || 0));
            
            // Get unique managers and locations for filter dropdowns
            const uniqueManagers = [...new Set(allCompanyAppraisals.map(a => a.formData?.manager).filter(Boolean))].sort();
            const uniqueLocations = [...new Set(allCompanyAppraisals.map(a => a.formData?.location || a.location).filter(Boolean))].sort();
            
            // Stats
            const stats = {
              members: allCompanyMembers.length,
              appraisals: allCompanyAppraisals.length,
              completed: allCompanyAppraisals.filter(a => a.status === 'completed').length,
              reviews: allCompanyAppraisals.filter(a => a.type === 'review' || !a.type).length,
              self: allCompanyAppraisals.filter(a => a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection' || a.type === 'self_assessment_standalone' || a.type === 'self_pdf').length
            };
            
            const reviewsWithGPS = allCompanyAppraisals.filter(a => (a.type === 'review' || !a.type) && a.gpsScore > 0);
            const avgGPS = reviewsWithGPS.length > 0 
              ? (reviewsWithGPS.reduce((sum, a) => sum + a.gpsScore, 0) / reviewsWithGPS.length).toFixed(2)
              : '‚Äì';
            
            return React.createElement('div', { className: 'space-y-6 pb-12' },
              // Header
              React.createElement('div', { 
                className: 'rounded-2xl p-6 text-white',
                style: { background: 'linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)' }
              },
                React.createElement('h1', { className: 'text-2xl font-bold mb-2 flex items-center gap-3' },
                  React.createElement(Building2, { size: 28 }),
                  'üîê HR Admin Dashboard'
                ),
                React.createElement('p', { className: 'text-white/80 mb-4' },
                  getText(lang, 'Unternehmensweite √úbersicht aller Performance-Daten', 'Panoramica aziendale', 'Company-wide overview')
                ),
                React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-3' },
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.members),
                    React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Mitarbeiter', 'Collaboratori', 'Employees'))
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.reviews),
                    React.createElement('div', { className: 'text-xs text-white/70' }, 'Reviews')
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.self),
                    React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Selbstrefl.', 'Autorifless.', 'Self-Assess.'))
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, avgGPS),
                    React.createElement('div', { className: 'text-xs text-white/70' }, '√ò GPS')
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, `${stats.completed}/${stats.reviews}`),
                    React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Fertig', 'Completate', 'Done'))
                  )
                )
              ),
              
              // === HR SUB-TAB NAVIGATION ===
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-2 flex flex-wrap gap-2' },
                React.createElement('button', {
                  onClick: () => setHrSubTab('overview'),
                  className: 'flex-1 min-w-[140px] px-4 py-3 rounded-lg font-medium text-sm transition-all flex items-center justify-center gap-2 ' + 
                    (hrSubTab === 'overview' ? 'bg-purple-600 text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200')
                },
                  React.createElement(Building2, { size: 16 }),
                  getText(lang, '√úbersicht', 'Panoramica', 'Overview')
                ),
                React.createElement('button', {
                  onClick: () => setHrSubTab('calibration'),
                  className: 'flex-1 min-w-[140px] px-4 py-3 rounded-lg font-medium text-sm transition-all flex items-center justify-center gap-2 ' + 
                    (hrSubTab === 'calibration' ? 'bg-purple-600 text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200')
                },
                  'üîî',
                  getText(lang, 'Normalverteilung', 'Distribuzione', 'Distribution')
                ),
                React.createElement('button', {
                  onClick: () => setHrSubTab('rater-bias'),
                  className: 'flex-1 min-w-[140px] px-4 py-3 rounded-lg font-medium text-sm transition-all flex items-center justify-center gap-2 ' + 
                    (hrSubTab === 'rater-bias' ? 'bg-purple-600 text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200')
                },
                  '‚öñÔ∏è',
                  getText(lang, 'Rater-Bias', 'Bias Valutatore', 'Rater Bias')
                ),
                React.createElement('button', {
                  onClick: () => setHrSubTab('radar'),
                  className: 'flex-1 min-w-[140px] px-4 py-3 rounded-lg font-medium text-sm transition-all flex items-center justify-center gap-2 ' + 
                    (hrSubTab === 'radar' ? 'bg-purple-600 text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200')
                },
                  'üï∏Ô∏è',
                  getText(lang, 'Kompetenz-Radar', 'Radar Competenze', 'Competency Radar')
                ),
                React.createElement('button', {
                  onClick: () => setHrSubTab('goals-dashboard'),
                  className: 'flex-1 min-w-[140px] px-4 py-3 rounded-lg font-medium text-sm transition-all flex items-center justify-center gap-2 ' + 
                    (hrSubTab === 'goals-dashboard' ? 'bg-purple-600 text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200')
                },
                  'üìã',
                  getText(lang, 'Ziel-Dashboard', 'Dashboard Obiettivi', 'Goals Dashboard')
                ),
                // Versions Tab Button
                React.createElement('button', {
                  onClick: () => setHrSubTab('versions'),
                  className: 'flex-1 min-w-[140px] px-4 py-3 rounded-lg font-medium text-sm transition-all flex items-center justify-center gap-2 ' + 
                    (hrSubTab === 'versions' ? 'bg-amber-600 text-white shadow-md' : 'bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200')
                },
                  React.createElement(Clock, { size: 16 }),
                  getText(lang, 'Versionen', 'Versioni', 'Versions')
                ),
                // Backup/Restore Button
                React.createElement('button', {
                  onClick: () => setHrSubTab('backup'),
                  className: 'flex-1 min-w-[140px] px-4 py-3 rounded-lg font-medium text-sm transition-all flex items-center justify-center gap-2 ' + 
                    (hrSubTab === 'backup' ? 'bg-red-600 text-white shadow-md' : 'bg-red-50 text-red-600 hover:bg-red-100 border border-red-200')
                },
                  'üíæ',
                  getText(lang, 'Backup & Restore', 'Backup & Ripristino', 'Backup & Restore')
                )
              ),
              
              // === BACKUP & RESTORE TAB ===
              hrSubTab === 'backup' && React.createElement('div', { className: 'space-y-6' },
                // Warning Banner
                React.createElement('div', { className: 'bg-red-50 border-2 border-red-300 rounded-xl p-6' },
                  React.createElement('h3', { className: 'text-lg font-bold text-red-800 mb-2 flex items-center gap-2' },
                    '‚ö†Ô∏è Backup & Datenwiederherstellung'
                  ),
                  React.createElement('p', { className: 'text-red-700 mb-4' },
                    'Hier k√∂nnen Sie ein vollst√§ndiges Backup aller Daten erstellen oder aus einem fr√ºheren Backup wiederherstellen.'
                  ),
                  React.createElement('div', { className: 'flex flex-wrap gap-4' },
                    // Export Backup Button
                    React.createElement('button', {
                      onClick: exportFullBackup,
                      className: 'px-6 py-3 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 flex items-center gap-2'
                    },
                      React.createElement(Download, { size: 20 }),
                      getText(lang, 'üì¶ Vollst√§ndiges Backup erstellen', 'üì¶ Crea backup completo', 'üì¶ Create Full Backup')
                    ),
                    // Import/Restore Button
                    React.createElement('label', { className: 'px-6 py-3 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 flex items-center gap-2 cursor-pointer' },
                      React.createElement(Upload, { size: 20 }),
                      getText(lang, 'üì• Backup-Datei laden', 'üì• Carica file backup', 'üì• Load Backup File'),
                      React.createElement('input', {
                        type: 'file',
                        accept: '.json',
                        onChange: loadBackupFile,
                        className: 'hidden'
                      })
                    )
                  )
                ),
                
                // Restore Preview (wenn Backup geladen)
                restoreData && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                  React.createElement('h3', { className: 'text-lg font-bold text-slate-800 mb-4' },
                    'üìã Backup-Vorschau: ' + (restoreData.exportedAt ? new Date(restoreData.exportedAt).toLocaleString('de-DE') : 'Unbekannt')
                  ),
                  React.createElement('div', { className: 'grid md:grid-cols-4 gap-4 mb-6' },
                    React.createElement('div', { className: 'bg-blue-50 rounded-lg p-4 text-center' },
                      React.createElement('div', { className: 'text-2xl font-bold text-blue-700' }, restoreData.data?.teamAppraisals?.length || 0),
                      React.createElement('div', { className: 'text-sm text-blue-600' }, 'Beurteilungen')
                    ),
                    React.createElement('div', { className: 'bg-green-50 rounded-lg p-4 text-center' },
                      React.createElement('div', { className: 'text-2xl font-bold text-green-700' }, restoreData.data?.teamMembers?.length || 0),
                      React.createElement('div', { className: 'text-sm text-green-600' }, 'Mitarbeiter')
                    ),
                    React.createElement('div', { className: 'bg-purple-50 rounded-lg p-4 text-center' },
                      React.createElement('div', { className: 'text-2xl font-bold text-purple-700' }, restoreData.data?.salaryReviewData?.length || 0),
                      React.createElement('div', { className: 'text-sm text-purple-600' }, 'Salary Review')
                    ),
                    React.createElement('div', { className: 'bg-amber-50 rounded-lg p-4 text-center' },
                      React.createElement('div', { className: 'text-2xl font-bold text-amber-700' }, restoreData.data?.salaryReviewAccess?.length || 0),
                      React.createElement('div', { className: 'text-sm text-amber-600' }, 'Zugriffsrechte')
                    )
                  ),
                  
                  // Appraisals List
                  React.createElement('div', { className: 'border rounded-lg overflow-hidden mb-4' },
                    React.createElement('div', { className: 'bg-slate-100 px-4 py-2 font-semibold text-sm' }, 
                      'Beurteilungen im Backup (' + (restoreData.data?.teamAppraisals?.length || 0) + ')'
                    ),
                    React.createElement('div', { className: 'max-h-64 overflow-y-auto' },
                      (restoreData.data?.teamAppraisals || []).slice(0, 50).map((a, idx) => 
                        React.createElement('div', { 
                          key: a.id || idx, 
                          className: 'px-4 py-2 border-b text-sm flex justify-between items-center hover:bg-slate-50'
                        },
                          React.createElement('div', null,
                            React.createElement('span', { className: 'font-medium' }, a.employeeName || a.formData?.employee || 'Unbekannt'),
                            React.createElement('span', { className: 'text-slate-500 ml-2' }, '(' + (a.type || 'review') + ')'),
                            a.gpsScore > 0 && React.createElement('span', { className: 'ml-2 px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded text-xs' }, 'GPS: ' + a.gpsScore.toFixed(2))
                          ),
                          React.createElement('button', {
                            onClick: async () => {
                              if (confirm('Diese einzelne Beurteilung wiederherstellen?\n\n' + (a.employeeName || a.formData?.employee || 'Unbekannt'))) {
                                const success = await restoreAppraisalFromBackup(a);
                                if (success) showToast('Wiederhergestellt!', 'success');
                              }
                            },
                            className: 'px-3 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200'
                          }, 'Wiederherstellen')
                        )
                      ),
                      (restoreData.data?.teamAppraisals?.length || 0) > 50 && 
                        React.createElement('div', { className: 'px-4 py-2 text-center text-slate-500 text-sm' },
                          '... und ' + ((restoreData.data?.teamAppraisals?.length || 0) - 50) + ' weitere'
                        )
                    )
                  ),
                  
                  // Restore All Button
                  React.createElement('div', { className: 'flex gap-4' },
                    React.createElement('button', {
                      onClick: restoreAllFromBackup,
                      className: 'px-6 py-3 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700'
                    }, '‚ö†Ô∏è ALLE Beurteilungen wiederherstellen'),
                    React.createElement('button', {
                      onClick: () => { setRestoreData(null); setRestorePreview([]); },
                      className: 'px-6 py-3 bg-slate-200 text-slate-700 rounded-lg font-medium hover:bg-slate-300'
                    }, 'Abbrechen')
                  )
                ),
                
                // Current Data Overview
                React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                  React.createElement('h3', { className: 'text-lg font-bold text-slate-800 mb-4' },
                    'üìä Aktuelle Daten in Firebase'
                  ),
                  React.createElement('div', { className: 'grid md:grid-cols-4 gap-4' },
                    React.createElement('div', { className: 'bg-slate-50 rounded-lg p-4 text-center' },
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-700' }, allCompanyAppraisals.length),
                      React.createElement('div', { className: 'text-sm text-slate-600' }, 'Beurteilungen')
                    ),
                    React.createElement('div', { className: 'bg-slate-50 rounded-lg p-4 text-center' },
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-700' }, allCompanyMembers.length),
                      React.createElement('div', { className: 'text-sm text-slate-600' }, 'Mitarbeiter')
                    ),
                    React.createElement('div', { className: 'bg-slate-50 rounded-lg p-4 text-center' },
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-700' }, allCompanyAppraisals.filter(a => a.type === 'review' || !a.type).length),
                      React.createElement('div', { className: 'text-sm text-slate-600' }, 'Reviews')
                    ),
                    React.createElement('div', { className: 'bg-slate-50 rounded-lg p-4 text-center' },
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-700' }, allCompanyAppraisals.filter(a => a.type === 'goals').length),
                      React.createElement('div', { className: 'text-sm text-slate-600' }, 'Zielvereinbarungen')
                    )
                  )
                ),
                
                // === VERSIONSHISTORIE INITIALISIEREN ===
                React.createElement('div', { className: 'bg-blue-50 border-2 border-blue-300 rounded-xl p-6' },
                  React.createElement('h3', { className: 'text-lg font-bold text-blue-800 mb-2 flex items-center gap-2' },
                    'üìö Versionshistorie f√ºr bestehende Beurteilungen'
                  ),
                  React.createElement('p', { className: 'text-blue-700 mb-4' },
                    'Diese Funktion erstellt f√ºr alle bestehenden Beurteilungen eine initiale Version. So k√∂nnen F√ºhrungskr√§fte auf √§ltere Versionen zugreifen. Diese Aktion sollte EINMALIG ausgef√ºhrt werden.'
                  ),
                  React.createElement('div', { className: 'flex flex-wrap items-center gap-4' },
                    React.createElement('button', {
                      onClick: initializeVersionHistoryForAll,
                      className: 'px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center gap-2'
                    },
                      'üìö Versionshistorie f√ºr alle initialisieren'
                    ),
                    React.createElement('div', { className: 'text-sm text-blue-600' },
                      '(' + allCompanyAppraisals.filter(a => !a.versionHistory || a.versionHistory.length === 0).length + ' von ' + allCompanyAppraisals.length + ' ohne Versionshistorie)'
                    )
                  )
                ),
                
                // === BESITZER-REPARATUR TOOL (userId + managerId) ===
                React.createElement('div', { className: 'bg-emerald-50 border-2 border-emerald-400 rounded-xl p-6' },
                  React.createElement('h3', { className: 'text-lg font-bold text-emerald-800 mb-2 flex items-center gap-2' },
                    '‚úÖ Besitzer-Integrit√§tspr√ºfung (userId + managerId)'
                  ),
                  React.createElement('div', { className: 'bg-emerald-100 rounded-lg p-3 mb-4' },
                    React.createElement('p', { className: 'text-emerald-800 font-medium flex items-center gap-2' },
                      'üîÑ Automatische Reparatur ist AKTIV'
                    ),
                    React.createElement('p', { className: 'text-emerald-700 text-sm mt-1' },
                      'Die App pr√ºft automatisch alle Beurteilungen und korrigiert fehlende oder falsche userId UND managerId im Hintergrund. F√ºhrungskr√§fte sehen ihre Daten sofort wieder.'
                    )
                  ),
                  React.createElement('div', { className: 'bg-blue-50 rounded-lg p-3 mb-4 text-sm' },
                    React.createElement('p', { className: 'text-blue-800 font-medium' }, 'üìã Was wird gepr√ºft:'),
                    React.createElement('p', { className: 'text-blue-700 mt-1' }, 
                      '‚Ä¢ userId: Bestimmt welcher Manager das Dokument in seiner Ansicht sieht'),
                    React.createElement('p', { className: 'text-blue-700' }, 
                      '‚Ä¢ managerId: Referenz zum Manager f√ºr Analysen und Berichte'),
                    React.createElement('p', { className: 'text-blue-700 mt-2 font-medium' }, 
                      '‚ö†Ô∏è Pr√§vention: HR-Bearbeitungen √ºberschreiben den Besitzer nicht mehr!')
                  ),
                  React.createElement('div', { className: 'flex flex-wrap items-center gap-4' },
                    React.createElement('button', {
                      onClick: repairManagerIds,
                      className: 'px-6 py-3 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 flex items-center gap-2'
                    },
                      'üìä Analyse & Bericht anzeigen'
                    ),
                    React.createElement('div', { className: 'text-sm text-emerald-600' },
                      '(' + allCompanyAppraisals.filter(a => {
                        const member = allCompanyMembers.find(m => m.id === a.employeeId);
                        if (!member) return false;
                        return a.userId !== member.userId || a.managerId !== member.userId;
                      }).length + ' mit falscher Zuordnung von ' + allCompanyAppraisals.length + ' gesamt)'
                    )
                  )
                ),
                
                // === LEGACY APPRAISALS COLLECTION SUCHE ===
                React.createElement('div', { className: 'bg-purple-50 border-2 border-purple-300 rounded-xl p-6' },
                  React.createElement('h3', { className: 'text-lg font-bold text-purple-800 mb-2 flex items-center gap-2' },
                    'üóÑÔ∏è Legacy Collection durchsuchen'
                  ),
                  React.createElement('p', { className: 'text-purple-700 mb-4' },
                    'Es existiert eine √§ltere Collection "appraisals" (neben der aktuellen "teamAppraisals"). Hier k√∂nnten noch alte Daten liegen, die m√∂glicherweise bei einer Migration verloren gegangen sind.'
                  ),
                  React.createElement('div', { className: 'flex flex-wrap items-center gap-4' },
                    React.createElement('button', {
                      onClick: async () => {
                        try {
                          const snapshot = await db.collection('appraisals').get();
                          const legacyData = [];
                          snapshot.forEach(doc => {
                            legacyData.push({ id: doc.id, ...doc.data() });
                          });
                          
                          if (legacyData.length === 0) {
                            showToast('Legacy-Collection ist leer. Daten in teamAppraisals.', 'info');
                          } else {
                            // Zeige gefundene Daten
                            const summary = legacyData.map(a => 
                              `‚Ä¢ ${a.employeeName || a.formData?.employee || 'Unbekannt'} (${a.type || 'review'}) - GPS: ${(a.gpsScore || 0).toFixed(2)}`
                            ).join('\n');
                            
                            const action = confirm(
                              `üóÑÔ∏è LEGACY DATEN GEFUNDEN!\n\n` +
                              `${legacyData.length} Eintr√§ge in der alten Collection:\n\n` +
                              `${summary.substring(0, 1500)}${summary.length > 1500 ? '\n... und weitere' : ''}\n\n` +
                              `M√∂chten Sie diese Daten als Backup-JSON exportieren?`
                            );
                            
                            if (action) {
                              const exportData = {
                                exportedAt: new Date().toISOString(),
                                source: 'legacy_appraisals_collection',
                                count: legacyData.length,
                                data: legacyData
                              };
                              const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                              const url = URL.createObjectURL(blob);
                              const a = document.createElement('a');
                              a.href = url;
                              a.download = `legacy_appraisals_backup_${new Date().toISOString().slice(0,10)}.json`;
                              a.click();
                              URL.revokeObjectURL(url);
                              showToast('Legacy-Daten exportiert', 'success');
                            }
                          }
                        } catch (err) {
                          console.error('Legacy search error:', err);
                          showToast('Fehler beim Durchsuchen', 'error');
                        }
                      },
                      className: 'px-6 py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 flex items-center gap-2'
                    },
                      'üîç Legacy "appraisals" Collection durchsuchen'
                    )
                  )
                )
              ),
              
              // === CONTENT BASED ON SUB-TAB ===
              hrSubTab === 'overview' && React.createElement(React.Fragment, null,
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                React.createElement('h3', { className: 'text-lg font-bold text-purple-800 mb-4 flex items-center gap-2' },
                  React.createElement(TrendingUp, { size: 20 }),
                  getText(lang, 'üìä Analytics & Verteilung', 'üìä Analytics e Distribuzione', 'üìä Analytics & Distribution')
                ),
                React.createElement('div', { className: 'grid md:grid-cols-3 gap-6' },
                  
                  // GPS Verteilung
                  (() => {
                    const gpsDistribution = {
                      outstanding: reviewsWithGPS.filter(a => a.gpsScore >= 4.51).length,
                      exceeds: reviewsWithGPS.filter(a => a.gpsScore >= 3.51 && a.gpsScore < 4.51).length,
                      meets: reviewsWithGPS.filter(a => a.gpsScore >= 2.51 && a.gpsScore < 3.51).length,
                      needs: reviewsWithGPS.filter(a => a.gpsScore >= 1.51 && a.gpsScore < 2.51).length,
                      doesNot: reviewsWithGPS.filter(a => a.gpsScore < 1.51).length
                    };
                    const total = reviewsWithGPS.length || 1;
                    
                    return React.createElement('div', { className: 'space-y-3' },
                      React.createElement('h4', { className: 'font-semibold text-slate-700 text-sm' }, 
                        getText(lang, 'GPS Verteilung', 'Distribuzione GPS', 'GPS Distribution')
                      ),
                      // Outstanding (5)
                      React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs w-20 text-slate-600' }, '5 Outstanding'),
                        React.createElement('div', { className: 'flex-1 h-4 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: 'h-full bg-green-500 rounded-full transition-all',
                            style: { width: `${(gpsDistribution.outstanding / total) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs w-8 text-right font-medium' }, gpsDistribution.outstanding)
                      ),
                      // Exceeds (4)
                      React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs w-20 text-slate-600' }, '4 Exceeds'),
                        React.createElement('div', { className: 'flex-1 h-4 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: 'h-full bg-emerald-500 rounded-full transition-all',
                            style: { width: `${(gpsDistribution.exceeds / total) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs w-8 text-right font-medium' }, gpsDistribution.exceeds)
                      ),
                      // Meets (3)
                      React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs w-20 text-slate-600' }, '3 Meets'),
                        React.createElement('div', { className: 'flex-1 h-4 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: 'h-full bg-blue-500 rounded-full transition-all',
                            style: { width: `${(gpsDistribution.meets / total) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs w-8 text-right font-medium' }, gpsDistribution.meets)
                      ),
                      // Needs Improvement (2)
                      React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs w-20 text-slate-600' }, '2 Needs Imp.'),
                        React.createElement('div', { className: 'flex-1 h-4 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: 'h-full bg-orange-500 rounded-full transition-all',
                            style: { width: `${(gpsDistribution.needs / total) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs w-8 text-right font-medium' }, gpsDistribution.needs)
                      ),
                      // Does Not Meet (1)
                      React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs w-20 text-slate-600' }, '1 Does Not'),
                        React.createElement('div', { className: 'flex-1 h-4 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: 'h-full bg-red-500 rounded-full transition-all',
                            style: { width: `${(gpsDistribution.doesNot / total) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs w-8 text-right font-medium' }, gpsDistribution.doesNot)
                      )
                    );
                  })(),
                  
                  // Fortschritts-√úbersicht
                  (() => {
                    const completionRate = stats.appraisals > 0 ? ((stats.completed / stats.appraisals) * 100).toFixed(0) : 0;
                    const selfRate = stats.members > 0 ? ((stats.self / stats.members) * 100).toFixed(0) : 0;
                    const reviewRate = stats.members > 0 ? ((stats.reviews / stats.members) * 100).toFixed(0) : 0;
                    
                    return React.createElement('div', { className: 'space-y-3' },
                      React.createElement('h4', { className: 'font-semibold text-slate-700 text-sm' }, 
                        getText(lang, 'Fortschritt', 'Progresso', 'Progress')
                      ),
                      // Completion Rate Ring
                      React.createElement('div', { className: 'flex items-center gap-4' },
                        React.createElement('div', { 
                          className: 'relative w-20 h-20',
                          style: {
                            background: `conic-gradient(#7c3aed ${completionRate}%, #e2e8f0 ${completionRate}%)`,
                            borderRadius: '50%'
                          }
                        },
                          React.createElement('div', { 
                            className: 'absolute inset-2 bg-white rounded-full flex items-center justify-center'
                          },
                            React.createElement('span', { className: 'text-lg font-bold text-purple-700' }, completionRate + '%')
                          )
                        ),
                        React.createElement('div', null,
                          React.createElement('p', { className: 'font-semibold text-slate-800' }, 
                            getText(lang, 'Abschlussrate', 'Tasso completamento', 'Completion Rate')
                          ),
                          React.createElement('p', { className: 'text-xs text-slate-500' }, 
                            `${stats.completed}/${stats.appraisals} ${getText(lang, 'abgeschlossen', 'completate', 'completed')}`
                          )
                        )
                      ),
                      React.createElement('div', { className: 'grid grid-cols-2 gap-2 text-xs' },
                        React.createElement('div', { className: 'bg-purple-50 p-2 rounded-lg text-center' },
                          React.createElement('div', { className: 'font-bold text-purple-700' }, selfRate + '%'),
                          React.createElement('div', { className: 'text-purple-600' }, getText(lang, 'Selbstrefl.', 'Autorifless.', 'Self-Assess.'))
                        ),
                        React.createElement('div', { className: 'bg-blue-50 p-2 rounded-lg text-center' },
                          React.createElement('div', { className: 'font-bold text-blue-700' }, reviewRate + '%'),
                          React.createElement('div', { className: 'text-blue-600' }, 'Reviews')
                        )
                      )
                    );
                  })(),
                  
                  // Top/Bottom Performer Hinweise
                  (() => {
                    const sortedByGPS = [...reviewsWithGPS].sort((a, b) => b.gpsScore - a.gpsScore);
                    // FIX: Nur echte Top Performer (GPS >= 3.0) anzeigen
                    const topPerformers = sortedByGPS.filter(p => p.gpsScore >= 3.0).slice(0, 3);
                    const needsAttention = reviewsWithGPS.filter(a => a.gpsScore < 2.5);
                    
                    return React.createElement('div', { className: 'space-y-3' },
                      React.createElement('h4', { className: 'font-semibold text-slate-700 text-sm' }, 
                        getText(lang, 'Highlights', 'Highlights', 'Highlights')
                      ),
                      
                      // Top Performers (nur GPS >= 3.0)
                      React.createElement('div', { className: 'bg-green-50 rounded-lg p-3' },
                        React.createElement('p', { className: 'text-xs font-semibold text-green-700 mb-2' }, 
                          'üåü ' + getText(lang, 'Top Performer (GPS ‚â•3)', 'Top Performer (GPS ‚â•3)', 'Top Performers (GPS ‚â•3)')
                        ),
                        topPerformers.length > 0 
                          ? React.createElement('div', { className: 'space-y-1' },
                              topPerformers.map((p, i) => 
                                React.createElement('div', { key: i, className: 'flex justify-between text-xs' },
                                  React.createElement('span', { className: 'text-green-800 truncate max-w-[120px]' }, 
                                    p.employeeName || p.formData?.employee || 'N/A'
                                  ),
                                  React.createElement('span', { className: 'font-bold text-green-600' }, 
                                    p.gpsScore?.toFixed(2)
                                  )
                                )
                              )
                            )
                          : React.createElement('p', { className: 'text-xs text-green-600 italic' }, 
                              getText(lang, 'Noch keine (alle unter GPS 3.0)', 'Nessuno (tutti sotto GPS 3.0)', 'None yet (all below GPS 3.0)')
                            )
                      ),
                      
                      // Attention Needed
                      needsAttention.length > 0 && 
                        React.createElement('div', { className: 'bg-amber-50 rounded-lg p-3' },
                          React.createElement('p', { className: 'text-xs font-semibold text-amber-700 mb-2' }, 
                            '‚ö†Ô∏è ' + getText(lang, 'Achtung erforderlich', 'Attenzione richiesta', 'Attention Needed')
                          ),
                          React.createElement('p', { className: 'text-xs text-amber-600' },
                            needsAttention.length + ' ' +
                            getText(lang, 'Mitarbeiter unter GPS 2.5', 'collaboratori sotto GPS 2.5', 'employees below GPS 2.5')
                          )
                        )
                    );
                  })()
                )
              )
              ), // Ende hrSubTab === 'overview'
              
              // === VERSIONS TAB: ALLE VERSIONEN ALLER BEURTEILUNGEN ===
              hrSubTab === 'versions' && React.createElement('div', { className: 'space-y-6' },
                
                // Header Card
                React.createElement('div', { 
                  className: 'rounded-2xl p-6 text-white',
                  style: { background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)' }
                },
                  React.createElement('h2', { className: 'text-2xl font-bold mb-2 flex items-center gap-3' },
                    React.createElement(Clock, { size: 28 }),
                    getText(lang, 'Versionshistorie aller Beurteilungen', 'Storico versioni', 'Version History')
                  ),
                  React.createElement('p', { className: 'text-white/80' },
                    getText(lang, 
                      'Hier sehen Sie alle gespeicherten Versionen jedes Beurteilungsbogens. Sie k√∂nnen Details einsehen und als JSON exportieren. Die Wiederherstellung erfolgt durch die F√ºhrungskraft direkt im Beurteilungsbogen.', 
                      'Qui puoi vedere tutte le versioni salvate di ogni scheda di valutazione.',
                      'Here you can see all saved versions of each appraisal form.'
                    )
                  ),
                  // Safety Notice
                  React.createElement('div', { className: 'mt-3 bg-white/10 rounded-lg px-4 py-2 text-sm' },
                    'üîí ' + getText(lang, 
                      'Nur Ansicht & Export - Wiederherstellung erfolgt durch FK im Beurteilungsbogen', 
                      'Solo visualizzazione - ripristino dal modulo',
                      'View & export only - restore via appraisal form'
                    )
                  ),
                  React.createElement('div', { className: 'flex gap-4 mt-4' },
                    React.createElement('div', { className: 'bg-white/20 rounded-lg px-4 py-2' },
                      React.createElement('div', { className: 'text-2xl font-bold' }, 
                        allCompanyAppraisals.filter(a => a.versionHistory && a.versionHistory.length > 0).length
                      ),
                      React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Mit Versionen', 'Con versioni', 'With versions'))
                    ),
                    React.createElement('div', { className: 'bg-white/20 rounded-lg px-4 py-2' },
                      React.createElement('div', { className: 'text-2xl font-bold' }, 
                        allCompanyAppraisals.reduce((sum, a) => sum + (a.versionHistory?.length || 0), 0)
                      ),
                      React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Gesamte Versionen', 'Totale versioni', 'Total versions'))
                    )
                  )
                ),
                
                // Appraisals List with Versions
                React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border overflow-hidden' },
                  React.createElement('div', { className: 'bg-slate-100 px-6 py-3 border-b flex items-center justify-between' },
                    React.createElement('h3', { className: 'font-semibold text-slate-700' }, 
                      getText(lang, 'Beurteilungsb√∂gen mit Versionshistorie', 'Schede con storico versioni', 'Appraisals with version history')
                    ),
                    React.createElement('span', { className: 'text-sm text-slate-500' },
                      allCompanyAppraisals.filter(a => (a.type === 'review' || !a.type)).length + ' ' + getText(lang, 'Beurteilungen', 'valutazioni', 'appraisals')
                    )
                  ),
                  React.createElement('div', { className: 'divide-y max-h-[70vh] overflow-y-auto' },
                    allCompanyAppraisals
                      .filter(a => a.type === 'review' || !a.type)
                      .sort((a, b) => (b.updatedAt || b.createdAt || '').localeCompare(a.updatedAt || a.createdAt || ''))
                      .map((appraisal, idx) => {
                        const versions = appraisal.versionHistory || [];
                        const employeeName = appraisal.employeeName || appraisal.formData?.employee || 'Unbekannt';
                        const lastUpdate = appraisal.updatedAt || appraisal.createdAt;
                        const isExpanded = expandedVersionAppraisal === appraisal.id;
                        
                        return React.createElement('div', { key: appraisal.id || idx, className: 'border-b last:border-b-0' },
                          // Appraisal Header Row
                          React.createElement('div', { 
                            className: 'px-6 py-4 flex items-center justify-between hover:bg-slate-50 cursor-pointer',
                            onClick: () => setExpandedVersionAppraisal(isExpanded ? null : appraisal.id)
                          },
                            React.createElement('div', { className: 'flex items-center gap-4' },
                              React.createElement('div', { 
                                className: 'w-10 h-10 rounded-full flex items-center justify-center text-white font-bold',
                                style: { backgroundColor: '#243186' }
                              }, employeeName.charAt(0).toUpperCase()),
                              React.createElement('div', null,
                                React.createElement('div', { className: 'font-semibold text-slate-800' }, employeeName),
                                React.createElement('div', { className: 'text-sm text-slate-500 flex items-center gap-2' },
                                  appraisal.managerName && React.createElement('span', null, 'üë§ ' + appraisal.managerName),
                                  lastUpdate && React.createElement('span', null, 'üìÖ ' + new Date(lastUpdate).toLocaleDateString('de-DE'))
                                )
                              )
                            ),
                            React.createElement('div', { className: 'flex items-center gap-4' },
                              // GPS Score
                              appraisal.gpsScore > 0 && React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { 
                                  className: 'px-3 py-1 rounded-lg font-bold text-sm ' + 
                                    (appraisal.gpsScore >= 4 ? 'bg-emerald-100 text-emerald-700' : 
                                     appraisal.gpsScore >= 3 ? 'bg-blue-100 text-blue-700' : 
                                     'bg-amber-100 text-amber-700')
                                }, 'GPS: ' + appraisal.gpsScore.toFixed(2))
                              ),
                              // Version Count Badge
                              React.createElement('div', { 
                                className: versions.length > 0 
                                  ? 'px-3 py-1 bg-amber-100 text-amber-700 rounded-lg text-sm font-medium flex items-center gap-1' 
                                  : 'px-3 py-1 bg-slate-100 text-slate-500 rounded-lg text-sm'
                              },
                                React.createElement(Clock, { size: 14 }),
                                versions.length > 0 
                                  ? versions.length + ' ' + getText(lang, 'Version(en)', 'versione/i', 'version(s)')
                                  : getText(lang, 'Keine Versionen', 'Nessuna versione', 'No versions')
                              ),
                              // Expand Arrow
                              React.createElement('div', { 
                                className: 'text-slate-400 transition-transform ' + (isExpanded ? 'rotate-180' : '')
                              },
                                React.createElement(ChevronDown, { size: 20 })
                              )
                            )
                          ),
                          
                          // Expanded Version List
                          isExpanded && React.createElement('div', { 
                            className: 'bg-amber-50 border-t border-amber-200 px-6 py-4'
                          },
                            versions.length === 0 
                              ? React.createElement('div', { className: 'text-center py-6 text-slate-500' },
                                  React.createElement(Clock, { size: 32, className: 'mx-auto mb-2 text-slate-300' }),
                                  React.createElement('p', null, getText(lang, 'Noch keine Versionen gespeichert', 'Nessuna versione salvata', 'No versions saved yet')),
                                  React.createElement('p', { className: 'text-sm mt-1' }, 
                                    getText(lang, 'Versionen werden beim Speichern automatisch erstellt.', 'Le versioni vengono create automaticamente al salvataggio.', 'Versions are created automatically when saving.')
                                  )
                                )
                              : React.createElement('div', { className: 'space-y-2' },
                                  React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                                    React.createElement('h4', { className: 'font-semibold text-amber-800' }, 
                                      'üìö ' + getText(lang, 'Gespeicherte Versionen', 'Versioni salvate', 'Saved Versions')
                                    ),
                                    React.createElement('span', { className: 'text-sm text-amber-600' },
                                      getText(lang, 'Neueste zuerst', 'Pi√π recente prima', 'Newest first')
                                    )
                                  ),
                                  versions.slice().reverse().map((version, vIdx) => 
                                    React.createElement('div', { 
                                      key: vIdx,
                                      className: 'bg-white rounded-lg border border-amber-200 p-4 hover:shadow-md transition-all'
                                    },
                                      React.createElement('div', { className: 'flex items-center justify-between' },
                                        React.createElement('div', { className: 'flex items-center gap-4' },
                                          // Date/Time
                                          React.createElement('div', { className: 'text-center bg-amber-100 rounded-lg px-3 py-2' },
                                            React.createElement('div', { className: 'font-bold text-amber-800' },
                                              new Date(version.savedAt).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: '2-digit' })
                                            ),
                                            React.createElement('div', { className: 'text-xs text-amber-600' },
                                              new Date(version.savedAt).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })
                                            )
                                          ),
                                          // Scores
                                          React.createElement('div', { className: 'flex flex-wrap gap-2' },
                                            React.createElement('span', { 
                                              className: 'px-2 py-1 rounded text-sm font-semibold ' +
                                                ((version.gpsScore || 0) >= 4 ? 'bg-emerald-100 text-emerald-700' :
                                                 (version.gpsScore || 0) >= 3 ? 'bg-blue-100 text-blue-700' :
                                                 'bg-amber-100 text-amber-700')
                                            }, 'GPS: ' + (version.gpsScore || 0).toFixed(2)),
                                            version.wasScore > 0 && React.createElement('span', { className: 'px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs' },
                                              'WAS: ' + version.wasScore.toFixed(2)
                                            ),
                                            version.wieCoreScore > 0 && React.createElement('span', { className: 'px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs' },
                                              'WIE: ' + version.wieCoreScore.toFixed(2)
                                            ),
                                            version.goals && version.goals.length > 0 && React.createElement('span', { className: 'px-2 py-1 bg-blue-100 text-blue-600 rounded text-xs' },
                                              version.goals.length + ' ' + getText(lang, 'Ziele', 'obiettivi', 'goals')
                                            ),
                                            Object.keys(version.coreScores || {}).length > 0 && React.createElement('span', { className: 'px-2 py-1 bg-purple-100 text-purple-600 rounded text-xs' },
                                              Object.keys(version.coreScores).length + ' ' + getText(lang, 'Kompetenzen', 'competenze', 'competencies')
                                            )
                                          )
                                        ),
                                        // Action Buttons
                                        React.createElement('div', { className: 'flex items-center gap-2' },
                                          React.createElement('button', {
                                            onClick: (e) => {
                                              e.stopPropagation();
                                              // Open detail modal
                                              setHrVersionDetailModal({
                                                version: version,
                                                employeeName: employeeName,
                                                appraisalId: appraisal.id,
                                                managerName: appraisal.managerName
                                              });
                                            },
                                            className: 'px-3 py-2 bg-slate-100 text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-200 flex items-center gap-1'
                                          },
                                            React.createElement(Eye, { size: 14 }),
                                            getText(lang, 'Details', 'Dettagli', 'Details')
                                          ),
                                          // Export einzelne Version als JSON
                                          React.createElement('button', {
                                            onClick: (e) => {
                                              e.stopPropagation();
                                              const exportData = {
                                                exportedAt: new Date().toISOString(),
                                                employeeName: employeeName,
                                                appraisalId: appraisal.id,
                                                versionDate: version.savedAt,
                                                version: version
                                              };
                                              const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                                              const url = URL.createObjectURL(blob);
                                              const a = document.createElement('a');
                                              a.href = url;
                                              a.download = `version_${employeeName.replace(/\s+/g, '_')}_${new Date(version.savedAt).toISOString().slice(0,10)}.json`;
                                              a.click();
                                              URL.revokeObjectURL(url);
                                            },
                                            className: 'px-3 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200 flex items-center gap-1'
                                          },
                                            React.createElement(Download, { size: 14 }),
                                            'JSON'
                                          )
                                        )
                                      ),
                                      // Optional: Show if initialized
                                      version.initializedBy && React.createElement('div', { className: 'mt-2 text-xs text-slate-500 italic' },
                                        '‚ö° ' + version.initializedBy
                                      )
                                    )
                                  )
                                )
                          )
                        );
                      })
                  )
                )
              ), // Ende hrSubTab === 'versions'
              
              // =====================================================
              // VERSION DETAIL MODAL - Zeigt alle Details inkl. Kommentare
              // =====================================================
              hrVersionDetailModal && React.createElement('div', {
                className: 'fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm',
                onClick: () => setHrVersionDetailModal(null)
              },
                React.createElement('div', {
                  className: 'bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col',
                  onClick: (e) => e.stopPropagation()
                },
                  // Modal Header
                  React.createElement('div', { 
                    className: 'p-6 text-white',
                    style: { background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)' }
                  },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                      React.createElement('div', null,
                        React.createElement('h2', { className: 'text-xl font-bold flex items-center gap-2' },
                          React.createElement(Clock, { size: 24 }),
                          getText(lang, 'Versions-Details', 'Dettagli versione', 'Version Details')
                        ),
                        React.createElement('p', { className: 'text-white/80 mt-1' },
                          hrVersionDetailModal.employeeName + ' ‚Ä¢ ' +
                          new Date(hrVersionDetailModal.version.savedAt).toLocaleString('de-DE', {
                            weekday: 'long', day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit'
                          })
                        ),
                        hrVersionDetailModal.managerName && React.createElement('p', { className: 'text-white/60 text-sm mt-1' },
                          'üë§ FK: ' + hrVersionDetailModal.managerName
                        )
                      ),
                      React.createElement('button', {
                        onClick: () => setHrVersionDetailModal(null),
                        className: 'p-2 rounded-full bg-white/20 hover:bg-white/30'
                      }, React.createElement(X, { size: 24 }))
                    ),
                    // Score Cards
                    React.createElement('div', { className: 'flex gap-3 mt-4' },
                      React.createElement('div', { className: 'bg-white/20 rounded-lg px-4 py-2' },
                        React.createElement('div', { className: 'text-2xl font-bold' }, 
                          (hrVersionDetailModal.version.gpsScore || 0).toFixed(2)
                        ),
                        React.createElement('div', { className: 'text-xs text-white/70' }, 'GPS')
                      ),
                      React.createElement('div', { className: 'bg-white/20 rounded-lg px-4 py-2' },
                        React.createElement('div', { className: 'text-2xl font-bold' }, 
                          (hrVersionDetailModal.version.wasScore || 0).toFixed(2)
                        ),
                        React.createElement('div', { className: 'text-xs text-white/70' }, 'WAS')
                      ),
                      React.createElement('div', { className: 'bg-white/20 rounded-lg px-4 py-2' },
                        React.createElement('div', { className: 'text-2xl font-bold' }, 
                          (hrVersionDetailModal.version.wieCoreScore || 0).toFixed(2)
                        ),
                        React.createElement('div', { className: 'text-xs text-white/70' }, 'WIE Core')
                      ),
                      hrVersionDetailModal.version.wieLeaderScore > 0 && React.createElement('div', { className: 'bg-white/20 rounded-lg px-4 py-2' },
                        React.createElement('div', { className: 'text-2xl font-bold' }, 
                          hrVersionDetailModal.version.wieLeaderScore.toFixed(2)
                        ),
                        React.createElement('div', { className: 'text-xs text-white/70' }, 'WIE Leader')
                      )
                    )
                  ),
                  
                  // Modal Content - Scrollable
                  React.createElement('div', { className: 'flex-1 overflow-y-auto p-6 space-y-6' },
                    
                    // === ZIELE SECTION ===
                    React.createElement('div', { className: 'bg-blue-50 rounded-xl p-5' },
                      React.createElement('h3', { className: 'text-lg font-bold text-blue-800 mb-4 flex items-center gap-2' },
                        'üéØ ', getText(lang, 'Ziele', 'Obiettivi', 'Goals'),
                        React.createElement('span', { className: 'text-sm font-normal text-blue-600' },
                          '(' + (hrVersionDetailModal.version.goals || []).length + ')'
                        )
                      ),
                      (hrVersionDetailModal.version.goals || []).length === 0
                        ? React.createElement('p', { className: 'text-blue-600 italic' }, 
                            getText(lang, 'Keine Ziele in dieser Version', 'Nessun obiettivo', 'No goals')
                          )
                        : React.createElement('div', { className: 'space-y-3' },
                            (hrVersionDetailModal.version.goals || []).map((goal, gIdx) =>
                              React.createElement('div', { 
                                key: gIdx, 
                                className: 'bg-white rounded-lg p-4 border border-blue-200'
                              },
                                React.createElement('div', { className: 'flex items-start justify-between mb-2' },
                                  React.createElement('div', { className: 'font-semibold text-slate-800' },
                                    (gIdx + 1) + '. ' + (goal.name || 'Ohne Name')
                                  ),
                                  React.createElement('div', { className: 'flex gap-2' },
                                    React.createElement('span', { className: 'px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium' },
                                      getText(lang, 'Gewicht', 'Peso', 'Weight') + ': ' + (goal.weight || 0) + '%'
                                    ),
                                    React.createElement('span', { 
                                      className: 'px-2 py-1 rounded text-xs font-medium ' +
                                        ((goal.achievement || 0) >= 100 ? 'bg-emerald-100 text-emerald-700' :
                                         (goal.achievement || 0) >= 85 ? 'bg-blue-100 text-blue-700' :
                                         'bg-amber-100 text-amber-700')
                                    },
                                      getText(lang, 'Erreichung', 'Raggiungimento', 'Achievement') + ': ' + (goal.achievement || '?') + '%'
                                    )
                                  )
                                ),
                                goal.description && React.createElement('p', { className: 'text-sm text-slate-600 mt-2' },
                                  goal.description
                                ),
                                goal.comment && React.createElement('div', { className: 'mt-3 p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400' },
                                  React.createElement('div', { className: 'text-xs text-yellow-700 font-medium mb-1' }, 'üí¨ Kommentar:'),
                                  React.createElement('p', { className: 'text-sm text-yellow-800' }, goal.comment)
                                )
                              )
                            )
                          )
                    ),
                    
                    // === KERNKOMPETENZEN SECTION ===
                    React.createElement('div', { className: 'bg-purple-50 rounded-xl p-5' },
                      React.createElement('h3', { className: 'text-lg font-bold text-purple-800 mb-4 flex items-center gap-2' },
                        '‚≠ê ', getText(lang, 'Kernkompetenzen', 'Competenze chiave', 'Core Competencies'),
                        React.createElement('span', { className: 'text-sm font-normal text-purple-600' },
                          '(' + Object.keys(hrVersionDetailModal.version.coreScores || {}).length + ')'
                        )
                      ),
                      Object.keys(hrVersionDetailModal.version.coreScores || {}).length === 0
                        ? React.createElement('p', { className: 'text-purple-600 italic' }, 
                            getText(lang, 'Keine Kernkompetenzen bewertet', 'Nessuna competenza', 'No competencies rated')
                          )
                        : React.createElement('div', { className: 'space-y-3' },
                            Object.entries(hrVersionDetailModal.version.coreScores || {}).map(([compId, rating], compIdx) => {
                              // Try to find competency by ID first
                              let comp = window.CORE_COMPETENCIES_CALC?.find(c => c.id === compId);
                              // If not found and ID looks numeric, try to map by index
                              if (!comp && window.CORE_COMPETENCIES_CALC) {
                                // Try matching by index position
                                const allComps = window.CORE_COMPETENCIES_CALC;
                                if (compIdx < allComps.length) {
                                  comp = allComps[compIdx];
                                }
                              }
                              // Fallback: create a readable name
                              const displayName = comp ? (lang === 'it' ? comp.nameIt : comp.name) : 
                                `Kompetenz ${compIdx + 1}`;
                              const comment = (hrVersionDetailModal.version.coreComments || {})[compId] || '';
                              return React.createElement('div', { 
                                key: compId, 
                                className: 'bg-white rounded-lg p-4 border border-purple-200'
                              },
                                React.createElement('div', { className: 'flex items-center justify-between mb-2' },
                                  React.createElement('div', { className: 'font-semibold text-slate-800' },
                                    displayName
                                  ),
                                  React.createElement('div', { 
                                    className: 'px-3 py-1 rounded-lg text-sm font-bold ' +
                                      (rating >= 4 ? 'bg-emerald-100 text-emerald-700' :
                                       rating >= 3 ? 'bg-blue-100 text-blue-700' :
                                       rating >= 2 ? 'bg-amber-100 text-amber-700' :
                                       'bg-red-100 text-red-700')
                                  },
                                    'Level ' + rating
                                  )
                                ),
                                comment && React.createElement('div', { className: 'mt-2 p-3 bg-purple-100/50 rounded-lg border-l-4 border-purple-400' },
                                  React.createElement('div', { className: 'text-xs text-purple-700 font-medium mb-1' }, 'üí¨ Begr√ºndung:'),
                                  React.createElement('p', { className: 'text-sm text-purple-900 whitespace-pre-wrap' }, comment)
                                )
                              );
                            })
                          )
                    ),
                    
                    // === F√úHRUNGSKOMPETENZEN SECTION (wenn vorhanden) ===
                    Object.keys(hrVersionDetailModal.version.leaderScores || {}).length > 0 &&
                    React.createElement('div', { className: 'bg-indigo-50 rounded-xl p-5' },
                      React.createElement('h3', { className: 'text-lg font-bold text-indigo-800 mb-4 flex items-center gap-2' },
                        'üëë ', getText(lang, 'F√ºhrungskompetenzen', 'Competenze di leadership', 'Leadership Competencies'),
                        React.createElement('span', { className: 'text-sm font-normal text-indigo-600' },
                          '(' + Object.keys(hrVersionDetailModal.version.leaderScores || {}).length + ')'
                        )
                      ),
                      React.createElement('div', { className: 'space-y-3' },
                        Object.entries(hrVersionDetailModal.version.leaderScores || {}).map(([compId, rating], compIdx) => {
                          // Try to find competency by ID first
                          let comp = window.LEADER_COMPETENCIES_CALC?.find(c => c.id === compId);
                          // If not found and ID looks numeric, try to map by index
                          if (!comp && window.LEADER_COMPETENCIES_CALC) {
                            const allComps = window.LEADER_COMPETENCIES_CALC;
                            if (compIdx < allComps.length) {
                              comp = allComps[compIdx];
                            }
                          }
                          // Fallback: create a readable name
                          const displayName = comp ? (lang === 'it' ? comp.nameIt : comp.name) : 
                            `F√ºhrungskompetenz ${compIdx + 1}`;
                          const comment = (hrVersionDetailModal.version.leaderComments || {})[compId] || '';
                          return React.createElement('div', { 
                            key: compId, 
                            className: 'bg-white rounded-lg p-4 border border-indigo-200'
                          },
                            React.createElement('div', { className: 'flex items-center justify-between mb-2' },
                              React.createElement('div', { className: 'font-semibold text-slate-800' },
                                displayName
                              ),
                              React.createElement('div', { 
                                className: 'px-3 py-1 rounded-lg text-sm font-bold ' +
                                  (rating >= 4 ? 'bg-emerald-100 text-emerald-700' :
                                   rating >= 3 ? 'bg-blue-100 text-blue-700' :
                                   rating >= 2 ? 'bg-amber-100 text-amber-700' :
                                   'bg-red-100 text-red-700')
                              },
                                'Level ' + rating
                              )
                            ),
                            comment && React.createElement('div', { className: 'mt-2 p-3 bg-indigo-100/50 rounded-lg border-l-4 border-indigo-400' },
                              React.createElement('div', { className: 'text-xs text-indigo-700 font-medium mb-1' }, 'üí¨ Begr√ºndung:'),
                              React.createElement('p', { className: 'text-sm text-indigo-900 whitespace-pre-wrap' }, comment)
                            )
                          );
                        })
                      )
                    ),
                    
                    // === METADATA ===
                    React.createElement('div', { className: 'bg-slate-100 rounded-xl p-5' },
                      React.createElement('h3', { className: 'text-lg font-bold text-slate-700 mb-3 flex items-center gap-2' },
                        'üìã ', getText(lang, 'Metadaten', 'Metadati', 'Metadata')
                      ),
                      React.createElement('div', { className: 'grid grid-cols-2 gap-4 text-sm' },
                        React.createElement('div', null,
                          React.createElement('span', { className: 'text-slate-500' }, 'Status: '),
                          React.createElement('span', { className: 'font-medium' }, 
                            hrVersionDetailModal.version.savedStatus || 'Gespeichert'
                          )
                        ),
                        hrVersionDetailModal.version.initializedBy && React.createElement('div', null,
                          React.createElement('span', { className: 'text-slate-500' }, 'Initialisiert: '),
                          React.createElement('span', { className: 'font-medium' }, hrVersionDetailModal.version.initializedBy)
                        ),
                        hrVersionDetailModal.version.formData?.period && React.createElement('div', null,
                          React.createElement('span', { className: 'text-slate-500' }, 'Periode: '),
                          React.createElement('span', { className: 'font-medium' }, hrVersionDetailModal.version.formData.period)
                        ),
                        React.createElement('div', null,
                          React.createElement('span', { className: 'text-slate-500' }, 'Appraisal ID: '),
                          React.createElement('span', { className: 'font-mono text-xs' }, hrVersionDetailModal.appraisalId)
                        )
                      )
                    )
                  ),
                  
                  // Modal Footer
                  React.createElement('div', { className: 'p-4 bg-slate-50 border-t flex justify-end gap-3' },
                    React.createElement('button', {
                      onClick: () => {
                        const exportData = {
                          exportedAt: new Date().toISOString(),
                          employeeName: hrVersionDetailModal.employeeName,
                          appraisalId: hrVersionDetailModal.appraisalId,
                          versionDate: hrVersionDetailModal.version.savedAt,
                          version: hrVersionDetailModal.version
                        };
                        const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `version_${hrVersionDetailModal.employeeName.replace(/\s+/g, '_')}_${new Date(hrVersionDetailModal.version.savedAt).toISOString().slice(0,10)}.json`;
                        a.click();
                        URL.revokeObjectURL(url);
                      },
                      className: 'px-4 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 flex items-center gap-2'
                    },
                      React.createElement(Download, { size: 16 }),
                      getText(lang, 'Als JSON exportieren', 'Esporta JSON', 'Export as JSON')
                    ),
                    React.createElement('button', {
                      onClick: () => setHrVersionDetailModal(null),
                      className: 'px-4 py-2 bg-slate-200 text-slate-700 rounded-lg font-medium hover:bg-slate-300'
                    }, getText(lang, 'Schlie√üen', 'Chiudi', 'Close'))
                  )
                )
              ),
              
              
              // === CALIBRATION TAB: GAUSS'SCHE NORMALVERTEILUNG MIT ANALYSIS ENGINE ===
              hrSubTab === 'calibration' && React.createElement('div', { className: 'space-y-6' },
                
                // Header Card
                React.createElement('div', { 
                  className: 'rounded-2xl p-6 text-white',
                  style: { background: 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)' }
                },
                  React.createElement('h2', { className: 'text-2xl font-bold mb-2 flex items-center gap-3' },
                    React.createElement('span', { className: 'text-3xl' }, 'üîî'),
                    getText(lang, 'Kalibrierung: IST vs. SOLL (Normalverteilung)', 'Calibrazione: Effettivo vs. Atteso', 'Calibration: Actual vs. Expected')
                  ),
                  React.createElement('p', { className: 'text-white/80' },
                    getText(lang, 
                      'Vergleichen Sie die tats√§chliche Bewertungsverteilung mit der statistischen Normalverteilung. Die intelligente Analyse erkennt automatisch Verzerrungen und gibt psychologisch fundierte Coaching-Hinweise.', 
                      'Confronta la distribuzione effettiva con la normale statistica. L\'analisi intelligente rileva automaticamente i bias.',
                      'Compare actual rating distribution with statistical normal distribution. Smart analysis automatically detects biases and provides coaching nudges.'
                    )
                  )
                ),
                
                // Hauptinhalt
                (() => {
                  // ========== ANALYSIS ENGINE ==========
                  // Intelligente Analyse-Funktion f√ºr Verteilungs-Bias
                  const getDistributionAnalysis = (buckets, totalCount) => {
                    // Berechne IST und SOLL Summen f√ºr verschiedene Bereiche
                    const topIST = buckets.filter(b => b.gpsMin >= 4.0).reduce((sum, b) => sum + b.percent, 0);
                    const topSOLL = buckets.filter(b => b.gpsMin >= 4.0).reduce((sum, b) => sum + b.idealPercent, 0);
                    
                    const bottomIST = buckets.filter(b => b.gpsMax < 3.0).reduce((sum, b) => sum + b.percent, 0);
                    const bottomSOLL = buckets.filter(b => b.gpsMax < 3.0).reduce((sum, b) => sum + b.idealPercent, 0);
                    
                    const middleBucket = buckets.find(b => b.gpsMin >= 2.5 && b.gpsMax <= 3.5);
                    const middleIST = middleBucket ? middleBucket.percent : 0;
                    const middleSOLL = middleBucket ? middleBucket.idealPercent : 0;
                    
                    const analyses = [];
                    
                    // Minimum Sample Size f√ºr valide Analyse
                    if (totalCount < 3) {
                      return [{
                        type: 'info',
                        icon: '‚ÑπÔ∏è',
                        title: getText(lang, 'Zu wenige Datenpunkte', 'Dati insufficienti', 'Insufficient Data'),
                        message: getText(lang, 
                          'F√ºr eine aussagekr√§ftige Verteilungsanalyse werden mindestens 3 Bewertungen ben√∂tigt.',
                          'Sono necessarie almeno 3 valutazioni per un\'analisi significativa.',
                          'At least 3 ratings are needed for meaningful distribution analysis.'
                        ),
                        color: 'slate',
                        severity: 0
                      }];
                    }
                    
                    // Szenario A: Milde-Effekt (Leniency Bias)
                    const leniencyDiff = topIST - topSOLL;
                    if (leniencyDiff > 15) {
                      analyses.push({
                        type: 'warning',
                        icon: '‚ö†Ô∏è',
                        title: getText(lang, 'Milde-Tendenz erkannt (Leniency Bias)', 'Tendenza all\'indulgenza rilevata', 'Leniency Bias Detected'),
                        message: getText(lang, 
                          `Es befinden sich √ºberdurchschnittlich viele Mitarbeiter im Top-Bereich (GPS ‚â• 4.0): ${topIST.toFixed(0)}% statt erwarteter ${topSOLL.toFixed(0)}% (+${leniencyDiff.toFixed(0)} Prozentpunkte). Pr√ºfen Sie: Wurden die Ziele wirklich ambitioniert genug gesetzt oder vermeiden Sie unbewusst kritisches Feedback? (Gefahr: "Grade Inflation")`,
                          `Troppi collaboratori nell\'area top: ${topIST.toFixed(0)}% invece del ${topSOLL.toFixed(0)}% atteso.`,
                          `Too many employees in top range (GPS ‚â• 4.0): ${topIST.toFixed(0)}% instead of expected ${topSOLL.toFixed(0)}% (+${leniencyDiff.toFixed(0)} percentage points). Consider: Were goals ambitious enough? Are you unconsciously avoiding critical feedback? (Risk: "Grade Inflation")`
                        ),
                        color: 'orange',
                        severity: leniencyDiff > 25 ? 3 : 2,
                        metric: `+${leniencyDiff.toFixed(0)}%`,
                        metricLabel: getText(lang, '√ºber SOLL', 'sopra atteso', 'above expected')
                      });
                    }
                    
                    // Szenario B: H√§rte-Effekt (Severity Bias)
                    const severityDiff = bottomIST - bottomSOLL;
                    if (severityDiff > 15) {
                      analyses.push({
                        type: 'warning',
                        icon: '‚ö†Ô∏è',
                        title: getText(lang, 'Strenge-Tendenz erkannt (Severity Bias)', 'Tendenza alla severit√† rilevata', 'Severity Bias Detected'),
                        message: getText(lang, 
                          `Der Anteil an niedrigen Bewertungen (GPS < 3.0) ist sehr hoch: ${bottomIST.toFixed(0)}% statt erwarteter ${bottomSOLL.toFixed(0)}% (+${severityDiff.toFixed(0)} Prozentpunkte). Pr√ºfen Sie: Waren die Ziele realistisch erreichbar? Gab es externe Faktoren (Ressourcenmangel, Marktver√§nderungen)? (Gefahr: Demotivation)`,
                          `Troppi collaboratori con valutazioni basse: ${bottomIST.toFixed(0)}% invece del ${bottomSOLL.toFixed(0)}% atteso.`,
                          `High proportion of low ratings (GPS < 3.0): ${bottomIST.toFixed(0)}% instead of expected ${bottomSOLL.toFixed(0)}% (+${severityDiff.toFixed(0)} percentage points). Consider: Were goals realistically achievable? Were there external factors? (Risk: Demotivation)`
                        ),
                        color: 'red',
                        severity: severityDiff > 25 ? 3 : 2,
                        metric: `+${severityDiff.toFixed(0)}%`,
                        metricLabel: getText(lang, '√ºber SOLL', 'sopra atteso', 'above expected')
                      });
                    }
                    
                    // Szenario C: Tendenz zur Mitte (Central Tendency)
                    const centralDiff = middleIST - middleSOLL;
                    if (centralDiff > 20) {
                      analyses.push({
                        type: 'info',
                        icon: '‚ÑπÔ∏è',
                        title: getText(lang, 'Tendenz zur Mitte erkannt (Central Tendency)', 'Tendenza centrale rilevata', 'Central Tendency Detected'),
                        message: getText(lang, 
                          `Die Bewertungen konzentrieren sich stark auf den Durchschnitt (Note 3): ${middleIST.toFixed(0)}% statt erwarteter ${middleSOLL.toFixed(0)}% (+${centralDiff.toFixed(0)} Prozentpunkte). Trauen Sie sich, st√§rkere Differenzierungen vorzunehmen, um High-Performer klarer zu identifizieren und Entwicklungsbedarf sichtbar zu machen.`,
                          `Le valutazioni si concentrano fortemente sulla media: ${middleIST.toFixed(0)}% invece del ${middleSOLL.toFixed(0)}% atteso.`,
                          `Ratings cluster heavily around average (Grade 3): ${middleIST.toFixed(0)}% instead of expected ${middleSOLL.toFixed(0)}% (+${centralDiff.toFixed(0)} percentage points). Consider making stronger differentiations to clearly identify high performers and development needs.`
                        ),
                        color: 'blue',
                        severity: centralDiff > 30 ? 2 : 1,
                        metric: `+${centralDiff.toFixed(0)}%`,
                        metricLabel: getText(lang, '√ºber SOLL', 'sopra atteso', 'above expected')
                      });
                    }
                    
                    // Szenario D: Polarisierung (Bimodal Distribution)
                    const middleDeficit = middleSOLL - middleIST;
                    const extremesHigh = (topIST > topSOLL + 10) && (bottomIST > bottomSOLL + 10);
                    if (extremesHigh && middleDeficit > 15) {
                      analyses.push({
                        type: 'warning',
                        icon: '‚öñÔ∏è',
                        title: getText(lang, 'Polarisierung erkannt (Bimodale Verteilung)', 'Polarizzazione rilevata', 'Polarization Detected (Bimodal)'),
                        message: getText(lang, 
                          `Es gibt eine Spaltung in sehr gute und schwache Bewertungen, das Mittelfeld fehlt (${middleIST.toFixed(0)}% statt ${middleSOLL.toFixed(0)}%). Pr√ºfen Sie auf "In-Group vs. Out-Group" Effekte: Werden manche Mitarbeiter systematisch bevorzugt (Halo-Effekt) und andere benachteiligt (Horn-Effekt)?`,
                          `C\'√® una spaccatura tra valutazioni molto buone e deboli, manca la fascia media.`,
                          `There's a split between very good and poor ratings, the middle ground is missing (${middleIST.toFixed(0)}% instead of ${middleSOLL.toFixed(0)}%). Check for "In-Group vs. Out-Group" effects: Are some employees systematically favored (Halo Effect) while others are disadvantaged (Horn Effect)?`
                        ),
                        color: 'purple',
                        severity: 2,
                        metric: `-${middleDeficit.toFixed(0)}%`,
                        metricLabel: getText(lang, 'unter SOLL (Mitte)', 'sotto atteso (centro)', 'below expected (middle)')
                      });
                    }
                    
                    // Szenario E: Alles OK (Balanced)
                    if (analyses.length === 0) {
                      analyses.push({
                        type: 'success',
                        icon: '‚úÖ',
                        title: getText(lang, 'Ausgewogene Verteilung', 'Distribuzione equilibrata', 'Balanced Distribution'),
                        message: getText(lang, 
                          'Die Verteilung entspricht weitestgehend der statistischen Erwartung (Normalverteilung). Gute Differenzierung! Die F√ºhrungskr√§fte scheinen faire und kalibrierte Bewertungen vorzunehmen.',
                          'La distribuzione corrisponde ampiamente alle aspettative statistiche. Buona differenziazione!',
                          'Distribution largely matches statistical expectations (normal distribution). Good differentiation! Managers appear to be making fair and calibrated ratings.'
                        ),
                        color: 'green',
                        severity: 0
                      });
                    }
                    
                    // Sortiere nach Severity (h√∂chste zuerst)
                    return analyses.sort((a, b) => b.severity - a.severity);
                  };
                  
                  // ========== DATA PREPARATION ==========
                  const gpsToNote = (gps) => {
                    if (gps >= 4.51) return 5;
                    if (gps >= 3.51) return 4;
                    if (gps >= 2.51) return 3;
                    if (gps >= 1.51) return 2;
                    return 1;
                  };
                  
                  const allAppraisalsWithGPS = allCompanyAppraisals.filter(a => a.gpsScore && a.gpsScore > 0);
                  
                  const getTypeFilteredAppraisals = () => {
                    if (hrCalibrationTypeFilter === 'review') {
                      return allAppraisalsWithGPS.filter(a => a.type === 'review' || !a.type);
                    } else if (hrCalibrationTypeFilter === 'self') {
                      return allAppraisalsWithGPS.filter(a => 
                        a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection' || a.type === 'self_assessment_standalone'
                      );
                    } else {
                      return allAppraisalsWithGPS;
                    }
                  };
                  
                  const typeFilteredAppraisals = getTypeFilteredAppraisals();
                  
                  const getSelectedForCalibration = () => {
                    if (hrCalibrationSelectAll) {
                      return typeFilteredAppraisals;
                    } else {
                      return typeFilteredAppraisals.filter(a => hrCalibrationSelectedIds.has(a.id));
                    }
                  };
                  
                  const selectedAppraisals = getSelectedForCalibration();
                  
                  const toggleCalibrationAppraisal = (id) => {
                    const newSet = new Set(hrCalibrationSelectedIds);
                    if (newSet.has(id)) {
                      newSet.delete(id);
                    } else {
                      newSet.add(id);
                    }
                    setHrCalibrationSelectedIds(newSet);
                    setHrCalibrationSelectAll(false);
                  };
                  
                  const toggleCalibrationSelectAll = () => {
                    if (hrCalibrationSelectAll) {
                      setHrCalibrationSelectAll(false);
                      setHrCalibrationSelectedIds(new Set());
                    } else {
                      setHrCalibrationSelectAll(true);
                      setHrCalibrationSelectedIds(new Set(typeFilteredAppraisals.map(a => a.id)));
                    }
                  };
                  
                  // Bucket-Definitionen f√ºr GPS-Noten
                  const total = selectedAppraisals.length || 1;
                  const buckets = [
                    { 
                      label: getText(lang, 'Note 5 - Outstanding', 'Voto 5 - Eccezionale', 'Grade 5 - Outstanding'),
                      shortLabel: '5',
                      gpsRange: '4.51 - 5.00',
                      gpsMin: 4.51,
                      gpsMax: 5.00,
                      color: '#22c55e',
                      bgClass: 'bg-green-500',
                      lightBgClass: 'bg-green-50 border-green-200 text-green-800',
                      count: selectedAppraisals.filter(a => a.gpsScore >= 4.51).length,
                      get percent() { return (this.count / total) * 100; },
                      idealPercent: 5
                    },
                    { 
                      label: getText(lang, 'Note 4 - Exceeds Expectations', 'Voto 4 - Supera', 'Grade 4 - Exceeds'),
                      shortLabel: '4',
                      gpsRange: '3.51 - 4.50',
                      gpsMin: 3.51,
                      gpsMax: 4.50,
                      color: '#10b981',
                      bgClass: 'bg-emerald-500',
                      lightBgClass: 'bg-emerald-50 border-emerald-200 text-emerald-800',
                      count: selectedAppraisals.filter(a => a.gpsScore >= 3.51 && a.gpsScore < 4.51).length,
                      get percent() { return (this.count / total) * 100; },
                      idealPercent: 20
                    },
                    { 
                      label: getText(lang, 'Note 3 - Meets Expectations', 'Voto 3 - Soddisfa', 'Grade 3 - Meets'),
                      shortLabel: '3',
                      gpsRange: '2.51 - 3.50',
                      gpsMin: 2.51,
                      gpsMax: 3.50,
                      color: '#3b82f6',
                      bgClass: 'bg-blue-500',
                      lightBgClass: 'bg-blue-50 border-blue-200 text-blue-800',
                      count: selectedAppraisals.filter(a => a.gpsScore >= 2.51 && a.gpsScore < 3.51).length,
                      get percent() { return (this.count / total) * 100; },
                      idealPercent: 50
                    },
                    { 
                      label: getText(lang, 'Note 2 - Needs Improvement', 'Voto 2 - Da migliorare', 'Grade 2 - Needs Improvement'),
                      shortLabel: '2',
                      gpsRange: '1.51 - 2.50',
                      gpsMin: 1.51,
                      gpsMax: 2.50,
                      color: '#f97316',
                      bgClass: 'bg-orange-500',
                      lightBgClass: 'bg-orange-50 border-orange-200 text-orange-800',
                      count: selectedAppraisals.filter(a => a.gpsScore >= 1.51 && a.gpsScore < 2.51).length,
                      get percent() { return (this.count / total) * 100; },
                      idealPercent: 20
                    },
                    { 
                      label: getText(lang, 'Note 1 - Does Not Meet', 'Voto 1 - Non soddisfa', 'Grade 1 - Does Not Meet'),
                      shortLabel: '1',
                      gpsRange: '1.00 - 1.50',
                      gpsMin: 1.00,
                      gpsMax: 1.50,
                      color: '#ef4444',
                      bgClass: 'bg-red-500',
                      lightBgClass: 'bg-red-50 border-red-200 text-red-800',
                      count: selectedAppraisals.filter(a => a.gpsScore <= 1.50).length,
                      get percent() { return (this.count / total) * 100; },
                      idealPercent: 5
                    }
                  ];
                  
                  // Analyse durchf√ºhren
                  const analysisResults = getDistributionAnalysis(buckets, selectedAppraisals.length);
                  
                  const avgGPSSelected = selectedAppraisals.length > 0 
                    ? (selectedAppraisals.reduce((sum, a) => sum + a.gpsScore, 0) / selectedAppraisals.length).toFixed(2)
                    : '-';
                  
                  const maxPercent = Math.max(
                    ...buckets.map(b => b.percent),
                    ...buckets.map(b => b.idealPercent)
                  );
                  
                  // ========== RENDER ==========
                  return React.createElement('div', { className: 'space-y-6' },
                    
                    // === STEUERUNGSBEREICH ===
                    React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                        React.createElement('span', null, 'üéõÔ∏è'),
                        getText(lang, 'Datenauswahl', 'Selezione dati', 'Data Selection')
                      ),
                      
                      // Typ-Filter Buttons
                      React.createElement('div', { className: 'mb-6' },
                        React.createElement('p', { className: 'text-xs text-slate-500 mb-2 font-medium uppercase tracking-wide' },
                          getText(lang, 'Beurteilungstyp', 'Tipo valutazione', 'Appraisal Type')
                        ),
                        React.createElement('div', { className: 'flex flex-wrap gap-2' },
                          React.createElement('button', {
                            onClick: () => { setHrCalibrationTypeFilter('review'); setHrCalibrationSelectAll(true); },
                            className: 'px-5 py-2.5 rounded-xl text-sm font-semibold transition-all ' + 
                              (hrCalibrationTypeFilter === 'review' 
                                ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30' 
                                : 'bg-slate-100 text-slate-600 hover:bg-slate-200')
                          }, 'üìã ' + getText(lang, 'F√ºhrungskraft-Beurteilungen', 'Valutazioni manager', 'Manager Reviews')),
                          React.createElement('button', {
                            onClick: () => { setHrCalibrationTypeFilter('self'); setHrCalibrationSelectAll(true); },
                            className: 'px-5 py-2.5 rounded-xl text-sm font-semibold transition-all ' + 
                              (hrCalibrationTypeFilter === 'self' 
                                ? 'bg-gradient-to-r from-teal-500 to-teal-600 text-white shadow-lg shadow-teal-500/30' 
                                : 'bg-slate-100 text-slate-600 hover:bg-slate-200')
                          }, 'ü™û ' + getText(lang, 'Selbstreflexionen', 'Autoriflessioni', 'Self-Assessments')),
                          React.createElement('button', {
                            onClick: () => { setHrCalibrationTypeFilter('all'); setHrCalibrationSelectAll(true); },
                            className: 'px-5 py-2.5 rounded-xl text-sm font-semibold transition-all ' + 
                              (hrCalibrationTypeFilter === 'all' 
                                ? 'bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-lg shadow-purple-500/30' 
                                : 'bg-slate-100 text-slate-600 hover:bg-slate-200')
                          }, 'üìä ' + getText(lang, 'Alle', 'Tutti', 'All'))
                        )
                      ),
                      
                      // Mitarbeiter-Auswahl
                      React.createElement('div', { className: 'border-t pt-4' },
                        React.createElement('div', { className: 'flex flex-wrap gap-4 items-center mb-3' },
                          React.createElement('label', { className: 'flex items-center gap-2 cursor-pointer' },
                            React.createElement('input', { 
                              type: 'checkbox', 
                              checked: hrCalibrationSelectAll, 
                              onChange: toggleCalibrationSelectAll, 
                              className: 'w-5 h-5 accent-indigo-600 rounded' 
                            }),
                            React.createElement('span', { className: 'text-sm font-medium text-slate-700' }, 
                              getText(lang, 'Alle einbeziehen', 'Includi tutti', 'Include All')
                            )
                          ),
                          React.createElement('span', { className: 'text-sm px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full font-semibold' },
                            selectedAppraisals.length + ' / ' + typeFilteredAppraisals.length + ' ' + getText(lang, 'ausgew√§hlt', 'selezionati', 'selected')
                          )
                        ),
                        
                        // Einzelauswahl-Liste
                        !hrCalibrationSelectAll && React.createElement('div', { 
                          className: 'max-h-64 overflow-y-auto border border-slate-200 rounded-xl bg-slate-50 p-3'
                        },
                          React.createElement('p', { className: 'text-xs text-slate-500 mb-2' }, 
                            getText(lang, 'W√§hlen Sie einzelne Mitarbeiter:', 'Seleziona singoli collaboratori:', 'Select individual employees:')
                          ),
                          React.createElement('div', { className: 'space-y-1' },
                            typeFilteredAppraisals.map(a => {
                              const isReview = a.type === 'review' || !a.type;
                              const note = gpsToNote(a.gpsScore);
                              const noteColors = {
                                5: 'bg-green-100 text-green-700',
                                4: 'bg-emerald-100 text-emerald-700',
                                3: 'bg-blue-100 text-blue-700',
                                2: 'bg-orange-100 text-orange-700',
                                1: 'bg-red-100 text-red-700'
                              };
                              
                              return React.createElement('label', { 
                                key: a.id, 
                                className: 'flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white cursor-pointer transition-colors border border-transparent hover:border-slate-200'
                              },
                                React.createElement('input', { 
                                  type: 'checkbox', 
                                  checked: hrCalibrationSelectedIds.has(a.id), 
                                  onChange: () => toggleCalibrationAppraisal(a.id), 
                                  className: 'w-4 h-4 accent-indigo-600 rounded' 
                                }),
                                React.createElement('span', { 
                                  className: 'text-xs px-2 py-0.5 rounded font-medium ' + (isReview ? 'bg-blue-100 text-blue-700' : 'bg-teal-100 text-teal-700')
                                }, isReview ? 'üìã' : 'ü™û'),
                                React.createElement('span', { className: 'text-sm text-slate-700 flex-1 truncate font-medium' }, 
                                  a.employeeName || a.formData?.employee || 'N/A'
                                ),
                                React.createElement('span', { className: 'text-xs font-bold text-slate-500' }, 
                                  'GPS ' + (a.gpsScore?.toFixed(2) || '-')
                                ),
                                React.createElement('span', { 
                                  className: 'text-xs font-bold px-2 py-0.5 rounded ' + noteColors[note]
                                }, getText(lang, 'Note', 'Voto', 'Grade') + ' ' + note)
                              );
                            })
                          )
                        )
                      )
                    ),
                    
                    // === GPS-SKALA INFO ===
                    React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-4' },
                      React.createElement('h4', { className: 'font-semibold text-slate-700 mb-3 flex items-center gap-2 text-sm' },
                        React.createElement('span', null, 'üìè'),
                        getText(lang, 'GPS-Score zu Note Umrechnung', 'Conversione GPS-Voto', 'GPS Score to Grade Conversion')
                      ),
                      React.createElement('div', { className: 'grid grid-cols-5 gap-2 text-center' },
                        React.createElement('div', { className: 'bg-green-100 rounded-xl p-3' }, 
                          React.createElement('div', { className: 'text-xl font-bold text-green-700' }, '5'), 
                          React.createElement('div', { className: 'text-xs text-green-600 font-medium' }, '4.51 - 5.00')
                        ),
                        React.createElement('div', { className: 'bg-emerald-100 rounded-xl p-3' }, 
                          React.createElement('div', { className: 'text-xl font-bold text-emerald-700' }, '4'), 
                          React.createElement('div', { className: 'text-xs text-emerald-600 font-medium' }, '3.51 - 4.50')
                        ),
                        React.createElement('div', { className: 'bg-blue-100 rounded-xl p-3' }, 
                          React.createElement('div', { className: 'text-xl font-bold text-blue-700' }, '3'), 
                          React.createElement('div', { className: 'text-xs text-blue-600 font-medium' }, '2.51 - 3.50')
                        ),
                        React.createElement('div', { className: 'bg-orange-100 rounded-xl p-3' }, 
                          React.createElement('div', { className: 'text-xl font-bold text-orange-700' }, '2'), 
                          React.createElement('div', { className: 'text-xs text-orange-600 font-medium' }, '1.51 - 2.50')
                        ),
                        React.createElement('div', { className: 'bg-red-100 rounded-xl p-3' }, 
                          React.createElement('div', { className: 'text-xl font-bold text-red-700' }, '1'), 
                          React.createElement('div', { className: 'text-xs text-red-600 font-medium' }, '1.00 - 1.50')
                        )
                      )
                    ),
                    
                    // === KEINE DATEN WARNUNG ===
                    selectedAppraisals.length === 0 && React.createElement('div', { className: 'bg-slate-50 rounded-xl p-8 text-center border border-slate-200' },
                      React.createElement('span', { className: 'text-4xl mb-4 block' }, 'üì≠'),
                      React.createElement('p', { className: 'text-slate-600 font-medium' }, 
                        getText(lang, 'Keine Daten ausgew√§hlt', 'Nessun dato selezionato', 'No data selected')
                      ),
                      React.createElement('p', { className: 'text-slate-500 text-sm mt-1' }, 
                        getText(lang, 'Bitte w√§hlen Sie Beurteilungen aus oder √§ndern Sie den Typ-Filter.', 'Seleziona valutazioni o cambia il filtro.', 'Please select appraisals or change the type filter.')
                      )
                    ),
                    
                    // === HAUPTVISUALISIERUNG ===
                    selectedAppraisals.length > 0 && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                        React.createElement('span', null, 'üìä'),
                        getText(lang, 'Verteilung: IST vs. SOLL', 'Distribuzione: Effettivo vs. Atteso', 'Distribution: Actual vs. Expected')
                      ),
                      
                      // Balkendiagramm
                      React.createElement('div', { className: 'space-y-4' },
                        buckets.map((bucket, idx) => 
                          React.createElement('div', { key: idx, className: 'space-y-1' },
                            React.createElement('div', { className: 'flex justify-between text-sm' },
                              React.createElement('span', { className: 'font-medium text-slate-700' }, bucket.label),
                              React.createElement('span', { className: 'text-slate-500' }, 
                                `IST: ${bucket.percent.toFixed(0)}% (${bucket.count}) | SOLL: ${bucket.idealPercent}%`
                              )
                            ),
                            React.createElement('div', { className: 'relative h-8 bg-slate-100 rounded-full overflow-hidden' },
                              // SOLL Hintergrund
                              React.createElement('div', { 
                                className: 'absolute h-full rounded-full opacity-20',
                                style: { width: `${(bucket.idealPercent / maxPercent) * 100}%`, backgroundColor: bucket.color }
                              }),
                              // IST Balken
                              React.createElement('div', { 
                                className: 'absolute h-full rounded-full transition-all duration-700 shadow-sm',
                                style: { width: `${(bucket.percent / maxPercent) * 100}%`, backgroundColor: bucket.color }
                              },
                                bucket.count > 0 && React.createElement('span', { 
                                  className: 'absolute right-2 top-1/2 -translate-y-1/2 text-sm font-bold text-white drop-shadow'
                                }, bucket.count)
                              ),
                              // SOLL Markierung
                              React.createElement('div', { 
                                className: 'absolute top-0 bottom-0 w-0.5 bg-slate-800 opacity-50',
                                style: { left: `${(bucket.idealPercent / maxPercent) * 100}%` }
                              })
                            ),
                            React.createElement('div', { className: 'flex justify-between text-xs text-slate-400' },
                              React.createElement('span', null, bucket.gpsRange),
                              React.createElement('span', null, 
                                (bucket.percent - bucket.idealPercent >= 0 ? '+' : '') + (bucket.percent - bucket.idealPercent).toFixed(0) + '% ' +
                                getText(lang, 'Abweichung', 'scostamento', 'deviation')
                              )
                            )
                          )
                        ),
                        
                        // Legende
                        React.createElement('div', { className: 'flex gap-6 text-xs text-slate-500 justify-center mt-6 pt-4 border-t' },
                          React.createElement('span', { className: 'flex items-center gap-2' }, 
                            React.createElement('span', { className: 'w-4 h-4 rounded bg-blue-500' }), 
                            getText(lang, 'IST (tats√§chlich)', 'Effettivo', 'Actual')
                          ),
                          React.createElement('span', { className: 'flex items-center gap-2' }, 
                            React.createElement('span', { className: 'w-4 h-4 rounded bg-blue-200' }), 
                            getText(lang, 'SOLL (Normalverteilung)', 'Atteso', 'Expected')
                          ),
                          React.createElement('span', { className: 'flex items-center gap-2' }, 
                            React.createElement('span', { className: 'w-0.5 h-4 bg-slate-800 opacity-50' }), 
                            getText(lang, 'SOLL-Linie', 'Linea attesa', 'Target Line')
                          )
                        )
                      )
                    ),
                    
                    // === ANALYSIS ENGINE FEEDBACK BOX ===
                    selectedAppraisals.length > 0 && React.createElement('div', { className: 'space-y-4' },
                      React.createElement('h3', { className: 'font-semibold text-slate-800 flex items-center gap-2' },
                        React.createElement('span', null, 'üß†'),
                        getText(lang, 'Intelligente Analyse & Coaching-Hinweise', 'Analisi intelligente', 'Smart Analysis & Coaching Nudges')
                      ),
                      
                      // Analysis Feedback Cards
                      analysisResults.map((analysis, idx) => {
                        const colorClasses = {
                          green: 'bg-green-50 border-green-200',
                          orange: 'bg-orange-50 border-orange-200',
                          red: 'bg-red-50 border-red-200',
                          blue: 'bg-blue-50 border-blue-200',
                          purple: 'bg-purple-50 border-purple-200',
                          slate: 'bg-slate-50 border-slate-200'
                        };
                        const textClasses = {
                          green: 'text-green-800',
                          orange: 'text-orange-800',
                          red: 'text-red-800',
                          blue: 'text-blue-800',
                          purple: 'text-purple-800',
                          slate: 'text-slate-700'
                        };
                        const iconBgClasses = {
                          green: 'bg-green-100',
                          orange: 'bg-orange-100',
                          red: 'bg-red-100',
                          blue: 'bg-blue-100',
                          purple: 'bg-purple-100',
                          slate: 'bg-slate-100'
                        };
                        
                        return React.createElement('div', { 
                          key: idx, 
                          className: `rounded-xl p-5 border-2 ${colorClasses[analysis.color]} transition-all hover:shadow-md`
                        },
                          React.createElement('div', { className: 'flex gap-4' },
                            // Icon
                            React.createElement('div', { 
                              className: `w-12 h-12 rounded-xl flex items-center justify-center text-2xl flex-shrink-0 ${iconBgClasses[analysis.color]}`
                            }, analysis.icon),
                            
                            // Content
                            React.createElement('div', { className: 'flex-1' },
                              React.createElement('div', { className: 'flex items-start justify-between gap-4 mb-2' },
                                React.createElement('h4', { className: `font-bold ${textClasses[analysis.color]}` }, analysis.title),
                                analysis.metric && React.createElement('span', { 
                                  className: `text-sm font-bold px-3 py-1 rounded-full ${iconBgClasses[analysis.color]} ${textClasses[analysis.color]}`
                                }, analysis.metric + ' ' + (analysis.metricLabel || ''))
                              ),
                              React.createElement('p', { className: `text-sm ${textClasses[analysis.color]} opacity-90 leading-relaxed` }, analysis.message)
                            )
                          ),
                          
                          // Severity Indicator
                          analysis.severity > 0 && React.createElement('div', { className: 'mt-4 pt-3 border-t border-current opacity-20' },
                            React.createElement('div', { className: 'flex items-center gap-2' },
                              React.createElement('span', { className: `text-xs font-medium ${textClasses[analysis.color]}` }, 
                                getText(lang, 'Handlungsbedarf:', 'Priorit√†:', 'Priority:')
                              ),
                              React.createElement('div', { className: 'flex gap-1' },
                                [1, 2, 3].map(i => 
                                  React.createElement('div', { 
                                    key: i, 
                                    className: `w-3 h-3 rounded-full ${i <= analysis.severity ? iconBgClasses[analysis.color] : 'bg-slate-200'}`
                                  })
                                )
                              ),
                              React.createElement('span', { className: `text-xs ${textClasses[analysis.color]}` }, 
                                analysis.severity === 1 ? getText(lang, 'Gering', 'Basso', 'Low') :
                                analysis.severity === 2 ? getText(lang, 'Mittel', 'Medio', 'Medium') :
                                getText(lang, 'Hoch', 'Alto', 'High')
                              )
                            )
                          )
                        );
                      })
                    ),
                    
                    // === STATISTIK ZUSAMMENFASSUNG ===
                    selectedAppraisals.length > 0 && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                        React.createElement('span', null, 'üìà'),
                        getText(lang, 'Zusammenfassung', 'Riepilogo', 'Summary')
                      ),
                      React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-4' },
                        React.createElement('div', { className: 'bg-slate-50 rounded-xl p-4 text-center' },
                          React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, selectedAppraisals.length),
                          React.createElement('div', { className: 'text-xs text-slate-500 mt-1' }, getText(lang, 'Bewertungen', 'Valutazioni', 'Ratings'))
                        ),
                        React.createElement('div', { className: 'bg-green-50 rounded-xl p-4 text-center' },
                          React.createElement('div', { className: 'text-2xl font-bold text-green-700' }, 
                            (buckets[0].percent + buckets[1].percent).toFixed(0) + '%'
                          ),
                          React.createElement('div', { className: 'text-xs text-green-600 mt-1' }, getText(lang, 'Top (Note 4-5)', 'Top (4-5)', 'Top (Grade 4-5)'))
                        ),
                        React.createElement('div', { className: 'bg-blue-50 rounded-xl p-4 text-center' },
                          React.createElement('div', { className: 'text-2xl font-bold text-blue-700' }, 
                            buckets[2].percent.toFixed(0) + '%'
                          ),
                          React.createElement('div', { className: 'text-xs text-blue-600 mt-1' }, getText(lang, 'Mitte (Note 3)', 'Centro (3)', 'Middle (Grade 3)'))
                        ),
                        React.createElement('div', { className: 'bg-orange-50 rounded-xl p-4 text-center' },
                          React.createElement('div', { className: 'text-2xl font-bold text-orange-700' }, 
                            (buckets[3].percent + buckets[4].percent).toFixed(0) + '%'
                          ),
                          React.createElement('div', { className: 'text-xs text-orange-600 mt-1' }, getText(lang, 'Unten (Note 1-2)', 'Basso (1-2)', 'Bottom (Grade 1-2)'))
                        ),
                        React.createElement('div', { className: 'bg-purple-50 rounded-xl p-4 text-center' },
                          React.createElement('div', { className: 'text-2xl font-bold text-purple-700' }, avgGPSSelected),
                          React.createElement('div', { className: 'text-xs text-purple-600 mt-1' }, getText(lang, '√ò GPS-Score', 'GPS medio', 'Avg GPS Score'))
                        )
                      )
                    ),
                    
                    // === DISKUSSIONSFRAGEN F√úR KALIBRIERUNGSMEETING ===
                    selectedAppraisals.length > 0 && React.createElement('div', { className: 'bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-6 border border-purple-200' },
                      React.createElement('h3', { className: 'font-semibold text-purple-800 mb-4 flex items-center gap-2' },
                        React.createElement('span', null, 'üí¨'),
                        getText(lang, 'Diskussionsfragen f√ºr das Kalibrierungsmeeting', 'Domande per la riunione di calibrazione', 'Discussion Questions for Calibration Meeting')
                      ),
                      React.createElement('div', { className: 'grid md:grid-cols-2 gap-4' },
                        React.createElement('div', { className: 'bg-white/60 rounded-lg p-4' },
                          React.createElement('p', { className: 'text-sm text-purple-700' },
                            '1Ô∏è‚É£ ' + getText(lang, 
                              'Warum haben wir m√∂glicherweise mehr/weniger Top-Performer (Note 4-5) als statistisch erwartet?',
                              'Perch√© potremmo avere pi√π/meno top performer del previsto?',
                              'Why might we have more/fewer top performers (grade 4-5) than statistically expected?'
                            )
                          )
                        ),
                        React.createElement('div', { className: 'bg-white/60 rounded-lg p-4' },
                          React.createElement('p', { className: 'text-sm text-purple-700' },
                            '2Ô∏è‚É£ ' + getText(lang, 
                              'Sind die Bewertungskriterien √ºber alle Abteilungen hinweg einheitlich verstanden?',
                              'I criteri sono compresi uniformemente in tutti i reparti?',
                              'Are rating criteria understood uniformly across all departments?'
                            )
                          )
                        ),
                        React.createElement('div', { className: 'bg-white/60 rounded-lg p-4' },
                          React.createElement('p', { className: 'text-sm text-purple-700' },
                            '3Ô∏è‚É£ ' + getText(lang, 
                              'Welche konkreten Verhaltensbeispiele (BARS) rechtfertigen eine Note 4 oder 5?',
                              'Quali esempi comportamentali giustificano un voto 4 o 5?',
                              'What specific behavioral examples (BARS) justify a grade 4 or 5?'
                            )
                          )
                        ),
                        hrCalibrationTypeFilter === 'all' && React.createElement('div', { className: 'bg-white/60 rounded-lg p-4 border-2 border-purple-300' },
                          React.createElement('p', { className: 'text-sm text-purple-700 font-medium' },
                            'üîÑ ' + getText(lang, 
                              'Wie stark weichen Selbsteinsch√§tzung und F√ºhrungskraft-Beurteilung voneinander ab?',
                              'Quanto differiscono autovalutazione e valutazione del manager?',
                              'How much do self-assessment and manager review differ from each other?'
                            )
                          )
                        )
                      )
                    ),
                    
                    // === INFO-BOX ===
                    React.createElement('div', { className: 'bg-slate-50 rounded-xl p-4 border border-slate-200' },
                      React.createElement('div', { className: 'flex items-start gap-3' },
                        React.createElement('span', { className: 'text-xl' }, '‚ÑπÔ∏è'),
                        React.createElement('div', null,
                          React.createElement('p', { className: 'text-sm text-slate-700 font-medium' }, 
                            getText(lang, 'Hinweis: Keine erzwungene Verteilung', 'Nota: Nessuna distribuzione forzata', 'Note: No Forced Distribution')
                          ),
                          React.createElement('p', { className: 'text-xs text-slate-600 mt-1' }, 
                            getText(lang, 
                              'Diese Darstellung dient als Referenz und Diskussionsgrundlage. Wir erzwingen keine bestimmte Verteilung ("Forced Ranking"). Ziel ist es, Verzerrungen zu erkennen und faire, kalibrierte Bewertungen zu f√∂rdern.',
                              'Questa visualizzazione serve come riferimento. Non imponiamo alcuna distribuzione specifica.',
                              'This visualization serves as a reference and discussion basis. We do not enforce any specific distribution ("Forced Ranking"). The goal is to identify biases and promote fair, calibrated ratings.'
                            )
                          )
                        )
                      )
                    )
                  );
                })()
              ), // Ende hrSubTab === 'calibration'
              
              // === RATER-BIAS TAB ===
              hrSubTab === 'rater-bias' && React.createElement('div', { className: 'space-y-6' },
                
                // Header Card
                React.createElement('div', { 
                  className: 'rounded-2xl p-6 text-white',
                  style: { background: 'linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)' }
                },
                  React.createElement('h2', { className: 'text-2xl font-bold mb-2 flex items-center gap-3' },
                    React.createElement('span', { className: 'text-3xl' }, '‚öñÔ∏è'),
                    getText(lang, 'Rater-Bias-Index: H√§rte-Milde-Analyse', 'Indice Bias Valutatore', 'Rater Bias Index: Leniency-Strictness Analysis')
                  ),
                  React.createElement('p', { className: 'text-white/80' },
                    getText(lang, 
                      'Analysieren Sie, ob F√ºhrungskr√§fte strukturell zu milde oder zu streng bewerten. W√§hlen Sie aus, welche Mitarbeiter und F√ºhrungskr√§fte in die Analyse einflie√üen sollen.', 
                      'Analizza se i manager valutano sistematicamente troppo indulgentemente o severamente.',
                      'Analyze whether managers rate systematically too leniently or too strictly. Select which employees and managers to include.'
                    )
                  )
                ),
                
                // Hauptinhalt
                (() => {
                  // Alle Reviews mit GPS extrahieren
                  const allReviewsWithGPS = allCompanyAppraisals.filter(a => 
                    (a.type === 'review' || !a.type) && a.gpsScore && a.gpsScore > 0
                  );
                  
                  // Ermittle alle einzigartigen Manager
                  const managersMap = new Map();
                  allReviewsWithGPS.forEach(a => {
                    const manager = a.formData?.manager || a.managerId || 'Unbekannt';
                    if (!managersMap.has(manager)) {
                      managersMap.set(manager, []);
                    }
                    managersMap.get(manager).push(a);
                  });
                  
                  const uniqueManagers = Array.from(managersMap.keys()).sort();
                  
                  // Ermittle alle einzigartigen Mitarbeiter
                  const uniqueEmployees = [...new Set(allReviewsWithGPS.map(a => 
                    a.employeeName || a.formData?.employee || 'N/A'
                  ))].sort();
                  
                  // Filtere nach ausgew√§hlten Mitarbeitern
                  const getFilteredAppraisals = () => {
                    let filtered = allReviewsWithGPS;
                    
                    // Filter nach Manager
                    if (hrManagerFilter !== 'all') {
                      filtered = filtered.filter(a => 
                        (a.formData?.manager || a.managerId || 'Unbekannt') === hrManagerFilter
                      );
                    }
                    
                    // Filter nach Mitarbeitern (Mehrfachauswahl)
                    if (!hrRaterBiasSelectAllEmployees && hrRaterBiasSelectedEmployees.size > 0) {
                      filtered = filtered.filter(a => {
                        const empName = a.employeeName || a.formData?.employee || 'N/A';
                        return hrRaterBiasSelectedEmployees.has(empName);
                      });
                    }
                    
                    return filtered;
                  };
                  
                  const selectedAppraisals = getFilteredAppraisals();
                  
                  // Berechne Unternehmens-Durchschnitt (aus ALLEN Reviews als Benchmark)
                  const companyAvgGPS = allReviewsWithGPS.length > 0 
                    ? allReviewsWithGPS.reduce((sum, a) => sum + a.gpsScore, 0) / allReviewsWithGPS.length
                    : 0;
                  
                  // Berechne Durchschnitt der gefilterten Auswahl
                  const selectionAvgGPS = selectedAppraisals.length > 0 
                    ? selectedAppraisals.reduce((sum, a) => sum + a.gpsScore, 0) / selectedAppraisals.length
                    : 0;
                  
                  // Berechne Standardabweichung f√ºr das gesamte Unternehmen
                  const companyStdDev = (() => {
                    if (allReviewsWithGPS.length < 2) return 0;
                    const mean = companyAvgGPS;
                    const squaredDiffs = allReviewsWithGPS.map(a => Math.pow(a.gpsScore - mean, 2));
                    return Math.sqrt(squaredDiffs.reduce((sum, d) => sum + d, 0) / squaredDiffs.length);
                  })();
                  
                  // Berechne Manager-Statistiken basierend auf gefilterter Auswahl
                  const getManagerStats = () => {
                    const statsMap = new Map();
                    
                    selectedAppraisals.forEach(a => {
                      const manager = a.formData?.manager || a.managerId || 'Unbekannt';
                      if (!statsMap.has(manager)) {
                        statsMap.set(manager, []);
                      }
                      statsMap.get(manager).push(a);
                    });
                    
                    return Array.from(statsMap.entries()).map(([manager, appraisals]) => {
                      const count = appraisals.length;
                      const avgGPS = appraisals.reduce((sum, a) => sum + a.gpsScore, 0) / count;
                      
                      const stdDev = count > 1 
                        ? Math.sqrt(appraisals.map(a => Math.pow(a.gpsScore - avgGPS, 2)).reduce((sum, d) => sum + d, 0) / count)
                        : 0;
                      
                      const biasIndex = avgGPS - companyAvgGPS;
                      
                      let biasType = 'neutral';
                      let biasLabel = getText(lang, 'Neutral', 'Neutro', 'Neutral');
                      let biasColor = 'slate';
                      
                      if (biasIndex >= 0.5) {
                        biasType = 'leniency';
                        biasLabel = getText(lang, 'Milde-Tendenz', 'Tendenza indulgente', 'Leniency Bias');
                        biasColor = 'amber';
                      } else if (biasIndex >= 0.25) {
                        biasType = 'slight_leniency';
                        biasLabel = getText(lang, 'Leicht mild', 'Leggermente indulgente', 'Slightly Lenient');
                        biasColor = 'yellow';
                      } else if (biasIndex <= -0.5) {
                        biasType = 'strictness';
                        biasLabel = getText(lang, 'Strenge-Tendenz', 'Tendenza severa', 'Strictness Bias');
                        biasColor = 'red';
                      } else if (biasIndex <= -0.25) {
                        biasType = 'slight_strictness';
                        biasLabel = getText(lang, 'Leicht streng', 'Leggermente severo', 'Slightly Strict');
                        biasColor = 'orange';
                      }
                      
                      const lacksDifferentiation = stdDev < 0.3 && count >= 3;
                      
                      return {
                        manager,
                        appraisals,
                        count,
                        avgGPS,
                        stdDev,
                        biasIndex,
                        biasType,
                        biasLabel,
                        biasColor,
                        lacksDifferentiation
                      };
                    }).sort((a, b) => b.biasIndex - a.biasIndex);
                  };
                  
                  const managerStats = getManagerStats();
                  
                  // Toggle Mitarbeiter-Auswahl
                  const toggleEmployee = (empName) => {
                    const newSet = new Set(hrRaterBiasSelectedEmployees);
                    if (newSet.has(empName)) {
                      newSet.delete(empName);
                    } else {
                      newSet.add(empName);
                    }
                    setHrRaterBiasSelectedEmployees(newSet);
                    setHrRaterBiasSelectAllEmployees(false);
                  };
                  
                  // Alle Mitarbeiter ausw√§hlen/abw√§hlen
                  const toggleAllEmployees = () => {
                    if (hrRaterBiasSelectAllEmployees) {
                      setHrRaterBiasSelectAllEmployees(false);
                      setHrRaterBiasSelectedEmployees(new Set());
                    } else {
                      setHrRaterBiasSelectAllEmployees(true);
                      setHrRaterBiasSelectedEmployees(new Set(uniqueEmployees));
                    }
                  };
                  
                  return React.createElement('div', { className: 'space-y-6' },
                    
                    // Keine Daten Warnung
                    allReviewsWithGPS.length === 0 && React.createElement('div', { className: 'bg-slate-50 rounded-xl p-8 text-center' },
                      React.createElement('span', { className: 'text-4xl mb-4 block' }, 'üì≠'),
                      React.createElement('p', { className: 'text-slate-600 font-medium' },
                        getText(lang, 'Keine Review-Daten mit GPS vorhanden.', 'Nessun dato disponibile.', 'No review data with GPS available.')
                      )
                    ),
                    
                    // === STEUERUNGSBEREICH ===
                    allReviewsWithGPS.length > 0 && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                        React.createElement('span', null, 'üéõÔ∏è'),
                        getText(lang, 'Datenauswahl', 'Selezione dati', 'Data Selection')
                      ),
                      
                      // Zwei-Spalten-Layout f√ºr Filter
                      React.createElement('div', { className: 'grid md:grid-cols-2 gap-6' },
                        
                        // LINKE SPALTE: F√ºhrungskraft-Filter
                        React.createElement('div', null,
                          React.createElement('p', { className: 'text-xs text-slate-500 mb-2 font-medium uppercase tracking-wide' },
                            getText(lang, 'Nach F√ºhrungskraft filtern', 'Filtra per manager', 'Filter by Manager')
                          ),
                          React.createElement('div', { className: 'flex flex-wrap gap-2' },
                            React.createElement('button', {
                              onClick: () => setHrManagerFilter('all'),
                              className: 'px-4 py-2 rounded-xl text-sm font-semibold transition-all ' + 
                                (hrManagerFilter === 'all' 
                                  ? 'bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-lg shadow-purple-500/30' 
                                  : 'bg-slate-100 text-slate-600 hover:bg-slate-200')
                            }, 'üë• ' + getText(lang, 'Alle FK', 'Tutti', 'All Managers')),
                            uniqueManagers.slice(0, 5).map(m => 
                              React.createElement('button', {
                                key: m,
                                onClick: () => setHrManagerFilter(m),
                                className: 'px-4 py-2 rounded-xl text-sm font-semibold transition-all ' + 
                                  (hrManagerFilter === m 
                                    ? 'bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-lg shadow-purple-500/30' 
                                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200')
                              }, m.split(' ')[0])
                            ),
                            uniqueManagers.length > 5 && React.createElement('select', {
                              value: hrManagerFilter,
                              onChange: (e) => setHrManagerFilter(e.target.value),
                              className: 'px-3 py-2 text-sm border border-slate-300 rounded-xl bg-white focus:ring-2 focus:ring-purple-500 outline-none'
                            },
                              React.createElement('option', { value: 'all' }, getText(lang, 'Mehr...', 'Altri...', 'More...')),
                              uniqueManagers.map(m => 
                                React.createElement('option', { key: m, value: m }, m)
                              )
                            )
                          )
                        ),
                        
                        // RECHTE SPALTE: Mitarbeiter-Filter
                        React.createElement('div', null,
                          React.createElement('p', { className: 'text-xs text-slate-500 mb-2 font-medium uppercase tracking-wide' },
                            getText(lang, 'Nach Mitarbeiter filtern', 'Filtra per collaboratore', 'Filter by Employee')
                          ),
                          React.createElement('div', { className: 'flex flex-wrap gap-3 items-center mb-3' },
                            React.createElement('label', { className: 'flex items-center gap-2 cursor-pointer' },
                              React.createElement('input', { 
                                type: 'checkbox', 
                                checked: hrRaterBiasSelectAllEmployees, 
                                onChange: toggleAllEmployees, 
                                className: 'w-5 h-5 accent-purple-600 rounded' 
                              }),
                              React.createElement('span', { className: 'text-sm font-medium text-slate-700' }, 
                                getText(lang, 'Alle Mitarbeiter', 'Tutti', 'All Employees')
                              )
                            ),
                            React.createElement('span', { className: 'text-sm px-3 py-1 bg-purple-100 text-purple-700 rounded-full font-semibold' },
                              selectedAppraisals.length + ' / ' + allReviewsWithGPS.length + ' ' + getText(lang, 'Reviews', 'valutazioni', 'reviews')
                            )
                          )
                        )
                      ),
                      
                      // Mitarbeiter-Auswahlliste (wenn nicht alle ausgew√§hlt)
                      !hrRaterBiasSelectAllEmployees && React.createElement('div', { 
                        className: 'mt-4 border-t pt-4'
                      },
                        React.createElement('p', { className: 'text-xs text-slate-500 mb-3' }, 
                          getText(lang, 'W√§hlen Sie Mitarbeiter aus, deren Bewertungen analysiert werden sollen:', 'Seleziona collaboratori:', 'Select employees whose reviews should be analyzed:')
                        ),
                        React.createElement('div', { 
                          className: 'grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-2 max-h-64 overflow-y-auto p-2 bg-slate-50 rounded-xl'
                        },
                          uniqueEmployees.map(empName => {
                            const empReviews = allReviewsWithGPS.filter(a => 
                              (a.employeeName || a.formData?.employee || 'N/A') === empName
                            );
                            const empGPS = empReviews.length > 0 
                              ? empReviews.reduce((s, a) => s + a.gpsScore, 0) / empReviews.length 
                              : 0;
                            const empManager = empReviews[0]?.formData?.manager || '‚Äì';
                            
                            const isSelected = hrRaterBiasSelectedEmployees.has(empName);
                            
                            return React.createElement('label', { 
                              key: empName, 
                              className: `flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-all border ${
                                isSelected 
                                  ? 'bg-purple-100 border-purple-300 shadow-sm' 
                                  : 'bg-white border-slate-200 hover:border-purple-200 hover:bg-purple-50'
                              }`
                            },
                              React.createElement('input', { 
                                type: 'checkbox', 
                                checked: isSelected, 
                                onChange: () => toggleEmployee(empName), 
                                className: 'w-4 h-4 accent-purple-600 rounded flex-shrink-0' 
                              }),
                              React.createElement('div', { className: 'min-w-0 flex-1' },
                                React.createElement('p', { className: 'text-sm font-medium text-slate-800 truncate' }, empName),
                                React.createElement('p', { className: 'text-xs text-slate-500 truncate' }, 
                                  `${empManager} ‚Ä¢ GPS ${empGPS.toFixed(2)}`
                                )
                              )
                            );
                          })
                        ),
                        // Schnellauswahl-Buttons
                        React.createElement('div', { className: 'flex gap-2 mt-3' },
                          React.createElement('button', {
                            onClick: () => {
                              // Top 25% ausw√§hlen
                              const sorted = [...uniqueEmployees].sort((a, b) => {
                                const aGPS = allReviewsWithGPS.find(r => (r.employeeName || r.formData?.employee) === a)?.gpsScore || 0;
                                const bGPS = allReviewsWithGPS.find(r => (r.employeeName || r.formData?.employee) === b)?.gpsScore || 0;
                                return bGPS - aGPS;
                              });
                              const top25 = sorted.slice(0, Math.ceil(sorted.length * 0.25));
                              setHrRaterBiasSelectedEmployees(new Set(top25));
                            },
                            className: 'px-3 py-1.5 text-xs bg-green-100 text-green-700 rounded-lg hover:bg-green-200 font-medium'
                          }, 'üèÜ ' + getText(lang, 'Top 25%', 'Top 25%', 'Top 25%')),
                          React.createElement('button', {
                            onClick: () => {
                              // Bottom 25% ausw√§hlen
                              const sorted = [...uniqueEmployees].sort((a, b) => {
                                const aGPS = allReviewsWithGPS.find(r => (r.employeeName || r.formData?.employee) === a)?.gpsScore || 0;
                                const bGPS = allReviewsWithGPS.find(r => (r.employeeName || r.formData?.employee) === b)?.gpsScore || 0;
                                return aGPS - bGPS;
                              });
                              const bottom25 = sorted.slice(0, Math.ceil(sorted.length * 0.25));
                              setHrRaterBiasSelectedEmployees(new Set(bottom25));
                            },
                            className: 'px-3 py-1.5 text-xs bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 font-medium'
                          }, 'üìâ ' + getText(lang, 'Bottom 25%', 'Bottom 25%', 'Bottom 25%')),
                          React.createElement('button', {
                            onClick: () => {
                              setHrRaterBiasSelectedEmployees(new Set());
                            },
                            className: 'px-3 py-1.5 text-xs bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 font-medium'
                          }, '‚úñ ' + getText(lang, 'Keine', 'Nessuno', 'None'))
                        )
                      )
                    ),
                    
                    // === BENCHMARK-KARTEN ===
                    selectedAppraisals.length > 0 && React.createElement('div', { className: 'grid md:grid-cols-2 gap-4' },
                      // Unternehmens-Benchmark
                      React.createElement('div', { className: 'bg-gradient-to-r from-slate-800 to-slate-700 rounded-xl p-5 text-white' },
                        React.createElement('div', { className: 'flex items-center justify-between' },
                          React.createElement('div', null,
                            React.createElement('p', { className: 'text-xs text-slate-300 uppercase tracking-wider' }, 
                              getText(lang, 'Unternehmens-Benchmark (alle)', 'Benchmark aziendale', 'Company Benchmark (all)')
                            ),
                            React.createElement('p', { className: 'text-3xl font-bold mt-1' }, companyAvgGPS.toFixed(2)),
                            React.createElement('p', { className: 'text-xs text-slate-400 mt-1' }, 
                              `${allReviewsWithGPS.length} Reviews ‚Ä¢ œÉ ${companyStdDev.toFixed(2)}`
                            )
                          ),
                          React.createElement('div', { className: 'text-5xl opacity-30' }, 'üìä')
                        )
                      ),
                      // Auswahl-Durchschnitt
                      React.createElement('div', { 
                        className: 'rounded-xl p-5 text-white',
                        style: { background: selectionAvgGPS >= companyAvgGPS ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'linear-gradient(135deg, #f97316 0%, #ea580c 100%)' }
                      },
                        React.createElement('div', { className: 'flex items-center justify-between' },
                          React.createElement('div', null,
                            React.createElement('p', { className: 'text-xs text-white/80 uppercase tracking-wider' }, 
                              getText(lang, 'Aktuelle Auswahl', 'Selezione attuale', 'Current Selection')
                            ),
                            React.createElement('p', { className: 'text-3xl font-bold mt-1' }, selectionAvgGPS.toFixed(2)),
                            React.createElement('p', { className: 'text-xs text-white/70 mt-1' }, 
                              `${selectedAppraisals.length} Reviews ‚Ä¢ Œî ${(selectionAvgGPS - companyAvgGPS) >= 0 ? '+' : ''}${(selectionAvgGPS - companyAvgGPS).toFixed(2)}`
                            )
                          ),
                          React.createElement('div', { className: 'text-5xl opacity-30' }, 
                            selectionAvgGPS >= companyAvgGPS ? 'üìà' : 'üìâ'
                          )
                        )
                      )
                    ),
                    
                    // === KEINE AUSWAHL WARNUNG ===
                    selectedAppraisals.length === 0 && allReviewsWithGPS.length > 0 && React.createElement('div', { className: 'bg-amber-50 rounded-xl p-6 text-center border border-amber-200' },
                      React.createElement('span', { className: 'text-4xl mb-4 block' }, '‚ö†Ô∏è'),
                      React.createElement('p', { className: 'text-amber-800 font-medium' },
                        getText(lang, 'Keine Mitarbeiter ausgew√§hlt', 'Nessun collaboratore selezionato', 'No employees selected')
                      ),
                      React.createElement('p', { className: 'text-amber-600 text-sm mt-1' },
                        getText(lang, 'Bitte w√§hlen Sie mindestens einen Mitarbeiter aus.', 'Seleziona almeno un collaboratore.', 'Please select at least one employee.')
                      )
                    ),
                    
                    // === MANAGER-VERGLEICH ===
                    selectedAppraisals.length > 0 && managerStats.length > 0 && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                        React.createElement('span', null, 'üìä'),
                        getText(lang, 'Bewertungsverhalten nach F√ºhrungskraft', 'Comportamento per manager', 'Rating Behavior by Manager')
                      ),
                      
                      React.createElement('div', { className: 'space-y-4' },
                        managerStats.map((ms, idx) => {
                          const barWidth = Math.min(Math.max((ms.avgGPS / 5) * 100, 10), 100);
                          const benchmarkPosition = (companyAvgGPS / 5) * 100;
                          
                          return React.createElement('div', { key: idx, className: 'bg-slate-50 rounded-xl p-4' },
                            React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                              React.createElement('div', null,
                                React.createElement('p', { className: 'font-semibold text-slate-800' }, ms.manager),
                                React.createElement('p', { className: 'text-xs text-slate-500' }, 
                                  `${ms.count} ${getText(lang, 'Bewertungen', 'valutazioni', 'ratings')} ‚Ä¢ ${ms.appraisals.map(a => a.employeeName || a.formData?.employee || '').filter(n => n).slice(0, 3).join(', ')}${ms.count > 3 ? '...' : ''}`
                                )
                              ),
                              React.createElement('div', { className: 'flex gap-2' },
                                React.createElement('span', { 
                                  className: `px-2 py-0.5 rounded-full text-xs font-medium ${
                                    ms.biasColor === 'amber' ? 'bg-amber-100 text-amber-700' :
                                    ms.biasColor === 'yellow' ? 'bg-yellow-100 text-yellow-700' :
                                    ms.biasColor === 'red' ? 'bg-red-100 text-red-700' :
                                    ms.biasColor === 'orange' ? 'bg-orange-100 text-orange-700' :
                                    'bg-emerald-100 text-emerald-700'
                                  }`
                                }, ms.biasLabel),
                                ms.lacksDifferentiation && React.createElement('span', { 
                                  className: 'px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700'
                                }, '‚ö†Ô∏è')
                              )
                            ),
                            
                            React.createElement('div', { className: 'relative h-8 bg-slate-200 rounded-lg overflow-visible' },
                              React.createElement('div', { 
                                className: `h-full rounded-lg transition-all duration-500 ${
                                  ms.biasIndex >= 0.5 ? 'bg-gradient-to-r from-amber-400 to-amber-500' :
                                  ms.biasIndex >= 0.25 ? 'bg-gradient-to-r from-yellow-400 to-yellow-500' :
                                  ms.biasIndex <= -0.5 ? 'bg-gradient-to-r from-red-400 to-red-500' :
                                  ms.biasIndex <= -0.25 ? 'bg-gradient-to-r from-orange-400 to-orange-500' :
                                  'bg-gradient-to-r from-emerald-400 to-emerald-500'
                                }`,
                                style: { width: `${barWidth}%` }
                              },
                                React.createElement('span', { className: 'absolute right-2 top-1/2 -translate-y-1/2 text-sm font-bold text-white drop-shadow' },
                                  ms.avgGPS.toFixed(2)
                                )
                              ),
                              React.createElement('div', { 
                                className: 'absolute top-0 bottom-0 w-0.5 bg-slate-800 z-10',
                                style: { left: `${benchmarkPosition}%` }
                              },
                                React.createElement('div', { 
                                  className: 'absolute -top-5 left-1/2 -translate-x-1/2 text-xs bg-slate-800 text-white px-1.5 py-0.5 rounded whitespace-nowrap'
                                }, `√ò ${companyAvgGPS.toFixed(2)}`)
                              )
                            ),
                            
                            React.createElement('div', { className: 'flex justify-between mt-2 text-xs text-slate-600' },
                              React.createElement('span', null, 
                                `Œî ${ms.biasIndex >= 0 ? '+' : ''}${ms.biasIndex.toFixed(2)} ${getText(lang, 'zum Benchmark', 'dal benchmark', 'from benchmark')}`
                              ),
                              React.createElement('span', null, 
                                `œÉ ${ms.stdDev.toFixed(2)}`
                              )
                            )
                          );
                        })
                      )
                    ),
                    
                    // === EINZELNE MITARBEITER-DETAILS (wenn Filterung aktiv) ===
                    !hrRaterBiasSelectAllEmployees && selectedAppraisals.length > 0 && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                        React.createElement('span', null, 'üë§'),
                        getText(lang, 'Details der ausgew√§hlten Mitarbeiter', 'Dettagli collaboratori', 'Selected Employee Details')
                      ),
                      React.createElement('div', { className: 'overflow-x-auto' },
                        React.createElement('table', { className: 'w-full text-sm' },
                          React.createElement('thead', { className: 'bg-slate-50' },
                            React.createElement('tr', null,
                              React.createElement('th', { className: 'px-4 py-2 text-left font-semibold' }, getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee')),
                              React.createElement('th', { className: 'px-4 py-2 text-left font-semibold' }, getText(lang, 'F√ºhrungskraft', 'Manager', 'Manager')),
                              React.createElement('th', { className: 'px-4 py-2 text-center font-semibold' }, 'GPS'),
                              React.createElement('th', { className: 'px-4 py-2 text-center font-semibold' }, 'Œî vs √ò'),
                              React.createElement('th', { className: 'px-4 py-2 text-center font-semibold' }, getText(lang, 'Tendenz', 'Tendenza', 'Tendency'))
                            )
                          ),
                          React.createElement('tbody', { className: 'divide-y' },
                            selectedAppraisals.map(a => {
                              const diff = a.gpsScore - companyAvgGPS;
                              const tendency = diff >= 0.5 ? 'high' : diff <= -0.5 ? 'low' : 'avg';
                              return React.createElement('tr', { key: a.id, className: 'hover:bg-slate-50' },
                                React.createElement('td', { className: 'px-4 py-3 font-medium' }, a.employeeName || a.formData?.employee || 'N/A'),
                                React.createElement('td', { className: 'px-4 py-3 text-slate-600' }, a.formData?.manager || '‚Äì'),
                                React.createElement('td', { className: 'px-4 py-3 text-center' },
                                  React.createElement('span', { className: 'px-2 py-1 rounded font-bold ' + 
                                    (a.gpsScore >= 3.5 ? 'bg-green-100 text-green-700' : a.gpsScore >= 2.5 ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700')
                                  }, a.gpsScore.toFixed(2))
                                ),
                                React.createElement('td', { className: 'px-4 py-3 text-center ' + (diff >= 0 ? 'text-green-600' : 'text-red-600') },
                                  (diff >= 0 ? '+' : '') + diff.toFixed(2)
                                ),
                                React.createElement('td', { className: 'px-4 py-3 text-center' },
                                  React.createElement('span', { className: 'text-lg' }, 
                                    tendency === 'high' ? 'üìà' : tendency === 'low' ? 'üìâ' : '‚ûñ'
                                  )
                                )
                              );
                            })
                          )
                        )
                      )
                    ),
                    
                    // === ZUSAMMENFASSUNG ===
                    selectedAppraisals.length > 0 && React.createElement('div', { className: 'grid md:grid-cols-2 gap-4' },
                      React.createElement('div', { className: 'bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-4 border border-purple-200' },
                        React.createElement('h5', { className: 'font-semibold text-purple-800 mb-3 flex items-center gap-2' },
                          React.createElement('span', null, 'üìà'),
                          getText(lang, 'Bias-Zusammenfassung', 'Riepilogo bias', 'Bias Summary')
                        ),
                        React.createElement('div', { className: 'space-y-2' },
                          React.createElement('div', { className: 'flex justify-between text-sm' },
                            React.createElement('span', { className: 'text-amber-700' }, 'üî∫ ' + getText(lang, 'Milde-Tendenz', 'Indulgenti', 'Lenient')),
                            React.createElement('span', { className: 'font-bold text-amber-700' }, 
                              managerStats.filter(m => m.biasType === 'leniency' || m.biasType === 'slight_leniency').length
                            )
                          ),
                          React.createElement('div', { className: 'flex justify-between text-sm' },
                            React.createElement('span', { className: 'text-emerald-700' }, '‚úÖ ' + getText(lang, 'Neutral', 'Neutri', 'Neutral')),
                            React.createElement('span', { className: 'font-bold text-emerald-700' }, 
                              managerStats.filter(m => m.biasType === 'neutral').length
                            )
                          ),
                          React.createElement('div', { className: 'flex justify-between text-sm' },
                            React.createElement('span', { className: 'text-red-700' }, 'üîª ' + getText(lang, 'Strenge-Tendenz', 'Severi', 'Strict')),
                            React.createElement('span', { className: 'font-bold text-red-700' }, 
                              managerStats.filter(m => m.biasType === 'strictness' || m.biasType === 'slight_strictness').length
                            )
                          )
                        )
                      ),
                      
                      React.createElement('div', { className: 'bg-slate-50 rounded-xl p-4 border border-slate-200' },
                        React.createElement('h5', { className: 'font-semibold text-slate-700 mb-3' }, 
                          getText(lang, 'Legende', 'Legenda', 'Legend')
                        ),
                        React.createElement('div', { className: 'flex flex-wrap gap-2 text-xs' },
                          React.createElement('span', { className: 'px-2 py-1 bg-amber-100 text-amber-700 rounded' }, 'Milde: Œî ‚â• +0.5'),
                          React.createElement('span', { className: 'px-2 py-1 bg-emerald-100 text-emerald-700 rounded' }, 'Neutral: Œî ¬±0.25'),
                          React.createElement('span', { className: 'px-2 py-1 bg-red-100 text-red-700 rounded' }, 'Streng: Œî ‚â§ -0.5')
                        )
                      )
                    )
                  );
                })()
              ),
              
              // === KOMPETENZ-RADAR (SPIDER CHART) TAB ===
              hrSubTab === 'radar' && React.createElement('div', { className: 'space-y-6' },
                
                // Header Card
                React.createElement('div', { 
                  className: 'rounded-2xl p-6 text-white',
                  style: { background: 'linear-gradient(135deg, #0891b2 0%, #0e7490 100%)' }
                },
                  React.createElement('h2', { className: 'text-2xl font-bold mb-2 flex items-center gap-3' },
                    React.createElement('span', { className: 'text-3xl' }, 'üï∏Ô∏è'),
                    getText(lang, 'Kompetenz-Radar: Profilvergleich', 'Radar Competenze: Confronto profili', 'Competency Radar: Profile Comparison')
                  ),
                  React.createElement('p', { className: 'text-white/80' },
                    getText(lang, 
                      'Vergleichen Sie die Kompetenzprofile von 2-5 Mitarbeitern. Erkennen Sie komplement√§re St√§rken, potenzielle "Klone" oder Halo-Effekte (unrealistisch gleichm√§√üige Profile).', 
                      'Confronta i profili di competenza di 2-5 collaboratori.',
                      'Compare competency profiles of 2-5 employees. Identify complementary strengths, potential "clones", or halo effects.'
                    )
                  )
                ),
                
                // Hauptinhalt
                (() => {
                  // Alle Reviews mit Kompetenz-Daten
                  const reviewsWithCompetencies = allCompanyAppraisals.filter(a => 
                    (a.coreScores && Object.values(a.coreScores).some(v => v > 0)) ||
                    (a.selfCoreScores && Object.values(a.selfCoreScores).some(v => v > 0))
                  );
                  
                  // Farben f√ºr die Linien (max 5)
                  const lineColors = [
                    { stroke: '#8b5cf6', fill: 'rgba(139, 92, 246, 0.15)', name: 'Violet' },
                    { stroke: '#06b6d4', fill: 'rgba(6, 182, 212, 0.15)', name: 'Cyan' },
                    { stroke: '#f97316', fill: 'rgba(249, 115, 22, 0.15)', name: 'Orange' },
                    { stroke: '#10b981', fill: 'rgba(16, 185, 129, 0.15)', name: 'Emerald' },
                    { stroke: '#ec4899', fill: 'rgba(236, 72, 153, 0.15)', name: 'Pink' }
                  ];
                  
                  // Kompetenz-Namen
                  const coreCompetencies = [
                    { key: 'fach', label: getText(lang, 'Fachkompetenz', 'Competenza', 'Expertise'), short: 'F' },
                    { key: 'komm', label: getText(lang, 'Kommunikation', 'Comunicazione', 'Communication'), short: 'K' },
                    { key: 'prob', label: getText(lang, 'Probleml√∂sung', 'Problem Solving', 'Problem Solving'), short: 'P' },
                    { key: 'adapt', label: getText(lang, 'Adaptivit√§t', 'Adattabilit√†', 'Adaptability'), short: 'A' },
                    { key: 'orga', label: getText(lang, 'Organisation', 'Organizzazione', 'Organization'), short: 'O' }
                  ];
                  
                  const leaderCompetencies = [
                    { key: 'lead', label: getText(lang, 'F√ºhrung', 'Leadership', 'Leadership'), short: 'L' },
                    { key: 'strat', label: getText(lang, 'Strategie', 'Strategia', 'Strategy'), short: 'S' },
                    { key: 'decide', label: getText(lang, 'Entscheidung', 'Decisione', 'Decision'), short: 'E' },
                    { key: 'exec', label: getText(lang, 'Execution', 'Esecuzione', 'Execution'), short: 'X' },
                    { key: 'stake', label: getText(lang, 'Stakeholder', 'Stakeholder', 'Stakeholder'), short: 'St' }
                  ];
                  
                  // Aktive Kompetenzen basierend auf Toggle
                  const activeCompetencies = hrRadarShowLeadership 
                    ? [...coreCompetencies, ...leaderCompetencies]
                    : coreCompetencies;
                  
                  // Hole ausgew√§hlte Mitarbeiter-Daten
                  const selectedEmployees = hrRadarSelectedEmployees
                    .map(id => reviewsWithCompetencies.find(a => a.id === id))
                    .filter(Boolean);
                  
                  // Toggle Mitarbeiter-Auswahl (max 5)
                  const toggleRadarEmployee = (id) => {
                    if (hrRadarSelectedEmployees.includes(id)) {
                      setHrRadarSelectedEmployees(hrRadarSelectedEmployees.filter(i => i !== id));
                    } else if (hrRadarSelectedEmployees.length < 5) {
                      setHrRadarSelectedEmployees([...hrRadarSelectedEmployees, id]);
                    }
                  };
                  
                  // SVG Radar Chart Komponente
                  const renderRadarChart = () => {
                    if (selectedEmployees.length < 2) return null;
                    
                    const size = 400;
                    const center = size / 2;
                    const maxRadius = 160;
                    const levels = 5; // 1-5 Skala
                    
                    const numAxes = activeCompetencies.length;
                    const angleStep = (2 * Math.PI) / numAxes;
                    
                    // Berechne Punkt auf dem Radar
                    const getPoint = (value, index) => {
                      const angle = index * angleStep - Math.PI / 2; // Start oben
                      const radius = (value / 5) * maxRadius;
                      return {
                        x: center + radius * Math.cos(angle),
                        y: center + radius * Math.sin(angle)
                      };
                    };
                    
                    // Grid-Linien (Ringe)
                    const gridLines = [];
                    for (let i = 1; i <= levels; i++) {
                      const radius = (i / levels) * maxRadius;
                      const points = [];
                      for (let j = 0; j < numAxes; j++) {
                        const angle = j * angleStep - Math.PI / 2;
                        points.push(`${center + radius * Math.cos(angle)},${center + radius * Math.sin(angle)}`);
                      }
                      gridLines.push(
                        React.createElement('polygon', {
                          key: `grid-${i}`,
                          points: points.join(' '),
                          fill: 'none',
                          stroke: '#e2e8f0',
                          strokeWidth: 1
                        })
                      );
                    }
                    
                    // Achsen-Linien
                    const axisLines = activeCompetencies.map((comp, i) => {
                      const endPoint = getPoint(5, i);
                      return React.createElement('line', {
                        key: `axis-${i}`,
                        x1: center,
                        y1: center,
                        x2: endPoint.x,
                        y2: endPoint.y,
                        stroke: '#cbd5e1',
                        strokeWidth: 1
                      });
                    });
                    
                    // Achsen-Labels
                    const axisLabels = activeCompetencies.map((comp, i) => {
                      const labelPoint = getPoint(5.8, i);
                      return React.createElement('text', {
                        key: `label-${i}`,
                        x: labelPoint.x,
                        y: labelPoint.y,
                        textAnchor: 'middle',
                        dominantBaseline: 'middle',
                        className: 'text-xs font-medium fill-slate-600',
                        style: { fontSize: '11px' }
                      }, comp.short);
                    });
                    
                    // Daten-Polygone f√ºr jeden Mitarbeiter
                    const dataPolygons = selectedEmployees.map((emp, empIndex) => {
                      const scores = emp.coreScores || emp.selfCoreScores || {};
                      const leaderScores = emp.leaderScores || emp.selfLeaderScores || {};
                      const allScores = hrRadarShowLeadership 
                        ? { ...scores, ...leaderScores }
                        : scores;
                      
                      const points = activeCompetencies.map((comp, i) => {
                        const value = allScores[comp.key] || 0;
                        const point = getPoint(value, i);
                        return `${point.x},${point.y}`;
                      }).join(' ');
                      
                      const color = lineColors[empIndex];
                      
                      return React.createElement('g', { key: `emp-${empIndex}` },
                        // Fl√§che
                        React.createElement('polygon', {
                          points: points,
                          fill: color.fill,
                          stroke: color.stroke,
                          strokeWidth: 2.5,
                          strokeLinejoin: 'round'
                        }),
                        // Punkte
                        activeCompetencies.map((comp, i) => {
                          const value = allScores[comp.key] || 0;
                          const point = getPoint(value, i);
                          return React.createElement('circle', {
                            key: `point-${i}`,
                            cx: point.x,
                            cy: point.y,
                            r: 4,
                            fill: color.stroke,
                            stroke: 'white',
                            strokeWidth: 2
                          });
                        })
                      );
                    });
                    
                    // Level-Labels (1-5)
                    const levelLabels = [1, 2, 3, 4, 5].map(level => {
                      const radius = (level / 5) * maxRadius;
                      return React.createElement('text', {
                        key: `level-${level}`,
                        x: center + 8,
                        y: center - radius + 4,
                        className: 'text-xs fill-slate-400',
                        style: { fontSize: '9px' }
                      }, level);
                    });
                    
                    return React.createElement('svg', {
                      viewBox: `0 0 ${size} ${size}`,
                      className: 'w-full max-w-md mx-auto'
                    },
                      // Hintergrund
                      React.createElement('circle', {
                        cx: center,
                        cy: center,
                        r: maxRadius + 20,
                        fill: '#f8fafc'
                      }),
                      gridLines,
                      axisLines,
                      levelLabels,
                      dataPolygons,
                      axisLabels
                    );
                  };
                  
                  // Halo-Effekt Analyse
                  const analyzeHaloEffect = (emp) => {
                    const scores = emp.coreScores || emp.selfCoreScores || {};
                    const values = Object.values(scores).filter(v => v > 0);
                    if (values.length < 3) return null;
                    
                    const mean = values.reduce((s, v) => s + v, 0) / values.length;
                    const stdDev = Math.sqrt(values.map(v => Math.pow(v - mean, 2)).reduce((s, v) => s + v, 0) / values.length);
                    
                    // Niedriger Variationskoeffizient = verd√§chtig einheitlich
                    const cv = stdDev / mean;
                    
                    if (cv < 0.1 && mean > 3.5) {
                      return { type: 'halo_positive', message: getText(lang, 'Verdacht: Positiver Halo-Effekt', 'Sospetto: Effetto alone positivo', 'Suspected: Positive Halo Effect') };
                    } else if (cv < 0.1 && mean < 2.5) {
                      return { type: 'halo_negative', message: getText(lang, 'Verdacht: Negativer Halo-Effekt', 'Sospetto: Effetto alone negativo', 'Suspected: Negative Halo Effect') };
                    } else if (cv < 0.15) {
                      return { type: 'uniform', message: getText(lang, 'Sehr einheitliches Profil', 'Profilo molto uniforme', 'Very uniform profile') };
                    }
                    return null;
                  };
                  
                  // Komplementarit√§ts-Analyse
                  const analyzeComplementarity = () => {
                    if (selectedEmployees.length < 2) return null;
                    
                    const profiles = selectedEmployees.map(emp => {
                      const scores = emp.coreScores || emp.selfCoreScores || {};
                      return coreCompetencies.map(c => scores[c.key] || 0);
                    });
                    
                    // Finde die st√§rkste Kompetenz jedes Mitarbeiters
                    const strengths = profiles.map((profile, empIdx) => {
                      const maxIdx = profile.indexOf(Math.max(...profile));
                      return { empIdx, compIdx: maxIdx, value: profile[maxIdx] };
                    });
                    
                    // Pr√ºfe ob verschiedene St√§rken
                    const uniqueStrengths = new Set(strengths.map(s => s.compIdx));
                    
                    if (uniqueStrengths.size === selectedEmployees.length) {
                      return { type: 'complementary', message: getText(lang, 'Komplement√§re Profile: Jeder hat andere St√§rken', 'Profili complementari', 'Complementary profiles: Each has different strengths') };
                    } else if (uniqueStrengths.size === 1) {
                      return { type: 'clone', message: getText(lang, '√Ñhnliche Profile: Alle haben dieselbe St√§rke', 'Profili simili', 'Similar profiles: All have the same strength') };
                    }
                    return { type: 'mixed', message: getText(lang, 'Gemischte Profile', 'Profili misti', 'Mixed profiles') };
                  };
                  
                  return React.createElement('div', { className: 'space-y-6' },
                    
                    // Keine Daten Warnung
                    reviewsWithCompetencies.length === 0 && React.createElement('div', { className: 'bg-slate-50 rounded-xl p-8 text-center' },
                      React.createElement('span', { className: 'text-4xl mb-4 block' }, 'üì≠'),
                      React.createElement('p', { className: 'text-slate-600 font-medium' },
                        getText(lang, 'Keine Beurteilungen mit Kompetenz-Daten gefunden.', 'Nessuna valutazione con dati di competenza.', 'No appraisals with competency data found.')
                      )
                    ),
                    
                    // === MITARBEITER-AUSWAHL ===
                    reviewsWithCompetencies.length > 0 && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('div', { className: 'flex flex-wrap justify-between items-center mb-4 gap-4' },
                        React.createElement('h3', { className: 'font-semibold text-slate-800 flex items-center gap-2' },
                          React.createElement('span', null, 'üë•'),
                          getText(lang, 'Mitarbeiter ausw√§hlen (2-5)', 'Seleziona collaboratori', 'Select Employees (2-5)')
                        ),
                        React.createElement('div', { className: 'flex items-center gap-4' },
                          // Leadership Toggle
                          React.createElement('label', { className: 'flex items-center gap-2 cursor-pointer' },
                            React.createElement('input', {
                              type: 'checkbox',
                              checked: hrRadarShowLeadership,
                              onChange: () => setHrRadarShowLeadership(!hrRadarShowLeadership),
                              className: 'w-4 h-4 accent-cyan-600 rounded'
                            }),
                            React.createElement('span', { className: 'text-sm text-slate-600' },
                              getText(lang, 'F√ºhrungskompetenzen anzeigen', 'Mostra competenze leadership', 'Show leadership competencies')
                            )
                          ),
                          // Auswahl l√∂schen
                          hrRadarSelectedEmployees.length > 0 && React.createElement('button', {
                            onClick: () => setHrRadarSelectedEmployees([]),
                            className: 'px-3 py-1.5 text-xs bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200'
                          }, '‚úñ ' + getText(lang, 'Auswahl l√∂schen', 'Cancella', 'Clear selection'))
                        )
                      ),
                      
                      // Ausgew√§hlte Mitarbeiter anzeigen
                      hrRadarSelectedEmployees.length > 0 && React.createElement('div', { className: 'flex flex-wrap gap-2 mb-4' },
                        selectedEmployees.map((emp, idx) => 
                          React.createElement('span', { 
                            key: emp.id,
                            className: 'px-3 py-1.5 rounded-full text-sm font-medium flex items-center gap-2',
                            style: { backgroundColor: lineColors[idx].fill, borderColor: lineColors[idx].stroke, borderWidth: 2 }
                          },
                            React.createElement('span', { 
                              className: 'w-3 h-3 rounded-full',
                              style: { backgroundColor: lineColors[idx].stroke }
                            }),
                            emp.employeeName || emp.formData?.employee || 'N/A',
                            React.createElement('button', {
                              onClick: () => toggleRadarEmployee(emp.id),
                              className: 'ml-1 text-slate-500 hover:text-red-500'
                            }, '√ó')
                          )
                        )
                      ),
                      
                      // Mitarbeiter-Grid
                      React.createElement('div', { 
                        className: 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 max-h-64 overflow-y-auto p-2 bg-slate-50 rounded-xl'
                      },
                        reviewsWithCompetencies.map(a => {
                          const isSelected = hrRadarSelectedEmployees.includes(a.id);
                          const colorIdx = hrRadarSelectedEmployees.indexOf(a.id);
                          const scores = a.coreScores || a.selfCoreScores || {};
                          const avgScore = Object.values(scores).filter(v => v > 0).reduce((s, v, _, arr) => s + v / arr.length, 0);
                          
                          return React.createElement('button', {
                            key: a.id,
                            onClick: () => toggleRadarEmployee(a.id),
                            disabled: !isSelected && hrRadarSelectedEmployees.length >= 5,
                            className: `text-left p-3 rounded-lg transition-all border ${
                              isSelected 
                                ? 'shadow-md' 
                                : hrRadarSelectedEmployees.length >= 5 
                                  ? 'bg-slate-100 border-slate-200 opacity-50 cursor-not-allowed'
                                  : 'bg-white border-slate-200 hover:border-cyan-300 hover:bg-cyan-50'
                            }`,
                            style: isSelected ? { 
                              backgroundColor: lineColors[colorIdx]?.fill, 
                              borderColor: lineColors[colorIdx]?.stroke,
                              borderWidth: 2
                            } : {}
                          },
                            React.createElement('p', { className: 'font-medium text-slate-800 truncate text-sm' }, 
                              a.employeeName || a.formData?.employee || 'N/A'
                            ),
                            React.createElement('p', { className: 'text-xs text-slate-500 truncate' }, 
                              a.formData?.manager || '‚Äì'
                            ),
                            React.createElement('p', { className: 'text-xs font-semibold mt-1 ' + (avgScore >= 3.5 ? 'text-green-600' : avgScore >= 2.5 ? 'text-blue-600' : 'text-orange-600') }, 
                              `√ò ${avgScore.toFixed(2)}`
                            )
                          );
                        })
                      )
                    ),
                    
                    // === RADAR CHART ===
                    selectedEmployees.length >= 2 && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                        React.createElement('span', null, 'üï∏Ô∏è'),
                        getText(lang, 'Kompetenz-Radar', 'Radar Competenze', 'Competency Radar')
                      ),
                      
                      // Chart Container
                      React.createElement('div', { className: 'flex flex-col lg:flex-row gap-6' },
                        // Radar Chart
                        React.createElement('div', { className: 'flex-1 flex justify-center items-center' },
                          renderRadarChart()
                        ),
                        
                        // Legende
                        React.createElement('div', { className: 'lg:w-64 space-y-4' },
                          React.createElement('h4', { className: 'font-medium text-slate-700 text-sm' }, 
                            getText(lang, 'Legende', 'Legenda', 'Legend')
                          ),
                          selectedEmployees.map((emp, idx) => {
                            const scores = emp.coreScores || emp.selfCoreScores || {};
                            const avgScore = Object.values(scores).filter(v => v > 0).reduce((s, v, _, arr) => s + v / arr.length, 0);
                            
                            return React.createElement('div', { 
                              key: emp.id,
                              className: 'flex items-center gap-3 p-2 rounded-lg',
                              style: { backgroundColor: lineColors[idx].fill }
                            },
                              React.createElement('div', { 
                                className: 'w-4 h-4 rounded-full flex-shrink-0',
                                style: { backgroundColor: lineColors[idx].stroke }
                              }),
                              React.createElement('div', { className: 'min-w-0 flex-1' },
                                React.createElement('p', { className: 'font-medium text-slate-800 text-sm truncate' }, 
                                  emp.employeeName || emp.formData?.employee
                                ),
                                React.createElement('p', { className: 'text-xs text-slate-500' }, 
                                  `√ò ${avgScore.toFixed(2)} ‚Ä¢ GPS ${(emp.gpsScore || 0).toFixed(2)}`
                                )
                              )
                            );
                          }),
                          
                          // Kompetenz-Erkl√§rung
                          React.createElement('div', { className: 'pt-4 border-t space-y-1' },
                            React.createElement('p', { className: 'text-xs font-medium text-slate-600 mb-2' }, 
                              getText(lang, 'Achsen:', 'Assi:', 'Axes:')
                            ),
                            activeCompetencies.map(comp =>
                              React.createElement('p', { key: comp.key, className: 'text-xs text-slate-500' },
                                React.createElement('span', { className: 'font-semibold' }, comp.short + ': '),
                                comp.label
                              )
                            )
                          )
                        )
                      )
                    ),
                    
                    // === ANALYSE & INSIGHTS ===
                    selectedEmployees.length >= 2 && React.createElement('div', { className: 'grid md:grid-cols-2 gap-4' },
                      
                      // Komplementarit√§ts-Analyse
                      React.createElement('div', { className: 'bg-gradient-to-br from-cyan-50 to-teal-50 rounded-xl p-4 border border-cyan-200' },
                        React.createElement('h4', { className: 'font-semibold text-cyan-800 mb-3 flex items-center gap-2' },
                          React.createElement('span', null, 'üß©'),
                          getText(lang, 'Team-Komplementarit√§t', 'Complementarit√† team', 'Team Complementarity')
                        ),
                        (() => {
                          const analysis = analyzeComplementarity();
                          if (!analysis) return null;
                          
                          const icon = analysis.type === 'complementary' ? '‚úÖ' : analysis.type === 'clone' ? '‚ö†Ô∏è' : 'üìä';
                          const bgColor = analysis.type === 'complementary' ? 'bg-green-100 text-green-700' : 
                                          analysis.type === 'clone' ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-700';
                          
                          return React.createElement('div', { className: `p-3 rounded-lg ${bgColor}` },
                            React.createElement('p', { className: 'font-medium' }, icon + ' ' + analysis.message),
                            analysis.type === 'complementary' && React.createElement('p', { className: 'text-sm mt-1 opacity-80' },
                              getText(lang, 'Gut f√ºr diverse Teams mit verschiedenen Perspektiven.', 'Buono per team diversificati.', 'Good for diverse teams with different perspectives.')
                            ),
                            analysis.type === 'clone' && React.createElement('p', { className: 'text-sm mt-1 opacity-80' },
                              getText(lang, '√úberlegen Sie, ob mehr Diversit√§t im Team hilfreich w√§re.', 'Considera se pi√π diversit√† sarebbe utile.', 'Consider if more diversity in the team would be helpful.')
                            )
                          );
                        })()
                      ),
                      
                      // Halo-Effekt Warnungen
                      React.createElement('div', { className: 'bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-4 border border-purple-200' },
                        React.createElement('h4', { className: 'font-semibold text-purple-800 mb-3 flex items-center gap-2' },
                          React.createElement('span', null, 'üîç'),
                          getText(lang, 'Halo-Effekt Pr√ºfung', 'Verifica effetto alone', 'Halo Effect Check')
                        ),
                        React.createElement('div', { className: 'space-y-2' },
                          selectedEmployees.map(emp => {
                            const halo = analyzeHaloEffect(emp);
                            const name = emp.employeeName || emp.formData?.employee || 'N/A';
                            
                            if (halo) {
                              return React.createElement('div', { 
                                key: emp.id,
                                className: `p-2 rounded-lg ${
                                  halo.type === 'halo_positive' ? 'bg-amber-100 text-amber-700' :
                                  halo.type === 'halo_negative' ? 'bg-red-100 text-red-700' :
                                  'bg-blue-100 text-blue-700'
                                }`
                              },
                                React.createElement('span', { className: 'font-medium' }, name + ': '),
                                halo.message
                              );
                            }
                            return React.createElement('div', { 
                              key: emp.id,
                              className: 'p-2 rounded-lg bg-green-100 text-green-700'
                            },
                              React.createElement('span', { className: 'font-medium' }, name + ': '),
                              getText(lang, 'Differenziertes Profil ‚úì', 'Profilo differenziato ‚úì', 'Differentiated profile ‚úì')
                            );
                          })
                        )
                      )
                    ),
                    
                    // === QUALIT√ÑTS-CHECK DER BEGR√úNDUNGEN ===
                    selectedEmployees.length >= 2 && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('div', { className: 'flex flex-wrap items-center justify-between gap-4 mb-4' },
                        React.createElement('h3', { className: 'font-semibold text-slate-800 flex items-center gap-2' },
                          React.createElement('span', null, 'üìù'),
                          getText(lang, 'Qualit√§ts-Check: Begr√ºndungen', 'Quality Check: Giustificazioni', 'Quality Check: Justifications')
                        ),
                        React.createElement('div', { className: 'flex items-center gap-3 text-xs' },
                          React.createElement('span', { className: 'flex items-center gap-1' },
                            React.createElement('span', { className: 'w-3 h-3 rounded-full bg-green-500' }),
                            getText(lang, 'Gut dokumentiert', 'Ben documentato', 'Well documented')
                          ),
                          React.createElement('span', { className: 'flex items-center gap-1' },
                            React.createElement('span', { className: 'w-3 h-3 rounded-full bg-amber-500' }),
                            getText(lang, 'Kurze Begr√ºndung', 'Breve giustificazione', 'Brief justification')
                          ),
                          React.createElement('span', { className: 'flex items-center gap-1' },
                            React.createElement('span', { className: 'w-3 h-3 rounded-full bg-red-500' }),
                            getText(lang, 'Dokumentation fehlt', 'Documentazione mancante', 'Documentation missing')
                          )
                        )
                      ),
                      React.createElement('p', { className: 'text-sm text-slate-600 mb-4 bg-slate-50 p-3 rounded-lg' },
                        React.createElement('span', { className: 'font-semibold text-slate-700' }, 'üí° A&O-Psychologie: '),
                        getText(lang, 
                          'Nur Bewertung "3" gilt als Erwartungsnorm. Bewertungen 1, 2, 4 und 5 sind "extrem" und erfordern substanzielle schriftliche Begr√ºndungen. Rechtfertigungsdruck erh√∂ht die Objektivit√§t.',
                          'Solo la valutazione "3" √® la norma. Valutazioni 1, 2, 4 e 5 sono "estreme" e richiedono giustificazioni scritte sostanziali.',
                          'Only rating "3" is the expectation norm. Ratings 1, 2, 4 and 5 are "extreme" and require substantial written justifications. Accountability pressure increases objectivity.'
                        )
                      ),
                      React.createElement('div', { className: 'space-y-3' },
                        selectedEmployees.map((emp, idx) => {
                          const name = emp.employeeName || emp.formData?.employee || 'N/A';
                          const scores = emp.coreScores || emp.selfCoreScores || {};
                          const leaderScores = emp.leaderScores || emp.selfLeaderScores || {};
                          const allScores = { ...scores, ...leaderScores };
                          
                          // Kommentare aus dem Review extrahieren - alle m√∂glichen Quellen pr√ºfen
                          const goalComment = emp.formData?.goalComment || emp.goalComment || '';
                          const coreComment = emp.formData?.coreComment || emp.coreComment || '';
                          const leaderComment = emp.formData?.leaderComment || emp.leaderComment || '';
                          const overallComment = emp.formData?.overallComment || emp.overallComment || '';
                          const careerComment = emp.formData?.careerComment || emp.careerComment || '';
                          const strengths1 = emp.formData?.strengths1 || emp.strengths1 || '';
                          const strengths2 = emp.formData?.strengths2 || emp.strengths2 || '';
                          
                          // Kommentare aus Kompetenz-Arrays extrahieren
                          const coreList = emp.formData?.competencies?.core || emp.competencies?.core || [];
                          const leadList = emp.formData?.competencies?.lead || emp.competencies?.lead || [];
                          const coreArrayComments = coreList.map(c => c.comment || '').join(' ');
                          const leadArrayComments = leadList.map(c => c.comment || '').join(' ');
                          
                          // Kommentare aus coreComments/leaderComments Objekten
                          const coreCommentsObj = emp.coreComments || emp.formData?.coreComments || {};
                          const leaderCommentsObj = emp.leaderComments || emp.formData?.leaderComments || {};
                          const coreObjComments = Object.values(coreCommentsObj).join(' ');
                          const leaderObjComments = Object.values(leaderCommentsObj).join(' ');
                          
                          // Alle Kommentare zusammenfassen
                          const allComments = [
                            goalComment, coreComment, leaderComment, overallComment, careerComment,
                            strengths1, strengths2, coreArrayComments, leadArrayComments,
                            coreObjComments, leaderObjComments
                          ].join(' ');
                          const totalCommentLength = allComments.trim().length;
                          
                          // Finde extreme Bewertungen (1, 2, 4, 5 sind extrem - nur 3 ist "normal")
                          // Runde auf ganze Zahlen f√ºr die Klassifizierung
                          const extremeHigh = Object.entries(allScores).filter(([k, v]) => v > 0 && Math.round(v) >= 4);
                          const extremeLow = Object.entries(allScores).filter(([k, v]) => v > 0 && Math.round(v) <= 2);
                          const gpsScore = emp.gpsScore || 0;
                          const hasExtremeGPS = gpsScore > 0 && (Math.round(gpsScore) >= 4 || Math.round(gpsScore) <= 2);
                          
                          // Qualit√§ts-Analyse
                          const analyzeQuality = () => {
                            const issues = [];
                            let status = 'green'; // green, amber, red
                            
                            // Mindest-Textl√§nge basierend auf Extremheit
                            const totalExtremes = extremeHigh.length + extremeLow.length + (hasExtremeGPS ? 1 : 0);
                            const minChars = totalExtremes > 0 ? 50 + (totalExtremes * 20) : 20;
                            
                            if (totalExtremes > 0 && totalCommentLength < 20) {
                              status = 'red';
                              issues.push(getText(lang, 
                                `${totalExtremes} extreme Bewertung(en) (‚â†3), aber Begr√ºndung fehlt komplett!`,
                                `${totalExtremes} valutazione/i estrema/e (‚â†3), ma manca la giustificazione!`,
                                `${totalExtremes} extreme rating(s) (‚â†3), but justification is missing!`
                              ));
                            } else if (totalExtremes > 0 && totalCommentLength < minChars) {
                              status = 'amber';
                              issues.push(getText(lang,
                                `${totalExtremes} extreme Bewertung(en) (‚â†3), Begr√ºndung zu kurz (${totalCommentLength}/${minChars} Zeichen)`,
                                `${totalExtremes} valutazione/i estrema/e (‚â†3), giustificazione troppo breve`,
                                `${totalExtremes} extreme rating(s) (‚â†3), justification too brief (${totalCommentLength}/${minChars} chars)`
                              ));
                            } else if (totalExtremes > 0 && totalCommentLength >= minChars) {
                              issues.push(getText(lang,
                                `${totalExtremes} extreme Bewertung(en) (‚â†3), ausreichend begr√ºndet ‚úì`,
                                `${totalExtremes} valutazione/i estrema/e (‚â†3), ben documentata/e ‚úì`,
                                `${totalExtremes} extreme rating(s) (‚â†3), sufficiently justified ‚úì`
                              ));
                            }
                            
                            // GPS Score Pr√ºfung
                            if (Math.round(gpsScore) >= 4 && totalCommentLength < 80) {
                              status = status === 'green' ? 'amber' : status;
                              issues.push(getText(lang,
                                `Top-Performer (GPS ${gpsScore.toFixed(2)}) - mehr Dokumentation f√ºr Bef√∂rderung empfohlen`,
                                `Top performer (GPS ${gpsScore.toFixed(2)}) - pi√π documentazione raccomandata`,
                                `Top performer (GPS ${gpsScore.toFixed(2)}) - more documentation recommended`
                              ));
                            }
                            
                            if (gpsScore > 0 && Math.round(gpsScore) <= 2 && totalCommentLength < 100) {
                              status = 'red';
                              issues.push(getText(lang,
                                `‚ö†Ô∏è Low-Performer (GPS ${gpsScore.toFixed(2)}) - ausf√ºhrliche Dokumentation f√ºr PIP erforderlich!`,
                                `‚ö†Ô∏è Low performer (GPS ${gpsScore.toFixed(2)}) - documentazione dettagliata richiesta!`,
                                `‚ö†Ô∏è Low performer (GPS ${gpsScore.toFixed(2)}) - detailed documentation required for PIP!`
                              ));
                            }
                            
                            // Sentiment-Check (vereinfacht)
                            const positiveWords = ['excellent', 'outstanding', 'great', 'fantastic', 'hervorragend', 'ausgezeichnet', 'sehr gut', 'excellent', 'eccellente', 'ottimo'];
                            const negativeWords = ['poor', 'weak', 'lacking', 'insufficient', 'schwach', 'mangelhaft', 'unzureichend', 'problematisch', 'scarso', 'insufficiente'];
                            
                            const commentLower = allComments.toLowerCase();
                            const hasPositiveWords = positiveWords.some(w => commentLower.includes(w));
                            const hasNegativeWords = negativeWords.some(w => commentLower.includes(w));
                            
                            if (gpsScore >= 4.0 && hasNegativeWords && !hasPositiveWords) {
                              status = 'amber';
                              issues.push(getText(lang,
                                'üîÑ Inkonsistenz: Hohe Bewertung, aber kritischer Textton',
                                'üîÑ Inconsistenza: Alta valutazione ma tono critico',
                                'üîÑ Inconsistency: High rating but critical tone in text'
                              ));
                            }
                            
                            if (gpsScore > 0 && gpsScore <= 2.5 && hasPositiveWords && !hasNegativeWords) {
                              status = 'amber';
                              issues.push(getText(lang,
                                'üîÑ Inkonsistenz: Niedrige Bewertung, aber positiver Textton',
                                'üîÑ Inconsistenza: Bassa valutazione ma tono positivo',
                                'üîÑ Inconsistency: Low rating but positive tone in text'
                              ));
                            }
                            
                            if (issues.length === 0) {
                              issues.push(getText(lang, 'Keine extremen Bewertungen', 'Nessuna valutazione estrema', 'No extreme ratings'));
                            }
                            
                            return { status, issues, totalCommentLength, totalExtremes };
                          };
                          
                          const quality = analyzeQuality();
                          const statusColors = {
                            green: { bg: 'bg-green-50 border-green-200', icon: 'üü¢', badge: 'bg-green-100 text-green-700' },
                            amber: { bg: 'bg-amber-50 border-amber-200', icon: 'üü°', badge: 'bg-amber-100 text-amber-700' },
                            red: { bg: 'bg-red-50 border-red-200', icon: 'üî¥', badge: 'bg-red-100 text-red-700' }
                          };
                          const statusStyle = statusColors[quality.status];
                          
                          return React.createElement('div', { 
                            key: emp.id,
                            className: `p-4 rounded-lg border ${statusStyle.bg}`
                          },
                            React.createElement('div', { className: 'flex flex-wrap items-start justify-between gap-3' },
                              React.createElement('div', { className: 'flex items-center gap-3' },
                                React.createElement('span', { 
                                  className: 'w-4 h-4 rounded-full flex-shrink-0',
                                  style: { backgroundColor: lineColors[idx].stroke }
                                }),
                                React.createElement('div', null,
                                  React.createElement('p', { className: 'font-semibold text-slate-800' }, name),
                                  React.createElement('p', { className: 'text-xs text-slate-500' }, 
                                    `GPS: ${(emp.gpsScore || 0).toFixed(2)} ‚Ä¢ ${getText(lang, 'Kommentarl√§nge', 'Lunghezza commento', 'Comment length')}: ${quality.totalCommentLength} ${getText(lang, 'Zeichen', 'caratteri', 'chars')}`
                                  )
                                )
                              ),
                              React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement('span', { className: `px-3 py-1 rounded-full text-xs font-bold ${statusStyle.badge}` },
                                  statusStyle.icon + ' ' + (quality.status === 'green' 
                                    ? getText(lang, 'OK', 'OK', 'OK')
                                    : quality.status === 'amber' 
                                      ? getText(lang, 'Pr√ºfen', 'Verifica', 'Review')
                                      : getText(lang, 'Aktion n√∂tig', 'Azione richiesta', 'Action needed'))
                                )
                              )
                            ),
                            quality.issues.length > 0 && React.createElement('div', { className: 'mt-3 space-y-1' },
                              quality.issues.map((issue, i) => 
                                React.createElement('p', { key: i, className: 'text-sm text-slate-700 flex items-start gap-2' },
                                  React.createElement('span', { className: 'text-slate-400' }, '‚Ä¢'),
                                  issue
                                )
                              )
                            ),
                            // Detaillierte Kompetenz-Tabelle mit Bewertungen und Begr√ºndungen
                            React.createElement('div', { className: 'mt-4 pt-3 border-t border-slate-200' },
                              React.createElement('p', { className: 'text-xs font-semibold text-slate-700 mb-3 flex items-center gap-2' }, 
                                'üìã ',
                                getText(lang, 'Kompetenzen & Begr√ºndungen', 'Competenze & Giustificazioni', 'Competencies & Justifications')
                              ),
                              // Tabelle
                              React.createElement('div', { className: 'overflow-x-auto' },
                                React.createElement('table', { className: 'w-full text-xs' },
                                  React.createElement('thead', null,
                                    React.createElement('tr', { className: 'bg-slate-100' },
                                      React.createElement('th', { className: 'px-2 py-1.5 text-left font-semibold text-slate-600 w-32' }, 
                                        getText(lang, 'Kompetenz', 'Competenza', 'Competency')
                                      ),
                                      React.createElement('th', { className: 'px-2 py-1.5 text-center font-semibold text-slate-600 w-16' }, 
                                        getText(lang, 'Note', 'Voto', 'Rating')
                                      ),
                                      React.createElement('th', { className: 'px-2 py-1.5 text-left font-semibold text-slate-600' }, 
                                        getText(lang, 'Begr√ºndung', 'Giustificazione', 'Justification')
                                      )
                                    )
                                  ),
                                  React.createElement('tbody', null,
                                    // Kernkompetenzen
                                    (() => {
                                      const coreCompNames = {
                                        fach: getText(lang, 'Fachkompetenz', 'Competenza tecnica', 'Expertise'),
                                        komm: getText(lang, 'Kommunikation', 'Comunicazione', 'Communication'),
                                        prob: getText(lang, 'Probleml√∂sung', 'Problem Solving', 'Problem Solving'),
                                        adapt: getText(lang, 'Adaptivit√§t', 'Adattabilit√†', 'Adaptability'),
                                        orga: getText(lang, 'Organisation', 'Organizzazione', 'Organization')
                                      };
                                      const leaderCompNames = {
                                        lead: getText(lang, 'F√ºhrung', 'Leadership', 'Leadership'),
                                        strat: getText(lang, 'Strategie', 'Strategia', 'Strategy'),
                                        decide: getText(lang, 'Entscheidung', 'Decisione', 'Decision'),
                                        exec: getText(lang, 'Execution', 'Esecuzione', 'Execution'),
                                        stake: getText(lang, 'Stakeholder', 'Stakeholder', 'Stakeholder')
                                      };
                                      
                                      // Kommentare aus verschiedenen Quellen holen
                                      const getComment = (compKey) => {
                                        // Aus coreComments/leaderComments Objekt
                                        if (coreCommentsObj[compKey]) return coreCommentsObj[compKey];
                                        if (leaderCommentsObj[compKey]) return leaderCommentsObj[compKey];
                                        // Aus competencies Array
                                        const coreComp = coreList.find(c => c.id === compKey || c.key === compKey);
                                        if (coreComp?.comment) return coreComp.comment;
                                        const leadComp = leadList.find(c => c.id === compKey || c.key === compKey);
                                        if (leadComp?.comment) return leadComp.comment;
                                        return '';
                                      };
                                      
                                      const rows = [];
                                      
                                      // Core Kompetenzen
                                      Object.entries(coreCompNames).forEach(([key, label]) => {
                                        const score = allScores[key] || 0;
                                        if (score === 0) return; // Keine Bewertung
                                        
                                        const comment = getComment(key);
                                        const isExtreme = Math.round(score) !== 3;
                                        const needsJustification = isExtreme && comment.length < 20;
                                        
                                        rows.push(React.createElement('tr', { 
                                          key: key, 
                                          className: needsJustification ? 'bg-red-50' : isExtreme ? 'bg-amber-50' : ''
                                        },
                                          React.createElement('td', { className: 'px-2 py-1.5 border-b border-slate-100 font-medium text-slate-700' }, label),
                                          React.createElement('td', { className: 'px-2 py-1.5 border-b border-slate-100 text-center' },
                                            React.createElement('span', { 
                                              className: `px-2 py-0.5 rounded font-bold ${
                                                Math.round(score) >= 4 ? 'bg-emerald-100 text-emerald-700' :
                                                Math.round(score) <= 2 ? 'bg-red-100 text-red-700' :
                                                'bg-blue-100 text-blue-700'
                                              }`
                                            }, score.toFixed(1))
                                          ),
                                          React.createElement('td', { className: 'px-2 py-1.5 border-b border-slate-100 text-slate-600' },
                                            comment ? 
                                              React.createElement('span', { className: 'line-clamp-2' }, comment) :
                                              React.createElement('span', { className: needsJustification ? 'text-red-500 font-medium' : 'text-slate-400 italic' }, 
                                                needsJustification ? '‚ö†Ô∏è ' + getText(lang, 'Begr√ºndung fehlt!', 'Manca giustificazione!', 'Justification missing!') :
                                                getText(lang, 'Keine Begr√ºndung', 'Nessuna giustificazione', 'No justification')
                                              )
                                          )
                                        ));
                                      });
                                      
                                      // Leadership Kompetenzen (falls vorhanden)
                                      Object.entries(leaderCompNames).forEach(([key, label]) => {
                                        const score = allScores[key] || 0;
                                        if (score === 0) return;
                                        
                                        const comment = getComment(key);
                                        const isExtreme = Math.round(score) !== 3;
                                        const needsJustification = isExtreme && comment.length < 20;
                                        
                                        rows.push(React.createElement('tr', { 
                                          key: key, 
                                          className: needsJustification ? 'bg-red-50' : isExtreme ? 'bg-amber-50' : ''
                                        },
                                          React.createElement('td', { className: 'px-2 py-1.5 border-b border-slate-100 font-medium text-slate-700' }, 
                                            'üëî ' + label
                                          ),
                                          React.createElement('td', { className: 'px-2 py-1.5 border-b border-slate-100 text-center' },
                                            React.createElement('span', { 
                                              className: `px-2 py-0.5 rounded font-bold ${
                                                Math.round(score) >= 4 ? 'bg-emerald-100 text-emerald-700' :
                                                Math.round(score) <= 2 ? 'bg-red-100 text-red-700' :
                                                'bg-blue-100 text-blue-700'
                                              }`
                                            }, score.toFixed(1))
                                          ),
                                          React.createElement('td', { className: 'px-2 py-1.5 border-b border-slate-100 text-slate-600' },
                                            comment ? 
                                              React.createElement('span', { className: 'line-clamp-2' }, comment) :
                                              React.createElement('span', { className: needsJustification ? 'text-red-500 font-medium' : 'text-slate-400 italic' }, 
                                                needsJustification ? '‚ö†Ô∏è ' + getText(lang, 'Begr√ºndung fehlt!', 'Manca giustificazione!', 'Justification missing!') :
                                                getText(lang, 'Keine Begr√ºndung', 'Nessuna giustificazione', 'No justification')
                                              )
                                          )
                                        ));
                                      });
                                      
                                      return rows;
                                    })()
                                  )
                                )
                              ),
                              // Zus√§tzliche Freitext-Kommentare
                              (strengths1 || strengths2 || careerComment) && React.createElement('div', { className: 'mt-3 pt-2 border-t border-slate-100' },
                                React.createElement('p', { className: 'text-xs font-semibold text-slate-600 mb-2' }, 
                                  getText(lang, 'Weitere Kommentare:', 'Altri commenti:', 'Additional comments:')
                                ),
                                strengths1 && React.createElement('p', { className: 'text-xs text-slate-600 mb-1' },
                                  React.createElement('span', { className: 'font-medium' }, getText(lang, 'St√§rke 1: ', 'Forza 1: ', 'Strength 1: ')),
                                  strengths1
                                ),
                                strengths2 && React.createElement('p', { className: 'text-xs text-slate-600 mb-1' },
                                  React.createElement('span', { className: 'font-medium' }, getText(lang, 'St√§rke 2: ', 'Forza 2: ', 'Strength 2: ')),
                                  strengths2
                                ),
                                careerComment && React.createElement('p', { className: 'text-xs text-slate-600' },
                                  React.createElement('span', { className: 'font-medium' }, getText(lang, 'Karriere: ', 'Carriera: ', 'Career: ')),
                                  careerComment
                                )
                              )
                            )
                          );
                        })
                      ),
                      // Zusammenfassung
                      React.createElement('div', { className: 'mt-4 pt-4 border-t grid grid-cols-3 gap-4 text-center' },
                        (() => {
                          const qualityStats = selectedEmployees.map(emp => {
                            // Alle Kommentar-Quellen pr√ºfen
                            const goalComment = emp.formData?.goalComment || emp.goalComment || '';
                            const coreComment = emp.formData?.coreComment || emp.coreComment || '';
                            const leaderComment = emp.formData?.leaderComment || emp.leaderComment || '';
                            const overallComment = emp.formData?.overallComment || emp.overallComment || '';
                            const careerComment = emp.formData?.careerComment || emp.careerComment || '';
                            const strengths1 = emp.formData?.strengths1 || emp.strengths1 || '';
                            const strengths2 = emp.formData?.strengths2 || emp.strengths2 || '';
                            
                            const coreList = emp.formData?.competencies?.core || emp.competencies?.core || [];
                            const leadList = emp.formData?.competencies?.lead || emp.competencies?.lead || [];
                            const coreArrayComments = coreList.map(c => c.comment || '').join(' ');
                            const leadArrayComments = leadList.map(c => c.comment || '').join(' ');
                            
                            const coreCommentsObj = emp.coreComments || emp.formData?.coreComments || {};
                            const leaderCommentsObj = emp.leaderComments || emp.formData?.leaderComments || {};
                            const coreObjComments = Object.values(coreCommentsObj).join(' ');
                            const leaderObjComments = Object.values(leaderCommentsObj).join(' ');
                            
                            const totalLen = [
                              goalComment, coreComment, leaderComment, overallComment, careerComment,
                              strengths1, strengths2, coreArrayComments, leadArrayComments,
                              coreObjComments, leaderObjComments
                            ].join(' ').trim().length;
                            
                            const scores = { ...(emp.coreScores || {}), ...(emp.leaderScores || {}) };
                            // Extrem = 1, 2, 4, 5 (nur 3 ist normal)
                            const extremes = Object.values(scores).filter(v => v > 0 && (Math.round(v) <= 2 || Math.round(v) >= 4)).length;
                            const gps = emp.gpsScore || 0;
                            const hasExtremeGPS = gps > 0 && (Math.round(gps) <= 2 || Math.round(gps) >= 4);
                            const totalExtremes = extremes + (hasExtremeGPS ? 1 : 0);
                            
                            if (totalExtremes > 0 && totalLen < 20) return 'red';
                            if (totalExtremes > 0 && totalLen < 50 + totalExtremes * 20) return 'amber';
                            return 'green';
                          });
                          
                          const greenCount = qualityStats.filter(s => s === 'green').length;
                          const amberCount = qualityStats.filter(s => s === 'amber').length;
                          const redCount = qualityStats.filter(s => s === 'red').length;
                          
                          return [
                            React.createElement('div', { key: 'green', className: 'p-3 bg-green-50 rounded-lg' },
                              React.createElement('p', { className: 'text-2xl font-bold text-green-600' }, greenCount),
                              React.createElement('p', { className: 'text-xs text-green-700' }, getText(lang, 'Gut dokumentiert', 'Ben documentati', 'Well documented'))
                            ),
                            React.createElement('div', { key: 'amber', className: 'p-3 bg-amber-50 rounded-lg' },
                              React.createElement('p', { className: 'text-2xl font-bold text-amber-600' }, amberCount),
                              React.createElement('p', { className: 'text-xs text-amber-700' }, getText(lang, 'Zu pr√ºfen', 'Da verificare', 'To review'))
                            ),
                            React.createElement('div', { key: 'red', className: 'p-3 bg-red-50 rounded-lg' },
                              React.createElement('p', { className: 'text-2xl font-bold text-red-600' }, redCount),
                              React.createElement('p', { className: 'text-xs text-red-700' }, getText(lang, 'Aktion n√∂tig', 'Azione richiesta', 'Action needed'))
                            )
                          ];
                        })()
                      )
                    ),
                    
                    // === DETAIL-TABELLE ===
                    selectedEmployees.length >= 2 && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                        React.createElement('span', null, 'üìä'),
                        getText(lang, 'Kompetenz-Werte im Detail', 'Valori competenze', 'Competency Values in Detail')
                      ),
                      React.createElement('div', { className: 'overflow-x-auto' },
                        React.createElement('table', { className: 'w-full text-sm' },
                          React.createElement('thead', { className: 'bg-slate-50' },
                            React.createElement('tr', null,
                              React.createElement('th', { className: 'px-3 py-2 text-left font-semibold' }, getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee')),
                              activeCompetencies.map(comp =>
                                React.createElement('th', { key: comp.key, className: 'px-3 py-2 text-center font-semibold', title: comp.label }, comp.short)
                              ),
                              React.createElement('th', { className: 'px-3 py-2 text-center font-semibold' }, '√ò'),
                              React.createElement('th', { className: 'px-3 py-2 text-center font-semibold' }, 'œÉ')
                            )
                          ),
                          React.createElement('tbody', { className: 'divide-y' },
                            selectedEmployees.map((emp, idx) => {
                              const scores = emp.coreScores || emp.selfCoreScores || {};
                              const leaderScores = emp.leaderScores || emp.selfLeaderScores || {};
                              const allScores = hrRadarShowLeadership ? { ...scores, ...leaderScores } : scores;
                              
                              const values = activeCompetencies.map(c => allScores[c.key] || 0).filter(v => v > 0);
                              const avg = values.length > 0 ? values.reduce((s, v) => s + v, 0) / values.length : 0;
                              const stdDev = values.length > 1 
                                ? Math.sqrt(values.map(v => Math.pow(v - avg, 2)).reduce((s, v) => s + v, 0) / values.length)
                                : 0;
                              
                              return React.createElement('tr', { key: emp.id },
                                React.createElement('td', { className: 'px-3 py-2 font-medium flex items-center gap-2' },
                                  React.createElement('span', { 
                                    className: 'w-3 h-3 rounded-full flex-shrink-0',
                                    style: { backgroundColor: lineColors[idx].stroke }
                                  }),
                                  React.createElement('span', { className: 'truncate' }, emp.employeeName || emp.formData?.employee)
                                ),
                                activeCompetencies.map(comp => {
                                  const val = allScores[comp.key] || 0;
                                  const bgColor = val >= 4 ? 'bg-green-100 text-green-700' : 
                                                  val >= 3 ? 'bg-blue-100 text-blue-700' : 
                                                  val > 0 ? 'bg-orange-100 text-orange-700' : 'bg-slate-100 text-slate-400';
                                  return React.createElement('td', { key: comp.key, className: 'px-3 py-2 text-center' },
                                    React.createElement('span', { className: `px-2 py-0.5 rounded font-medium ${bgColor}` }, 
                                      val > 0 ? val.toFixed(1) : '‚Äì'
                                    )
                                  );
                                }),
                                React.createElement('td', { className: 'px-3 py-2 text-center font-bold text-slate-700' }, avg.toFixed(2)),
                                React.createElement('td', { className: 'px-3 py-2 text-center text-slate-500' }, stdDev.toFixed(2))
                              );
                            })
                          )
                        )
                      )
                    ),
                    
                    // Hinweis wenn weniger als 2 ausgew√§hlt
                    selectedEmployees.length < 2 && reviewsWithCompetencies.length > 0 && React.createElement('div', { className: 'bg-cyan-50 rounded-xl p-6 text-center border border-cyan-200' },
                      React.createElement('span', { className: 'text-4xl mb-4 block' }, 'üëÜ'),
                      React.createElement('p', { className: 'text-cyan-800 font-medium' },
                        getText(lang, 
                          `Bitte w√§hlen Sie mindestens 2 Mitarbeiter aus (${hrRadarSelectedEmployees.length}/5 ausgew√§hlt)`, 
                          `Seleziona almeno 2 collaboratori (${hrRadarSelectedEmployees.length}/5)`,
                          `Please select at least 2 employees (${hrRadarSelectedEmployees.length}/5 selected)`
                        )
                      )
                    )
                  );
                })()
              ),
              
              // === ZIEL-DASHBOARD TAB ===
              hrSubTab === 'goals-dashboard' && (function() {
                // Sammle alle Zielvereinbarungen
                const goalAppraisals = allCompanyAppraisals.filter(a => a.type === 'goals');
                const totalGoalDocs = goalAppraisals.length;
                const completedGoals = goalAppraisals.filter(a => a.status === 'completed').length;
                const draftGoals = goalAppraisals.filter(a => a.status === 'draft').length;
                
                // Z√§hle alle einzelnen Ziele
                let allGoals = [];
                let totalWeight = 0;
                let goalsWithWeight = 0;
                
                goalAppraisals.forEach(ga => {
                  if (ga.goals && Array.isArray(ga.goals)) {
                    ga.goals.forEach(g => {
                      if (g.name) {
                        allGoals.push({
                          ...g,
                          employeeName: ga.employeeName || ga.formData?.employee || 'Unbekannt',
                          appraisalId: ga.id,
                          status: ga.status
                        });
                        if (g.weight > 0) {
                          totalWeight += parseFloat(g.weight) || 0;
                          goalsWithWeight++;
                        }
                      }
                    });
                  }
                });
                
                const avgWeight = goalsWithWeight > 0 ? (totalWeight / goalsWithWeight).toFixed(1) : 0;
                
                // Analysiere Gewichtungsverteilung
                const weightDistribution = { low: 0, medium: 0, high: 0 };
                allGoals.forEach(g => {
                  const w = parseFloat(g.weight) || 0;
                  if (w <= 20) weightDistribution.low++;
                  else if (w <= 40) weightDistribution.medium++;
                  else weightDistribution.high++;
                });
                
                // SMART-Analyse (vereinfacht)
                const smartAnalysis = { good: 0, needsWork: 0 };
                allGoals.forEach(g => {
                  const combined = ((g.name || '') + ' ' + (g.target || '')).toLowerCase();
                  const hasNumber = /\d+/.test(combined);
                  const hasTimeframe = /q[1-4]|quartal|bis|ende|monat|jahr|quarter|month|year/.test(combined);
                  if (hasNumber && hasTimeframe && combined.length > 30) {
                    smartAnalysis.good++;
                  } else {
                    smartAnalysis.needsWork++;
                  }
                });
                
                // Mitarbeiter ohne Zielvereinbarung
                const employeesWithGoals = new Set(goalAppraisals.map(a => a.employeeId || a.employeeName));
                const reviewAppraisals = allCompanyAppraisals.filter(a => a.type === 'review' || !a.type);
                const missingGoalsData = reviewAppraisals.filter(a => !employeesWithGoals.has(a.employeeId || a.employeeName))
                  .map(a => ({ 
                    id: a.employeeId || a.id,
                    name: a.employeeName || a.formData?.employee || 'Unbekannt',
                    position: a.formData?.position || '',
                    gpsScore: a.gpsScore || 0
                  }));
                
                return React.createElement('div', { className: 'space-y-6' },
                  // Header
                  React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                    React.createElement('h3', { className: 'text-xl font-bold text-purple-800 mb-2 flex items-center gap-2' },
                      lang === 'de' ? 'Ziel-Dashboard (MBO √úbersicht)' : lang === 'it' ? 'Dashboard Obiettivi (Panoramica MBO)' : 'Goals Dashboard (MBO Overview)'
                    ),
                    React.createElement('p', { className: 'text-slate-600 mb-4' },
                      lang === 'de' ? 'Unternehmensweite √úbersicht aller Zielvereinbarungen, Qualit√§tsanalyse und Identifikation von Handlungsbedarf.'
                      : lang === 'it' ? 'Panoramica aziendale di tutti gli accordi sugli obiettivi, analisi della qualit√† e identificazione delle necessit√† di intervento.'
                      : 'Company-wide overview of all goal agreements, quality analysis and identification of action needs.'
                    ),
                    // KPI Cards
                    React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-3' },
                      React.createElement('div', { className: 'bg-purple-100 rounded-xl p-4 text-center' },
                        React.createElement('div', { className: 'text-2xl font-bold text-purple-700' }, totalGoalDocs),
                        React.createElement('div', { className: 'text-xs text-purple-600' }, 
                          lang === 'de' ? 'Zielvereinbarungen' : lang === 'it' ? 'Accordi obiettivi' : 'Goal Agreements')
                      ),
                      React.createElement('div', { className: 'bg-green-100 rounded-xl p-4 text-center' },
                        React.createElement('div', { className: 'text-2xl font-bold text-green-700' }, completedGoals),
                        React.createElement('div', { className: 'text-xs text-green-600' }, 
                          lang === 'de' ? 'Abgeschlossen' : lang === 'it' ? 'Completati' : 'Completed')
                      ),
                      React.createElement('div', { className: 'bg-amber-100 rounded-xl p-4 text-center' },
                        React.createElement('div', { className: 'text-2xl font-bold text-amber-700' }, draftGoals),
                        React.createElement('div', { className: 'text-xs text-amber-600' }, 
                          lang === 'de' ? 'Entw√ºrfe' : lang === 'it' ? 'Bozze' : 'Drafts')
                      ),
                      React.createElement('div', { className: 'bg-blue-100 rounded-xl p-4 text-center' },
                        React.createElement('div', { className: 'text-2xl font-bold text-blue-700' }, allGoals.length),
                        React.createElement('div', { className: 'text-xs text-blue-600' }, 
                          lang === 'de' ? 'Einzelziele' : lang === 'it' ? 'Obiettivi singoli' : 'Individual Goals')
                      ),
                      React.createElement('div', { className: 'bg-slate-100 rounded-xl p-4 text-center' },
                        React.createElement('div', { className: 'text-2xl font-bold text-slate-700' }, avgWeight + '%'),
                        React.createElement('div', { className: 'text-xs text-slate-600' }, 
                          lang === 'de' ? '√ò Gewichtung' : lang === 'it' ? '√ò Peso' : '√ò Weight')
                      )
                    )
                  ),
                  
                  // Qualit√§tsanalyse
                  React.createElement('div', { className: 'grid md:grid-cols-2 gap-6' },
                    // SMART-Analyse
                    React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('h4', { className: 'font-bold text-slate-800 mb-4' },
                        lang === 'de' ? 'SMART-Qualit√§tscheck' : lang === 'it' ? 'Verifica qualit√† SMART' : 'SMART Quality Check'
                      ),
                      React.createElement('div', { className: 'space-y-3' },
                        React.createElement('div', { className: 'flex items-center justify-between' },
                          React.createElement('span', { className: 'text-sm text-slate-600' }, 
                            lang === 'de' ? '‚úÖ SMART-konform' : lang === 'it' ? '‚úÖ Conforme SMART' : '‚úÖ SMART-compliant'),
                          React.createElement('span', { className: 'font-bold text-green-600' }, 
                            smartAnalysis.good + ' ' + (lang === 'de' ? 'Ziele' : 'goals'))
                        ),
                        React.createElement('div', { className: 'w-full bg-slate-200 rounded-full h-3' },
                          React.createElement('div', { 
                            className: 'bg-green-500 h-3 rounded-full transition-all',
                            style: { width: (allGoals.length > 0 ? (smartAnalysis.good / allGoals.length * 100) : 0) + '%' }
                          })
                        ),
                        React.createElement('div', { className: 'flex items-center justify-between' },
                          React.createElement('span', { className: 'text-sm text-slate-600' }, 
                            lang === 'de' ? '‚ö†Ô∏è Verbesserungsbedarf' : lang === 'it' ? '‚ö†Ô∏è Da migliorare' : '‚ö†Ô∏è Needs improvement'),
                          React.createElement('span', { className: 'font-bold text-amber-600' }, 
                            smartAnalysis.needsWork + ' ' + (lang === 'de' ? 'Ziele' : 'goals'))
                        ),
                        React.createElement('div', { className: 'w-full bg-slate-200 rounded-full h-3' },
                          React.createElement('div', { 
                            className: 'bg-amber-500 h-3 rounded-full transition-all',
                            style: { width: (allGoals.length > 0 ? (smartAnalysis.needsWork / allGoals.length * 100) : 0) + '%' }
                          })
                        ),
                        React.createElement('p', { className: 'text-xs text-slate-500 mt-3 bg-slate-50 p-2 rounded' },
                          lang === 'de' ? 'SMART = Spezifisch, Messbar, Erreichbar, Relevant, Terminiert. Ziele mit Zahlen, Prozenten und Zeitangaben gelten als SMART-konform.'
                          : lang === 'it' ? 'SMART = Specifico, Misurabile, Raggiungibile, Rilevante, Temporizzato. Obiettivi con numeri, percentuali e date sono conformi SMART.'
                          : 'SMART = Specific, Measurable, Achievable, Relevant, Time-bound. Goals with numbers, percentages and timeframes are SMART-compliant.'
                        )
                      )
                    ),
                    
                    // Gewichtungsverteilung
                    React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                      React.createElement('h4', { className: 'font-bold text-slate-800 mb-4' },
                        lang === 'de' ? 'Gewichtungsverteilung' : lang === 'it' ? 'Distribuzione pesi' : 'Weight Distribution'
                      ),
                      React.createElement('div', { className: 'space-y-3' },
                        React.createElement('div', { className: 'flex items-center justify-between' },
                          React.createElement('span', { className: 'text-sm text-slate-600' }, 
                            (lang === 'de' ? 'Niedrig' : lang === 'it' ? 'Basso' : 'Low') + ' (‚â§20%)'),
                          React.createElement('span', { className: 'font-bold text-blue-600' }, 
                            weightDistribution.low + ' ' + (lang === 'de' ? 'Ziele' : 'goals'))
                        ),
                        React.createElement('div', { className: 'flex items-center justify-between' },
                          React.createElement('span', { className: 'text-sm text-slate-600' }, 
                            (lang === 'de' ? 'Mittel' : lang === 'it' ? 'Medio' : 'Medium') + ' (21-40%)'),
                          React.createElement('span', { className: 'font-bold text-green-600' }, 
                            weightDistribution.medium + ' ' + (lang === 'de' ? 'Ziele' : 'goals'))
                        ),
                        React.createElement('div', { className: 'flex items-center justify-between' },
                          React.createElement('span', { className: 'text-sm text-slate-600' }, 
                            (lang === 'de' ? 'Hoch' : lang === 'it' ? 'Alto' : 'High') + ' (>40%)'),
                          React.createElement('span', { className: 'font-bold text-amber-600' }, 
                            weightDistribution.high + ' ' + (lang === 'de' ? 'Ziele' : 'goals'))
                        ),
                        React.createElement('div', { className: 'mt-4 flex gap-1 h-8' },
                          weightDistribution.low > 0 && React.createElement('div', { 
                            className: 'bg-blue-500 rounded flex items-center justify-center text-white text-xs font-bold',
                            style: { width: (weightDistribution.low / allGoals.length * 100) + '%' }
                          }, weightDistribution.low),
                          weightDistribution.medium > 0 && React.createElement('div', { 
                            className: 'bg-green-500 rounded flex items-center justify-center text-white text-xs font-bold',
                            style: { width: (weightDistribution.medium / allGoals.length * 100) + '%' }
                          }, weightDistribution.medium),
                          weightDistribution.high > 0 && React.createElement('div', { 
                            className: 'bg-amber-500 rounded flex items-center justify-center text-white text-xs font-bold',
                            style: { width: (weightDistribution.high / allGoals.length * 100) + '%' }
                          }, weightDistribution.high)
                        )
                      )
                    )
                  ),
                  
                  // Mitarbeiter ohne Zielvereinbarung
                  missingGoalsData.length > 0 && React.createElement('div', { className: 'bg-red-50 border border-red-200 rounded-xl p-6' },
                    React.createElement('h4', { className: 'font-bold text-red-800 mb-3 flex items-center gap-2' },
                      (lang === 'de' ? 'Mitarbeiter ohne Zielvereinbarung' : lang === 'it' ? 'Collaboratori senza accordo obiettivi' : 'Employees without Goal Agreement') + ' (' + missingGoalsData.length + ')'
                    ),
                    React.createElement('p', { className: 'text-sm text-red-700 mb-3' },
                      lang === 'de' ? 'Diese Mitarbeiter haben bereits eine Leistungsbeurteilung, aber noch keine Zielvereinbarung f√ºr die n√§chste Periode:'
                      : lang === 'it' ? 'Questi collaboratori hanno gi√† una valutazione delle prestazioni, ma non ancora un accordo sugli obiettivi per il prossimo periodo:'
                      : 'These employees already have a performance review, but no goal agreement for the next period yet:'
                    ),
                    React.createElement('div', { className: 'flex flex-wrap gap-2' },
                      missingGoalsData.slice(0, 10).map((emp, idx) => 
                        React.createElement('span', { 
                          key: idx,
                          className: 'px-3 py-1 bg-white border border-red-300 rounded-full text-sm text-red-700 cursor-default',
                          title: emp.position ? emp.position + (emp.gpsScore ? ' ‚Ä¢ GPS: ' + emp.gpsScore.toFixed(2) : '') : ''
                        }, emp.name)
                      ),
                      missingGoalsData.length > 10 && React.createElement('span', { 
                        className: 'px-3 py-1 bg-red-200 rounded-full text-sm text-red-700 font-medium'
                      }, '+' + (missingGoalsData.length - 10) + (lang === 'de' ? ' weitere' : lang === 'it' ? ' altri' : ' more'))
                    )
                  ),
                  
                  // Alle Zielvereinbarungen Liste
                  React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border overflow-hidden' },
                    React.createElement('div', { className: 'p-4 border-b bg-slate-50' },
                      React.createElement('h4', { className: 'font-bold text-slate-800' }, 
                        lang === 'de' ? 'Alle Zielvereinbarungen' : lang === 'it' ? 'Tutti gli accordi obiettivi' : 'All Goal Agreements')
                    ),
                    goalAppraisals.length > 0 ? React.createElement('div', { className: 'divide-y max-h-96 overflow-auto' },
                      goalAppraisals.map(ga => 
                        React.createElement('div', { 
                          key: ga.id,
                          className: 'p-4 hover:bg-blue-50 cursor-pointer flex items-center justify-between transition-colors',
                          onClick: () => {
                            // Zeige Modal mit Zieldetails
                            const goalsHtml = (ga.goals || []).map((g, i) => 
                              `<tr class="border-b"><td class="p-2 text-sm">${i+1}</td><td class="p-2 text-sm">${g.name || '-'}</td><td class="p-2 text-sm">${g.target || '-'}</td><td class="p-2 text-sm text-center">${g.weight || 0}%</td></tr>`
                            ).join('');
                            const devGoalsHtml = (ga.devGoals || []).map((g, i) => 
                              `<tr class="border-b"><td class="p-2 text-sm">${i+1}</td><td class="p-2 text-sm">${g.name || '-'}</td><td class="p-2 text-sm">${g.category || '-'}</td><td class="p-2 text-sm">${g.deadline ? new Date(g.deadline).toLocaleDateString('de-DE') : '-'}</td></tr>`
                            ).join('');
                            const modal = document.createElement('div');
                            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4';
                            modal.innerHTML = `
                              <div class="bg-white rounded-2xl shadow-xl max-w-3xl w-full max-h-[90vh] overflow-auto">
                                <div class="p-6 border-b bg-slate-50 flex justify-between items-center sticky top-0">
                                  <div>
                                    <h3 class="text-xl font-bold text-slate-800">${ga.employeeName || ga.formData?.employee || 'Unbekannt'}</h3>
                                    <p class="text-sm text-slate-500">${ga.formData?.position || ''}</p>
                                  </div>
                                  <button onclick="this.closest('.fixed').remove()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
                                </div>
                                <div class="p-6 space-y-6">
                                  <div>
                                    <h4 class="font-bold text-slate-700 mb-3">${lang === 'de' ? 'Leistungsziele (GPS-relevant)' : lang === 'it' ? 'Obiettivi di performance (rilevanti GPS)' : 'Performance Goals (GPS-relevant)'}</h4>
                                    ${ga.goals?.length > 0 ? `
                                      <table class="w-full border">
                                        <thead class="bg-slate-100"><tr><th class="p-2 text-left text-xs">#</th><th class="p-2 text-left text-xs">${lang === 'de' ? 'Ziel' : 'Goal'}</th><th class="p-2 text-left text-xs">${lang === 'de' ? 'Messbar' : 'Measurable'}</th><th class="p-2 text-center text-xs">${lang === 'de' ? 'Gewichtung' : 'Weight'}</th></tr></thead>
                                        <tbody>${goalsHtml}</tbody>
                                      </table>
                                      <p class="text-sm text-slate-500 mt-2">${lang === 'de' ? 'Gesamtgewichtung' : 'Total weight'}: ${(ga.goals || []).reduce((s, g) => s + (parseFloat(g.weight) || 0), 0)}%</p>
                                    ` : `<p class="text-slate-400 text-sm">${lang === 'de' ? 'Keine Leistungsziele definiert' : 'No performance goals defined'}</p>`}
                                  </div>
                                  ${ga.devGoals?.length > 0 ? `
                                  <div>
                                    <h4 class="font-bold text-purple-700 mb-3">${lang === 'de' ? 'Entwicklungsziele (nicht GPS-relevant)' : lang === 'it' ? 'Obiettivi di sviluppo (non GPS-rilevanti)' : 'Development Goals (not GPS-relevant)'}</h4>
                                    <table class="w-full border">
                                      <thead class="bg-purple-50"><tr><th class="p-2 text-left text-xs">#</th><th class="p-2 text-left text-xs">${lang === 'de' ? 'Entwicklungsziel' : 'Development Goal'}</th><th class="p-2 text-left text-xs">${lang === 'de' ? 'Kategorie' : 'Category'}</th><th class="p-2 text-left text-xs">${lang === 'de' ? 'Bis wann' : 'Deadline'}</th></tr></thead>
                                      <tbody>${devGoalsHtml}</tbody>
                                    </table>
                                  </div>
                                  ` : ''}
                                  <div class="text-xs text-slate-400 pt-4 border-t">
                                    ${lang === 'de' ? 'Zuletzt aktualisiert' : 'Last updated'}: ${new Date(ga.updatedAt || ga.createdAt).toLocaleString('de-DE')}
                                    ${ga.status === 'completed' ? ` ‚Ä¢ <span class="text-green-600">${lang === 'de' ? 'Abgeschlossen' : 'Completed'}</span>` : ` ‚Ä¢ <span class="text-amber-600">${lang === 'de' ? 'Entwurf' : 'Draft'}</span>`}
                                  </div>
                                </div>
                              </div>
                            `;
                            modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
                            document.body.appendChild(modal);
                          }
                        },
                          React.createElement('div', null,
                            React.createElement('div', { className: 'font-medium text-slate-800' }, 
                              ga.employeeName || ga.formData?.employee || 'Unbekannt'
                            ),
                            React.createElement('div', { className: 'text-sm text-slate-500' },
                              (ga.goals?.length || 0) + ' ' + (lang === 'de' ? 'Ziele' : 'goals') + ' ‚Ä¢ ' +
                              (ga.goals?.reduce((s, g) => s + (parseFloat(g.weight) || 0), 0) || 0) + '% ' + (lang === 'de' ? 'Gewichtung' : 'weight')
                            )
                          ),
                          React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('span', { 
                              className: 'px-2 py-1 rounded text-xs font-medium ' + 
                                (ga.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700')
                            }, ga.status === 'completed' 
                              ? (lang === 'de' ? '‚úì Fertig' : lang === 'it' ? '‚úì Completato' : '‚úì Complete') 
                              : (lang === 'de' ? 'Entwurf' : lang === 'it' ? 'Bozza' : 'Draft')),
                            React.createElement('span', { className: 'text-xs text-slate-400' },
                              new Date(ga.updatedAt || ga.createdAt).toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB')
                            ),
                            React.createElement('span', { className: 'text-blue-500 text-xs' }, '‚Üí')
                          )
                        )
                      )
                    ) : React.createElement('div', { className: 'p-8 text-center text-slate-500' },
                      lang === 'de' ? 'Noch keine Zielvereinbarungen vorhanden.' : lang === 'it' ? 'Nessun accordo sugli obiettivi disponibile.' : 'No goal agreements available yet.'
                    )
                  )
                );
              })(),
              
              // Filter + Export - √úBERARBEITETE VERSION
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border overflow-hidden' },
                // Filter Header
                React.createElement('div', { className: 'bg-slate-50 px-4 py-3 border-b flex items-center justify-between' },
                  React.createElement('h3', { className: 'font-semibold text-slate-700 flex items-center gap-2' },
                    React.createElement(Filter, { size: 18 }),
                    getText(lang, 'Filter & Suche', 'Filtri & Ricerca', 'Filter & Search')
                  ),
                  React.createElement('div', { className: 'flex items-center gap-2' },
                    React.createElement('span', { className: 'text-sm font-medium text-purple-600 bg-purple-50 px-3 py-1 rounded-full' },
                      filtered.length + ' ' + getText(lang, 'Eintr√§ge', 'voci', 'entries')
                    ),
                    // Reset Button
                    (hrFilter !== 'all' || hrManagerFilter !== 'all' || hrLocationFilter !== 'all' || hrGpsFilter !== 'all' || hrSearch) &&
                    React.createElement('button', {
                      onClick: () => { setHrFilter('all'); setHrManagerFilter('all'); setHrLocationFilter('all'); setHrGpsFilter('all'); setHrSearch(''); },
                      className: 'text-xs text-red-600 hover:text-red-700 flex items-center gap-1'
                    }, React.createElement(X, { size: 14 }), getText(lang, 'Zur√ºcksetzen', 'Resetta', 'Reset'))
                  )
                ),
                // Filter Row
                React.createElement('div', { className: 'p-4 grid grid-cols-2 md:grid-cols-6 gap-3' },
                  // Suche
                  React.createElement('div', { className: 'col-span-2' },
                    React.createElement('label', { className: 'block text-xs font-medium text-slate-500 mb-1' }, getText(lang, 'Suche', 'Cerca', 'Search')),
                    React.createElement('input', {
                      type: 'text',
                      placeholder: getText(lang, 'Name, Position, FK...', 'Nome, posizione...', 'Name, position...'),
                      value: hrSearch,
                      onChange: (e) => setHrSearch(e.target.value),
                      className: 'w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none text-sm'
                    })
                  ),
                  // Typ
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-xs font-medium text-slate-500 mb-1' }, getText(lang, 'Typ', 'Tipo', 'Type')),
                    React.createElement('select', {
                      value: hrFilter,
                      onChange: (e) => setHrFilter(e.target.value),
                      className: 'w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none text-sm'
                    },
                      React.createElement('option', { value: 'all' }, getText(lang, 'Alle Typen', 'Tutti', 'All Types')),
                      React.createElement('option', { value: 'reviews' }, 'üìã Reviews'),
                      React.createElement('option', { value: 'self' }, 'ü™û Self'),
                      React.createElement('option', { value: 'goals' }, 'üéØ Goals'),
                      React.createElement('option', { value: 'completed' }, '‚úì Completed'),
                      React.createElement('option', { value: 'draft' }, '‚úé Drafts')
                    )
                  ),
                  // Standort
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-xs font-medium text-slate-500 mb-1' }, getText(lang, 'Standort', 'Sede', 'Location')),
                    React.createElement('select', {
                      value: hrLocationFilter,
                      onChange: (e) => setHrLocationFilter(e.target.value),
                      className: 'w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none text-sm'
                    },
                      React.createElement('option', { value: 'all' }, getText(lang, 'Alle', 'Tutti', 'All')),
                      React.createElement('option', { value: 'Sulzberg' }, 'üá©üá™ Sulzberg'),
                      React.createElement('option', { value: 'Bolzano' }, 'üáÆüáπ Bolzano'),
                      React.createElement('option', { value: 'Campogalliano' }, 'üáÆüáπ Campogalliano')
                    )
                  ),
                  // F√ºhrungskraft
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-xs font-medium text-slate-500 mb-1' }, getText(lang, 'F√ºhrungskraft', 'Manager', 'Manager')),
                    React.createElement('select', {
                      value: hrManagerFilter,
                      onChange: (e) => setHrManagerFilter(e.target.value),
                      className: 'w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none text-sm'
                    },
                      React.createElement('option', { value: 'all' }, getText(lang, 'Alle', 'Tutti', 'All')),
                      uniqueManagers.map(m => React.createElement('option', { key: m, value: m }, m))
                    )
                  ),
                  // GPS
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-xs font-medium text-slate-500 mb-1' }, 'GPS Score'),
                    React.createElement('select', {
                      value: hrGpsFilter,
                      onChange: (e) => setHrGpsFilter(e.target.value),
                      className: 'w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none text-sm'
                    },
                      React.createElement('option', { value: 'all' }, getText(lang, 'Alle', 'Tutti', 'All')),
                      React.createElement('option', { value: 'high' }, 'üü¢ ‚â•3.51 (High)'),
                      React.createElement('option', { value: 'medium' }, 'üü° 2.51-3.50'),
                      React.createElement('option', { value: 'low' }, 'üî¥ <2.51 (Low)'),
                      React.createElement('option', { value: 'none' }, '‚ö™ Kein GPS')
                    )
                  )
                ),
                // Export Row
                React.createElement('div', { className: 'px-4 pb-4 flex justify-end' },
                  React.createElement('button', {
                    onClick: () => {
                      // Erstelle CSV-Daten f√ºr Excel
                      const headers = [
                        getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee'), 
                        getText(lang, 'Position', 'Posizione', 'Position'), 
                        getText(lang, 'F√ºhrungskraft', 'Responsabile', 'Manager'), 
                        getText(lang, 'Typ', 'Tipo', 'Type'), 
                        getText(lang, 'Status', 'Stato', 'Status'),
                        'GPS', 'WAS', 'WIE Core', 'WIE Lead',
                        getText(lang, 'C1 Fachkompetenz', 'C1 Competenza tecnica', 'C1 Technical Competence'), 
                        getText(lang, 'C2 Kommunikation', 'C2 Comunicazione', 'C2 Communication'), 
                        getText(lang, 'C3 Probleml√∂sung', 'C3 Problem solving', 'C3 Problem Solving'), 
                        getText(lang, 'C4 Adaptivit√§t', 'C4 Adattabilit√†', 'C4 Adaptability'), 
                        getText(lang, 'C5 Organisation', 'C5 Organizzazione', 'C5 Organization'),
                        getText(lang, 'L1 F√ºhrung', 'L1 Leadership', 'L1 Leadership'), 
                        getText(lang, 'L2 Strategie', 'L2 Strategia', 'L2 Strategy'), 
                        getText(lang, 'L3 Entscheidung', 'L3 Decisione', 'L3 Decision'), 
                        getText(lang, 'L4 Execution', 'L4 Esecuzione', 'L4 Execution'), 
                        getText(lang, 'L5 Stakeholder', 'L5 Stakeholder', 'L5 Stakeholder'),
                        getText(lang, 'St√§rken 1', 'Punti di forza 1', 'Strengths 1'), 
                        getText(lang, 'St√§rken 2', 'Punti di forza 2', 'Strengths 2'), 
                        getText(lang, 'Karriere-Kommentar', 'Commento carriera', 'Career Comment'), 
                        getText(lang, 'W√ºnsche n√§chstes Jahr', 'Desideri anno prossimo', 'Wishes Next Year'),
                        getText(lang, 'Feedback an FK', 'Feedback al responsabile', 'Feedback to Manager'), 
                        getText(lang, 'Erstellt am', 'Creato il', 'Created'), 
                        getText(lang, 'Aktualisiert am', 'Aggiornato il', 'Updated')
                      ];
                      
                      const rows = filtered.map(a => {
                        const coreScores = a.coreScores || {};
                        const leaderScores = a.leaderScores || {};
                        const formData = a.formData || {};
                        
                        return [
                          a.employeeName || formData.employee || '',
                          formData.position || a.position || '',
                          formData.manager || '',
                          (a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection' || a.type === 'self_assessment_standalone') ? getText(lang, 'Selbstreflexion', 'Autovalutazione', 'Self-Reflection') : a.type === 'self_pdf' ? getText(lang, 'PDF-Selbstreflexion', 'Autovalutazione PDF', 'PDF Self-Reflection') : a.type === 'goals' ? getText(lang, 'Zielvereinbarung', 'Accordo obiettivi', 'Goals Agreement') : 'Review',
                          a.status === 'completed' ? getText(lang, 'Fertig', 'Completato', 'Completed') : a.status === 'pdf_uploaded' ? getText(lang, 'PDF hochgeladen', 'PDF caricato', 'PDF Uploaded') : getText(lang, 'Entwurf', 'Bozza', 'Draft'),
                          a.gpsScore || '',
                          a.wasScore || '',
                          a.wieCoreScore || '',
                          a.wieLeaderScore || '',
                          coreScores.fach || coreScores.c1 || '',
                          coreScores.komm || coreScores.c2 || '',
                          coreScores.prob || coreScores.c3 || '',
                          coreScores.adapt || coreScores.c4 || '',
                          coreScores.orga || coreScores.c5 || '',
                          leaderScores.lead || leaderScores.l1 || '',
                          leaderScores.strat || leaderScores.l2 || '',
                          leaderScores.decide || leaderScores.l3 || '',
                          leaderScores.exec || leaderScores.l4 || '',
                          leaderScores.stake || leaderScores.l5 || '',
                          (formData.strengths1 || '').replace(/[\n\r]+/g, ' '),
                          (formData.strengths2 || '').replace(/[\n\r]+/g, ' '),
                          (formData.careerComment || '').replace(/[\n\r]+/g, ' '),
                          (formData.wishesNextYear || '').replace(/[\n\r]+/g, ' '),
                          (formData.feedbackManager || '').replace(/[\n\r]+/g, ' '),
                          a.createdAt ? new Date(a.createdAt).toLocaleDateString('de-DE') : '',
                          a.updatedAt ? new Date(a.updatedAt).toLocaleDateString('de-DE') : ''
                        ];
                      });
                      
                      const escapeCSV = (val) => {
                        if (val === null || val === undefined) return '';
                        const str = String(val);
                        if (str.includes(';') || str.includes('"') || str.includes('\n')) {
                          return '"' + str.replace(/"/g, '""') + '"';
                        }
                        return str;
                      };
                      
                      const csvContent = '\uFEFF' + headers.map(escapeCSV).join(';') + '\n' + rows.map(row => row.map(escapeCSV).join(';')).join('\n');
                      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                      const link = document.createElement('a');
                      link.href = URL.createObjectURL(blob);
                      link.download = 'HR_Dashboard_Export_' + new Date().toISOString().split('T')[0] + '.csv';
                      link.click();
                    },
                    className: 'flex items-center gap-2 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg text-sm font-medium transition-colors'
                  },
                    React.createElement(Download, { size: 16 }),
                    getText(lang, 'Excel Export', 'Esporta Excel', 'Excel Export') + ' (' + filtered.length + ')'
                  )
                )
              ),
              
              // === TABELLE - √úBERARBEITETE VERSION ===
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border overflow-hidden' },
                React.createElement('div', { className: 'overflow-x-auto' },
                  React.createElement('table', { className: 'w-full text-sm' },
                    React.createElement('thead', { className: 'bg-slate-50 border-b' },
                      React.createElement('tr', null,
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee')),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'F√ºhrungskraft', 'Manager', 'Manager')),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'Typ', 'Tipo', 'Type')),
                        React.createElement('th', { className: 'px-4 py-3 text-center font-semibold' }, 'GPS'),
                        React.createElement('th', { className: 'px-4 py-3 text-center font-semibold' }, getText(lang, 'WAS', 'COSA', 'WHAT')),
                        React.createElement('th', { className: 'px-4 py-3 text-center font-semibold' }, getText(lang, 'WIE', 'COME', 'HOW')),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, 'Status'),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'Datum', 'Data', 'Date')),
                        React.createElement('th', { className: 'px-4 py-3 text-center font-semibold' }, getText(lang, 'Aktionen', 'Azioni', 'Actions'))
                      )
                    ),
                    React.createElement('tbody', { className: 'divide-y' },
                      filtered.length === 0 
                        ? React.createElement('tr', null,
                            React.createElement('td', { colSpan: 9, className: 'px-4 py-12 text-center text-slate-500' },
                              getText(lang, 'Keine Daten gefunden', 'Nessun dato', 'No data found')
                            )
                          )
                        : filtered.map(a => {
                            const name = a.employeeName || a.formData?.employee || '‚Äì';
                            const manager = a.formData?.manager || '‚Äì';
                            const position = a.formData?.position || a.position || '';
                            
                            // GPS-Score: Falls nicht vorhanden, berechne live
                            let gps = a.gpsScore || 0;
                            let was = a.wasScore || 0;
                            let wie = a.wieCoreScore || 0;
                            
                            // Live-Berechnung falls GPS fehlt aber Daten vorhanden sind
                            if (gps === 0 && (a.selfCoreScores || a.coreScores)) {
                              const calcScores = calculateGPSForAppraisal(a);
                              gps = calcScores.gpsScore;
                              was = calcScores.wasScore || was;
                              wie = calcScores.wieCoreScore || wie;
                            }
                            
                            const isSelf = a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection' || a.type === 'self_assessment_standalone';
                            const isPdf = a.type === 'self_pdf' || a.isPdfUpload === true;
                            const isReview = a.type === 'review' || (!a.type && !isSelf && !isPdf);
                            const typeLabel = isPdf ? 'üìÑ PDF' : isSelf ? 'ü™û Self' : a.type === 'goals' ? 'üéØ Goals' : 'üìã Review';
                            const typeColor = isPdf ? 'bg-amber-100 text-amber-700' : isSelf ? 'bg-purple-100 text-purple-700' : 
                                              a.type === 'goals' ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700';
                            
                            const gpsColor = gps >= 3.5 ? 'bg-green-50 text-green-700' : 
                                             gps >= 2.5 ? 'bg-blue-50 text-blue-700' : 
                                             gps > 0 ? 'bg-orange-50 text-orange-700' : 'bg-slate-50 text-slate-400';
                            
                            return React.createElement('tr', { key: a.id, className: 'hover:bg-slate-50 group' },
                              React.createElement('td', { className: 'px-4 py-3' },
                                React.createElement('div', { className: 'font-medium text-slate-800' }, name),
                                React.createElement('div', { className: 'text-xs text-slate-500' }, position)
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-slate-600' }, manager),
                              React.createElement('td', { className: 'px-4 py-3' },
                                React.createElement('span', { className: 'px-2 py-1 rounded-full text-xs font-medium ' + typeColor }, typeLabel)
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-center' },
                                React.createElement('span', { className: 'px-2 py-1 rounded font-bold ' + gpsColor }, gps > 0 ? gps.toFixed(2) : '‚Äì')
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-center text-slate-600' }, was > 0 ? (was > 5 ? was.toFixed(0) + '%' : was.toFixed(2)) : '‚Äì'),
                              React.createElement('td', { className: 'px-4 py-3 text-center text-slate-600' }, wie > 0 ? wie.toFixed(2) : '‚Äì'),
                              React.createElement('td', { className: 'px-4 py-3' },
                                React.createElement('span', { 
                                  className: 'px-2 py-1 rounded-full text-xs ' + (a.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700')
                                }, a.status === 'completed' ? '‚úì' : '‚úé')
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-slate-500 text-xs' },
                                a.updatedAt ? new Date(a.updatedAt).toLocaleDateString('de-DE') : 
                                a.createdAt ? new Date(a.createdAt).toLocaleDateString('de-DE') : '‚Äì'
                              ),
                              // Aktions-Spalte
                              React.createElement('td', { className: 'px-4 py-3' },
                                React.createElement('div', { className: 'flex gap-1 opacity-50 group-hover:opacity-100 transition-opacity' },
                                  // Ansehen Button
                                  React.createElement('button', {
                                    onClick: () => setHrViewAppraisal(a),
                                    className: 'p-1.5 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 transition-colors',
                                    title: getText(lang, 'Ansehen', 'Visualizza', 'View')
                                  }, React.createElement(Eye, { size: 14 })),
                                  // Im Formular bearbeiten Button (√∂ffnet AppraisalForm)
                                  React.createElement('button', {
                                    onClick: () => {
                                      devLog('üîß HR Edit - Originaldaten:', a);
                                      devLog('   - coreScores:', a.coreScores);
                                      devLog('   - goals:', a.goals);
                                      // Erstelle das Team-Context-Objekt, das AppraisalForm erwartet
                                      const teamContext = {
                                        employee: {
                                          id: a.employeeId || a.id,
                                          name: a.employeeName || a.formData?.employee || 'Unbekannt',
                                          email: a.employeeEmail || a.formData?.employeeEmail || '',
                                          position: a.position || a.formData?.position || ''
                                        },
                                        appraisalId: a.id || a.docId, // WICHTIG: ID f√ºr Update
                                        period: a.period || new Date().getFullYear(),
                                        existingData: a, // Die komplette Beurteilung als existingData
                                        isHREdit: true, // Markierung dass HR Admin bearbeitet
                                        // WICHTIG: Manager-Referenz beibehalten damit FK Zugriff beh√§lt!
                                        managerId: a.managerId || a.userId || null,
                                        managerName: a.managerName || a.formData?.manager || ''
                                      };
                                      devLog('üîß HR Edit - TeamContext wird gespeichert:', teamContext);
                                      // WICHTIG: safeLocalStorage.setItem macht bereits JSON.stringify!
                                      safeLocalStorage.setItem('nw_current_employee', teamContext);
                                      // Wechsle zur Formular-Ansicht
                                      setActiveView('formular');
                                    },
                                    className: 'p-1.5 rounded-lg bg-purple-50 text-purple-600 hover:bg-purple-100 transition-colors',
                                    title: getText(lang, 'Im Formular bearbeiten', 'Modifica nel modulo', 'Edit in Form')
                                  }, React.createElement(Edit2, { size: 14 })),
                                  // PDF Export Button
                                  React.createElement('button', {
                                    onClick: () => exportHRAppraisalAsPDF(a),
                                    className: 'p-1.5 rounded-lg bg-emerald-50 text-emerald-600 hover:bg-emerald-100 transition-colors',
                                    title: getText(lang, 'PDF Export', 'Esporta PDF', 'Export PDF')
                                  }, React.createElement(Download, { size: 14 })),
                                  // Drucken Button
                                  React.createElement('button', {
                                    onClick: () => printHRAppraisal(a),
                                    className: 'p-1.5 rounded-lg bg-slate-50 text-slate-600 hover:bg-slate-100 transition-colors',
                                    title: getText(lang, 'Drucken', 'Stampa', 'Print')
                                  }, React.createElement(FileText, { size: 14 })),
                                  // L√∂schen Button
                                  React.createElement('button', {
                                    onClick: () => setHrDeleteConfirm(a),
                                    className: 'p-1.5 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 transition-colors',
                                    title: getText(lang, 'L√∂schen', 'Elimina', 'Delete')
                                  }, React.createElement(Trash2, { size: 14 }))
                                )
                              )
                            );
                          })
                    )
                  )
                )
              ),
              
              // GPS Neuberechnungs-Button
              React.createElement('div', { className: 'flex justify-end' },
                React.createElement('button', {
                  onClick: recalculateAllGPS,
                  disabled: hrRecalculating,
                  className: 'px-4 py-2 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 disabled:opacity-50 text-sm font-medium flex items-center gap-2 transition-colors'
                },
                  hrRecalculating 
                    ? React.createElement(Loader2, { size: 16, className: 'animate-spin' })
                    : React.createElement(RefreshCw, { size: 16 }),
                  getText(lang, 
                    hrRecalculating ? 'Berechne GPS...' : 'üîÑ GPS f√ºr alle neu berechnen', 
                    hrRecalculating ? 'Calcolo GPS...' : 'üîÑ Ricalcola GPS per tutti',
                    hrRecalculating ? 'Calculating GPS...' : 'üîÑ Recalculate GPS for all'
                  )
                )
              ),
              
              // === ANSICHT-MODAL ===
              hrViewAppraisal && React.createElement('div', { 
                className: 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4',
                onClick: () => setHrViewAppraisal(null)
              },
                React.createElement('div', { 
                  className: 'bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden',
                  onClick: e => e.stopPropagation()
                },
                  // Modal Header
                  React.createElement('div', { className: 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6' },
                    React.createElement('div', { className: 'flex justify-between items-start' },
                      React.createElement('div', null,
                        React.createElement('h2', { className: 'text-xl font-bold flex items-center gap-2' },
                          hrViewAppraisal.type === 'self' || hrViewAppraisal.type === 'self_assessment' || hrViewAppraisal.type === 'self-reflection' || hrViewAppraisal.type === 'self_assessment_standalone' ? 'ü™û' : 'üìã',
                          hrViewAppraisal.employeeName || hrViewAppraisal.formData?.employee || 'N/A'
                        ),
                        React.createElement('p', { className: 'text-white/80 text-sm mt-1' },
                          (hrViewAppraisal.formData?.position || '') + (hrViewAppraisal.formData?.manager ? ` ‚Ä¢ ${getText(lang, 'FK', 'Manager', 'Manager')}: ${hrViewAppraisal.formData.manager}` : '')
                        )
                      ),
                      React.createElement('button', {
                        onClick: () => setHrViewAppraisal(null),
                        className: 'w-8 h-8 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center'
                      }, React.createElement(X, { size: 18 }))
                    ),
                    // Score-Badges
                    React.createElement('div', { className: 'flex gap-3 mt-4' },
                      React.createElement('span', { className: 'px-3 py-1 rounded-full bg-white/20 text-sm font-bold' },
                        'GPS: ' + (hrViewAppraisal.gpsScore ? hrViewAppraisal.gpsScore.toFixed(2) : calculateGPSForAppraisal(hrViewAppraisal).gpsScore.toFixed(2))
                      ),
                      hrViewAppraisal.wieCoreScore && React.createElement('span', { className: 'px-3 py-1 rounded-full bg-white/20 text-sm' },
                        'WIE: ' + hrViewAppraisal.wieCoreScore.toFixed(2)
                      ),
                      hrViewAppraisal.wasScore && React.createElement('span', { className: 'px-3 py-1 rounded-full bg-white/20 text-sm' },
                        'WAS: ' + (hrViewAppraisal.wasScore > 5 ? hrViewAppraisal.wasScore.toFixed(0) + '%' : hrViewAppraisal.wasScore.toFixed(2))
                      ),
                      React.createElement('span', { 
                        className: 'px-3 py-1 rounded-full text-sm ' + (hrViewAppraisal.status === 'completed' ? 'bg-green-500/30' : 'bg-amber-500/30')
                      }, hrViewAppraisal.status === 'completed' ? '‚úì Fertig' : '‚úé Entwurf')
                    )
                  ),
                  
                  // Modal Body - Scrollbar
                  React.createElement('div', { className: 'overflow-y-auto max-h-[60vh] p-6 space-y-6' },
                    
                    // === Ziele (falls vorhanden) ===
                    hrViewAppraisal.goals && hrViewAppraisal.goals.length > 0 && React.createElement('div', null,
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-3 flex items-center gap-2' },
                        React.createElement('span', null, 'üéØ'),
                        getText(lang, 'Ziele (WAS)', 'Obiettivi (COSA)', 'Goals (WHAT)')
                      ),
                      React.createElement('div', { className: 'bg-slate-50 rounded-xl p-4 space-y-3' },
                        hrViewAppraisal.goals.map((g, i) => 
                          React.createElement('div', { key: i, className: 'flex items-center gap-3 bg-white rounded-lg p-3 border' },
                            React.createElement('span', { className: 'text-lg font-bold text-slate-400' }, i + 1),
                            React.createElement('div', { className: 'flex-1' },
                              React.createElement('p', { className: 'font-medium text-slate-800' }, g.name || g.n || 'N/A'),
                              React.createElement('div', { className: 'flex gap-4 text-xs text-slate-500 mt-1' },
                                React.createElement('span', null, getText(lang, 'Gewicht', 'Peso', 'Weight') + ': ' + (g.weight || g.w || 0) + '%'),
                                React.createElement('span', { className: 'font-semibold text-blue-600' }, 
                                  getText(lang, 'Zielerreichung', 'Raggiungimento', 'Achievement') + ': ' + (g.achievement || g.a || 0) + '%'
                                )
                              )
                            )
                          )
                        )
                      )
                    ),
                    
                    // === Core Kompetenzen ===
                    (hrViewAppraisal.selfCoreScores || hrViewAppraisal.coreScores) && React.createElement('div', null,
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-3 flex items-center gap-2' },
                        React.createElement('span', null, 'üí°'),
                        getText(lang, 'Kernkompetenzen (WIE)', 'Competenze Core (COME)', 'Core Competencies (HOW)')
                      ),
                      React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-3' },
                        (() => {
                          const scores = hrViewAppraisal.selfCoreScores || hrViewAppraisal.coreScores || {};
                          const comments = hrViewAppraisal.selfCoreComments || hrViewAppraisal.coreComments || {};
                          const compNames = {
                            fach: getText(lang, 'Fachkompetenz', 'Competenza', 'Expertise'),
                            komm: getText(lang, 'Kommunikation', 'Comunicazione', 'Communication'),
                            prob: getText(lang, 'Probleml√∂sung', 'Problem Solving', 'Problem Solving'),
                            adapt: getText(lang, 'Adaptivit√§t', 'Adattabilit√†', 'Adaptability'),
                            orga: getText(lang, 'Organisation', 'Organizzazione', 'Organization')
                          };
                          return Object.entries(scores).map(([key, value]) => 
                            React.createElement('div', { key, className: 'bg-slate-50 rounded-xl p-3 text-center' },
                              React.createElement('div', { className: 'text-2xl font-bold text-indigo-600' }, value || '‚Äì'),
                              React.createElement('div', { className: 'text-xs text-slate-600 mt-1' }, compNames[key] || key),
                              comments[key] && React.createElement('div', { className: 'text-xs text-slate-500 mt-2 italic truncate', title: comments[key] }, 
                                '"' + comments[key].substring(0, 30) + (comments[key].length > 30 ? '...' : '') + '"'
                              )
                            )
                          );
                        })()
                      )
                    ),
                    
                    // === Leader Kompetenzen (falls vorhanden) ===
                    (hrViewAppraisal.selfLeaderScores || hrViewAppraisal.leaderScores) && React.createElement('div', null,
                      React.createElement('h3', { className: 'font-semibold text-slate-800 mb-3 flex items-center gap-2' },
                        React.createElement('span', null, 'üëî'),
                        getText(lang, 'F√ºhrungskompetenzen', 'Competenze Leadership', 'Leadership Competencies')
                      ),
                      React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-3' },
                        (() => {
                          const scores = hrViewAppraisal.selfLeaderScores || hrViewAppraisal.leaderScores || {};
                          const compNames = {
                            lead: getText(lang, 'F√ºhrung', 'Leadership', 'Leadership'),
                            strat: getText(lang, 'Strategie', 'Strategia', 'Strategy'),
                            decide: getText(lang, 'Entscheidung', 'Decisione', 'Decision'),
                            exec: getText(lang, 'Execution', 'Esecuzione', 'Execution'),
                            stake: getText(lang, 'Stakeholder', 'Stakeholder', 'Stakeholder')
                          };
                          return Object.entries(scores).filter(([_, v]) => v > 0).map(([key, value]) => 
                            React.createElement('div', { key, className: 'bg-purple-50 rounded-xl p-3 text-center' },
                              React.createElement('div', { className: 'text-2xl font-bold text-purple-600' }, value || '‚Äì'),
                              React.createElement('div', { className: 'text-xs text-slate-600 mt-1' }, compNames[key] || key)
                            )
                          );
                        })()
                      )
                    ),
                    
                    // === Textfelder (St√§rken, W√ºnsche, Feedback) ===
                    hrViewAppraisal.formData && React.createElement('div', { className: 'space-y-4' },
                      hrViewAppraisal.formData.strengths1 && React.createElement('div', { className: 'bg-green-50 rounded-xl p-4 border border-green-200' },
                        React.createElement('h4', { className: 'font-semibold text-green-800 mb-2' }, 'üí™ ' + getText(lang, 'St√§rke 1', 'Punto di forza 1', 'Strength 1')),
                        React.createElement('p', { className: 'text-sm text-green-700 whitespace-pre-wrap' }, hrViewAppraisal.formData.strengths1)
                      ),
                      hrViewAppraisal.formData.strengths2 && React.createElement('div', { className: 'bg-green-50 rounded-xl p-4 border border-green-200' },
                        React.createElement('h4', { className: 'font-semibold text-green-800 mb-2' }, 'üí™ ' + getText(lang, 'St√§rke 2', 'Punto di forza 2', 'Strength 2')),
                        React.createElement('p', { className: 'text-sm text-green-700 whitespace-pre-wrap' }, hrViewAppraisal.formData.strengths2)
                      ),
                      hrViewAppraisal.formData.wishesNextYear && React.createElement('div', { className: 'bg-blue-50 rounded-xl p-4 border border-blue-200' },
                        React.createElement('h4', { className: 'font-semibold text-blue-800 mb-2' }, 'üéØ ' + getText(lang, 'W√ºnsche n√§chstes Jahr', 'Desideri anno prossimo', 'Wishes next year')),
                        React.createElement('p', { className: 'text-sm text-blue-700 whitespace-pre-wrap' }, hrViewAppraisal.formData.wishesNextYear)
                      ),
                      hrViewAppraisal.formData.feedbackManager && React.createElement('div', { className: 'bg-purple-50 rounded-xl p-4 border border-purple-200' },
                        React.createElement('h4', { className: 'font-semibold text-purple-800 mb-2' }, 'üí¨ ' + getText(lang, 'Feedback an F√ºhrungskraft', 'Feedback al manager', 'Feedback to manager')),
                        React.createElement('p', { className: 'text-sm text-purple-700 whitespace-pre-wrap' }, hrViewAppraisal.formData.feedbackManager)
                      ),
                      hrViewAppraisal.formData.careerComment && React.createElement('div', { className: 'bg-amber-50 rounded-xl p-4 border border-amber-200' },
                        React.createElement('h4', { className: 'font-semibold text-amber-800 mb-2' }, 'üìà ' + getText(lang, 'Karriere-Kommentar', 'Commento carriera', 'Career comment')),
                        React.createElement('p', { className: 'text-sm text-amber-700 whitespace-pre-wrap' }, hrViewAppraisal.formData.careerComment)
                      )
                    ),
                    
                    // === Meta-Informationen ===
                    React.createElement('div', { className: 'bg-slate-100 rounded-xl p-4 text-xs text-slate-600' },
                      React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
                        React.createElement('div', null,
                          React.createElement('span', { className: 'font-semibold' }, 'ID: '),
                          React.createElement('span', { className: 'font-mono' }, hrViewAppraisal.id?.substring(0, 8) + '...')
                        ),
                        React.createElement('div', null,
                          React.createElement('span', { className: 'font-semibold' }, 'Typ: '),
                          hrViewAppraisal.type || 'review'
                        ),
                        React.createElement('div', null,
                          React.createElement('span', { className: 'font-semibold' }, getText(lang, 'Erstellt', 'Creato', 'Created') + ': '),
                          hrViewAppraisal.createdAt ? new Date(hrViewAppraisal.createdAt).toLocaleDateString('de-DE') : '‚Äì'
                        ),
                        React.createElement('div', null,
                          React.createElement('span', { className: 'font-semibold' }, getText(lang, 'Aktualisiert', 'Aggiornato', 'Updated') + ': '),
                          hrViewAppraisal.updatedAt ? new Date(hrViewAppraisal.updatedAt).toLocaleDateString('de-DE') : '‚Äì'
                        )
                      )
                    )
                  ),
                  
                  // Modal Footer
                  React.createElement('div', { className: 'border-t p-4 flex justify-between items-center' },
                    React.createElement('button', {
                      onClick: () => { setHrDeleteConfirm(hrViewAppraisal); setHrViewAppraisal(null); },
                      className: 'px-4 py-2 bg-red-100 text-red-700 rounded-xl hover:bg-red-200 font-medium flex items-center gap-2'
                    }, React.createElement(Trash2, { size: 16 }), getText(lang, 'L√∂schen', 'Elimina', 'Delete')),
                    React.createElement('div', { className: 'flex gap-2' },
                      // PDF Export Button
                      React.createElement('button', {
                        onClick: () => exportHRAppraisalAsPDF(hrViewAppraisal),
                        className: 'px-4 py-2 bg-emerald-100 text-emerald-700 rounded-xl hover:bg-emerald-200 font-medium flex items-center gap-2'
                      }, React.createElement(Download, { size: 16 }), getText(lang, 'PDF', 'PDF', 'PDF')),
                      // Print Button
                      React.createElement('button', {
                        onClick: () => printHRAppraisal(hrViewAppraisal),
                        className: 'px-4 py-2 bg-blue-100 text-blue-700 rounded-xl hover:bg-blue-200 font-medium flex items-center gap-2'
                      }, React.createElement(FileText, { size: 16 }), getText(lang, 'Drucken', 'Stampa', 'Print')),
                      // Close Button
                      React.createElement('button', {
                        onClick: () => setHrViewAppraisal(null),
                        className: 'px-6 py-2 bg-slate-800 text-white rounded-xl hover:bg-slate-900 font-medium'
                      }, getText(lang, 'Schlie√üen', 'Chiudi', 'Close'))
                    )
                  )
                )
              ),
              
              // === L√ñSCH-BEST√ÑTIGUNG MODAL ===
              hrDeleteConfirm && React.createElement('div', { 
                className: 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4',
                onClick: () => setHrDeleteConfirm(null)
              },
                React.createElement('div', { 
                  className: 'bg-white rounded-2xl shadow-2xl max-w-md w-full p-6',
                  onClick: e => e.stopPropagation()
                },
                  React.createElement('div', { className: 'text-center' },
                    React.createElement('div', { className: 'w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4' },
                      React.createElement(Trash2, { size: 32, className: 'text-red-600' })
                    ),
                    React.createElement('h3', { className: 'text-xl font-bold text-slate-800 mb-2' },
                      getText(lang, 'Beurteilung l√∂schen?', 'Eliminare valutazione?', 'Delete appraisal?')
                    ),
                    React.createElement('p', { className: 'text-slate-600 mb-2' },
                      getText(lang, 'Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.', 'Questa azione non pu√≤ essere annullata.', 'This action cannot be undone.')
                    ),
                    React.createElement('div', { className: 'bg-slate-100 rounded-xl p-3 mb-6' },
                      React.createElement('p', { className: 'font-semibold text-slate-800' }, 
                        hrDeleteConfirm.employeeName || hrDeleteConfirm.formData?.employee || 'N/A'
                      ),
                      React.createElement('p', { className: 'text-sm text-slate-600' },
                        (hrDeleteConfirm.type === 'self' || hrDeleteConfirm.type === 'self_assessment' || hrDeleteConfirm.type === 'self-reflection' || hrDeleteConfirm.type === 'self_assessment_standalone' ? 'ü™û Selbstreflexion' : 'üìã Review') +
                        (hrDeleteConfirm.gpsScore ? ' ‚Ä¢ GPS: ' + hrDeleteConfirm.gpsScore.toFixed(2) : '')
                      )
                    ),
                    React.createElement('div', { className: 'flex gap-3' },
                      React.createElement('button', {
                        onClick: () => setHrDeleteConfirm(null),
                        className: 'flex-1 px-4 py-3 bg-slate-200 text-slate-700 rounded-xl hover:bg-slate-300 font-medium'
                      }, getText(lang, 'Abbrechen', 'Annulla', 'Cancel')),
                      React.createElement('button', {
                        onClick: () => deleteHRAppraisal(hrDeleteConfirm.id),
                        className: 'flex-1 px-4 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 font-medium'
                      }, getText(lang, 'Endg√ºltig l√∂schen', 'Elimina definitivamente', 'Delete permanently'))
                    )
                  )
                )
              ),
              
              // === BEARBEITEN-MODAL (HR ADMIN) ===
              hrEditAppraisal && React.createElement('div', { 
                className: 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4',
                onClick: () => setHrEditAppraisal(null)
              },
                React.createElement('div', { 
                  key: hrEditAppraisal.id || hrEditAppraisal.docId || Date.now(),
                  className: 'bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden',
                  onClick: e => e.stopPropagation()
                },
                  // Modal Header
                  React.createElement('div', { className: 'bg-gradient-to-r from-amber-500 to-orange-500 text-white p-6' },
                    React.createElement('div', { className: 'flex justify-between items-start' },
                      React.createElement('div', null,
                        React.createElement('h2', { className: 'text-xl font-bold flex items-center gap-2' },
                          React.createElement(Edit3, { size: 24 }),
                          getText(lang, 'Beurteilung bearbeiten', 'Modifica valutazione', 'Edit Appraisal')
                        ),
                        React.createElement('p', { className: 'text-white/80 text-sm mt-1' },
                          hrEditAppraisal.employeeName || hrEditAppraisal.formData?.employee || 'N/A'
                        )
                      ),
                      React.createElement('button', {
                        onClick: () => setHrEditAppraisal(null),
                        className: 'w-8 h-8 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center'
                      }, React.createElement(X, { size: 18 }))
                    )
                  ),
                  // Modal Body - Extended Edit Form
                  React.createElement('div', { className: 'p-5 overflow-y-auto max-h-[70vh] space-y-4' },
                    // Debug info - zeigt alle verf√ºgbaren Felder
                    React.createElement('details', { className: 'bg-gray-100 rounded p-2 text-xs text-gray-600 mb-2' },
                      React.createElement('summary', { className: 'cursor-pointer font-medium' }, 'Debug: Verf√ºgbare Daten anzeigen'),
                      React.createElement('pre', { className: 'mt-2 whitespace-pre-wrap overflow-auto max-h-40' },
                        JSON.stringify({
                          id: hrEditAppraisal.id || hrEditAppraisal.docId,
                          type: hrEditAppraisal.type,
                          status: hrEditAppraisal.status,
                          employeeName: hrEditAppraisal.employeeName,
                          gpsScore: hrEditAppraisal.gpsScore,
                          wasScore: hrEditAppraisal.wasScore,
                          wieScoreCore: hrEditAppraisal.wieScoreCore,
                          wieScoreLead: hrEditAppraisal.wieScoreLead,
                          formData: hrEditAppraisal.formData
                        }, null, 2)
                      )
                    ),
                    // === STAMMDATEN ===
                    React.createElement('div', { className: 'bg-slate-50 rounded-lg p-4' },
                      React.createElement('h4', { className: 'font-medium text-slate-700 mb-3' }, getText(lang, 'Stammdaten', 'Dati', 'Data')),
                      React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-3 gap-3' },
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee')),
                          React.createElement('input', { type: 'text', defaultValue: hrEditAppraisal.employeeName || hrEditAppraisal.formData?.employee || '', onChange: e => { hrEditAppraisal._editedName = e.target.value; }, className: 'w-full px-3 py-1.5 border rounded text-sm' })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, getText(lang, 'Position', 'Posizione', 'Position')),
                          React.createElement('input', { type: 'text', defaultValue: hrEditAppraisal.formData?.position || '', onChange: e => { hrEditAppraisal._editedPosition = e.target.value; }, className: 'w-full px-3 py-1.5 border rounded text-sm' })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, getText(lang, 'F√ºhrungskraft', 'Manager', 'Manager')),
                          React.createElement('input', { type: 'text', defaultValue: hrEditAppraisal.formData?.manager || '', onChange: e => { hrEditAppraisal._editedManager = e.target.value; }, className: 'w-full px-3 py-1.5 border rounded text-sm' })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, getText(lang, 'Status', 'Stato', 'Status')),
                          React.createElement('select', { defaultValue: hrEditAppraisal.status || 'draft', onChange: e => { hrEditAppraisal._editedStatus = e.target.value; }, className: 'w-full px-3 py-1.5 border rounded text-sm' },
                            React.createElement('option', { value: 'draft' }, getText(lang, 'Entwurf', 'Bozza', 'Draft')),
                            React.createElement('option', { value: 'completed' }, getText(lang, 'Abgeschlossen', 'Completato', 'Completed'))
                          )
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, getText(lang, 'Standort', 'Sede', 'Location')),
                          React.createElement('select', { defaultValue: hrEditAppraisal.formData?.location || hrEditAppraisal.location || '', onChange: e => { hrEditAppraisal._editedLocation = e.target.value; }, className: 'w-full px-3 py-1.5 border rounded text-sm' },
                            React.createElement('option', { value: '' }, '--'),
                            React.createElement('option', { value: 'Sulzberg' }, 'Sulzberg'),
                            React.createElement('option', { value: 'Bolzano' }, 'Bolzano'),
                            React.createElement('option', { value: 'Campogalliano' }, 'Campogalliano')
                          )
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, getText(lang, 'Typ', 'Tipo', 'Type')),
                          React.createElement('select', { defaultValue: hrEditAppraisal.type || 'review', onChange: e => { hrEditAppraisal._editedType = e.target.value; }, className: 'w-full px-3 py-1.5 border rounded text-sm' },
                            React.createElement('option', { value: 'review' }, 'Review'),
                            React.createElement('option', { value: 'self' }, 'Self'),
                            React.createElement('option', { value: 'goals' }, 'Goals')
                          )
                        )
                      )
                    ),
                    // === ZIELE ===
                    React.createElement('div', { className: 'bg-blue-50 rounded-lg p-4' },
                      React.createElement('h4', { className: 'font-medium text-blue-700 mb-3' }, getText(lang, 'Ziele (WAS)', 'Obiettivi', 'Goals')),
                      React.createElement('div', { className: 'space-y-2' },
                        React.createElement('div', { className: 'flex gap-2' },
                          React.createElement('input', { type: 'text', placeholder: getText(lang, 'Ziel 1', 'Obiettivo 1', 'Goal 1'), defaultValue: hrEditAppraisal.formData?.goal1 || '', onChange: e => { if(!hrEditAppraisal._goals) hrEditAppraisal._goals={}; hrEditAppraisal._goals.goal1=e.target.value; }, className: 'flex-1 px-2 py-1 border rounded text-xs' }),
                          React.createElement('input', { type: 'number', placeholder: '%', defaultValue: hrEditAppraisal.formData?.goal1Weight || '', onChange: e => { if(!hrEditAppraisal._goals) hrEditAppraisal._goals={}; hrEditAppraisal._goals.goal1Weight=parseInt(e.target.value)||0; }, className: 'w-14 px-2 py-1 border rounded text-xs' }),
                          React.createElement('select', { defaultValue: hrEditAppraisal.formData?.goal1Rating || '', onChange: e => { if(!hrEditAppraisal._goals) hrEditAppraisal._goals={}; hrEditAppraisal._goals.goal1Rating=parseInt(e.target.value)||0; }, className: 'w-14 px-1 py-1 border rounded text-xs' },
                            React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1')
                          )
                        ),
                        React.createElement('div', { className: 'flex gap-2' },
                          React.createElement('input', { type: 'text', placeholder: getText(lang, 'Ziel 2', 'Obiettivo 2', 'Goal 2'), defaultValue: hrEditAppraisal.formData?.goal2 || '', onChange: e => { if(!hrEditAppraisal._goals) hrEditAppraisal._goals={}; hrEditAppraisal._goals.goal2=e.target.value; }, className: 'flex-1 px-2 py-1 border rounded text-xs' }),
                          React.createElement('input', { type: 'number', placeholder: '%', defaultValue: hrEditAppraisal.formData?.goal2Weight || '', onChange: e => { if(!hrEditAppraisal._goals) hrEditAppraisal._goals={}; hrEditAppraisal._goals.goal2Weight=parseInt(e.target.value)||0; }, className: 'w-14 px-2 py-1 border rounded text-xs' }),
                          React.createElement('select', { defaultValue: hrEditAppraisal.formData?.goal2Rating || '', onChange: e => { if(!hrEditAppraisal._goals) hrEditAppraisal._goals={}; hrEditAppraisal._goals.goal2Rating=parseInt(e.target.value)||0; }, className: 'w-14 px-1 py-1 border rounded text-xs' },
                            React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1')
                          )
                        ),
                        React.createElement('div', { className: 'flex gap-2' },
                          React.createElement('input', { type: 'text', placeholder: getText(lang, 'Ziel 3', 'Obiettivo 3', 'Goal 3'), defaultValue: hrEditAppraisal.formData?.goal3 || '', onChange: e => { if(!hrEditAppraisal._goals) hrEditAppraisal._goals={}; hrEditAppraisal._goals.goal3=e.target.value; }, className: 'flex-1 px-2 py-1 border rounded text-xs' }),
                          React.createElement('input', { type: 'number', placeholder: '%', defaultValue: hrEditAppraisal.formData?.goal3Weight || '', onChange: e => { if(!hrEditAppraisal._goals) hrEditAppraisal._goals={}; hrEditAppraisal._goals.goal3Weight=parseInt(e.target.value)||0; }, className: 'w-14 px-2 py-1 border rounded text-xs' }),
                          React.createElement('select', { defaultValue: hrEditAppraisal.formData?.goal3Rating || '', onChange: e => { if(!hrEditAppraisal._goals) hrEditAppraisal._goals={}; hrEditAppraisal._goals.goal3Rating=parseInt(e.target.value)||0; }, className: 'w-14 px-1 py-1 border rounded text-xs' },
                            React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1')
                          )
                        )
                      )
                    ),
                    // === KOMPETENZEN ===
                    React.createElement('div', { className: 'bg-emerald-50 rounded-lg p-4' },
                      React.createElement('h4', { className: 'font-medium text-emerald-700 mb-3' }, getText(lang, 'Kompetenzen (WIE)', 'Competenze', 'Competencies')),
                      React.createElement('div', { className: 'grid grid-cols-5 gap-2 mb-2' },
                        React.createElement('div', null, React.createElement('label', { className: 'block text-xs mb-1' }, 'C1'), React.createElement('select', { defaultValue: hrEditAppraisal.formData?.c1 || '', onChange: e => { if(!hrEditAppraisal._comps) hrEditAppraisal._comps={}; hrEditAppraisal._comps.c1=parseInt(e.target.value)||0; }, className: 'w-full px-1 py-1 border rounded text-xs' }, React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1'))),
                        React.createElement('div', null, React.createElement('label', { className: 'block text-xs mb-1' }, 'C2'), React.createElement('select', { defaultValue: hrEditAppraisal.formData?.c2 || '', onChange: e => { if(!hrEditAppraisal._comps) hrEditAppraisal._comps={}; hrEditAppraisal._comps.c2=parseInt(e.target.value)||0; }, className: 'w-full px-1 py-1 border rounded text-xs' }, React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1'))),
                        React.createElement('div', null, React.createElement('label', { className: 'block text-xs mb-1' }, 'C3'), React.createElement('select', { defaultValue: hrEditAppraisal.formData?.c3 || '', onChange: e => { if(!hrEditAppraisal._comps) hrEditAppraisal._comps={}; hrEditAppraisal._comps.c3=parseInt(e.target.value)||0; }, className: 'w-full px-1 py-1 border rounded text-xs' }, React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1'))),
                        React.createElement('div', null, React.createElement('label', { className: 'block text-xs mb-1' }, 'C4'), React.createElement('select', { defaultValue: hrEditAppraisal.formData?.c4 || '', onChange: e => { if(!hrEditAppraisal._comps) hrEditAppraisal._comps={}; hrEditAppraisal._comps.c4=parseInt(e.target.value)||0; }, className: 'w-full px-1 py-1 border rounded text-xs' }, React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1'))),
                        React.createElement('div', null, React.createElement('label', { className: 'block text-xs mb-1' }, 'C5'), React.createElement('select', { defaultValue: hrEditAppraisal.formData?.c5 || '', onChange: e => { if(!hrEditAppraisal._comps) hrEditAppraisal._comps={}; hrEditAppraisal._comps.c5=parseInt(e.target.value)||0; }, className: 'w-full px-1 py-1 border rounded text-xs' }, React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1')))
                      ),
                      React.createElement('div', { className: 'grid grid-cols-5 gap-2 pt-2 border-t border-emerald-200' },
                        React.createElement('div', null, React.createElement('label', { className: 'block text-xs mb-1 text-purple-600' }, 'L1'), React.createElement('select', { defaultValue: hrEditAppraisal.formData?.l1 || '', onChange: e => { if(!hrEditAppraisal._comps) hrEditAppraisal._comps={}; hrEditAppraisal._comps.l1=parseInt(e.target.value)||0; }, className: 'w-full px-1 py-1 border rounded text-xs' }, React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1'))),
                        React.createElement('div', null, React.createElement('label', { className: 'block text-xs mb-1 text-purple-600' }, 'L2'), React.createElement('select', { defaultValue: hrEditAppraisal.formData?.l2 || '', onChange: e => { if(!hrEditAppraisal._comps) hrEditAppraisal._comps={}; hrEditAppraisal._comps.l2=parseInt(e.target.value)||0; }, className: 'w-full px-1 py-1 border rounded text-xs' }, React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1'))),
                        React.createElement('div', null, React.createElement('label', { className: 'block text-xs mb-1 text-purple-600' }, 'L3'), React.createElement('select', { defaultValue: hrEditAppraisal.formData?.l3 || '', onChange: e => { if(!hrEditAppraisal._comps) hrEditAppraisal._comps={}; hrEditAppraisal._comps.l3=parseInt(e.target.value)||0; }, className: 'w-full px-1 py-1 border rounded text-xs' }, React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1'))),
                        React.createElement('div', null, React.createElement('label', { className: 'block text-xs mb-1 text-purple-600' }, 'L4'), React.createElement('select', { defaultValue: hrEditAppraisal.formData?.l4 || '', onChange: e => { if(!hrEditAppraisal._comps) hrEditAppraisal._comps={}; hrEditAppraisal._comps.l4=parseInt(e.target.value)||0; }, className: 'w-full px-1 py-1 border rounded text-xs' }, React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1'))),
                        React.createElement('div', null, React.createElement('label', { className: 'block text-xs mb-1 text-purple-600' }, 'L5'), React.createElement('select', { defaultValue: hrEditAppraisal.formData?.l5 || '', onChange: e => { if(!hrEditAppraisal._comps) hrEditAppraisal._comps={}; hrEditAppraisal._comps.l5=parseInt(e.target.value)||0; }, className: 'w-full px-1 py-1 border rounded text-xs' }, React.createElement('option', { value: '' }, '-'), React.createElement('option', { value: '5' }, '5'), React.createElement('option', { value: '4' }, '4'), React.createElement('option', { value: '3' }, '3'), React.createElement('option', { value: '2' }, '2'), React.createElement('option', { value: '1' }, '1')))
                      )
                    ),
                    // === KOMMENTARE ===
                    React.createElement('div', { className: 'bg-amber-50 rounded-lg p-4' },
                      React.createElement('h4', { className: 'font-medium text-amber-700 mb-3' }, getText(lang, 'Kommentare', 'Commenti', 'Comments')),
                      React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, getText(lang, 'St√§rken', 'Punti forza', 'Strengths')),
                          React.createElement('textarea', { rows: 2, defaultValue: hrEditAppraisal.formData?.strengths || '', onChange: e => { hrEditAppraisal._editedStrengths = e.target.value; }, className: 'w-full px-2 py-1 border rounded text-xs' })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, getText(lang, 'Entwicklung', 'Sviluppo', 'Development')),
                          React.createElement('textarea', { rows: 2, defaultValue: hrEditAppraisal.formData?.developmentAreas || '', onChange: e => { hrEditAppraisal._editedDevAreas = e.target.value; }, className: 'w-full px-2 py-1 border rounded text-xs' })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, getText(lang, 'Gesamtkommentar', 'Commento', 'Comment')),
                          React.createElement('textarea', { rows: 2, defaultValue: hrEditAppraisal.formData?.overallComment || '', onChange: e => { hrEditAppraisal._editedComment = e.target.value; }, className: 'w-full px-2 py-1 border rounded text-xs' })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, getText(lang, 'Karriere', 'Carriera', 'Career')),
                          React.createElement('textarea', { rows: 2, defaultValue: hrEditAppraisal.formData?.careerComment || '', onChange: e => { hrEditAppraisal._editedCareer = e.target.value; }, className: 'w-full px-2 py-1 border rounded text-xs' })
                        )
                      )
                    ),
                    // === GPS OVERRIDE ===
                    React.createElement('div', { className: 'bg-red-50 rounded-lg p-4' },
                      React.createElement('h4', { className: 'font-medium text-red-700 mb-3' }, 'GPS Override'),
                      React.createElement('div', { className: 'grid grid-cols-4 gap-3' },
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, 'GPS'),
                          React.createElement('input', { type: 'number', step: '0.01', min: 1, max: 5, defaultValue: hrEditAppraisal.gpsScore || '', onChange: e => { hrEditAppraisal._editedGPS = parseFloat(e.target.value)||0; }, className: 'w-full px-2 py-1 border border-red-300 rounded text-xs' })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, 'WAS'),
                          React.createElement('input', { type: 'number', step: '0.01', min: 1, max: 5, defaultValue: hrEditAppraisal.wasScore || '', onChange: e => { hrEditAppraisal._editedWAS = parseFloat(e.target.value)||0; }, className: 'w-full px-2 py-1 border border-red-300 rounded text-xs' })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, 'WIE Core'),
                          React.createElement('input', { type: 'number', step: '0.01', min: 1, max: 5, defaultValue: hrEditAppraisal.wieScoreCore || '', onChange: e => { hrEditAppraisal._editedWIECore = parseFloat(e.target.value)||0; }, className: 'w-full px-2 py-1 border border-red-300 rounded text-xs' })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-xs text-slate-600 mb-1' }, 'WIE Lead'),
                          React.createElement('input', { type: 'number', step: '0.01', min: 1, max: 5, defaultValue: hrEditAppraisal.wieScoreLead || '', onChange: e => { hrEditAppraisal._editedWIELead = parseFloat(e.target.value)||0; }, className: 'w-full px-2 py-1 border border-red-300 rounded text-xs' })
                        )
                      )
                    )
                  ),
                  // Modal Footer
                  React.createElement('div', { className: 'border-t border-slate-200 p-4 flex justify-end gap-3' },
                    React.createElement('button', {
                      onClick: () => setHrEditAppraisal(null),
                      className: 'px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors'
                    }, getText(lang, 'Abbrechen', 'Annulla', 'Cancel')),
                    React.createElement('button', {
                      onClick: async () => {
                        try {
                          // Baue formData korrekt auf (Firestore akzeptiert keine Dot-Notation in update)
                          const fd = hrEditAppraisal.formData || {};
                          const newFd = { ...fd };
                          // Stammdaten
                          if (hrEditAppraisal._editedName) newFd.employee = hrEditAppraisal._editedName;
                          if (hrEditAppraisal._editedPosition) newFd.position = hrEditAppraisal._editedPosition;
                          if (hrEditAppraisal._editedManager) newFd.manager = hrEditAppraisal._editedManager;
                          if (hrEditAppraisal._editedLocation) newFd.location = hrEditAppraisal._editedLocation;
                          // Ziele
                          if (hrEditAppraisal._goals) Object.assign(newFd, hrEditAppraisal._goals);
                          // Kompetenzen
                          if (hrEditAppraisal._comps) Object.assign(newFd, hrEditAppraisal._comps);
                          // Kommentare
                          if (hrEditAppraisal._editedStrengths) newFd.strengths = hrEditAppraisal._editedStrengths;
                          if (hrEditAppraisal._editedDevAreas) newFd.developmentAreas = hrEditAppraisal._editedDevAreas;
                          if (hrEditAppraisal._editedComment) newFd.overallComment = hrEditAppraisal._editedComment;
                          if (hrEditAppraisal._editedCareer) newFd.careerComment = hrEditAppraisal._editedCareer;
                          
                          const updates = {
                            formData: newFd,
                            updatedAt: new Date().toISOString(),
                            updatedBy: user?.email || 'HR Admin',
                            lastEditedByHR: true
                          };
                          // Top-level fields
                          if (hrEditAppraisal._editedName) updates.employeeName = hrEditAppraisal._editedName;
                          if (hrEditAppraisal._editedStatus) updates.status = hrEditAppraisal._editedStatus;
                          if (hrEditAppraisal._editedType) updates.type = hrEditAppraisal._editedType;
                          if (hrEditAppraisal._editedLocation) updates.location = hrEditAppraisal._editedLocation;
                          // GPS Override
                          if (hrEditAppraisal._editedGPS) updates.gpsScore = hrEditAppraisal._editedGPS;
                          if (hrEditAppraisal._editedWAS) updates.wasScore = hrEditAppraisal._editedWAS;
                          if (hrEditAppraisal._editedWIECore) updates.wieScoreCore = hrEditAppraisal._editedWIECore;
                          if (hrEditAppraisal._editedWIELead) updates.wieScoreLead = hrEditAppraisal._editedWIELead;
                          
                          await db.collection('appraisals').doc(hrEditAppraisal.id).update(updates);
                          devLog('Beurteilung aktualisiert');
                          setHrEditAppraisal(null);
                          // Refresh data
                          window.location.reload();
                        } catch (err) {
                          console.error('Fehler beim Speichern:', err);
                          showToast(getText(lang, 'Fehler beim Speichern', 'Errore nel salvataggio', 'Error saving'), 'error');
                        }
                      },
                      className: 'px-6 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors font-medium'
                    }, getText(lang, 'Speichern', 'Salva', 'Save'))
                  )
                )
              ),
              
              // Footer
              React.createElement('div', { className: 'text-center text-xs text-slate-400 py-4' },
                'üîê HR Admin ‚Äì ' + (user?.email || '')
              )
            );
          };
          
          // === TEAM CALIBRATION RENDER FUNCTION ===
          const renderTeamCalibration = () => {
            // Sammle alle Reviews (type: 'review' oder kein type f√ºr R√ºckw√§rtskompatibilit√§t)
            const allReviews = teamAppraisals.filter(a => a.type === 'review' || !a.type);
            
            // Completed = Reviews mit status 'completed' UND gpsScore > 0
            const completedReviews = allReviews.filter(a => a.status === 'completed' && a.gpsScore && a.gpsScore > 0);
            
            // Drafts = Reviews mit status 'draft' ODER ohne gpsScore
            const draftReviews = allReviews.filter(a => a.status === 'draft' || !a.gpsScore || a.gpsScore === 0);
            
            // Reviews mit GPS f√ºr Statistiken (alle mit gpsScore > 0, unabh√§ngig vom Status)
            const reviewsWithGPS = allReviews.filter(a => a.gpsScore && a.gpsScore > 0);
            
            // Debug-Log
            devLog('üìä Team Calibration Filter:', {
              totalAppraisals: teamAppraisals.length,
              allReviews: allReviews.length,
              completed: completedReviews.length,
              drafts: draftReviews.length,
              withGPS: reviewsWithGPS.length,
              sample: allReviews[0] || null
            });
            
            // Team-Name aus user oder Fallback
            const teamName = user?.displayName ? `Team ${user.displayName.split(' ')[0]}` : getText(lang, 'Team-√úbersicht', 'Panoramica team', 'Team Overview');
            
            // Aktuelle Review-Periode
            const currentPeriod = new Date().getFullYear().toString();
            
            // === STATISTIK-BERECHNUNGEN ===
            
            // Hilfsfunktion: WAS % zu BARS konvertieren
            const convertWAStoBARS = (percentage) => {
              if (percentage < 70) return 1;
              if (percentage < 90) return 2;
              if (percentage <= 110) return 3;
              if (percentage <= 130) return 4;
              return 5;
            };
            
            // Hilfsfunktion: Standardabweichung berechnen
            const calculateStdDev = (values) => {
              if (values.length === 0) return 0;
              if (values.length === 1) return 0; // Keine Streuung bei einem Wert
              const avg = values.reduce((sum, v) => sum + v, 0) / values.length;
              const squareDiffs = values.map(v => Math.pow(v - avg, 2));
              const avgSquareDiff = squareDiffs.reduce((sum, v) => sum + v, 0) / values.length;
              return Math.sqrt(avgSquareDiff);
            };
            
            // Hilfsfunktion: WIE-Durchschnitt aus Kompetenzen berechnen
            // WICHTIG: Daten werden als coreScores/leaderScores Objekte gespeichert, NICHT als Arrays!
            const calculateWieAverage = (review) => {
              const ratings = [];
              
              // Core Scores aus coreScores Objekt (Format: { c1: 3, c2: 4, ... })
              if (review.coreScores && typeof review.coreScores === 'object') {
                Object.values(review.coreScores).forEach(rating => {
                  if (typeof rating === 'number' && rating > 0) {
                    ratings.push(rating);
                  }
                });
              }
              
              // Leadership Scores aus leaderScores Objekt (Format: { l1: 3, l2: 4, ... })
              if (review.leaderScores && typeof review.leaderScores === 'object') {
                Object.values(review.leaderScores).forEach(rating => {
                  if (typeof rating === 'number' && rating > 0) {
                    ratings.push(rating);
                  }
                });
              }
              
              // Fallback: Direkt wieCoreScore und wieLeaderScore nutzen falls vorhanden
              if (ratings.length === 0) {
                if (review.wieCoreScore && review.wieCoreScore > 0) {
                  ratings.push(review.wieCoreScore);
                }
                if (review.wieLeaderScore && review.wieLeaderScore > 0) {
                  ratings.push(review.wieLeaderScore);
                }
              }
              
              return ratings.length > 0 ? ratings.reduce((sum, r) => sum + r, 0) / ratings.length : 0;
            };
            
            // Hilfsfunktion: WAS-Score berechnen (aus goals)
            const calculateWasScore = (review) => {
              // Erst pr√ºfen ob wasScore direkt gespeichert ist
              if (review.wasScore && review.wasScore > 0) {
                return review.wasScore;
              }
              
              // Sonst aus goals berechnen
              if (!review.goals || !Array.isArray(review.goals) || review.goals.length === 0) return null;
              const validGoals = review.goals.filter(g => g.weight > 0);
              if (validGoals.length === 0) return null;
              
              let weightedSum = 0;
              let totalWeight = 0;
              validGoals.forEach(g => {
                const achievement = g.achievement || 0;
                const barsScore = convertWAStoBARS(achievement);
                weightedSum += barsScore * (g.weight / 100);
                totalWeight += g.weight / 100;
              });
              return totalWeight > 0 ? weightedSum / totalWeight : null;
            };
            
            // Z√§hle eindeutige Mitarbeiter aus allen Reviews (unternehmenweit)
            const uniqueEmployees = new Set();
            allReviews.forEach(r => {
              if (r.employeeId) uniqueEmployees.add(r.employeeId);
              if (r.employeeName) uniqueEmployees.add(r.employeeName);
            });
            // Fallback auf teamMembers wenn keine Reviews vorhanden
            const totalEmployeeCount = uniqueEmployees.size > 0 ? uniqueEmployees.size : teamMembers.length;
            
            // Berechne Selbstreflexionen separat (alle Typen)
            const selfReflections = teamAppraisals.filter(a => a.type === 'self' || a.type === 'self-reflection' || a.type === 'self_assessment' || a.type === 'self_assessment_standalone' || a.type === 'self_pdf');
            
            // Berechne alle Statistiken
            const stats = {
              totalMembers: totalEmployeeCount,
              totalReviews: allReviews.length,
              completedReviews: completedReviews.length,
              draftReviews: draftReviews.length,
              selfReflections: selfReflections.length,
              avgGPS: 0,
              avgWAS: 0,
              avgWIE: 0,
              stdDev: 0
            };
            
            // Nur berechnen wenn Reviews mit GPS vorhanden
            if (reviewsWithGPS.length > 0) {
              // GPS Durchschnitt
              const gpsValues = reviewsWithGPS.map(r => r.gpsScore || 0).filter(v => v > 0);
              if (gpsValues.length > 0) {
                stats.avgGPS = gpsValues.reduce((sum, v) => sum + v, 0) / gpsValues.length;
                // Standardabweichung
                stats.stdDev = calculateStdDev(gpsValues);
              }
              
              // WAS Durchschnitt - nutze wasScore direkt falls vorhanden
              const wasScores = reviewsWithGPS
                .map(r => r.wasScore || calculateWasScore(r))
                .filter(s => s !== null && s > 0);
              if (wasScores.length > 0) {
                stats.avgWAS = wasScores.reduce((sum, v) => sum + v, 0) / wasScores.length;
              }
              
              // WIE Durchschnitt - nutze wieCoreScore/wieLeaderScore falls vorhanden
              const wieScores = reviewsWithGPS.map(r => {
                // Erst direkte Scores nutzen
                if (r.wieCoreScore && r.wieCoreScore > 0) {
                  if (r.includeLeadership && r.wieLeaderScore && r.wieLeaderScore > 0) {
                    return (r.wieCoreScore + r.wieLeaderScore) / 2;
                  }
                  return r.wieCoreScore;
                }
                // Sonst berechnen
                return calculateWieAverage(r);
              }).filter(s => s > 0);
              
              if (wieScores.length > 0) {
                stats.avgWIE = wieScores.reduce((sum, v) => sum + v, 0) / wieScores.length;
              }
            }
            
            // Debug-Log (kann sp√§ter entfernt werden)
            devLog('üìä Team Calibration Stats:', {
              allReviews: allReviews.length,
              reviewsWithGPS: reviewsWithGPS.length,
              stats,
              sampleReview: reviewsWithGPS[0] || null
            });
            
            // === RENDER ===
            return React.createElement('div', { className: "space-y-6 pb-12" },
              
              // HERO HEADER mit Gradient (Unternehmensfarben)
              React.createElement('div', { 
                className: "rounded-2xl p-6 md:p-8 text-white shadow-xl",
                style: { background: "linear-gradient(135deg, #243186 0%, #1a2563 50%, #243186 100%)" }
              },
                // Titel-Zeile
                React.createElement('div', { className: "flex flex-col md:flex-row md:items-center md:justify-between mb-6" },
                  React.createElement('div', null,
                    React.createElement('h1', { className: "text-2xl md:text-3xl font-bold mb-2 flex items-center gap-3" },
                      React.createElement(Scale, { size: 28 }),
                      lang === 'de' ? `Team-Kalibrierung: ${teamName}` : lang === 'it' ? `Calibrazione Team: ${teamName}` : `Team Calibration: ${teamName}`
                    ),
                    React.createElement('p', { className: "text-white/80" },
                      `${stats.totalMembers} ${lang === 'de' ? 'Mitarbeiter' : lang === 'it' ? 'Collaboratori' : 'Employees'} | Review-Periode: ${currentPeriod}`
                    )
                  ),
                  // Status-Badge
                  React.createElement('div', { className: "mt-4 md:mt-0 flex items-center gap-2" },
                    React.createElement('span', { 
                      className: "bg-white/20 backdrop-blur px-4 py-2 rounded-full text-sm font-medium"
                    },
                      `${stats.draftReviews} ${lang === 'de' ? 'Entw√ºrfe' : lang === 'it' ? 'Bozze' : 'Drafts'} | ${stats.completedReviews} ${lang === 'de' ? 'Fertig' : lang === 'it' ? 'Completate' : 'Completed'}`
                    )
                  )
                ),
                
                // Stats Grid
                reviewsWithGPS.length > 0 
                  ? React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4" },
                      // GPS Durchschnitt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, stats.avgGPS.toFixed(1)),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'GPS √ò' : lang === 'it' ? 'GPS Medio' : 'GPS Avg'
                        )
                      ),
                      // WAS Durchschnitt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, 
                          stats.avgWAS > 0 ? stats.avgWAS.toFixed(1) : '‚Äì'
                        ),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'WAS √ò' : lang === 'it' ? 'COSA Medio' : 'WHAT Avg'
                        )
                      ),
                      // WIE Durchschnitt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, stats.avgWIE.toFixed(1)),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'WIE √ò' : lang === 'it' ? 'COME Medio' : 'HOW Avg'
                        )
                      ),
                      // Standardabweichung
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, stats.stdDev.toFixed(2)),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, "Std.Dev")
                      ),
                      // Fortschritt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center col-span-2 md:col-span-1" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, 
                          `${stats.completedReviews}/${stats.totalMembers}`
                        ),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'Fortschritt' : lang === 'it' ? 'Progresso' : 'Progress'
                        )
                      )
                    )
                  : // Keine Reviews vorhanden
                    React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-6 text-center" },
                      React.createElement('p', { className: "text-white/80 text-lg" },
                        lang === 'de' 
                          ? 'üìã Noch keine Reviews abgeschlossen. Starte mit dem ersten Performance Review!'
                          : 'üìã Nessuna review completata. Inizia con la prima Performance Review!'
                      )
                    )
              ),
              
              // === FILTER & SORTIERUNGS-TOOLBAR ===
              reviewsWithGPS.length > 0 && React.createElement('div', { 
                className: "bg-white rounded-xl p-4 shadow-sm border border-slate-200 flex flex-col md:flex-row md:items-center gap-4"
              },
                // Filter
                React.createElement('div', { className: "flex items-center gap-2" },
                  React.createElement('span', { className: "text-sm font-medium text-slate-600" }, 
                    lang === 'de' ? 'Filter:' : lang === 'it' ? 'Filtro:' : 'Filter:'
                  ),
                  React.createElement('div', { className: "flex bg-slate-100 rounded-lg p-1" },
                    React.createElement('button', {
                      onClick: () => setCalibrationFilter('all'),
                      className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${
                        calibrationFilter === 'all' 
                          ? 'bg-white text-slate-800 shadow-sm' 
                          : 'text-slate-500 hover:text-slate-700'
                      }`
                    }, lang === 'de' ? 'Alle' : lang === 'it' ? 'Tutti' : 'All'),
                    React.createElement('button', {
                      onClick: () => setCalibrationFilter('completed'),
                      className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${
                        calibrationFilter === 'completed' 
                          ? 'bg-green-100 text-green-800 shadow-sm' 
                          : 'text-slate-500 hover:text-slate-700'
                      }`
                    }, `‚úì ${lang === 'de' ? 'Fertig' : lang === 'it' ? 'Completate' : 'Completed'}`),
                    React.createElement('button', {
                      onClick: () => setCalibrationFilter('draft'),
                      className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${
                        calibrationFilter === 'draft' 
                          ? 'bg-amber-100 text-amber-800 shadow-sm' 
                          : 'text-slate-500 hover:text-slate-700'
                      }`
                    }, `‚úé ${lang === 'de' ? 'Entw√ºrfe' : lang === 'it' ? 'Bozze' : 'Drafts'}`)
                  )
                ),
                
                // Trennlinie
                React.createElement('div', { className: "hidden md:block w-px h-8 bg-slate-200" }),
                
                // Sortierung
                React.createElement('div', { className: "flex items-center gap-2" },
                  React.createElement('span', { className: "text-sm font-medium text-slate-600" }, 
                    lang === 'de' ? 'Sortieren:' : lang === 'it' ? 'Ordina:' : 'Sort:'
                  ),
                  React.createElement('select', {
                    value: `${calibrationSort.field}-${calibrationSort.direction}`,
                    onChange: (e) => {
                      const [field, direction] = e.target.value.split('-');
                      setCalibrationSort({ field, direction });
                    },
                    className: "px-3 py-1.5 text-sm border border-slate-200 rounded-lg bg-white focus:ring-2 focus:ring-[#6EBD84] outline-none"
                  },
                    React.createElement('option', { value: 'name-asc' }, lang === 'de' ? 'Name A-Z' : lang === 'it' ? 'Nome A-Z' : 'Name A-Z'),
                    React.createElement('option', { value: 'name-desc' }, lang === 'de' ? 'Name Z-A' : lang === 'it' ? 'Nome Z-A' : 'Name Z-A'),
                    React.createElement('option', { value: 'gps-desc' }, lang === 'de' ? 'GPS ‚Üì (h√∂chste)' : lang === 'it' ? 'GPS ‚Üì (pi√π alto)' : 'GPS ‚Üì (highest)'),
                    React.createElement('option', { value: 'gps-asc' }, lang === 'de' ? 'GPS ‚Üë (niedrigste)' : lang === 'it' ? 'GPS ‚Üë (pi√π basso)' : 'GPS ‚Üë (lowest)'),
                    React.createElement('option', { value: 'was-desc' }, lang === 'de' ? 'WAS ‚Üì (h√∂chste)' : lang === 'it' ? 'COSA ‚Üì (pi√π alto)' : 'WHAT ‚Üì (highest)'),
                    React.createElement('option', { value: 'was-asc' }, lang === 'de' ? 'WAS ‚Üë (niedrigste)' : lang === 'it' ? 'COSA ‚Üë (pi√π basso)' : 'WHAT ‚Üë (lowest)'),
                    React.createElement('option', { value: 'wie-desc' }, lang === 'de' ? 'WIE ‚Üì (h√∂chste)' : lang === 'it' ? 'COME ‚Üì (pi√π alto)' : 'HOW ‚Üì (highest)'),
                    React.createElement('option', { value: 'wie-asc' }, lang === 'de' ? 'WIE ‚Üë (niedrigste)' : lang === 'it' ? 'COME ‚Üë (pi√π basso)' : 'HOW ‚Üë (lowest)')
                  )
                ),
                
                // Spacer
                React.createElement('div', { className: "flex-1" }),
                
                // Anzahl gefiltert
                React.createElement('span', { className: "text-sm text-slate-500" },
                  (() => {
                    const filtered = calibrationFilter === 'all' ? reviewsWithGPS :
                                     calibrationFilter === 'completed' ? completedReviews : draftReviews;
                    return `${filtered.length} ${lang === 'de' ? 'angezeigt' : lang === 'it' ? 'visualizzati' : 'displayed'}`;
                  })()
                )
              ),
              
              // Info-Box (falls keine Reviews)
              reviewsWithGPS.length === 0 && React.createElement('div', { 
                className: "bg-gradient-to-br from-amber-50 to-orange-50 border-2 border-amber-200 rounded-2xl p-8 text-center" 
              },
                React.createElement('div', { className: "max-w-md mx-auto" },
                  React.createElement('div', { className: "bg-amber-100 rounded-full p-4 w-16 h-16 mx-auto mb-4 flex items-center justify-center" },
                    React.createElement(Info, { size: 32, className: "text-amber-600" })
                  ),
                  React.createElement('h3', { className: "font-bold text-amber-900 text-xl mb-3" },
                    lang === 'de' ? 'Noch keine Daten f√ºr Kalibrierung' : lang === 'it' ? 'Nessun dato per la calibrazione' : 'No data for calibration yet'
                  ),
                  React.createElement('p', { className: "text-amber-800 mb-4 leading-relaxed" },
                    lang === 'de' 
                      ? 'Um Bubble Chart, Heatmap und Warnungen zu sehen, m√ºssen zuerst Performance Reviews mit GPS-Bewertung f√ºr deine Team-Mitglieder erstellt werden.'
                      : 'Per visualizzare Bubble Chart, Heatmap e avvisi, devono prima essere create le Performance Review con valutazione GPS per i membri del team.'
                  ),
                  // Checkliste
                  React.createElement('div', { className: "bg-white rounded-xl p-4 mb-4 text-left border border-amber-200" },
                    React.createElement('div', { className: "text-sm font-medium text-amber-900 mb-2" },
                      lang === 'de' ? 'So startest du:' : lang === 'it' ? 'Come iniziare:' : 'How to start:'
                    ),
                    React.createElement('ul', { className: "text-sm text-amber-800 space-y-1.5" },
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "1."),
                        lang === 'de' ? 'Gehe zu "Team-√úbersicht"' : lang === 'it' ? 'Vai a "Panoramica team"' : 'Go to "Team Overview"'
                      ),
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "2."),
                        lang === 'de' ? 'W√§hle einen Mitarbeiter und starte ein Review' : lang === 'it' ? 'Seleziona un collaboratore e inizia una review' : 'Select an employee and start a review'
                      ),
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "3."),
                        lang === 'de' ? 'F√ºlle WAS (Ziele) und WIE (Kompetenzen) aus' : lang === 'it' ? 'Compila COSA (obiettivi) e COME (competenze)' : 'Fill in WHAT (goals) and HOW (competencies)'
                      ),
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "4."),
                        lang === 'de' ? 'Speichere das Review (GPS wird automatisch berechnet)' : lang === 'it' ? 'Salva la review (GPS viene calcolato automaticamente)' : 'Save the review (GPS is calculated automatically)'
                      )
                    )
                  ),
                  React.createElement('button', {
                    onClick: () => setActiveView('teamoverview'),
                    className: "flex items-center gap-2 px-6 py-3 bg-amber-600 text-white rounded-2xl hover:bg-amber-700 transition-colors font-medium mx-auto shadow-lg shadow-amber-200"
                  },
                    React.createElement(Users, { size: 18 }),
                    lang === 'de' ? 'Zur Team-√úbersicht' : lang === 'it' ? 'Vai alla panoramica team' : 'Go to Team Overview'
                  ),
                  // Draft-Hinweis falls vorhanden
                  draftReviews.length > 0 && React.createElement('p', { className: "text-sm text-amber-700 mt-4" },
                    lang === 'de' 
                      ? `üí° Du hast ${draftReviews.length} Entw√ºrfe. Schlie√üe diese ab, um GPS-Werte zu erhalten.`
                      : `üí° Hai ${draftReviews.length} bozze. Completale per ottenere i valori GPS.`
                  )
                )
              ),
              
              // === AUTO-WARNUNGEN ===
              reviewsWithGPS.length > 0 && (() => {
                const warnings = [];
                
                // Bereite Daten f√ºr Analyse vor
                const analysisData = reviewsWithGPS.map(review => {
                  const member = teamMembers.find(m => m.id === review.employeeId);
                  const name = review.employeeName || member?.name || 'Unbekannt';
                  const coreScores = review.coreScores || {};
                  const leaderScores = review.leaderScores || {};
                  
                  return {
                    name,
                    gps: review.gpsScore || 0,
                    wasScore: review.wasScore || 0,
                    kommunikation: coreScores.komm || coreScores.c2 || 0, // Kommunikation
                    mitarbeiterfuehrung: leaderScores.lead || leaderScores.l1 || 0, // Mitarbeiterf√ºhrung
                    includeLeadership: review.includeLeadership,
                    allScores: { ...coreScores, ...leaderScores }
                  };
                });
                
                // CHECK 1: Killer Criteria Verletzung
                // GPS > 2.5 aber Level 1 bei Kommunikation oder Mitarbeiterf√ºhrung
                analysisData.forEach(emp => {
                  if (emp.gps > 2.5) {
                    if (emp.kommunikation > 0 && emp.kommunikation === 1) {
                      warnings.push({
                        type: 'error',
                        title: lang === 'de' ? 'Killer Criteria Verletzung' : lang === 'it' ? 'Violazione Killer Criteria' : 'Killer Criteria Violation',
                        message: lang === 'de' 
                          ? `${emp.name}: GPS ${emp.gps.toFixed(1)} trotz Level ${emp.kommunikation} bei Kommunikation ‚Üí GPS sollte max. 2.5 sein!`
                          : `${emp.name}: GPS ${emp.gps.toFixed(1)} nonostante Livello ${emp.kommunikation} in Comunicazione ‚Üí GPS dovrebbe essere max. 2.5!`
                      });
                    }
                    if (emp.includeLeadership && emp.mitarbeiterfuehrung > 0 && emp.mitarbeiterfuehrung === 1) {
                      warnings.push({
                        type: 'error',
                        title: lang === 'de' ? 'Killer Criteria Verletzung' : lang === 'it' ? 'Violazione Killer Criteria' : 'Killer Criteria Violation',
                        message: lang === 'de'
                          ? `${emp.name}: GPS ${emp.gps.toFixed(1)} trotz Level ${emp.mitarbeiterfuehrung} bei Mitarbeiterf√ºhrung ‚Üí GPS sollte max. 2.5 sein!`
                          : `${emp.name}: GPS ${emp.gps.toFixed(1)} nonostante Livello ${emp.mitarbeiterfuehrung} in Gestione Personale ‚Üí GPS dovrebbe essere max. 2.5!`
                      });
                    }
                  }
                });
                
                // CHECK 2: ENTFERNT - WAS-GPS Unterschiede sind durch WIE-Komponente beabsichtigt
                // Die GPS-Formel (50% WAS + 50% WIE) f√ºhrt nat√ºrlich zu unterschiedlichen GPS bei gleichem WAS
                
                // CHECK 3: Verteilungs-Probleme (nur bei ausreichender Teamgr√∂√üe)
                const totalCount = analysisData.length;
                if (totalCount >= 5) {
                  // Zu viele Top-Performer (GPS >= 4.5) - nur bei mindestens 5 MA sinnvoll
                  const topPerformers = analysisData.filter(e => e.gps >= 4.5).length;
                  const topPercent = (topPerformers / totalCount) * 100;
                  if (topPercent > 25) {
                    warnings.push({
                      type: 'info',
                      title: lang === 'de' ? 'Verteilungs-Hinweis' : lang === 'it' ? 'Nota distribuzione' : 'Distribution Note',
                      message: lang === 'de'
                        ? `${topPercent.toFixed(0)}% mit GPS ‚â• 4.5 (${topPerformers}/${totalCount}). √úblich: 10-20%. Bewertung pr√ºfen?`
                        : `${topPercent.toFixed(0)}% con GPS ‚â• 4.5 (${topPerformers}/${totalCount}). Normale: 10-20%. Verificare?`
                    });
                  }
                  
                  // Check f√ºr Level 1 bei irgendeiner Kompetenz mit gutem GPS
                  analysisData.forEach(emp => {
                    const hasLevel1 = Object.values(emp.allScores).some(score => score === 1);
                    if (hasLevel1 && emp.gps >= 3.5) {
                      warnings.push({
                        type: 'warning',
                        title: lang === 'de' ? 'Level 1 bei gutem GPS' : lang === 'it' ? 'Livello 1 con buon GPS' : 'Level 1 with good GPS',
                        message: lang === 'de'
                          ? `${emp.name}: GPS ${emp.gps.toFixed(1)} aber mindestens 1x Level 1. Entwicklungsbedarf?`
                          : `${emp.name}: GPS ${emp.gps.toFixed(1)} ma almeno 1x Livello 1. Necessit√† di sviluppo?`
                      });
                    }
                  });
                }
                
                // Render Warnungen
                if (warnings.length === 0) {
                  // Keine Warnungen - Alles OK
                  return React.createElement('div', { 
                    className: "bg-green-50 border-2 border-green-300 rounded-xl p-4 mb-6 flex items-center gap-3"
                  },
                    React.createElement('span', { className: "text-2xl" }, "‚úÖ"),
                    React.createElement('div', { className: "text-green-800" },
                      React.createElement('span', { className: "font-semibold" }, 
                        lang === 'de' ? 'Keine Warnungen' : lang === 'it' ? 'Nessun avviso' : 'No warnings'
                      ),
                      React.createElement('span', { className: "ml-2" }, 
                        lang === 'de' ? '‚Äì Deine Bewertungen sind konsistent!' : lang === 'it' ? '‚Äì Le tue valutazioni sono coerenti!' : '‚Äì Your assessments are consistent!'
                      )
                    )
                  );
                }
                
                // Warnungen anzeigen
                return React.createElement('div', { className: "space-y-3 mb-6" },
                  // Header
                  React.createElement('div', { className: "flex items-center gap-2 text-slate-600 text-sm mb-2" },
                    React.createElement(AlertCircle, { size: 16 }),
                    React.createElement('span', null, 
                      lang === 'de' 
                        ? `${warnings.length} ${warnings.length === 1 ? 'Hinweis' : 'Hinweise'} zur Kalibrierung:`
                        : `${warnings.length} ${warnings.length === 1 ? 'avviso' : 'avvisi'} per la calibrazione:`
                    )
                  ),
                  // Warnungen
                  ...warnings.slice(0, 5).map((w, idx) => {
                    let bgColor, borderColor, textColor, icon;
                    if (w.type === 'error') {
                      bgColor = 'bg-red-50'; borderColor = 'border-red-400'; textColor = 'text-red-800'; icon = 'üö®';
                    } else if (w.type === 'warning') {
                      bgColor = 'bg-yellow-50'; borderColor = 'border-yellow-400'; textColor = 'text-yellow-800'; icon = '‚ö†Ô∏è';
                    } else {
                      bgColor = 'bg-blue-50'; borderColor = 'border-blue-400'; textColor = 'text-blue-800'; icon = 'üí°';
                    }
                    
                    return React.createElement('div', { 
                      key: idx,
                      className: `${bgColor} border-2 ${borderColor} rounded-lg p-4 flex items-start gap-3`
                    },
                      React.createElement('span', { className: "text-xl flex-shrink-0" }, icon),
                      React.createElement('div', { className: textColor },
                        React.createElement('div', { className: "font-semibold text-sm mb-1" }, w.title),
                        React.createElement('div', { className: "text-sm" }, w.message)
                      )
                    );
                  }),
                  // Falls mehr als 5 Warnungen
                  warnings.length > 5 && React.createElement('div', { 
                    className: "text-sm text-slate-500 text-center py-2"
                  },
                    lang === 'de' 
                      ? `... und ${warnings.length - 5} weitere Hinweise`
                      : `... e altri ${warnings.length - 5} avvisi`
                  )
                );
              })(),
              
              // === BUBBLE CHART: WAS vs. WIE ===
              reviewsWithGPS.length > 0 && (() => {
                // Chart-Dimensionen
                const width = 650;
                const height = 450;
                const padding = 55;
                
                // Scale-Funktionen (0-5 auf Pixel)
                const scaleX = (was) => padding + ((was / 5) * (width - 2 * padding));
                const scaleY = (wie) => height - padding - ((wie / 5) * (height - 2 * padding));
                
                // === CI-KONFORME BUBBLE-FARBEN (strikt nach GPS-Rating) ===
                const getBubbleColor = (gps) => {
                  if (gps > 4.50) return '#16a34a'; // Rating 5: Outstanding (Green-600)
                  if (gps > 3.50) return '#10b981'; // Rating 4: Exceeds (Emerald-500)
                  if (gps > 2.50) return '#2563eb'; // Rating 3: Meets (Blue-600)
                  if (gps > 1.50) return '#f97316'; // Rating 2: Needs Improvement (Orange-500)
                  return '#dc2626';                  // Rating 1: Fail (Red-600)
                };
                
                // === ACTION CARDS basierend auf GPS-Rating (A&O-Psychologie & F√ºhrungscoach-Perspektive) ===
                const getActionCard = (gps) => {
                  if (gps > 4.50) return { 
                    icon: 'üåü', 
                    rating: 'OUTSTANDING (5)', 
                    action: lang === 'de' 
                      ? '‚Üí Karrieregespr√§ch f√ºhren: Aufstiegsperspektiven kl√§ren\n‚Üí Stretch-Assignments & strategische Projekte\n‚Üí Als Mentor f√ºr andere einsetzen\n‚Üí Retention: Bindung aktiv st√§rken!' 
                      : lang === 'it' 
                      ? '‚Üí Colloquio carriera: chiarire prospettive\n‚Üí Progetti strategici & sfidanti\n‚Üí Usare come mentor per altri\n‚Üí Retention: rafforzare il legame!' 
                      : '‚Üí Career talk: clarify growth path\n‚Üí Stretch assignments & strategic projects\n‚Üí Deploy as mentor for others\n‚Üí Retention: actively strengthen bond!',
                    color: '#16a34a', bg: '#dcfce7'
                  };
                  if (gps > 3.50) return { 
                    icon: 'üöÄ', 
                    rating: 'EXCEEDS (4)', 
                    action: lang === 'de' 
                      ? '‚Üí St√§rken gezielt ausbauen & sichtbar machen\n‚Üí Verantwortung erweitern (Job Enrichment)\n‚Üí Als fachlicher Ansprechpartner positionieren\n‚Üí Entwicklungsziel f√ºr n√§chstes Level definieren' 
                      : lang === 'it' 
                      ? '‚Üí Sviluppare punti di forza & renderli visibili\n‚Üí Ampliare responsabilit√† (Job Enrichment)\n‚Üí Posizionare come referente tecnico\n‚Üí Definire obiettivo per il prossimo livello' 
                      : '‚Üí Leverage strengths & increase visibility\n‚Üí Expand responsibility (Job Enrichment)\n‚Üí Position as subject matter expert\n‚Üí Define goal for next level',
                    color: '#10b981', bg: '#d1fae5'
                  };
                  if (gps > 2.50) return { 
                    icon: '‚úÖ', 
                    rating: 'MEETS (3)', 
                    action: lang === 'de' 
                      ? '‚Üí Wertsch√§tzung aussprechen ‚Äì R√ºckgrat des Teams!\n‚Üí Stabilit√§t anerkennen, nicht nur "Stars" loben\n‚Üí Individuelle St√§rken identifizieren & nutzen\n‚Üí Bei Interesse: gezielte Entwicklungsimpulse' 
                      : lang === 'it' 
                      ? '‚Üí Esprimere apprezzamento ‚Äì spina dorsale!\n‚Üí Riconoscere stabilit√†, non solo le "star"\n‚Üí Identificare & utilizzare punti di forza\n‚Üí Se interessato: impulsi di sviluppo mirati' 
                      : '‚Üí Express appreciation ‚Äì team backbone!\n‚Üí Recognize stability, not just "stars"\n‚Üí Identify & leverage individual strengths\n‚Üí If interested: targeted development',
                    color: '#2563eb', bg: '#dbeafe'
                  };
                  if (gps > 1.50) return { 
                    icon: '‚ö†Ô∏è', 
                    rating: 'NEEDS IMPR. (2)', 
                    action: lang === 'de' 
                      ? '‚Üí Ursachenanalyse: Kompetenz, Motivation oder Kontext?\n‚Üí Klare Erwartungen & messbare Ziele setzen\n‚Üí Engmaschiges Feedback (alle 2-4 Wochen)\n‚Üí 90-Tage-Entwicklungsplan mit Meilensteinen' 
                      : lang === 'it' 
                      ? '‚Üí Analisi cause: competenza, motivazione o contesto?\n‚Üí Aspettative chiare & obiettivi misurabili\n‚Üí Feedback frequente (ogni 2-4 settimane)\n‚Üí Piano sviluppo 90 giorni con milestone' 
                      : '‚Üí Root cause: skill, motivation or context?\n‚Üí Clear expectations & measurable goals\n‚Üí Frequent feedback (every 2-4 weeks)\n‚Üí 90-day development plan with milestones',
                    color: '#f97316', bg: '#ffedd5'
                  };
                  return { 
                    icon: 'üö®', 
                    rating: 'FAIL (1)', 
                    action: lang === 'de' 
                      ? '‚Üí Sofortiges HR-Gespr√§ch ansetzen\n‚Üí Schriftlicher PIP mit klaren Konsequenzen\n‚Üí W√∂chentliche Check-ins dokumentieren\n‚Üí Rollenpassung & Alternativen pr√ºfen' 
                      : lang === 'it' 
                      ? '‚Üí Colloquio HR immediato\n‚Üí PIP scritto con conseguenze chiare\n‚Üí Check-in settimanali documentati\n‚Üí Verificare idoneit√† ruolo & alternative' 
                      : '‚Üí Schedule immediate HR meeting\n‚Üí Written PIP with clear consequences\n‚Üí Document weekly check-ins\n‚Üí Review role fit & alternatives',
                    color: '#dc2626', bg: '#fee2e2'
                  };
                };
                
                // Initialen aus Name
                const getInitials = (name) => {
                  const parts = name.trim().split(' ');
                  if (parts.length >= 2) {
                    return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
                  }
                  return name.substring(0, 2).toUpperCase();
                };
                
                // Bereite Mitarbeiter-Daten auf
                const bubbleData = reviewsWithGPS.map(review => {
                  const member = teamMembers.find(m => m.id === review.employeeId);
                  const name = review.employeeName || member?.name || 'Unknown';
                  const wasScore = review.wasScore || 0;
                  const coreScores = review.coreScores || {};
                  const leaderScores = review.leaderScores || {};
                  
                  const allWieScores = [
                    ...Object.values(coreScores).filter(v => v > 0),
                    ...(review.includeLeadership ? Object.values(leaderScores).filter(v => v > 0) : [])
                  ];
                  const wieAvg = allWieScores.length > 0 
                    ? allWieScores.reduce((s, v) => s + v, 0) / allWieScores.length 
                    : 0;
                  
                  return {
                    name,
                    gps: review.gpsScore || 0,
                    was: wasScore,
                    wie: wieAvg,
                    initials: getInitials(name)
                  };
                }).filter(e => e.gps > 0);
                
                // === SOLID BACKBONE ZONE (Rating 3 = 2.5 bis 3.5) ===
                const solidBackboneX1 = scaleX(2.5);
                const solidBackboneX2 = scaleX(3.5);
                const solidBackboneY1 = scaleY(3.5);
                const solidBackboneY2 = scaleY(2.5);
                
                // === 4 ARCHETYPEN-ZONEN ===
                const zones = [
                  { 
                    id: 'handlungsbedarf',
                    name: lang === 'de' ? 'HANDLUNGSBEDARF' : lang === 'it' ? 'AZIONE RICHIESTA' : 'ACTION REQUIRED',
                    x: padding, 
                    y: scaleY(2.5), 
                    w: scaleX(2.5) - padding, 
                    h: height - padding - scaleY(2.5),
                    fill: '#fee2e2', textColor: '#991b1b', icon: 'üö®'
                  },
                  { 
                    id: 'solo-star',
                    name: 'SOLO STAR',
                    x: scaleX(2.5), 
                    y: scaleY(2.5), 
                    w: width - padding - scaleX(2.5), 
                    h: height - padding - scaleY(2.5),
                    fill: '#ffedd5', textColor: '#9a3412', icon: 'üéØ'
                  },
                  { 
                    id: 'hidden-gem',
                    name: 'HIDDEN GEM',
                    x: padding, 
                    y: padding, 
                    w: scaleX(2.5) - padding, 
                    h: scaleY(2.5) - padding,
                    fill: '#fef9c3', textColor: '#854d0e', icon: 'üíé'
                  },
                  { 
                    id: 'role-model',
                    name: 'ROLE MODEL',
                    x: scaleX(2.5), 
                    y: padding, 
                    w: width - padding - scaleX(2.5), 
                    h: scaleY(2.5) - padding,
                    fill: '#dcfce7', textColor: '#166534', icon: '‚≠ê'
                  }
                ];
                
                return React.createElement('div', { className: "bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-slate-200 mb-6" },
                  // Header mit Icon
                  React.createElement('div', { className: "flex items-center justify-between mb-6" },
                    React.createElement('div', { className: "flex items-center gap-3" },
                      React.createElement('div', { className: "w-12 h-12 rounded-xl bg-gradient-to-br from-[#243186] to-[#1a2564] flex items-center justify-center shadow-lg" },
                        React.createElement('span', { className: "text-2xl" }, "üìä")
                      ),
                      React.createElement('div', null,
                        React.createElement('h3', { className: "text-xl md:text-2xl font-bold", style: { color: "#243186" } },
                          lang === 'de' ? 'GPS-Verteilung (9-Box Grid)' : lang === 'it' ? 'Distribuzione GPS (9-Box Grid)' : 'GPS Distribution (9-Box Grid)'
                        ),
                        React.createElement('p', { className: "text-sm text-slate-500" },
                          lang === 'de' ? 'WAS (Ergebnisse) vs. WIE (Verhalten)' : lang === 'it' ? 'COSA (Risultati) vs. COME (Comportamento)' : 'WHAT (Results) vs. HOW (Behavior)'
                        )
                      )
                    ),
                    // Legende (Rating-Farben)
                    React.createElement('div', { className: "hidden lg:flex items-center gap-3 text-xs" },
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#dc2626' } }),
                        React.createElement('span', { className: "text-slate-600" }, "1 (‚â§1.5)")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#f97316' } }),
                        React.createElement('span', { className: "text-slate-600" }, "2")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#2563eb' } }),
                        React.createElement('span', { className: "text-slate-600" }, "3")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#10b981' } }),
                        React.createElement('span', { className: "text-slate-600" }, "4")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#16a34a' } }),
                        React.createElement('span', { className: "text-slate-600" }, "5 (>4.5)")
                      )
                    )
                  ),
                  
                  // Chart Container
                  React.createElement('div', { className: "relative", style: { maxWidth: '850px', margin: '0 auto' } },
                    
                    // SVG Chart
                    React.createElement('svg', { 
                      viewBox: `0 0 ${width} ${height}`, 
                      className: "w-full h-auto",
                      style: { minHeight: '420px' }
                    },
                      // Definitionen (Schatten, etc.)
                      React.createElement('defs', null,
                        React.createElement('filter', { id: 'bubbleShadow', x: '-50%', y: '-50%', width: '200%', height: '200%' },
                          React.createElement('feDropShadow', { dx: '0', dy: '3', stdDeviation: '4', floodOpacity: '0.25' })
                        )
                      ),
                      
                      // === 4 ARCHETYPEN-ZONEN (Hintergrund) ===
                      ...zones.map(zone => 
                        React.createElement('g', { key: zone.id },
                          // Zone-Rechteck
                          React.createElement('rect', {
                            x: zone.x, y: zone.y, width: zone.w, height: zone.h,
                            fill: zone.fill, opacity: 0.7
                          }),
                          // Zone-Icon
                          React.createElement('text', {
                            x: zone.x + zone.w / 2, y: zone.y + zone.h / 2 - 8,
                            textAnchor: 'middle', fontSize: '28', opacity: 0.5
                          }, zone.icon),
                          // Zone-Label
                          React.createElement('text', {
                            x: zone.x + zone.w / 2, y: zone.y + zone.h / 2 + 20,
                            textAnchor: 'middle', fontSize: '11', fontWeight: 700,
                            fill: zone.textColor, opacity: 0.9
                          }, zone.name)
                        )
                      ),
                      
                      // === SOLID BACKBONE ZONE (Rating 3 - Meets Expectations) ===
                      React.createElement('rect', {
                        x: solidBackboneX1, y: solidBackboneY1,
                        width: solidBackboneX2 - solidBackboneX1,
                        height: solidBackboneY2 - solidBackboneY1,
                        fill: 'rgba(255,255,255,0.6)',
                        stroke: '#243186', strokeWidth: 2, strokeDasharray: '8,4',
                        rx: 6
                      }),
                      React.createElement('text', {
                        x: (solidBackboneX1 + solidBackboneX2) / 2, 
                        y: (solidBackboneY1 + solidBackboneY2) / 2 + 4,
                        textAnchor: 'middle', fontSize: '10', fontWeight: 600,
                        fill: '#243186', opacity: 0.8
                      }, 'SOLID BACKBONE'),
                      React.createElement('text', {
                        x: (solidBackboneX1 + solidBackboneX2) / 2, 
                        y: (solidBackboneY1 + solidBackboneY2) / 2 + 18,
                        textAnchor: 'middle', fontSize: '9', 
                        fill: '#243186', opacity: 0.6
                      }, '(Rating 3)'),
                      
                      // === ACHSEN-LABELS (CI-Blau) ===
                      React.createElement('text', {
                        x: width / 2, y: height - 8, textAnchor: 'middle',
                        fontSize: '13', fill: '#243186', fontWeight: 600
                      }, lang === 'de' ? 'WAS: Ergebnisse (Ziele) ‚Üí' : lang === 'it' ? 'COSA: Risultati (Obiettivi) ‚Üí' : 'WHAT: Results (Goals) ‚Üí'),
                      
                      React.createElement('text', {
                        x: 14, y: height / 2, textAnchor: 'middle',
                        transform: `rotate(-90 14 ${height / 2})`,
                        fontSize: '13', fill: '#243186', fontWeight: 600
                      }, lang === 'de' ? '‚Üë WIE: Verhalten (Kompetenzen)' : lang === 'it' ? '‚Üë COME: Comportamento (Competenze)' : '‚Üë HOW: Behavior (Competencies)'),
                      
                      // === SKALA X-ACHSE ===
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('g', { key: `x-${v}` },
                          React.createElement('line', {
                            x1: scaleX(v), y1: height - padding, x2: scaleX(v), y2: height - padding + 6,
                            stroke: '#243186', strokeWidth: 1.5
                          }),
                          React.createElement('text', {
                            x: scaleX(v), y: height - padding + 20, textAnchor: 'middle',
                            fontSize: '12', fill: '#243186', fontWeight: 500
                          }, v)
                        )
                      ),
                      
                      // === SKALA Y-ACHSE ===
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('g', { key: `y-${v}` },
                          React.createElement('line', {
                            x1: padding - 6, y1: scaleY(v), x2: padding, y2: scaleY(v),
                            stroke: '#243186', strokeWidth: 1.5
                          }),
                          React.createElement('text', {
                            x: padding - 14, y: scaleY(v) + 4, textAnchor: 'middle',
                            fontSize: '12', fill: '#243186', fontWeight: 500
                          }, v)
                        )
                      ),
                      
                      // === GRID-LINIEN (dezent) ===
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('line', {
                          key: `grid-x-${v}`,
                          x1: scaleX(v), y1: padding, x2: scaleX(v), y2: height - padding,
                          stroke: v === 3 ? '#243186' : '#cbd5e1', 
                          strokeWidth: v === 3 ? 1.5 : 0.5,
                          strokeDasharray: v === 3 ? '6,3' : 'none',
                          opacity: v === 3 ? 0.6 : 0.5
                        })
                      ),
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('line', {
                          key: `grid-y-${v}`,
                          x1: padding, y1: scaleY(v), x2: width - padding, y2: scaleY(v),
                          stroke: v === 3 ? '#243186' : '#cbd5e1', 
                          strokeWidth: v === 3 ? 1.5 : 0.5,
                          strokeDasharray: v === 3 ? '6,3' : 'none',
                          opacity: v === 3 ? 0.6 : 0.5
                        })
                      ),
                      
                      // === BUBBLES (Mitarbeiter) ===
                      ...bubbleData.map((emp, idx) => {
                        // Deterministischer Jitter basierend auf Name
                        const hashCode = (str) => {
                          let hash = 0;
                          for (let i = 0; i < str.length; i++) {
                            hash = ((hash << 5) - hash) + str.charCodeAt(i);
                            hash = hash & hash;
                          }
                          return hash;
                        };
                        
                        const nameHash = hashCode(emp.name || `emp${idx}`);
                        const jitterX = ((nameHash % 21) - 10);
                        const jitterY = (((nameHash >> 8) % 21) - 10);
                        
                        const baseCx = scaleX(emp.was || 3);
                        const baseCy = scaleY(emp.wie || 3);
                        const cx = Math.max(padding + 20, Math.min(width - padding - 20, baseCx + jitterX));
                        const cy = Math.max(padding + 20, Math.min(height - padding - 20, baseCy + jitterY));
                        
                        const r = Math.max(20, Math.min(38, emp.gps * 7.5));
                        const color = getBubbleColor(emp.gps);
                        
                        return React.createElement('g', { 
                          key: idx,
                          style: { cursor: 'pointer' },
                          onMouseEnter: () => setBubbleTooltip({ ...emp, cx, cy, r, actionCard: getActionCard(emp.gps) }),
                          onMouseLeave: () => setBubbleTooltip(null)
                        },
                          // Bubble mit Schatten
                          React.createElement('circle', {
                            cx, cy, r,
                            fill: color,
                            opacity: 0.85,
                            filter: 'url(#bubbleShadow)',
                            className: 'transition-all duration-200 hover:opacity-100'
                          }),
                          // Wei√üer Ring
                          React.createElement('circle', {
                            cx, cy, r: r - 2,
                            fill: 'none', stroke: 'white', strokeWidth: 2.5, opacity: 0.6
                          }),
                          // Initialen
                          React.createElement('text', {
                            x: cx, y: cy, textAnchor: 'middle', dy: '0.35em',
                            fill: 'white', fontWeight: 700, fontSize: r > 26 ? '14px' : '11px',
                            style: { textShadow: '0 1px 3px rgba(0,0,0,0.4)' }
                          }, emp.initials)
                        );
                      })
                    ),
                    
                    // === TOOLTIP MIT ACTION CARD ===
                    bubbleTooltip && (() => {
                      const tooltipX = (bubbleTooltip.cx / width) * 100;
                      const tooltipY = ((bubbleTooltip.cy - bubbleTooltip.r - 10) / height) * 100;
                      const showBelow = tooltipY < 20;
                      const adjustLeft = tooltipX < 20 ? 'translateX(-5%)' : tooltipX > 80 ? 'translateX(-95%)' : 'translateX(-50%)';
                      const action = bubbleTooltip.actionCard;
                      
                      return React.createElement('div', {
                        className: "absolute bg-white text-slate-800 rounded-xl shadow-2xl text-sm z-50 pointer-events-none border border-slate-200 overflow-hidden",
                        style: { 
                          left: `${tooltipX}%`, 
                          top: showBelow 
                            ? `${((bubbleTooltip.cy + bubbleTooltip.r + 10) / height) * 100}%`
                            : `${tooltipY}%`,
                          transform: showBelow ? `${adjustLeft} translateY(0)` : `${adjustLeft} translateY(-100%)`,
                          minWidth: '220px',
                          maxWidth: '280px'
                        }
                      },
                        // Header mit Name
                        React.createElement('div', { 
                          className: "px-4 py-3 border-b border-slate-100",
                          style: { backgroundColor: '#243186' }
                        },
                          React.createElement('div', { className: "font-bold text-white" }, bubbleTooltip.name)
                        ),
                        // GPS Score
                        React.createElement('div', { className: "px-4 py-3" },
                          React.createElement('div', { className: "flex items-center justify-between mb-3" },
                            React.createElement('span', { className: "text-slate-500 text-xs uppercase tracking-wide" }, "GPS Score"),
                            React.createElement('span', { 
                              className: "text-2xl font-bold",
                              style: { color: action.color }
                            }, bubbleTooltip.gps.toFixed(2))
                          ),
                          // WAS & WIE
                          React.createElement('div', { className: "grid grid-cols-2 gap-2 text-xs mb-3" },
                            React.createElement('div', { className: "bg-slate-50 rounded p-2 text-center" },
                              React.createElement('div', { className: "text-slate-400 mb-0.5" }, lang === 'de' ? 'WAS' : lang === 'it' ? 'COSA' : 'WHAT'),
                              React.createElement('div', { className: "font-semibold text-sm" }, bubbleTooltip.was > 0 ? bubbleTooltip.was.toFixed(1) : '‚Äì')
                            ),
                            React.createElement('div', { className: "bg-slate-50 rounded p-2 text-center" },
                              React.createElement('div', { className: "text-slate-400 mb-0.5" }, lang === 'de' ? 'WIE' : lang === 'it' ? 'COME' : 'HOW'),
                              React.createElement('div', { className: "font-semibold text-sm" }, bubbleTooltip.wie > 0 ? bubbleTooltip.wie.toFixed(1) : '‚Äì')
                            )
                          ),
                          // === ACTION CARD ===
                          React.createElement('div', { 
                            className: "rounded-lg p-3 text-xs",
                            style: { backgroundColor: action.bg }
                          },
                            React.createElement('div', { 
                              className: "font-bold mb-1 flex items-center gap-1.5",
                              style: { color: action.color }
                            },
                              React.createElement('span', null, action.icon),
                              React.createElement('span', null, action.rating)
                            ),
                            React.createElement('div', { className: "text-slate-700" },
                              React.createElement('span', { className: "font-medium" }, 'Action: '),
                              action.action
                            )
                          )
                        )
                      );
                    })()
                  ),
                  
                  // Mobile Legende
                  React.createElement('div', { className: "flex lg:hidden flex-wrap justify-center gap-2 mt-4 text-xs" },
                    [
                      { color: '#dc2626', label: '1' },
                      { color: '#f97316', label: '2' },
                      { color: '#2563eb', label: '3' },
                      { color: '#10b981', label: '4' },
                      { color: '#16a34a', label: '5' }
                    ].map((item, i) => 
                      React.createElement('div', { key: i, className: "flex items-center gap-1" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: item.color } }),
                        React.createElement('span', { className: "text-slate-600" }, item.label)
                      )
                    )
                  ),
                  
                  // === ARCHETYPEN-ERKL√ÑRUNG ===
                  React.createElement('div', { className: "mt-6 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-5 border border-slate-200" },
                    React.createElement('h4', { className: "text-sm font-bold mb-4 flex items-center gap-2", style: { color: '#243186' } },
                      React.createElement(Info, { size: 16 }),
                      lang === 'de' ? 'Die 4 Archetypen verstehen' : lang === 'it' ? 'Capire i 4 archetipi' : 'Understanding the 4 Archetypes'
                    ),
                    React.createElement('div', { className: "grid md:grid-cols-2 gap-3" },
                      // ROLE MODEL (oben rechts)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#166534' } },
                        React.createElement('span', { className: "text-xl" }, "‚≠ê"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#166534' } }, "ROLE MODEL"),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'High WAS + High WIE. Vorbilder, Mentoren, Bef√∂rderungskandidaten.'
                              : lang === 'it' ? 'High COSA + High COME. Modelli, mentori, candidati promozione.'
                              : 'High WHAT + High HOW. Role models, mentors, promotion candidates.'
                          )
                        )
                      ),
                      // HIDDEN GEM (oben links)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#854d0e' } },
                        React.createElement('span', { className: "text-xl" }, "üíé"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#854d0e' } }, "HIDDEN GEM"),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'Low WAS + High WIE. Tolles Verhalten, braucht klarere Ziele.'
                              : lang === 'it' ? 'Low COSA + High COME. Ottimo comportamento, serve obiettivi chiari.'
                              : 'Low WHAT + High HOW. Great behavior, needs clearer goals.'
                          )
                        )
                      ),
                      // SOLO STAR (unten rechts)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#9a3412' } },
                        React.createElement('span', { className: "text-xl" }, "üéØ"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#9a3412' } }, "SOLO STAR"),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'High WAS + Low WIE. Erreicht Ziele, aber WIE ist problematisch. Verhaltens-Coaching n√∂tig.'
                              : lang === 'it' ? 'High COSA + Low COME. Raggiunge obiettivi, ma COME problematico. Serve coaching.'
                              : 'High WHAT + Low HOW. Achieves goals, but HOW is problematic. Behavior coaching needed.'
                          )
                        )
                      ),
                      // HANDLUNGSBEDARF (unten links)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#991b1b' } },
                        React.createElement('span', { className: "text-xl" }, "üö®"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#991b1b' } }, 
                            lang === 'de' ? 'HANDLUNGSBEDARF' : lang === 'it' ? 'AZIONE RICHIESTA' : 'ACTION REQUIRED'
                          ),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'Low WAS + Low WIE. Intensive Unterst√ºtzung oder Rollenpassung pr√ºfen.'
                              : lang === 'it' ? 'Low COSA + Low COME. Supporto intensivo o valutare cambio ruolo.'
                              : 'Low WHAT + Low HOW. Intensive support or review role fit.'
                          )
                        )
                      )
                    )
                  ),
                  
                  // Kompakter Hinweis
                  React.createElement('p', { className: "text-xs text-slate-500 mt-4 text-center" },
                    lang === 'de' 
                      ? 'üí° Bubble-Gr√∂√üe = GPS-Score | Farbe = Rating (1-5) | Gestrichelte Box = Solid Backbone (Rating 3)'
                      : lang === 'it' ? 'üí° Dimensione bolla = GPS | Colore = Rating (1-5) | Box tratteggiata = Solid Backbone (Rating 3)'
                      : 'üí° Bubble size = GPS score | Color = Rating (1-5) | Dashed box = Solid Backbone (Rating 3)'
                  )
                );
              })(),
              
              // === KOMPETENZ-HEATMAP ===
              // Zeige ALLE Reviews (auch Entw√ºrfe), nicht nur die mit GPS > 0
              allReviews.length > 0 && (() => {
                // Hilfsfunktionen f√ºr Farbcodierung (Unternehmensfarben)
                const getColorForGPS = (gps) => {
                  if (!gps || gps <= 0) return 'bg-slate-100 text-slate-400';
                  if (gps < 2.0) return 'bg-red-100 text-red-800';
                  if (gps < 2.5) return 'bg-orange-100 text-orange-800';
                  if (gps < 3.5) return 'bg-[#E8F5ED] text-[#243186]'; // Niederwieser Blau auf hellem Gr√ºn
                  return 'bg-[#6EBD84] text-white'; // Niederwieser Gr√ºn
                };
                
                const getColorForLevel = (level) => {
                  if (!level || level <= 0) return 'bg-slate-50 text-slate-400';
                  if (level <= 1.4) return 'bg-red-100 text-red-800';
                  if (level <= 2.4) return 'bg-orange-100 text-orange-800';
                  if (level <= 3.4) return 'bg-[#E8F5ED] text-[#243186]'; // Niederwieser Blau
                  return 'bg-[#6EBD84] text-white'; // Niederwieser Gr√ºn
                };
                
                // Kompetenz-IDs
                const coreCompIds = ['fach', 'komm', 'prob', 'adapt', 'orga'];
                const leaderCompIds = ['lead', 'strat', 'decide', 'exec', 'stake'];
                
                // Kompetenz-Labels (kurz) - mit korrekten IDs
                const compLabels = {
                  de: { fach: 'Fach', komm: 'Komm', prob: 'Prob', adapt: 'Adapt', orga: 'Orga', lead: 'F√ºhrung', strat: 'Strat', decide: 'Entsch', exec: 'Exec', stake: 'Stakeh' },
                  it: { fach: 'Tecn', komm: 'Comm', prob: 'Prob', adapt: 'Adatt', orga: 'Orga', lead: 'Lead', strat: 'Strat', decide: 'Decis', exec: 'Exec', stake: 'Stakeh' },
                  en: { fach: 'Tech', komm: 'Comm', prob: 'Prob', adapt: 'Adapt', orga: 'Orga', lead: 'Lead', strat: 'Strat', decide: 'Decis', exec: 'Exec', stake: 'Stakeh' }
                };
                const labels = compLabels[lang] || compLabels.de;
                
                // Pr√ºfe ob mindestens ein Review Leadership hat
                const hasAnyLeadership = allReviews.some(r => r.includeLeadership && r.leaderScores);
                
                // === FILTER ANWENDEN ===
                const filteredReviews = (() => {
                  if (calibrationFilter === 'completed') {
                    return allReviews.filter(r => r.status === 'completed');
                  } else if (calibrationFilter === 'draft') {
                    return allReviews.filter(r => r.status === 'draft' || !r.status);
                  }
                  return allReviews;
                })();
                
                // Bereite Mitarbeiter-Daten auf
                const employeeData = filteredReviews.map(review => {
                  // Finde Mitarbeiter-Name
                  const member = teamMembers.find(m => m.id === review.employeeId);
                  const name = review.employeeName || member?.name || (lang === 'de' ? 'Unbekannt' : lang === 'it' ? 'Sconosciuto' : 'Unknown');
                  
                  // WAS Score (direkt oder berechnet)
                  const wasScore = review.wasScore || 0;
                  
                  // WIE Scores - normalisiere IDs (unterst√ºtze alle Formate)
                  const rawCoreScores = review.coreScores || {};
                  const rawLeaderScores = review.leaderScores || {};
                  
                  // Normalisiere Core Scores (unterst√ºtze ALLE ID-Formate)
                  // Format 1: fach, komm, prob, adapt, orga (neu)
                  // Format 2: c1, c2, c3, c4, c5 (alt)
                  // Format 3: Numerische IDs von Math.random() (ganz alt)
                  const coreKeys = Object.keys(rawCoreScores);
                  const coreValues = Object.values(rawCoreScores).filter(v => typeof v === 'number' && v > 0);
                  
                  // Wenn numerische Keys, dann nach Position mappen
                  const isNumericKeys = coreKeys.length > 0 && coreKeys.every(k => !isNaN(parseFloat(k)));
                  
                  let coreScores;
                  if (isNumericKeys && coreValues.length >= 5) {
                    // Alte Math.random() IDs - nimm die ersten 5 numerischen Werte
                    const sortedKeys = coreKeys.sort();
                    coreScores = {
                      fach: rawCoreScores[sortedKeys[0]] || 0,
                      komm: rawCoreScores[sortedKeys[1]] || 0,
                      prob: rawCoreScores[sortedKeys[2]] || 0,
                      adapt: rawCoreScores[sortedKeys[3]] || 0,
                      orga: rawCoreScores[sortedKeys[4]] || 0
                    };
                  } else {
                    // Standard: fach/komm oder c1/c2 Format
                    coreScores = {
                      fach: rawCoreScores.fach || rawCoreScores.c1 || 0,
                      komm: rawCoreScores.komm || rawCoreScores.c2 || 0,
                      prob: rawCoreScores.prob || rawCoreScores.c3 || 0,
                      adapt: rawCoreScores.adapt || rawCoreScores.c4 || 0,
                      orga: rawCoreScores.orga || rawCoreScores.c5 || 0
                    };
                  }
                  
                  // Gleiches f√ºr Leader Scores
                  const leaderKeys = Object.keys(rawLeaderScores);
                  const leaderValues = Object.values(rawLeaderScores).filter(v => typeof v === 'number' && v > 0);
                  const isNumericLeaderKeys = leaderKeys.length > 0 && leaderKeys.every(k => !isNaN(parseFloat(k)));
                  
                  let leaderScores;
                  if (isNumericLeaderKeys && leaderValues.length >= 5) {
                    const sortedKeys = leaderKeys.sort();
                    leaderScores = {
                      lead: rawLeaderScores[sortedKeys[0]] || 0,
                      strat: rawLeaderScores[sortedKeys[1]] || 0,
                      decide: rawLeaderScores[sortedKeys[2]] || 0,
                      exec: rawLeaderScores[sortedKeys[3]] || 0,
                      stake: rawLeaderScores[sortedKeys[4]] || 0
                    };
                  } else {
                    leaderScores = {
                      lead: rawLeaderScores.lead || rawLeaderScores.l1 || 0,
                      strat: rawLeaderScores.strat || rawLeaderScores.l2 || 0,
                      decide: rawLeaderScores.decide || rawLeaderScores.l3 || 0,
                      exec: rawLeaderScores.exec || rawLeaderScores.l4 || 0,
                      stake: rawLeaderScores.stake || rawLeaderScores.l5 || 0
                    };
                  }
                  
                  // WIE Durchschnitt
                  const allWieScores = [
                    ...Object.values(coreScores).filter(v => v > 0),
                    ...(review.includeLeadership ? Object.values(leaderScores).filter(v => v > 0) : [])
                  ];
                  const wieAvg = allWieScores.length > 0 
                    ? allWieScores.reduce((s, v) => s + v, 0) / allWieScores.length 
                    : 0;
                  
                  return {
                    id: review.id,
                    employeeId: review.employeeId,
                    name,
                    status: review.status,
                    gps: review.gpsScore || 0,
                    wasScore,
                    wieAvg,
                    coreScores,
                    leaderScores,
                    includeLeadership: review.includeLeadership,
                    note: calibrationNotes[review.id] || '' // Notiz hinzuf√ºgen
                  };
                })
                // === SORTIERUNG ANWENDEN ===
                .sort((a, b) => {
                  const { field, direction } = calibrationSort;
                  let comparison = 0;
                  
                  switch (field) {
                    case 'name':
                      comparison = a.name.localeCompare(b.name);
                      break;
                    case 'gps':
                      comparison = a.gps - b.gps;
                      break;
                    case 'was':
                      comparison = a.wasScore - b.wasScore;
                      break;
                    case 'wie':
                      comparison = a.wieAvg - b.wieAvg;
                      break;
                    default:
                      comparison = a.name.localeCompare(b.name);
                  }
                  
                  return direction === 'desc' ? -comparison : comparison;
                });
                
                // Team-Durchschnitte berechnen
                const calcAvg = (arr) => arr.length > 0 ? arr.reduce((s, v) => s + v, 0) / arr.length : 0;
                
                const teamAvg = {
                  gps: calcAvg(employeeData.map(e => e.gps).filter(v => v > 0)),
                  was: calcAvg(employeeData.map(e => e.wasScore).filter(v => v > 0)),
                  wie: calcAvg(employeeData.map(e => e.wieAvg).filter(v => v > 0)),
                  core: {},
                  leader: {}
                };
                
                // Durchschnitte pro Kompetenz
                coreCompIds.forEach(id => {
                  const vals = employeeData.map(e => e.coreScores[id]).filter(v => v > 0);
                  teamAvg.core[id] = calcAvg(vals);
                });
                
                if (hasAnyLeadership) {
                  leaderCompIds.forEach(id => {
                    const vals = employeeData.filter(e => e.includeLeadership).map(e => e.leaderScores[id]).filter(v => v > 0);
                    teamAvg.leader[id] = calcAvg(vals);
                  });
                }
                
                // Debug-Log f√ºr Heatmap-Daten
                devLog('üî• Heatmap Data:', {
                  employeeCount: employeeData.length,
                  hasLeadership: hasAnyLeadership,
                  teamAvg,
                  sampleEmployee: employeeData[0] || null,
                  colorTest: {
                    level1: getColorForLevel(1),
                    level2: getColorForLevel(2),
                    level3: getColorForLevel(3),
                    level4: getColorForLevel(4),
                    level5: getColorForLevel(5),
                    gps2_0: getColorForGPS(2.0),
                    gps3_0: getColorForGPS(3.0),
                    gps4_0: getColorForGPS(4.0)
                  }
                });
                
                // Render Heatmap
                return React.createElement('div', { className: "bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-slate-200" },
                  // Header
                  React.createElement('div', { className: "flex flex-col md:flex-row md:items-center md:justify-between mb-4" },
                    React.createElement('h3', { className: "text-xl md:text-2xl font-bold flex items-center gap-2", style: { color: "#243186" } },
                      "üî• ", lang === 'de' ? 'Kompetenz-Heatmap' : lang === 'it' ? 'Heatmap Competenze' : 'Competency Heatmap'
                    ),
                    // Legende (Unternehmensfarben)
                    React.createElement('div', { className: "flex flex-wrap gap-2 mt-3 md:mt-0 text-xs" },
                      React.createElement('span', { className: "px-2 py-1 rounded bg-red-100 text-red-800" }, "1 Kritisch"),
                      React.createElement('span', { className: "px-2 py-1 rounded bg-orange-100 text-orange-800" }, "2 Below"),
                      React.createElement('span', { className: "px-2 py-1 rounded bg-[#E8F5ED] text-[#243186]" }, "3 Baseline"),
                      React.createElement('span', { className: "px-2 py-1 rounded bg-[#6EBD84] text-white" }, "4-5 Top")
                    )
                  ),
                  
                  // === COACHING-INFO BOX ===
                  React.createElement('div', { className: "mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100" },
                    React.createElement('div', { className: "flex items-start gap-3" },
                      React.createElement('div', { className: "w-10 h-10 rounded-lg bg-[#243186] flex items-center justify-center flex-shrink-0" },
                        React.createElement(MessageCircle, { size: 20, className: "text-white" })
                      ),
                      React.createElement('div', { className: "flex-1" },
                        React.createElement('h4', { className: "font-bold text-[#243186] text-sm mb-2" },
                          lang === 'de' ? 'üí° Coaching-Tipps f√ºr das Feedbackgespr√§ch' : lang === 'it' ? 'üí° Suggerimenti di coaching per il colloquio' : 'üí° Coaching Tips for Feedback Conversations'
                        ),
                        React.createElement('div', { className: "grid md:grid-cols-2 gap-3 text-xs text-slate-700" },
                          React.createElement('div', { className: "flex items-start gap-2" },
                            React.createElement('span', { className: "text-red-500 font-bold" }, "1-2:"),
                            React.createElement('span', null, 
                              lang === 'de' ? 'Konkretes Beispiel erfragen. Gemeinsam 1-2 Ma√ünahmen definieren. Follow-up in 4 Wochen.'
                              : lang === 'it' ? 'Chiedere esempio concreto. Definire insieme 1-2 azioni. Follow-up in 4 settimane.'
                              : 'Ask for concrete example. Define 1-2 actions together. Follow-up in 4 weeks.'
                            )
                          ),
                          React.createElement('div', { className: "flex items-start gap-2" },
                            React.createElement('span', { className: "text-[#6EBD84] font-bold" }, "4-5:"),
                            React.createElement('span', null, 
                              lang === 'de' ? 'St√§rke anerkennen! Fragen: "Wie k√∂nnen Sie das Team damit unterst√ºtzen?"'
                              : lang === 'it' ? 'Riconoscere il punto di forza! Chiedere: "Come pu√≤ supportare il team con questo?"'
                              : 'Acknowledge strength! Ask: "How can you support the team with this?"'
                            )
                          )
                        )
                      )
                    )
                  ),
                  
                  // === KOMPETENZ-ERKL√ÑRUNGEN (aufklappbar) ===
                  React.createElement('details', { className: "mb-6 group" },
                    React.createElement('summary', { className: "cursor-pointer text-sm font-medium text-[#243186] hover:text-[#1a2564] flex items-center gap-2" },
                      React.createElement(HelpCircle, { size: 16 }),
                      lang === 'de' ? 'Kompetenzen erkl√§rt + Coaching-Fragen' : lang === 'it' ? 'Competenze spiegate + Domande di coaching' : 'Competencies explained + Coaching questions'
                    ),
                    React.createElement('div', { className: "mt-4 grid md:grid-cols-2 gap-3" },
                      // Kernkompetenzen
                      React.createElement('div', { className: "space-y-2" },
                        React.createElement('h5', { className: "font-bold text-slate-700 text-xs uppercase tracking-wide mb-2" }, 
                          lang === 'de' ? 'üìã Kernkompetenzen' : lang === 'it' ? 'üìã Competenze core' : 'üìã Core Competencies'
                        ),
                        // Fachkompetenz
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Fach ‚Äì Fachkompetenz & Anwendung' : lang === 'it' ? 'Fach ‚Äì Competenza tecnica & Applicazione' : 'Fach ‚Äì Technical Expertise'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Wendet Fachwissen effektiv an, l√∂st technische Probleme selbstst√§ndig.' : lang === 'it' ? 'Applica le competenze tecniche in modo efficace, risolve problemi tecnici in autonomia.' : 'Applies expertise effectively, solves technical problems independently.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Welche Weiterbildung w√ºrde Ihnen helfen?"' : lang === 'it' ? '‚Üí "Quale formazione ti aiuterebbe?"' : '‚Üí "What training would help you?"'
                          )
                        ),
                        // Kommunikation
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Komm ‚Äì Kommunikation & Zusammenarbeit' : lang === 'it' ? 'Comm ‚Äì Comunicazione & Collaborazione' : 'Comm ‚Äì Communication & Collaboration'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Teilt Infos proaktiv, h√∂rt aktiv zu, arbeitet konstruktiv mit anderen.' : lang === 'it' ? 'Condivide informazioni proattivamente, ascolta attivamente, collabora costruttivamente.' : 'Shares info proactively, listens actively, works constructively with others.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "In welcher Situation war Kommunikation schwierig?"' : lang === 'it' ? '‚Üí "In quale situazione la comunicazione √® stata difficile?"' : '‚Üí "In which situation was communication difficult?"'
                          )
                        ),
                        // Probleml√∂sung
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Prob ‚Äì Probleml√∂sekompetenz' : lang === 'it' ? 'Prob ‚Äì Capacit√† di problem solving' : 'Prob ‚Äì Problem-Solving'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Analysiert Probleme strukturiert, entwickelt kreative L√∂sungen.' : lang === 'it' ? 'Analizza i problemi in modo strutturato, sviluppa soluzioni creative.' : 'Analyzes problems systematically, develops creative solutions.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Welches Problem haben Sie zuletzt gel√∂st? Wie?"' : lang === 'it' ? '‚Üí "Quale problema hai risolto di recente? Come?"' : '‚Üí "What problem did you solve recently? How?"'
                          )
                        ),
                        // Anpassungsf√§higkeit
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Adapt ‚Äì Anpassungsf√§higkeit' : lang === 'it' ? 'Adapt ‚Äì Adattabilit√†' : 'Adapt ‚Äì Adaptability'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Reagiert flexibel auf Ver√§nderungen, bleibt offen f√ºr Neues.' : lang === 'it' ? 'Reagisce in modo flessibile ai cambiamenti, resta aperto alle novit√†.' : 'Responds flexibly to changes, stays open to new things.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Was war die gr√∂√üte Ver√§nderung dieses Jahr?"' : lang === 'it' ? '‚Üí "Qual √® stato il cambiamento pi√π grande quest\'anno?"' : '‚Üí "What was the biggest change this year?"'
                          )
                        ),
                        // Selbstorganisation
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Orga ‚Äì Selbstorganisation' : lang === 'it' ? 'Orga ‚Äì Autogestione' : 'Orga ‚Äì Self-Organization'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Priorisiert eigenst√§ndig, h√§lt Deadlines ein, arbeitet strukturiert.' : lang === 'it' ? 'Stabilisce priorit√† in autonomia, rispetta le scadenze, lavora in modo strutturato.' : 'Prioritizes independently, meets deadlines, works in a structured way.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Wie organisieren Sie Ihren Arbeitstag?"' : lang === 'it' ? '‚Üí "Come organizzi la tua giornata lavorativa?"' : '‚Üí "How do you organize your workday?"'
                          )
                        )
                      ),
                      // F√ºhrungskompetenzen
                      React.createElement('div', { className: "space-y-2" },
                        React.createElement('h5', { className: "font-bold text-purple-700 text-xs uppercase tracking-wide mb-2" }, 
                          lang === 'de' ? 'üëî F√ºhrungskompetenzen' : lang === 'it' ? 'üëî Competenze leadership' : 'üëî Leadership Competencies'
                        ),
                        // Mitarbeiterf√ºhrung
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'F√ºhrung ‚Äì Mitarbeiterf√ºhrung & -entwicklung' : lang === 'it' ? 'Lead ‚Äì Gestione & Sviluppo del personale' : 'Lead ‚Äì People Management & Development'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'F√∂rdert Teammitglieder, gibt regelm√§√üig Feedback, delegiert sinnvoll.' : lang === 'it' ? 'Sviluppa i membri del team, fornisce feedback regolare, delega in modo sensato.' : 'Develops team members, gives regular feedback, delegates meaningfully.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Wie f√∂rdern Sie Ihre Mitarbeiter individuell?"' : lang === 'it' ? '‚Üí "Come sviluppi i tuoi collaboratori individualmente?"' : '‚Üí "How do you develop your employees individually?"'
                          )
                        ),
                        // Strategisches Denken
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Strat ‚Äì Strategisches Denken' : lang === 'it' ? 'Strat ‚Äì Pensiero strategico' : 'Strat ‚Äì Strategic Thinking'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Denkt √ºber den Tellerrand, plant langfristig, erkennt Zusammenh√§nge.' : lang === 'it' ? 'Pensa oltre l\'ovvio, pianifica a lungo termine, coglie le connessioni.' : 'Thinks beyond the obvious, plans long-term, sees connections.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Welche Trends beeinflussen unseren Bereich?"' : lang === 'it' ? '‚Üí "Quali trend influenzano il nostro settore?"' : '‚Üí "What trends affect our area?"'
                          )
                        ),
                        // Entscheidungsf√§higkeit
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Entsch ‚Äì Entscheidungsf√§higkeit' : lang === 'it' ? 'Decis ‚Äì Capacit√† decisionale' : 'Decis ‚Äì Decision-Making'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Trifft zeitnah fundierte Entscheidungen, steht dazu, kommuniziert klar.' : lang === 'it' ? 'Prende decisioni informate tempestivamente, le sostiene, comunica chiaramente.' : 'Makes timely informed decisions, stands by them, communicates clearly.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Welche schwierige Entscheidung haben Sie getroffen?"' : lang === 'it' ? '‚Üí "Quale decisione difficile hai preso?"' : '‚Üí "What difficult decision did you make?"'
                          )
                        ),
                        // Execution
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Exec ‚Äì Execution & Performance Mgmt' : lang === 'it' ? 'Exec ‚Äì Execution & Performance Mgmt' : 'Exec ‚Äì Execution & Performance Mgmt'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Setzt Strategie um, monitort Ergebnisse, steuert bei Abweichungen nach.' : lang === 'it' ? 'Implementa la strategia, monitora i risultati, interviene in caso di deviazioni.' : 'Implements strategy, monitors results, adjusts when needed.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Wie tracken Sie den Fortschritt Ihres Teams?"' : lang === 'it' ? '‚Üí "Come monitori i progressi del tuo team?"' : '‚Üí "How do you track your team\'s progress?"'
                          )
                        ),
                        // Stakeholder
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Stakeh ‚Äì Stakeholder-Mgmt & Konflikte' : lang === 'it' ? 'Stakeh ‚Äì Gestione stakeholder & Conflitti' : 'Stakeh ‚Äì Stakeholder Mgmt & Conflicts'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Managt Erwartungen, l√∂st Konflikte konstruktiv, baut Beziehungen auf.' : lang === 'it' ? 'Gestisce le aspettative, risolve i conflitti costruttivamente, costruisce relazioni.' : 'Manages expectations, resolves conflicts constructively, builds relationships.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Welchen Konflikt haben Sie k√ºrzlich gel√∂st?"' : lang === 'it' ? '‚Üí "Quale conflitto hai risolto di recente?"' : '‚Üí "What conflict did you resolve recently?"'
                          )
                        )
                      )
                    )
                  ),
                  
                  // === MOBILE: Karten-Ansicht (< md) ===
                  React.createElement('div', { className: "md:hidden space-y-4" },
                    employeeData.map(emp => 
                      React.createElement('div', { 
                        key: emp.id, 
                        className: "bg-slate-50 rounded-xl p-4 border border-slate-200"
                      },
                        // Header mit Name und GPS
                        React.createElement('div', { className: "flex justify-between items-start mb-3" },
                          React.createElement('div', null,
                            React.createElement('div', { className: "font-bold text-slate-800" }, emp.name),
                            React.createElement('div', { className: "text-xs text-slate-500 flex items-center gap-1" },
                              emp.status === 'completed' 
                                ? React.createElement('span', { className: "text-green-600" }, "‚úì Abgeschlossen")
                                : React.createElement('span', { className: "text-amber-600" }, "‚úé Entwurf"),
                              emp.includeLeadership && React.createElement('span', { className: "ml-1 text-purple-600" }, "üëî FK")
                            )
                          ),
                          React.createElement('div', { 
                            className: `px-3 py-1.5 rounded-lg font-bold text-lg ${getColorForGPS(emp.gps)}`
                          }, emp.gps.toFixed(2))
                        ),
                        // Scores Grid
                        React.createElement('div', { className: "grid grid-cols-3 gap-2 text-center text-sm mb-3" },
                          React.createElement('div', { className: "bg-white rounded-lg p-2 border border-slate-200" },
                            React.createElement('div', { className: "text-xs text-slate-500" }, lang === 'de' ? 'WAS' : lang === 'it' ? 'COSA' : 'WHAT'),
                            React.createElement('div', { className: "font-bold" }, emp.wasScore > 0 ? emp.wasScore.toFixed(1) : '‚Äì')
                          ),
                          React.createElement('div', { className: "bg-white rounded-lg p-2 border border-slate-200" },
                            React.createElement('div', { className: "text-xs text-slate-500" }, lang === 'de' ? 'WIE √ò' : lang === 'it' ? 'COME √ò' : 'HOW √ò'),
                            React.createElement('div', { className: "font-bold" }, emp.wieAvg > 0 ? emp.wieAvg.toFixed(1) : '‚Äì')
                          ),
                          React.createElement('div', { className: "bg-white rounded-lg p-2 border border-slate-200" },
                            React.createElement('div', { className: "text-xs text-slate-500" }, "GPS"),
                            React.createElement('div', { className: "font-bold" }, emp.gps.toFixed(2))
                          )
                        ),
                        // Kompetenzen als Tags
                        React.createElement('div', { className: "flex flex-wrap gap-1.5" },
                          ...coreCompIds.map(id => {
                            const score = emp.coreScores[id] || 0;
                            return React.createElement('span', { 
                              key: id, 
                              className: `px-2 py-1 rounded text-xs font-medium ${getColorForLevel(score)}`
                            }, `${labels[id]}: ${score > 0 ? score : '‚Äì'}`);
                          }),
                          ...(emp.includeLeadership ? leaderCompIds.map(id => {
                            const score = emp.leaderScores[id] || 0;
                            return React.createElement('span', { 
                              key: id, 
                              className: `px-2 py-1 rounded text-xs font-medium border border-purple-200 ${getColorForLevel(score)}`
                            }, `${labels[id]}: ${score > 0 ? score : '‚Äì'}`);
                          }) : [])
                        ),
                        // === NOTIZEN-BEREICH (Mobile) ===
                        React.createElement('div', { className: "mt-3 pt-3 border-t border-slate-200" },
                          editingNoteId === emp.id
                            ? // Bearbeitungsmodus
                              React.createElement('div', { className: "space-y-2" },
                                React.createElement('textarea', {
                                  value: calibrationNotes[emp.id] || '',
                                  onChange: (e) => setCalibrationNotes({ ...calibrationNotes, [emp.id]: e.target.value }),
                                  placeholder: lang === 'de' ? 'Notiz f√ºr Kalibrierungs-Meeting...' : lang === 'it' ? 'Note per il meeting di calibrazione...' : 'Note for calibration meeting...',
                                  className: "w-full px-3 py-2 text-sm border border-slate-300 rounded-lg resize-none focus:ring-2 focus:ring-[#6EBD84] outline-none",
                                  rows: 2
                                }),
                                React.createElement('div', { className: "flex gap-2" },
                                  React.createElement('button', {
                                    onClick: () => setEditingNoteId(null),
                                    className: "px-3 py-1 text-xs bg-[#243186] text-white rounded-2xl hover:bg-[#1a2563]"
                                  }, '‚úì ' + (lang === 'de' ? 'Fertig' : lang === 'it' ? 'Fatto' : 'Done')),
                                  React.createElement('button', {
                                    onClick: () => {
                                      const newNotes = { ...calibrationNotes };
                                      delete newNotes[emp.id];
                                      setCalibrationNotes(newNotes);
                                      setEditingNoteId(null);
                                    },
                                    className: "px-3 py-1 text-xs text-red-600 hover:bg-red-50 rounded-lg"
                                  }, lang === 'de' ? 'L√∂schen' : lang === 'it' ? 'Elimina' : 'Delete')
                                )
                              )
                            : // Anzeigemodus
                              React.createElement('div', { 
                                onClick: () => setEditingNoteId(emp.id),
                                className: "cursor-pointer text-sm"
                              },
                                emp.note 
                                  ? React.createElement('div', { className: "bg-amber-50 border border-amber-200 rounded-lg p-2 text-amber-800" },
                                      React.createElement('span', { className: "mr-1" }, "üìù"),
                                      emp.note
                                    )
                                  : React.createElement('div', { className: "text-slate-400 hover:text-slate-600 flex items-center gap-1" },
                                      React.createElement(Edit2, { size: 12 }),
                                      lang === 'de' ? 'Notiz hinzuf√ºgen...' : lang === 'it' ? 'Aggiungi nota...' : 'Add note...'
                                    )
                              )
                        )
                      )
                    ),
                    // Mobile: Team-Durchschnitt
                    React.createElement('div', { className: "bg-[#E8F5ED] rounded-xl p-4 border-2 border-[#6EBD84]" },
                      React.createElement('div', { className: "font-bold text-[#243186] mb-2" }, 
                        `üìä ${lang === 'de' ? 'Team-Durchschnitt' : lang === 'it' ? 'Media Team' : 'Team Average'}`
                      ),
                      React.createElement('div', { className: "grid grid-cols-3 gap-2 text-center text-sm" },
                        React.createElement('div', { className: "bg-white rounded-lg p-2" },
                          React.createElement('div', { className: "text-xs text-slate-500" }, "GPS √ò"),
                          React.createElement('div', { className: "font-bold text-[#243186]" }, teamAvg.gps.toFixed(2))
                        ),
                        React.createElement('div', { className: "bg-white rounded-lg p-2" },
                          React.createElement('div', { className: "text-xs text-slate-500" }, "WAS √ò"),
                          React.createElement('div', { className: "font-bold text-[#243186]" }, teamAvg.was.toFixed(1))
                        ),
                        React.createElement('div', { className: "bg-white rounded-lg p-2" },
                          React.createElement('div', { className: "text-xs text-slate-500" }, "WIE √ò"),
                          React.createElement('div', { className: "font-bold text-[#243186]" }, teamAvg.wie.toFixed(1))
                        )
                      )
                    )
                  ),
                  
                  // === DESKTOP: Tabellen-Ansicht (>= md) ===
                  React.createElement('div', { className: "hidden md:block overflow-x-auto" },
                    React.createElement('table', { className: "w-full text-sm border-collapse" },
                      // Thead
                      React.createElement('thead', null,
                        React.createElement('tr', { className: "bg-slate-100" },
                          React.createElement('th', { className: "px-3 py-3 text-left font-bold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[140px]" }, 
                            lang === 'de' ? 'Mitarbeiter' : lang === 'it' ? 'Collaboratore' : 'Employee'
                          ),
                          React.createElement('th', { className: "px-2 py-3 text-center font-bold text-slate-700 min-w-[50px]" }, "GPS"),
                          React.createElement('th', { className: "px-2 py-3 text-center font-bold text-slate-700 min-w-[50px]" }, lang === 'de' ? 'WAS' : lang === 'it' ? 'COSA' : 'WHAT'),
                          React.createElement('th', { className: "px-2 py-3 text-center font-bold text-slate-700 min-w-[50px]" }, lang === 'de' ? 'WIE' : lang === 'it' ? 'COME' : 'HOW'),
                          // Core Kompetenzen
                          ...coreCompIds.map(id => 
                            React.createElement('th', { key: id, className: "px-2 py-3 text-center font-semibold text-slate-600 min-w-[45px]" }, labels[id])
                          ),
                          // Leadership Kompetenzen (falls vorhanden)
                          ...(hasAnyLeadership ? leaderCompIds.map(id => 
                            React.createElement('th', { key: id, className: "px-2 py-3 text-center font-semibold text-purple-700 min-w-[45px] bg-purple-50" }, labels[id])
                          ) : []),
                          // Notizen-Spalte
                          React.createElement('th', { className: "px-3 py-3 text-left font-bold text-slate-700 min-w-[180px] bg-amber-50" }, 
                            "üìù " + (lang === 'de' ? 'Notizen' : lang === 'it' ? 'Note' : 'Notes')
                          )
                        )
                      ),
                      // Tbody
                      React.createElement('tbody', null,
                        // Mitarbeiter-Zeilen
                        ...employeeData.map((emp, idx) => 
                          React.createElement('tr', { 
                            key: emp.id, 
                            className: `border-b border-slate-100 hover:bg-slate-50 ${idx % 2 === 0 ? 'bg-white' : 'bg-slate-50/50'}`
                          },
                            // Name + Status
                            React.createElement('td', { className: "px-3 py-3 sticky left-0 bg-inherit z-10" },
                              React.createElement('div', { className: "flex items-center gap-2 flex-wrap" },
                                React.createElement('span', { className: "font-semibold text-slate-800" }, emp.name),
                                // Status Badge
                                React.createElement('span', { 
                                  className: `text-xs px-2 py-0.5 rounded-full ${emp.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`
                                }, emp.status === 'completed' ? '‚úì' : '‚úé'),
                                // FK Badge
                                emp.includeLeadership && React.createElement('span', { 
                                  className: "text-xs px-2 py-0.5 rounded-full bg-purple-100 text-purple-700"
                                }, "üëî FK")
                              )
                            ),
                            // GPS
                            React.createElement('td', { className: `px-2 py-3 text-center font-bold rounded ${getColorForGPS(emp.gps)}` },
                              emp.gps > 0 ? emp.gps.toFixed(1) : '‚Äì'
                            ),
                            // WAS
                            React.createElement('td', { className: `px-2 py-3 text-center font-medium rounded ${getColorForLevel(emp.wasScore)}` },
                              emp.wasScore > 0 ? emp.wasScore.toFixed(1) : '‚Äì'
                            ),
                            // WIE √ò
                            React.createElement('td', { className: `px-2 py-3 text-center font-medium rounded ${getColorForLevel(emp.wieAvg)}` },
                              emp.wieAvg > 0 ? emp.wieAvg.toFixed(1) : '‚Äì'
                            ),
                            // Core Kompetenzen - IMMER mit Wert anzeigen
                            ...coreCompIds.map(id => 
                              React.createElement('td', { 
                                key: id, 
                                className: `px-2 py-3 text-center rounded font-bold ${getColorForLevel(emp.coreScores[id])}`
                              }, 
                                React.createElement('span', { className: 'text-sm' }, emp.coreScores[id] || '‚Äì')
                              )
                            ),
                            // Leadership Kompetenzen - IMMER mit Wert anzeigen
                            ...(hasAnyLeadership ? leaderCompIds.map(id => 
                              React.createElement('td', { 
                                key: id, 
                                className: `px-2 py-3 text-center rounded font-bold ${emp.includeLeadership ? getColorForLevel(emp.leaderScores[id]) : 'bg-slate-100 text-slate-300'}`
                              }, 
                                React.createElement('span', { className: 'text-sm' }, emp.includeLeadership ? (emp.leaderScores[id] || '‚Äì') : '‚Äì')
                              )
                            ) : []),
                            // === NOTIZEN-ZELLE ===
                            React.createElement('td', { className: "px-3 py-2 bg-amber-50/50" },
                              editingNoteId === emp.id
                                ? // Bearbeitungsmodus
                                  React.createElement('div', { className: "flex items-center gap-2" },
                                    React.createElement('input', {
                                      type: 'text',
                                      value: calibrationNotes[emp.id] || '',
                                      onChange: (e) => setCalibrationNotes({ ...calibrationNotes, [emp.id]: e.target.value }),
                                      placeholder: lang === 'de' ? 'Notiz...' : lang === 'it' ? 'Nota...' : 'Note...',
                                      className: "flex-1 px-2 py-1 text-sm border border-amber-300 rounded focus:ring-2 focus:ring-amber-500 outline-none",
                                      autoFocus: true,
                                      onKeyDown: (e) => { if (e.key === 'Enter') setEditingNoteId(null); }
                                    }),
                                    React.createElement('button', {
                                      onClick: () => setEditingNoteId(null),
                                      className: "px-2 py-1 text-xs bg-amber-500 text-white rounded hover:bg-amber-600"
                                    }, '‚úì')
                                  )
                                : // Anzeigemodus
                                  React.createElement('div', { 
                                    onClick: () => setEditingNoteId(emp.id),
                                    className: "cursor-pointer text-sm min-h-[24px] flex items-center"
                                  },
                                    emp.note 
                                      ? React.createElement('span', { className: "text-amber-800 truncate max-w-[200px]" }, emp.note)
                                      : React.createElement('span', { className: "text-slate-300 hover:text-amber-600 flex items-center gap-1 text-xs" },
                                          React.createElement(Edit2, { size: 12 }),
                                          lang === 'de' ? 'Notiz...' : lang === 'it' ? 'Nota...' : 'Note...'
                                        )
                                  )
                            )
                          )
                        ),
                        
                        // Team-Durchschnitt Zeile
                        React.createElement('tr', { className: "bg-[#E8F5ED] font-bold sticky bottom-0" },
                          React.createElement('td', { className: "px-3 py-3 sticky left-0 bg-[#E8F5ED] z-10 text-[#243186]" }, 
                            `üìä TEAM √ò (${employeeData.length})`
                          ),
                          React.createElement('td', { className: "px-2 py-3 text-center text-[#243186]" }, 
                            teamAvg.gps > 0 ? teamAvg.gps.toFixed(1) : '‚Äì'
                          ),
                          React.createElement('td', { className: "px-2 py-3 text-center text-[#243186]" }, 
                            teamAvg.was > 0 ? teamAvg.was.toFixed(1) : '‚Äì'
                          ),
                          React.createElement('td', { className: "px-2 py-3 text-center text-[#243186]" }, 
                            teamAvg.wie > 0 ? teamAvg.wie.toFixed(1) : '‚Äì'
                          ),
                          // Core Durchschnitte
                          ...coreCompIds.map(id => 
                            React.createElement('td', { key: id, className: "px-2 py-3 text-center text-[#243186]" }, 
                              teamAvg.core[id] > 0 ? teamAvg.core[id].toFixed(1) : '‚Äì'
                            )
                          ),
                          // Leadership Durchschnitte
                          ...(hasAnyLeadership ? leaderCompIds.map(id => 
                            React.createElement('td', { key: id, className: "px-2 py-3 text-center text-purple-900 bg-purple-100" }, 
                              teamAvg.leader[id] > 0 ? teamAvg.leader[id].toFixed(1) : '‚Äì'
                            )
                          ) : []),
                          // Leere Notizen-Zelle f√ºr Team-Durchschnitt
                          React.createElement('td', { className: "px-3 py-3 bg-[#E8F5ED]" })
                        )
                      )
                    )
                  ),
                  
                  // === TEAM-ENTWICKLUNGSEMPFEHLUNG ===
                  employeeData.length > 0 && (() => {
                    // Finde niedrigsten Durchschnitt pro Kompetenz
                    const compAverages = {};
                    coreCompIds.forEach(id => {
                      const vals = employeeData.map(e => e.coreScores[id]).filter(v => v > 0);
                      compAverages[id] = vals.length > 0 ? vals.reduce((a, b) => a + b, 0) / vals.length : 0;
                    });
                    
                    // Sortiere nach niedrigstem Durchschnitt
                    const sortedComps = Object.entries(compAverages)
                      .filter(([_, avg]) => avg > 0)
                      .sort((a, b) => a[1] - b[1]);
                    
                    if (sortedComps.length === 0) return null;
                    
                    const lowestComp = sortedComps[0];
                    const lowestId = lowestComp[0];
                    const lowestAvg = lowestComp[1];
                    
                    // Empfehlungen pro Kompetenz
                    const devRecommendations = {
                      fach: {
                        de: { title: 'Fachkompetenz st√§rken', actions: ['Peer-Learning Sessions einf√ºhren', 'Externe Schulungen pr√ºfen', 'Mentoring durch erfahrene Kollegen'] },
                        it: { title: 'Rafforzare competenza tecnica', actions: ['Introdurre sessioni di peer-learning', 'Valutare formazione esterna', 'Mentoring da colleghi esperti'] },
                        en: { title: 'Strengthen technical competence', actions: ['Introduce peer-learning sessions', 'Evaluate external training', 'Mentoring by experienced colleagues'] }
                      },
                      komm: {
                        de: { title: 'Kommunikation verbessern', actions: ['Regelm√§√üige Team-Meetings etablieren', 'Feedback-Kultur st√§rken', 'Kommunikationstraining anbieten'] },
                        it: { title: 'Migliorare comunicazione', actions: ['Stabilire meeting regolari', 'Rafforzare cultura del feedback', 'Offrire training comunicazione'] },
                        en: { title: 'Improve communication', actions: ['Establish regular team meetings', 'Strengthen feedback culture', 'Offer communication training'] }
                      },
                      prob: {
                        de: { title: 'Probleml√∂sekompetenz entwickeln', actions: ['Strukturierte Problemanalyse √ºben', 'Case Studies im Team bearbeiten', 'Design Thinking Workshop'] },
                        it: { title: 'Sviluppare problem solving', actions: ['Praticare analisi strutturata', 'Lavorare su case studies', 'Workshop Design Thinking'] },
                        en: { title: 'Develop problem-solving skills', actions: ['Practice structured problem analysis', 'Work on case studies as a team', 'Design Thinking workshop'] }
                      },
                      adapt: {
                        de: { title: 'Anpassungsf√§higkeit f√∂rdern', actions: ['Change-Kommunikation verbessern', 'Kleine Experimente ermutigen', 'Lessons Learned teilen'] },
                        it: { title: 'Promuovere adattabilit√†', actions: ['Migliorare comunicazione del cambiamento', 'Incoraggiare piccoli esperimenti', 'Condividere lessons learned'] },
                        en: { title: 'Promote adaptability', actions: ['Improve change communication', 'Encourage small experiments', 'Share lessons learned'] }
                      },
                      orga: {
                        de: { title: 'Selbstorganisation unterst√ºtzen', actions: ['Priorisierungstechniken vermitteln', 'Klare Deadlines setzen', 'Zeitmanagement-Tools einf√ºhren'] },
                        it: { title: 'Supportare auto-organizzazione', actions: ['Insegnare tecniche di prioritizzazione', 'Definire deadline chiare', 'Introdurre strumenti time management'] },
                        en: { title: 'Support self-organization', actions: ['Teach prioritization techniques', 'Set clear deadlines', 'Introduce time management tools'] }
                      }
                    };
                    
                    const rec = devRecommendations[lowestId]?.[lang] || devRecommendations[lowestId]?.de;
                    if (!rec) return null;
                    
                    return React.createElement('div', { className: "mt-6 bg-amber-50 rounded-xl p-5 border border-amber-200" },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "w-10 h-10 rounded-lg bg-amber-500 flex items-center justify-center flex-shrink-0" },
                          React.createElement(Target, { size: 20, className: "text-white" })
                        ),
                        React.createElement('div', { className: "flex-1" },
                          React.createElement('h4', { className: "font-bold text-amber-800 text-sm mb-1" },
                            lang === 'de' ? 'üéØ Team-Entwicklungsempfehlung' : lang === 'it' ? 'üéØ Raccomandazione sviluppo team' : 'üéØ Team Development Recommendation'
                          ),
                          React.createElement('p', { className: "text-sm text-amber-700 mb-3" },
                            lang === 'de' 
                              ? `Niedrigster Team-Durchschnitt: ${labels[lowestId]} (√ò ${lowestAvg.toFixed(1)}) ‚Äì ${rec.title}`
                              : `Media team pi√π bassa: ${labels[lowestId]} (√ò ${lowestAvg.toFixed(1)}) ‚Äì ${rec.title}`
                          ),
                          React.createElement('div', { className: "flex flex-wrap gap-2" },
                            ...rec.actions.map((action, i) => 
                              React.createElement('span', { 
                                key: i, 
                                className: "inline-flex items-center gap-1 px-2 py-1 bg-white rounded-full text-xs text-amber-800 border border-amber-300"
                              },
                                React.createElement(CheckCircle2, { size: 12 }),
                                action
                              )
                            )
                          )
                        )
                      )
                    );
                  })(),
                  
                  // === PEER-LEARNING / MENTORING ENGINE ===
                  employeeData.length >= 2 && (() => {
                    // Vollst√§ndige Kompetenz-Namen f√ºr bessere Lesbarkeit
                    const fullCompNames = {
                      de: { 
                        fach: 'Fachkompetenz', komm: 'Kommunikation', prob: 'Probleml√∂sung', 
                        adapt: 'Anpassungsf√§higkeit', orga: 'Selbstorganisation',
                        lead: 'Mitarbeiterf√ºhrung', strat: 'Strategisches Denken', 
                        decide: 'Entscheidungsf√§higkeit', exec: 'Execution', stake: 'Stakeholder-Management'
                      },
                      it: { 
                        fach: 'Competenza tecnica', komm: 'Comunicazione', prob: 'Problem solving', 
                        adapt: 'Adattabilit√†', orga: 'Auto-organizzazione',
                        lead: 'Gestione personale', strat: 'Pensiero strategico', 
                        decide: 'Capacit√† decisionale', exec: 'Execution', stake: 'Gestione stakeholder'
                      },
                      en: { 
                        fach: 'Technical Expertise', komm: 'Communication', prob: 'Problem Solving', 
                        adapt: 'Adaptability', orga: 'Self-Organization',
                        lead: 'People Management', strat: 'Strategic Thinking', 
                        decide: 'Decision Making', exec: 'Execution', stake: 'Stakeholder Management'
                      }
                    };
                    const compNames = fullCompNames[lang] || fullCompNames.de;
                    
                    // Sammle alle Mentoring-Matches
                    const allMatches = [];
                    
                    // Durchlaufe alle Kompetenzen
                    const allCompIds = [...coreCompIds, ...(hasAnyLeadership ? leaderCompIds : [])];
                    
                    allCompIds.forEach(compId => {
                      const isLeadership = leaderCompIds.includes(compId);
                      
                      // Finde Mentoren (Score 4 oder 5) und Mentees (Score 1 oder 2)
                      const mentors = [];
                      const mentees = [];
                      
                      employeeData.forEach(emp => {
                        const score = isLeadership 
                          ? (emp.includeLeadership ? emp.leaderScores[compId] : 0)
                          : emp.coreScores[compId];
                        
                        if (score >= 4) {
                          mentors.push({ name: emp.name, score, employeeId: emp.employeeId });
                        } else if (score > 0 && score <= 2) {
                          mentees.push({ name: emp.name, score, employeeId: emp.employeeId });
                        }
                      });
                      
                      // Erstelle Matches wenn es sowohl Mentoren als auch Mentees gibt
                      if (mentors.length > 0 && mentees.length > 0) {
                        // Sortiere f√ºr beste Matches: h√∂chster Mentor-Score mit niedrigstem Mentee-Score
                        mentors.sort((a, b) => b.score - a.score);
                        mentees.sort((a, b) => a.score - b.score);
                        
                        // Erstelle Match (bester Mentor mit schlechtestem Mentee)
                        const mentor = mentors[0];
                        const mentee = mentees[0];
                        
                        // Vermeide Self-Matches
                        if (mentor.employeeId !== mentee.employeeId) {
                          allMatches.push({
                            mentor,
                            mentee,
                            compId,
                            compName: compNames[compId] || compId,
                            isLeadership,
                            scoreDiff: mentor.score - mentee.score
                          });
                        }
                      }
                    });
                    
                    // Sortiere nach gr√∂√üter Differenz und nimm max 3
                    allMatches.sort((a, b) => b.scoreDiff - a.scoreDiff);
                    const topMatches = allMatches.slice(0, 3);
                    
                    // Zeige nur an wenn Matches vorhanden
                    if (topMatches.length === 0) return null;
                    
                    return React.createElement('div', { 
                      className: "mt-6 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-5 border border-indigo-200"
                    },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { 
                          className: "w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",
                          style: { background: 'linear-gradient(135deg, #243186 0%, #6366f1 100%)' }
                        },
                          React.createElement(Users, { size: 20, className: "text-white" })
                        ),
                        React.createElement('div', { className: "flex-1" },
                          React.createElement('h4', { className: "font-bold text-sm mb-1", style: { color: '#243186' } },
                            lang === 'de' ? 'ü§ù Peer-Learning Impulse' 
                              : lang === 'it' ? 'ü§ù Impulsi Peer-Learning' 
                              : 'ü§ù Peer-Learning Opportunities'
                          ),
                          React.createElement('p', { className: "text-xs text-indigo-600 mb-3" },
                            lang === 'de' 
                              ? 'Basierend auf Kompetenz-St√§rken und -L√ºcken im Team'
                              : lang === 'it' ? 'Basato su punti di forza e lacune nelle competenze del team'
                              : 'Based on competency strengths and gaps in the team'
                          ),
                          React.createElement('div', { className: "space-y-2" },
                            ...topMatches.map((match, idx) => 
                              React.createElement('div', { 
                                key: idx,
                                className: "bg-white rounded-lg p-3 border border-indigo-100 flex items-center gap-3 text-sm"
                              },
                                // Mentor
                                React.createElement('div', { className: "flex items-center gap-1.5" },
                                  React.createElement('span', { 
                                    className: "w-7 h-7 rounded-full flex items-center justify-center text-white text-xs font-bold",
                                    style: { backgroundColor: '#6EBD84' }
                                  }, match.mentor.score),
                                  React.createElement('span', { className: "font-medium text-slate-800" }, 
                                    match.mentor.name.split(' ')[0]
                                  )
                                ),
                                // Pfeil
                                React.createElement('span', { className: "text-indigo-400" }, '‚Üí'),
                                // Mentee
                                React.createElement('div', { className: "flex items-center gap-1.5" },
                                  React.createElement('span', { 
                                    className: "w-7 h-7 rounded-full flex items-center justify-center text-white text-xs font-bold",
                                    style: { backgroundColor: match.mentee.score === 1 ? '#dc2626' : '#f97316' }
                                  }, match.mentee.score),
                                  React.createElement('span', { className: "font-medium text-slate-800" }, 
                                    match.mentee.name.split(' ')[0]
                                  )
                                ),
                                // Kompetenz-Badge
                                React.createElement('span', { 
                                  className: `ml-auto px-2 py-0.5 rounded text-xs font-medium ${match.isLeadership ? 'bg-purple-100 text-purple-700' : 'bg-indigo-100 text-indigo-700'}`
                                }, match.compName)
                              )
                            )
                          ),
                          // Hinweis
                          React.createElement('p', { className: "text-xs text-indigo-500 mt-3 italic" },
                            lang === 'de' 
                              ? 'üí° Peer-Mentoring f√∂rdert Wissenstransfer und st√§rkt das Team.'
                              : lang === 'it' ? 'üí° Il peer-mentoring promuove il trasferimento di conoscenze e rafforza il team.'
                              : 'üí° Peer mentoring promotes knowledge transfer and strengthens the team.'
                          )
                        )
                      )
                    );
                  })(),
                  
                  // Hinweis
                  React.createElement('p', { className: "text-xs text-slate-500 mt-4 text-center" },
                    lang === 'de' 
                      ? 'üí° Tipp: Scrolle horizontal um alle Kompetenzen zu sehen. Lila Spalten = Leadership-Kompetenzen.'
                      : 'üí° Suggerimento: Scorri orizzontalmente per vedere tutte le competenze. Colonne viola = Competenze Leadership.'
                  )
                );
              })(),
              
              // Quick Actions
              React.createElement('div', { className: "flex flex-wrap gap-3 justify-center" },
                React.createElement('button', {
                  onClick: () => setActiveView('teamoverview'),
                  className: "flex items-center gap-2 px-5 py-2.5 bg-slate-100 text-slate-700 rounded-2xl hover:bg-slate-200 transition-colors text-sm font-medium"
                },
                  React.createElement(Users, { size: 16 }),
                  getText(lang, 'Team-√úbersicht', 'Panoramica team', 'Team Overview')
                ),
                reviewsWithGPS.length > 0 && React.createElement('button', {
                  onClick: () => setActiveView('formular'),
                  className: "flex items-center gap-2 px-5 py-2.5 bg-[#6EBD84] text-white rounded-2xl hover:bg-[#5da872] transition-colors text-sm font-medium"
                },
                  React.createElement(FileText, { size: 16 }),
                  lang === 'de' ? 'Neues Review' : lang === 'it' ? 'Nuova review' : 'New Review'
                )
              )
            );
          };
          
const renderDashboard = () => {
            // Safety check inside render
            if (!data || !data.intro) return React.createElement('div', null, "Loading...");

            return React.createElement('div', { className: "space-y-8 animate-in fade-in duration-500" },
              // === MIGRATION SUCCESS BANNER ===
              migrationStatus === 'done' && migrationResult && (migrationResult.members > 0 || migrationResult.appraisals > 0) &&
                React.createElement('div', { 
                  className: 'bg-green-50 border border-green-200 rounded-xl p-4 flex items-start gap-3 animate-in fade-in duration-500'
                },
                  React.createElement(CheckCircle2, { size: 24, className: 'text-green-600 flex-shrink-0 mt-0.5' }),
                  React.createElement('div', { className: 'flex-1' },
                    React.createElement('h4', { className: 'font-semibold text-green-800 mb-1' },
                      getText(lang, '‚ú® Daten erfolgreich migriert!', '‚ú® Dati migrati con successo!', '‚ú® Data successfully migrated!')
                    ),
                    React.createElement('p', { className: 'text-sm text-green-700' },
                      getText(lang,
                        `${migrationResult.members} Mitarbeiter und ${migrationResult.appraisals} Bewertungen wurden in die Cloud √ºbertragen. Ihre Daten sind jetzt sicher in Firebase gespeichert.`,
                        `${migrationResult.members} collaboratori e ${migrationResult.appraisals} valutazioni sono stati trasferiti nel cloud. I tuoi dati sono ora salvati in Firebase.`,
                        `${migrationResult.members} employees and ${migrationResult.appraisals} appraisals have been transferred to the cloud. Your data is now securely stored in Firebase.`)
                    )
                  ),
                  React.createElement('button', {
                    onClick: () => { setMigrationStatus(null); setMigrationResult(null); },
                    className: 'text-green-600 hover:text-green-800 p-1'
                  }, React.createElement(X, { size: 18 }))
                ),
              
              // === QUICKSTART GUIDE (GANZ OBEN) ===
              React.createElement('div', { className: "bg-gradient-to-br from-slate-50 to-white rounded-2xl p-6 md:p-8 shadow-lg border border-slate-200" },
                React.createElement('div', { className: "flex items-center gap-3 mb-6" },
                  React.createElement('div', { className: "bg-[#6EBD84] p-3 rounded-xl" },
                    React.createElement(Lightbulb, { size: 28, className: "text-white" })
                  ),
                  React.createElement('div', null,
                    React.createElement('h2', { className: "text-2xl font-bold", style: { color: "#243186" } },
                      lang === 'de' ? 'üöÄ Schnellstart-Guide' : lang === 'it' ? 'üöÄ Guida Rapida' : 'üöÄ Quick Start Guide'
                    ),
                    React.createElement('p', { className: "text-slate-500 text-sm" },
                      lang === 'de' ? 'So nutzen Sie den Performance Manager' : lang === 'it' ? 'Come utilizzare il Performance Manager' : 'How to use the Performance Manager'
                    )
                  )
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 gap-6" },
                  // LINKE SPALTE: F√ºr F√ºhrungskr√§fte
                  React.createElement('div', { className: "bg-[#243186] rounded-xl p-5 text-white" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-4" },
                      React.createElement(Users, { size: 24, className: "text-[#6EBD84]" }),
                      React.createElement('h3', { className: "text-lg font-bold" },
                        lang === 'de' ? 'F√ºr F√ºhrungskr√§fte' : lang === 'it' ? 'Per Manager' : 'For Managers'
                      )
                    ),
                    React.createElement('div', { className: "space-y-4" },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '1'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Account erstellen' : lang === 'it' ? 'Crea account' : 'Create account'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? 'Unter "Team-√úbersicht" registrieren.' : lang === 'it' ? 'Registrati in "Panoramica team".' : 'Register in "Team Overview".')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '2'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Team anlegen' : lang === 'it' ? 'Crea team' : 'Create team'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? 'Unter "Team-√úbersicht" Mitarbeiter hinzuf√ºgen.' : lang === 'it' ? 'In "Panoramica team" aggiungi collaboratori.' : 'Add employees in "Team Overview".')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '3'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Selbstreflexion-Link senden' : lang === 'it' ? 'Invia link autovalutazione' : 'Send self-reflection link'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? '"üìã Selbstreflexion-Link" an Mitarbeiter senden.' : lang === 'it' ? 'Invia "üìã Link autovalutazione" al collaboratore.' : 'Send "üìã Self-Reflection Link" to employee.')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '4'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Beurteilung erstellen' : lang === 'it' ? 'Crea valutazione' : 'Create assessment'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? '"üìù Beurteilung starten" oder "üéØ Zielvereinbarung".' : lang === 'it' ? '"üìù Avvia valutazione" o "üéØ Obiettivi".' : '"üìù Start Assessment" or "üéØ Goals".')
                        )
                      )
                    )
                  ),
                  // RECHTE SPALTE: F√ºr Mitarbeiter
                  React.createElement('div', { className: "bg-white rounded-xl p-5 border-2 border-[#6EBD84]" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-4" },
                      React.createElement(User, { size: 24, className: "text-[#243186]" }),
                      React.createElement('h3', { className: "text-lg font-bold", style: { color: "#243186" } },
                        lang === 'de' ? 'F√ºr Mitarbeiter' : lang === 'it' ? 'Per Collaboratori' : 'For Employees'
                      )
                    ),
                    React.createElement('div', { className: "bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4" },
                      React.createElement('div', { className: "flex items-center gap-2" },
                        React.createElement(Link, { size: 16, className: "text-purple-600" }),
                        React.createElement('p', { className: "text-sm font-medium text-purple-700" },
                          lang === 'de' ? 'Link erhalten? Einfach √∂ffnen ‚Äì kein Login n√∂tig!' : lang === 'it' ? 'Ricevuto un link? Aprilo ‚Äì nessun login!' : 'Received a link? Just open it ‚Äì no login needed!'
                        )
                      )
                    ),
                    React.createElement('div', { className: "space-y-4" },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#243186] text-white font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '1'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold", style: { color: "#243186" } }, lang === 'de' ? 'Link √∂ffnen' : lang === 'it' ? 'Apri link' : 'Open link'),
                          React.createElement('p', { className: "text-sm text-slate-600" }, lang === 'de' ? 'Klicken Sie auf den Link in der E-Mail.' : lang === 'it' ? 'Clicca sul link nell\'email.' : 'Click the link in the email.')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#243186] text-white font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '2'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold", style: { color: "#243186" } }, lang === 'de' ? 'Selbsteinsch√§tzung ausf√ºllen' : lang === 'it' ? 'Compila autovalutazione' : 'Complete self-assessment'),
                          React.createElement('p', { className: "text-sm text-slate-600" }, lang === 'de' ? 'Kompetenzen ehrlich bewerten.' : lang === 'it' ? 'Valuta le competenze onestamente.' : 'Rate competencies honestly.')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#243186] text-white font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '3'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold", style: { color: "#243186" } }, lang === 'de' ? 'Absenden' : lang === 'it' ? 'Invia' : 'Submit'),
                          React.createElement('p', { className: "text-sm text-slate-600" }, lang === 'de' ? 'Ihre F√ºhrungskraft sieht die Antworten.' : lang === 'it' ? 'Il manager vedr√† le risposte.' : 'Your manager sees the answers.')
                        )
                      )
                    )
                  )
                ),
                React.createElement('div', { className: "mt-4 text-center" },
                  React.createElement('p', { className: "text-sm text-slate-500" },
                    lang === 'de' ? 'üí° Nutzen Sie die Seitenleiste links zur Navigation.' : lang === 'it' ? 'üí° Usa la barra laterale per navigare.' : 'üí° Use the sidebar to navigate.'
                  )
                )
              ),
              
              // === JAHRESKALENDER ===
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-6' },
                React.createElement('div', { className: 'bg-gradient-to-r from-[#243186] to-[#1a2460] p-4 text-white' },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement(Calendar, { size: 22 }),
                    React.createElement('div', null,
                      React.createElement('h3', { className: 'font-bold' }, lang === 'de' ? 'Performance-Jahreszyklus' : lang === 'it' ? 'Ciclo annuale' : 'Annual Cycle'),
                      React.createElement('p', { className: 'text-xs text-slate-300' }, lang === 'de' ? 'Aktueller Monat: Januar' : lang === 'it' ? 'Mese corrente: Gennaio' : 'Current month: January')
                    )
                  )
                ),
                React.createElement('div', { className: 'p-4' },
                  React.createElement('div', { className: 'flex gap-1 mb-3' },
                    ['J','F','M','A','M','J','J','A','S','O','N','D'].map(function(m, i) {
                      return React.createElement('div', { 
                        key: i, 
                        className: 'flex-1 text-center text-xs py-1 rounded ' + (i === 0 ? 'bg-[#243186] text-white font-bold' : 'bg-slate-100 text-slate-500')
                      }, m);
                    })
                  ),
                  React.createElement('div', { className: 'grid grid-cols-3 gap-2 text-xs' },
                    React.createElement('div', { className: 'p-2 rounded bg-green-50 border border-green-200' },
                      React.createElement('span', { className: 'font-medium text-green-700' }, 'üéØ Q1: ' + (lang === 'de' ? 'Ziele' : lang === 'it' ? 'Obiettivi' : 'Goals'))
                    ),
                    React.createElement('div', { className: 'p-2 rounded bg-slate-50 border border-slate-200' },
                      React.createElement('span', { className: 'text-slate-500' }, 'üîÑ Q2-Q3: ' + (lang === 'de' ? 'Reviews' : 'Reviews'))
                    ),
                    React.createElement('div', { className: 'p-2 rounded bg-slate-50 border border-slate-200' },
                      React.createElement('span', { className: 'text-slate-500' }, 'üìù Q4: ' + (lang === 'de' ? 'Bewertung' : lang === 'it' ? 'Valutazione' : 'Evaluation'))
                    )
                  )
                )
              ),
              
              React.createElement('div', { className: "bg-white rounded-xl p-6 shadow-sm border border-slate-200" },
                React.createElement('h2', { className: "text-2xl font-bold mb-4", style: { color: "#243186" } }, t.welcome),
                React.createElement('p', { className: "mb-6 leading-relaxed", style: { color: "#243186" } },
                  t.intro, React.createElement('strong', null, t.introBold), t.introEnd
                ),
                React.createElement('div', { className: "bg-slate-50 p-5 rounded-lg border border-slate-100 mb-6" },
                  React.createElement('h3', { className: "font-semibold mb-3 flex items-center gap-2", style: { color: "#243186" } },
                    React.createElement(Target, { size: 18 }), " ", t.strategyTitle
                  ),
                  React.createElement('p', { className: "text-sm leading-relaxed", style: { color: "#243186" } },
                    t.strategyDesc, React.createElement('strong', null, t.strategyBold), t.strategyEnd
                  )
                )
              ),
              
              React.createElement('div', { className: "grid md:grid-cols-3 gap-4" },
                // BEGIN: Fast, Fair, Personal Block
                data.intro.values.map((val) => (
                  React.createElement('div', { 
                    key: val.key, 
                    // Dunkler Hintergrund, wei√üer Text, Akzentlinie oben
                    className: "bg-[#243186] p-5 rounded-xl shadow-lg border-t-4 border-t-[#6EBD84] flex flex-col items-center text-center transition-all hover:shadow-xl" 
                  },
                    // Icon: Wei√ü mit Akzentfarbe f√ºr die Hervorhebung
                    React.createElement('div', { className: `mb-3 p-2 rounded-full border-2 border-white/50 text-white/90` }, 
                      React.createElement(val.icon, { size: 32 })
                    ),
                    // Titel: Wei√üer Text, fett
                    React.createElement('h3', { className: "font-bold text-lg text-white mb-1" }, val.key),
                    // Beschreibung: Hellerer wei√üer Text
                    React.createElement('p', { className: "text-sm text-slate-300" }, val.desc)
                  )
                ))
                // END: Fast, Fair, Personal Block
              ),
              
              // Performance Kompass Section
              React.createElement('div', { 
                className: "rounded-xl shadow-lg p-8", 
                style: { background: "linear-gradient(135deg, #243186 0%, #1a2460 100%)" }
              },
                React.createElement('h2', { className: "text-3xl font-bold text-white mb-3" }, 
                  t.performanceCompassTitle
                ),
                React.createElement('p', { className: "text-slate-200 text-lg mb-6 leading-relaxed" }, 
                  t.performanceCompassSubtitle
                ),
                // Top Row: WAS + WIE
                React.createElement('div', { className: "relative mb-6" },
                  React.createElement('div', { className: "grid md:grid-cols-2 gap-6" },
                    // WAS Box
                    React.createElement('div', { 
                      className: "bg-white/10 backdrop-blur-sm rounded-2xl p-6 border-2 border-white/20 hover:border-[#6EBD84] transition-all duration-300 hover:scale-105"
                    },
                      React.createElement('div', { className: "flex items-center justify-between mb-4" },
                        React.createElement('h3', { 
                          className: "text-3xl font-bold",
                          style: { color: "#6EBD84" }
                        }, t.wasBoxTitle),
                        React.createElement(Target, { size: 48, className: "text-white/60" })
                      ),
                      React.createElement('p', { className: "text-white text-lg" }, 
                        t.wasBoxSubtitle
                      )
                    ),
                    
                    // WIE Box - mit dynamischem Inhalt f√ºr Manager/Mitarbeiter
                    React.createElement('div', { 
                      className: "bg-white/10 backdrop-blur-sm rounded-2xl p-6 border-2 border-white/20 hover:border-[#6EBD84] transition-all duration-300 hover:scale-105"
                    },
                      React.createElement('div', { className: "flex items-center justify-between mb-4" },
                        React.createElement('h3', { 
                          className: "text-3xl font-bold",
                          style: { color: "#6EBD84" }
                        }, t.wieBoxTitle),
                        React.createElement(Brain, { size: 48, className: "text-white/60" })
                      ),
                      React.createElement('p', { className: "text-white text-lg mb-2" }, 
                        t.wieBoxSubtitle
                      ),
                      // Manager/Mitarbeiter Unterscheidung
                      React.createElement('div', { className: "mt-3 pt-3 border-t border-white/20" },
                        React.createElement('div', { className: "flex items-start gap-2 text-sm text-white/80" },
                          React.createElement(Users, { size: 14, className: "mt-0.5 flex-shrink-0" }),
                          React.createElement('span', null, 
                            lang === 'de' ? 'Mitarbeitende: 50% Kern-Kompetenzen' : lang === 'it' ? 'Collaboratori: 50% Competenze Core' : 'Employees: 50% Core Competencies'
                          )
                        ),
                        React.createElement('div', { className: "flex items-start gap-2 text-sm text-white/80 mt-1" },
                          React.createElement(Award, { size: 14, className: "mt-0.5 flex-shrink-0" }),
                          React.createElement('span', null, 
                            lang === 'de' ? 'F√ºhrungskr√§fte: 25% Kern-Komp. + 25% Leadership' : lang === 'it' ? 'Dirigenti: 25% Comp. Core + 25% Leadership' : 'Managers: 25% Core Comp. + 25% Leadership'
                          )
                        )
                      )
                    )
                  ),
                  // Plus Symbol zwischen den Boxen (nur Desktop)
                  React.createElement('div', { className: "hidden md:flex absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none" },
                    React.createElement('div', { className: "w-16 h-16 rounded-full bg-white flex items-center justify-center shadow-lg" },
                      React.createElement('span', { className: "text-[#243186] text-4xl font-bold" }, "+")
                    )
                  )
                ),
                
                // Formel-Erkl√§rung unter den Boxen
                React.createElement('div', { className: "flex justify-center mb-4" },
                  React.createElement('div', { className: "bg-white/5 backdrop-blur-sm rounded-lg px-6 py-3 border border-white/10" },
                    React.createElement('p', { className: "text-white/90 text-sm text-center" },
                      lang === 'de' 
                        ? 'üìä GPS = 50% WAS-Zielerreichung + 50% WIE-Kompetenzbewertung'
                        : 'üìä GPS = 50% Raggiungimento COSA + 50% Valutazione COME'
                    )
                  )
                ),
                
                // GPS Result Box - mittig positioniert, zentrierter Text
                React.createElement('div', { className: "flex justify-center" },
                  React.createElement('div', { 
                    className: "w-full md:w-1/2 bg-gradient-to-br from-[#6EBD84] to-[#5aa871] rounded-2xl p-6 border-2 border-white shadow-2xl transform hover:scale-105 transition-all duration-300"
                  },
                    React.createElement('div', { className: "text-center" },
                      React.createElement('h3', { 
                        className: "text-3xl font-bold text-white mb-2"
                      }, "GPS"),
                      React.createElement('p', { className: "text-white text-lg" }, 
                        "Global Performance Score"
                      )
                    )
                  )
                ),
                // Fairness Garantie Badge
                React.createElement('div', { className: "flex justify-center mt-6" },
                  React.createElement('div', { 
                    className: "inline-flex items-center gap-3 px-6 py-3 rounded-full border-2",
                    style: { 
                      backgroundColor: "rgba(110, 189, 132, 0.2)",
                      borderColor: "#6EBD84"
                    }
                  },
                    React.createElement(Scale, { size: 20, style: { color: "#6EBD84" } }),
                    React.createElement('span', { 
                      className: "font-bold text-sm uppercase tracking-wider",
                      style: { color: "#6EBD84" }
                    }, t.fairnessGuarantee)
                  )
                ),
                
                // GPS Rating Scale Table
                React.createElement('div', { className: "mt-6 bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20" },
                  React.createElement('p', { className: "text-white text-center text-sm mb-4" },
                    lang === 'de' 
                      ? 'Der finale GPS-Score wird in ein 5-stufiges Rating √ºberf√ºhrt:'
                      : 'Il punteggio GPS finale viene convertito in un rating a 5 livelli:'
                  ),
                  React.createElement('div', { className: "overflow-hidden rounded-lg border border-white/30" },
                    // Header Row
                    React.createElement('div', { className: "grid grid-cols-3 gap-0" },
                      React.createElement('div', { className: "bg-white/20 backdrop-blur-sm px-4 py-3 font-bold text-white text-sm border-r border-white/30" },
                        lang === 'de' ? 'GPS-Score' : lang === 'it' ? 'Punteggio GPS' : 'GPS Score'
                      ),
                      React.createElement('div', { className: "bg-white/20 backdrop-blur-sm px-4 py-3 font-bold text-white text-sm text-center border-r border-white/30" },
                        'Note'
                      ),
                      React.createElement('div', { className: "bg-white/20 backdrop-blur-sm px-4 py-3 font-bold text-white text-sm" },
                        lang === 'de' ? 'Beschreibung' : 'Descrizione'
                      )
                    ),
                    // Rating 5
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-pink-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '4,51 ‚Äì 5,00'
                      ),
                      React.createElement('div', { className: "bg-pink-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '5'
                      ),
                      React.createElement('div', { className: "bg-pink-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Outstanding'
                      )
                    ),
                    // Rating 4
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-orange-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '3,51 ‚Äì 4,50'
                      ),
                      React.createElement('div', { className: "bg-orange-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '4'
                      ),
                      React.createElement('div', { className: "bg-orange-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Exceeds Expectations'
                      )
                    ),
                    // Rating 3
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-blue-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '2,51 ‚Äì 3,50'
                      ),
                      React.createElement('div', { className: "bg-blue-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '3'
                      ),
                      React.createElement('div', { className: "bg-blue-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Meets Expectations (Baseline)'
                      )
                    ),
                    // Rating 2
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-green-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '1,51 ‚Äì 2,50'
                      ),
                      React.createElement('div', { className: "bg-green-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '2'
                      ),
                      React.createElement('div', { className: "bg-green-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Needs Improvement'
                      )
                    ),
                    // Rating 1
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-teal-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '1,00 ‚Äì 1,50'
                      ),
                      React.createElement('div', { className: "bg-teal-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '1'
                      ),
                      React.createElement('div', { className: "bg-teal-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Does Not Meet'
                      )
                    )
                  )
                )
              ),
              
              // Hintergrundfarbe ge√§ndert auf das CI-Dunkelblau: #243186
              React.createElement('div', { className: "bg-[#243186] rounded-xl p-6 text-white shadow-lg" },
                React.createElement('div', { className: "flex flex-col items-start" },
                  React.createElement('h3', { className: "text-xl font-bold mb-2" }, t.barsTitle),
                  React.createElement('p', { className: "text-[#E8F5ED] text-sm mb-4 opacity-90" }, t.barsDesc),
                  React.createElement('button', {
                    onClick: () => setActiveView('list'),
                    className: "bg-white text-[#6EBD84] px-6 py-2 rounded-lg font-semibold hover:bg-[#F4FAF7] transition-colors"
                  }, t.btnCompetencies)
                )
              ),
              
              React.createElement('div', { className: "mt-12 mb-8" },
                React.createElement('h2', { className: "text-2xl font-bold mb-8 text-center", style: { color: "#243186" } },
                  lang === 'de' ? 'DER JAHRESZYKLUS IM √úBERBLICK' : 'IL CICLO ANNUALE IN SINTESI'
                ),
                // Verwendung der benutzerdefinierten Klasse f√ºr gleich hohe Spalten
                React.createElement('div', { className: "equal-height-grid" },
                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(Scale, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 1' : 'FASE 1'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Entwurf & Kalibrierung' : 'Bozza & Calibrazione'
                      )
                    ),
                    // Inhalt ohne Aufz√§hlungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(ClipboardList, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'F√ºhrungskraft erstellt GPS-Entwurf.' 
                          : 'Il manager crea la bozza GPS.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(CalendarCheck, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Kalibrierungs-Meeting im F√ºhrungskreis sichert Fairness.' 
                          : 'Meeting di calibrazione nel team di leadership garantisce equit√†.')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'WICHTIG: Nach diesem Meeting ist der GPS-Score final und verbindlich.' 
                          : 'IMPORTANTE: Dopo questo meeting il punteggio GPS √® finale e vincolante.'
                      )
                    )
                  ),

                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(Brain, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 2' : 'FASE 2'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Selbstreflexion' : 'Autoriflessione'
                      )
                    ),
                    // Inhalt ohne Aufz√§hlungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(BookOpen, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Mitarbeiter bereitet Selbstreflexion vor.' 
                          : 'Il collaboratore prepara l\'autoriflessione.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Users, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Dient als Basis f√ºr den Dialog auf Augenh√∂he.' 
                          : 'Serve come base per il dialogo alla pari.')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'TIMING: Zusendung an FK ca. eine Woche vor Gespr√§chstermin' 
                          : 'TIMING: Invio al manager ca. una settimana prima del colloquio'
                      )
                    )
                  ),

                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(MessageCircle, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 3' : 'FASE 3'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Review-Gespr√§ch' : 'Colloquio di Review'
                      )
                    ),
                    // Inhalt ohne Aufz√§hlungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Scale, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Erkl√§rung des GPS-Scores' 
                          : 'Spiegazione del punteggio GPS')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Target, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Feedback zu Zielerreichung (WAS) & Kompetenzen (WIE)' 
                          : 'Feedback sul raggiungimento obiettivi (COSA) & competenze (COME)')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'Keine Verhandlung des GPS-Scores, aber offenes Ohr.' 
                          : 'Nessuna negoziazione del punteggio GPS, ma ascolto aperto.'
                      )
                    )
                  ),

                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(Target, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 4' : 'FASE 4'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Zielvereinbarung' : 'Definizione Obiettivi'
                      )
                    ),
                    // Inhalt ohne Aufz√§hlungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(TrendingUp, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Blick nach vorne.' 
                          : 'Sguardo al futuro.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Briefcase, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Vereinbarung der neuen Ziele.' 
                          : 'Definizione dei nuovi obiettivi.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Lightbulb, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Erstellung des Entwicklungsplans' 
                          : 'Creazione del piano di sviluppo')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'HALBJAHRES-CHECK: Kurzer Boxenstopp zur Kurskorrektur.' 
                          : 'CHECK SEMESTRALE: Breve pit-stop per correzione di rotta.'
                      )
                    )
                  )
                )
              )
            );
          };

          // === HANDLUNGSLEITFADEN / USER GUIDE ===
          const renderGuide = () => {
            const guideSteps = {
              de: [
                { num: 1, icon: 'üîê', title: 'Anmeldung im System', goal: 'Zugang zur App erhalten', items: ['Im Men√º auf ‚ÄûTeam-√úbersicht" klicken', 'Falls noch nicht registriert: ‚ÄûRegistrieren" w√§hlen', 'Firmen-E-Mail und Passwort (min. 6 Zeichen) eingeben', 'Bei erneutem Besuch: ‚ÄûAnmelden" nutzen'], tip: 'Die Registrierung erfolgt direkt √ºber ‚ÄûTeam-√úbersicht" ‚Äì kein separater Anmeldeprozess n√∂tig.' },
                { num: 2, icon: 'üë•', title: 'Team aufbauen', goal: 'Ihre Mitarbeiter im System erfassen', items: ['Nach Anmeldung erscheint ‚ÄûTeam-√úbersicht" automatisch', 'Formular ‚ÄûNeuen Mitarbeiter hinzuf√ºgen" ausf√ºllen', 'Name und Position sind Pflichtfelder', 'E-Mail eingeben f√ºr automatische Einladung'], tip: 'Pro Mitarbeiter wird automatisch ein pers√∂nlicher Zugangs-Link (accessCode) erstellt!' },
                { num: 3, icon: 'üìß', title: 'Zur Selbstreflexion einladen', goal: 'Mitarbeiter aktiv einbinden', items: ['In der Mitarbeiterliste: E-Mail-Button (‚úâÔ∏è) oder Link-Button (üîó)', 'Bei hinterlegter E-Mail: Button √∂ffnet fertigen E-Mail-Entwurf', 'Ohne E-Mail: Link wird in Zwischenablage kopiert', 'Mitarbeiter kann OHNE Registrierung ausf√ºllen'], email: 'Betreff: Vorbereitung Jahresgespr√§ch ‚Äì Selbstreflexion\n\nHallo [Name],\n\nzur Vorbereitung auf unser Jahresgespr√§ch bitte ich dich, deine Selbstreflexion digital auszuf√ºllen.\n\nDein pers√∂nlicher Link (keine Anmeldung n√∂tig):\n[Link wird automatisch eingef√ºgt]\n\nBitte bis eine Woche vor unserem Termin ausf√ºllen.\n\nViele Gr√º√üe', productionNote: 'F√ºr Produktion & Logistik: Die Selbstreflexion wird NICHT vorab versendet. Stattdessen wird die Selbsteinsch√§tzung direkt im Gespr√§ch m√ºndlich abgefragt (siehe Schritt 5).' },
                { num: 4, icon: 'üìÖ', title: 'Gespr√§chstermin festlegen (optional)', goal: 'Termin im System dokumentieren', items: ['Bei Mitarbeiter auf ‚ÄûüìÖ Termin" klicken', 'Datum und Uhrzeit eingeben', 'Termin erscheint in der Mitarbeiterliste als Badge', 'Mit ‚ÄûGespr√§ch gef√ºhrt" Checkbox als erledigt markieren'], tip: 'üí° Dies ist eine Unterst√ºtzungsfunktion ‚Äì die eigentliche Terminorganisation erfolgt wie gewohnt √ºber Outlook. Diese Funktion hilft lediglich, den √úberblick zu behalten und zeigt den Status in der App an.' },
                { num: 5, icon: 'üìã', title: 'Beurteilung durchf√ºhren', goal: 'Leistung fair und objektiv bewerten', items: ['In ‚ÄûTeam-√úbersicht" beim Mitarbeiter auf ‚ÄûReview" klicken', 'Teil B: Zielerreichung bewerten (WAS) ‚Äì Erreichungsgrad in %', 'Teil C: Kompetenzen bewerten (WIE) ‚Äì BARS-Skala 1-5', 'Selbstreflexion des MA erscheint links als Referenz', 'Regelm√§√üig als Entwurf speichern', 'Nach dem Feedbackgespr√§ch auf ‚Äû‚úì Abschlie√üen" klicken'], tip: 'Die Split-Screen Ansicht zeigt links die Selbstreflexion, rechts Ihr Formular. Abgeschlossene Bewertungen k√∂nnen jederzeit bearbeitet werden.', productionNote: 'F√ºr Produktion & Logistik: Im Gespr√§ch fragen Sie zu jeder Kompetenz: ‚ÄûWie sch√§tzt du dich selbst ein?" Dokumentieren Sie die Einsch√§tzung des Mitarbeiters im Kommentarfeld. Dies f√∂rdert den Dialog und erm√∂glicht direktes Eingehen auf Abweichungen.' },
                { num: 6, icon: 'üéØ', title: 'Zielvereinbarung erstellen', goal: 'Klare Ziele f√ºr das Folgejahr', items: ['Bei Mitarbeiter auf ‚ÄûZiele" klicken', 'SMART-Ziele formulieren', 'Gewichtung festlegen (Summe = 100%)', 'Bonus-Relevanz markieren', 'Entwicklungsma√ünahmen hinzuf√ºgen'] },
                { num: 7, icon: '‚úÖ', title: 'Fortschritt verfolgen', goal: '√úberblick √ºber alle Aufgaben', items: ['Die Checkliste zeigt pro Mitarbeiter 3 Status-Badges:', '‚Ä¢ Selbstreflexion ‚Äì eingegangen oder ausstehend', '‚Ä¢ Beurteilung ‚Äì erstellt oder offen', '‚Ä¢ Zielvereinbarung ‚Äì vorhanden oder fehlt', 'Graue Badges = Aktion erforderlich (anklickbar)'], productionNote: 'F√ºr Produktion & Logistik: Das Badge ‚ÄûSelbstreflexion" bleibt leer ‚Äì das ist korrekt, da diese m√ºndlich im Gespr√§ch erfolgt.' },
                { num: 8, icon: 'üìä', title: 'Team-Kalibrierung nutzen', goal: 'Verzerrungen vermeiden, Fairness sichern', items: ['Men√º: ‚ÄûTeam-Kalibrierung"', '9-Box Grid: Leistung (WAS) vs. Verhalten (WIE)', 'Heatmap: Kompetenz-St√§rken und -L√ºcken im Team', 'Killer Criteria: Warnung bei toxischem Verhalten', 'Peer-Learning: Mentoring-Vorschl√§ge'] }
              ],
              it: [
                { num: 1, icon: 'üîê', title: 'Accesso al sistema', goal: 'Ottenere accesso all\'app', items: ['Nel menu cliccare su ‚ÄûPanoramica team"', 'Se non registrato: selezionare ‚ÄûRegistrati"', 'Inserire email aziendale e password (min. 6 caratteri)', 'Per visite successive: usare ‚ÄûAccedi"'], tip: 'La registrazione avviene direttamente da ‚ÄûPanoramica team" ‚Äì nessun processo separato.' },
                { num: 2, icon: 'üë•', title: 'Creare il team', goal: 'Registrare i collaboratori', items: ['Dopo l\'accesso appare automaticamente ‚ÄûPanoramica team"', 'Compilare il modulo ‚ÄûAggiungi nuovo collaboratore"', 'Nome e posizione sono obbligatori', 'Inserire email per invito automatico'], tip: 'Per ogni collaboratore viene creato automaticamente un link personale (accessCode)!' },
                { num: 3, icon: 'üìß', title: 'Invitare all\'autovalutazione', goal: 'Coinvolgere attivamente i collaboratori', items: ['Nella lista: pulsante email (‚úâÔ∏è) o link (üîó)', 'Con email: apre bozza email pronta', 'Senza email: link copiato negli appunti', 'Il collaboratore pu√≤ compilare SENZA registrazione'], email: 'Oggetto: Preparazione colloquio annuale ‚Äì Autovalutazione\n\nCiao [Nome],\n\nin preparazione al nostro colloquio annuale, ti chiedo di compilare la tua autovalutazione.\n\nIl tuo link personale (nessun login richiesto):\n[Link inserito automaticamente]\n\nTi prego di completarlo almeno una settimana prima.\n\nCordiali saluti', productionNote: 'Per Produzione & Logistica: L\'autovalutazione NON viene inviata in anticipo. Invece, viene richiesta verbalmente durante il colloquio (vedi passo 5).' },
                { num: 4, icon: 'üìÖ', title: 'Fissare appuntamento (opzionale)', goal: 'Documentare il termine nel sistema', items: ['Cliccare ‚ÄûüìÖ Appuntamento" sul collaboratore', 'Inserire data e ora', 'Appuntamento appare come badge nella lista', 'Segnare come completato con checkbox ‚ÄûColloquio effettuato"'], tip: 'üí° Questa √® una funzione di supporto ‚Äì l\'organizzazione vera e propria degli appuntamenti avviene come sempre tramite Outlook. Questa funzione aiuta solo a mantenere la panoramica e mostra lo stato nell\'app.' },
                { num: 5, icon: 'üìã', title: 'Eseguire valutazione', goal: 'Valutare in modo equo e oggettivo', items: ['In ‚ÄûPanoramica team" cliccare ‚ÄûReview" sul collaboratore', 'Parte B: Valutare raggiungimento obiettivi (COSA) ‚Äì % raggiungimento', 'Parte C: Valutare competenze (COME) ‚Äì Scala BARS 1-5', 'Autovalutazione del collaboratore appare a sinistra', 'Salvare regolarmente come bozza', 'Cliccare ‚Äû‚úì Completa" dopo il colloquio'], tip: 'La vista Split-Screen mostra l\'autovalutazione a sinistra, il tuo modulo a destra. Le valutazioni completate possono essere modificate.', productionNote: 'Per Produzione & Logistica: Durante il colloquio chiedi per ogni competenza: ‚ÄûCome ti valuti?" Documenta la valutazione del collaboratore nel campo commento. Questo favorisce il dialogo e permette di affrontare subito le divergenze.' },
                { num: 6, icon: 'üéØ', title: 'Creare accordo obiettivi', goal: 'Obiettivi chiari per l\'anno prossimo', items: ['Cliccare ‚ÄûObiettivi" sul collaboratore', 'Formulare obiettivi SMART', 'Definire peso (somma = 100%)', 'Indicare rilevanza bonus', 'Aggiungere misure di sviluppo'] },
                { num: 7, icon: '‚úÖ', title: 'Monitorare progressi', goal: 'Panoramica di tutte le attivit√†', items: ['La checklist mostra per collaboratore 3 badge:', '‚Ä¢ Autovalutazione ‚Äì ricevuta o in attesa', '‚Ä¢ Valutazione ‚Äì creata o aperta', '‚Ä¢ Accordo obiettivi ‚Äì presente o mancante', 'Badge grigi = Azione richiesta (cliccabili)'], productionNote: 'Per Produzione & Logistica: Il badge ‚ÄûAutovalutazione" rimane vuoto ‚Äì √® corretto, poich√© avviene verbalmente durante il colloquio.' },
                { num: 8, icon: 'üìä', title: 'Usare calibrazione team', goal: 'Evitare distorsioni, garantire equit√†', items: ['Menu: ‚ÄûCalibrazione Team"', '9-Box Grid: Prestazione (COSA) vs. Comportamento (COME)', 'Heatmap: Punti di forza e lacune nel team', 'Killer Criteria: Avviso per comportamenti tossici', 'Peer-Learning: Suggerimenti mentoring'] }
              ],
              en: [
                { num: 1, icon: 'üîê', title: 'System Login', goal: 'Get app access', items: ['Click ‚ÄûMy Team" in the menu', 'If not registered: select ‚ÄûRegister"', 'Enter company email and password (min. 6 chars)', 'For return visits: use ‚ÄûSign In"'], tip: 'Registration happens directly via ‚ÄûMy Team" ‚Äì no separate process needed.' },
                { num: 2, icon: 'üë•', title: 'Build Your Team', goal: 'Add your employees to the system', items: ['After login ‚ÄûMy Team" appears automatically', 'Fill out ‚ÄûAdd New Employee" form', 'Name and position are required', 'Enter email for automatic invitation'], tip: 'A personal access link (accessCode) is automatically created for each employee!' },
                { num: 3, icon: 'üìß', title: 'Invite for Self-Reflection', goal: 'Actively engage employees', items: ['In the list: email button (‚úâÔ∏è) or link button (üîó)', 'With email: opens ready-made email draft', 'Without email: link copied to clipboard', 'Employee can fill out WITHOUT registration'], email: 'Subject: Annual Review Preparation ‚Äì Self-Reflection\n\nHello [Name],\n\nIn preparation for our annual review, please complete your self-reflection digitally.\n\nYour personal link (no login required):\n[Link automatically inserted]\n\nPlease complete at least one week before our meeting.\n\nBest regards', productionNote: 'For Production & Logistics: Self-reflection is NOT sent in advance. Instead, self-assessment is requested verbally during the meeting (see step 5).' },
                { num: 4, icon: 'üìÖ', title: 'Schedule Meeting (optional)', goal: 'Document appointment in system', items: ['Click ‚ÄûüìÖ Schedule" on employee', 'Enter date and time', 'Appointment appears as badge in list', 'Mark as done with ‚ÄûMeeting done" checkbox'], tip: 'üí° This is a support feature ‚Äì actual appointment organization happens as usual via Outlook. This feature just helps maintain overview and shows the status in the app.' },
                { num: 5, icon: 'üìã', title: 'Conduct Evaluation', goal: 'Assess fairly and objectively', items: ['In ‚ÄûMy Team" click ‚ÄûReview" on employee', 'Part B: Rate goal achievement (WHAT) ‚Äì % achieved', 'Part C: Rate competencies (HOW) ‚Äì BARS scale 1-5', 'Employee self-reflection appears on the left', 'Save regularly as draft', 'Click ‚Äû‚úì Complete" after the feedback meeting'], tip: 'Split-Screen view shows self-reflection on left, your form on right. Completed evaluations can be edited anytime.', productionNote: 'For Production & Logistics: During the meeting ask for each competency: "How do you rate yourself?" Document the employee\'s assessment in the comment field. This promotes dialogue and allows immediate discussion of differences.' },
                { num: 6, icon: 'üéØ', title: 'Create Goal Agreement', goal: 'Clear goals for the next year', items: ['Click ‚ÄûGoals" on employee', 'Formulate SMART goals', 'Set weights (sum = 100%)', 'Mark bonus relevance', 'Add development measures'] },
                { num: 7, icon: '‚úÖ', title: 'Track Progress', goal: 'Overview of all tasks', items: ['The checklist shows 3 status badges per employee:', '‚Ä¢ Self-reflection ‚Äì received or pending', '‚Ä¢ Review ‚Äì created or open', '‚Ä¢ Goal agreement ‚Äì exists or missing', 'Gray badges = Action required (clickable)'], productionNote: 'For Production & Logistics: The "Self-reflection" badge remains empty ‚Äì this is correct, as it happens verbally during the meeting.' },
                { num: 8, icon: 'üìä', title: 'Use Team Calibration', goal: 'Avoid bias, ensure fairness', items: ['Menu: ‚ÄûTeam Calibration"', '9-Box Grid: Performance (WHAT) vs. Behavior (HOW)', 'Heatmap: Competency strengths and gaps', 'Killer Criteria: Warning for toxic behavior', 'Peer-Learning: Mentoring suggestions'] }
              ]
            };
            const steps = guideSteps[lang] || guideSteps.de;
            const title = lang === 'de' ? 'Handlungsleitfaden f√ºr F√ºhrungskr√§fte' : lang === 'it' ? 'Guida per Manager' : 'Manager Guide';
            const subtitle = lang === 'de' ? 'Schritt-f√ºr-Schritt durch den Performance Review Prozess' : lang === 'it' ? 'Passo dopo passo nel processo di valutazione' : 'Step-by-step through the Performance Review process';
            
            const quickTips = {
              de: ['GPS 3.0 = Erwartungen erf√ºllt (Standardwert)', 'Konkrete Beispiele in Kommentaren nennen', 'Selbstreflexion VOR dem Gespr√§ch lesen', 'Bei GPS < 2.5: Entwicklungsplan erstellen'],
              it: ['GPS 3.0 = Aspettative soddisfatte (valore standard)', 'Citare esempi concreti nei commenti', 'Leggere autovalutazione PRIMA del colloquio', 'Per GPS < 2.5: Creare piano di sviluppo'],
              en: ['GPS 3.0 = Expectations met (standard value)', 'Cite concrete examples in comments', 'Read self-reflection BEFORE the meeting', 'For GPS < 2.5: Create development plan']
            };
            const tips = quickTips[lang] || quickTips.de;
            
            const productionBoxTitle = {
              de: 'üè≠ Besonderheit f√ºr Produktion & Logistik',
              it: 'üè≠ Particolarit√† per Produzione & Logistica',
              en: 'üè≠ Special Note for Production & Logistics'
            };
            
            return React.createElement('div', { className: 'space-y-6 pb-12' },
              React.createElement('div', { className: 'rounded-2xl p-6 text-white', style: { background: 'linear-gradient(135deg, #243186 0%, #1a2563 100%)' } },
                React.createElement('h1', { className: 'text-2xl font-bold mb-2 flex items-center gap-3' }, React.createElement(BookOpen, { size: 28 }), title),
                React.createElement('p', { className: 'text-white/80' }, subtitle)
              ),
              // Bereichshinweis-Box am Anfang
              React.createElement('div', { className: 'bg-orange-50 border-2 border-orange-200 rounded-xl p-5' },
                React.createElement('h3', { className: 'font-bold text-orange-800 flex items-center gap-2 mb-3' },
                  React.createElement(Factory, { size: 20 }),
                  productionBoxTitle[lang] || productionBoxTitle.de
                ),
                React.createElement('p', { className: 'text-orange-700 text-sm leading-relaxed' },
                  lang === 'de' 
                    ? 'F√ºr Mitarbeiter in Produktion & Logistik gilt ein angepasster Prozess: Die Selbstreflexion wird NICHT vorab digital versendet, sondern die Selbsteinsch√§tzung wird direkt im Gespr√§ch m√ºndlich abgefragt. Achten Sie bei den folgenden Schritten auf die orangefarbenen Hinweise.'
                    : lang === 'it'
                    ? 'Per i collaboratori in Produzione & Logistica si applica un processo adattato: L\'autovalutazione NON viene inviata digitalmente in anticipo, ma viene richiesta verbalmente durante il colloquio. Nei passi seguenti, prestare attenzione alle note in arancione.'
                    : 'For employees in Production & Logistics, an adapted process applies: Self-reflection is NOT sent digitally in advance, but self-assessment is requested verbally during the meeting. In the following steps, pay attention to the orange notes.'
                )
              ),
              React.createElement('div', { className: 'space-y-4' },
                steps.map(step => React.createElement('div', { key: step.num, className: 'bg-white rounded-xl p-5 shadow-sm border border-slate-200 relative overflow-hidden' },
                  React.createElement('div', { className: 'absolute top-0 left-0 w-1.5 h-full', style: { backgroundColor: '#6EBD84' } }),
                  React.createElement('div', { className: 'flex items-start gap-4 ml-2' },
                    React.createElement('div', { className: 'w-10 h-10 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0', style: { backgroundColor: '#243186' } }, step.num),
                    React.createElement('div', { className: 'flex-1' },
                      React.createElement('div', { className: 'flex items-center gap-2 mb-2' },
                        React.createElement('span', { className: 'text-xl' }, step.icon),
                        React.createElement('h3', { className: 'text-lg font-bold text-slate-800' }, step.title)
                      ),
                      React.createElement('p', { className: 'text-sm text-green-700 bg-green-50 px-3 py-1 rounded-full inline-block mb-3' }, 'üéØ ' + step.goal),
                      React.createElement('ul', { className: 'space-y-1 text-slate-600' },
                        step.items.map((item, i) => React.createElement('li', { key: i, className: 'flex items-start gap-2' },
                          React.createElement('span', { className: 'text-[#6EBD84] mt-1' }, '‚ñ∏'), item
                        ))
                      ),
                      step.tip && React.createElement('div', { className: 'mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800' }, 'üí° ' + step.tip),
                      step.email && React.createElement('div', { className: 'mt-3 p-3 bg-slate-50 border-l-4 border-[#243186] rounded text-sm' },
                        React.createElement('p', { className: 'font-bold text-[#243186] mb-1' }, 'üìß ' + (lang === 'de' ? 'E-Mail Vorlage:' : lang === 'it' ? 'Modello email:' : 'Email template:')),
                        React.createElement('pre', { className: 'text-slate-600 whitespace-pre-wrap font-sans' }, step.email)
                      ),
                      step.warning && React.createElement('div', { className: 'mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800 flex items-start gap-2' },
                        React.createElement(AlertCircle, { size: 16, className: 'flex-shrink-0 mt-0.5' }), step.warning
                      ),
                      // Produktions-Hinweis (orange Box)
                      step.productionNote && React.createElement('div', { className: 'mt-3 p-3 bg-orange-50 border-2 border-orange-300 rounded-lg text-sm text-orange-800 flex items-start gap-2' },
                        React.createElement(Factory, { size: 16, className: 'flex-shrink-0 mt-0.5 text-orange-600' }),
                        React.createElement('div', null,
                          React.createElement('span', { className: 'font-bold' }, 'üè≠ '),
                          step.productionNote
                        )
                      )
                    )
                  )
                ))
              ),
              React.createElement('div', { className: 'bg-gradient-to-r from-[#6EBD84] to-[#4D9360] rounded-xl p-5 text-white' },
                React.createElement('h3', { className: 'font-bold mb-3' }, 'üí° Quick Tips'),
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-2' },
                  tips.map((tip, i) =>
                    React.createElement('div', { key: i, className: 'flex items-center gap-2 bg-white/20 rounded px-3 py-2 text-sm' },
                      React.createElement(CheckCircle2, { size: 14 }), tip
                    )
                  )
                )
              )
            );
          };

          const renderCompetencyList = () => {
            // Bereichsauswahl wenn noch kein Bereich gew√§hlt
            if (!competencyArea) {
              return React.createElement('div', { className: "space-y-8 pb-10" },
                // Header
                React.createElement('div', { className: "bg-[#243186] rounded-xl p-6 shadow-lg mb-6 text-center" },
                  React.createElement('h2', { className: "text-2xl font-bold text-white mb-2" },
                    lang === 'de' ? 'Kompetenzen' : lang === 'it' ? 'Competenze' : 'Competencies'
                  ),
                  React.createElement('p', { className: "text-white/80" },
                    lang === 'de' ? 'Bitte w√§hlen Sie Ihren Bereich:' : lang === 'it' ? 'Seleziona la tua area:' : 'Please select your area:'
                  )
                ),
                // Bereichskarten
                React.createElement('div', { className: "grid md:grid-cols-2 gap-6 max-w-3xl mx-auto" },
                  // Verwaltung/Administration
                  React.createElement('div', {
                    onClick: () => setCompetencyArea('admin'),
                    className: "group bg-white p-8 rounded-2xl border-2 border-slate-200 shadow-lg hover:shadow-xl hover:border-[#6EBD84] cursor-pointer transition-all"
                  },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement('div', { className: "p-4 bg-[#F4FAF7] rounded-full text-[#6EBD84] group-hover:bg-[#6EBD84] group-hover:text-white transition-colors" },
                        React.createElement(Briefcase, { size: 48 })
                      )
                    ),
                    React.createElement('h3', { className: "text-xl font-bold text-slate-800 text-center mb-2" },
                      lang === 'de' ? 'Verwaltung' : lang === 'it' ? 'Amministrazione' : 'Administration'
                    ),
                    React.createElement('p', { className: "text-slate-500 text-center text-sm" },
                      lang === 'de' ? 'Administration & Management' : lang === 'it' ? 'Amministrazione & Management' : 'Administration & Management'
                    ),
                    React.createElement('div', { className: "mt-4 text-center" },
                      React.createElement('span', { className: "inline-flex items-center gap-1 text-sm text-[#6EBD84] font-medium" },
                        lang === 'de' ? '5 Kern- + 5 Leadership-Kompetenzen' : lang === 'it' ? '5 competenze base + 5 leadership' : '5 Core + 5 Leadership Competencies',
                        React.createElement(ChevronRight, { size: 16 })
                      )
                    )
                  ),
                  // Produktion & Logistik
                  React.createElement('div', {
                    onClick: () => setCompetencyArea('production'),
                    className: "group bg-white p-8 rounded-2xl border-2 border-slate-200 shadow-lg hover:shadow-xl hover:border-[#6EBD84] cursor-pointer transition-all"
                  },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement('div', { className: "p-4 bg-[#F4FAF7] rounded-full text-[#6EBD84] group-hover:bg-[#6EBD84] group-hover:text-white transition-colors" },
                        React.createElement(Factory, { size: 48 })
                      )
                    ),
                    React.createElement('h3', { className: "text-xl font-bold text-slate-800 text-center mb-2" },
                      lang === 'de' ? 'Produktion & Logistik' : lang === 'it' ? 'Produzione & Logistica' : 'Production & Logistics'
                    ),
                    React.createElement('p', { className: "text-slate-500 text-center text-sm" },
                      lang === 'de' ? 'Fertigung, Lager, Versand' : lang === 'it' ? 'Produzione, Magazzino, Spedizione' : 'Manufacturing, Warehouse, Shipping'
                    ),
                    React.createElement('div', { className: "mt-4 text-center" },
                      React.createElement('span', { className: "inline-flex items-center gap-1 text-sm text-[#6EBD84] font-medium" },
                        lang === 'de' ? '5 Kern-Kompetenzen' : lang === 'it' ? '5 competenze base' : '5 Core Competencies',
                        React.createElement(ChevronRight, { size: 16 })
                      )
                    )
                  )
                )
              );
            }

            // Je nach Bereich die richtigen Daten laden
            const isProduction = competencyArea === 'production';
            const currentData = isProduction ? APP_DATA_PRODUCTION[lang] : data;
            
            if (!currentData || !currentData.competencies) return null;
            
            const core = currentData.competencies.filter(c => c.category === 'core');
            const lead = isProduction ? [] : currentData.competencies.filter(c => c.category === 'leadership');
            const introData = isProduction ? currentData.intro : null;

            return React.createElement('div', { className: "space-y-6 pb-10" },
              // Bereichs-Header mit Navigation
              React.createElement('div', { className: "bg-white rounded-xl shadow-sm border border-slate-200 p-4 flex items-center justify-between" },
                React.createElement('div', { className: "flex items-center gap-3" },
                  React.createElement('div', { className: `p-2 rounded-lg ${isProduction ? 'bg-orange-100 text-orange-600' : 'bg-blue-100 text-blue-600'}` },
                    React.createElement(isProduction ? Factory : Briefcase, { size: 24 })
                  ),
                  React.createElement('div', null,
                    React.createElement('h2', { className: "font-bold text-slate-800" },
                      isProduction 
                        ? (lang === 'de' ? 'Produktion & Logistik' : lang === 'it' ? 'Produzione & Logistica' : 'Production & Logistics')
                        : (lang === 'de' ? 'Verwaltung / Administration' : lang === 'it' ? 'Amministrazione' : 'Administration')
                    ),
                    React.createElement('p', { className: "text-xs text-slate-500" },
                      isProduction 
                        ? (lang === 'de' ? '5 Kern-Kompetenzen' : lang === 'it' ? '5 competenze base' : '5 Core Competencies')
                        : (lang === 'de' ? '5 Kern- + 5 Leadership-Kompetenzen' : lang === 'it' ? '5 base + 5 leadership' : '5 Core + 5 Leadership')
                    )
                  )
                ),
                React.createElement('button', {
                  onClick: () => setCompetencyArea(null),
                  className: "flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors text-sm font-medium"
                }, 
                  React.createElement(ChevronLeft, { size: 16 }),
                  lang === 'de' ? 'Bereich wechseln' : lang === 'it' ? 'Cambia area' : 'Change area'
                )
              ),
              
              // BARS Explanation Box (unterschiedlich je nach Bereich)
              React.createElement('div', { className: "bg-[#243186] rounded-xl p-6 shadow-lg" },
                React.createElement('h2', { className: "text-2xl font-bold text-white mb-4 flex items-center gap-3" },
                  React.createElement(BookOpen, { size: 28, style: { color: "#6EBD84" } }),
                  lang === 'de' ? 'Bewertung anhand von Verhaltensankern (BARS)' : lang === 'it' ? 'Valutazione tramite ancore comportamentali (BARS)' : 'Behavioral Anchored Rating Scale (BARS)'
                ),
                React.createElement('div', { className: "space-y-4 text-white" },
                  // F√ºr Produktion: Spezielle Intro-Texte
                  isProduction && introData ? React.createElement('div', null,
                    React.createElement('p', { className: "text-lg leading-relaxed" }, introData.description),
                    // Hinweis zur Selbsteinsch√§tzung im Gespr√§ch
                    React.createElement('div', { className: "bg-amber-500/20 border border-amber-400/50 rounded-lg p-4 mt-4" },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement(AlertCircle, { size: 20, className: "text-amber-300 flex-shrink-0 mt-0.5" }),
                        React.createElement('p', { className: "text-amber-100 text-sm" }, introData.selfAssessmentNote)
                      )
                    ),
                    // Die drei Regeln
                    React.createElement('div', { className: "grid md:grid-cols-3 gap-4 mt-4" },
                      introData.rules.map((rule, idx) => 
                        React.createElement('div', { key: idx, className: "bg-white/10 rounded-lg p-4" },
                          React.createElement('h4', { className: "font-bold text-[#6EBD84] mb-1" }, `${idx + 1}. ${rule.title}`),
                          React.createElement('p', { className: "text-sm text-white/80" }, rule.desc)
                        )
                      )
                    )
                  ) : React.createElement('div', null,
                    // Standard f√ºr Verwaltung
                    React.createElement('p', { className: "text-lg leading-relaxed" },
                      lang === 'de' 
                        ? 'F√ºr jede Kompetenz wird ein Score von 1 bis 5 vergeben.'
                        : 'Per ogni competenza viene assegnato un punteggio da 1 a 5.'
                    ),
                    React.createElement('p', { className: "text-lg leading-relaxed" },
                      lang === 'de'
                        ? 'Basis ist nicht das "Bauchgef√ºhl", sondern der Vergleich des beobachteten Verhaltens mit den definierten Ankern.'
                        : 'La base non √® l\'intuizione, ma il confronto del comportamento osservato con gli ancore definiti.'
                    ),
                    React.createElement('div', { className: "bg-white/10 rounded-lg p-5 border-l-4", style: { borderColor: "#6EBD84" } },
                      React.createElement('div', { className: "flex items-start gap-3 mb-3" },
                        React.createElement(Lightbulb, { size: 24, style: { color: "#6EBD84" }, className: "flex-shrink-0 mt-1" }),
                        React.createElement('p', { className: "text-lg font-semibold", style: { color: "#6EBD84" } },
                          lang === 'de' 
                            ? 'Die Vorgehensweise f√ºr F√ºhrungskr√§fte:'
                            : 'La procedura per i manager:'
                        )
                      ),
                      React.createElement('p', { className: "text-white italic text-base leading-relaxed pl-9" },
                        lang === 'de'
                          ? 'Lese die Verhaltensanker im Handlungsleitfaden. Frage dich: "Welche Beschreibung passt am besten zu dem Verhalten, das ich dieses Jahr beobachtet habe?"'
                          : 'Leggi gli ancore comportamentali nella guida operativa. Chiediti: "Quale descrizione si adatta meglio al comportamento che ho osservato quest\'anno?"'
                      )
                    )
                  )
                )
              ),
              
              // Kern-Kompetenzen
              React.createElement('div', null,
                React.createElement('h3', { className: "text-lg font-bold text-slate-700 mb-4 flex items-center gap-2" },
                  React.createElement(Users, { size: 20 }), " ", 
                  isProduction 
                    ? (lang === 'de' ? 'Kern-Kompetenzen (Produktion & Logistik)' : lang === 'it' ? 'Competenze Base (Produzione & Logistica)' : 'Core Competencies (Production & Logistics)')
                    : t.coreComp
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 lg:grid-cols-3 gap-4" },
                  core.map(c => (
                    React.createElement('div', {
                      key: c.id,
                      onClick: () => navigateToCompetency(c.id, isProduction ? 'production' : 'admin'),
                      className: "group bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-[#BAE1CE] cursor-pointer transition-all"
                    },
                      React.createElement('div', { className: "flex justify-between items-start mb-3" },
                        React.createElement('div', { className: "p-2 bg-[#F4FAF7] rounded-lg text-[#6EBD84] group-hover:bg-[#6EBD84] group-hover:text-white transition-colors" }, React.createElement(c.icon, { size: 24 })),
                        React.createElement(ChevronRight, { size: 20, className: "text-slate-300 group-hover:text-[#6EBD84]" })
                      ),
                      React.createElement('h4', { className: "font-bold text-slate-800" }, c.title),
                      // Zeige Definition als Vorschau
                      React.createElement('p', { className: "text-xs text-slate-500 mt-2 line-clamp-2" }, c.definition)
                    )
                  ))
                )
              ),
              // Leadership-Kompetenzen (nur f√ºr Verwaltung)
              !isProduction && lead.length > 0 && React.createElement('div', null,
                React.createElement('h3', { className: "text-lg font-bold text-slate-700 mb-4 flex items-center gap-2" },
                  React.createElement(Briefcase, { size: 20 }), " ", t.leadComp
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 lg:grid-cols-3 gap-4" },
                  lead.map(c => (
                    React.createElement('div', {
                      key: c.id,
                      onClick: () => navigateToCompetency(c.id, 'admin'),
                      className: "group bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-[#BAE1CE] cursor-pointer transition-all"
                    },
                      React.createElement('div', { className: "flex justify-between items-start mb-3" },
                        React.createElement('div', { className: "p-2 bg-[#F4FAF7] rounded-lg text-[#6EBD84] group-hover:bg-[#6EBD84] group-hover:text-white transition-colors" }, React.createElement(c.icon, { size: 24 })),
                        React.createElement(ChevronRight, { size: 20, className: "text-slate-300 group-hover:text-[#6EBD84]" })
                      ),
                      React.createElement('h4', { className: "font-bold text-slate-800" }, c.title),
                      React.createElement('p', { className: "text-xs text-slate-500 mt-2 line-clamp-2" }, c.definition)
                    )
                  ))
                )
              )
            );
          };

          const renderDetailView = () => {
            const compData = getActiveCompetencyData();
            if (!compData) return null;
            const currentLevel = compData.levels[activeScore];
            const isProductionDetail = detailAreaContext === 'production';

            return React.createElement('div', { className: "animate-in slide-in-from-right duration-300 pb-12" },
              // Verbesserte Navigation
              React.createElement('button', {
                onClick: () => setActiveView('list'),
                className: "flex items-center gap-2 px-4 py-2 mb-4 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors text-sm font-medium"
              }, 
                React.createElement(ChevronLeft, { size: 16 }),
                lang === 'de' ? 'Zur√ºck zur √úbersicht' : lang === 'it' ? 'Torna alla panoramica' : 'Back to overview'
              ),
              React.createElement('div', { className: "bg-white rounded-xl shadow-lg overflow-hidden border border-slate-200" },
                React.createElement('div', { className: "p-6 md:p-8 bg-slate-50 border-b border-slate-100" },
                  React.createElement('div', { className: "flex items-center gap-4 mb-4" },
                    React.createElement('div', { className: `p-3 rounded-xl ${isProductionDetail ? 'bg-orange-500' : 'bg-[#6EBD84]'} text-white` }, React.createElement(compData.icon, { size: 32 })),
                    React.createElement('div', null,
                      React.createElement('h2', { className: "text-2xl font-bold text-slate-800" }, compData.title),
                      React.createElement('span', { className: `text-xs uppercase tracking-wider font-semibold px-2 py-1 rounded ${isProductionDetail ? 'bg-orange-100 text-orange-700' : 'bg-blue-100 text-blue-700'}` }, 
                        isProductionDetail 
                          ? (lang === 'de' ? 'Produktion & Logistik' : lang === 'it' ? 'Produzione & Logistica' : 'Production & Logistics')
                          : (compData.category === 'core' ? 'Core' : 'Leadership')
                      )
                    )
                  ),
                  React.createElement('p', { className: "text-slate-600 leading-relaxed" }, compData.definition),
                  
                  // Beobachtungstipps f√ºr Produktion
                  compData.observationTips && compData.observationTips.length > 0 && React.createElement('div', { className: "mt-4 bg-amber-50 border border-amber-200 rounded-lg p-4" },
                    React.createElement('h4', { className: "text-sm font-bold text-amber-800 mb-2 flex items-center gap-2" },
                      React.createElement(Eye, { size: 16 }),
                      lang === 'de' ? 'Woran erkenne ich das im Alltag?' : lang === 'it' ? 'Come lo riconosco nella quotidianit√†?' : 'How do I recognize this in daily work?'
                    ),
                    React.createElement('ul', { className: "space-y-1" },
                      compData.observationTips.map((tip, idx) => 
                        React.createElement('li', { key: idx, className: "text-sm text-amber-700 flex items-start gap-2" },
                          React.createElement('span', { className: "text-amber-500 mt-0.5" }, '‚Ä¢'),
                          tip
                        )
                      )
                    )
                  )
                ),
                React.createElement('div', { className: "p-6 md:p-8" },
                  React.createElement('div', { className: "flex flex-col items-center mb-8" },
                    React.createElement('span', { className: "text-sm font-semibold text-slate-400 mb-4 uppercase tracking-widest" }, t.selectScore),
                    React.createElement('div', { className: "flex gap-3 md:gap-6" },
                      [1, 2, 3, 4, 5].map(s => React.createElement(ScoreBadge, { key: s, score: s, active: activeScore === s }))
                    )
                  ),
                  React.createElement('div', { className: "bg-slate-50 rounded-2xl p-6 md:p-8 border border-slate-200 relative overflow-hidden transition-all" },
                    React.createElement('div', { className: `absolute top-0 left-0 w-2 h-full ${activeScore === 1 ? 'bg-red-500' : activeScore === 2 ? 'bg-orange-400' : activeScore === 3 ? 'bg-green-500' : activeScore === 4 ? 'bg-blue-500' : 'bg-[#6EBD84]'}` }),
                    React.createElement('div', { className: "mb-6" },
                      React.createElement('h3', { className: "text-lg font-bold text-slate-800 mb-2 flex items-center gap-2" },
                        activeScore === 3 ? React.createElement(CheckCircle2, { className: "text-green-600", size: 20 }) :
                        activeScore === 5 ? React.createElement(Award, { className: "text-[#6EBD84]", size: 20 }) :
                        activeScore === 1 ? React.createElement(ShieldAlert, { className: "text-red-500", size: 20 }) : React.createElement(BookOpen, { className: "text-slate-400", size: 20 }),
                        activeScore === 1 ? t.level1 :
                        activeScore === 2 ? t.level2 :
                        activeScore === 3 ? t.level3 :
                        activeScore === 4 ? t.level4 : t.level5
                      ),
                      React.createElement('p', { className: "text-slate-700 text-lg leading-relaxed whitespace-pre-line" }, currentLevel.text)
                    ),
                    React.createElement('div', { className: "bg-white rounded-xl p-5 border-l-4 border-l-slate-300 shadow-sm" },
                      React.createElement('h4', { className: "text-sm font-bold text-slate-400 uppercase mb-2 flex items-center gap-2" },
                        React.createElement(Lightbulb, { size: 16 }), " ", t.example
                      ),
                      React.createElement('p', { className: "text-slate-600 italic font-medium" }, `"${currentLevel.example}"`)
                    )
                  )
                )
              )
            );
          };

          // === GPS EXPLAINER RENDER FUNCTION ===
          const renderGPSExplainer = () => {
            return React.createElement('div', { className: "pb-12 space-y-8" },
              // Header
              React.createElement('div', { className: "mb-4" },
                React.createElement('h1', { className: "text-3xl font-bold text-slate-800 mb-2" }, t.gpsExplainerTitle),
                React.createElement('p', { className: "text-slate-600 text-lg" }, t.gpsExplainerSubtitle)
              ),
              
              // OPTIMIERUNG 1: HERO-SEKTION MIT VISUELLER FORMEL
              React.createElement('div', { 
                className: "text-white py-10 px-6 md:px-8 rounded-3xl mb-8 shadow-2xl",
                style: { background: "linear-gradient(135deg, #243186 0%, #1a2460 100%)" }
              },
                React.createElement('h2', { className: "text-2xl md:text-3xl font-bold text-center mb-8" }, 
                  lang === 'de' ? 'Die GPS-Formel' : 'La Formula GPS'
                ),
                
                // Formel-Visualisierung - verbessert f√ºr bessere Darstellung
                React.createElement('div', { className: "flex items-center justify-center gap-3 md:gap-5 flex-wrap" },
                  // WAS Box
                  React.createElement('div', { 
                    className: "bg-white/10 backdrop-blur rounded-xl p-5 md:p-6 w-[140px] md:w-[180px] border border-white/20"
                  },
                    React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-2 text-center" }, "50%"),
                    React.createElement('div', { className: "text-lg md:text-xl font-semibold mb-1 text-center", style: { color: "#6EBD84" } }, 
                      lang === 'de' ? 'WAS' : 'COSA'
                    ),
                    React.createElement('div', { className: "text-xs opacity-80 text-center" }, 
                      lang === 'de' ? 'Ziele & KPIs' : 'Obiettivi & KPI'
                    )
                  ),
                  
                  // Plus Symbol
                  React.createElement('div', { className: "text-3xl md:text-4xl font-bold opacity-70" }, "+"),
                  
                  // WIE Box
                  React.createElement('div', { 
                    className: "bg-white/10 backdrop-blur rounded-xl p-5 md:p-6 w-[140px] md:w-[180px] border border-white/20"
                  },
                    React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-2 text-center" }, "50%"),
                    React.createElement('div', { className: "text-lg md:text-xl font-semibold mb-1 text-center", style: { color: "#6EBD84" } }, 
                      lang === 'de' ? 'WIE' : 'COME'
                    ),
                    React.createElement('div', { className: "text-xs opacity-80 text-center" }, 
                      lang === 'de' ? 'Kompetenzen' : 'Competenze'
                    )
                  ),
                  
                  // Equals Symbol
                  React.createElement('div', { className: "text-3xl md:text-4xl font-bold opacity-70" }, "="),
                  
                  // GPS Box - jetzt als wei√üer Kasten mit gr√ºnem Text
                  React.createElement('div', { 
                    className: "bg-white rounded-xl p-5 md:p-6 w-[140px] md:w-[180px] shadow-lg"
                  },
                    React.createElement('div', { className: "text-lg md:text-xl font-bold mb-1 text-center", style: { color: "#243186" } }, "GPS"),
                    React.createElement('div', { className: "text-2xl md:text-3xl font-bold mb-1 text-center", style: { color: "#6EBD84" } }, "1.0‚Äì5.0"),
                    React.createElement('div', { className: "text-xs text-center text-slate-600" }, "Performance Score")
                  )
                ),
                
                // Hinweis-Badge - dezenter
                React.createElement('div', { className: "mt-6 text-center" },
                  React.createElement('div', { className: "inline-flex items-center gap-2 bg-white/10 px-4 py-2 rounded-full text-sm" },
                    React.createElement(Info, { size: 16, style: { color: "#6EBD84" } }),
                    React.createElement('span', { className: "opacity-90" }, 
                      lang === 'de' ? 'Beide Dimensionen z√§hlen gleich viel!' : 'Entrambe le dimensioni contano allo stesso modo!'
                    )
                  )
                ),
                
                // Manager/Mitarbeiter Unterscheidung - kompakter
                React.createElement('div', { className: "mt-4 flex justify-center gap-3 flex-wrap text-xs" },
                  React.createElement('div', { className: "bg-white/10 rounded-lg px-3 py-1.5" },
                    React.createElement('span', { className: "opacity-70" }, lang === 'de' ? 'MA: ' : 'Coll: '),
                    React.createElement('span', null, '50% + 50%')
                  ),
                  React.createElement('div', { className: "bg-white/10 rounded-lg px-3 py-1.5" },
                    React.createElement('span', { className: "opacity-70" }, lang === 'de' ? 'FK: ' : 'Dir: '),
                    React.createElement('span', null, '50% + 25% + 25%')
                  )
                )
              ),

              // WAS & WIE Cards - Visuell optimiert
              React.createElement('div', { className: "grid md:grid-cols-2 gap-6 mb-8" },
                
                // WAS Card
                React.createElement('div', { 
                  className: "text-white rounded-2xl p-6 md:p-8 shadow-xl transform hover:scale-[1.02] transition-all duration-300",
                  style: { background: "linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)" }
                },
                  React.createElement('div', { className: "flex items-center gap-4 mb-6" },
                    React.createElement('div', { className: "bg-white/20 rounded-full p-4" },
                      React.createElement(Target, { size: 32 })
                    ),
                    React.createElement('div', null,
                      React.createElement('div', { className: "text-3xl font-bold" }, "50%"),
                      React.createElement('div', { className: "text-lg font-semibold" }, t.wasExplainTitle)
                    )
                  ),
                  
                  React.createElement('div', { className: "space-y-4" },
                    React.createElement('p', { className: "text-white/90 leading-relaxed" }, t.wasExplainText),
                    
                    React.createElement('div', { className: "bg-white/10 rounded-lg p-4 backdrop-blur" },
                      React.createElement('div', { className: "text-xs font-semibold mb-2 opacity-75" }, 
                        lang === 'de' ? 'BEISPIEL:' : 'ESEMPIO:'
                      ),
                      React.createElement('div', { className: "text-sm" }, t.wasExplainExample)
                    ),
                    
                    React.createElement('div', { className: "flex items-center gap-2 text-sm font-semibold bg-white/20 rounded-lg px-4 py-2 w-fit" },
                      React.createElement(CheckCircle2, { size: 18 }),
                      lang === 'de' ? 'Objektiv messbar' : 'Oggettivamente misurabile'
                    )
                  )
                ),
                
                // WIE Card
                React.createElement('div', { 
                  className: "text-white rounded-2xl p-6 md:p-8 shadow-xl transform hover:scale-[1.02] transition-all duration-300",
                  style: { background: "linear-gradient(135deg, #6EBD84 0%, #3E7D4E 100%)" }
                },
                  React.createElement('div', { className: "flex items-center gap-4 mb-6" },
                    React.createElement('div', { className: "bg-white/20 rounded-full p-4" },
                      React.createElement(Brain, { size: 32 })
                    ),
                    React.createElement('div', null,
                      React.createElement('div', { className: "text-3xl font-bold" }, "50%"),
                      React.createElement('div', { className: "text-lg font-semibold" }, t.wieExplainTitle)
                    )
                  ),
                  
                  React.createElement('div', { className: "space-y-4" },
                    React.createElement('p', { className: "text-white/90 leading-relaxed" }, t.wieExplainText),
                    
                    // Gewichtung Pills
                    React.createElement('div', { className: "flex flex-wrap gap-2" },
                      React.createElement('div', { className: "bg-white/20 rounded-full px-4 py-2 text-sm font-semibold backdrop-blur" },
                        t.wieCoreExplainWeight
                      ),
                      React.createElement('div', { className: "bg-white/20 rounded-full px-4 py-2 text-sm font-semibold backdrop-blur" },
                        t.wieLeadExplainWeight
                      )
                    ),
                    
                    React.createElement('div', { className: "flex items-center gap-2 text-sm font-semibold bg-white/20 rounded-lg px-4 py-2 w-fit" },
                      React.createElement(ClipboardList, { size: 18 }),
                      lang === 'de' ? 'BARS-Methodik' : 'Metodologia BARS'
                    )
                  )
                )
              ),

              // Kompetenzen-√úbersicht (kompakt)
              React.createElement('div', { className: "bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 p-6" },
                React.createElement('h3', { className: "text-xl font-bold text-slate-800 mb-4 flex items-center gap-2" },
                  React.createElement(Users, { size: 24, style: { color: "#6EBD84" } }),
                  lang === 'de' ? 'Bewertete Kompetenzen' : 'Competenze valutate'
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 gap-4" },
                  // Kern-Kompetenzen
                  React.createElement('div', { className: "bg-purple-50 rounded-lg p-4 border border-purple-200" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-3" },
                      React.createElement('div', { className: "bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm" }, "5"),
                      React.createElement('span', { className: "font-bold text-purple-900" }, 
                        lang === 'de' ? 'Kern-Kompetenzen' : 'Competenze Core'
                      )
                    ),
                    React.createElement('div', { className: "text-sm text-slate-700 space-y-1" },
                      (lang === 'de' 
                        ? ['Fachkompetenz', 'Kommunikation', 'Probleml√∂sung', 'Anpassungsf√§higkeit', 'Selbstorganisation']
                        : ['Competenza tecnica', 'Comunicazione', 'Problem solving', 'Adattabilit√†', 'Auto-organizzazione']
                      ).map((comp, idx) => 
                        React.createElement('div', { key: idx, className: "flex items-center gap-2" },
                          React.createElement('span', { className: "text-purple-500" }, "‚Ä¢"),
                          comp
                        )
                      )
                    )
                  ),
                  // Leadership-Kompetenzen
                  React.createElement('div', { className: "bg-indigo-50 rounded-lg p-4 border border-indigo-200" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-3" },
                      React.createElement('div', { className: "bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm" }, "5"),
                      React.createElement('span', { className: "font-bold text-indigo-900" }, 
                        lang === 'de' ? 'Leadership-Kompetenzen' : 'Competenze Leadership'
                      ),
                      React.createElement('span', { className: "text-xs text-indigo-600 ml-2" }, 
                        lang === 'de' ? '(nur FK)' : '(solo dirigenti)'
                      )
                    ),
                    React.createElement('div', { className: "text-sm text-slate-700 space-y-1" },
                      (lang === 'de' 
                        ? ['Mitarbeiterf√ºhrung', 'Strategisches Denken', 'Entscheidungsf√§higkeit', 'Execution', 'Stakeholder-Mgmt']
                        : ['Gestione personale', 'Pensiero strategico', 'Capacit√† decisionale', 'Execution', 'Gestione stakeholder']
                      ).map((comp, idx) => 
                        React.createElement('div', { key: idx, className: "flex items-center gap-2" },
                          React.createElement('span', { className: "text-indigo-500" }, "‚Ä¢"),
                          comp
                        )
                      )
                    )
                  )
                )
              ),

              // BARS Conversion Table
              React.createElement('div', { className: "bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 overflow-hidden" },
                React.createElement('div', { className: "p-6 border-b border-slate-200", style: { backgroundColor: "#243186" } },
                  React.createElement('h3', { className: "text-2xl font-bold text-white flex items-center gap-3" },
                    React.createElement(Scale, { className: "w-7 h-7", style: { color: "#6EBD84" } }),
                    t.barsConversionTitle
                  ),
                  React.createElement('p', { className: "mt-2", style: { color: "#6EBD84" } }, t.barsConversionDesc)
                ),
                React.createElement('div', { className: "overflow-x-auto" },
                  React.createElement('table', { className: "w-full" },
                    React.createElement('thead', { className: "bg-slate-50" },
                      React.createElement('tr', null,
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          lang === 'de' ? 'Zielerreichung %' : 'Raggiungimento %'
                        ),
                        React.createElement('th', { className: "px-6 py-3 text-center text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          "BARS-Stufe"
                        ),
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          lang === 'de' ? 'Beschreibung' : 'Descrizione'
                        )
                      )
                    ),
                    React.createElement('tbody', { className: "bg-white divide-y divide-slate-200" },
                      BARS_RANGES.map((range, idx) => React.createElement('tr', { key: idx, className: "hover:bg-slate-50" },
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900" }, 
                          lang === 'de' ? range.label : 
                            (range.score === 5 ? 'Eccezionale (>130%)' :
                             range.score === 4 ? 'Superato (111-130%)' :
                             range.score === 3 ? 'Baseline (90-110%)' :
                             range.score === 2 ? 'Parziale (70-89%)' : 'Non raggiunto (<70%)')
                        ),
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-center" },
                          React.createElement('span', { 
                            className: `inline-flex items-center justify-center w-10 h-10 rounded-full text-white font-bold ${
                              range.score === 5 ? 'bg-green-600' :
                              range.score === 4 ? 'bg-emerald-500' :
                              range.score === 3 ? 'bg-blue-600' :
                              range.score === 2 ? 'bg-orange-500' : 'bg-red-600'
                            }`
                          }, range.score)
                        ),
                        React.createElement('td', { className: "px-6 py-4 text-sm text-slate-700" }, 
                          lang === 'de' ? 
                            (range.score === 5 ? 'Ziel herausragend √ºbertroffen' :
                             range.score === 4 ? 'Ziel √ºbertroffen' :
                             range.score === 3 ? 'Ziel vollst√§ndig erreicht (Baseline)' :
                             range.score === 2 ? 'Ziel teilweise erreicht' : 'Ziel nicht erreicht') :
                          lang === 'it' ?
                            (range.score === 5 ? 'Obiettivo superato eccezionalmente' :
                             range.score === 4 ? 'Obiettivo superato' :
                             range.score === 3 ? 'Obiettivo completamente raggiunto (Baseline)' :
                             range.score === 2 ? 'Obiettivo parzialmente raggiunto' : 'Obiettivo non raggiunto') :
                            (range.score === 5 ? 'Goal significantly exceeded' :
                             range.score === 4 ? 'Goal exceeded' :
                             range.score === 3 ? 'Goal fully achieved (Baseline)' :
                             range.score === 2 ? 'Goal partially achieved' : 'Goal not achieved')
                        )
                      ))
                    )
                  )
                )
              ),

              // Performance Rating Table
              React.createElement('div', { className: "bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 overflow-hidden" },
                React.createElement('div', { className: "p-6 border-b border-slate-200", style: { backgroundColor: "#243186" } },
                  React.createElement('h3', { className: "text-2xl font-bold text-white flex items-center gap-3" },
                    React.createElement(Award, { className: "w-7 h-7", style: { color: "#6EBD84" } }),
                    t.performanceRatingTitle
                  ),
                  React.createElement('p', { className: "mt-2", style: { color: "#6EBD84" } }, t.performanceRatingDesc)
                ),
                React.createElement('div', { className: "overflow-x-auto" },
                  React.createElement('table', { className: "w-full" },
                    React.createElement('thead', { className: "bg-slate-50" },
                      React.createElement('tr', null,
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          "GPS Range"
                        ),
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          "Rating"
                        )
                      )
                    ),
                    React.createElement('tbody', { className: "bg-white divide-y divide-slate-200" },
                      RATINGS.map((rating, idx) => React.createElement('tr', { key: idx, className: "hover:bg-slate-50" },
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-bold text-slate-900" }, 
                          `${rating.min.toFixed(2)} - ${rating.max.toFixed(2)}`
                        ),
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" },
                          React.createElement('span', { className: `px-3 py-1 rounded-full text-white text-sm font-bold ${rating.color}` }, 
                            rating.label
                          )
                        )
                      ))
                    )
                  )
                )
              ),

              // Calculation Example
              React.createElement('div', { className: "bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 p-6" },
                React.createElement('h3', { className: "text-2xl font-bold text-slate-800 mb-4 flex items-center gap-3" },
                  React.createElement(Calculator, { className: "w-7 h-7 text-slate-600" }),
                  t.calculationExampleTitle
                ),
                React.createElement('div', { className: "bg-slate-50 rounded-lg p-6 space-y-4" },
                  React.createElement('p', { className: "font-semibold text-slate-700" }, t.calculationExampleIntro),
                  React.createElement('ul', { className: "space-y-2 ml-4" },
                    React.createElement('li', { className: "text-slate-700" }, `‚Ä¢ ${t.calculationStep1}`),
                    React.createElement('li', { className: "text-slate-700" }, `‚Ä¢ ${t.calculationStep2}`),
                    React.createElement('li', { className: "text-slate-700" }, `‚Ä¢ ${t.calculationStep3}`)
                  ),
                  React.createElement('div', { className: "border-t border-slate-300 pt-4 mt-4" },
                    React.createElement('p', { className: "font-semibold text-slate-700 mb-2" }, t.calculationFormula),
                    React.createElement('p', { className: "font-mono text-lg text-slate-800 bg-white p-4 rounded border border-slate-200" }, 
                      "(4,0 √ó 0,5) + (3,2 √ó 0,25) + (4,0 √ó 0,25) = 3,8"
                    )
                  ),
                  React.createElement('div', { className: "bg-green-50 border-l-4 border-green-500 p-4 rounded" },
                    React.createElement('p', { className: "font-bold text-green-900" }, t.calculationResult)
                  )
                )
              ),

              // Why GPS Section
              React.createElement('div', { className: "rounded-xl shadow-lg p-8", style: { backgroundColor: "#243186" } },
                React.createElement('h3', { className: "text-2xl font-bold text-white mb-6 flex items-center gap-3" },
                  React.createElement(Lightbulb, { className: "w-7 h-7", style: { color: "#6EBD84" } }),
                  t.whyGPSTitle
                ),
                React.createElement('div', { className: "grid md:grid-cols-3 gap-6" },
                  React.createElement('div', { className: "bg-white bg-opacity-10 rounded-lg p-6" },
                    React.createElement('div', { className: "w-12 h-12 rounded-full flex items-center justify-center mb-4", style: { backgroundColor: "#6EBD84" } },
                      React.createElement(Scale, { className: "w-6 h-6 text-white" })
                    ),
                    React.createElement('h4', { className: "text-lg font-bold text-white mb-2" }, t.whyGPS1Title),
                    React.createElement('p', { className: "text-slate-300 text-sm" }, t.whyGPS1Text)
                  ),
                  React.createElement('div', { className: "bg-white bg-opacity-10 rounded-lg p-6" },
                    React.createElement('div', { className: "w-12 h-12 rounded-full flex items-center justify-center mb-4", style: { backgroundColor: "#6EBD84" } },
                      React.createElement(Target, { className: "w-6 h-6 text-white" })
                    ),
                    React.createElement('h4', { className: "text-lg font-bold text-white mb-2" }, t.whyGPS2Title),
                    React.createElement('p', { className: "text-slate-300 text-sm" }, t.whyGPS2Text)
                  ),
                  React.createElement('div', { className: "bg-white bg-opacity-10 rounded-lg p-6" },
                    React.createElement('div', { className: "w-12 h-12 rounded-full flex items-center justify-center mb-4", style: { backgroundColor: "#6EBD84" } },
                      React.createElement(TrendingUp, { className: "w-6 h-6 text-white" })
                    ),
                    React.createElement('h4', { className: "text-lg font-bold text-white mb-2" }, t.whyGPS3Title),
                    React.createElement('p', { className: "text-slate-300 text-sm" }, t.whyGPS3Text)
                  )
                )
              )
            );
          };

          // === MEINE SELBSTREFLEXION KOMPONENTE (1:1 identisch mit AppraisalForm) ===
          // === MEINE SELBSTREFLEXION KOMPONENTE (VOLLST√ÑNDIG wie AppraisalForm) ===
          const MySelfReflectionComponent = ({ lang, user, guestEmployee, isGuestMode, onComplete }) => {
            const e = React.createElement;
            const t = FORM_TEXT[lang] || FORM_TEXT['de'];
            const defs = DEFAULTS[lang] || DEFAULTS['de'];
            
            // === STATES (VOLLST√ÑNDIG wie AppraisalForm) ===
            const [isManager, setIsManager] = React.useState(false);
            const [isGenerating, setIsGenerating] = React.useState(false);
            const [firestoreDocId, setFirestoreDocId] = React.useState(null);
            const [loadingFirestore, setLoadingFirestore] = React.useState(true);
            
            // === SHARE-LINK STATES ===
            const [showShareModal, setShowShareModal] = React.useState(false);
            const [shareLink, setShareLink] = React.useState('');
            const [linkCopied, setLinkCopied] = React.useState(false);
            const [managerEmail, setManagerEmail] = React.useState('');
            
            // Initialisiere formData mit guestEmployee-Daten im Guest-Modus
            const [formData, setFormData] = React.useState({
              employee: isGuestMode && guestEmployee ? guestEmployee.name : '', 
              position: isGuestMode && guestEmployee ? (guestEmployee.position || '') : '', 
              manager: '', 
              date: new Date().toISOString().split('T')[0],
              strengths1: '', strengths2: '', 
              development1: '', development2: '', // Entwicklungsfelder
              careerComment: '',
              wishesNextYear: '', feedbackManager: '',
              feedbackQ1: '', feedbackQ2: '', feedbackQ3: '', feedbackQ4: '', feedbackQ5: '', feedbackQ6: '', feedbackQ7: 3,
              plannedBonus: '',
              managerEmail: '' // NEU: E-Mail der F√ºhrungskraft f√ºr Vorhalten
            });
            
            const [careerChecks, setCareerChecks] = React.useState([false, false, false, false, false]);
            
            // Im Guest-Modus: Option "Keine Ziele" - starte mit leeren Zielen
            const [goals, setGoals] = React.useState([
              { id: 101, name: '', weight: 60, achievement: 0 },
              { id: 102, name: '', weight: 40, achievement: 0 }
            ]);
            
            // State f√ºr "Keine Ziele vorhanden" Checkbox
            const [noGoalsMode, setNoGoalsMode] = React.useState(false);
            
            const [devPlan, setDevPlan] = React.useState([
              { id: 201, measure: '', responsible: '', deadline: '' }
            ]);
            
            const [coreList, setCoreList] = React.useState(() => {
              return defs.core.map(c => ({ ...c, rating: 3, comment: '' }));
            });
            const [leadList, setLeadList] = React.useState(() => {
              return defs.lead.map(c => ({ ...c, rating: 3, comment: '' }));
            });
            
            // UI States
            const [isSaving, setIsSaving] = React.useState(false);
            const [saveStatus, setSaveStatus] = React.useState(null);
            
            // Draft-ID: Im Guest-Modus basierend auf guestEmployee.id
            const draftId = isGuestMode && guestEmployee 
              ? `guest_self_${guestEmployee.id}_${new Date().getFullYear()}`
              : `my_self_${user?.uid}_${new Date().getFullYear()}`;
            const currentYear = new Date().getFullYear();
            const period = `${currentYear}`;
            
            // Handler f√ºr "Keine Ziele" Toggle
            const handleNoGoalsToggle = (checked) => {
              setNoGoalsMode(checked);
              if (checked) {
                // Alle Ziele entfernen
                setGoals([]);
              } else {
                // Standard-Ziele wiederherstellen
                setGoals([
                  { id: 101, name: '', weight: 60, achievement: 0 },
                  { id: 102, name: '', weight: 40, achievement: 0 }
                ]);
              }
            };
            
            // === LADE AUS FIRESTORE (beim Start) ===
            React.useEffect(() => {
              const loadFromFirestore = async () => {
                // Im Guest-Modus: Andere Logik f√ºr Laden
                if (isGuestMode && guestEmployee) {
                  // Pr√ºfe ob bereits eine Selbstreflexion f√ºr diesen Mitarbeiter existiert
                  try {
                    const snapshot = await db.collection('teamAppraisals')
                      .where('employeeId', '==', guestEmployee.id)
                      .where('type', 'in', ['self_assessment', 'self'])
                      .where('period', '==', period)
                      .limit(1)
                      .get();
                    
                    if (!snapshot.empty) {
                      const doc = snapshot.docs[0];
                      const data = doc.data();
                      devLog('‚úÖ Existierende Gast-Selbstreflexion gefunden:', doc.id);
                      setFirestoreDocId(doc.id);
                      
                      // Daten laden
                      if (data.formData) setFormData(prev => ({ ...prev, ...data.formData }));
                      if (data.goals && data.goals.length > 0) {
                        setGoals(data.goals);
                        setNoGoalsMode(false);
                      } else if (data.noGoalsMode) {
                        setNoGoalsMode(true);
                        setGoals([]);
                      }
                      // WICHTIG: Nur √ºberschreiben wenn Array nicht leer ist
                      if (data.coreList && data.coreList.length > 0) setCoreList(data.coreList);
                      if (data.leadList && data.leadList.length > 0) setLeadList(data.leadList);
                      if (data.devPlan) setDevPlan(data.devPlan);
                      if (data.careerChecks) setCareerChecks(data.careerChecks);
                      if (data.isManager !== undefined) setIsManager(data.isManager);
                      
                      // Info f√ºr User dass Entwurf geladen wurde
                      if (data.status === 'draft') {
                        devLog('üìù Entwurf geladen - Mitarbeiter kann fortfahren');
                      }
                    }
                  } catch (err) {
                    console.error('Fehler beim Laden der Gast-Selbstreflexion:', err);
                  }
                  setLoadingFirestore(false);
                  return;
                }
                
                // Normaler Modus (eingeloggter User)
                if (!user?.uid || !db) {
                  setLoadingFirestore(false);
                  return;
                }
                
                try {
                  devLog('üîç Suche Selbstreflexion in Firestore f√ºr User:', user.uid);
                  
                  // Suche existierende Selbstreflexion f√ºr dieses Jahr
                  // EINFACHE ABFRAGE ohne compound index - dann manuell filtern
                  devLog('üîç Lade Selbstreflexionen f√ºr User:', user.uid, 'Periode:', period);
                  const snapshot = await db.collection('teamAppraisals')
                    .where('createdByUid', '==', user.uid)
                    .where('period', '==', period)
                    .get();
                  
                  // Manuell nach Typ filtern und sortieren
                  const selfDocs = snapshot.docs.filter(doc => {
                    const type = doc.data().type;
                    return type === 'self' || type === 'self_assessment' || type === 'self_assessment_standalone';
                  }).sort((a, b) => {
                    const aTime = a.data().updatedAt || a.data().createdAt || '';
                    const bTime = b.data().updatedAt || b.data().createdAt || '';
                    return bTime.localeCompare(aTime); // Neueste zuerst
                  });
                  
                  devLog('üìä Gefunden:', snapshot.docs.length, 'Dokumente, davon', selfDocs.length, 'Selbstreflexionen');
                  
                  if (selfDocs.length > 0) {
                    const doc = selfDocs[0];
                    const data = doc.data();
                    devLog('‚úÖ Selbstreflexion aus Firestore geladen:', doc.id, 'Typ:', data.type);
                    
                    setFirestoreDocId(doc.id);
                    
                    // Daten in States laden - mit Validierung
                    if (data.formData && Object.keys(data.formData).length > 0) {
                      setFormData(prev => ({ ...prev, ...data.formData }));
                    }
                    
                    // Goals laden mit Validierung
                    if (data.noGoalsMode === true) {
                      setNoGoalsMode(true);
                      setGoals([]);
                    } else if (data.goals && Array.isArray(data.goals) && data.goals.length > 0) {
                      setGoals(data.goals);
                      setNoGoalsMode(false);
                    }
                    
                    // WICHTIG: Nur √ºberschreiben wenn Array nicht leer ist und g√ºltige Daten enth√§lt
                    if (data.coreList && Array.isArray(data.coreList) && data.coreList.length > 0) {
                      // Validiere dass coreList g√ºltige Daten hat
                      const isValid = data.coreList.every(c => c.id && typeof c.rating === 'number');
                      if (isValid) {
                        setCoreList(data.coreList);
                        devLog('üìä coreList geladen:', data.coreList.length, 'Kompetenzen');
                      } else {
                        console.warn('‚ö†Ô∏è coreList ung√ºltig, verwende Defaults');
                      }
                    }
                    
                    if (data.leadList && Array.isArray(data.leadList) && data.leadList.length > 0) {
                      const isValid = data.leadList.every(c => c.id && typeof c.rating === 'number');
                      if (isValid) {
                        setLeadList(data.leadList);
                        devLog('üìä leadList geladen:', data.leadList.length, 'Kompetenzen');
                      }
                    }
                    
                    if (data.devPlan && Array.isArray(data.devPlan)) setDevPlan(data.devPlan);
                    if (data.careerChecks && Array.isArray(data.careerChecks)) setCareerChecks(data.careerChecks);
                    if (typeof data.isManager === 'boolean') setIsManager(data.isManager);
                    
                    devLog('‚úÖ Alle Daten erfolgreich geladen aus Firestore');
                  } else {
                    devLog('üìù Keine existierende Selbstreflexion gefunden, lade lokalen Draft...');
                    // Fallback: Lokalen Draft laden
                    const draft = DraftManager.loadDraft(draftId);
                    if (draft) {
                      devLog('üìÇ Lokaler Draft gefunden');
                      if (draft.formData) setFormData(prev => ({ ...prev, ...draft.formData }));
                      if (draft.goals && Array.isArray(draft.goals)) setGoals(draft.goals);
                      if (draft.noGoalsMode === true) {
                        setNoGoalsMode(true);
                        setGoals([]);
                      }
                      // WICHTIG: Nur √ºberschreiben wenn Array nicht leer ist
                      if (draft.coreList && Array.isArray(draft.coreList) && draft.coreList.length > 0) setCoreList(draft.coreList);
                      if (draft.leadList && Array.isArray(draft.leadList) && draft.leadList.length > 0) setLeadList(draft.leadList);
                      if (draft.devPlan && Array.isArray(draft.devPlan)) setDevPlan(draft.devPlan);
                      if (draft.careerChecks && Array.isArray(draft.careerChecks)) setCareerChecks(draft.careerChecks);
                      if (typeof draft.isManager === 'boolean') setIsManager(draft.isManager);
                    }
                  }
                } catch (err) {
                  console.error('‚ùå Fehler beim Laden aus Firestore:', err);
                  // Fallback: Lokalen Draft laden
                  const draft = DraftManager.loadDraft(draftId);
                  if (draft) {
                    devLog('üìÇ Lokaler Draft als Fallback geladen');
                    if (draft.formData) setFormData(prev => ({ ...prev, ...draft.formData }));
                    if (draft.goals && Array.isArray(draft.goals)) setGoals(draft.goals);
                    if (draft.noGoalsMode === true) {
                      setNoGoalsMode(true);
                      setGoals([]);
                    }
                    if (draft.coreList && Array.isArray(draft.coreList) && draft.coreList.length > 0) setCoreList(draft.coreList);
                    if (draft.leadList && Array.isArray(draft.leadList) && draft.leadList.length > 0) setLeadList(draft.leadList);
                    if (draft.devPlan && Array.isArray(draft.devPlan)) setDevPlan(draft.devPlan);
                    if (draft.careerChecks && Array.isArray(draft.careerChecks)) setCareerChecks(draft.careerChecks);
                    if (typeof draft.isManager === 'boolean') setIsManager(draft.isManager);
                  }
                }
                setLoadingFirestore(false);
              };
              
              loadFromFirestore();
            }, [user?.uid]);
            
            // === BERECHNUNGEN (VOLLST√ÑNDIG wie AppraisalForm) ===
            const totalGoalWeight = goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
            
            // WAS-Score
            const calculateWAS = () => {
              let sum = 0, weight = 0;
              goals.forEach(g => {
                const w = parseFloat(g.weight) || 0;
                if (w > 0) { sum += getBarsScore(g.achievement) * (w / 100); weight += w; }
              });
              return weight > 0 ? (sum / (weight / 100)) : 0;
            };
            
            // WIE-Score
            const calculateWIE = (list) => {
              let sum = 0, weight = 0;
              list.forEach(i => {
                const w = parseFloat(i.weight) || 20;
                sum += (i.rating || 3) * (w / 100);
                weight += w;
              });
              return weight > 0 ? (sum / (weight / 100)) : 3;
            };
            
            const wasScore = calculateWAS();
            const wieCoreScore = calculateWIE(coreList);
            const wieLeadScore = calculateWIE(leadList);
            
            // GPS Berechnung (wie AppraisalForm)
            let finalGPS;
            const hasLeadershipScores = isManager && wieLeadScore > 0;
            
            if (goals.length === 0 || totalGoalWeight === 0) {
              if (isManager && hasLeadershipScores) {
                finalGPS = (wieCoreScore * 0.5) + (wieLeadScore * 0.5);
              } else {
                finalGPS = wieCoreScore;
              }
            } else {
              if (isManager && hasLeadershipScores) {
                finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.25) + (wieLeadScore * 0.25);
              } else {
                finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.5);
              }
            }
            
            // Bonus Berechnung
            const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
            const bonusPerGoal = goals.map(g => {
              const weight = parseFloat(g.weight) || 0;
              const achievement = parseFloat(g.achievement) || 0;
              const goalBonus = plannedBonusNum * (weight / 100);
              const achievementFactor = Math.min(achievement / 100, 1.0);
              return { goalBonus, payout: goalBonus * achievementFactor, achievement };
            });
            const totalBonusPayout = bonusPerGoal.reduce((sum, b) => sum + b.payout, 0);
            const bonusPayoutPercentage = plannedBonusNum > 0 ? (totalBonusPayout / plannedBonusNum * 100) : 0;
            
            // Halo-Effekt Erkennung
            const coreRatings = coreList.map(c => c.rating).filter(r => r > 0);
            const allCoreRatingsSame = coreRatings.length >= 5 && coreRatings.every(r => r === coreRatings[0]);
            const haloEffectWarning = allCoreRatingsSame && coreRatings.length >= 5;
            
            // === AUTO-SAVE: Alle 60 Sekunden automatisch in Firebase speichern ===
            const [lastAutoSave, setLastAutoSave] = React.useState(null);
            const [autoSaveEnabled, setAutoSaveEnabled] = React.useState(true);
            
            React.useEffect(() => {
              // Nur Auto-Save wenn nicht gerade manuell gespeichert wird und Daten vorhanden
              if (!autoSaveEnabled || isSaving || loadingFirestore) return;
              
              // Nur wenn mindestens der Name ausgef√ºllt ist
              const hasData = formData.employee?.trim() || 
                              coreList.some(c => c.comment?.trim()) ||
                              goals.some(g => g.name?.trim());
              
              if (!hasData) return;
              
              const autoSaveInterval = setInterval(async () => {
                // Nicht auto-saven wenn bereits abgeschlossen
                if (saveStatus === 'firebase_completed') return;
                
                devLog('‚è∞ Auto-Save startet...');
                try {
                  // Berechne Scores f√ºr Auto-Save
                  const autoSelfCoreScores = {};
                  const autoSelfCoreComments = {};
                  coreList.forEach(c => {
                    autoSelfCoreScores[c.id] = c.rating;
                    autoSelfCoreComments[c.id] = c.comment || '';
                  });
                  
                  const autoSelfLeaderScores = {};
                  const autoSelfLeaderComments = {};
                  if (isManager) {
                    leadList.forEach(c => {
                      autoSelfLeaderScores[c.id] = c.rating;
                      autoSelfLeaderComments[c.id] = c.comment || '';
                    });
                  }
                  
                  // WICHTIG: Deep Copies erstellen um Referenzprobleme zu vermeiden
                  const autoSaveData = {
                    type: isGuestMode ? 'self_assessment' : 'self_assessment_standalone',
                    status: 'draft',
                    period: period,
                    employeeName: formData.employee || (isGuestMode && guestEmployee ? guestEmployee.name : '') || '',
                    employeeEmail: formData.employeeEmail?.trim()?.toLowerCase() || '',
                    employeePosition: formData.position || '',
                    ...(isGuestMode && guestEmployee ? {
                      employeeId: guestEmployee.id,
                      userId: guestEmployee.userId,
                      isSelfAssessment: true
                    } : {
                      createdByUid: user?.uid || null,
                      isStandalone: true
                    }),
                    formData: { ...formData }, // Deep Copy
                    goals: noGoalsMode ? [] : goals.map(g => ({ ...g })), // Deep Copy
                    noGoalsMode: noGoalsMode,
                    coreList: coreList.map(c => ({ ...c })), // Deep Copy
                    leadList: isManager ? leadList.map(c => ({ ...c })) : [], // Deep Copy
                    devPlan: devPlan.map(d => ({ ...d })), // Deep Copy
                    careerChecks: [...careerChecks], // Deep Copy
                    isManager: isManager,
                    selfCoreScores: { ...autoSelfCoreScores },
                    selfCoreComments: { ...autoSelfCoreComments },
                    selfLeaderScores: isManager ? { ...autoSelfLeaderScores } : null,
                    selfLeaderComments: isManager ? { ...autoSelfLeaderComments } : null,
                    wasScore: noGoalsMode ? 0 : wasScore,
                    wieCoreScore: wieCoreScore,
                    wieLeadScore: isManager ? wieLeadScore : null,
                    finalGPS: finalGPS,
                    updatedAt: new Date().toISOString(),
                    isAutoSave: true
                  };
                  
                  if (db) {
                    // Stelle sicher dass Auth vorhanden
                    if (!auth.currentUser) {
                      await auth.signInAnonymously();
                    }
                    
                    if (firestoreDocId) {
                      await db.collection('teamAppraisals').doc(firestoreDocId).update(autoSaveData);
                    } else {
                      autoSaveData.createdAt = new Date().toISOString();
                      const docRef = await db.collection('teamAppraisals').add(autoSaveData);
                      setFirestoreDocId(docRef.id);
                    }
                    setLastAutoSave(new Date());
                    devLog('‚úÖ Auto-Save erfolgreich');
                  }
                } catch (err) {
                  console.error('‚ùå Auto-Save Fehler:', err);
                }
              }, 60000); // Alle 60 Sekunden
              
              return () => clearInterval(autoSaveInterval);
            }, [formData, goals, coreList, leadList, devPlan, careerChecks, isManager, noGoalsMode, firestoreDocId, autoSaveEnabled, isSaving, loadingFirestore, saveStatus]);
            
            // === HANDLER ===
            const handleFormChange = (field, value) => setFormData(prev => ({ ...prev, [field]: value }));
            
            const handleSave = async (status) => {
              setIsSaving(true);
              devLog('üíæ === SAVE START ===');
              devLog('Status:', status);
              devLog('firestoreDocId:', firestoreDocId);
              devLog('isGuestMode:', isGuestMode);
              devLog('user: authenticated');
              
              // Berechne selfCoreScores f√ºr linkedSelfAssessment Kompatibilit√§t
              const selfCoreScores = {};
              const selfCoreComments = {};
              coreList.forEach(c => {
                selfCoreScores[c.id] = c.rating;
                selfCoreComments[c.id] = c.comment || '';
              });
              devLog('coreList Eintr√§ge:', coreList.length);
              
              const selfLeaderScores = {};
              const selfLeaderComments = {};
              if (isManager) {
                leadList.forEach(c => {
                  selfLeaderScores[c.id] = c.rating;
                  selfLeaderComments[c.id] = c.comment || '';
                });
                devLog('leadList Eintr√§ge:', leadList.length);
              }
              
              // E-Mail der FK normalisieren
              const managerEmailNormalized = formData.managerEmail?.trim()?.toLowerCase() || null;
              
              // WICHTIG: Typ konsistent halten - wenn firestoreDocId existiert, behalte den urspr√ºnglichen Typ
              // Ansonsten verwende self_assessment_standalone f√ºr eingeloggte User
              const docType = isGuestMode ? 'self_assessment' : 'self_assessment_standalone';
              
              // Daten-Objekt f√ºr Firestore
              const saveData = {
                type: docType,
                status: status,
                period: period,
                employeeName: formData.employee || (isGuestMode && guestEmployee ? guestEmployee.name : user?.displayName) || 'Unbekannt',
                employeeEmail: formData.employeeEmail?.trim()?.toLowerCase() || user?.email || '',
                employeePosition: formData.position || '',
                managerName: formData.manager || '',
                // Guest-Modus: userId ist die FK-ID, employeeId ist der Mitarbeiter
                ...(isGuestMode && guestEmployee ? {
                  employeeId: guestEmployee.id,
                  userId: guestEmployee.userId, // Manager's userId
                  isSelfAssessment: true
                } : {
                  // Standalone-Modus (ohne Login oder mit Login aber ohne Team-Zuordnung)
                  createdByUid: user?.uid || null,
                  isStandalone: true
                }),
                formData: { ...formData }, // Kopie erstellen
                goals: noGoalsMode ? [] : [...goals], // Kopie erstellen
                noGoalsMode: noGoalsMode,
                coreList: coreList.map(c => ({ ...c })), // Deep Copy
                leadList: isManager ? leadList.map(c => ({ ...c })) : [], // Deep Copy
                devPlan: devPlan.map(d => ({ ...d })), // Deep Copy
                careerChecks: [...careerChecks], // Kopie erstellen
                isManager: isManager,
                // F√ºr linkedSelfAssessment Kompatibilit√§t
                selfCoreScores: { ...selfCoreScores },
                selfCoreComments: { ...selfCoreComments },
                selfLeaderScores: isManager ? { ...selfLeaderScores } : null,
                selfLeaderComments: isManager ? { ...selfLeaderComments } : null,
                // Scores
                wasScore: noGoalsMode ? 0 : wasScore,
                wieCoreScore: wieCoreScore,
                wieLeadScore: isManager ? wieLeadScore : null,
                finalGPS: finalGPS,
                // WICHTIG: F√ºr automatische Zuordnung zur FK
                pendingForEmail: status === 'completed' && managerEmailNormalized ? managerEmailNormalized : null,
                pendingStatus: status === 'completed' && managerEmailNormalized ? 'pending_claim' : null,
                updatedAt: new Date().toISOString()
              };
              
              devLog('üì¶ Save Data vorbereitet:', {
                type: saveData.type,
                status: saveData.status,
                coreListLength: saveData.coreList.length,
                goalsLength: saveData.goals.length,
                formDataKeys: Object.keys(saveData.formData)
              });
              
              try {
                // IMMER in Firebase speichern - auch ohne Login (anonyme Auth)
                if (db) {
                  // Stelle sicher, dass wir authentifiziert sind (anonym wenn n√∂tig)
                  if (!auth.currentUser) {
                    devLog('üîê Starte anonyme Authentifizierung f√ºr Speichern...');
                    await auth.signInAnonymously();
                    devLog('‚úì Anonymer Login erfolgreich');
                  }
                  
                  if (firestoreDocId) {
                    // Update existierendes Dokument
                    devLog('üìù Update existierendes Dokument:', firestoreDocId);
                    await db.collection('teamAppraisals').doc(firestoreDocId).update(saveData);
                    devLog('‚úÖ Selbstreflexion in Firestore aktualisiert:', firestoreDocId);
                  } else {
                    // Neues Dokument erstellen
                    saveData.createdAt = new Date().toISOString();
                    if (status === 'completed') {
                      saveData.submittedAt = new Date().toISOString();
                    }
                    devLog('üìù Erstelle neues Dokument...');
                    const docRef = await db.collection('teamAppraisals').add(saveData);
                    setFirestoreDocId(docRef.id);
                    devLog('‚úÖ Selbstreflexion in Firestore gespeichert:', docRef.id);
                  }
                  
                  // Auch lokal speichern als Backup
                  DraftManager.saveDraft(draftId, { ...saveData, firestoreId: firestoreDocId });
                  
                  setSaveStatus(status === 'completed' ? 'firebase_completed' : 'firebase_draft');
                  devLog('üíæ === SAVE COMPLETE ===');
                  
                  // USER FEEDBACK: Erfolgsmeldung anzeigen
                  if (status === 'draft') {
                    // F√ºr Entwurf: Kurze, nicht-blockierende Meldung
                    const feedbackMsg = lang === 'de' 
                      ? '‚úÖ Entwurf erfolgreich gespeichert!' 
                      : lang === 'it' 
                      ? '‚úÖ Bozza salvata con successo!' 
                      : '‚úÖ Draft saved successfully!';
                    
                    // Tempor√§res Toast-Element erstellen
                    const toast = document.createElement('div');
                    toast.textContent = feedbackMsg;
                    toast.style.cssText = `
                      position: fixed;
                      bottom: 100px;
                      left: 50%;
                      transform: translateX(-50%);
                      background: linear-gradient(135deg, #059669, #10b981);
                      color: white;
                      padding: 16px 32px;
                      border-radius: 12px;
                      font-weight: 600;
                      font-size: 16px;
                      box-shadow: 0 10px 40px rgba(5, 150, 105, 0.4);
                      z-index: 99999;
                      animation: slideUp 0.3s ease-out;
                    `;
                    document.body.appendChild(toast);
                    
                    // Nach 2.5 Sekunden ausblenden
                    setTimeout(() => {
                      toast.style.transition = 'opacity 0.3s, transform 0.3s';
                      toast.style.opacity = '0';
                      toast.style.transform = 'translateX(-50%) translateY(20px)';
                      setTimeout(() => toast.remove(), 300);
                    }, 2500);
                  } else if (status === 'completed') {
                    // F√ºr Abschlie√üen: Best√§tigungsmeldung
                    const completeMsg = lang === 'de'
                      ? 'üéâ Selbstreflexion erfolgreich abgeschlossen und gesendet!'
                      : lang === 'it'
                      ? 'üéâ Autovalutazione completata e inviata con successo!'
                      : 'üéâ Self-reflection completed and sent successfully!';
                    showToast(completeMsg, "success");
                  }
                  
                  // Im Guest-Modus: Callback aufrufen wenn abgeschlossen
                  if (isGuestMode && status === 'completed' && onComplete) {
                    setTimeout(() => onComplete(), 1500);
                  }
                } else {
                  // Fallback: Lokaler Draft (sollte nicht passieren)
                  console.warn('‚ö†Ô∏è Keine DB-Verbindung, speichere lokal');
                  DraftManager.saveDraft(draftId, saveData);
                  devLog('üíæ Selbstreflexion lokal gespeichert (kein Firebase)');
                  setSaveStatus(status);
                }
              } catch (err) {
                console.error('‚ùå Fehler beim Speichern:', err);
                console.error('Error Details:', err.message, err.code);
                // Fallback: Lokal speichern
                DraftManager.saveDraft(draftId, saveData);
                setSaveStatus('local_fallback');
                showToast(lang === 'de' ? 'Firebase-Fehler. Lokal gespeichert.' : 'Firebase error. Saved locally.', 'warning');
              }
              
              setTimeout(() => setSaveStatus(null), 3000);
              setIsSaving(false);
            };
            
            // === NEU: Abschlie√üen & Senden Handler ===
            const handleCompleteAndSend = async () => {
              // Validierung
              if (!formData.employee?.trim()) {
                showToast(lang === 'de' 
                  ? 'Bitte geben Sie Ihren Namen ein' 
                  : 'Per favore, inserisci il tuo nome', 'warning');
                return;
              }
              
              // Im Standalone-Modus (nicht Guest): FK-E-Mail ist Pflicht
              if (!isGuestMode && !formData.managerEmail?.trim()) {
                showToast(lang === 'de' 
                  ? 'Bitte E-Mail der F√ºhrungskraft eingeben' 
                  : 'Per favore, inserisci l\'e-mail del responsabile', 'warning');
                return;
              }
              
              // E-Mail-Format pr√ºfen
              if (!isGuestMode && formData.managerEmail?.trim()) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(formData.managerEmail.trim())) {
                  showToast(lang === 'de' 
                    ? 'Bitte g√ºltige E-Mail-Adresse eingeben' 
                    : 'Per favore, inserisci un indirizzo e-mail valido', 'warning');
                  return;
                }
              }
              
              // Speichern mit Status 'completed'
              await handleSave('completed');
              
              // Erfolgsmeldung - im Guest-Modus wird onComplete aufgerufen
              if (!isGuestMode) {
                const fkEmail = formData.managerEmail?.trim();
                showToast(lang === 'de' 
                  ? `Selbstreflexion √ºbermittelt f√ºr ${fkEmail}`
                  : `Autovalutazione inviata per ${fkEmail}`, 'success');
              }
            };
            
            // === SHARE-LINK GENERIERUNG ===
            const generateShareLink = () => {
              // Erstelle komprimierte Daten f√ºr den Link
              const shareData = {
                v: 2, // Version 2 mit Teil E+F
                n: formData.employee || 'Unbekannt',
                p: formData.position || '',
                m: formData.manager || '',
                e: user?.email || formData.employeeEmail || '',
                g: goals.filter(g => g.name?.trim()).map(g => ({
                  n: g.name,
                  w: g.weight,
                  a: g.achievement
                })),
                c: coreList.map(c => ({ i: c.id, r: c.rating, t: c.comment || '' })),
                l: isManager ? leadList.map(c => ({ i: c.id, r: c.rating, t: c.comment || '' })) : [],
                im: isManager,
                d: devPlan.filter(d => d.measure?.trim()).map(d => ({
                  m: d.measure,
                  r: d.responsible,
                  dl: d.deadline
                })),
                s1: formData.strengths1 || '',
                s2: formData.strengths2 || '',
                cc: formData.careerComment || '',
                ck: careerChecks,
                // NEU: Teil E und F
                wn: formData.wishesNextYear || '', // Teil E: Karrierew√ºnsche/Wishes Next Year
                fm: formData.feedbackManager || '', // Teil F: Feedback an F√ºhrungskraft
                // NEU: Teil F Feedback-Felder (Q1-Q7)
                fq1: formData.feedbackQ1 || '',
                fq2: formData.feedbackQ2 || '',
                fq3: formData.feedbackQ3 || '',
                fq4: formData.feedbackQ4 || '',
                fq5: formData.feedbackQ5 || '',
                fq6: formData.feedbackQ6 || '',
                fq7: formData.feedbackQ7 || 3,
                ts: new Date().toISOString(),
                period: period
              };
              
              // Base64-kodieren
              const encoded = btoa(encodeURIComponent(JSON.stringify(shareData)));
              const baseUrl = window.location.href.split('?')[0];
              const link = `${baseUrl}?import_self=${encoded}`;
              
              setShareLink(link);
              setShowShareModal(true);
              setLinkCopied(false);
            };
            
            const copyShareLink = async () => {
              try {
                await navigator.clipboard.writeText(shareLink);
                setLinkCopied(true);
                setTimeout(() => setLinkCopied(false), 3000);
              } catch (err) {
                // Fallback f√ºr √§ltere Browser
                const textArea = document.createElement('textarea');
                textArea.value = shareLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                setLinkCopied(true);
                setTimeout(() => setLinkCopied(false), 3000);
              }
            };
            
            // === SHARE MODAL COMPONENT ===
            const ShareModal = () => {
              if (!showShareModal) return null;
              
              const getText = (de, it, en) => lang === 'de' ? de : lang === 'it' ? it : en;
              
              return e('div', { 
                className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
                onClick: (ev) => ev.target === ev.currentTarget && setShowShareModal(false)
              },
                e('div', { className: 'bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto' },
                  // Header
                  e('div', { className: 'p-6 border-b border-slate-200', style: { backgroundColor: '#243186' } },
                    e('div', { className: 'flex items-center justify-between' },
                      e('h2', { className: 'text-2xl font-bold text-white flex items-center gap-3' },
                        e(Share2, { size: 28 }),
                        getText('Selbstreflexion teilen', 'Condividi autovalutazione', 'Share Self-Assessment')
                      ),
                      e('button', { 
                        onClick: () => setShowShareModal(false),
                        className: 'text-white hover:text-slate-200 transition-colors'
                      }, e(X, { size: 24 }))
                    )
                  ),
                  
                  // Content
                  e('div', { className: 'p-6 space-y-6' },
                    // Success Message
                    e('div', { className: 'bg-green-50 border border-green-200 rounded-xl p-4 flex items-start gap-3' },
                      e(CheckCircle2, { size: 24, className: 'text-green-600 flex-shrink-0 mt-0.5' }),
                      e('div', null,
                        e('p', { className: 'font-semibold text-green-800' }, 
                          getText('Ihre Selbstreflexion wurde gespeichert!', 'La tua autovalutazione √® stata salvata!', 'Your self-assessment has been saved!')
                        ),
                        e('p', { className: 'text-sm text-green-700 mt-1' },
                          getText(
                            'Jetzt k√∂nnen Sie sie mit Ihrer F√ºhrungskraft teilen.',
                            'Ora puoi condividerla con il tuo responsabile.',
                            'Now you can share it with your manager.'
                          )
                        )
                      )
                    ),
                    
                    // Step by Step Instructions
                    e('div', { className: 'bg-slate-50 rounded-xl p-5' },
                      e('h3', { className: 'font-bold text-slate-800 mb-4 flex items-center gap-2' },
                        e(ClipboardList, { size: 20, style: { color: '#243186' } }),
                        getText('So funktioniert\'s:', 'Come funziona:', 'How it works:')
                      ),
                      e('div', { className: 'space-y-4' },
                        // Step 1
                        e('div', { className: 'flex gap-4' },
                          e('div', { className: 'w-8 h-8 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0', style: { backgroundColor: '#243186' } }, '1'),
                          e('div', null,
                            e('p', { className: 'font-semibold text-slate-800' }, 
                              getText('Link kopieren', 'Copia il link', 'Copy the link')
                            ),
                            e('p', { className: 'text-sm text-slate-600' },
                              getText(
                                'Klicken Sie auf den Button unten, um den Link zu kopieren.',
                                'Clicca sul pulsante qui sotto per copiare il link.',
                                'Click the button below to copy the link.'
                              )
                            )
                          )
                        ),
                        // Step 2
                        e('div', { className: 'flex gap-4' },
                          e('div', { className: 'w-8 h-8 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0', style: { backgroundColor: '#243186' } }, '2'),
                          e('div', null,
                            e('p', { className: 'font-semibold text-slate-800' }, 
                              getText('Link an F√ºhrungskraft senden', 'Invia il link al responsabile', 'Send link to your manager')
                            ),
                            e('p', { className: 'text-sm text-slate-600' },
                              getText(
                                'Senden Sie den kopierten Link per E-Mail oder Teams an Ihre F√ºhrungskraft.',
                                'Invia il link copiato via e-mail o Teams al tuo responsabile.',
                                'Send the copied link via email or Teams to your manager.'
                              )
                            )
                          )
                        ),
                        // Step 3
                        e('div', { className: 'flex gap-4' },
                          e('div', { className: 'w-8 h-8 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0', style: { backgroundColor: '#6EBD84' } }, '3'),
                          e('div', null,
                            e('p', { className: 'font-semibold text-slate-800' }, 
                              getText('Fertig!', 'Fatto!', 'Done!')
                            ),
                            e('p', { className: 'text-sm text-slate-600' },
                              getText(
                                'Ihre F√ºhrungskraft √∂ffnet den Link und Ihre Selbstreflexion wird automatisch importiert.',
                                'Il tuo responsabile apre il link e la tua autovalutazione viene importata automaticamente.',
                                'Your manager opens the link and your self-assessment is automatically imported.'
                              )
                            )
                          )
                        )
                      )
                    ),
                    
                    // Link Box
                    e('div', { className: 'border border-slate-300 rounded-xl overflow-hidden' },
                      e('div', { className: 'bg-slate-100 px-4 py-2 border-b border-slate-300' },
                        e('span', { className: 'text-sm font-medium text-slate-600' }, 
                          getText('Ihr pers√∂nlicher Share-Link:', 'Il tuo link di condivisione:', 'Your personal share link:')
                        )
                      ),
                      e('div', { className: 'p-4 bg-white' },
                        e('div', { className: 'bg-slate-50 p-3 rounded-lg font-mono text-xs text-slate-600 break-all max-h-20 overflow-y-auto' },
                          shareLink
                        )
                      )
                    ),
                    
                    // Copy Button
                    e('button', {
                      onClick: copyShareLink,
                      className: 'w-full py-4 rounded-xl font-bold text-white flex items-center justify-center gap-3 transition-all transform hover:scale-[1.02]',
                      style: { backgroundColor: linkCopied ? '#6EBD84' : '#243186' }
                    },
                      linkCopied ? e(CheckCircle2, { size: 24 }) : e(Copy, { size: 24 }),
                      linkCopied 
                        ? getText('‚úì Link kopiert!', '‚úì Link copiato!', '‚úì Link copied!')
                        : getText('Link in Zwischenablage kopieren', 'Copia link negli appunti', 'Copy link to clipboard')
                    ),
                    
                    // Per E-Mail senden Button
                    e('button', {
                      onClick: () => {
                        const subject = encodeURIComponent(
                          getText(
                            `Meine Selbstreflexion - ${formData.employee || 'Mitarbeiter'}`,
                            `La mia autovalutazione - ${formData.employee || 'Collaboratore'}`,
                            `My Self-Assessment - ${formData.employee || 'Employee'}`
                          )
                        );
                        const body = encodeURIComponent(
                          getText(
                            `Hallo,\n\nanbei meine Selbstreflexion f√ºr das Jahresgespr√§ch.\n\nBitte √∂ffnen Sie folgenden Link, um meine Eingaben zu importieren:\n\n${shareLink}\n\nMit freundlichen Gr√º√üen\n${formData.employee || 'Ihr Mitarbeiter'}`,
                            `Salve,\n\nin allegato la mia autovalutazione per il colloquio annuale.\n\nApra il seguente link per importare i miei dati:\n\n${shareLink}\n\nCordiali saluti\n${formData.employee || 'Il tuo collaboratore'}`,
                            `Hello,\n\nplease find my self-assessment for the annual review.\n\nPlease open the following link to import my data:\n\n${shareLink}\n\nBest regards\n${formData.employee || 'Your employee'}`
                          )
                        );
                        window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
                      },
                      className: 'w-full py-4 rounded-xl font-bold text-white flex items-center justify-center gap-3 transition-all transform hover:scale-[1.02]',
                      style: { backgroundColor: '#6EBD84' }
                    },
                      e(Mail, { size: 24 }),
                      getText('Per E-Mail an F√ºhrungskraft senden', 'Invia via e-mail al responsabile', 'Send via email to manager')
                    ),
                    
                    // Email Template
                    e('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4' },
                      e('h4', { className: 'font-semibold text-blue-800 mb-2 flex items-center gap-2' },
                        e(Mail, { size: 18 }),
                        getText('Vorlage f√ºr Ihre E-Mail:', 'Modello per la tua e-mail:', 'Template for your email:')
                      ),
                      e('div', { className: 'bg-white p-3 rounded-lg text-sm text-slate-700 border border-blue-100' },
                        e('p', { className: 'mb-2' },
                          getText(
                            `Betreff: Meine Selbstreflexion - ${formData.employee || 'Name'}`,
                            `Oggetto: La mia autovalutazione - ${formData.employee || 'Nome'}`,
                            `Subject: My Self-Assessment - ${formData.employee || 'Name'}`
                          )
                        ),
                        e('p', { className: 'text-slate-600' },
                          getText(
                            `Hallo,\n\nanbei meine Selbstreflexion f√ºr das Jahresgespr√§ch.\n\nBitte √∂ffnen Sie folgenden Link, um meine Eingaben zu importieren:\n[Link einf√ºgen]\n\nMit freundlichen Gr√º√üen\n${formData.employee || 'Ihr Name'}`,
                            `Salve,\n\nin allegato la mia autovalutazione per il colloquio annuale.\n\nApra il seguente link per importare i miei dati:\n[Inserire link]\n\nCordiali saluti\n${formData.employee || 'Il tuo nome'}`,
                            `Hello,\n\nplease find my self-assessment for the annual review.\n\nPlease open the following link to import my data:\n[Insert link]\n\nBest regards\n${formData.employee || 'Your name'}`
                          )
                        )
                      )
                    ),
                    
                    // Warning
                    e('div', { className: 'flex items-start gap-3 text-sm text-slate-600' },
                      e(Info, { size: 18, className: 'flex-shrink-0 mt-0.5 text-slate-400' }),
                      e('p', null,
                        getText(
                          'Wichtig: Der Link enth√§lt Ihre Selbstreflexion. Teilen Sie ihn nur mit Ihrer F√ºhrungskraft.',
                          'Importante: Il link contiene la tua autovalutazione. Condividilo solo con il tuo responsabile.',
                          'Important: The link contains your self-assessment. Only share it with your manager.'
                        )
                      )
                    )
                  ),
                  
                  // Footer
                  e('div', { className: 'p-6 border-t border-slate-200 bg-slate-50' },
                    e('button', {
                      onClick: () => setShowShareModal(false),
                      className: 'w-full py-3 rounded-xl font-medium text-slate-600 bg-white border border-slate-300 hover:bg-slate-100 transition-colors'
                    },
                      getText('Schlie√üen', 'Chiudi', 'Close')
                    )
                  )
                )
              );
            };
            
            const handlePrint = () => { 
              if (!window.html2pdf) {
                showToast(lang === 'de' ? "PDF-Bibliothek nicht geladen" : "Libreria PDF non caricata", 'error');
                return;
              }
              
              // === HELPER F√úR DYNAMISCHE KOMPETENZ-NAMEN √úBERSETZUNG (PDF) ===
              const getTranslatedCompName = (compId) => {
                const coreComp = CORE_COMPETENCIES_CALC.find(c => c.id === compId);
                const leadComp = LEADERSHIP_COMPETENCIES_CALC.find(c => c.id === compId);
                const comp = coreComp || leadComp;
                
                if (!comp) return compId; // Fallback
                
                if (lang === 'it' && comp.nameIt) return comp.nameIt;
                if (lang === 'en' && comp.nameEn) return comp.nameEn;
                return comp.name;
              };
              
              setIsGenerating(true);
              
              setTimeout(() => {
                try {
                  const currentDate = new Date().toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
                  
                  // Container erstellen - identisch zum Beurteilungsbogen
                  const pdfContainer = document.createElement('div');
                  pdfContainer.style.cssText = `
                    width: 190mm;
                    box-sizing: border-box;
                    padding: 10mm;
                    background: white;
                    font-family: Arial, sans-serif;
                    color: #1e293b;
                    font-size: 10pt;
                    line-height: 1.4;
                  `;
                  
                  // Profil-Text
                  const profileShort = isManager 
                    ? (lang === 'de' ? 'FK (50/25/25)' : lang === 'it' ? 'Dir. (50/25/25)' : 'Mgr (50/25/25)')
                    : (lang === 'de' ? 'MA (50/50)' : lang === 'it' ? 'Coll. (50/50)' : 'Emp (50/50)');
                  
                  // GPS Formel
                  const gpsFormulaText = noGoalsMode 
                    ? (isManager 
                        ? (lang === 'de' ? '(100% WIE: 50% Kern + 50% Leadership)' : '(100% COME: 50% Core + 50% Leadership)')
                        : (lang === 'de' ? '(100% WIE: Kern-Kompetenzen)' : '(100% COME: Competenze Core)'))
                    : (isManager 
                        ? '(WAS 50% + WIE Core 25% + WIE Lead 25%)' 
                        : '(WAS 50% + WIE Core 50%)');
                  
                  // Professional PDF Layout - IDENTISCH zum Beurteilungsbogen
                  let pdfHTML = `
                    <!-- HEADER -->
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #243186;">
                      <div style="flex: 1;">
                        <h1 style="color: #243186; font-size: 26pt; margin: 0; font-weight: 700; letter-spacing: -0.5px;">nƒ±ederwƒ±eser</h1>
                        <p style="color: #6EBD84; font-size: 8pt; margin: 2px 0 0 0; font-weight: 600; letter-spacing: 1.5px;">FLEXIBLE FOOD PACKAGING</p>
                      </div>
                      <div style="text-align: right; flex-shrink: 0; padding-left: 10px;">
                        <p style="font-size: 8pt; color: #64748b; margin: 0;">Dok.: ${currentDate}</p>
                        <p style="font-size: 8pt; color: #64748b; margin: 2px 0 0 0;">${lang === 'de' ? 'Periode' : lang === 'it' ? 'Periodo' : 'Period'}: ${period}</p>
                      </div>
                    </div>
                    
                    <!-- DOCUMENT TITLE -->
                    <div style="background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%); color: white; padding: 15px 20px; margin-bottom: 20px; border-radius: 4px;">
                      <h2 style="margin: 0; font-size: 16pt; font-weight: 600;">${lang === 'de' ? 'Selbstreflexionsbogen' : lang === 'it' ? 'Modulo di Autovalutazione' : 'Self-Reflection Form'}</h2>
                      <p style="margin: 5px 0 0 0; font-size: 11pt; opacity: 0.9;">${lang === 'de' ? 'Mitarbeiter-Selbsteinsch√§tzung' : lang === 'it' ? 'Autovalutazione del Collaboratore' : 'Employee Self-Assessment'} | ${t.headerSubtitle || 'Strategie 2035'}</p>
                    </div>
                    
                    <!-- TEIL A: STAMMDATEN -->
                    <div style="margin-bottom: 20px; page-break-inside: avoid;">
                      <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                        <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partA}</h3>
                      </div>
                      <table style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                        <tr>
                          <td style="padding: 8px 10px; width: 22%; background: #f1f5f9; border: 1px solid #e2e8f0;">
                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.employee}</span>
                          </td>
                          <td style="padding: 8px 10px; width: 28%; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.employee || '‚Äì'}</td>
                          <td style="padding: 8px 10px; width: 22%; background: #f1f5f9; border: 1px solid #e2e8f0;">
                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.manager}</span>
                          </td>
                          <td style="padding: 8px 10px; width: 28%; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.manager || '‚Äì'}</td>
                        </tr>
                        <tr>
                          <td style="padding: 8px 10px; background: #f1f5f9; border: 1px solid #e2e8f0;">
                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.position}</span>
                          </td>
                          <td style="padding: 8px 10px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.position || '‚Äì'}</td>
                          <td style="padding: 8px 10px; background: #f1f5f9; border: 1px solid #e2e8f0;">
                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.profile || 'Profil / Rolle'}</span>
                          </td>
                          <td style="padding: 8px 10px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${profileShort}</td>
                        </tr>
                      </table>
                    </div>
                    
                    <!-- TEIL B: ZIELERREICHUNG (falls vorhanden) -->
                    ${!noGoalsMode && goals && goals.length > 0 ? `
                    <div style="margin-bottom: 20px;">
                      <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #3b82f6; margin-bottom: 10px;">
                        <h3 style="font-size: 12pt; margin: 0; color: #1e40af; font-weight: 600;">${t.partB || 'Teil B: Zielerreichung (WAS) ‚Äì 50% Gewichtung'}</h3>
                        <span style="background: #dbeafe; color: #1e40af; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                          Score: ${wasScore.toFixed(2)}
                        </span>
                      </div>
                      <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                        <thead>
                          <tr style="background: #1e40af; color: white;">
                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.goalName || 'Zielbezeichnung'}</th>
                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 70px;">${lang === 'de' ? 'Gewicht %' : 'Peso %'}</th>
                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 80px;">${lang === 'de' ? 'Erreichung %' : 'Raggiunto %'}</th>
                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 55px;">BARS</th>
                          </tr>
                        </thead>
                        <tbody>
                          ${goals.map((g, idx) => `
                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'};">
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0;">${g.name || '‚Äì'}</td>
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center;">${g.weight}%</td>
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center;">
                                <span style="padding: 2px 8px; border-radius: 10px; font-weight: 600; background: ${(g.achievement || 0) >= 100 ? '#dcfce7' : (g.achievement || 0) >= 80 ? '#fef9c3' : '#fee2e2'}; color: ${(g.achievement || 0) >= 100 ? '#166534' : (g.achievement || 0) >= 80 ? '#854d0e' : '#dc2626'};">
                                  ${g.achievement || 0}%
                                </span>
                              </td>
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 700;">${getBarsScore(g.achievement || 0)}</td>
                            </tr>
                          `).join('')}
                        </tbody>
                      </table>
                    </div>
                    ` : ''}
                    
                    <!-- TEIL C: KERN-KOMPETENZEN -->
                    <div style="margin-bottom: 20px;">
                      <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #6EBD84; margin-bottom: 10px;">
                        <h3 style="font-size: 12pt; margin: 0; color: #166534; font-weight: 600;">${t.partC}</h3>
                        <span style="background: #dcfce7; color: #166534; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                          Score: ${wieCoreScore.toFixed(2)}
                        </span>
                      </div>
                      <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                        <thead>
                          <tr style="background: #166534; color: white;">
                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 30%;">${t.compName}</th>
                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 60px;">${t.rating}</th>
                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.comment}</th>
                          </tr>
                        </thead>
                        <tbody>
                          ${coreList.map((c, idx) => `
                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f0fdf4'}; page-break-inside: avoid;">
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-weight: 500; vertical-align: top;">${getTranslatedCompName(c.id)}</td>
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                <span style="display: inline-block; width: 24px; height: 24px; line-height: 24px; background: #166534; color: white; border-radius: 50%; font-weight: 700; font-size: 10pt;">${c.rating}</span>
                              </td>
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-size: 9pt; color: #475569; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${c.comment || '‚Äì'}</td>
                            </tr>
                          `).join('')}
                        </tbody>
                      </table>
                    </div>
                    
                    <!-- TEIL C.2: LEADERSHIP-KOMPETENZEN (falls FK) -->
                    ${isManager && leadList && leadList.length > 0 ? `
                    <div style="margin-bottom: 20px;">
                      <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #059669; margin-bottom: 10px;">
                        <h3 style="font-size: 12pt; margin: 0; color: #059669; font-weight: 600;">${t.partCLead || 'Teil C.2: Leadership-Kompetenzen'}</h3>
                        <span style="background: #d1fae5; color: #059669; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                          Score: ${wieLeadScore.toFixed(2)}
                        </span>
                      </div>
                      <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                        <thead>
                          <tr style="background: #059669; color: white;">
                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 30%;">${t.compName}</th>
                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 60px;">${t.rating}</th>
                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.comment}</th>
                          </tr>
                        </thead>
                        <tbody>
                          ${leadList.map((l, idx) => `
                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#ecfdf5'}; page-break-inside: avoid;">
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-weight: 500; vertical-align: top;">${getTranslatedCompName(l.id)}</td>
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                <span style="display: inline-block; width: 24px; height: 24px; line-height: 24px; background: #059669; color: white; border-radius: 50%; font-weight: 700; font-size: 10pt;">${l.rating}</span>
                              </td>
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-size: 9pt; color: #475569; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${l.comment || '‚Äì'}</td>
                            </tr>
                          `).join('')}
                        </tbody>
                      </table>
                    </div>
                    ` : ''}
                    
                    <!-- GPS ERGEBNIS - Cyan statt Blau f√ºr Unterscheidung -->
                    <div style="margin-bottom: 20px; padding: 25px; background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%); border-radius: 8px; text-align: center; page-break-inside: avoid;">
                      <p style="font-size: 10pt; color: rgba(255,255,255,0.7); margin: 0 0 5px 0; text-transform: uppercase; letter-spacing: 2px;">SELF-ASSESSMENT GPS</p>
                      <p style="font-size: 52pt; font-weight: 900; margin: 10px 0; color: white;">${finalGPS.toFixed(2)}</p>
                      <p style="font-size: 10pt; color: #6EBD84; font-weight: 600; margin: 10px 0 0 0;">${gpsFormulaText}</p>
                      ${noGoalsMode ? `<p style="font-size: 9pt; color: #fbbf24; margin-top: 8px;">‚ö†Ô∏è ${lang === 'de' ? 'Ohne Zielvereinbarung' : 'Senza accordo obiettivi'}</p>` : ''}
                    </div>
                    
                    <!-- TEIL D: ST√ÑRKEN & ENTWICKLUNG -->
                    <div style="margin-bottom: 20px;">
                      <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                        <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partD}</h3>
                      </div>
                      <div style="margin-bottom: 15px;">
                        <p style="font-weight: 600; margin: 0 0 5px 0; font-size: 10pt; color: #334155;">${t.strengthsProfessional}</p>
                        <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; min-height: 40px; word-wrap: break-word; white-space: pre-wrap; font-size: 10pt;">${formData.strengths1 || '‚Äì'}</div>
                      </div>
                      <div style="margin-bottom: 15px;">
                        <p style="font-weight: 600; margin: 0 0 5px 0; font-size: 10pt; color: #334155;">${t.strengthsPersonal}</p>
                        <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; min-height: 40px; word-wrap: break-word; white-space: pre-wrap; font-size: 10pt;">${formData.strengths2 || '‚Äì'}</div>
                      </div>
                      
                      ${devPlan && devPlan.filter(d => d.measure).length > 0 ? `
                      <p style="font-weight: 600; margin: 15px 0 8px 0; font-size: 11pt; color: #243186;">${t.development || 'Entwicklungsma√ünahmen'}</p>
                      <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                        <thead>
                          <tr style="background: #243186; color: white;">
                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.measure || 'Ma√ünahme'}</th>
                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 120px;">${t.responsible || 'Verantwortlich'}</th>
                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 85px;">${t.deadline || 'Termin'}</th>
                          </tr>
                        </thead>
                        <tbody>
                          ${devPlan.filter(d => d.measure).map((d, idx) => `
                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'};">
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">${d.measure || '‚Äì'}</td>
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">${d.responsible || '‚Äì'}</td>
                              <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">${d.deadline || '‚Äì'}</td>
                            </tr>
                          `).join('')}
                        </tbody>
                      </table>
                      ` : ''}
                    </div>
                    
                    <!-- TEIL E: KARRIEREPERSPEKTIVEN -->
                    <div style="margin-bottom: 20px; page-break-inside: avoid;">
                      <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                        <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partE || 'Teil E: Karriereperspektive & Zielvorstellungen'}</h3>
                      </div>
                      <p style="font-size: 9pt; color: #64748b; margin-bottom: 8px;">${t.careerIntro || 'Welche Zielvorstellungen hat der/die Mitarbeiter:in?'}</p>
                      <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
                        ${(t.careerOptions || ['Zufrieden mit aktueller Position', 'Strebe Fachkarriere an', 'Strebe F√ºhrungskarriere an', 'Offen f√ºr Abteilungswechsel', 'Offen f√ºr Standortwechsel']).map((opt, i) => careerChecks[i] ? `
                          <span style="padding: 6px 12px; background: #dcfce7; border: 1px solid #86efac; border-radius: 20px; font-size: 9pt; color: #166534;">‚úì ${opt}</span>
                        ` : '').join('') || `<span style="font-size: 9pt; color: #94a3b8; font-style: italic;">${lang === 'de' ? 'Keine Auswahl getroffen' : 'Nessuna selezione'}</span>`}
                      </div>
                      <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; font-size: 9pt; word-wrap: break-word; white-space: pre-wrap; min-height: 40px;">
                        ${formData.careerComment || `<span style="color: #94a3b8; font-style: italic;">${lang === 'de' ? 'Kein Kommentar' : 'Nessun commento'}</span>`}
                      </div>
                    </div>
                    
                    <!-- TEIL F: FEEDBACK -->
                    <div style="margin-bottom: 20px;">
                      <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                        <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partF || 'Teil F: Mitarbeiter-Feedback'}</h3>
                      </div>
                      <p style="font-size: 9pt; color: #64748b; margin-bottom: 12px;">${t.feedbackIntro || 'Bitte teile deine Einsch√§tzung zur Zusammenarbeit, den Arbeitsbedingungen und Entwicklungsm√∂glichkeiten mit.'}</p>
                      ${[
                        { label: t.feedbackQ1 || '1. F√ºhlst du dich ausreichend unterst√ºtzt und gef√∂rdert?', value: formData.feedbackQ1 },
                        { label: t.feedbackQ2 || '2. Welche Verbesserungsvorschl√§ge hast du (Prozesse, Tools, Arbeitsbedingungen)?', value: formData.feedbackQ2 },
                        { label: t.feedbackQ3 || '3. Auf welche gr√∂√üeren Schwierigkeiten bist du dieses Jahr gesto√üen?', value: formData.feedbackQ3 },
                        { label: t.feedbackQ4 || '4. Was war dein gr√∂√üter pers√∂nlicher Erfolgsmoment?', value: formData.feedbackQ4 },
                        { label: t.feedbackQ5 || '5. Wie nimmst du die √Ñnderung der Unternehmensstrategie wahr?', value: formData.feedbackQ5 },
                        { label: t.feedbackQ6 || '6. Welche Projekte w√ºrdest du f√ºr deine Abteilung vorschlagen?', value: formData.feedbackQ6 },
                        { label: t.feedbackQ7 || '7. Wie bewertest du deine Work-Life-Balance? (1=sehr schlecht, 5=sehr gut)', value: formData.feedbackQ7 || '3' }
                      ].map(item => `
                        <div style="margin-bottom: 10px;">
                          <p style="font-weight: 600; margin: 0 0 4px 0; font-size: 9pt; color: #334155;">${item.label}</p>
                          <div style="padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; min-height: 30px; font-size: 9pt; word-wrap: break-word; white-space: pre-wrap;">${item.value || '‚Äì'}</div>
                        </div>
                      `).join('')}
                    </div>
                    
                    <!-- TEIL G: UNTERSCHRIFTEN -->
                    <div style="margin-top: 30px; padding: 20px; border: 2px solid #0891b2; border-radius: 6px; page-break-inside: avoid;">
                      <h3 style="font-size: 12pt; margin: 0 0 25px 0; color: #0891b2; font-weight: 600; text-align: center;">${t.partH || 'Teil G: Unterschriften & Einverst√§ndnis'}</h3>
                      <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                        <div style="width: 42%; text-align: center;">
                          <div style="border-bottom: 2px solid #1e293b; height: 60px;"></div>
                          <p style="margin: 8px 0 0 0; font-size: 9pt; color: #64748b;">${t.employee}</p>
                          <p style="margin: 2px 0 0 0; font-size: 8pt; color: #94a3b8;">${lang === 'de' ? 'Datum, Unterschrift' : lang === 'it' ? 'Data, Firma' : 'Date, Signature'}</p>
                        </div>
                        <div style="width: 42%; text-align: center;">
                          <div style="border-bottom: 2px solid #1e293b; height: 60px;"></div>
                          <p style="margin: 8px 0 0 0; font-size: 9pt; color: #64748b;">${t.manager}</p>
                          <p style="margin: 2px 0 0 0; font-size: 8pt; color: #94a3b8;">${lang === 'de' ? 'Datum, Unterschrift' : lang === 'it' ? 'Data, Firma' : 'Date, Signature'}</p>
                        </div>
                      </div>
                    </div>
                    
                    <!-- FOOTER -->
                    <div style="margin-top: 30px; padding-top: 10px; border-top: 1px solid #e2e8f0; text-align: center;">
                      <p style="font-size: 8pt; color: #94a3b8; margin: 0;">
                        Niederwieser Group | ${lang === 'de' ? 'Selbstreflexionsbogen' : lang === 'it' ? 'Modulo di Autovalutazione' : 'Self-Reflection Form'} | ${currentDate}
                      </p>
                      <p style="font-size: 7pt; color: #cbd5e1; margin: 3px 0 0 0;">
                        ${lang === 'de' ? 'Dieses Dokument ist vertraulich und nur f√ºr den internen Gebrauch bestimmt.' : lang === 'it' ? 'Questo documento √® riservato e destinato esclusivamente all\'uso interno.' : 'This document is confidential and intended for internal use only.'}
                      </p>
                    </div>
                  `;
                  
                  pdfContainer.innerHTML = pdfHTML;
                  document.body.appendChild(pdfContainer);
                  
                  const opt = {
                    margin: 10,
                    filename: `Selbstreflexion_${(formData.employee || 'Export').replace(/[^a-z0-9√§√∂√º√ü]/gi, '_')}_${period}.pdf`,
                    image: { type: 'jpeg', quality: 0.95 },
                    html2canvas: { 
                      scale: 2,
                      useCORS: true,
                      logging: false,
                      backgroundColor: '#ffffff'
                    },
                    jsPDF: { 
                      unit: 'mm', 
                      format: 'a4', 
                      orientation: 'portrait'
                    }
                  };
                  
                  window.html2pdf()
                    .set(opt)
                    .from(pdfContainer)
                    .save()
                    .then(() => {
                      document.body.removeChild(pdfContainer);
                      setIsGenerating(false);
                    })
                    .catch(err => {
                      console.error('PDF Error:', err);
                      showToast(lang === 'de' ? 'PDF-Export fehlgeschlagen' : 'Errore export PDF', 'error');
                      if (document.body.contains(pdfContainer)) {
                        document.body.removeChild(pdfContainer);
                      }
                      setIsGenerating(false);
                    });
                    
                } catch (error) {
                  console.error('PDF Generation Error:', error);
                  showToast(lang === 'de' ? 'PDF-Export fehlgeschlagen' : 'Errore export PDF', 'error');
                  setIsGenerating(false);
                }
              }, 300);
            };
            
            // Item-Management
            const addItem = (list, setList, template) => {
              const newId = Math.max(...list.map(i => i.id || 0), 0) + 1;
              setList([...list, { ...template, id: newId }]);
            };
            const removeItem = (list, setList, id) => setList(list.filter(i => i.id !== id));
            const updateItem = (list, setList, id, field, value) => setList(list.map(i => i.id === id ? { ...i, [field]: value } : i));
            
            // Ziel-Zeile
            const renderGoalRow = (goal) => e('tr', { key: goal.id },
              e('td', { className: 'p-2 border' }, e('input', { type: 'text', value: goal.name, onChange: (ev) => updateItem(goals, setGoals, goal.id, 'name', ev.target.value), className: 'w-full outline-none', placeholder: t.goalName })),
              e('td', { className: 'p-2 border w-20' }, e('input', { type: 'number', value: goal.weight, onChange: (ev) => updateItem(goals, setGoals, goal.id, 'weight', parseInt(ev.target.value) || 0), className: 'w-full outline-none text-center', min: 0, max: 100 })),
              e('td', { className: 'p-2 border w-24' }, e('input', { type: 'number', value: goal.achievement, onChange: (ev) => updateItem(goals, setGoals, goal.id, 'achievement', parseInt(ev.target.value) || 0), className: 'w-full outline-none text-center', min: 0, max: 150 })),
              e('td', { className: 'p-2 border w-20 text-center' }, e('span', { className: 'text-sm font-medium' }, getBarsScore(goal.achievement || 0))),
              e('td', { className: 'p-2 border w-10 no-print' }, e('button', { onClick: () => removeItem(goals, setGoals, goal.id), className: 'text-red-500 hover:text-red-700' }, e(Trash2, { size: 16 })))
            );
            
            // Kompetenz-Zeile - MIT TEXTAREA statt Input f√ºr Kommentare
            const renderCompRow = (comp, list, setList) => {
              // === DYNAMISCHE KOMPETENZ-NAMEN √úBERSETZUNG ===
              const getTranslatedCompName = () => {
                const coreComp = CORE_COMPETENCIES_CALC.find(c => c.id === comp.id);
                const leadComp = LEADERSHIP_COMPETENCIES_CALC.find(c => c.id === comp.id);
                const foundComp = coreComp || leadComp;
                
                if (!foundComp) return comp.name; // Fallback
                
                if (lang === 'it' && foundComp.nameIt) return foundComp.nameIt;
                if (lang === 'en' && foundComp.nameEn) return foundComp.nameEn;
                return foundComp.name;
              };
              
              return e('tr', { key: comp.id },
                e('td', { className: 'p-2 border font-medium align-top' }, getTranslatedCompName()),
                e('td', { className: 'p-2 border w-24 align-top' }, e('select', { value: comp.rating, onChange: (ev) => updateItem(list, setList, comp.id, 'rating', parseInt(ev.target.value)), className: 'w-full outline-none bg-white' }, [1,2,3,4,5].map(n => e('option', { key: n, value: n }, n)))),
                e('td', { className: 'p-2 border align-top' }, 
                  e('textarea', { 
                    value: comp.comment || '', 
                    onChange: (ev) => updateItem(list, setList, comp.id, 'comment', ev.target.value), 
                    className: 'w-full outline-none border-none resize-none competency-comment-textarea', 
                    placeholder: t.comment,
                    rows: 2,
                    style: { minHeight: '40px', whiteSpace: 'pre-wrap', wordWrap: 'break-word' }
                  })
                )
              );
            };
            
            // Entwicklungsplan-Zeile
            const renderDevRow = (dev) => e('tr', { key: dev.id, className: 'break-inside-avoid' },
              e('td', { className: 'p-2 border align-top' }, e('textarea', { 
                value: dev.measure, 
                onChange: (ev) => {
                  updateItem(devPlan, setDevPlan, dev.id, 'measure', ev.target.value);
                  ev.target.style.height = 'auto';
                  ev.target.style.height = ev.target.scrollHeight + 'px';
                },
                onInput: (ev) => {
                  ev.target.style.height = 'auto';
                  ev.target.style.height = ev.target.scrollHeight + 'px';
                },
                className: 'w-full outline-none resize-none overflow-hidden min-h-[2rem]', 
                placeholder: t.devMeasure,
                rows: 1,
                style: { whiteSpace: 'pre-wrap', wordWrap: 'break-word' }
              })),
              e('td', { className: 'p-2 border w-32 align-top' }, e('input', { type: 'text', value: dev.responsible, onChange: (ev) => updateItem(devPlan, setDevPlan, dev.id, 'responsible', ev.target.value), className: 'w-full outline-none' })),
              e('td', { className: 'p-2 border w-28 align-top' }, e('input', { type: 'date', value: dev.deadline, onChange: (ev) => updateItem(devPlan, setDevPlan, dev.id, 'deadline', ev.target.value), className: 'w-full outline-none' })),
              e('td', { className: 'p-2 border w-10 no-print align-top' }, e('button', { onClick: () => removeItem(devPlan, setDevPlan, dev.id), className: 'text-red-500 hover:text-red-700' }, e(Trash2, { size: 16 })))
            );
            
            // === RENDER ===
            // Lade-Anzeige w√§hrend Firestore l√§dt
            if (loadingFirestore) {
              return e('div', { className: 'flex flex-col items-center justify-center py-20' },
                e(Loader2, { className: 'animate-spin text-blue-600', size: 48 }),
                e('p', { className: 'mt-4 text-slate-600' }, lang === 'de' ? 'Lade Selbstreflexion...' : 'Caricamento autovalutazione...')
              );
            }
            
            return e('div', { className: 'space-y-6 max-w-4xl mx-auto print:max-w-none' },
              
              // === SHARE MODAL ===
              e(ShareModal, null),
              
              // === HEADER ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100' },
                e('div', { className: 'flex justify-between items-start mb-6' },
                  e('div', null,
                    e('h1', { className: 'text-3xl font-bold', style: { color: '#243186' } }, 'nƒ±ederwƒ±eser'),
                    e('span', { className: 'text-sm tracking-wider font-medium', style: { color: '#6EBD84' } }, 'FLEXIBLE FOOD PACKAGING')
                  ),
                  e('button', { onClick: handlePrint, disabled: isGenerating, className: 'no-print flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-2xl hover:bg-blue-700 disabled:opacity-50' },
                    isGenerating ? e(Loader2, { className: 'animate-spin', size: 18 }) : e(Download, { size: 18 }), isGenerating ? t.generating : t.print)
                ),
                e('div', { className: 'border-b-2 border-slate-100 mb-4' }),
                
                // Speicher-Buttons
                e('div', { className: 'mb-6 p-5 bg-gradient-to-r from-[#243186] to-[#1a2564] rounded-xl no-print' },
                  e('div', { className: 'flex flex-col gap-4' },
                    e('div', { className: 'text-white' },
                      e('h2', { className: 'text-2xl font-bold', style: { color: '#6EBD84' } }, lang === 'de' ? 'Selbstreflexionsbogen' : 'Autovalutazione'),
                      e('p', { className: 'text-blue-200 text-sm' }, t.headerSubtitle)
                    ),
                    
                    // Buttons: Im Guest-Modus nur "Entwurf" und "Abschlie√üen", sonst mit Share
                    e('div', { className: isGuestMode ? 'grid grid-cols-2 gap-4' : 'grid grid-cols-3 gap-4' },
                      // Entwurf-Button
                      e('button', { 
                        onClick: () => handleSave('draft'), 
                        disabled: isSaving, 
                        className: 'bg-slate-200 hover:bg-slate-300 text-slate-900 py-4 px-5 rounded-xl font-bold flex items-center justify-center gap-2' 
                      }, 
                        e(Save, { size: 18 }),
                        (lang === 'de' ? 'Entwurf speichern' : lang === 'it' ? 'Salva bozza' : 'Save Draft')
                      ),
                      
                      // Abschlie√üen-Button - verwendet neuen idiotensicheren Handler
                      e('button', { 
                        onClick: handleCompleteAndSend, 
                        disabled: isSaving, 
                        className: 'bg-[#6EBD84] hover:bg-[#5da872] text-white py-4 px-5 rounded-xl font-bold flex items-center justify-center gap-2' 
                      }, 
                        e(Send, { size: 18 }),
                        isGuestMode 
                          ? (lang === 'de' ? 'Abschlie√üen & Senden' : lang === 'it' ? 'Completa & Invia' : 'Complete & Submit')
                          : (lang === 'de' ? 'Abschlie√üen & Senden' : lang === 'it' ? 'Completa & Invia' : 'Complete & Send')
                      ),
                      
                      // PDF-Button (nur im Normal-Modus)
                      !isGuestMode && e('button', { 
                        onClick: handlePrint, 
                        className: 'border-2 border-white/40 text-white py-4 px-5 rounded-xl font-bold hover:bg-white/20' 
                      }, 'PDF')
                    ),
                    
                    // Status-Anzeige
                    saveStatus && e('div', { className: 'text-center font-medium ' + (saveStatus.includes('firebase') ? 'text-green-300' : 'text-yellow-300') }, 
                      saveStatus === 'firebase_completed' 
                        ? (isGuestMode 
                            ? (lang === 'de' ? '‚úÖ Erfolgreich an Ihre F√ºhrungskraft gesendet!' : '‚úÖ Inviato con successo al tuo responsabile!')
                            : (lang === 'de' ? '‚úÖ Erfolgreich an Ihre F√ºhrungskraft √ºbermittelt!' : '‚úÖ Inviato con successo!'))
                        : saveStatus === 'firebase_draft' ? '‚òÅÔ∏è In Cloud als Entwurf gespeichert' 
                        : saveStatus === 'local_fallback' ? 'üíæ Lokal gespeichert (offline)' 
                        : '‚úì Gespeichert!'
                    ),
                    
                    // Loading-Indikator
                    isSaving && e('div', { className: 'text-center text-blue-200' },
                      e('span', { className: 'animate-pulse' }, 
                        lang === 'de' ? '‚è≥ Wird gespeichert...' : '‚è≥ Salvataggio in corso...'
                      )
                    ),
                    
                    // Auto-Save Indikator
                    lastAutoSave && !saveStatus && e('div', { className: 'text-center text-xs text-white/60 mt-2' },
                      lang === 'de' 
                        ? `‚òÅÔ∏è Auto-Save: ${lastAutoSave.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}`
                        : `‚òÅÔ∏è Auto-Save: ${lastAutoSave.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' })}`
                    )
                  )
                ),
                
                // Anleitung: UNTERSCHIEDLICH f√ºr Guest-Modus vs. Normal-Modus
                isGuestMode 
                  // === GUEST-MODUS: Einfache Info mit Auto-Save Hinweis ===
                  ? e('div', { className: 'bg-green-50 border-2 border-green-200 rounded-xl p-5 mb-4 no-print' },
                      e('div', { className: 'flex items-start gap-4' },
                        e('div', { className: 'w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0', style: { backgroundColor: '#6EBD84' } },
                          e(CheckCircle2, { size: 24, className: 'text-white' })
                        ),
                        e('div', null,
                          e('h4', { className: 'font-bold text-green-900 mb-2' }, 
                            lang === 'de' ? '‚úÖ Ihre Eingaben werden automatisch gespeichert' 
                            : lang === 'it' ? '‚úÖ I tuoi dati vengono salvati automaticamente'
                            : '‚úÖ Your entries are saved automatically'
                          ),
                          e('p', { className: 'text-sm text-green-800' },
                            lang === 'de' 
                              ? 'Sie k√∂nnen jederzeit unterbrechen und sp√§ter mit demselben Link fortfahren. Alle Eingaben werden automatisch in der Cloud gesichert. Klicken Sie am Ende auf "Abschlie√üen & Senden".'
                              : lang === 'it'
                              ? 'Puoi interrompere in qualsiasi momento e continuare pi√π tardi con lo stesso link. Tutti i dati vengono salvati automaticamente nel cloud. Clicca su "Completa & Invia" alla fine.'
                              : 'You can stop at any time and continue later with the same link. All entries are automatically saved in the cloud. Click "Complete & Send" when finished.'
                          ),
                          // NEU: Visueller Hinweis f√ºr Cloud-Speicherung
                          e('div', { className: 'mt-3 flex items-center gap-2 text-xs text-green-600' },
                            e('span', { className: 'w-2 h-2 rounded-full bg-green-500 animate-pulse' }),
                            lang === 'de' ? 'Cloud-Synchronisierung aktiv' : 'Sincronizzazione cloud attiva'
                          )
                        )
                      )
                    )
                  // === NORMAL-MODUS: Neue einfache Anleitung (kein Link-Kopieren mehr n√∂tig!) ===
                  : e('div', { className: 'bg-cyan-50 border-2 border-cyan-200 rounded-xl p-5 mb-4 no-print' },
                      e('div', { className: 'flex items-start gap-4' },
                        e('div', { className: 'w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0', style: { backgroundColor: '#0891b2' } },
                          e(Send, { size: 24, className: 'text-white' })
                        ),
                        e('div', null,
                          e('h4', { className: 'font-bold text-cyan-900 mb-2' }, 
                            lang === 'de' ? 'üöÄ So funktioniert es - kinderleicht!' 
                            : lang === 'it' ? 'üöÄ Come funziona - semplicissimo!'
                            : 'üöÄ How it works - super easy!'
                          ),
                          e('ol', { className: 'text-sm text-cyan-800 space-y-2' },
                            e('li', { className: 'flex items-start gap-2' },
                              e('span', { className: 'bg-cyan-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold flex-shrink-0' }, '1'),
                              lang === 'de' 
                                ? 'Geben Sie oben die E-Mail-Adresse Ihrer F√ºhrungskraft ein' 
                                : lang === 'it'
                                ? 'Inserisci sopra l\'indirizzo e-mail del tuo responsabile'
                                : 'Enter your manager\'s email address above'
                            ),
                            e('li', { className: 'flex items-start gap-2' },
                              e('span', { className: 'bg-cyan-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold flex-shrink-0' }, '2'),
                              lang === 'de' 
                                ? 'F√ºllen Sie das Formular aus' 
                                : lang === 'it'
                                ? 'Compila il modulo'
                                : 'Fill out the form'
                            ),
                            e('li', { className: 'flex items-start gap-2' },
                              e('span', { className: 'bg-cyan-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold flex-shrink-0' }, '3'),
                              lang === 'de' 
                                ? 'Klicken Sie auf "Abschlie√üen & Senden" - fertig!' 
                                : lang === 'it'
                                ? 'Clicca su "Completa & Invia" - finito!'
                                : 'Click "Complete & Send" - done!'
                            )
                          ),
                          e('div', { className: 'mt-3 p-3 bg-white/70 border border-cyan-200 rounded-lg' },
                            e('p', { className: 'text-cyan-800 text-sm flex items-center gap-2' },
                              e('span', { className: 'text-lg' }, '‚ú®'),
                              lang === 'de' 
                                ? 'Ihre F√ºhrungskraft bekommt Ihre Selbstreflexion automatisch in der App angezeigt - kein Link kopieren, keine E-Mail senden!'
                                : lang === 'it'
                                ? 'Il tuo responsabile vedr√† automaticamente la tua autovalutazione nell\'app - niente link da copiare, niente e-mail da inviare!'
                                : 'Your manager will automatically see your self-assessment in the app - no link to copy, no email to send!'
                            )
                          )
                        )
                      )
                    ),
                
                // Hinweis
                e('div', { className: 'bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4 no-print' },
                  e('p', { className: 'text-amber-800 text-sm' }, 'üí° ' + (lang === 'de' ? 'Hinweis: Alle Felder au√üer Name und FK-E-Mail sind freiwillig!' : lang === 'it' ? 'Nota: Tutti i campi tranne nome e e-mail FK sono facoltativi!' : 'Note: All fields except name and manager email are optional!'))
                ),
                
                // === NEU: BARS-Kompetenz-Hinweis mit Link zum √ñffnen in neuem Tab ===
                e('div', { className: 'bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 mb-4 no-print' },
                  e('div', { className: 'flex items-start gap-4' },
                    e('div', { className: 'w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg', style: { background: 'linear-gradient(135deg, #243186 0%, #1a2564 100%)' } },
                      e(BookOpen, { size: 28, className: 'text-white' })
                    ),
                    e('div', { className: 'flex-1' },
                      e('h4', { className: 'font-bold text-lg mb-2', style: { color: '#243186' } }, 
                        lang === 'de' ? 'üìö Verhaltensanker als Orientierung' 
                        : lang === 'it' ? 'üìö Ancoraggi comportamentali come riferimento'
                        : 'üìö Behavioral Anchors as Reference'
                      ),
                      e('p', { className: 'text-sm text-slate-700 mb-3' },
                        lang === 'de' 
                          ? 'Um die Kompetenzen richtig einzusch√§tzen, empfehlen wir Ihnen, die Verhaltensanker (BARS) in einem zweiten Fenster zu √∂ffnen. Dort finden Sie konkrete Beispiele f√ºr jede Bewertungsstufe (1-5).'
                          : lang === 'it'
                          ? 'Per valutare correttamente le competenze, ti consigliamo di aprire gli ancoraggi comportamentali (BARS) in una seconda finestra. L√¨ troverai esempi concreti per ogni livello di valutazione (1-5).'
                          : 'To correctly assess competencies, we recommend opening the behavioral anchors (BARS) in a second window. There you will find concrete examples for each rating level (1-5).'
                      ),
                      e('div', { className: 'flex flex-wrap gap-3' },
                        e('button', {
                          onClick: () => {
                            // √ñffne die App in einem neuen Tab mit dem Kompetenz-View
                            const baseUrl = window.location.href.split('?')[0];
                            const competencyUrl = baseUrl + '?view=competencies';
                            window.open(competencyUrl, '_blank', 'noopener,noreferrer');
                          },
                          className: 'flex items-center gap-2 px-5 py-3 rounded-xl font-bold text-white shadow-lg hover:shadow-xl transition-all transform hover:scale-105',
                          style: { background: 'linear-gradient(135deg, #6EBD84 0%, #5da872 100%)' }
                        },
                          e(BookOpen, { size: 18 }),
                          lang === 'de' ? 'Kompetenzen √∂ffnen (neues Fenster)' 
                          : lang === 'it' ? 'Apri competenze (nuova finestra)'
                          : 'Open Competencies (new window)'
                        ),
                        e('a', {
                          href: '#',
                          onClick: (ev) => {
                            ev.preventDefault();
                            const baseUrl = window.location.href.split('?')[0];
                            const competencyUrl = baseUrl + '?view=competencies';
                            navigator.clipboard.writeText(competencyUrl).then(() => {
                              showToast(lang === 'de' ? 'Link kopiert!' : lang === 'it' ? 'Link copiato!' : 'Link copied!', 'success');
                            }).catch(() => {
                              // Fallback
                              const textArea = document.createElement('textarea');
                              textArea.value = competencyUrl;
                              document.body.appendChild(textArea);
                              textArea.select();
                              document.execCommand('copy');
                              document.body.removeChild(textArea);
                              showToast(lang === 'de' ? 'Link kopiert!' : lang === 'it' ? 'Link copiato!' : 'Link copied!', 'success');
                            });
                          },
                          className: 'flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-slate-600 bg-white border border-slate-300 hover:bg-slate-50 transition-all cursor-pointer'
                        },
                          e(Link, { size: 16 }),
                          lang === 'de' ? 'Als Link kopieren' 
                          : lang === 'it' ? 'Copia come link'
                          : 'Copy as link'
                        )
                      ),
                      e('p', { className: 'text-xs text-slate-500 mt-3 flex items-center gap-1' },
                        e(Info, { size: 14 }),
                        lang === 'de' 
                          ? 'Tipp: Ordnen Sie beide Fenster nebeneinander an f√ºr optimales Arbeiten.'
                          : lang === 'it'
                          ? 'Suggerimento: Disponi entrambe le finestre una accanto all\'altra per un lavoro ottimale.'
                          : 'Tip: Arrange both windows side by side for optimal work.'
                      )
                    )
                  )
                ),
                
                e('h2', { className: 'text-2xl font-bold', style: { color: '#243186' } }, lang === 'de' ? 'Selbstreflexionsbogen' : lang === 'it' ? 'Modulo di autovalutazione' : 'Self-Reflection Form'),
                e('p', { className: 'font-medium', style: { color: '#6EBD84' } }, t.headerSubtitle)
              ),
              
              // === TEIL A: STAMMDATEN ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('h3', { className: 'text-lg font-bold text-slate-700 mb-4 border-b pb-2' }, t.partA),
                
                // === PROFIL-AUSWAHL (Mitarbeiter/F√ºhrungskraft) - PROMINENTER ===
                e('div', { className: 'no-print mb-6 p-4 bg-gradient-to-r from-[#E8F5ED] to-[#F0F9F4] border-2 border-[#6EBD84] rounded-xl' },
                  e('div', { className: 'flex items-center gap-2 mb-3' },
                    e('span', { className: 'text-lg' }, 'üë§'),
                    e('span', { className: 'font-bold text-[#243186]' }, 
                      lang === 'de' ? 'Ihr Profil ausw√§hlen:' : lang === 'it' ? 'Seleziona il tuo profilo:' : 'Select your profile:'
                    )
                  ),
                  e('div', { className: 'flex flex-col sm:flex-row gap-3' },
                    // Mitarbeitende Option
                    e('label', { 
                      className: `flex-1 flex items-center gap-3 p-3 rounded-lg cursor-pointer border-2 transition-all ${
                        !isManager 
                          ? 'bg-white border-[#243186] shadow-md' 
                          : 'bg-white/50 border-slate-200 hover:border-slate-300'
                      }`
                    }, 
                      e('input', { 
                        type: 'radio', 
                        checked: !isManager, 
                        onChange: () => setIsManager(false),
                        className: 'w-5 h-5 text-[#243186]'
                      }), 
                      e('div', null,
                        e('span', { className: 'font-semibold text-slate-800 block' }, t.roleEmp?.split('(')[0]?.trim() || 'Mitarbeitende'),
                        e('span', { className: 'text-xs text-slate-500' }, '50% WAS + 50% Kern-Kompetenzen')
                      )
                    ),
                    // F√ºhrungskraft Option
                    e('label', { 
                      className: `flex-1 flex items-center gap-3 p-3 rounded-lg cursor-pointer border-2 transition-all ${
                        isManager 
                          ? 'bg-white border-[#6EBD84] shadow-md' 
                          : 'bg-white/50 border-slate-200 hover:border-slate-300'
                      }`
                    }, 
                      e('input', { 
                        type: 'radio', 
                        checked: isManager, 
                        onChange: () => setIsManager(true),
                        className: 'w-5 h-5 text-[#6EBD84]'
                      }), 
                      e('div', null,
                        e('span', { className: 'font-semibold text-slate-800 block' }, t.roleMgr?.split('(')[0]?.trim() || 'F√ºhrungskraft'),
                        e('span', { className: 'text-xs text-slate-500' }, '50% WAS + 25% Kern + 25% Leadership')
                      )
                    )
                  ),
                  // Hinweis wenn F√ºhrungskraft gew√§hlt
                  isManager && e('div', { className: 'mt-3 text-sm text-[#059669] bg-white/80 p-2 rounded-lg flex items-center gap-2' },
                    e('span', null, '‚úÖ'),
                    lang === 'de' 
                      ? 'Sie bewerten sich auch in den 5 Leadership-Kompetenzen (Teil C.2)' 
                      : lang === 'it'
                      ? 'Valuterai anche le 5 competenze di leadership (Parte C.2)'
                      : 'You will also rate yourself on 5 leadership competencies (Part C.2)'
                  )
                ),
                e('div', { className: 'hidden print:block mb-4 font-bold' }, t.profile + ': ' + (isManager ? t.roleMgr : t.roleEmp)),
                
                e('div', { className: 'grid grid-cols-2 gap-6' },
                  e('div', null, e('label', { className: 'text-xs text-slate-500 block' }, t.employee), e('input', { type: 'text', value: formData.employee, onChange: (ev) => handleFormChange('employee', ev.target.value), className: 'w-full border-b border-slate-300 py-1 outline-none' })),
                  e('div', null, e('label', { className: 'text-xs text-slate-500 block' }, t.manager), e('input', { type: 'text', value: formData.manager, onChange: (ev) => handleFormChange('manager', ev.target.value), className: 'w-full border-b border-slate-300 py-1 outline-none' })),
                  e('div', null, e('label', { className: 'text-xs text-slate-500 block' }, t.position), e('input', { type: 'text', value: formData.position, onChange: (ev) => handleFormChange('position', ev.target.value), className: 'w-full border-b border-slate-300 py-1 outline-none' })),
                  e('div', null, e('label', { className: 'text-xs text-slate-500 block' }, t.date), e('input', { type: 'date', value: formData.date, onChange: (ev) => handleFormChange('date', ev.target.value), className: 'w-full border-b border-slate-300 py-1 outline-none' }))
                ),
                // NEU: FK-Email Feld - PFLICHT im Standalone-Modus f√ºr automatische Zuordnung
                !isGuestMode && e('div', { className: 'mt-4 p-4 bg-gradient-to-r from-cyan-50 to-blue-50 border-2 border-cyan-300 rounded-xl no-print' },
                  e('label', { className: 'text-sm font-bold text-cyan-900 block mb-2 flex items-center gap-2' }, 
                    e(Mail, { size: 18 }),
                    lang === 'de' ? 'üìß E-Mail-Adresse Ihrer F√ºhrungskraft (PFLICHT):' 
                    : lang === 'it' ? 'üìß Indirizzo e-mail del tuo responsabile (OBBLIGATORIO):'
                    : 'üìß Your manager\'s email address (REQUIRED):'
                  ),
                  e('input', { 
                    type: 'email', 
                    value: formData.managerEmail || '', 
                    onChange: (ev) => handleFormChange('managerEmail', ev.target.value), 
                    placeholder: lang === 'de' ? 'vorname.nachname@niederwieser.com' : 'nome.cognome@niederwieser.com',
                    className: 'w-full border-2 border-cyan-400 rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 text-lg' 
                  }),
                  e('div', { className: 'mt-3 p-3 bg-white/70 rounded-lg border border-cyan-200' },
                    e('p', { className: 'text-sm text-cyan-800 font-medium flex items-start gap-2' }, 
                      e('span', { className: 'text-lg' }, '‚ú®'),
                      e('span', null,
                        lang === 'de' 
                          ? 'Ihre Selbstreflexion wird automatisch Ihrer F√ºhrungskraft zugeordnet, sobald diese sich mit dieser E-Mail anmeldet. Kein Link-Kopieren oder E-Mail-Senden n√∂tig!'
                          : lang === 'it'
                          ? 'La tua autovalutazione verr√† automaticamente assegnata al tuo responsabile non appena effettuer√† l\'accesso con questa e-mail. Non √® necessario copiare link o inviare e-mail!'
                          : 'Your self-assessment will be automatically assigned to your manager as soon as they log in with this email. No link copying or email sending required!'
                      )
                    )
                  )
                ),
                
                // Im Guest-Modus: Keine E-Mail n√∂tig (wird automatisch zugeordnet)
                isGuestMode && e('div', { className: 'mt-4 p-4 bg-green-50 border border-green-200 rounded-xl no-print' },
                  e('p', { className: 'text-sm text-green-800 flex items-center gap-2' }, 
                    e(CheckCircle2, { size: 16 }),
                    lang === 'de' 
                      ? 'Ihre Selbstreflexion wird automatisch Ihrer F√ºhrungskraft zugeordnet, da Sie √ºber einen pers√∂nlichen Link aufgerufen wurde.'
                      : lang === 'it'
                      ? 'La tua autovalutazione sar√† automaticamente assegnata al tuo responsabile poich√© √® stata aperta tramite un link personale.'
                      : 'Your self-assessment will be automatically assigned to your manager since it was opened via a personal link.'
                  )
                )
              ),
              
              // === TEIL B: ZIELERREICHUNG (WAS) ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('div', { className: 'flex justify-between items-center mb-4 border-b pb-2' },
                  e('h3', { className: 'text-lg font-bold text-slate-700' }, t.partB),
                  e('span', { className: 'bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-bold' }, goals.length > 0 ? 'Score: ' + wasScore.toFixed(2) : (lang === 'de' ? 'Keine Ziele' : 'Nessun obiettivo'))
                ),
                
                // "Keine Ziele" Checkbox
                e('div', { className: 'mb-4 p-4 bg-amber-50 border border-amber-200 rounded-xl no-print' },
                  e('label', { className: 'flex items-center gap-3 cursor-pointer' },
                    e('input', { 
                      type: 'checkbox', 
                      checked: noGoalsMode,
                      onChange: (ev) => handleNoGoalsToggle(ev.target.checked),
                      className: 'w-5 h-5 rounded border-amber-400 text-amber-600 focus:ring-amber-500'
                    }),
                    e('div', null,
                      e('span', { className: 'font-medium text-amber-800' }, 
                        lang === 'de' ? 'Keine Ziele vereinbart' : lang === 'it' ? 'Nessun obiettivo concordato' : 'No goals agreed'
                      ),
                      e('p', { className: 'text-xs text-amber-600 mt-0.5' },
                        lang === 'de' 
                          ? 'Aktivieren Sie diese Option, falls f√ºr Sie keine Ziele festgelegt wurden. Der GPS wird dann nur aus den Kompetenzen (100%) berechnet.'
                          : lang === 'it'
                          ? 'Attiva questa opzione se non sono stati definiti obiettivi per te. Il GPS sar√† calcolato solo dalle competenze (100%).'
                          : 'Enable this option if no goals were set for you. GPS will be calculated from competencies only (100%).'
                      )
                    )
                  )
                ),
                
                // Ziele-Tabelle (nur wenn noGoalsMode = false)
                !noGoalsMode && e('table', { className: 'w-full text-sm' },
                  e('thead', { className: 'bg-slate-50 text-left' }, e('tr', null, e('th', { className: 'p-2 border' }, t.goalName), e('th', { className: 'p-2 border w-20' }, t.weight), e('th', { className: 'p-2 border w-24' }, t.achievement), e('th', { className: 'p-2 border w-20' }, 'BARS'), e('th', { className: 'p-2 border w-10 no-print' }, ''))),
                  e('tbody', null, goals.map(g => renderGoalRow(g)))
                ),
                !noGoalsMode && e('button', { onClick: () => addItem(goals, setGoals, { name: '', weight: 0, achievement: 0 }), className: 'no-print mt-3 text-xs flex items-center gap-1 text-blue-600' }, e(PlusCircle, { size: 14 }), ' ', t.addGoal),
                !noGoalsMode && totalGoalWeight !== 100 && goals.length > 0 && e('div', { className: 'mt-3 text-sm p-3 rounded-lg bg-yellow-50 text-yellow-700 border border-yellow-200 no-print' }, t.totalWeight + ': ' + totalGoalWeight + '% (' + t.shouldBe100 + ')'),
                
                // Info wenn keine Ziele
                noGoalsMode && e('div', { className: 'text-center py-8 text-slate-400' },
                  e('p', { className: 'text-sm' }, 
                    lang === 'de' 
                      ? 'üìä Der GPS wird nur aus Teil C (Kompetenzen = 100%) berechnet.'
                      : lang === 'it'
                      ? 'üìä Il GPS sar√† calcolato solo dalla Parte C (Competenze = 100%).'
                      : 'üìä GPS will be calculated from Part C only (Competencies = 100%).'
                  )
                ),
                
                // Bonus (nur wenn Ziele vorhanden)
                !noGoalsMode && e('div', { className: 'mt-6 pt-4 border-t border-slate-200' },
                  e('div', { className: 'flex items-center gap-4 mb-4' },
                    e('label', { className: 'text-sm font-semibold text-slate-700' }, lang === 'de' ? 'Geplanter Bonus (100%):' : 'Bonus pianificato:'),
                    e('div', { className: 'flex items-center gap-1' }, e('span', { className: 'text-slate-500' }, '‚Ç¨'), e('input', { type: 'text', value: formData.plannedBonus, onChange: (ev) => handleFormChange('plannedBonus', ev.target.value.replace(/[^\d]/g, '')), className: 'w-32 border-b border-slate-300 py-1 outline-none text-right', placeholder: '0' }))
                  ),
                  plannedBonusNum > 0 && e('div', { className: 'bg-emerald-50 border border-emerald-200 rounded-lg p-4' },
                    e('div', { className: 'flex justify-between items-center' },
                      e('div', { className: 'text-sm text-emerald-800' }, e('span', { className: 'font-medium' }, lang === 'de' ? 'Geplant: ' : 'Previsto: '), e('span', { className: 'font-bold' }, plannedBonusNum.toLocaleString('de-DE') + ' ‚Ç¨')),
                      e('div', { className: 'text-right' },
                        e('div', { className: 'text-xs text-emerald-600 mb-1' }, lang === 'de' ? 'Auszahlung:' : 'Pagamento:'),
                        e('div', { className: 'text-2xl font-black text-emerald-700' }, Math.round(totalBonusPayout).toLocaleString('de-DE') + ' ‚Ç¨'),
                        e('div', { className: 'text-xs font-medium ' + (bonusPayoutPercentage >= 100 ? 'text-green-600' : bonusPayoutPercentage >= 70 ? 'text-yellow-600' : 'text-red-600') }, '(' + bonusPayoutPercentage.toFixed(1) + '%)')
                      )
                    )
                  )
                )
              ),
              
              // === TEIL C: KERN-KOMPETENZEN ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('div', { className: 'flex justify-between items-center mb-4 border-b pb-2' },
                  e('h3', { className: 'text-lg font-bold text-slate-700' }, t.partC),
                  e('span', { className: 'bg-[#E8F5ED] text-[#4D9360] px-2 py-1 rounded text-xs font-bold' }, 'Score: ' + wieCoreScore.toFixed(2))
                ),
                e('table', { className: 'w-full text-sm' },
                  e('thead', { className: 'bg-slate-50 text-left' }, e('tr', null, e('th', { className: 'p-2 border' }, t.compName), e('th', { className: 'p-2 border w-24' }, t.rating), e('th', { className: 'p-2 border' }, t.comment))),
                  e('tbody', null, coreList.map(c => renderCompRow(c, coreList, setCoreList)))
                )
              ),
              
              // === TEIL C.2: LEADERSHIP-KOMPETENZEN (nur wenn isManager) ===
              isManager && e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('div', { className: 'flex justify-between items-center mb-4 border-b pb-2' },
                  e('h3', { className: 'text-lg font-bold text-[#5CA872]' }, t.partCLead),
                  e('span', { className: 'bg-[#E8F5ED] text-[#4D9360] px-2 py-1 rounded text-xs font-bold' }, 'Score: ' + wieLeadScore.toFixed(2))
                ),
                e('table', { className: 'w-full text-sm' },
                  e('thead', { className: 'bg-slate-50 text-left' }, e('tr', null, e('th', { className: 'p-2 border' }, t.compName), e('th', { className: 'p-2 border w-24' }, t.rating), e('th', { className: 'p-2 border' }, t.comment))),
                  e('tbody', null, leadList.map(c => renderCompRow(c, leadList, setLeadList)))
                )
              ),
              
              // === HALO-EFFEKT WARNUNG ===
              haloEffectWarning && e('div', { className: 'bg-amber-50 border-2 border-amber-400 rounded-xl p-4 no-print' },
                e('div', { className: 'flex items-start gap-3' },
                  e('div', { className: 'text-2xl' }, 'üé≠'),
                  e('div', null,
                    e('div', { className: 'font-bold text-amber-800 mb-1' }, lang === 'de' ? 'M√∂glicher Halo-Effekt' : 'Possibile Effetto Halo'),
                    e('p', { className: 'text-sm text-amber-700' }, lang === 'de' ? 'Alle Kompetenzen haben die gleiche Bewertung.' : 'Tutte le competenze hanno la stessa valutazione.')
                  )
                )
              ),
              
              // === TEIL C.3: GPS ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('h3', { className: 'text-lg font-bold text-slate-700 mb-4 border-b pb-2' }, t.partC3),
                e('div', { className: 'bg-slate-50 p-6 rounded-xl text-center border border-slate-200' },
                  e('div', { className: 'text-sm text-slate-500 uppercase tracking-widest mb-2' }, 'Final GPS'),
                  e('div', { className: 'text-5xl font-black text-slate-800' }, finalGPS.toFixed(2)),
                  e('div', { className: 'mt-2 font-medium text-[#6EBD84]' },
                    goals.length === 0 || totalGoalWeight === 0
                      ? (isManager ? '(100% WIE: 50% Core + 50% Leadership)' : '(100% WIE: Kern-Kompetenzen)')
                      : (isManager ? '(WAS 50% + WIE Core 25% + WIE Lead 25%)' : '(WAS 50% + WIE Core 50%)')
                  ),
                  goals.length === 0 && e('div', { className: 'mt-3 text-xs text-amber-600 bg-amber-50 px-3 py-1 rounded-full inline-block' }, lang === 'de' ? '‚ö†Ô∏è Ohne Zielvereinbarung' : '‚ö†Ô∏è Senza accordo obiettivi')
                )
              ),
              
              // === TEIL D: ST√ÑRKEN & ENTWICKLUNG ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('h3', { className: 'text-lg font-bold text-slate-700 mb-4 border-b pb-2' }, t.partD),
                e('div', { className: 'mb-6' }, e('label', { className: 'block text-sm font-bold mb-1 text-slate-700' }, t.strengthsProfessional), e('textarea', { value: formData.strengths1, onChange: (ev) => handleFormChange('strengths1', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 3 })),
                e('div', { className: 'mb-6' }, e('label', { className: 'block text-sm font-bold mb-1 text-slate-700' }, t.strengthsPersonal), e('textarea', { value: formData.strengths2, onChange: (ev) => handleFormChange('strengths2', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 3 })),
                e('div', null,
                  e('label', { className: 'block text-sm font-bold mb-2 text-slate-700' }, t.devPlanTitle),
                  e('table', { className: 'w-full text-sm' },
                    e('thead', { className: 'bg-slate-50 text-left' }, e('tr', null, e('th', { className: 'p-2 border' }, t.devMeasure), e('th', { className: 'p-2 border w-32' }, t.devResponsible), e('th', { className: 'p-2 border w-28' }, t.devDeadline), e('th', { className: 'p-2 border w-10 no-print' }, ''))),
                    e('tbody', null, devPlan.map(d => renderDevRow(d)))
                  ),
                  e('button', { onClick: () => addItem(devPlan, setDevPlan, { measure: '', responsible: '', deadline: '' }), className: 'no-print mt-3 text-xs flex items-center gap-1 text-[#6EBD84]' }, e(PlusCircle, { size: 14 }), ' ', t.addDev)
                )
              ),
              
              // === TEIL E: KARRIEREPERSPEKTIVE ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('h3', { className: 'text-lg font-bold text-slate-700 mb-4 border-b pb-2' }, t.partE),
                e('div', { className: 'space-y-3' },
                  [lang === 'de' ? 'Ich bin zufrieden mit meiner aktuellen Position' : 'Sono soddisfatto/a della mia posizione attuale',
                   lang === 'de' ? 'Ich strebe eine Fachkarriere an' : 'Aspiro a una carriera tecnica',
                   lang === 'de' ? 'Ich strebe eine F√ºhrungskarriere an' : 'Aspiro a una carriera manageriale',
                   lang === 'de' ? 'Ich bin offen f√ºr einen Abteilungswechsel' : 'Sono aperto/a a un cambio di reparto',
                   lang === 'de' ? 'Ich bin offen f√ºr einen Standortwechsel' : 'Sono aperto/a a un cambio di sede'
                  ].map((label, idx) => e('label', { key: idx, className: 'flex items-center gap-3 cursor-pointer' },
                    e('input', { type: 'checkbox', checked: careerChecks[idx], onChange: (ev) => { const n = [...careerChecks]; n[idx] = ev.target.checked; setCareerChecks(n); }, className: 'w-4 h-4 accent-[#6EBD84]' }),
                    e('span', { className: 'text-sm text-slate-700' }, label)
                  ))
                ),
                e('div', { className: 'mt-4' }, e('label', { className: 'block text-sm font-bold mb-1 text-slate-700' }, t.careerComment), e('textarea', { value: formData.careerComment, onChange: (ev) => handleFormChange('careerComment', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 3 })),
                // NEU: W√ºnsche f√ºr das kommende Jahr
                e('div', { className: 'mt-4' }, 
                  e('label', { className: 'block text-sm font-bold mb-1 text-slate-700 flex items-center gap-2' }, 
                    e(Target, { size: 16, className: 'text-purple-500' }),
                    lang === 'de' ? 'Meine W√ºnsche f√ºr das kommende Jahr' : lang === 'it' ? 'I miei desideri per l\'anno prossimo' : 'My wishes for the coming year'
                  ),
                  e('p', { className: 'text-xs text-slate-500 mb-2' },
                    lang === 'de' ? 'Welche Projekte, Aufgaben oder Entwicklungsm√∂glichkeiten w√ºnschen Sie sich?' 
                    : lang === 'it' ? 'Quali progetti, compiti o opportunit√† di sviluppo desideri?' 
                    : 'What projects, tasks or development opportunities would you like?'
                  ),
                  e('textarea', { 
                    value: formData.wishesNextYear || '', 
                    onChange: (ev) => handleFormChange('wishesNextYear', ev.target.value), 
                    className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', 
                    rows: 3,
                    placeholder: lang === 'de' ? 'z.B. neue Verantwortungsbereiche, Weiterbildungen, Projektteilnahme...' 
                                : lang === 'it' ? 'es. nuove responsabilit√†, formazione, partecipazione a progetti...' 
                                : 'e.g. new responsibilities, training, project participation...'
                  })
                )
              ),
              
              // === TEIL F: FEEDBACK ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('h3', { className: 'text-lg font-bold text-slate-700 mb-4 border-b pb-2' }, t.partF),
                e('div', { className: 'space-y-4' },
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ1), e('textarea', { value: formData.feedbackQ1, onChange: (ev) => handleFormChange('feedbackQ1', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ2), e('textarea', { value: formData.feedbackQ2, onChange: (ev) => handleFormChange('feedbackQ2', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ3), e('textarea', { value: formData.feedbackQ3, onChange: (ev) => handleFormChange('feedbackQ3', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ4), e('textarea', { value: formData.feedbackQ4, onChange: (ev) => handleFormChange('feedbackQ4', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ5), e('textarea', { value: formData.feedbackQ5, onChange: (ev) => handleFormChange('feedbackQ5', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ6), e('textarea', { value: formData.feedbackQ6, onChange: (ev) => handleFormChange('feedbackQ6', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ7),
                    e('div', { className: 'flex items-center gap-4' },
                      e('input', { type: 'range', min: 1, max: 5, value: formData.feedbackQ7 || 3, onChange: (ev) => handleFormChange('feedbackQ7', parseInt(ev.target.value)), className: 'flex-1 accent-[#6EBD84]' }),
                      e('span', { className: 'text-lg font-bold text-slate-700 w-8 text-center' }, formData.feedbackQ7 || 3)
                    )
                  ),
                  // NEU: Feedback an die F√ºhrungskraft (freies Textfeld)
                  e('div', { className: 'mt-4 pt-4 border-t border-slate-200' },
                    e('label', { className: 'block text-sm font-bold mb-1 text-slate-700 flex items-center gap-2' }, 
                      e(MessageCircle, { size: 16, className: 'text-blue-500' }),
                      lang === 'de' ? 'Feedback an meine F√ºhrungskraft' : lang === 'it' ? 'Feedback al mio responsabile' : 'Feedback to My Manager'
                    ),
                    e('p', { className: 'text-xs text-slate-500 mb-2' },
                      lang === 'de' ? 'Was l√§uft gut in der Zusammenarbeit? Was k√∂nnte verbessert werden?' 
                      : lang === 'it' ? 'Cosa funziona bene nella collaborazione? Cosa potrebbe essere migliorato?' 
                      : 'What is working well? What could be improved?'
                    ),
                    e('textarea', { 
                      value: formData.feedbackManager || '', 
                      onChange: (ev) => handleFormChange('feedbackManager', ev.target.value), 
                      className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', 
                      rows: 3,
                      placeholder: lang === 'de' ? 'Konstruktives Feedback zur Zusammenarbeit...' 
                                  : lang === 'it' ? 'Feedback costruttivo sulla collaborazione...' 
                                  : 'Constructive feedback on collaboration...'
                    })
                  )
                )
              )
            );
          };

          const renderGuestWelcome = () => {
            if (!guestEmployee) return null;
            
            // Wenn Formular erfolgreich abgeschlossen wurde: Erfolgsseite anzeigen
            if (guestFormSubmitted) {
              return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4' },
                React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-lg w-full text-center' },
                  // Erfolgs-Icon
                  React.createElement('div', { className: 'w-24 h-24 rounded-full bg-[#E8F5ED] flex items-center justify-center mx-auto mb-6' },
                    React.createElement(CheckCircle2, { size: 48, className: 'text-[#6EBD84]' })
                  ),
                  
                  // Erfolgs-Titel
                  React.createElement('h2', { className: 'text-3xl font-bold text-slate-800 mb-3' },
                    lang === 'de' ? 'Vielen Dank!' : lang === 'it' ? 'Grazie!' : 'Thank you!'
                  ),
                  
                  // Erfolgs-Text
                  React.createElement('p', { className: 'text-lg text-slate-600 mb-6' },
                    lang === 'de' 
                      ? 'Ihre Selbstreflexion wurde erfolgreich an Ihre F√ºhrungskraft √ºbermittelt.'
                      : lang === 'it'
                      ? 'La tua autovalutazione √® stata inviata con successo al tuo responsabile.'
                      : 'Your self-reflection has been successfully submitted to your manager.'
                  ),
                  
                  // Info-Box
                  React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 text-left' },
                    React.createElement('div', { className: 'flex items-start gap-3' },
                      React.createElement(Info, { size: 20, className: 'text-blue-600 flex-shrink-0 mt-0.5' }),
                      React.createElement('div', { className: 'text-sm text-blue-800' },
                        React.createElement('p', { className: 'font-medium mb-1' },
                          lang === 'de' ? 'N√§chste Schritte:' : lang === 'it' ? 'Prossimi passi:' : 'Next steps:'
                        ),
                        React.createElement('p', null,
                          lang === 'de' 
                            ? 'Ihre F√ºhrungskraft wird Ihre Eingaben als Grundlage f√ºr das Jahresgespr√§ch verwenden. Sie werden zur Terminvereinbarung kontaktiert.'
                            : lang === 'it'
                            ? 'Il tuo responsabile utilizzer√† le tue risposte come base per il colloquio annuale. Sarai contattato/a per fissare un appuntamento.'
                            : 'Your manager will use your input as a basis for the annual review. You will be contacted to schedule a meeting.'
                        )
                      )
                    )
                  ),
                  
                  // Schlie√üen-Button
                  React.createElement('p', { className: 'text-sm text-slate-400' },
                    lang === 'de' 
                      ? 'Sie k√∂nnen dieses Fenster jetzt schlie√üen.'
                      : lang === 'it'
                      ? 'Puoi chiudere questa finestra.'
                      : 'You can close this window now.'
                  )
                )
              );
            }
            
            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4' },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-2xl w-full' },
                // Header mit Logo
                React.createElement('div', { className: 'text-center mb-8' },
                  React.createElement('h1', { className: 'text-2xl font-bold tracking-tight', style: { color: '#243186' } }, 'nƒ±ederwƒ±eser'),
                  React.createElement('p', { className: 'text-xs uppercase tracking-widest', style: { color: '#6EBD84' } }, 'Performance Manager')
                ),
                
                // Willkommens-Icon
                React.createElement('div', { className: 'w-24 h-24 rounded-full bg-[#E8F5ED] flex items-center justify-center mx-auto mb-6' },
                  React.createElement(Users, { size: 48, className: 'text-[#6EBD84]' })
                ),
                
                // Begr√º√üung
                React.createElement('div', { className: 'text-center mb-8' },
                  React.createElement('h2', { className: 'text-3xl font-bold text-slate-800 mb-3' },
                    lang === 'de' ? 'Willkommen, ' : 'Benvenuto/a, ',
                    guestEmployee.name, '!'
                  ),
                  
                  // Position Badge
                  React.createElement('div', { className: 'inline-flex items-center gap-2 bg-slate-100 px-4 py-2 rounded-full text-sm text-slate-600' },
                    React.createElement(Briefcase, { size: 16 }),
                    guestEmployee.position,
                    guestEmployee.department && React.createElement('span', { className: 'text-slate-400' }, ' ‚Ä¢ ', guestEmployee.department)
                  )
                ),
                
                // Haupttext mit Zeitangabe
                React.createElement('div', { className: 'bg-slate-50 rounded-xl p-6 mb-6 text-center' },
                  React.createElement('div', { className: 'flex items-center justify-center gap-2 text-slate-500 mb-3' },
                    React.createElement(Clock, { size: 20 }),
                    React.createElement('span', { className: 'font-medium' }, 
                      lang === 'de' ? 'ca. 15-20 Minuten' : 'ca. 15-20 minuti'
                    )
                  ),
                  React.createElement('p', { className: 'text-slate-700 text-lg' },
                    lang === 'de'
                      ? 'Bitte nehmen Sie sich Zeit f√ºr Ihre Selbstreflexion zur Vorbereitung auf das Jahresgespr√§ch mit Ihrer F√ºhrungskraft.'
                      : 'Per favore, prenditi del tempo per la tua autovalutazione in preparazione al colloquio annuale con il tuo responsabile.'
                  )
                ),
                
                // Info-Box: Was erwartet Sie?
                React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-5 mb-6' },
                  React.createElement('h4', { className: 'font-semibold text-blue-900 mb-3 flex items-center gap-2' },
                    React.createElement(Info, { size: 20 }),
                    lang === 'de' ? 'Was erwartet Sie?' : 'Cosa ti aspetta?'
                  ),
                  React.createElement('div', { className: 'grid md:grid-cols-2 gap-3' },
                    // Punkt 1
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '1')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Selbsteinsch√§tzung Ihrer 5 Kernkompetenzen' : 'Autovalutazione delle tue 5 competenze chiave'
                      )
                    ),
                    // Punkt 2
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '2')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Reflexion zu St√§rken & Entwicklungsfeldern' : 'Riflessione su punti di forza e aree di sviluppo'
                      )
                    ),
                    // Punkt 3
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '3')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Ihre W√ºnsche f√ºr das kommende Jahr' : 'I tuoi desideri per l\'anno prossimo'
                      )
                    ),
                    // Punkt 4
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '4')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Feedback zur Zusammenarbeit' : 'Feedback sulla collaborazione'
                      )
                    )
                  )
                ),
                
                // Sprachauswahl
                React.createElement('div', { className: 'flex justify-center gap-2 mb-6' },
                  React.createElement('button', {
                    onClick: () => setLang('de'),
                    className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${lang === 'de' ? 'bg-[#243186] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`
                  }, 'üá©üá™ DE'),
                  React.createElement('button', {
                    onClick: () => setLang('it'),
                    className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${lang === 'it' ? 'bg-[#243186] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`
                  }, 'üáÆüáπ IT'),
                  React.createElement('button', {
                    onClick: () => setLang('en'),
                    className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${lang === 'en' ? 'bg-[#243186] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`
                  }, 'üá¨üáß EN')
                ),
                
                // Start Button ‚Üí navigiert zu guestForm
                React.createElement('button', {
                  onClick: () => setActiveView('guestForm'),
                  className: 'w-full bg-[#6EBD84] text-white py-4 rounded-xl font-semibold text-lg hover:bg-[#5da872] transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-3'
                },
                  React.createElement(Play, { size: 24 }),
                  lang === 'de' ? 'Selbstreflexion starten' : lang === 'it' ? 'Inizia autovalutazione' : 'Start Self-Reflection'
                ),
                
                // "Zur√ºck zur App" Button - NUR f√ºr eingeloggte User (nicht anonym)
                user && !user.isAnonymous && React.createElement('button', {
                  onClick: () => {
                    // Gast-Modus beenden und zur normalen App zur√ºckkehren
                    setGuestMode(false);
                    setGuestEmployee(null);
                    setGuestManagerId(null);
                    setActiveView('dashboard');
                    // URL bereinigen
                    window.history.replaceState({}, document.title, window.location.pathname);
                  },
                  className: 'w-full mt-3 bg-slate-100 text-slate-700 py-3 rounded-xl font-medium hover:bg-slate-200 transition-all flex items-center justify-center gap-2'
                },
                  React.createElement(ArrowLeft, { size: 18 }),
                  lang === 'de' ? 'Zur√ºck zur App' : lang === 'it' ? 'Torna all\'app' : 'Back to App'
                ),
                
                // Footer Hinweis
                React.createElement('p', { className: 'text-xs text-slate-400 mt-6 text-center' },
                  lang === 'de'
                    ? 'üîí Ihre Eingaben werden vertraulich behandelt und dienen der Vorbereitung auf das Gespr√§ch mit Ihrer F√ºhrungskraft.'
                    : 'üîí I tuoi dati saranno trattati in modo confidenziale e serviranno a preparare il colloquio con il tuo responsabile.'
                )
              )
            );
          };
          
          // === GUEST FORM RENDER FUNCTION (Vollst√§ndiges Selbstreflexions-Formular) ===
          const renderGuestForm = () => {
            if (!guestEmployee) return null;
            
            // States kommen jetzt von der Komponenten-Ebene (oben definiert):
            // guestFormData, setGuestFormData
            // guestCoreScores, setGuestCoreScores  
            // guestCoreComments, setGuestCoreComments
            // guestFormStep, setGuestFormStep
            // guestFormSaving, setGuestFormSaving
            // guestFormSubmitted, setGuestFormSubmitted
            // guestLastAutoSave, setGuestLastAutoSave
            // guestShowDraftRecovery, setGuestShowDraftRecovery
            // guestExistingAssessment, setGuestExistingAssessment
            // guestShowDuplicateWarning, setGuestShowDuplicateWarning
            
            // Aliase f√ºr Kompatibilit√§t mit bestehendem Code
            const selfCoreScores = guestCoreScores;
            const setSelfCoreScores = setGuestCoreScores;
            const selfCoreComments = guestCoreComments;
            const setSelfCoreComments = setGuestCoreComments;
            const currentStep = guestFormStep;
            const setCurrentStep = setGuestFormStep;
            const isSaving = guestFormSaving;
            const setIsSaving = setGuestFormSaving;
            const isSubmitted = guestFormSubmitted;
            const setIsSubmitted = setGuestFormSubmitted;
            const lastAutoSave = guestLastAutoSave;
            const setLastAutoSave = setGuestLastAutoSave;
            const showDraftRecovery = guestShowDraftRecovery;
            const setShowDraftRecovery = setGuestShowDraftRecovery;
            const existingAssessment = guestExistingAssessment;
            const setExistingAssessment = setGuestExistingAssessment;
            const showDuplicateWarning = guestShowDuplicateWarning;
            const setShowDuplicateWarning = setGuestShowDuplicateWarning;
            
            // Draft-ID f√ºr diesen Mitarbeiter
            const draftId = `guest_${guestEmployee.id}_${new Date().getFullYear()}`;
            
            // === Draft Recovery und Auto-Save wurden auf Komponenten-Ebene verschoben ===
            // Die useEffects sind jetzt au√üerhalb von renderGuestForm definiert
            
            // === Draft wiederherstellen Handler ===
            const handleRecoverDraft = () => {
              const draft = window._tempDraft;
              if (draft) {
                if (draft.guestFormData) setGuestFormData(draft.guestFormData);
                if (draft.selfCoreScores) setGuestCoreScores(draft.selfCoreScores);
                if (draft.selfCoreComments) setGuestCoreComments(draft.selfCoreComments);
                if (draft.currentStep) setGuestFormStep(draft.currentStep);
                devLog('‚úì Entwurf wiederhergestellt');
              }
              setShowDraftRecovery(false);
              delete window._tempDraft;
            };
            
            // === Draft verwerfen Handler ===
            const handleDiscardDraft = () => {
              DraftManager.deleteDraft(draftId);
              setShowDraftRecovery(false);
              delete window._tempDraft;
            };
            
            // Kompetenz-Daten aus APP_DATA
            const competencyData = APP_DATA[lang]?.competencies?.filter(c => c.category === 'core') || [];
            
            // BARS Labels
            const barsLabels = {
              de: {
                1: 'Erf√ºllt nicht',
                2: 'Verbesserungsbedarf', 
                3: 'Baseline',
                4: '√úbertrifft',
                5: 'Herausragend'
              },
              it: {
                1: 'Non soddisfa',
                2: 'Da migliorare',
                3: 'Baseline',
                4: 'Supera',
                5: 'Eccellente'
              },
              en: {
                1: 'Does Not Meet',
                2: 'Needs Improvement',
                3: 'Baseline',
                4: 'Exceeds',
                5: 'Outstanding'
              }
            };
            
            // Speichern-Handler MIT Duplikations-Pr√ºfung
            const handleGuestSave = async () => {
              if (!db || !guestEmployee) {
                showToast(lang === 'de' ? 'Keine Verbindung zur Datenbank' : 'Nessuna connessione al database', 'error');
                return;
              }
              
              setIsSaving(true);
              
              try {
                // === NEU: Duplikations-Pr√ºfung ===
                const currentPeriod = new Date().getFullYear().toString();
                const existingCheck = await checkExistingSelfAssessment(db, guestEmployee.id, currentPeriod);
                
                if (existingCheck.exists) {
                  const confirmOverwrite = confirm(
                    lang === 'de' 
                      ? `‚ö†Ô∏è Es existiert bereits eine Selbstreflexion f√ºr ${currentPeriod}.\n\nEingereicht am: ${new Date(existingCheck.data.submittedAt || existingCheck.data.createdAt).toLocaleDateString('de-DE')}\n\nM√∂chten Sie diese √ºberschreiben?`
                      : lang === 'it'
                      ? `‚ö†Ô∏è Esiste gi√† un'autovalutazione per ${currentPeriod}.\n\nInviata il: ${new Date(existingCheck.data.submittedAt || existingCheck.data.createdAt).toLocaleDateString('it-IT')}\n\nVuoi sovrascriverla?`
                      : `‚ö†Ô∏è A self-reflection already exists for ${currentPeriod}.\n\nSubmitted on: ${new Date(existingCheck.data.submittedAt || existingCheck.data.createdAt).toLocaleDateString('en-GB')}\n\nDo you want to overwrite it?`
                  );
                  
                  if (!confirmOverwrite) {
                    setIsSaving(false);
                    return;
                  }
                  
                  // L√∂sche alte Selbstreflexion
                  await db.collection('teamAppraisals').doc(existingCheck.docId).delete();
                  devLog('üóëÔ∏è Alte Selbstreflexion gel√∂scht:', existingCheck.docId);
                }
                
                const selfAssessmentId = 'self_' + guestEmployee.id + '_' + Date.now();
                
                const selfAssessmentData = {
                  id: selfAssessmentId,
                  type: 'self_assessment',
                  employeeId: guestEmployee.id,
                  employeeName: guestEmployee.name,
                  position: guestEmployee.position,
                  department: guestEmployee.department || '',
                  userId: guestEmployee.userId, // Manager's userId f√ºr Zugriff
                  period: new Date().getFullYear().toString(),
                  status: 'submitted_self',
                  isSelfAssessment: true,
                  
                  // Kompetenz-Selbsteinsch√§tzungen
                  selfCoreScores: selfCoreScores,
                  selfCoreComments: selfCoreComments,
                  
                  // Freitext-Felder
                  formData: {
                    strengths1: guestFormData.strengths1,
                    strengths2: guestFormData.strengths2,
                    wishesNextYear: guestFormData.wishesNextYear,
                    feedbackManager: guestFormData.feedbackManager,
                    additionalComments: guestFormData.additionalComments
                  },
                  
                  // Timestamps
                  createdAt: new Date().toISOString(),
                  submittedAt: new Date().toISOString()
                };
                
                // In Firestore speichern
                await db.collection('teamAppraisals').doc(selfAssessmentId).set(selfAssessmentData);
                
                devLog('‚úì Selbstreflexion gespeichert:', selfAssessmentId);
                
                // === NEU: Draft l√∂schen nach erfolgreichem Speichern ===
                DraftManager.deleteDraft(draftId);
                
                setIsSubmitted(true);
                
              } catch (error) {
                console.error('‚ùå Fehler beim Speichern:', error);
                showToast(lang === 'de' 
                  ? 'Fehler beim Speichern' 
                  : 'Errore durante il salvataggio', 'error');
              } finally {
                setIsSaving(false);
              }
            };
            
            // Success Screen nach dem Absenden
            if (isSubmitted) {
              return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4' },
                React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-lg w-full text-center' },
                  // Success Icon
                  React.createElement('div', { className: 'w-24 h-24 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-6' },
                    React.createElement(CheckCircle2, { size: 48, className: 'text-green-600' })
                  ),
                  
                  React.createElement('h2', { className: 'text-3xl font-bold text-slate-800 mb-4' },
                    lang === 'de' ? 'Vielen Dank!' : lang === 'it' ? 'Grazie mille!' : 'Thank you!'
                  ),
                  
                  React.createElement('p', { className: 'text-slate-600 text-lg mb-6' },
                    lang === 'de'
                      ? 'Ihre Selbstreflexion wurde erfolgreich √ºbermittelt.'
                      : lang === 'it'
                      ? 'La tua autovalutazione √® stata inviata con successo.'
                      : 'Your self-reflection has been submitted successfully.'
                  ),
                  
                  React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 text-left' },
                    React.createElement('h4', { className: 'font-semibold text-blue-900 mb-2 flex items-center gap-2' },
                      React.createElement(Info, { size: 18 }),
                      lang === 'de' ? 'N√§chste Schritte' : lang === 'it' ? 'Prossimi passi' : 'Next Steps'
                    ),
                    React.createElement('p', { className: 'text-sm text-blue-800' },
                      lang === 'de'
                        ? 'Ihre F√ºhrungskraft wird Ihre Eingaben sehen und diese als Grundlage f√ºr das gemeinsame Jahresgespr√§ch nutzen. Sie werden zeitnah kontaktiert, um einen Termin zu vereinbaren.'
                        : lang === 'it'
                        ? 'Il tuo responsabile vedr√† le tue risposte e le utilizzer√† come base per il colloquio annuale. Sarai contattato a breve per fissare un appuntamento.'
                        : 'Your manager will see your responses and use them as a basis for the annual review. You will be contacted shortly to schedule a meeting.'
                    )
                  ),
                  
                  // "Zur√ºck zur App" Button - NUR f√ºr eingeloggte User (nicht anonym)
                  user && !user.isAnonymous 
                    ? React.createElement('button', {
                        onClick: () => {
                          // Gast-Modus beenden und zur normalen App zur√ºckkehren
                          setGuestMode(false);
                          setGuestEmployee(null);
                          setGuestManagerId(null);
                          setActiveView('dashboard');
                          // URL bereinigen
                          window.history.replaceState({}, document.title, window.location.pathname);
                        },
                        className: 'w-full bg-[#6EBD84] text-white py-3 rounded-xl font-semibold hover:bg-[#5da872] transition-all flex items-center justify-center gap-2'
                      },
                        React.createElement(ArrowLeft, { size: 18 }),
                        lang === 'de' ? 'Zur√ºck zur App' : lang === 'it' ? 'Torna all\'app' : 'Back to App'
                      )
                    : React.createElement('p', { className: 'text-sm text-slate-500' },
                        lang === 'de'
                          ? 'Sie k√∂nnen dieses Fenster jetzt schlie√üen.'
                          : lang === 'it'
                          ? 'Puoi chiudere questa finestra.'
                          : 'You can close this window now.'
                      )
                )
              );
            }
            
            // Wizard Navigation
            const totalSteps = 4;
            const stepTitles = {
              de: ['Kompetenzen', 'St√§rken & Entwicklung', 'W√ºnsche & Feedback', 'Zusammenfassung'],
              it: ['Competenze', 'Punti di forza', 'Desideri & Feedback', 'Riepilogo'],
              en: ['Competencies', 'Strengths & Development', 'Wishes & Feedback', 'Summary']
            };
            
            // Kompetenz-Bewertungs-Komponente
            const renderCompetencyCard = (comp, index) => {
              const compId = `c${index + 1}`;
              const currentScore = selfCoreScores[compId] || 3;
              const currentComment = selfCoreComments[compId] || '';
              
              return React.createElement('div', { 
                key: compId,
                className: 'bg-white rounded-xl border border-slate-200 p-5 mb-4'
              },
                // Header
                React.createElement('div', { className: 'flex items-start gap-3 mb-4' },
                  React.createElement('div', { className: 'w-10 h-10 rounded-lg bg-[#E8F5ED] flex items-center justify-center flex-shrink-0' },
                    React.createElement(comp.icon || Briefcase, { size: 20, className: 'text-[#6EBD84]' })
                  ),
                  React.createElement('div', null,
                    React.createElement('h4', { className: 'font-bold text-slate-800' }, comp.title),
                    React.createElement('p', { 
                      className: 'text-sm text-slate-500 mt-1',
                      style: { maxHeight: '60px', overflowY: 'auto' }
                    }, comp.definition || '')
                  )
                ),
                
                // BARS Score Auswahl
                React.createElement('div', { className: 'mb-4' },
                  React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-2' },
                    lang === 'de' ? 'Ihre Selbsteinsch√§tzung:' : lang === 'it' ? 'La tua autovalutazione:' : 'Your Self-Assessment:'
                  ),
                  React.createElement('div', { className: 'flex gap-2' },
                    [1, 2, 3, 4, 5].map(score => 
                      React.createElement('button', {
                        key: score,
                        onClick: () => setSelfCoreScores(prev => ({...prev, [compId]: score})),
                        className: `flex-1 py-3 px-2 rounded-lg border-2 transition-all text-center ${
                          currentScore === score 
                            ? score <= 2 ? 'border-red-500 bg-red-50 text-red-700' :
                              score === 3 ? 'border-green-500 bg-green-50 text-green-700' :
                              'border-blue-500 bg-blue-50 text-blue-700'
                            : 'border-slate-200 hover:border-slate-300 text-slate-600'
                        }`
                      },
                        React.createElement('div', { className: 'text-xl font-bold' }, score),
                        React.createElement('div', { className: 'text-xs mt-1 hidden sm:block' }, barsLabels[lang][score])
                      )
                    )
                  )
                ),
                
                // Kommentar-Feld
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-2' },
                    lang === 'de' ? 'Begr√ºndung / Beispiele (optional):' : lang === 'it' ? 'Motivazione / Esempi (opzionale):' : 'Reasoning / Examples (optional):'
                  ),
                  React.createElement('textarea', {
                    value: currentComment,
                    onChange: (e) => setSelfCoreComments(prev => ({...prev, [compId]: e.target.value})),
                    placeholder: lang === 'de' 
                      ? 'Beschreiben Sie konkrete Situationen, die Ihre Einsch√§tzung belegen...'
                      : 'Descrivi situazioni concrete che supportano la tua valutazione...',
                    className: 'w-full border border-slate-300 rounded-lg px-4 py-3 text-sm resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                    rows: 3
                  })
                )
              );
            };
            
            // Step 1: Kompetenzen
            const renderStep1 = () => React.createElement('div', { className: 'space-y-4' },
              React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6' },
                React.createElement('p', { className: 'text-sm text-blue-800' },
                  lang === 'de'
                    ? 'Bitte sch√§tzen Sie sich selbst in den folgenden 5 Kernkompetenzen ein. Nutzen Sie die Skala von 1 (Erf√ºllt nicht) bis 5 (Herausragend). Level 3 entspricht der erwarteten Baseline.'
                    : 'Per favore, valuta te stesso nelle seguenti 5 competenze chiave. Usa la scala da 1 (Non soddisfa) a 5 (Eccellente). Il livello 3 corrisponde alla baseline attesa.'
                )
              ),
              competencyData.map((comp, idx) => renderCompetencyCard(comp, idx))
            );
            
            // Step 2: St√§rken & Entwicklung
            const renderStep2 = () => React.createElement('div', { className: 'space-y-6' },
              // St√§rken
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(Award, { size: 20, className: 'text-[#6EBD84]' }),
                  lang === 'de' ? 'Meine gr√∂√üten St√§rken' : lang === 'it' ? 'I miei punti di forza' : 'My Greatest Strengths'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Was k√∂nnen Sie besonders gut? Worauf sind Sie stolz?'
                    : 'In cosa sei particolarmente bravo? Di cosa sei orgoglioso?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.strengths1,
                  onChange: (e) => setGuestFormData(prev => ({...prev, strengths1: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Beschreiben Sie 2-3 St√§rken mit konkreten Beispielen...'
                    : 'Descrivi 2-3 punti di forza con esempi concreti...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 5
                })
              ),
              
              // Entwicklungsfelder
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(TrendingUp, { size: 20, className: 'text-amber-500' }),
                  lang === 'de' ? 'Meine Entwicklungsfelder' : lang === 'it' ? 'Le mie aree di sviluppo' : 'My Development Areas'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Wo sehen Sie Verbesserungspotenzial? Was m√∂chten Sie lernen?'
                    : 'Dove vedi potenziale di miglioramento? Cosa vorresti imparare?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.strengths2,
                  onChange: (e) => setGuestFormData(prev => ({...prev, strengths2: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Beschreiben Sie 1-2 Bereiche, in denen Sie sich entwickeln m√∂chten...'
                    : 'Descrivi 1-2 aree in cui vorresti svilupparti...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 5
                })
              )
            );
            
            // Step 3: W√ºnsche & Feedback
            const renderStep3 = () => React.createElement('div', { className: 'space-y-6' },
              // W√ºnsche f√ºr das kommende Jahr
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(Target, { size: 20, className: 'text-purple-500' }),
                  lang === 'de' ? 'Meine W√ºnsche f√ºr das kommende Jahr' : lang === 'it' ? 'I miei desideri per l\'anno prossimo' : 'My wishes for the coming year'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Welche Projekte, Aufgaben oder Entwicklungsm√∂glichkeiten w√ºnschen Sie sich?'
                    : 'Quali progetti, compiti o opportunit√† di sviluppo desideri?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.wishesNextYear,
                  onChange: (e) => setGuestFormData(prev => ({...prev, wishesNextYear: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'z.B. neue Verantwortungsbereiche, Weiterbildungen, Projektteilnahme...'
                    : 'es. nuove responsabilit√†, formazione, partecipazione a progetti...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 4
                })
              ),
              
              // Feedback an die FK
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(MessageCircle, { size: 20, className: 'text-blue-500' }),
                  lang === 'de' ? 'Feedback an meine F√ºhrungskraft' : lang === 'it' ? 'Feedback al mio responsabile' : 'Feedback to My Manager'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Was l√§uft gut in der Zusammenarbeit? Was k√∂nnte verbessert werden?'
                    : 'Cosa funziona bene nella collaborazione? Cosa potrebbe essere migliorato?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.feedbackManager,
                  onChange: (e) => setGuestFormData(prev => ({...prev, feedbackManager: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Konstruktives Feedback zur Zusammenarbeit...'
                    : 'Feedback costruttivo sulla collaborazione...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 4
                })
              ),
              
              // Sonstige Anmerkungen
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(FileText, { size: 20, className: 'text-slate-500' }),
                  lang === 'de' ? 'Sonstige Anmerkungen (optional)' : lang === 'it' ? 'Altre osservazioni (opzionale)' : 'Additional Comments (optional)'
                ),
                React.createElement('textarea', {
                  value: guestFormData.additionalComments,
                  onChange: (e) => setGuestFormData(prev => ({...prev, additionalComments: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Weitere Themen, die Sie besprechen m√∂chten...'
                    : 'Altri argomenti che vorresti discutere...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 3
                })
              )
            );
            
            // Step 4: Zusammenfassung
            const renderStep4 = () => {
              // Durchschnittliche Selbsteinsch√§tzung berechnen
              const avgScore = Object.values(selfCoreScores).reduce((a, b) => a + b, 0) / 5;
              
              return React.createElement('div', { className: 'space-y-6' },
                // Info-Box
                React.createElement('div', { className: 'bg-amber-50 border border-amber-200 rounded-xl p-4' },
                  React.createElement('p', { className: 'text-sm text-amber-800 flex items-start gap-2' },
                    React.createElement(AlertCircle, { size: 18, className: 'flex-shrink-0 mt-0.5' }),
                    lang === 'de'
                      ? 'Bitte pr√ºfen Sie Ihre Angaben. Nach dem Absenden k√∂nnen Sie diese nicht mehr √§ndern.'
                      : 'Per favore, controlla i tuoi dati. Dopo l\'invio non potrai pi√π modificarli.'
                  )
                ),
                
                // Kompetenz-Zusammenfassung
                React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                  React.createElement('h4', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                    React.createElement(Award, { size: 20, className: 'text-[#6EBD84]' }),
                    lang === 'de' ? 'Kompetenz-Selbsteinsch√§tzung' : lang === 'it' ? 'Autovalutazione competenze' : 'Competency Self-Assessment'
                  ),
                  React.createElement('div', { className: 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 mb-4' },
                    competencyData.map((comp, idx) => {
                      const compId = `c${idx + 1}`;
                      const score = selfCoreScores[compId];
                      return React.createElement('div', { 
                        key: compId,
                        className: 'text-center p-3 bg-slate-50 rounded-lg'
                      },
                        React.createElement('div', { 
                          className: `text-2xl font-bold ${
                            score <= 2 ? 'text-red-600' : score === 3 ? 'text-green-600' : 'text-blue-600'
                          }`
                        }, score),
                        React.createElement('div', { className: 'text-xs text-slate-500 mt-1 truncate' }, comp.title?.split(' ')[0])
                      );
                    })
                  ),
                  React.createElement('div', { className: 'flex items-center justify-between bg-slate-100 rounded-lg p-3' },
                    React.createElement('span', { className: 'text-sm text-slate-600' },
                      lang === 'de' ? 'Durchschnitt:' : lang === 'it' ? 'Media:' : 'Average:'
                    ),
                    React.createElement('span', { className: 'text-xl font-bold text-[#243186]' }, avgScore.toFixed(2))
                  )
                ),
                
                // Freitext-Zusammenfassung
                React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                  React.createElement('h4', { className: 'font-semibold text-slate-800 mb-4' },
                    lang === 'de' ? 'Ihre Eingaben' : lang === 'it' ? 'Le tue risposte' : 'Your Responses'
                  ),
                  React.createElement('div', { className: 'space-y-4 text-sm' },
                    guestFormData.strengths1 && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'St√§rken:' : lang === 'it' ? 'Punti di forza:' : 'Strengths:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.strengths1)
                    ),
                    guestFormData.strengths2 && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'Entwicklungsfelder:' : lang === 'it' ? 'Aree di sviluppo:' : 'Development Areas:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.strengths2)
                    ),
                    guestFormData.wishesNextYear && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'W√ºnsche:' : lang === 'it' ? 'Desideri:' : 'Wishes:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.wishesNextYear)
                    ),
                    guestFormData.feedbackManager && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'Feedback an FK:' : lang === 'it' ? 'Feedback al responsabile:' : 'Feedback to Manager:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.feedbackManager)
                    )
                  )
                )
              );
            };
            
            // Haupt-Render
            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4 pb-24' },
              React.createElement('div', { className: 'max-w-2xl mx-auto' },
              
                // === NEU: Draft Recovery Banner ===
                showDraftRecovery && React.createElement('div', { 
                  className: 'bg-blue-50 border-2 border-blue-300 rounded-xl p-4 mb-4 animate-in'
                },
                  React.createElement('div', { className: 'flex items-start justify-between' },
                    React.createElement('div', { className: 'flex items-center gap-3' },
                      React.createElement('div', { className: 'text-2xl' }, 'üíæ'),
                      React.createElement('div', null,
                        React.createElement('p', { className: 'font-bold text-blue-800' },
                          lang === 'de' ? 'Ungespeicherter Entwurf gefunden!' : lang === 'it' ? 'Bozza non salvata trovata!' : 'Unsaved draft found!'
                        ),
                        React.createElement('p', { className: 'text-sm text-blue-600' },
                          lang === 'de' 
                            ? 'Sie haben einen nicht abgeschlossenen Entwurf. M√∂chten Sie fortfahren?' 
                            : lang === 'it'
                            ? 'Hai una bozza non completata. Vuoi continuare?'
                            : 'You have an incomplete draft. Do you want to continue?'
                        )
                      )
                    ),
                    React.createElement('button', {
                      onClick: handleDiscardDraft,
                      className: 'text-blue-400 hover:text-blue-600'
                    }, React.createElement(X, { size: 18 }))
                  ),
                  React.createElement('div', { className: 'flex gap-2 mt-3' },
                    React.createElement('button', {
                      onClick: handleRecoverDraft,
                      className: 'flex-1 bg-blue-600 text-white py-2 rounded-2xl font-semibold hover:bg-blue-700 transition-colors'
                    }, lang === 'de' ? '‚úì Wiederherstellen' : lang === 'it' ? '‚úì Ripristina' : '‚úì Recover'),
                    React.createElement('button', {
                      onClick: handleDiscardDraft,
                      className: 'flex-1 bg-slate-200 text-slate-700 py-2 rounded-2xl font-semibold hover:bg-slate-300 transition-colors'
                    }, lang === 'de' ? 'Neu starten' : lang === 'it' ? 'Ricomincia' : 'Start fresh')
                  )
                ),
                
                // === NEU: Duplicate Warning Banner ===
                showDuplicateWarning && existingAssessment && React.createElement('div', { 
                  className: 'bg-amber-50 border-2 border-amber-300 rounded-xl p-4 mb-4'
                },
                  React.createElement('div', { className: 'flex items-start gap-3' },
                    React.createElement('div', { className: 'text-2xl' }, '‚ö†Ô∏è'),
                    React.createElement('div', { className: 'flex-1' },
                      React.createElement('p', { className: 'font-bold text-amber-800' },
                        lang === 'de' ? 'Bereits eingereicht!' : lang === 'it' ? 'Gi√† inviata!' : 'Already submitted!'
                      ),
                      React.createElement('p', { className: 'text-sm text-amber-700' },
                        lang === 'de' 
                          ? `Sie haben bereits am ${new Date(existingAssessment.data?.submittedAt || existingAssessment.data?.createdAt).toLocaleDateString('de-DE')} eine Selbstreflexion eingereicht.` 
                          : lang === 'it'
                          ? `Hai gi√† inviato un'autovalutazione il ${new Date(existingAssessment.data?.submittedAt || existingAssessment.data?.createdAt).toLocaleDateString('it-IT')}.`
                          : `You already submitted a self-reflection on ${new Date(existingAssessment.data?.submittedAt || existingAssessment.data?.createdAt).toLocaleDateString('en-GB')}.`
                      ),
                      React.createElement('p', { className: 'text-xs text-amber-600 mt-1' },
                        lang === 'de' 
                          ? 'Eine neue Eingabe wird die vorherige √ºberschreiben.' 
                          : lang === 'it'
                          ? 'Un nuovo invio sovrascriver√† il precedente.'
                          : 'A new submission will overwrite the previous one.'
                      )
                    ),
                    React.createElement('button', {
                      onClick: () => setShowDuplicateWarning(false),
                      className: 'text-amber-400 hover:text-amber-600'
                    }, React.createElement(X, { size: 18 }))
                  )
                ),
              
                // Header (sticky)
                React.createElement('div', { className: 'bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 p-4 mb-6 sticky top-4 z-10' },
                  // Obere Zeile: Logo, Skip-Button, User-Info
                  React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                    // Links: Logo
                    React.createElement('div', null,
                      React.createElement('h1', { className: 'text-xl font-bold', style: { color: '#243186' } }, 'nƒ±ederwƒ±eser'),
                      React.createElement('p', { className: 'text-xs uppercase tracking-widest', style: { color: '#6EBD84' } }, 
                        lang === 'de' ? 'Selbstreflexion' : lang === 'it' ? 'Autovalutazione' : 'Self-Reflection'
                      ),
                      // === NEU: Auto-Save Indikator ===
                      lastAutoSave && React.createElement('p', { className: 'text-xs text-slate-400 mt-1' },
                        'üíæ ', DraftManager.formatSavedTime(lastAutoSave, lang)
                      )
                    ),
                    
                    // Mitte: Skip-Button MIT VALIDIERUNG (nur wenn nicht auf Schritt 4)
                    currentStep < 4 && React.createElement('button', {
                      onClick: () => {
                        // === NEU: Validierungs-Warnung beim Skip ===
                        const hasContent = Object.values(selfCoreScores).some(v => v !== 3) || 
                                          guestFormData.strengths1 || guestFormData.strengths2;
                        if (!hasContent) {
                          const proceed = confirm(
                            lang === 'de' 
                              ? 'Sie haben noch keine Kompetenzen bewertet oder St√§rken/Entwicklungsfelder eingetragen. Trotzdem zum Absenden springen?'
                              : lang === 'it'
                              ? 'Non hai ancora valutato le competenze o inserito punti di forza/aree di sviluppo. Procedere comunque all\'invio?'
                              : 'You have not yet rated competencies or entered strengths/development areas. Skip to submit anyway?'
                          );
                          if (!proceed) return;
                        }
                        setCurrentStep(4);
                      },
                      className: 'hidden sm:flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors'
                    },
                      React.createElement(ChevronRight, { size: 16 }),
                      lang === 'de' ? 'Zum Absenden' : lang === 'it' ? 'Vai all\'invio' : 'Skip to Submit'
                    ),
                    
                    // Rechts: User-Info
                    React.createElement('div', { className: 'text-right' },
                      React.createElement('p', { className: 'font-medium text-slate-800' }, guestEmployee.name),
                      React.createElement('p', { className: 'text-sm text-slate-500' }, guestEmployee.position)
                    )
                  ),
                  
                  // Mobile: Skip-Button unter der Kopfzeile (nur wenn nicht auf Schritt 4)
                  currentStep < 4 && React.createElement('div', { className: 'sm:hidden mb-4' },
                    React.createElement('button', {
                      onClick: () => setCurrentStep(4),
                      className: 'w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors'
                    },
                      React.createElement(ChevronRight, { size: 16 }),
                      lang === 'de' ? 'Direkt zum Absenden springen' : lang === 'it' ? 'Vai direttamente all\'invio' : 'Skip to Submit'
                    )
                  ),
                  
                  // Progress Bar
                  React.createElement('div', { className: 'flex items-center gap-2' },
                    [1, 2, 3, 4].map(step => 
                      React.createElement('div', { 
                        key: step,
                        className: 'flex-1'
                      },
                        React.createElement('div', { 
                          className: `h-2 rounded-full transition-all ${
                            step < currentStep ? 'bg-[#6EBD84]' :
                            step === currentStep ? 'bg-[#243186]' : 'bg-slate-200'
                          }`
                        }),
                        React.createElement('p', { className: `text-xs mt-1 text-center ${step === currentStep ? 'text-[#243186] font-medium' : 'text-slate-400'}` },
                          stepTitles[lang][step - 1]
                        )
                      )
                    )
                  )
                ),
                
                // Step Content
                React.createElement('div', { className: 'mb-6' },
                  currentStep === 1 && renderStep1(),
                  currentStep === 2 && renderStep2(),
                  currentStep === 3 && renderStep3(),
                  currentStep === 4 && renderStep4()
                ),
                
                // Navigation Buttons (Fixed am unteren Rand)
                React.createElement('div', { className: 'fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-4' },
                  React.createElement('div', { className: 'max-w-2xl mx-auto flex gap-3' },
                    // Zur√ºck Button
                    currentStep > 1 && React.createElement('button', {
                      onClick: () => setCurrentStep(prev => prev - 1),
                      className: 'flex-1 py-3 px-6 border border-slate-300 text-slate-700 rounded-xl font-medium hover:bg-slate-50 transition-colors'
                    }, lang === 'de' ? '‚Üê Zur√ºck' : lang === 'it' ? '‚Üê Indietro' : '‚Üê Back'),
                    
                    // Weiter / Absenden Button
                    currentStep < totalSteps 
                      ? React.createElement('button', {
                          onClick: () => setCurrentStep(prev => prev + 1),
                          className: 'flex-1 py-3 px-6 bg-[#6EBD84] text-white rounded-xl font-medium hover:bg-[#5da872] transition-colors'
                        }, lang === 'de' ? 'Weiter ‚Üí' : lang === 'it' ? 'Avanti ‚Üí' : 'Next ‚Üí')
                      : React.createElement('button', {
                          onClick: handleGuestSave,
                          disabled: isSaving,
                          className: 'flex-1 py-3 px-6 bg-[#243186] text-white rounded-xl font-medium hover:bg-[#1a2563] transition-colors disabled:opacity-50 flex items-center justify-center gap-2'
                        }, 
                          isSaving && React.createElement(Loader2, { size: 20, className: 'animate-spin' }),
                          isSaving 
                            ? (lang === 'de' ? 'Wird gesendet...' : lang === 'it' ? 'Invio in corso...' : 'Sending...')
                            : (lang === 'de' ? '‚úì Absenden' : lang === 'it' ? '‚úì Invia' : '‚úì Submit')
                        )
                  )
                )
              )
            );
          };

          // === VIEW SELF ASSESSMENT (Manager sieht eingereichte Selbstreflexion) ===
          const renderViewSelfAssessment = () => {
            // Lade Daten aus localStorage (mit sicherem Zugriff)
            const selfData = safeLocalStorage.getItem('nw_view_self_assessment', null);
            if (!selfData) {
              return React.createElement('div', { className: 'text-center py-12' },
                React.createElement('p', { className: 'text-slate-500' }, 
                  lang === 'de' ? 'Keine Selbstreflexion ausgew√§hlt.' : lang === 'it' ? 'Nessuna autovalutazione selezionata.' : 'No self-reflection selected.'
                ),
                React.createElement('button', {
                  onClick: () => setActiveView('teamoverview'),
                  className: 'mt-4 px-4 py-2 bg-slate-100 rounded-2xl hover:bg-slate-200'
                }, lang === 'de' ? '‚Üê Zur√ºck' : lang === 'it' ? '‚Üê Indietro' : '‚Üê Back')
              );
            }
            
            const e = React.createElement;
            
            // BARS Labels
            const barsLabels = {
              de: { 1: 'Erf√ºllt nicht', 2: 'Verbesserungsbedarf', 3: 'Baseline', 4: '√úbertrifft', 5: 'Herausragend' },
              it: { 1: 'Non soddisfa', 2: 'Da migliorare', 3: 'Baseline', 4: 'Supera', 5: 'Eccellente' },
              en: { 1: 'Does Not Meet', 2: 'Needs Improvement', 3: 'Baseline', 4: 'Exceeds', 5: 'Outstanding' }
            };
            
            // Kompetenz-Namen aus DEFAULTS holen
            const defs = DEFAULTS[lang] || DEFAULTS['de'];
            
            // Scores extrahieren
            const coreScores = selfData.selfCoreScores || {};
            const coreComments = selfData.selfCoreComments || {};
            const leaderScores = selfData.selfLeaderScores || {};
            const leaderComments = selfData.selfLeaderComments || {};
            const goals = selfData.goals || [];
            const formData = selfData.formData || {};
            const careerChecks = selfData.careerChecks || [false, false, false, false, false];
            const isManager = selfData.isManager || false;
            const noGoalsMode = selfData.noGoalsMode || goals.length === 0;
            
            // Score-Farbe
            const getScoreColor = (score) => {
              if (score <= 1) return { bg: 'bg-red-500', text: 'text-red-700', light: 'bg-red-100' };
              if (score <= 2) return { bg: 'bg-orange-500', text: 'text-orange-700', light: 'bg-orange-100' };
              if (score <= 3) return { bg: 'bg-[#243186]', text: 'text-[#243186]', light: 'bg-blue-100' };
              if (score <= 4) return { bg: 'bg-[#6EBD84]', text: 'text-green-700', light: 'bg-green-100' };
              return { bg: 'bg-[#6EBD84]', text: 'text-green-700', light: 'bg-green-100' };
            };
            
            // GPS berechnen
            // BARS-Umrechnung: Zielerreichung % ‚Üí BARS-Stufe (1-5)
            const percentToBARS = (percent) => {
              if (percent >= 130) return 5;  // Herausragend (>130%)
              if (percent >= 111) return 4;  // √úbertroffen (111-130%)
              if (percent >= 90) return 3;   // Baseline (90-110%)
              if (percent >= 70) return 2;   // Teilweise (70-89%)
              return 1;                       // Nicht erreicht (<70%)
            };
            
            const calcGPS = () => {
              // WAS (Ziele) - achievement kann Prozent (0-100+) oder 1-5 Skala sein
              let wasScore = 0;
              let wasScorePercent = 0; // F√ºr Anzeige
              if (!noGoalsMode && goals.length > 0) {
                const totalWeight = goals.reduce((sum, g) => sum + (g.weight || 0), 0);
                if (totalWeight > 0) {
                  // Pr√ºfe ob achievement in Prozent oder 1-5 Skala ist
                  const firstAchievement = goals[0]?.achievement || 0;
                  const isPercent = firstAchievement > 5;
                  
                  if (isPercent) {
                    // Achievement ist in Prozent (0-100+)
                    // Erst gewichteten Durchschnitt der Prozente berechnen
                    wasScorePercent = goals.reduce((sum, g) => sum + ((g.achievement || 0) * (g.weight || 0)), 0) / totalWeight;
                    // Dann mit BARS-Tabelle in 1-5 Skala umrechnen
                    wasScore = percentToBARS(wasScorePercent);
                  } else {
                    // Achievement ist bereits auf 1-5 Skala
                    wasScore = goals.reduce((sum, g) => sum + ((g.achievement || 0) * (g.weight || 0)), 0) / totalWeight;
                    wasScorePercent = wasScore / 5 * 100;
                  }
                }
              }
              
              // WIE Core
              const coreValues = Object.values(coreScores).filter(v => v > 0);
              const wieCoreScore = coreValues.length > 0 ? coreValues.reduce((a, b) => a + b, 0) / coreValues.length : 0;
              
              // WIE Leader
              const leaderValues = Object.values(leaderScores).filter(v => v > 0);
              const wieLeadScore = leaderValues.length > 0 ? leaderValues.reduce((a, b) => a + b, 0) / leaderValues.length : 0;
              
              // Final GPS (alle Werte auf 5er-Skala)
              let finalGPS;
              if (noGoalsMode || goals.length === 0) {
                if (isManager && leaderValues.length > 0) {
                  finalGPS = (wieCoreScore * 0.5) + (wieLeadScore * 0.5);
                } else {
                  finalGPS = wieCoreScore;
                }
              } else {
                if (isManager && leaderValues.length > 0) {
                  finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.25) + (wieLeadScore * 0.25);
                } else {
                  finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.5);
                }
              }
              
              return { wasScore, wasScorePercent, wieCoreScore, wieLeadScore, finalGPS };
            };
            
            const gps = calcGPS();
            
            // Karriere-Labels
            const careerLabels = {
              de: ['Zufrieden mit aktueller Position', 'Strebe Fachkarriere an', 'Strebe F√ºhrungskarriere an', 'Offen f√ºr Abteilungswechsel', 'Offen f√ºr Standortwechsel'],
              it: ['Soddisfatto/a della posizione attuale', 'Aspiro a carriera tecnica', 'Aspiro a carriera manageriale', 'Aperto/a a cambio reparto', 'Aperto/a a cambio sede'],
              en: ['Satisfied with current position', 'Seeking technical career', 'Seeking management career', 'Open to department change', 'Open to location change']
            };
            
            return e('div', { className: 'space-y-6 pb-10 max-w-5xl mx-auto' },
              // === HEADER ===
              e('div', { className: 'bg-gradient-to-r from-teal-500 to-teal-600 rounded-2xl p-6 text-white shadow-lg' },
                e('div', { className: 'flex items-center justify-between flex-wrap gap-4' },
                  e('div', null,
                    e('div', { className: 'flex items-center gap-3 mb-2' },
                      e('div', { className: 'bg-white/20 p-3 rounded-full' },
                        e(Users, { size: 28 })
                      ),
                      e('div', null,
                        e('p', { className: 'text-teal-100 text-sm' },
                          lang === 'de' ? 'Selbstreflexion von' : lang === 'it' ? 'Autovalutazione di' : 'Self-Reflection from'
                        ),
                        e('h1', { className: 'text-2xl md:text-3xl font-bold' },
                          selfData.employeeName || selfData.formData?.employee || getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee')
                        )
                      )
                    ),
                    e('div', { className: 'flex items-center gap-4 mt-3 text-sm text-teal-100 flex-wrap' },
                      e('span', { className: 'flex items-center gap-1' },
                        e(Briefcase, { size: 14 }),
                        selfData.position || selfData.formData?.position || '‚Äì'
                      ),
                      selfData.department && e('span', { className: 'flex items-center gap-1' },
                        e(Building2, { size: 14 }),
                        selfData.department
                      ),
                      isManager && e('span', { className: 'bg-white/20 px-2 py-0.5 rounded text-xs' }, 'üëî ' + (lang === 'de' ? 'F√ºhrungskraft' : 'Manager')),
                      e('span', { className: 'flex items-center gap-1' },
                        e(Calendar, { size: 14 }),
                        selfData.period || new Date().getFullYear()
                      )
                    )
                  ),
                  // Pr√ºfe ob R√ºckkehr-Kontext existiert (kam vom AppraisalForm)
                  (() => {
                    const returnContext = safeLocalStorage.getItem('nw_return_to_appraisal', null);
                    const hasReturnContext = returnContext && (Date.now() - returnContext.timestamp) < 3600000; // Max 1 Stunde
                    
                    // Professioneller PDF Download Handler
                    const handlePrintSelfReflection = async () => {
                      if (!window.html2pdf) {
                        showToast(lang === 'de' ? "PDF-Bibliothek nicht geladen" : "PDF library not loaded", 'error');
                        return;
                      }
                      
                      try {
                        const currentDate = new Date().toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB');
                        const employeeName = selfData.employeeName || selfData.formData?.employee || 'Mitarbeiter';
                        const position = selfData.position || selfData.formData?.position || '‚Äì';
                        const period = selfData.period || new Date().getFullYear();
                        
                        // Texte je nach Sprache
                        const pdfTexts = {
                          de: { title: 'Selbstreflexion', subtitle: 'Performance Management', employee: 'Mitarbeiter/in', position: 'Position', period: 'Periode', profile: 'Profil', partB: 'Teil B: Zielerreichung (WAS)', partC1: 'Teil C.1: Kern-Kompetenzen (WIE)', partC2: 'Teil C.2: F√ºhrungs-Kompetenzen', goal: 'Ziel', weight: 'Gew.', achievement: 'Erreichung', competency: 'Kompetenz', rating: 'Rating', comment: 'Begr√ºndung', noGoals: 'Keine Ziele vereinbart', gpsTitle: 'GPS-Ergebnis' },
                          it: { title: 'Autovalutazione', subtitle: 'Performance Management', employee: 'Collaboratore', position: 'Posizione', period: 'Periodo', profile: 'Profilo', partB: 'Parte B: Obiettivi (COSA)', partC1: 'Parte C.1: Competenze Core (COME)', partC2: 'Parte C.2: Competenze Leadership', goal: 'Obiettivo', weight: 'Peso', achievement: 'Raggiunto', competency: 'Competenza', rating: 'Voto', comment: 'Motivazione', noGoals: 'Nessun obiettivo', gpsTitle: 'Risultato GPS' },
                          en: { title: 'Self-Reflection', subtitle: 'Performance Management', employee: 'Employee', position: 'Position', period: 'Period', profile: 'Profile', partB: 'Part B: Goals (WHAT)', partC1: 'Part C.1: Core Competencies (HOW)', partC2: 'Part C.2: Leadership', goal: 'Goal', weight: 'Wgt.', achievement: 'Achieved', competency: 'Competency', rating: 'Rating', comment: 'Comment', noGoals: 'No goals defined', gpsTitle: 'GPS Result' }
                        };
                        const t = pdfTexts[lang] || pdfTexts.de;
                        
                        // BARS Labels (kurz)
                        const barsLabelsLocal = {
                          de: { 1: 'Nicht erf√ºllt', 2: 'Verbess.', 3: 'Baseline', 4: '√úbertrifft', 5: 'Herausr.' },
                          it: { 1: 'Non sodd.', 2: 'Da migl.', 3: 'Baseline', 4: 'Supera', 5: 'Eccell.' },
                          en: { 1: 'Not Met', 2: 'Improve', 3: 'Baseline', 4: 'Exceeds', 5: 'Outstand.' }
                        };
                        const bl = barsLabelsLocal[lang] || barsLabelsLocal.de;
                        
                        // Profil-Text
                        const profileText = isManager 
                          ? (lang === 'de' ? 'F√ºhrungskraft' : lang === 'it' ? 'Dirigente' : 'Manager')
                          : (lang === 'de' ? 'Mitarbeiter' : lang === 'it' ? 'Collaboratore' : 'Employee');
                        
                        // Score-Farben
                        const getScoreColorStyle = (score) => {
                          if (score <= 1) return 'background: #fef2f2; color: #dc2626;';
                          if (score <= 2) return 'background: #fff7ed; color: #ea580c;';
                          if (score <= 3) return 'background: #eff6ff; color: #2563eb;';
                          return 'background: #f0fdf4; color: #16a34a;';
                        };
                        
                        // Kommentar formatieren OHNE K√ºrzung - voller Text mit Zeilenumbruch
                        const formatComment = (text, maxLen = 0) => {
                          if (!text) return '‚Äì';
                          // Ersetze lange Zeichenketten ohne Leerzeichen durch umgebrochene Version
                          // KEINE K√ºrzung mehr - voller Text wird angezeigt
                          let formatted = text.replace(/(\S{25})/g, '$1<wbr>');
                          // Zeilenumbr√ºche erhalten
                          formatted = formatted.replace(/\n/g, '<br>');
                          return formatted;
                        };
                        
                        
                        // Karriere-Labels f√ºr PDF
                        const careerLabelsLocal = {
                          de: ['Zufrieden mit aktueller Position', 'Strebe Fachkarriere an', 'Strebe F√ºhrungskarriere an', 'Offen f√ºr Abteilungswechsel', 'Offen f√ºr Standortwechsel'],
                          it: ['Soddisfatto/a della posizione', 'Aspiro a carriera tecnica', 'Aspiro a carriera manageriale', 'Aperto/a a cambio reparto', 'Aperto/a a cambio sede'],
                          en: ['Satisfied with position', 'Seeking technical career', 'Seeking management career', 'Open to dept. change', 'Open to location change']
                        };
                        const cl = careerLabelsLocal[lang] || careerLabelsLocal.de;
                        
                        // Feedback-Fragen Labels
                        const feedbackLabels = {
                          de: {
                            q1: 'Was l√§uft gut in der Zusammenarbeit mit Ihrer F√ºhrungskraft?',
                            q2: 'Was k√∂nnte verbessert werden?',
                            q3: 'Wie zufrieden sind Sie mit dem Informationsfluss?',
                            q4: 'Wie zufrieden sind Sie mit der Unterst√ºtzung bei Ihrer Weiterentwicklung?',
                            q5: 'Was w√ºnschen Sie sich von Ihrer F√ºhrungskraft?',
                            q6: 'Sonstige Anmerkungen',
                            q7: 'Work-Life-Balance'
                          },
                          it: {
                            q1: 'Cosa funziona bene nella collaborazione con il suo responsabile?',
                            q2: 'Cosa potrebbe essere migliorato?',
                            q3: 'Quanto √® soddisfatto/a del flusso di informazioni?',
                            q4: 'Quanto √® soddisfatto/a del supporto per il suo sviluppo?',
                            q5: 'Cosa si aspetta dal suo responsabile?',
                            q6: 'Altre osservazioni',
                            q7: 'Equilibrio vita-lavoro'
                          },
                          en: {
                            q1: 'What works well with your manager?',
                            q2: 'What could be improved?',
                            q3: 'How satisfied are you with information flow?',
                            q4: 'How satisfied are you with development support?',
                            q5: 'What do you expect from your manager?',
                            q6: 'Other comments',
                            q7: 'Work-Life Balance'
                          }
                        };
                        const fl = feedbackLabels[lang] || feedbackLabels.de;
                        
                        // DevPlan aus selfData holen
                        const devPlanData = selfData.devPlan || [];
                        
                        // HTML f√ºr PDF erstellen - VOLLST√ÑNDIG f√ºr Personalakte
                        let pdfHTML = `
                          <div style="font-family: Arial, sans-serif; color: #1e293b; font-size: 9pt; line-height: 1.4; padding: 10mm;">
                            <!-- HEADER -->
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 3px solid #243186;">
                              <div>
                                <h1 style="color: #243186; font-size: 22pt; margin: 0; font-weight: 700;">nƒ±ederwƒ±eser</h1>
                                <p style="color: #6EBD84; font-size: 8pt; margin: 3px 0 0 0; font-weight: 600; letter-spacing: 1.5px;">FLEXIBLE FOOD PACKAGING</p>
                              </div>
                              <div style="text-align: right;">
                                <p style="font-size: 8pt; color: #64748b; margin: 0;">Erstellt: ${currentDate}</p>
                                <p style="font-size: 7pt; color: #94a3b8; margin: 2px 0 0 0;">${lang === 'de' ? 'Vertraulich ‚Äì Personalakte' : lang === 'it' ? 'Riservato ‚Äì Fascicolo personale' : 'Confidential ‚Äì Personnel File'}</p>
                              </div>
                            </div>
                            
                            <!-- TITEL + STAMMDATEN -->
                            <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                              <div style="background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%); color: white; padding: 12px 18px; border-radius: 6px; flex-shrink: 0;">
                                <h2 style="margin: 0; font-size: 14pt; font-weight: 700;">${t.title}</h2>
                                <p style="margin: 3px 0 0 0; font-size: 9pt; opacity: 0.9;">${t.subtitle}</p>
                              </div>
                              <table style="flex: 1; border-collapse: collapse; font-size: 9pt;">
                                <tr>
                                  <td style="padding: 5px 8px; background: #f1f5f9; border: 1px solid #e2e8f0; width: 18%;"><span style="font-size: 7pt; color: #64748b;">${t.employee}</span></td>
                                  <td style="padding: 5px 8px; border: 1px solid #e2e8f0; font-weight: 700;">${employeeName}</td>
                                  <td style="padding: 5px 8px; background: #f1f5f9; border: 1px solid #e2e8f0; width: 15%;"><span style="font-size: 7pt; color: #64748b;">${t.position}</span></td>
                                  <td style="padding: 5px 8px; border: 1px solid #e2e8f0; font-weight: 600;">${position}</td>
                                </tr>
                                <tr>
                                  <td style="padding: 5px 8px; background: #f1f5f9; border: 1px solid #e2e8f0;"><span style="font-size: 7pt; color: #64748b;">${t.period}</span></td>
                                  <td style="padding: 5px 8px; border: 1px solid #e2e8f0; font-weight: 600;">${period}</td>
                                  <td style="padding: 5px 8px; background: #f1f5f9; border: 1px solid #e2e8f0;"><span style="font-size: 7pt; color: #64748b;">${t.profile}</span></td>
                                  <td style="padding: 5px 8px; border: 1px solid #e2e8f0; font-weight: 600;">${profileText}</td>
                                </tr>
                              </table>
                            </div>
                            
                            <!-- TEIL B: ZIELE -->
                            ${!noGoalsMode && goals.length > 0 ? `
                            <div style="margin-bottom: 12px;">
                              <div style="background: #eff6ff; padding: 6px 12px; border-left: 4px solid #3b82f6; margin-bottom: 8px;">
                                <h3 style="font-size: 11pt; margin: 0; color: #1e40af; font-weight: 700;">${t.partB}</h3>
                              </div>
                              <table style="width: 100%; border-collapse: collapse; font-size: 9pt;">
                                <thead>
                                  <tr style="background: #1e40af; color: white;">
                                    <th style="padding: 6px 8px; text-align: left;">${t.goal}</th>
                                    <th style="padding: 6px; text-align: center; width: 50px;">${t.weight}</th>
                                    <th style="padding: 6px; text-align: center; width: 70px;">${t.achievement}</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  ${goals.map((g, idx) => `
                                    <tr style="background: ${idx % 2 === 0 ? '#fff' : '#f8fafc'};">
                                      <td style="padding: 6px 8px; border-bottom: 1px solid #e2e8f0;">${g.name || '‚Äì'}</td>
                                      <td style="padding: 6px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 600;">${g.weight}%</td>
                                      <td style="padding: 6px; border-bottom: 1px solid #e2e8f0; text-align: center;">
                                        <span style="padding: 2px 8px; border-radius: 10px; font-weight: 700; font-size: 8pt; ${g.achievement >= 100 ? 'background: #dcfce7; color: #166534;' : g.achievement >= 70 ? 'background: #fef9c3; color: #854d0e;' : 'background: #fee2e2; color: #dc2626;'}">
                                          ${g.achievement}%
                                        </span>
                                      </td>
                                    </tr>
                                  `).join('')}
                                </tbody>
                              </table>
                            </div>
                            ` : `<div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 6px; padding: 10px 12px; margin-bottom: 12px;">
                              <p style="color: #92400e; font-size: 9pt; margin: 0;">‚ö†Ô∏è ${t.noGoals} ‚Äì GPS wird nur aus Kompetenzen berechnet.</p>
                            </div>`}
                            
                            <!-- TEIL C.1: KERN-KOMPETENZEN -->
                            <div style="margin-bottom: 12px;">
                              <div style="background: #f0fdf4; padding: 6px 12px; border-left: 4px solid #6EBD84; margin-bottom: 8px;">
                                <h3 style="font-size: 11pt; margin: 0; color: #166534; font-weight: 700;">${t.partC1}</h3>
                              </div>
                              <table style="width: 100%; border-collapse: collapse; font-size: 8pt; table-layout: fixed;">
                                <thead>
                                  <tr style="background: #166534; color: white;">
                                    <th style="padding: 5px 8px; text-align: left; width: 28%;">${t.competency}</th>
                                    <th style="padding: 5px; text-align: center; width: 18%;">${t.rating}</th>
                                    <th style="padding: 5px 8px; text-align: left; width: 54%;">${t.comment}</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  ${defs.core.map((comp, idx) => {
                                    const score = coreScores[comp.id] || 0;
                                    const comment = coreComments[comp.id] || '';
                                    return `
                                      <tr style="background: ${idx % 2 === 0 ? '#fff' : '#f0fdf4'};">
                                        <td style="padding: 5px 8px; border-bottom: 1px solid #e2e8f0; font-weight: 600; font-size: 8pt;">${comp.name}</td>
                                        <td style="padding: 5px; border-bottom: 1px solid #e2e8f0; text-align: center;">
                                          <span style="padding: 3px 8px; border-radius: 10px; font-weight: 700; font-size: 8pt; white-space: nowrap; ${getScoreColorStyle(score)}">
                                            ${score} ‚Äì ${bl[score] || '‚Äì'}
                                          </span>
                                        </td>
                                        <td style="padding: 5px 8px; border-bottom: 1px solid #e2e8f0; font-size: 8pt; color: #475569; font-style: italic; word-wrap: break-word; white-space: pre-wrap; overflow-wrap: break-word;">${formatComment(comment)}</td>
                                      </tr>
                                    `;
                                  }).join('')}
                                </tbody>
                              </table>
                            </div>
                            
                            <!-- TEIL C.2: F√úHRUNGS-KOMPETENZEN (nur wenn Manager) -->
                            ${isManager ? `
                            <div style="margin-bottom: 12px;">
                              <div style="background: #faf5ff; padding: 6px 12px; border-left: 4px solid #7c3aed; margin-bottom: 8px;">
                                <h3 style="font-size: 11pt; margin: 0; color: #5b21b6; font-weight: 700;">${t.partC2}</h3>
                              </div>
                              <table style="width: 100%; border-collapse: collapse; font-size: 8pt; table-layout: fixed;">
                                <thead>
                                  <tr style="background: #5b21b6; color: white;">
                                    <th style="padding: 5px 8px; text-align: left; width: 28%;">${t.competency}</th>
                                    <th style="padding: 5px; text-align: center; width: 18%;">${t.rating}</th>
                                    <th style="padding: 5px 8px; text-align: left; width: 54%;">${t.comment}</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  ${defs.lead.map((comp, idx) => {
                                    const score = leaderScores[comp.id] || 0;
                                    const comment = leaderComments[comp.id] || '';
                                    return `
                                      <tr style="background: ${idx % 2 === 0 ? '#fff' : '#faf5ff'};">
                                        <td style="padding: 5px 8px; border-bottom: 1px solid #e2e8f0; font-weight: 600; font-size: 8pt;">${comp.name}</td>
                                        <td style="padding: 5px; border-bottom: 1px solid #e2e8f0; text-align: center;">
                                          <span style="padding: 3px 8px; border-radius: 10px; font-weight: 700; font-size: 8pt; white-space: nowrap; ${getScoreColorStyle(score)}">
                                            ${score} ‚Äì ${bl[score] || '‚Äì'}
                                          </span>
                                        </td>
                                        <td style="padding: 5px 8px; border-bottom: 1px solid #e2e8f0; font-size: 8pt; color: #475569; font-style: italic; word-wrap: break-word; white-space: pre-wrap; overflow-wrap: break-word;">${formatComment(comment)}</td>
                                      </tr>
                                    `;
                                  }).join('')}
                                </tbody>
                              </table>
                            </div>
                            ` : ''}
                            
                            <!-- GPS ERGEBNIS -->
                            <div style="background: linear-gradient(135deg, #243186 0%, #1a2564 100%); color: white; padding: 14px 18px; border-radius: 8px; margin: 15px 0;">
                              <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="margin: 0; font-size: 12pt; font-weight: 600;">${t.gpsTitle}</h3>
                                <div style="display: flex; gap: 25px; align-items: center;">
                                  ${!noGoalsMode ? `<div style="text-align: center;"><div style="font-size: 18pt; font-weight: 700;">${gps.wasScore.toFixed(1)}</div><div style="font-size: 7pt; opacity: 0.8;">WAS (50%)</div></div>` : ''}
                                  <div style="text-align: center;"><div style="font-size: 18pt; font-weight: 700;">${gps.wieCoreScore.toFixed(2)}</div><div style="font-size: 7pt; opacity: 0.8;">WIE Core ${noGoalsMode ? (isManager ? '(50%)' : '(100%)') : (isManager ? '(25%)' : '(50%)')}</div></div>
                                  ${isManager ? `<div style="text-align: center;"><div style="font-size: 18pt; font-weight: 700;">${gps.wieLeadScore.toFixed(2)}</div><div style="font-size: 7pt; opacity: 0.8;">WIE Lead ${noGoalsMode ? '(50%)' : '(25%)'}</div></div>` : ''}
                                  <div style="background: rgba(110, 189, 132, 0.3); padding: 10px 18px; border-radius: 8px; text-align: center; border: 2px solid rgba(110, 189, 132, 0.5);">
                                    <div style="font-size: 24pt; font-weight: 900; color: #6EBD84;">${gps.finalGPS.toFixed(2)}</div>
                                    <div style="font-size: 8pt; font-weight: 700;">FINAL GPS</div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            
                            <!-- SEITENUMBRUCH f√ºr Seite 2 -->
                            <div style="page-break-before: always;"></div>
                            
                            <!-- TEIL D: ST√ÑRKEN & ENTWICKLUNG -->
                            <div style="margin-bottom: 15px;">
                              <div style="background: #f8fafc; padding: 6px 12px; border-left: 4px solid #64748b; margin-bottom: 10px;">
                                <h3 style="font-size: 11pt; margin: 0; color: #334155; font-weight: 700;">${lang === 'de' ? 'Teil D: St√§rken & Entwicklung' : lang === 'it' ? 'Parte D: Punti di forza & Sviluppo' : 'Part D: Strengths & Development'}</h3>
                              </div>
                              <div style="display: flex; gap: 15px;">
                                <!-- St√§rken -->
                                <div style="flex: 1; background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 6px; padding: 12px;">
                                  <h4 style="margin: 0 0 8px 0; font-size: 10pt; color: #166534; font-weight: 600;">‚úì ${lang === 'de' ? 'Meine St√§rken' : lang === 'it' ? 'I miei punti di forza' : 'My Strengths'}</h4>
                                  ${formData.strengths1 ? `<p style="margin: 0 0 6px 0; font-size: 8pt; color: #334155; background: white; padding: 6px 8px; border-radius: 4px;">${formatComment(formData.strengths1)}</p>` : ''}
                                  ${formData.strengths2 ? `<p style="margin: 0 0 6px 0; font-size: 8pt; color: #334155; background: white; padding: 6px 8px; border-radius: 4px;">${formatComment(formData.strengths2)}</p>` : ''}
                                  ${!formData.strengths1 && !formData.strengths2 ? `<p style="margin: 0; font-size: 8pt; color: #94a3b8; font-style: italic;">${lang === 'de' ? getText(lang, 'Keine Angabe', 'Non specificato', 'Not specified') : lang === 'it' ? 'Nessuna indicazione' : 'No data'}</p>` : ''}
                                </div>
                              </div>
                            </div>
                            
                            <!-- ENTWICKLUNGSPLAN (falls vorhanden) -->
                            ${devPlanData && devPlanData.length > 0 && devPlanData.some(d => d.measure) ? `
                            <div style="margin-bottom: 15px;">
                              <div style="background: #ecfeff; padding: 6px 12px; border-left: 4px solid #06b6d4; margin-bottom: 8px;">
                                <h4 style="font-size: 10pt; margin: 0; color: #0e7490; font-weight: 600;">${lang === 'de' ? 'Entwicklungsplan' : lang === 'it' ? 'Piano di sviluppo' : 'Development Plan'}</h4>
                              </div>
                              <table style="width: 100%; border-collapse: collapse; font-size: 8pt;">
                                <thead>
                                  <tr style="background: #0e7490; color: white;">
                                    <th style="padding: 5px 8px; text-align: left;">${lang === 'de' ? 'Ma√ünahme' : lang === 'it' ? 'Misura' : 'Measure'}</th>
                                    <th style="padding: 5px 8px; text-align: left; width: 25%;">${lang === 'de' ? 'Verantwortlich' : lang === 'it' ? 'Responsabile' : 'Responsible'}</th>
                                    <th style="padding: 5px 8px; text-align: center; width: 15%;">${lang === 'de' ? 'Termin' : lang === 'it' ? 'Scadenza' : 'Deadline'}</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  ${devPlanData.filter(d => d.measure).map((d, idx) => `
                                    <tr style="background: ${idx % 2 === 0 ? '#fff' : '#ecfeff'};">
                                      <td style="padding: 5px 8px; border-bottom: 1px solid #e2e8f0;">${d.measure || '‚Äì'}</td>
                                      <td style="padding: 5px 8px; border-bottom: 1px solid #e2e8f0;">${d.responsible || '‚Äì'}</td>
                                      <td style="padding: 5px 8px; border-bottom: 1px solid #e2e8f0; text-align: center;">${d.deadline || '‚Äì'}</td>
                                    </tr>
                                  `).join('')}
                                </tbody>
                              </table>
                            </div>
                            ` : ''}
                            
                            <!-- TEIL E: KARRIEREW√úNSCHE -->
                            <div style="margin-bottom: 15px;">
                              <div style="background: #faf5ff; padding: 6px 12px; border-left: 4px solid #a855f7; margin-bottom: 10px;">
                                <h3 style="font-size: 11pt; margin: 0; color: #7c3aed; font-weight: 700;">${lang === 'de' ? 'Teil E: Karrierew√ºnsche' : lang === 'it' ? 'Parte E: Aspirazioni di carriera' : 'Part E: Career Aspirations'}</h3>
                              </div>
                              <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 6px; padding: 12px;">
                                ${careerChecks.some(c => c) ? `
                                  <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
                                    ${careerChecks.map((checked, idx) => checked ? `<span style="background: #7c3aed; color: white; padding: 4px 10px; border-radius: 12px; font-size: 8pt; font-weight: 500;">‚úì ${cl[idx]}</span>` : '').join('')}
                                  </div>
                                ` : `<p style="margin: 0 0 10px 0; font-size: 8pt; color: #94a3b8; font-style: italic;">${lang === 'de' ? 'Keine Auswahl getroffen' : 'No selection'}</p>`}
                                ${formData.careerComment ? `
                                  <div style="background: white; border-radius: 4px; padding: 8px 10px; margin-top: 8px;">
                                    <p style="margin: 0 0 4px 0; font-size: 7pt; color: #7c3aed; font-weight: 600;">${lang === 'de' ? 'Kommentar:' : lang === 'it' ? 'Commento:' : 'Comment:'}</p>
                                    <p style="margin: 0; font-size: 8pt; color: #334155;">${formatComment(formData.careerComment)}</p>
                                  </div>
                                ` : ''}
                                ${formData.wishesNextYear ? `
                                  <div style="background: white; border-radius: 4px; padding: 8px 10px; margin-top: 8px;">
                                    <p style="margin: 0 0 4px 0; font-size: 7pt; color: #7c3aed; font-weight: 600;">${lang === 'de' ? 'W√ºnsche f√ºr das kommende Jahr:' : lang === 'it' ? 'Desideri per il prossimo anno:' : 'Wishes for next year:'}</p>
                                    <p style="margin: 0; font-size: 8pt; color: #334155;">${formatComment(formData.wishesNextYear)}</p>
                                  </div>
                                ` : ''}
                              </div>
                            </div>
                            
                            <!-- TEIL F: FEEDBACK AN F√úHRUNGSKRAFT -->
                            ${(formData.feedbackQ1 || formData.feedbackQ2 || formData.feedbackQ3 || formData.feedbackQ4 || formData.feedbackQ5 || formData.feedbackQ6 || formData.feedbackQ7) ? `
                            <div style="margin-bottom: 15px;">
                              <div style="background: #eff6ff; padding: 6px 12px; border-left: 4px solid #3b82f6; margin-bottom: 10px;">
                                <h3 style="font-size: 11pt; margin: 0; color: #1e40af; font-weight: 700;">${lang === 'de' ? 'Teil F: Feedback an F√ºhrungskraft' : lang === 'it' ? 'Parte F: Feedback al responsabile' : 'Part F: Feedback to Manager'}</h3>
                              </div>
                              <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 12px;">
                                ${formData.feedbackQ1 ? `<div style="margin-bottom: 10px; border-left: 3px solid #3b82f6; padding-left: 10px;"><p style="margin: 0 0 4px 0; font-size: 8pt; color: #1e40af; font-weight: 600;">${fl.q1}</p><p style="margin: 0; font-size: 8pt; color: #334155;">${formatComment(formData.feedbackQ1)}</p></div>` : ''}
                                ${formData.feedbackQ2 ? `<div style="margin-bottom: 10px; border-left: 3px solid #3b82f6; padding-left: 10px;"><p style="margin: 0 0 4px 0; font-size: 8pt; color: #1e40af; font-weight: 600;">${fl.q2}</p><p style="margin: 0; font-size: 8pt; color: #334155;">${formatComment(formData.feedbackQ2)}</p></div>` : ''}
                                ${formData.feedbackQ3 ? `<div style="margin-bottom: 10px; border-left: 3px solid #3b82f6; padding-left: 10px;"><p style="margin: 0 0 4px 0; font-size: 8pt; color: #1e40af; font-weight: 600;">${fl.q3}</p><p style="margin: 0; font-size: 8pt; color: #334155;">${formatComment(formData.feedbackQ3)}</p></div>` : ''}
                                ${formData.feedbackQ4 ? `<div style="margin-bottom: 10px; border-left: 3px solid #3b82f6; padding-left: 10px;"><p style="margin: 0 0 4px 0; font-size: 8pt; color: #1e40af; font-weight: 600;">${fl.q4}</p><p style="margin: 0; font-size: 8pt; color: #334155;">${formatComment(formData.feedbackQ4)}</p></div>` : ''}
                                ${formData.feedbackQ5 ? `<div style="margin-bottom: 10px; border-left: 3px solid #3b82f6; padding-left: 10px;"><p style="margin: 0 0 4px 0; font-size: 8pt; color: #1e40af; font-weight: 600;">${fl.q5}</p><p style="margin: 0; font-size: 8pt; color: #334155;">${formatComment(formData.feedbackQ5)}</p></div>` : ''}
                                ${formData.feedbackQ6 ? `<div style="margin-bottom: 10px; border-left: 3px solid #3b82f6; padding-left: 10px;"><p style="margin: 0 0 4px 0; font-size: 8pt; color: #1e40af; font-weight: 600;">${fl.q6}</p><p style="margin: 0; font-size: 8pt; color: #334155;">${formatComment(formData.feedbackQ6)}</p></div>` : ''}
                                ${formData.feedbackQ7 ? `<div style="background: #dbeafe; border-radius: 6px; padding: 10px; text-align: center; margin-top: 10px;"><p style="margin: 0 0 4px 0; font-size: 8pt; color: #1e40af; font-weight: 600;">${fl.q7}</p><p style="margin: 0; font-size: 18pt; font-weight: 900; color: #243186;">${formData.feedbackQ7}<span style="font-size: 10pt; font-weight: 400;">/5</span></p></div>` : ''}
                              </div>
                            </div>
                            ` : ''}
                            
                            <!-- UNTERSCHRIFTEN -->
                            <div style="margin-top: 25px; padding-top: 15px; border-top: 2px solid #e2e8f0;">
                              <div style="display: flex; gap: 40px;">
                                <div style="flex: 1;">
                                  <p style="font-size: 8pt; color: #64748b; margin: 0 0 25px 0;">${lang === 'de' ? 'Datum / Unterschrift Mitarbeiter:in' : lang === 'it' ? 'Data / Firma collaboratore' : 'Date / Employee Signature'}</p>
                                  <div style="border-bottom: 1px solid #334155; width: 100%;"></div>
                                </div>
                                <div style="flex: 1;">
                                  <p style="font-size: 8pt; color: #64748b; margin: 0 0 25px 0;">${lang === 'de' ? 'Datum / Unterschrift F√ºhrungskraft' : lang === 'it' ? 'Data / Firma responsabile' : 'Date / Manager Signature'}</p>
                                  <div style="border-bottom: 1px solid #334155; width: 100%;"></div>
                                </div>
                              </div>
                            </div>
                            
                            <!-- FOOTER -->
                            <div style="margin-top: 20px; padding-top: 10px; border-top: 1px solid #e2e8f0; font-size: 7pt; color: #94a3b8; text-align: center;">
                              ${lang === 'de' ? 'Vertraulich' : lang === 'it' ? 'Riservato' : 'Confidential'} ¬∑ Niederwieser Group ¬∑ Performance Management ${period} ¬∑ Seite 1-2
                            </div>
                          </div>
                        `;
                        
                        // PDF Container erstellen
                        const pdfContainer = document.createElement('div');
                        pdfContainer.style.cssText = 'width: 190mm; box-sizing: border-box; padding: 10mm; background: white;';
                        pdfContainer.innerHTML = pdfHTML;
                        document.body.appendChild(pdfContainer);
                        
                        // PDF generieren
                        const opt = {
                          margin: [0, 0, 0, 0],
                          filename: `Selbstreflexion_${employeeName.replace(/[^a-z0-9√§√∂√º√ü]/gi, '_')}.pdf`,
                          image: { type: 'jpeg', quality: 0.98 },
                          html2canvas: { scale: 2, useCORS: true },
                          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                        };
                        
                        await html2pdf().set(opt).from(pdfContainer).save();
                        
                        // Cleanup
                        document.body.removeChild(pdfContainer);
                        
                      } catch (error) {
                        console.error('PDF Export Fehler:', error);
                        showToast(lang === 'de' ? 'PDF-Export fehlgeschlagen' : 'PDF Export Error', 'error');
                      }
                    };
                    
                    return e('div', { className: 'flex flex-wrap gap-2 no-print' },
                      // PDF Download Button
                      e('button', {
                        onClick: handlePrintSelfReflection,
                        className: 'px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors text-white'
                      },
                        e(Download, { size: 16 }),
                        lang === 'de' ? 'PDF herunterladen' : lang === 'it' ? 'Scarica PDF' : 'Download PDF'
                      ),
                      // Bedingte Navigations-Buttons
                      hasReturnContext ? e(React.Fragment, null,
                        // Zur√ºck zur Beurteilung (prominent)
                        e('button', {
                          onClick: () => {
                            localStorage.removeItem('nw_view_self_assessment');
                            // Starte AppraisalForm mit dem gespeicherten Mitarbeiter
                            const employeeId = returnContext.employeeId;
                            const period = returnContext.period;
                            
                            // Finde den Mitarbeiter und starte das Formular
                            const member = teamMembers.find(m => m.id === employeeId);
                            if (member) {
                              const existingReview = teamAppraisals.find(a => 
                                a.employeeId === employeeId && 
                                a.period === period && 
                                (a.type === 'review' || !a.type)
                              );
                              startTeamAppraisal(employeeId, period, existingReview);
                            }
                            localStorage.removeItem('nw_return_to_appraisal');
                          },
                          className: 'px-4 py-2 bg-[#6EBD84] hover:bg-[#5da872] rounded-lg text-sm font-bold flex items-center gap-2 transition-colors text-white'
                        }, 
                          e(ArrowLeft, { size: 16 }),
                          lang === 'de' ? '‚Üê Beurteilung' : lang === 'it' ? '‚Üê Valutazione' : '‚Üê Appraisal'
                        ),
                        // Zur √úbersicht (sekund√§r)
                        e('button', {
                          onClick: () => {
                            localStorage.removeItem('nw_view_self_assessment');
                            localStorage.removeItem('nw_return_to_appraisal');
                            setActiveView('teamoverview');
                          },
                          className: 'px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors'
                        }, 
                          lang === 'de' ? '√úbersicht' : lang === 'it' ? 'Panoramica' : 'Overview'
                        )
                      ) : e('button', {
                        onClick: () => {
                          localStorage.removeItem('nw_view_self_assessment');
                          localStorage.removeItem('nw_return_to_appraisal');
                          setActiveView('teamoverview');
                        },
                        className: 'px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors'
                      }, 
                        e(ArrowLeft, { size: 16 }),
                        lang === 'de' ? 'Zur√ºck' : lang === 'it' ? 'Indietro' : 'Back'
                      )
                    );
                  })()
                )
              ),
              
              // === GPS √úBERSICHT ===
              e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(Calculator, { size: 20, className: 'text-[#243186]' }),
                  lang === 'de' ? 'GPS-Vorschau (Selbsteinsch√§tzung)' : 'GPS Preview (Self-Assessment)'
                ),
                e('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
                  // WAS - zeige Prozent UND 5er-Skala
                  !noGoalsMode && e('div', { className: 'bg-blue-50 rounded-xl p-4 text-center' },
                    e('p', { className: 'text-xs text-blue-600 mb-1' }, 'WAS (50%)'),
                    e('p', { className: 'text-2xl font-bold text-[#243186]' }, gps.wasScore.toFixed(2)),
                    e('p', { className: 'text-xs text-blue-400' }, '(' + gps.wasScorePercent.toFixed(0) + '%)')
                  ),
                  // WIE Core
                  e('div', { className: 'bg-green-50 rounded-xl p-4 text-center' },
                    e('p', { className: 'text-xs text-green-600 mb-1' }, noGoalsMode ? 'WIE Kern (100%)' : isManager ? 'WIE Kern (25%)' : 'WIE Kern (50%)'),
                    e('p', { className: 'text-2xl font-bold text-green-700' }, gps.wieCoreScore.toFixed(2))
                  ),
                  // WIE Lead (nur wenn Manager)
                  isManager && e('div', { className: 'bg-purple-50 rounded-xl p-4 text-center' },
                    e('p', { className: 'text-xs text-purple-600 mb-1' }, noGoalsMode ? 'WIE F√ºhrung (50%)' : 'WIE F√ºhrung (25%)'),
                    e('p', { className: 'text-2xl font-bold text-purple-700' }, gps.wieLeadScore.toFixed(2))
                  ),
                  // Final GPS
                  e('div', { className: 'bg-[#243186] rounded-xl p-4 text-center text-white' },
                    e('p', { className: 'text-xs opacity-80 mb-1' }, 'GPS'),
                    e('p', { className: 'text-3xl font-bold' }, gps.finalGPS.toFixed(2))
                  )
                )
              ),
              
              // === ZIELE (Teil B) ===
              !noGoalsMode && goals.length > 0 && e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(Target, { size: 20, className: 'text-[#6EBD84]' }),
                  lang === 'de' ? 'Teil B: Zielvereinbarungen' : 'Part B: Goals'
                ),
                e('div', { className: 'space-y-3' },
                  goals.map((g, idx) => {
                    // achievement kann entweder Prozent (0-100+) oder 1-5 Skala sein
                    // Wenn > 5, ist es Prozent
                    const isPercent = g.achievement > 5;
                    // BARS-Stufe berechnen wenn Prozent
                    const barsScore = isPercent ? percentToBARS(g.achievement) : g.achievement;
                    const displayValue = isPercent ? g.achievement + '% ‚Üí ' + barsScore : g.achievement + '/5';
                    const barWidth = isPercent ? Math.min(g.achievement, 130) / 1.3 : (g.achievement / 5) * 100;
                    
                    return e('div', { key: idx, className: 'border border-slate-200 rounded-lg p-4' },
                      e('div', { className: 'flex justify-between items-start mb-2' },
                        e('div', { className: 'flex-1' },
                          e('p', { className: 'font-medium text-slate-800' }, g.name || `Ziel ${idx + 1}`),
                          e('p', { className: 'text-xs text-slate-500' }, `${lang === 'de' ? 'Gewichtung' : 'Peso'}: ${g.weight}%`)
                        ),
                        e('div', { className: `px-3 py-1 rounded-full text-sm font-bold ${getScoreColor(barsScore).light} ${getScoreColor(barsScore).text}` },
                          displayValue
                        )
                      ),
                      // Visueller Balken
                      e('div', { className: 'h-2 bg-slate-100 rounded-full overflow-hidden' },
                        e('div', { 
                          className: `h-full ${getScoreColor(barsScore).bg} rounded-full`,
                          style: { width: `${barWidth}%` }
                        })
                      )
                    );
                  })
                )
              ),
              
              // Info wenn keine Ziele
              noGoalsMode && e('div', { className: 'bg-amber-50 border border-amber-200 rounded-xl p-4' },
                e('p', { className: 'text-amber-800 text-sm flex items-center gap-2' },
                  e(AlertCircle, { size: 16 }),
                  lang === 'de' ? 'Keine Ziele vereinbart - GPS wird nur aus Kompetenzen berechnet.' : 'No goals - GPS is calculated from competencies only.'
                )
              ),
              
              // === KERNKOMPETENZEN (Teil C.1) ===
              e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(Award, { size: 20, className: 'text-[#6EBD84]' }),
                  lang === 'de' ? 'Teil C.1: Kernkompetenzen' : 'Part C.1: Core Competencies'
                ),
                e('div', { className: 'space-y-4' },
                  defs.core.map(comp => {
                    const score = coreScores[comp.id] || 0;
                    const comment = coreComments[comp.id] || '';
                    const colors = getScoreColor(score);
                    
                    return e('div', { key: comp.id, className: 'border border-slate-200 rounded-lg p-4' },
                      e('div', { className: 'flex items-center justify-between mb-2' },
                        e('span', { className: 'font-medium text-slate-800' }, comp.name),
                        e('span', { className: `px-3 py-1 rounded-full text-sm font-bold ${colors.light} ${colors.text}` },
                          score, ' ‚Äì ', barsLabels[lang]?.[score] || '‚Äì'
                        )
                      ),
                      e('div', { className: 'flex items-center gap-2 mb-2' },
                        e('div', { className: 'flex-1 h-2 bg-slate-100 rounded-full overflow-hidden' },
                          e('div', { className: `h-full ${colors.bg} rounded-full`, style: { width: `${(score / 5) * 100}%` } })
                        ),
                        e('span', { className: 'text-xs text-slate-400 w-8' }, `${score}/5`)
                      ),
                      comment && e('div', { className: 'mt-2 bg-slate-50 rounded p-2 text-sm text-slate-600 italic break-words overflow-hidden', style: { wordBreak: 'break-all', whiteSpace: 'pre-wrap' } },
                        '"', comment, '"'
                      )
                    );
                  })
                )
              ),
              
              // === F√úHRUNGSKOMPETENZEN (Teil C.2) - nur wenn Manager ===
              isManager && Object.keys(leaderScores).length > 0 && e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(Users, { size: 20, className: 'text-purple-600' }),
                  lang === 'de' ? 'Teil C.2: F√ºhrungskompetenzen' : 'Part C.2: Leadership Competencies'
                ),
                e('div', { className: 'space-y-4' },
                  defs.lead.map(comp => {
                    const score = leaderScores[comp.id] || 0;
                    const comment = leaderComments[comp.id] || '';
                    const colors = getScoreColor(score);
                    
                    return e('div', { key: comp.id, className: 'border border-purple-200 rounded-lg p-4 bg-purple-50/30' },
                      e('div', { className: 'flex items-center justify-between mb-2' },
                        e('span', { className: 'font-medium text-slate-800' }, comp.name),
                        e('span', { className: `px-3 py-1 rounded-full text-sm font-bold ${colors.light} ${colors.text}` },
                          score, ' ‚Äì ', barsLabels[lang]?.[score] || '‚Äì'
                        )
                      ),
                      e('div', { className: 'flex items-center gap-2 mb-2' },
                        e('div', { className: 'flex-1 h-2 bg-slate-100 rounded-full overflow-hidden' },
                          e('div', { className: `h-full ${colors.bg} rounded-full`, style: { width: `${(score / 5) * 100}%` } })
                        ),
                        e('span', { className: 'text-xs text-slate-400 w-8' }, `${score}/5`)
                      ),
                      comment && e('div', { className: 'mt-2 bg-white rounded p-2 text-sm text-slate-600 italic border border-purple-100 break-words overflow-hidden', style: { wordBreak: 'break-all', whiteSpace: 'pre-wrap' } },
                        '"', comment, '"'
                      )
                    );
                  })
                )
              ),
              
              // === TEIL D: ST√ÑRKEN & ENTWICKLUNG ===
              e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(FileText, { size: 20, className: 'text-slate-500' }),
                  lang === 'de' ? 'Teil D: St√§rken & Entwicklung' : 'Part D: Strengths & Development'
                ),
                e('div', { className: 'grid md:grid-cols-2 gap-4' },
                  // St√§rken
                  e('div', { className: 'space-y-3' },
                    e('h4', { className: 'font-medium text-green-700 flex items-center gap-2' },
                      e(Award, { size: 16 }),
                      lang === 'de' ? 'Meine St√§rken' : 'My Strengths'
                    ),
                    formData.strengths1 && e('div', { className: 'bg-green-50 rounded-lg p-3 text-sm text-slate-700', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', overflowWrap: 'break-word' } }, formData.strengths1),
                    formData.strengths2 && e('div', { className: 'bg-green-50 rounded-lg p-3 text-sm text-slate-700', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', overflowWrap: 'break-word' } }, formData.strengths2),
                    !formData.strengths1 && !formData.strengths2 && 
                      e('p', { className: 'text-slate-400 text-sm italic' }, lang === 'de' ? getText(lang, 'Keine Angabe', 'Non specificato', 'Not specified') : lang === 'it' ? 'Nessuna indicazione' : 'No data')
                  )
                )
              ),
              
              // === TEIL E: KARRIEREW√úNSCHE ===
              e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(TrendingUp, { size: 20, className: 'text-purple-600' }),
                  lang === 'de' ? 'Teil E: Karrierew√ºnsche' : lang === 'it' ? 'Parte E: Aspirazioni di carriera' : 'Part E: Career Aspirations'
                ),
                e('div', { className: 'flex flex-wrap gap-2 mb-4' },
                  careerLabels[lang].map((label, idx) => 
                    careerChecks[idx] && e('span', { key: idx, className: 'bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm' },
                      '‚úì ', label
                    )
                  )
                ),
                !careerChecks.some(c => c) && e('p', { className: 'text-slate-400 text-sm italic' }, 
                  lang === 'de' ? 'Keine Auswahl getroffen' : lang === 'it' ? 'Nessuna selezione' : 'No selection made'
                ),
                formData.careerComment && e('div', { className: 'mt-4 bg-purple-50 rounded-lg p-4' },
                  e('p', { className: 'text-sm font-medium text-purple-700 mb-1' }, lang === 'de' ? 'Kommentar:' : lang === 'it' ? 'Commento:' : 'Comment:'),
                  e('p', { className: 'text-slate-700', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', overflowWrap: 'break-word' } }, formData.careerComment)
                ),
                formData.wishesNextYear && e('div', { className: 'mt-4 bg-purple-50 rounded-lg p-4' },
                  e('p', { className: 'text-sm font-medium text-purple-700 mb-1' }, lang === 'de' ? 'W√ºnsche f√ºr das kommende Jahr:' : lang === 'it' ? 'Desideri per il prossimo anno:' : 'Wishes for next year:'),
                  e('p', { className: 'text-slate-700', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', overflowWrap: 'break-word' } }, formData.wishesNextYear)
                )
              ),
              
              // === TEIL F: FEEDBACK ===
              (formData.feedbackQ1 || formData.feedbackQ2 || formData.feedbackQ3 || formData.feedbackQ4 || formData.feedbackQ5 || formData.feedbackQ6) && 
              e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(MessageCircle, { size: 20, className: 'text-blue-600' }),
                  lang === 'de' ? 'Teil F: Feedback' : 'Part F: Feedback'
                ),
                e('div', { className: 'space-y-4' },
                  formData.feedbackQ1 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Was l√§uft gut in der Zusammenarbeit mit der FK?' : 'What works well with your manager?'),
                    e('p', { className: 'text-slate-700', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', overflowWrap: 'break-word' } }, formData.feedbackQ1)
                  ),
                  formData.feedbackQ2 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Was k√∂nnte verbessert werden?' : 'What could be improved?'),
                    e('p', { className: 'text-slate-700', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', overflowWrap: 'break-word' } }, formData.feedbackQ2)
                  ),
                  formData.feedbackQ3 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Wie zufrieden mit Informationsfluss?' : 'Information flow satisfaction?'),
                    e('p', { className: 'text-slate-700', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', overflowWrap: 'break-word' } }, formData.feedbackQ3)
                  ),
                  formData.feedbackQ4 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Wie zufrieden mit Unterst√ºtzung bei Weiterentwicklung?' : 'Development support satisfaction?'),
                    e('p', { className: 'text-slate-700', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', overflowWrap: 'break-word' } }, formData.feedbackQ4)
                  ),
                  formData.feedbackQ5 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Was w√ºnschen Sie sich von Ihrer FK?' : 'What do you expect from your manager?'),
                    e('p', { className: 'text-slate-700', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', overflowWrap: 'break-word' } }, formData.feedbackQ5)
                  ),
                  formData.feedbackQ6 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Sonstige Anmerkungen' : 'Other comments'),
                    e('p', { className: 'text-slate-700', style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', overflowWrap: 'break-word' } }, formData.feedbackQ6)
                  ),
                  formData.feedbackQ7 && e('div', { className: 'bg-blue-50 rounded-lg p-4 text-center' },
                    e('p', { className: 'text-xs text-blue-600 mb-2' }, lang === 'de' ? 'Work-Life-Balance' : lang === 'it' ? 'Equilibrio vita-lavoro' : 'Work-Life Balance'),
                    e('p', { className: 'text-3xl font-bold text-[#243186]' }, formData.feedbackQ7, '/5')
                  )
                )
              ),
              
              // === ZUR√úCK BUTTON ===
              e('div', { className: 'flex justify-center gap-3 pt-4' },
                // Pr√ºfe ob R√ºckkehr-Kontext existiert
                (() => {
                  const returnContext = safeLocalStorage.getItem('nw_return_to_appraisal', null);
                  const hasReturnContext = returnContext && (Date.now() - returnContext.timestamp) < 3600000;
                  
                  if (hasReturnContext) {
                    return e(React.Fragment, null,
                      // Zur√ºck zur Beurteilung (prominent)
                      e('button', {
                        onClick: () => {
                          localStorage.removeItem('nw_view_self_assessment');
                          const employeeId = returnContext.employeeId;
                          const period = returnContext.period;
                          const member = teamMembers.find(m => m.id === employeeId);
                          if (member) {
                            const existingReview = teamAppraisals.find(a => 
                              a.employeeId === employeeId && 
                              a.period === period && 
                              (a.type === 'review' || !a.type)
                            );
                            startTeamAppraisal(employeeId, period, existingReview);
                          }
                          localStorage.removeItem('nw_return_to_appraisal');
                        },
                        className: 'px-6 py-3 bg-[#6EBD84] hover:bg-[#5da872] rounded-2xl font-bold text-white flex items-center gap-2 transition-colors shadow-lg'
                      }, 
                        e(ArrowLeft, { size: 18 }),
                        lang === 'de' ? 'Zur√ºck zur Beurteilung' : lang === 'it' ? 'Torna alla valutazione' : 'Back to Appraisal'
                      ),
                      // Zur √úbersicht (sekund√§r)
                      e('button', {
                        onClick: () => {
                          localStorage.removeItem('nw_view_self_assessment');
                          localStorage.removeItem('nw_return_to_appraisal');
                          setActiveView('teamoverview');
                        },
                        className: 'px-6 py-3 bg-slate-100 hover:bg-slate-200 rounded-2xl font-semibold text-slate-700 flex items-center gap-2 transition-colors'
                      }, 
                        lang === 'de' ? 'Zur √úbersicht' : lang === 'it' ? 'Alla panoramica' : 'To Overview'
                      )
                    );
                  } else {
                    return e('button', {
                      onClick: () => {
                        localStorage.removeItem('nw_view_self_assessment');
                        localStorage.removeItem('nw_return_to_appraisal');
                        setActiveView('teamoverview');
                      },
                      className: 'px-6 py-3 bg-slate-100 hover:bg-slate-200 rounded-2xl font-semibold text-slate-700 flex items-center gap-2 transition-colors'
                    }, 
                      e(ArrowLeft, { size: 18 }),
                      lang === 'de' ? 'Zur√ºck zum Team' : lang === 'it' ? 'Torna al team' : 'Back to Team'
                    );
                  }
                })()
              )
            );
          };

          // === MAIN RENDER ===
          
          // Migrations-Ladebildschirm (zeigt an w√§hrend Daten importiert werden)
          if (migrationStatus === 'pending') {
            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center' },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-md text-center' },
                React.createElement('div', { className: 'w-16 h-16 rounded-full bg-[#E8F5ED] flex items-center justify-center mx-auto mb-6' },
                  React.createElement(Loader2, { className: 'w-8 h-8 animate-spin text-[#6EBD84]' })
                ),
                React.createElement('h2', { className: 'text-xl font-bold text-slate-800 mb-2' },
                  getText(lang, 'Daten werden importiert...', 'Importazione dati in corso...', 'Importing data...')
                ),
                React.createElement('p', { className: 'text-slate-500 text-sm' },
                  getText(lang, 
                    'Wir √ºbertragen Ihre lokalen Daten sicher in die Cloud. Dies dauert nur einen Moment.',
                    'Stiamo trasferendo i tuoi dati locali nel cloud in modo sicuro. Ci vorr√† solo un momento.',
                    'We are securely transferring your local data to the cloud. This will only take a moment.')
                ),
                React.createElement('div', { className: 'mt-6 flex items-center justify-center gap-2 text-xs text-slate-400' },
                  React.createElement('div', { className: 'w-2 h-2 rounded-full bg-[#6EBD84] animate-pulse' }),
                  React.createElement('span', null, getText(lang, 'Bitte warten...', 'Attendere prego...', 'Please wait...'))
                )
              )
            );
          }
          
          // Wenn Gast-Modus aktiv: Zeige nur die Gast-Ansicht (ohne Sidebar, ohne Login)
          if (guestMode) {
            // Loading State
            if (authLoading) {
              return React.createElement('div', { className: 'min-h-screen bg-slate-100 flex items-center justify-center' },
                React.createElement('div', { className: 'text-center' },
                  React.createElement(Loader2, { className: 'w-12 h-12 animate-spin text-[#6EBD84] mx-auto mb-4' }),
                  React.createElement('p', { className: 'text-slate-500' }, getText(lang, 'Laden...', 'Caricamento...', 'Loading...'))
                )
              );
            }
            
            // Gast-Willkommensseite
            if (activeView === 'guestWelcome') {
              return renderGuestWelcome();
            }
            
            // Gast-Formular (Selbstreflexion) - Verwendet MySelfReflectionComponent
            // mit einem "virtuellen User" basierend auf guestEmployee
            if (activeView === 'guestForm') {
              // Erstelle einen virtuellen User-Kontext f√ºr das Formular
              const virtualUser = {
                uid: `guest_${guestEmployee.id}`,
                email: guestEmployee.email || '',
                displayName: guestEmployee.name,
                isGuest: true,
                guestEmployeeId: guestEmployee.id,
                guestManagerId: guestEmployee.userId // userId der FK
              };
              
              return React.createElement('div', { className: 'min-h-screen bg-slate-100' },
                // Header mit Zur√ºck-Button
                React.createElement('div', { 
                  className: 'bg-white border-b border-slate-200 px-4 py-3 flex items-center justify-between sticky top-0 z-40 no-print'
                },
                  React.createElement('button', {
                    onClick: () => setActiveView('guestWelcome'),
                    className: 'flex items-center gap-2 text-slate-600 hover:text-slate-800 transition-colors'
                  },
                    React.createElement(ArrowLeft, { size: 20 }),
                    lang === 'de' ? 'Zur√ºck' : lang === 'it' ? 'Indietro' : 'Back'
                  ),
                  React.createElement('div', { className: 'text-center' },
                    React.createElement('span', { className: 'font-semibold text-[#243186]' }, guestEmployee.name),
                    React.createElement('span', { className: 'text-slate-400 mx-2' }, '‚Ä¢'),
                    React.createElement('span', { className: 'text-slate-500 text-sm' }, 
                      lang === 'de' ? 'Selbstreflexion' : lang === 'it' ? 'Autovalutazione' : 'Self-Reflection'
                    )
                  ),
                  React.createElement('div', { className: 'w-20' }) // Spacer f√ºr Zentrierung
                ),
                // Das vollst√§ndige Selbstreflexions-Formular
                React.createElement(MySelfReflectionComponent, { 
                  lang: lang, 
                  user: virtualUser,
                  guestEmployee: guestEmployee,
                  isGuestMode: true,
                  onComplete: () => {
                    // Nach Abschluss: Erfolgsanzeige und Reset
                    setGuestFormSubmitted(true);
                    setActiveView('guestWelcome');
                  }
                })
              );
            }
            
            // Fallback f√ºr unbekannte Gast-Views
            return React.createElement('div', { className: 'min-h-screen bg-slate-100 flex items-center justify-center p-4' },
              React.createElement('div', { className: 'bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 p-8 text-center max-w-md' },
                React.createElement(AlertCircle, { size: 48, className: 'text-amber-500 mx-auto mb-4' }),
                React.createElement('h2', { className: 'text-xl font-bold text-slate-800 mb-2' },
                  lang === 'de' ? 'Seite nicht gefunden' : lang === 'it' ? 'Pagina non trovata' : 'Page Not Found'
                ),
                React.createElement('button', {
                  onClick: () => setActiveView('guestWelcome'),
                  className: 'mt-4 px-6 py-2 bg-[#6EBD84] text-white rounded-2xl hover:bg-[#5da872] transition-colors'
                }, lang === 'de' ? 'Zur√ºck zum Start' : lang === 'it' ? 'Torna all\'inizio' : 'Back to Start')
              )
            );
          }

          // === LOADING SCREEN (w√§hrend Auth oder AccessCode-Check l√§uft) - APPLE STYLE ===
          if (authLoading || accessCodeChecking) {
            return React.createElement('div', { 
              className: 'min-h-screen bg-white flex items-center justify-center'
            },
              React.createElement('div', { className: 'text-center' },
                // Pulsierendes Logo
                React.createElement('div', { 
                  className: 'w-20 h-20 mx-auto mb-8 rounded-3xl bg-gradient-to-br from-[#243186] to-[#1a2460] flex items-center justify-center shadow-2xl shadow-[#243186]/30 animate-pulse'
                },
                  React.createElement('span', { className: 'text-white font-bold text-2xl' }, 'N')
                ),
                React.createElement('h1', { className: "text-[#243186] font-semibold text-xl tracking-tight mb-1" }, "nƒ±ederwƒ±eser"),
                React.createElement('p', { className: "text-xs uppercase tracking-[0.2em] text-[#6EBD84] font-medium" }, "Performance Manager"),
                // Minimale Lade-Punkte
                React.createElement('div', { className: 'flex items-center justify-center gap-1.5 mt-8' },
                  [0, 1, 2].map(i => React.createElement('div', {
                    key: i,
                    className: 'w-2 h-2 rounded-full bg-slate-300 animate-bounce',
                    style: { animationDelay: `${i * 0.15}s` }
                  }))
                )
              )
            );
          }

          return React.createElement('div', { className: "min-h-screen bg-slate-100 font-sans text-slate-900 flex flex-col md:flex-row" },
            
            // === IMPORT SELF-ASSESSMENT MODAL ===
            showImportModal && importData && React.createElement('div', { 
              className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
              onClick: (ev) => ev.target === ev.currentTarget && !importStatus && setShowImportModal(false)
            },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden' },
                // Header
                React.createElement('div', { className: 'p-6 border-b border-slate-200', style: { backgroundColor: '#243186' } },
                  React.createElement('h2', { className: 'text-2xl font-bold text-white flex items-center gap-3' },
                    React.createElement(Upload, { size: 28 }),
                    lang === 'de' ? 'Selbstreflexion importieren' : lang === 'it' ? 'Importa autovalutazione' : 'Import Self-Assessment'
                  )
                ),
                
                // Content
                importStatus === 'success' 
                  ? React.createElement('div', { className: 'p-8 text-center' },
                      React.createElement('div', { className: 'w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center', style: { backgroundColor: '#6EBD84' } },
                        React.createElement(CheckCircle2, { size: 40, className: 'text-white' })
                      ),
                      React.createElement('h3', { className: 'text-xl font-bold text-slate-800 mb-2' },
                        lang === 'de' ? 'Import erfolgreich!' : lang === 'it' ? 'Importazione riuscita!' : 'Import successful!'
                      ),
                      React.createElement('p', { className: 'text-slate-600' },
                        lang === 'de' 
                          ? `${importData.n} wurde zu Ihrem Team hinzugef√ºgt.`
                          : lang === 'it'
                          ? `${importData.n} √® stato aggiunto al tuo team.`
                          : `${importData.n} has been added to your team.`
                      )
                    )
                  : importStatus === 'error'
                  ? React.createElement('div', { className: 'p-8 text-center' },
                      React.createElement('div', { className: 'w-20 h-20 rounded-full bg-red-100 mx-auto mb-4 flex items-center justify-center' },
                        React.createElement(AlertCircle, { size: 40, className: 'text-red-600' })
                      ),
                      React.createElement('h3', { className: 'text-xl font-bold text-slate-800 mb-2' },
                        lang === 'de' ? 'Fehler beim Import' : lang === 'it' ? 'Errore durante l\'importazione' : 'Import error'
                      ),
                      React.createElement('p', { className: 'text-slate-600 mb-4' },
                        lang === 'de' 
                          ? 'Bitte versuchen Sie es erneut oder wenden Sie sich an den Support.'
                          : lang === 'it'
                          ? 'Riprova o contatta il supporto.'
                          : 'Please try again or contact support.'
                      ),
                      React.createElement('button', {
                        onClick: () => { setImportStatus(null); },
                        className: 'px-6 py-2 rounded-xl font-medium text-white', 
                        style: { backgroundColor: '#243186' }
                      }, lang === 'de' ? 'Erneut versuchen' : lang === 'it' ? 'Riprova' : 'Try again')
                    )
                  : React.createElement('div', { className: 'p-6 space-y-5' },
                      // Preview der Daten
                      React.createElement('div', { className: 'bg-slate-50 rounded-xl p-5' },
                        React.createElement('h4', { className: 'font-bold text-slate-800 mb-3 flex items-center gap-2' },
                          React.createElement(User, { size: 18 }),
                          lang === 'de' ? 'Mitarbeiterdaten:' : lang === 'it' ? 'Dati del dipendente:' : 'Employee data:'
                        ),
                        React.createElement('div', { className: 'space-y-2' },
                          React.createElement('div', { className: 'flex justify-between' },
                            React.createElement('span', { className: 'text-slate-500' }, lang === 'de' ? 'Name:' : lang === 'it' ? 'Nome:' : 'Name:'),
                            React.createElement('span', { className: 'font-semibold text-slate-800' }, importData.n || '‚Äì')
                          ),
                          React.createElement('div', { className: 'flex justify-between' },
                            React.createElement('span', { className: 'text-slate-500' }, lang === 'de' ? 'Position:' : lang === 'it' ? 'Posizione:' : 'Position:'),
                            React.createElement('span', { className: 'font-medium text-slate-700' }, importData.p || '‚Äì')
                          ),
                          importData.e && React.createElement('div', { className: 'flex justify-between' },
                            React.createElement('span', { className: 'text-slate-500' }, 'Email:'),
                            React.createElement('span', { className: 'font-medium text-slate-700' }, importData.e)
                          ),
                          React.createElement('div', { className: 'flex justify-between' },
                            React.createElement('span', { className: 'text-slate-500' }, lang === 'de' ? 'Ziele:' : lang === 'it' ? 'Obiettivi:' : 'Goals:'),
                            React.createElement('span', { className: 'font-medium text-slate-700' }, (importData.g?.length || 0) + ' ' + (lang === 'de' ? 'definiert' : lang === 'it' ? 'definiti' : 'defined'))
                          ),
                          React.createElement('div', { className: 'flex justify-between' },
                            React.createElement('span', { className: 'text-slate-500' }, lang === 'de' ? 'F√ºhrungskraft:' : lang === 'it' ? 'Manager:' : 'Manager:'),
                            React.createElement('span', { className: 'font-medium text-slate-700' }, importData.im ? '‚úì' : '‚Äì')
                          )
                        )
                      ),
                      
                      // Info
                      React.createElement('div', { className: 'flex items-start gap-3 text-sm' },
                        React.createElement(Info, { size: 18, className: 'flex-shrink-0 mt-0.5 text-blue-500' }),
                        React.createElement('p', { className: 'text-slate-600' },
                          lang === 'de' 
                            ? 'Beim Import wird der Mitarbeiter automatisch zu Ihrem Team hinzugef√ºgt und die Selbstreflexion wird mit dessen Profil verkn√ºpft.'
                            : lang === 'it'
                            ? 'Durante l\'importazione, il dipendente viene aggiunto automaticamente al tuo team e l\'autovalutazione viene collegata al suo profilo.'
                            : 'During import, the employee will be automatically added to your team and the self-assessment will be linked to their profile.'
                        )
                      ),
                      
                      // Hinweis falls nicht eingeloggt
                      !user && React.createElement('div', { className: 'bg-amber-50 border border-amber-200 rounded-xl p-4' },
                        React.createElement('p', { className: 'text-amber-800 text-sm font-medium' },
                          '‚ö†Ô∏è ' + (lang === 'de' 
                            ? 'Bitte melden Sie sich zuerst an, um die Selbstreflexion zu importieren.'
                            : lang === 'it'
                            ? 'Accedi prima per importare l\'autovalutazione.'
                            : 'Please log in first to import the self-assessment.')
                        )
                      )
                    ),
                
                // Footer
                !importStatus && React.createElement('div', { className: 'p-6 border-t border-slate-200 bg-slate-50 flex gap-3' },
                  React.createElement('button', {
                    onClick: () => { setShowImportModal(false); setImportData(null); },
                    className: 'flex-1 py-3 rounded-xl font-medium text-slate-600 bg-white border border-slate-300 hover:bg-slate-100 transition-colors'
                  }, lang === 'de' ? 'Abbrechen' : lang === 'it' ? 'Annulla' : 'Cancel'),
                  React.createElement('button', {
                    onClick: importSelfAssessment,
                    disabled: !user,
                    className: 'flex-1 py-3 rounded-xl font-bold text-white transition-colors flex items-center justify-center gap-2 disabled:opacity-50',
                    style: { backgroundColor: '#6EBD84' }
                  }, 
                    React.createElement(CheckCircle2, { size: 18 }),
                    lang === 'de' ? 'Importieren' : lang === 'it' ? 'Importa' : 'Import'
                  )
                )
              )
            ),
            
            // === PENDING SELF-ASSESSMENTS MODAL (beim Login der FK) ===
            showPendingModal && pendingSelfAssessments.length > 0 && React.createElement('div', { 
              className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4'
            },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden' },
                // Header
                React.createElement('div', { className: 'p-6 border-b border-slate-200', style: { backgroundColor: '#6EBD84' } },
                  React.createElement('h2', { className: 'text-2xl font-bold text-white flex items-center gap-3' },
                    React.createElement(Sparkles, { size: 28 }),
                    lang === 'de' ? 'Neue Selbstreflexionen!' : lang === 'it' ? 'Nuove autovalutazioni!' : 'New Self-Assessments!'
                  )
                ),
                
                // Content
                React.createElement('div', { className: 'p-6 space-y-5' },
                  // Info
                  React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 flex items-start gap-3' },
                    React.createElement(Info, { size: 24, className: 'text-blue-600 flex-shrink-0 mt-0.5' }),
                    React.createElement('div', null,
                      React.createElement('p', { className: 'font-semibold text-blue-800' }, 
                        lang === 'de' 
                          ? `${pendingSelfAssessments.length} Mitarbeiter ${pendingSelfAssessments.length === 1 ? 'hat' : 'haben'} eine Selbstreflexion f√ºr Sie eingereicht!`
                          : lang === 'it'
                          ? `${pendingSelfAssessments.length} collaborator${pendingSelfAssessments.length === 1 ? 'e ha' : 'i hanno'} inviato un'autovalutazione per Lei!`
                          : `${pendingSelfAssessments.length} employee${pendingSelfAssessments.length === 1 ? ' has' : 's have'} submitted a self-assessment for you!`
                      ),
                      React.createElement('p', { className: 'text-sm text-blue-700 mt-1' },
                        lang === 'de' 
                          ? 'Diese Mitarbeiter haben Ihre E-Mail-Adresse angegeben.'
                          : lang === 'it'
                          ? 'Questi collaboratori hanno indicato il tuo indirizzo e-mail.'
                          : 'These employees have provided your email address.'
                      )
                    )
                  ),
                  
                  // Liste der wartenden Selbstreflexionen
                  React.createElement('div', { className: 'space-y-3 max-h-60 overflow-y-auto' },
                    pendingSelfAssessments.map((pending, index) => 
                      React.createElement('div', { 
                        key: pending.id || index, 
                        className: 'bg-slate-50 rounded-xl p-4 flex items-center justify-between'
                      },
                        React.createElement('div', null,
                          React.createElement('p', { className: 'font-semibold text-slate-800' }, 
                            pending.employeeName || pending.formData?.employee || 'Unbekannt'
                          ),
                          React.createElement('p', { className: 'text-sm text-slate-500' }, 
                            pending.formData?.position || '‚Äì'
                          )
                        ),
                        React.createElement('div', { className: 'text-right' },
                          React.createElement('span', { className: 'px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium' },
                            pending.period || new Date().getFullYear()
                          )
                        )
                      )
                    )
                  ),
                  
                  // Erkl√§rung
                  React.createElement('p', { className: 'text-sm text-slate-600' },
                    lang === 'de' 
                      ? 'Beim √úbernehmen werden die Mitarbeiter automatisch zu Ihrem Team hinzugef√ºgt und die Selbstreflexionen verkn√ºpft.'
                      : lang === 'it'
                      ? 'Durante l\'importazione, i collaboratori vengono aggiunti automaticamente al tuo team e le autovalutazioni collegate.'
                      : 'When claiming, the employees will be automatically added to your team and the self-assessments linked.'
                  )
                ),
                
                // Footer
                React.createElement('div', { className: 'p-6 border-t border-slate-200 bg-slate-50 flex gap-3' },
                  React.createElement('button', {
                    onClick: () => { setShowPendingModal(false); setPendingSelfAssessments([]); },
                    className: 'flex-1 py-3 rounded-xl font-medium text-slate-600 bg-white border border-slate-300 hover:bg-slate-100 transition-colors'
                  }, lang === 'de' ? 'Sp√§ter' : lang === 'it' ? 'Pi√π tardi' : 'Later'),
                  React.createElement('button', {
                    onClick: claimPendingSelfAssessments,
                    disabled: claimingPending,
                    className: 'flex-1 py-3 rounded-xl font-bold text-white transition-colors flex items-center justify-center gap-2 disabled:opacity-50',
                    style: { backgroundColor: '#6EBD84' }
                  }, 
                    claimingPending ? React.createElement(Loader2, { size: 18, className: 'animate-spin' }) : React.createElement(CheckCircle2, { size: 18 }),
                    claimingPending 
                      ? (lang === 'de' ? 'Wird √ºbernommen...' : lang === 'it' ? 'Importazione...' : 'Claiming...')
                      : (lang === 'de' ? 'Alle √ºbernehmen' : lang === 'it' ? 'Importa tutti' : 'Claim All')
                  )
                )
              )
            ),
            
            React.createElement('aside', { className: "bg-[#243186] text-slate-300 w-full md:w-64 flex-shrink-0 flex flex-col" }, // Sidebar background
              React.createElement('div', { className: "p-6 border-b border-slate-800" },
                React.createElement('h1', { className: "text-white font-bold text-xl tracking-tight" }, "nƒ±ederwƒ±eser"),
                // Akzentfarbe ge√§ndert auf #6EBD84
                React.createElement('p', { className: "text-xs mt-1 uppercase tracking-widest", style: { color: "#6EBD84" } }, t.title)
              ),
              React.createElement('nav', { className: "flex-1 p-4 space-y-2" },
                React.createElement('div', { className: "mb-6 px-2" },
                    // Sprachauswahl modern
                    React.createElement('div', { className: "bg-slate-800/50 backdrop-blur rounded-xl p-1.5 border border-slate-700/50" },
                        React.createElement('div', { className: "flex gap-1" },
                            React.createElement('button', {
                                onClick: () => setLang('de'),
                                className: `flex-1 py-2.5 rounded-lg text-xs font-semibold tracking-wide transition-all duration-300 ${lang === 'de' ? 'bg-gradient-to-r from-[#6EBD84] to-[#5da872] text-white shadow-lg shadow-[#6EBD84]/30' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`
                            }, "DE"),
                            React.createElement('button', {
                                onClick: () => setLang('it'),
                                className: `flex-1 py-2.5 rounded-lg text-xs font-semibold tracking-wide transition-all duration-300 ${lang === 'it' ? 'bg-gradient-to-r from-[#6EBD84] to-[#5da872] text-white shadow-lg shadow-[#6EBD84]/30' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`
                            }, "IT"),
                            React.createElement('button', {
                                onClick: () => setLang('en'),
                                className: `flex-1 py-2.5 rounded-lg text-xs font-semibold tracking-wide transition-all duration-300 ${lang === 'en' ? 'bg-gradient-to-r from-[#6EBD84] to-[#5da872] text-white shadow-lg shadow-[#6EBD84]/30' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`
                            }, "EN")
                        )
                    ),
                    React.createElement('p', { className: "text-[10px] mt-2 text-center uppercase tracking-widest", style: { color: '#6EBD84' } },
                        'Select Language'
                    )
                ),
                // Navigations-Buttons mit Akzentfarbe - OHNE Icons, wei√üe Schrift
                React.createElement('button', {
                  onClick: () => { setActiveView('dashboard'); setActiveScore(3); },
                  className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'dashboard' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                }, t.dashboard),
                React.createElement('button', {
                  onClick: () => { setActiveView('guide'); },
                  className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'guide' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                }, lang === 'de' ? 'Anleitung' : lang === 'it' ? 'Guida' : 'Guide'),
                React.createElement('button', {
                  onClick: () => { setActiveView('list'); setActiveScore(3); },
                  className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'list' || activeView === 'detail' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                }, t.competencies),
                React.createElement('button', {
                  onClick: () => { setActiveView('gpsexplainer'); setActiveScore(3); },
                  className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'gpsexplainer' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                }, t.gpsExplainer),
                
                // === SECTION: F√úR MICH ===
                React.createElement('div', { className: 'mt-4 pt-4 border-t border-slate-700' },
                  React.createElement('p', { className: 'text-xs px-4 mb-2 uppercase tracking-wider text-slate-400' }, 
                    getText(lang, 'F√ºr mich', 'Per me', 'For me')
                  ),
                  React.createElement('button', {
                    onClick: () => { setActiveView('mySelfReflection'); },
                    className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'mySelfReflection' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                  }, getText(lang, 'Meine Selbstreflexion', 'La mia autovalutazione', 'My Self-Reflection'))
                ),
                
                // === SECTION: TEAM ===
                React.createElement('div', { className: 'mt-4 pt-4 border-t border-slate-700' },
                  React.createElement('p', { className: 'text-xs px-4 mb-2 uppercase tracking-wider text-slate-400' }, 
                    getText(lang, 'Team', 'Team', 'Team')
                  ),
                  React.createElement('button', {
                    onClick: () => { setActiveView('teamoverview'); setActiveScore(3); },
                    className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'teamoverview' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                  }, getText(lang, 'Team-√úbersicht', 'Panoramica team', 'Team Overview')),
                  // Team-Kalibrierung (nur wenn Team vorhanden)
                  teamMembers.length > 0 && React.createElement('button', {
                    onClick: () => { setActiveView('teamcalibration'); setActiveScore(3); },
                    className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'teamcalibration' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                  }, getText(lang, 'Kalibrierung', 'Calibrazione', 'Calibration'))
                ),
                
                // HR ADMIN Men√ºpunkt (nur f√ºr HR-Admins sichtbar)
                isHRAdmin && React.createElement('div', { className: 'mt-4 pt-4 border-t border-slate-700' },
                  React.createElement('p', { className: 'text-xs px-4 mb-2 uppercase tracking-wider', style: { color: '#6EBD84' } }, 'HR Admin'),
                  React.createElement('button', {
                    onClick: () => { setActiveView('hrdashboard'); },
                    className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'hrdashboard' ? 'bg-purple-600 text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                  }, 'HR Dashboard')
                ),
                
                // SALARY REVIEW Men√ºpunkt (f√ºr HR-Admins, Executives und eingeladene Manager mit entsprechendem Zugriff)
                (isHRAdmin || (salaryReviewUserRole && (salaryReviewUserRole.accessSalary || salaryReviewUserRole.accessGoals))) && React.createElement('div', { className: isHRAdmin ? '' : 'mt-4 pt-4 border-t border-slate-700' },
                  !isHRAdmin && React.createElement('p', { className: 'text-xs px-4 mb-2 uppercase tracking-wider', style: { color: '#059669' } }, 
                    salaryReviewUserRole?.role === 'executive' ? 'Executive Access' : 'Manager Access'
                  ),
                  // Salary Review Button - nur wenn accessSalary true
                  (isHRAdmin || salaryReviewUserRole?.accessSalary) && React.createElement('button', {
                    onClick: () => { setActiveView('salaryreview'); },
                    className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'salaryreview' ? 'bg-emerald-600 text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                  }, 'Salary Review'),
                  // Goals Dashboard Button - nur wenn accessGoals true
                  (isHRAdmin || salaryReviewUserRole?.accessGoals) && React.createElement('button', {
                    onClick: () => { setActiveView('goalsdashboard'); },
                    className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'goalsdashboard' ? 'bg-blue-600 text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                  }, lang === 'de' ? 'Ziel-Dashboard' : lang === 'it' ? 'Dashboard Obiettivi' : 'Goals Dashboard')
                )
              )
            ),
            React.createElement('main', { className: "flex-1 overflow-y-auto h-screen p-4 md:p-6 md:pb-20" },
              React.createElement('div', { className: (activeView === 'hrdashboard' || activeView === 'salaryreview' || activeView === 'goalsdashboard') ? "w-full" : "max-w-4xl mx-auto" },
                activeView === 'dashboard' && renderDashboard(),
                activeView === 'guide' && renderGuide(),
                activeView === 'list' && renderCompetencyList(),
                activeView === 'detail' && renderDetailView(),
                activeView === 'gpsexplainer' && renderGPSExplainer(),
                activeView === 'mySelfReflection' && React.createElement(MySelfReflectionComponent, { lang: lang, user: user }),
                activeView === 'zielvereinbarung' && React.createElement(Zielvereinbarung, { key: JSON.stringify(safeLocalStorage.getItem('nw_current_employee', 'default')), lang: lang, onSaveTeam: saveTeamAppraisal, onCancel: () => setActiveView(isHRAdmin ? 'hrdashboard' : 'teamoverview') }),
                activeView === 'teamoverview' && renderTeamOverview(),
                activeView === 'viewSelfAssessment' && renderViewSelfAssessment(),
                activeView === 'formular' && React.createElement(AppraisalForm, { key: JSON.stringify(safeLocalStorage.getItem('nw_current_employee', 'default')), lang: lang, onSaveTeam: saveTeamAppraisal, onCancel: () => { safeLocalStorage.removeItem('nw_hr_edit_appraisal_id'); setActiveView(isHRAdmin ? 'hrdashboard' : 'teamoverview'); }, db: db, setActiveView: setActiveView }),
                activeView === 'teamcalibration' && renderTeamCalibration(),
                activeView === 'hrdashboard' && isHRAdmin && renderHRDashboard(),
                activeView === 'salaryreview' && (isHRAdmin || salaryReviewUserRole?.accessSalary) && renderSalaryReviewModule(),
                activeView === 'goalsdashboard' && (isHRAdmin || salaryReviewUserRole?.accessGoals) && renderGoalsDashboardModule()
              )
            ),
            // HelpChat - Smart HR Assistant (nur f√ºr eingeloggte User)
            React.createElement(HelpChat, { 
              lang: lang, 
              setActiveView: setActiveView, 
              activeView: activeView,
              setSelectedCompetencyId: setSelectedCompetencyId 
            }),
            // Debug Panel & Button
            // Debug Panel removed for production
          );
        }

        // --- RENDER APP ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(ErrorBoundary, null, React.createElement(PerformanceApp)));
    </script>
</body>
</html>
