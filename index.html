<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niederwieser Performance Manager</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'in': 'fade-in 0.3s ease-out',
                        'out': 'fade-out 0.3s ease-out',
                    },
                    keyframes: {
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        'fade-out': {
                            '0%': { opacity: '1', transform: 'translateY(0)' },
                            '100%': { opacity: '0', transform: 'translateY(10px)' },
                        }
                    }
                }
            }
        };
    </script>

    <style>
        body { -webkit-font-smoothing: antialiased; }
        /* Custom Scrollbar for better visibility */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        /* Zus√§tzliche Flex-Anpassung f√ºr die gleich hohe Spalte */
        .equal-height-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem; /* 6 */
            align-items: stretch;
        }
        
        /* PDF Print Styles */
        @media print {
            .no-print { display: none !important; visibility: hidden !important; height: 0 !important; overflow: hidden !important; }
            .break-inside-avoid { page-break-inside: avoid; break-inside: avoid; }
            body { background: white !important; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
        
        /* === KRITISCH: no-print Elemente auch ohne print-media ausblenden f√ºr html2pdf === */
        .pdf-export-mode .no-print,
        .pdf-render-container .no-print,
        [data-pdf-export="true"] .no-print {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            width: 0 !important;
            overflow: hidden !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        /* PDF Mode Styles - Optimiert f√ºr html2pdf mit langen Texten */
        .pdf-mode {
            background: white !important;
            max-width: 190mm !important;
            margin: 0 auto !important;
            padding: 10mm !important;
        }
        .pdf-mode * {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        .pdf-mode .no-print { 
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
        }
        .pdf-mode .pdf-only { 
            display: block !important; 
        }
        .pdf-only { 
            display: none; 
        }
        .pdf-mode .break-inside-avoid { 
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        /* === KRITISCH: Mehrzeilige Texte im PDF korrekt umbrechen === */
        .pdf-mode td,
        .pdf-mode th {
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
            word-break: break-word !important;
            overflow-wrap: break-word !important;
            max-width: 300px !important;
        }
        .pdf-mode p,
        .pdf-mode span,
        .pdf-mode div {
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
        }
        
        /* === KRITISCH: Robuste Seitenumbr√ºche f√ºr arbeitsrechtliche Dokumente === */
        .pdf-mode .pdf-section {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
            max-height: 250mm; /* Sicherheitslimit pro Sektion */
            overflow: visible !important;
        }
        .pdf-mode .pdf-text-block {
            page-break-inside: auto !important; /* Lange Texte d√ºrfen umbrechen */
            break-inside: auto !important;
            orphans: 3; /* Min 3 Zeilen vor Umbruch */
            widows: 3; /* Min 3 Zeilen nach Umbruch */
        }
        .pdf-mode .pdf-keep-together {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        /* Remove backgrounds and shadows */
        .pdf-mode [class*="bg-slate"],
        .pdf-mode [class*="bg-blue"],
        .pdf-mode [class*="bg-purple"],
        .pdf-mode [class*="bg-indigo"] {
            background: transparent !important;
        }
        .pdf-mode [class*="shadow"] {
            box-shadow: none !important;
        }
        .pdf-mode [class*="rounded"] {
            border-radius: 4px !important;
        }
        
        /* Table styles */
        .pdf-mode table {
            border-collapse: collapse !important;
            width: 100% !important;
            margin: 8px 0 !important;
        }
        .pdf-mode th {
            background-color: #f8fafc !important;
            font-weight: 700 !important;
            font-size: 11px !important;
            padding: 6px 4px !important;
            border: 1px solid #cbd5e1 !important;
            text-align: left !important;
        }
        .pdf-mode td {
            padding: 6px 4px !important;
            border: 1px solid #cbd5e1 !important;
            font-size: 10px !important;
            vertical-align: top !important; /* Top statt middle f√ºr lange Texte */
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            max-width: 300px; /* Verhindert √ºberlange Zellen */
        }
        .pdf-mode tbody tr {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        /* Lange Textfelder in Tabellen d√ºrfen umbrechen */
        .pdf-mode td.pdf-text-cell {
            page-break-inside: auto !important;
            break-inside: auto !important;
        }
        
        /* Headers and spacing */
        .pdf-mode h1 { font-size: 24px !important; margin-bottom: 4px !important; }
        .pdf-mode h2 { font-size: 18px !important; margin-bottom: 8px !important; page-break-after: avoid !important; }
        .pdf-mode h3 { font-size: 14px !important; margin-bottom: 6px !important; page-break-after: avoid !important; }
        .pdf-mode h4 { font-size: 12px !important; margin-bottom: 4px !important; }
        .pdf-mode p { font-size: 11px !important; line-height: 1.4 !important; }
        .pdf-mode label { font-size: 10px !important; }
        
        /* Section spacing */
        .pdf-mode > div {
            margin-bottom: 12px !important;
            padding: 8px !important;
            border: 1px solid #e2e8f0 !important;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-900">
    
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            BookOpen, Users, Target, Award, ChevronRight, 
            X, Zap, Heart, Scale, Brain, TrendingUp, Clock, MessageCircle, 
            Briefcase, Lightbulb, ShieldAlert, CheckCircle2, AlertCircle,
            ClipboardList, CalendarCheck, Calculator, Info, RotateCcw, Trophy, PlusCircle, XCircle,
            Download, Loader2, Trash2, FileText, Edit2, Edit3, Eye, UserPlus, Play, LogOut, Mail, Lock, Link, Save,
            Building2, ArrowLeft, RefreshCw, Calendar, User, HelpCircle, Send, Sparkles, Copy, Circle, Share2, Users2,
            Upload, FileUp
        } from 'https://esm.sh/lucide-react@0.292.0';

        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyCxQ9qLHls7RAUWmOkOSAg1E9-wzfRIAYc",
            authDomain: "performance-manager-b0967.firebaseapp.com",
            projectId: "performance-manager-b0967",
            storageBucket: "performance-manager-b0967.firebasestorage.app",
            messagingSenderId: "191493540566",
            appId: "1:191493540566:web:a64b78148c01a8fc089777",
            measurementId: "G-BHVYQBQR9C"
        };

        // Firebase initialisieren
        let firebaseApp = null;
        let auth = null;
        let db = null;
        let storage = null;  // Global f√ºr Storage
        
        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            storage = firebase.storage();  // Firebase Storage f√ºr gro√üe Dateien (PDFs)
            console.log("Firebase erfolgreich initialisiert (inkl. Storage)");
        } catch (error) {
            console.error("Firebase Initialisierungsfehler:", error);
        }

        // ============================================
        // HR ADMIN CONFIGURATION
        // ============================================
        const HR_ADMIN_EMAILS = ['d.andrisani@niederwiesergroup.com'];
        const isUserHRAdmin = (email) => email && HR_ADMIN_EMAILS.includes(email.toLowerCase());

        // ============================================
        // LOGIN VIEW COMPONENT
        // ============================================
        const LoginView = ({ lang, onLoginSuccess }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const t = {
                de: {
                    loginTitle: 'Anmelden',
                    registerTitle: 'Registrieren',
                    email: 'E-Mail-Adresse',
                    password: 'Passwort',
                    confirmPassword: 'Passwort best√§tigen',
                    loginBtn: 'Anmelden',
                    registerBtn: 'Registrieren',
                    noAccount: 'Noch kein Konto?',
                    hasAccount: 'Bereits ein Konto?',
                    registerLink: 'Jetzt registrieren',
                    loginLink: 'Jetzt anmelden',
                    teamAccess: 'Team-Zugang',
                    teamDesc: 'Melden Sie sich an, um Ihr Team zu verwalten und Performance Reviews durchzuf√ºhren.',
                    passwordMismatch: 'Passw√∂rter stimmen nicht √ºberein',
                    errorAuth: 'Authentifizierungsfehler. Bitte √ºberpr√ºfen Sie Ihre Eingaben.',
                    errorEmail: 'E-Mail-Adresse bereits registriert',
                    errorWeak: 'Passwort zu schwach (min. 6 Zeichen)',
                    errorInvalid: 'Ung√ºltige E-Mail oder falsches Passwort'
                },
                it: {
                    loginTitle: 'Accedi',
                    registerTitle: 'Registrati',
                    email: 'Indirizzo email',
                    password: 'Password',
                    confirmPassword: 'Conferma password',
                    loginBtn: 'Accedi',
                    registerBtn: 'Registrati',
                    noAccount: 'Non hai un account?',
                    hasAccount: 'Hai gi√† un account?',
                    registerLink: 'Registrati ora',
                    loginLink: 'Accedi ora',
                    teamAccess: 'Accesso Team',
                    teamDesc: 'Accedi per gestire il tuo team e condurre Performance Reviews.',
                    passwordMismatch: 'Le password non corrispondono',
                    errorAuth: 'Errore di autenticazione. Verifica i tuoi dati.',
                    errorEmail: 'Email gi√† registrata',
                    errorWeak: 'Password troppo debole (min. 6 caratteri)',
                    errorInvalid: 'Email non valida o password errata'
                },
                en: {
                    loginTitle: 'Sign In',
                    registerTitle: 'Register',
                    email: 'Email Address',
                    password: 'Password',
                    confirmPassword: 'Confirm Password',
                    loginBtn: 'Sign In',
                    registerBtn: 'Register',
                    noAccount: 'No account yet?',
                    hasAccount: 'Already have an account?',
                    registerLink: 'Register now',
                    loginLink: 'Sign in now',
                    teamAccess: 'Team Access',
                    teamDesc: 'Sign in to manage your team and conduct Performance Reviews.',
                    passwordMismatch: 'Passwords do not match',
                    errorAuth: 'Authentication error. Please check your inputs.',
                    errorEmail: 'Email address already registered',
                    errorWeak: 'Password too weak (min. 6 characters)',
                    errorInvalid: 'Invalid email or wrong password'
                }
            };

            const txt = t[lang] || t.de;

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                if (!isLogin && password !== confirmPassword) {
                    setError(txt.passwordMismatch);
                    setLoading(false);
                    return;
                }

                try {
                    if (isLogin) {
                        await auth.signInWithEmailAndPassword(email, password);
                    } else {
                        await auth.createUserWithEmailAndPassword(email, password);
                    }
                    if (onLoginSuccess) onLoginSuccess();
                } catch (err) {
                    console.error('Auth error:', err);
                    if (err.code === 'auth/email-already-in-use') {
                        setError(txt.errorEmail);
                    } else if (err.code === 'auth/weak-password') {
                        setError(txt.errorWeak);
                    } else if (err.code === 'auth/invalid-credential' || err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found') {
                        setError(txt.errorInvalid);
                    } else {
                        setError(txt.errorAuth);
                    }
                }
                setLoading(false);
            };

            return React.createElement('div', { className: 'min-h-[60vh] flex items-center justify-center' },
                React.createElement('div', { className: 'bg-white p-8 rounded-2xl shadow-xl border border-slate-200 w-full max-w-md' },
                    // Header
                    React.createElement('div', { className: 'text-center mb-8' },
                        React.createElement('div', { className: 'w-16 h-16 bg-[#243186] rounded-full flex items-center justify-center mx-auto mb-4' },
                            React.createElement(Users, { size: 32, className: 'text-white' })
                        ),
                        React.createElement('h2', { className: 'text-2xl font-bold', style: { color: '#243186' } },
                            txt.teamAccess
                        ),
                        React.createElement('p', { className: 'text-slate-500 mt-2 text-sm' },
                            txt.teamDesc
                        )
                    ),

                    // Tabs
                    React.createElement('div', { className: 'flex bg-slate-100 rounded-lg p-1 mb-6' },
                        React.createElement('button', {
                            onClick: () => { setIsLogin(true); setError(''); },
                            className: `flex-1 py-2.5 rounded-md text-sm font-medium transition-all ${isLogin ? 'bg-[#6EBD84] text-white shadow' : 'text-slate-600 hover:text-slate-900'}`
                        }, txt.loginTitle),
                        React.createElement('button', {
                            onClick: () => { setIsLogin(false); setError(''); },
                            className: `flex-1 py-2.5 rounded-md text-sm font-medium transition-all ${!isLogin ? 'bg-[#6EBD84] text-white shadow' : 'text-slate-600 hover:text-slate-900'}`
                        }, txt.registerTitle)
                    ),

                    // Error Message
                    error && React.createElement('div', { className: 'bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm' },
                        error
                    ),

                    // Form
                    React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
                        // Email
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, txt.email),
                            React.createElement('div', { className: 'relative' },
                                React.createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' },
                                    React.createElement(Mail, { size: 18, className: 'text-slate-400' })
                                ),
                                React.createElement('input', {
                                    type: 'email',
                                    value: email,
                                    onChange: (e) => setEmail(e.target.value),
                                    required: true,
                                    className: 'w-full pl-10 pr-4 py-2.5 bg-slate-100 border-transparent rounded-2xl focus:bg-white focus:ring-2 focus:ring-[#243186]/20 focus:border-transparent outline-none transition-all',
                                    placeholder: 'name@firma.de'
                                })
                            )
                        ),

                        // Password
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, txt.password),
                            React.createElement('div', { className: 'relative' },
                                React.createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' },
                                    React.createElement(Lock, { size: 18, className: 'text-slate-400' })
                                ),
                                React.createElement('input', {
                                    type: 'password',
                                    value: password,
                                    onChange: (e) => setPassword(e.target.value),
                                    required: true,
                                    minLength: 6,
                                    className: 'w-full pl-10 pr-4 py-2.5 bg-slate-100 border-transparent rounded-2xl focus:bg-white focus:ring-2 focus:ring-[#243186]/20 focus:border-transparent outline-none transition-all',
                                    placeholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'
                                })
                            )
                        ),

                        // Confirm Password (nur bei Registrierung)
                        !isLogin && React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, txt.confirmPassword),
                            React.createElement('div', { className: 'relative' },
                                React.createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' },
                                    React.createElement(Lock, { size: 18, className: 'text-slate-400' })
                                ),
                                React.createElement('input', {
                                    type: 'password',
                                    value: confirmPassword,
                                    onChange: (e) => setConfirmPassword(e.target.value),
                                    required: true,
                                    minLength: 6,
                                    className: 'w-full pl-10 pr-4 py-2.5 bg-slate-100 border-transparent rounded-2xl focus:bg-white focus:ring-2 focus:ring-[#243186]/20 focus:border-transparent outline-none transition-all',
                                    placeholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'
                                })
                            )
                        ),

                        // Submit Button
                        React.createElement('button', {
                            type: 'submit',
                            disabled: loading,
                            className: 'w-full bg-[#243186] text-white py-3 rounded-2xl font-semibold hover:bg-[#1a2460] transition-colors flex items-center justify-center gap-2 disabled:opacity-50'
                        },
                            loading ? React.createElement(Loader2, { size: 20, className: 'animate-spin' }) : null,
                            isLogin ? txt.loginBtn : txt.registerBtn
                        )
                    )
                )
            );
        };

        const { createElement: e } = React;

        // === PDF SANITIZING HELPER ===
        // Entfernt alle no-print Elemente aus einem DOM-Container vor dem PDF-Export
        const sanitizePdfContainer = (container) => {
          if (!container) return;
          
          // Entferne alle Elemente mit no-print Klasse
          const noPrintElements = container.querySelectorAll('.no-print, [data-no-print="true"]');
          noPrintElements.forEach(el => {
            el.style.display = 'none';
            el.style.visibility = 'hidden';
            el.style.height = '0';
            el.style.width = '0';
            el.style.overflow = 'hidden';
            el.style.position = 'absolute';
            el.style.left = '-9999px';
          });
          
          // Entferne leere Container die durch das Ausblenden entstanden sind
          const emptyContainers = container.querySelectorAll('div:empty');
          emptyContainers.forEach(el => {
            if (!el.textContent.trim() && el.children.length === 0) {
              el.style.display = 'none';
            }
          });
          
          console.log(`üßπ PDF Sanitizer: ${noPrintElements.length} no-print Elemente ausgeblendet`);
          return container;
        };

        // === LOCALSTORAGE RESILIENCE HELPER ===
        // Sichere localStorage Operationen mit Try-Catch und Fallback
        const safeLocalStorage = {
          getItem: (key, fallback = null) => {
            try {
              const item = localStorage.getItem(key);
              return item ? JSON.parse(item) : fallback;
            } catch (e) {
              console.warn(`‚ö†Ô∏è localStorage.getItem('${key}') fehlgeschlagen:`, e);
              return fallback;
            }
          },
          setItem: (key, value) => {
            try {
              localStorage.setItem(key, JSON.stringify(value));
              return true;
            } catch (e) {
              console.warn(`‚ö†Ô∏è localStorage.setItem('${key}') fehlgeschlagen:`, e);
              return false;
            }
          },
          removeItem: (key) => {
            try {
              localStorage.removeItem(key);
              return true;
            } catch (e) {
              console.warn(`‚ö†Ô∏è localStorage.removeItem('${key}') fehlgeschlagen:`, e);
              return false;
            }
          }
        };

        // === DRAFT AUTO-SAVE HELPER ===
        // Speichert Entw√ºrfe automatisch und stellt sie wieder her
        const DraftManager = {
          DRAFT_PREFIX: 'nw_draft_',
          EXPIRY_HOURS: 24,
          
          saveDraft: (draftId, data) => {
            const draftKey = DraftManager.DRAFT_PREFIX + draftId;
            const draftData = {
              ...data,
              savedAt: Date.now()
            };
            const success = safeLocalStorage.setItem(draftKey, draftData);
            if (success) {
              console.log(`üíæ Entwurf gespeichert: ${draftId}`);
            }
            return success;
          },
          
          loadDraft: (draftId) => {
            const draftKey = DraftManager.DRAFT_PREFIX + draftId;
            const draft = safeLocalStorage.getItem(draftKey, null);
            
            if (!draft) return null;
            
            // Pr√ºfe ob Entwurf noch g√ºltig ist (< 24h)
            const ageHours = (Date.now() - draft.savedAt) / (1000 * 60 * 60);
            if (ageHours > DraftManager.EXPIRY_HOURS) {
              console.log(`üóëÔ∏è Veralteter Entwurf gel√∂scht: ${draftId}`);
              safeLocalStorage.removeItem(draftKey);
              return null;
            }
            
            console.log(`üìÇ Entwurf geladen: ${draftId} (${Math.round(ageHours)}h alt)`);
            return draft;
          },
          
          deleteDraft: (draftId) => {
            const draftKey = DraftManager.DRAFT_PREFIX + draftId;
            safeLocalStorage.removeItem(draftKey);
            console.log(`üóëÔ∏è Entwurf gel√∂scht: ${draftId}`);
          },
          
          // Formatiere Zeitstempel f√ºr Anzeige
          formatSavedTime: (timestamp, lang) => {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMinutes = Math.round((now - date) / (1000 * 60));
            
            if (diffMinutes < 1) {
              return lang === 'de' ? 'gerade eben' : lang === 'it' ? 'proprio ora' : 'just now';
            }
            if (diffMinutes < 60) {
              return lang === 'de' ? `vor ${diffMinutes} Min.` : lang === 'it' ? `${diffMinutes} min fa` : `${diffMinutes} min ago`;
            }
            const diffHours = Math.round(diffMinutes / 60);
            if (diffHours < 24) {
              return lang === 'de' ? `vor ${diffHours} Std.` : lang === 'it' ? `${diffHours} ore fa` : `${diffHours}h ago`;
            }
            return date.toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB');
          }
        };

        // === GPS CONFIDENCE CALCULATOR ===
        // Berechnet die Konfidenz der GPS-Bewertung basierend auf Vollst√§ndigkeit
        const calculateGPSConfidence = (goals, coreList, leadList, isManager) => {
          const validGoals = goals.filter(g => g.weight > 0 && g.name?.trim());
          const validCore = coreList.filter(c => c.name?.trim() && c.rating > 0);
          const validLead = leadList.filter(l => l.name?.trim() && l.rating > 0);
          
          const totalGoalWeight = validGoals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
          const hasCompleteGoals = totalGoalWeight >= 95 && totalGoalWeight <= 105;
          const hasAllCore = validCore.length >= 5;
          const hasAllLead = !isManager || validLead.length >= 5;
          
          // Berechne Konfidenz-Score (0-100)
          let confidenceScore = 0;
          
          // Ziele (max 40 Punkte)
          if (hasCompleteGoals) confidenceScore += 40;
          else if (totalGoalWeight > 0) confidenceScore += Math.min(30, totalGoalWeight * 0.3);
          
          // Core Kompetenzen (max 40 Punkte, oder 60 wenn kein Manager)
          const coreMax = isManager ? 40 : 60;
          confidenceScore += Math.min(coreMax, validCore.length * (coreMax / 5));
          
          // Leadership Kompetenzen (max 20 Punkte, nur f√ºr Manager)
          if (isManager) {
            confidenceScore += Math.min(20, validLead.length * 4);
          }
          
          // Bestimme Level
          if (confidenceScore >= 90) {
            return { 
              level: 'high', 
              score: confidenceScore,
              color: 'text-green-600',
              bgColor: 'bg-green-100',
              icon: '‚úì',
              label: { de: 'Vollst√§ndig', it: 'Completo', en: 'Complete' }
            };
          }
          if (confidenceScore >= 60) {
            return { 
              level: 'medium', 
              score: confidenceScore,
              color: 'text-amber-600',
              bgColor: 'bg-amber-100',
              icon: '‚ö†',
              label: { de: 'Teilweise', it: 'Parziale', en: 'Partial' }
            };
          }
          return { 
            level: 'low', 
            score: confidenceScore,
            color: 'text-red-600',
            bgColor: 'bg-red-100',
            icon: '‚ùå',
            label: { de: 'Unvollst√§ndig', it: 'Incompleto', en: 'Incomplete' }
          };
        };

        // === SELF-ASSESSMENT DUPLICATE CHECKER ===
        // Pr√ºft ob bereits eine Selbstreflexion f√ºr einen Mitarbeiter/Periode existiert
        const checkExistingSelfAssessment = async (db, employeeId, period) => {
          if (!db || !employeeId) return { exists: false, data: null };
          
          try {
            // Suche nach allen Self-Typen (Firestore erlaubt kein OR in where)
            const snapshot = await db.collection('teamAppraisals')
              .where('employeeId', '==', employeeId)
              .where('period', '==', period)
              .get();
            
            // Filtere nach Self-Typen
            const selfDocs = snapshot.docs.filter(doc => {
              const type = doc.data().type;
              return type === 'self' || type === 'self_assessment' || type === 'self-reflection';
            });
            
            if (selfDocs.length > 0) {
              const existing = selfDocs[0].data();
              return { 
                exists: true, 
                data: existing,
                docId: selfDocs[0].id
              };
            }
            return { exists: false, data: null };
          } catch (error) {
            console.error('‚ùå Fehler beim Pr√ºfen auf existierende Selbstreflexion:', error);
            return { exists: false, data: null, error: error };
          }
        };

        // === MULTILINGUAL TEXT HELPER ===
        // Verwendung: getText(lang, 'German text', 'Italian text', 'English text')
        const getText = (lang, de, it, en) => {
          if (lang === 'en') return en || de;
          if (lang === 'it') return it || de;
          return de;
        };

        // === GPS SIMULATOR CONSTANTS ===
        const BARS_RANGES = [
          { min: 131, score: 5, label: "Herausragend (>130%)" },
          { min: 111, max: 130, score: 4, label: "√úbertroffen (111-130%)" },
          { min: 90, max: 110, score: 3, label: "Baseline (90-110%)" },
          { min: 70, max: 89, score: 2, label: "Teilweise (70-89%)" },
          { min: 0, max: 69, score: 1, label: "Nicht erreicht (<70%)" },
        ];

        const RATINGS = [
          { min: 4.51, max: 5.00, label: "Outstanding (5)", color: "bg-green-600", desc: "Top Bonus / Gehaltssprung" },
          { min: 3.51, max: 4.50, label: "Exceeds Expectations (4)", color: "bg-emerald-500", desc: "Basis-Bonus / Gehaltserh√∂hung" },
          { min: 2.51, max: 3.50, label: "Meets Expectations (3)", color: "bg-blue-600", desc: "Standard-Runde / Kein Bonus" },
          { min: 1.51, max: 2.50, label: "Needs Improvement (2)", color: "bg-orange-500", desc: "Enge F√ºhrung / PIP" },
          { min: 0.00, max: 1.50, label: "Does Not Meet (1)", color: "bg-red-600", desc: "Sofortige Eskalation" },
        ];

        const getBarsScore = (percentage) => {
          const range = BARS_RANGES.find(r => percentage >= r.min && (r.max === undefined || percentage <= r.max));
          return range ? range.score : 1;
        };

        const getRating = (score) => {
          return RATINGS.find(r => score >= r.min && score <= r.max) || RATINGS[RATINGS.length - 1];
        };


        // --- UI TEXT (German and Italian) ---
        const UI_TEXT = {
            de: {
                title: "Performance Manager",
                welcome: "Willkommen",
                intro: "Dies ist Ihr interaktiver Guide f√ºr das ",
                introBold: "Niederwieser Performance Review",
                introEnd: ". Hier finden Sie alle Verhaltensanker, Definitionen und Beispiele, um Leistungen objektiv einzusch√§tzen.",
                strategyTitle: "Strategie & Vision",
                strategySubtitle: "Die Transformation im Fokus",
                strategyDesc: "Unsere Kernwerte Fast, Fair & Personal sind der Kompass zur Strategie 2035. Mit dem Performance Review schaffen wir die Transparenz, individuelle Ergebnisse (WAS) und Kompetenzen (WIE) objektiv zu bewerten, um alle Anstrengungen auf das gemeinsame Ziel zu b√ºndeln: die Entwicklung zum ",
                strategyBold: "Smartest Solution Provider",
                strategyEnd: ".",
                barsTitle: "Wie funktioniert BARS?",
                barsDesc: "Behaviorally Anchored Rating Scales: Wir bewerten Verhalten, nicht Pers√∂nlichkeit. Nutzen Sie den Guide, um den Unterschied zwischen \"Standard\" (3) und \"Role Model\" (5) zu verstehen.",
                btnCompetencies: "Kompetenzen ansehen",
                coreComp: "Kern-Kompetenzen (F√ºr Alle)",
                leadComp: "Leadership-Kompetenzen (F√ºhrungskr√§fte)",
                back: "‚Üê Zur√ºck zur √úbersicht",
                selectScore: "W√§hlen Sie einen Score",
                example: "Praktisches Beispiel",
                dashboard: "Dashboard",
                competencies: "Kompetenzen",
                simulator: "GPS Simulator",
                gpsExplainer: "GPS Formel",
                formular: "Beurteilungsformular",
                zielvereinbarung: "Zielvereinbarung",
                level1: "Erf√ºllt nicht",
                level2: "Verbesserungsbedarf",
                level3: "Baseline (Standard)",
                level4: "√úbertrifft Erwartungen",
                level5: "Herausragend / Role Model",
                // GPS Simulator Texte
                gpsSimTitle: "GPS Simulator: Berechnung testen",
                gpsSimDesc: "Testen Sie die Formel, indem Sie WAS (Ziele) und WIE (Kompetenzen) bewerten.",
                wasSection: "WAS: Ziele erreichen",
                wasPercent: "50% der GPS",
                wasScoreLabel: "WAS Score",
                goalName: "Ziel",
                goalWeight: "Gewicht (%)",
                goalAchievement: "Erreichung (%)",
                addGoal: "Ziel hinzuf√ºgen",
                removeGoal: "Entfernen",
                competencyWeight: "Gewicht",
                totalWeight: "Gesamtgewicht",
                shouldBe100: "sollte 100% sein",
                wieCore: "WIE: Kern-Kompetenzen",
                wieLeadership: "WIE: Leadership-Kompetenzen",
                score: "Score",
                addLeadership: "Leadership-Kompetenzen hinzuf√ºgen",
                leadershipActive: "Aktiviert (F√ºhrungskraft)",
                leadershipOptional: "Optional",
                globalPerformanceScore: "Global Performance Score",
                theMath: "The Math: Berechnung",
                wasGoals: "WAS (Ziele)",
                wieCompetencies: "WIE (Kompetenzen)",
                wieCore2: "WIE (Kern)",
                wieLeader: "WIE (Lead)",
                gpsTotal: "GPS TOTAL",
                resetSimulator: "Simulator zur√ºcksetzen",
                // GPS Erkl√§rungsseite
                gpsExplainerTitle: "Der Global Performance Score (GPS)",
                gpsExplainerSubtitle: "So funktioniert unsere Performance-Bewertung",
                gpsIntroTitle: "Unser ausgewogener Ansatz",
                gpsIntroText: "Der Annual Performance Review basiert auf einem ausgewogenen Ansatz. Wir bewerten nicht nur WAS erreicht wurde, sondern auch WIE es erreicht wurde. Diese Kombination nennen wir Global Performance Score und stellt sicher, dass nicht nur Ergebnisse z√§hlen, sondern auch die Art und Weise, wie diese Ergebnisse erreicht werden.",
                gpsFormulaTitle: "Die GPS-Formel",
                gpsFormulaExplain: "Der GPS setzt sich aus drei Dimensionen zusammen:",
                wasExplainTitle: "WAS: Messbare Ergebnisse",
                wasExplainWeight: "50% Gewichtung",
                wasExplainText: "Misst die Zielerreichung. Die Messung erfolgt objektiv √ºber eine Umrechnungstabelle (%).",
                wasExplainExample: "Beispiel: \"Umsatzziel: 500.000 ‚Ç¨ geplant, 550.000 ‚Ç¨ erreicht = 110%\"",
                wieExplainTitle: "WIE: Verhalten & Kompetenzen",
                wieCoreExplainWeight: "25% Gewichtung (Kern-Kompetenzen)",
                wieLeadExplainWeight: "25% Gewichtung (Leadership-Kompetenzen)",
                wieExplainText: "Misst die Kompetenzen anhand von Verhaltensankern (BARS). Dies sichert die Einhaltung unserer Werte.",
                wieExplainCompetencies: "Kern-Kompetenzen: Fachkompetenz & Anwendung ‚Ä¢ Kommunikation & Zusammenarbeit ‚Ä¢ Probleml√∂sekompetenz ‚Ä¢ Anpassungsf√§higkeit ‚Ä¢ Selbstorganisation | Leadership-Kompetenzen: Mitarbeiterf√ºhrung & -entwicklung ‚Ä¢ Strategisches Denken ‚Ä¢ Entscheidungsf√§higkeit ‚Ä¢ Execution & Performance Management ‚Ä¢ Stakeholder-Management",
                barsConversionTitle: "Umrechnung: Zielerreichung % ‚Üí BARS-Stufe",
                barsConversionDesc: "Die Zielerreichung in Prozent wird in BARS-Stufen (1-5) umgerechnet:",
                performanceRatingTitle: "Performance-Rating (basierend auf GPS)",
                performanceRatingDesc: "Der finale GPS-Wert bestimmt das Performance-Rating:",
                calculationExampleTitle: "Berechnungsbeispiel",
                calculationExampleIntro: "Annahmen:",
                calculationStep1: "WAS (Zielerreichung): 4,0",
                calculationStep2: "WIE (Kern-Kompetenzen): 3,2",
                calculationStep3: "WIE (Leadership-Kompetenzen): 4,0",
                calculationFormula: "Berechnung:",
                calculationResult: "Ergebnis: GPS = 3,8 ‚Üí Exceeds Expectations (4)",
                whyGPSTitle: "Warum GPS?",
                whyGPS1Title: "Fairness & Objektivit√§t",
                whyGPS1Text: "BARS-Methodik reduziert subjektive Bewertungen durch konkrete Verhaltensanker",
                whyGPS2Title: "Strategische Ausrichtung",
                whyGPS2Text: "Verhalten wird an unseren Werten \"Schnell ‚Ä¢ Fair ‚Ä¢ Pers√∂nlich\" gemessen",
                whyGPS3Title: "Entwicklungsorientiert",
                whyGPS3Text: "Klare Verhaltensbeispiele zeigen den Weg zur n√§chsten Stufe auf",
                // Performance Kompass
                performanceCompassTitle: "Ihr Performance Kompass",
                performanceCompassSubtitle: "Der Global Performance Score (GPS) stellt sicher, dass wir Ihren Erfolg ganzheitlich messen: Wir bewerten nicht nur WAS erreicht wurde, sondern auch WIE es im Einklang mit unseren Werten umgesetzt wurde.",
                wasBoxTitle: "50% WAS",
                wasBoxSubtitle: "Ziele & Ergebnisse (KPIs)",
                wieBoxTitle: "50% WIE",
                wieBoxSubtitle: "Verhalten & Kompetenzen (BARS)",
                wieBoxSubtitleManager: "25% Kern-Kompetenzen + 25% Leadership",
                wieBoxSubtitleEmployee: "Kern-Kompetenzen (BARS)",
                managerNote: "* F√ºr F√ºhrungskr√§fte: Das WIE splittet sich in 25% Kern-Kompetenzen und 25% Leadership-Kompetenzen.",
                fairnessGuarantee: "FAIRNESS-GARANTIE: KALIBRIERTE BEWERTUNG",
                barsRanges: {
                    outstanding: "Herausragend (>130%)",
                    exceeded: "√úbertroffen (111-130%)",
                    baseline: "Baseline (90-110%)",
                    partial: "Teilweise (70-89%)",
                    notReached: "Nicht erreicht (<70%)"
                },
                ratings: {
                    outstanding: "Top Bonus / Gehaltssprung",
                    exceeds: "Basis-Bonus / Gehaltserh√∂hung",
                    meets: "Standard-Runde / Kein Bonus",
                    needs: "Enge F√ºhrung / PIP",
                    doesNot: "Sofortige Eskalation"
                }
            },
            it: {
                title: "Performance Manager",
                welcome: "Benvenuto",
                intro: "Questa √® la tua guida interattiva per il ",
                introBold: "Niederwieser Performance Review",
                introEnd: ". Qui troverai tutti gli ancoraggi comportamentali, definizioni ed esempi per valutare le prestazioni in modo oggettivo.",
                strategyTitle: "Strategia & Visione",
                strategySubtitle: "Focus sulla trasformazione",
                strategyDesc: "I nostri valori fondamentali Fast, Fair & Personal sono la bussola verso la Strategia 2035. Con il Performance Review creiamo la trasparenza per valutare oggettivamente risultati individuali (COSA) e competenze (COME), concentrando tutti gli sforzi sull'obiettivo comune: lo sviluppo verso ",
                strategyBold: "Smartest Solution Provider",
                strategyEnd: ".",
                barsTitle: "Come funziona BARS?",
                barsDesc: "Behaviorally Anchored Rating Scales: Valutiamo il comportamento, non la personalit√†. Usa la guida per capire la differenza tra \"Standard\" (3) e \"Role Model\" (5).",
                btnCompetencies: "Vedi Competenze",
                coreComp: "Competenze Chiave (Per Tutti)",
                leadComp: "Competenze di Leadership (Manager)",
                back: "‚Üê Torna alla panoramica",
                selectScore: "Seleziona un punteggio",
                example: "Esempio pratico",
                dashboard: "Dashboard",
                competencies: "Competenze",
                simulator: "Simulatore GPS",
                gpsExplainer: "Formula GPS",
                formular: "Modulo di valutazione",
                zielvereinbarung: "Accordo sugli obiettivi",
                level1: "Non soddisfa",
                level2: "Richiede miglioramento",
                level3: "Baseline (Standard)",
                level4: "Supera le aspettative",
                level5: "Eccellente / Role Model",
                // GPS Simulator Texte
                gpsSimTitle: "Simulatore GPS: Testare il calcolo",
                gpsSimDesc: "Testa la formula valutando COSA (Obiettivi) e COME (Competenze).",
                wasSection: "COSA: Raggiungere obiettivi",
                wasPercent: "50% del GPS",
                wasScoreLabel: "COSA Score",
                goalName: "Obiettivo",
                goalWeight: "Peso (%)",
                goalAchievement: "Raggiungimento (%)",
                addGoal: "Aggiungi obiettivo",
                removeGoal: "Rimuovi",
                competencyWeight: "Peso",
                totalWeight: "Peso totale",
                shouldBe100: "dovrebbe essere 100%",
                wieCore: "COME: Competenze Chiave",
                wieLeadership: "COME: Competenze di Leadership",
                score: "Punteggio",
                addLeadership: "Aggiungi Competenze di Leadership",
                leadershipActive: "Attivato (Manager)",
                leadershipOptional: "Opzionale",
                globalPerformanceScore: "Global Performance Score",
                theMath: "Il Calcolo: Formula",
                wasGoals: "COSA (Obiettivi)",
                wieCompetencies: "COME (Competenze)",
                wieCore2: "COME (Chiave)",
                wieLeader: "COME (Lead)",
                gpsTotal: "GPS TOTALE",
                resetSimulator: "Resetta simulatore",
                // GPS Erkl√§rungsseite
                gpsExplainerTitle: "Il Global Performance Score (GPS)",
                gpsExplainerSubtitle: "Come funziona la nostra valutazione delle prestazioni",
                gpsIntroTitle: "Il nostro approccio equilibrato",
                gpsIntroText: "L'Annual Performance Review si basa su un approccio equilibrato. Valutiamo non solo COSA √® stato raggiunto, ma anche COME √® stato raggiunto. Questa combinazione viene definita Global Performance Score e garantisce che vengano considerati non solo i risultati, ma anche il modo in cui sono stati ottenuti.",
                gpsFormulaTitle: "La Formula GPS",
                gpsFormulaExplain: "Il GPS si compone di tre dimensioni:",
                wasExplainTitle: "COSA: Risultati misurabili",
                wasExplainWeight: "Peso 50%",
                wasExplainText: "Misura il raggiungimento degli obiettivi. La misurazione avviene in modo oggettivo attraverso una tabella di conversione (%).",
                wasExplainExample: "Esempio: \"Obiettivo di fatturato: 500.000 ‚Ç¨ pianificati, 550.000 ‚Ç¨ raggiunti = 110%\"",
                wieExplainTitle: "COME: Comportamento & Competenze",
                wieCoreExplainWeight: "Peso 25% (Competenze Chiave)",
                wieLeadExplainWeight: "Peso 25% (Competenze di Leadership)",
                wieExplainText: "Misura le competenze sulla base di ancoraggi comportamentali (BARS). Ci√≤ garantisce il rispetto dei nostri valori.",
                wieExplainCompetencies: "Competenze Chiave: Competenza tecnica & Applicazione ‚Ä¢ Comunicazione & Collaborazione ‚Ä¢ Capacit√† di problem solving ‚Ä¢ Adattabilit√† ‚Ä¢ Autogestione | Competenze di Leadership: Gestione & Sviluppo del personale ‚Ä¢ Pensiero strategico ‚Ä¢ Capacit√† decisionale ‚Ä¢ Execution & Performance Management ‚Ä¢ Gestione degli stakeholder",
                barsConversionTitle: "Conversione: Raggiungimento % ‚Üí Livello BARS",
                barsConversionDesc: "La percentuale di raggiungimento viene convertita in livelli BARS (1-5):",
                performanceRatingTitle: "Valutazione delle Prestazioni (basata su GPS)",
                performanceRatingDesc: "Il valore GPS finale determina la valutazione delle prestazioni:",
                calculationExampleTitle: "Esempio di calcolo",
                calculationExampleIntro: "Ipotesi:",
                calculationStep1: "COSA (Raggiungimento obiettivi): 4,0",
                calculationStep2: "COME (Competenze Chiave): 3,2",
                calculationStep3: "COME (Competenze di Leadership): 4,0",
                calculationFormula: "Calcolo:",
                calculationResult: "Risultato: GPS = 3,8 ‚Üí Supera le Aspettative (4)",
                whyGPSTitle: "Perch√© GPS?",
                whyGPS1Title: "Equit√† & Oggettivit√†",
                whyGPS1Text: "La metodologia BARS riduce le valutazioni soggettive grazie ad ancoraggi comportamentali concreti",
                whyGPS2Title: "Allineamento Strategico",
                whyGPS2Text: "Il comportamento viene misurato in base ai nostri valori \"Veloce ‚Ä¢ Equo ‚Ä¢ Personale\"",
                whyGPS3Title: "Orientato allo Sviluppo",
                whyGPS3Text: "Esempi comportamentali chiari indicano il percorso verso il livello successivo",
                // Performance Kompass
                performanceCompassTitle: "La tua Bussola delle Prestazioni",
                performanceCompassSubtitle: "Il Global Performance Score (GPS) garantisce che misuriamo il vostro successo in modo olistico: valutiamo non solo COSA √® stato raggiunto, ma anche COME √® stato realizzato in linea con i nostri valori.",
                wasBoxTitle: "50% COSA",
                wasBoxSubtitle: "Obiettivi & Risultati (KPI)",
                wieBoxTitle: "50% COME",
                wieBoxSubtitle: "Comportamento & Competenze (BARS)",
                wieBoxSubtitleManager: "25% Competenze Core + 25% Leadership",
                wieBoxSubtitleEmployee: "Competenze Core (BARS)",
                managerNote: "* Per i dirigenti: Il COME si divide in 25% Competenze Core e 25% Competenze di Leadership.",
                fairnessGuarantee: "GARANZIA DI EQUIT√Ä: VALUTAZIONE CALIBRATA",
                barsRanges: {
                    outstanding: "Eccellente (>130%)",
                    exceeded: "Superato (111-130%)",
                    baseline: "Baseline (90-110%)",
                    partial: "Parziale (70-89%)",
                    notReached: "Non raggiunto (<70%)"
                },
                ratings: {
                    outstanding: "Bonus Massimo / Aumento Salariale",
                    exceeds: "Bonus Base / Aumento",
                    meets: "Standard / Nessun Bonus",
                    needs: "Supervisione Stretta / PIP",
                    doesNot: "Escalation Immediata"
                }
            },
            en: {
                title: "Performance Manager",
                welcome: "Welcome",
                intro: "This is your interactive guide for the ",
                introBold: "Niederwieser Performance Review",
                introEnd: ". Here you will find all behavioral anchors, definitions, and examples to objectively assess performance.",
                strategyTitle: "Strategy & Vision",
                strategySubtitle: "Focus on Transformation",
                strategyDesc: "Our core values Fast, Fair & Personal are the compass towards Strategy 2035. With the Performance Review, we create transparency to objectively evaluate individual results (WHAT) and competencies (HOW), focusing all efforts on the common goal: development into the ",
                strategyBold: "Smartest Solution Provider",
                strategyEnd: ".",
                barsTitle: "How does BARS work?",
                barsDesc: "Behaviorally Anchored Rating Scales: We evaluate behavior, not personality. Use the guide to understand the difference between \"Standard\" (3) and \"Role Model\" (5).",
                btnCompetencies: "View Competencies",
                coreComp: "Core Competencies (For Everyone)",
                leadComp: "Leadership Competencies (Managers)",
                back: "‚Üê Back to Overview",
                selectScore: "Select a Score",
                example: "Practical Example",
                dashboard: "Dashboard",
                competencies: "Competencies",
                simulator: "GPS Simulator",
                gpsExplainer: "GPS Formula",
                formular: "Appraisal Form",
                zielvereinbarung: "Goal Agreement",
                level1: "Does Not Meet",
                level2: "Needs Improvement",
                level3: "Baseline (Standard)",
                level4: "Exceeds Expectations",
                level5: "Outstanding / Role Model",
                // GPS Simulator Texts
                gpsSimTitle: "GPS Simulator: Test Calculation",
                gpsSimDesc: "Test the formula by rating WHAT (Goals) and HOW (Competencies).",
                wasSection: "WHAT: Achieve Goals",
                wasPercent: "50% of GPS",
                wasScoreLabel: "WHAT Score",
                goalName: "Goal",
                goalWeight: "Weight (%)",
                goalAchievement: "Achievement (%)",
                addGoal: "Add Goal",
                removeGoal: "Remove",
                competencyWeight: "Weight",
                totalWeight: "Total Weight",
                shouldBe100: "should be 100%",
                wieCore: "HOW: Core Competencies",
                wieLeadership: "HOW: Leadership Competencies",
                score: "Score",
                addLeadership: "Add Leadership Competencies",
                leadershipActive: "Activated (Manager)",
                leadershipOptional: "Optional",
                globalPerformanceScore: "Global Performance Score",
                theMath: "The Math: Calculation",
                wasGoals: "WHAT (Goals)",
                wieCompetencies: "HOW (Competencies)",
                wieCore2: "HOW (Core)",
                wieLeader: "HOW (Lead)",
                gpsTotal: "GPS TOTAL",
                resetSimulator: "Reset Simulator",
                // GPS Explainer Page
                gpsExplainerTitle: "The Global Performance Score (GPS)",
                gpsExplainerSubtitle: "How Our Performance Evaluation Works",
                gpsIntroTitle: "Our Balanced Approach",
                gpsIntroText: "The Annual Performance Review is based on a balanced approach. We evaluate not only WHAT was achieved, but also HOW it was achieved. This combination is called the Global Performance Score and ensures that not only results count, but also the way these results were achieved.",
                gpsFormulaTitle: "The GPS Formula",
                gpsFormulaExplain: "The GPS consists of three dimensions:",
                wasExplainTitle: "WHAT: Measurable Results",
                wasExplainWeight: "50% Weight",
                wasExplainText: "Measures goal achievement. Measurement is objective through a conversion table (%).",
                wasExplainExample: "Example: \"Revenue target: ‚Ç¨500,000 planned, ‚Ç¨550,000 achieved = 110%\"",
                wieExplainTitle: "HOW: Behavior & Competencies",
                wieCoreExplainWeight: "25% Weight (Core Competencies)",
                wieLeadExplainWeight: "25% Weight (Leadership Competencies)",
                wieExplainText: "Measures competencies based on behavioral anchors (BARS). This ensures adherence to our values.",
                wieExplainCompetencies: "Core Competencies: Technical Expertise & Application ‚Ä¢ Communication & Collaboration ‚Ä¢ Problem-Solving Skills ‚Ä¢ Adaptability ‚Ä¢ Self-Organization | Leadership Competencies: Employee Management & Development ‚Ä¢ Strategic Thinking ‚Ä¢ Decision-Making ‚Ä¢ Execution & Performance Management ‚Ä¢ Stakeholder Management",
                barsConversionTitle: "Conversion: Achievement % ‚Üí BARS Level",
                barsConversionDesc: "The achievement percentage is converted to BARS levels (1-5):",
                performanceRatingTitle: "Performance Rating (based on GPS)",
                performanceRatingDesc: "The final GPS value determines the performance rating:",
                calculationExampleTitle: "Calculation Example",
                calculationExampleIntro: "Assumptions:",
                calculationStep1: "WHAT (Goal Achievement): 4.0",
                calculationStep2: "HOW (Core Competencies): 3.2",
                calculationStep3: "HOW (Leadership Competencies): 4.0",
                calculationFormula: "Calculation:",
                calculationResult: "Result: GPS = 3.8 ‚Üí Exceeds Expectations (4)",
                whyGPSTitle: "Why GPS?",
                whyGPS1Title: "Fairness & Objectivity",
                whyGPS1Text: "BARS methodology reduces subjective assessments through concrete behavioral anchors",
                whyGPS2Title: "Strategic Alignment",
                whyGPS2Text: "Behavior is measured against our values \"Fast ‚Ä¢ Fair ‚Ä¢ Personal\"",
                whyGPS3Title: "Development-Oriented",
                whyGPS3Text: "Clear behavioral examples show the path to the next level",
                // Performance Compass
                performanceCompassTitle: "Your Performance Compass",
                performanceCompassSubtitle: "The Global Performance Score (GPS) ensures that we measure your success holistically: We evaluate not only WHAT was achieved, but also HOW it was implemented in line with our values.",
                wasBoxTitle: "50% WHAT",
                wasBoxSubtitle: "Goals & Results (KPIs)",
                wieBoxTitle: "50% HOW",
                wieBoxSubtitle: "Behavior & Competencies (BARS)",
                wieBoxSubtitleManager: "25% Core Competencies + 25% Leadership",
                wieBoxSubtitleEmployee: "Core Competencies (BARS)",
                managerNote: "* For managers: The HOW splits into 25% Core Competencies and 25% Leadership Competencies.",
                fairnessGuarantee: "FAIRNESS GUARANTEE: CALIBRATED ASSESSMENT",
                barsRanges: {
                    outstanding: "Outstanding (>130%)",
                    exceeded: "Exceeded (111-130%)",
                    baseline: "Baseline (90-110%)",
                    partial: "Partial (70-89%)",
                    notReached: "Not Reached (<70%)"
                },
                ratings: {
                    outstanding: "Top Bonus / Salary Jump",
                    exceeds: "Base Bonus / Salary Increase",
                    meets: "Standard Round / No Bonus",
                    needs: "Close Supervision / PIP",
                    doesNot: "Immediate Escalation"
                }
            }
        };

        // --- FORM TEXT FOR APPRAISAL FORM ---
        const FORM_TEXT = {
            de: {
                headerTitle: "Jahresgespr√§ch & Performance Review",
                headerSubtitle: "Annual Performance Review | Strategie 2035",
                partA: "Teil A: Gespr√§chsdaten",
                formType: "Art des Formulars",
                formTypeSelf: "Selbstreflexion (Mitarbeiter:in)",
                formTypeManager: "Beurteilung (F√ºhrungskraft)",
                selfReflectionNote: "‚ö†Ô∏è Bitte sende diese Selbstreflexion mindestens eine Woche vor dem Gespr√§ch an deine F√ºhrungskraft.",
                partB: "Teil B: Zielerreichung (WAS) ‚Äì 50% Gewichtung",
                partC: "Teil C: Kern-Kompetenzen (WIE)",
                compName: "Kompetenz",
                partCLead: "Teil C.2: Leadership-Kompetenzen",
                partC3: "Teil C.3: Global Performance Score (GPS)",
                partD: "Teil D: St√§rken & Entwicklungsplanung",
                partE: "Teil E: Karriereperspektive & Zielvorstellungen",
                partF: "Teil F: Mitarbeiter-Feedback",
                partH: "Teil G: Unterschriften & Einverst√§ndnis",
                employee: "Mitarbeiter:in (Name, Vorname)",
                position: "Stellenbezeichnung / Funktion",
                manager: "F√ºhrungskraft (Name, Vorname)",
                date: "Gespr√§chsdatum",
                period: "Bewertungszeitraum",
                to: "bis",
                hintGPS: "Hinweis: Der GPS wird hier interaktiv berechnet. √úbertragen Sie die finalen Werte aus der Kalibrierung.",
                profile: "Profil / Rolle",
                roleEmp: "Mitarbeitende (50% WAS / 50% Kern-Komp.)",
                roleMgr: "F√ºhrungskraft (50% WAS / 25% Kern / 25% Lead)",
                goalName: "Zielbezeichnung",
                weight: "Gewicht %",
                achievement: "Erreichung %",
                barsLevel: "BARS-Note",
                strengths: "D.1 Identifizierte St√§rken",
                strengthsProfessional: "Fachliche St√§rken (Was gelingt besonders gut?):",
                strengthsPersonal: "Pers√∂nliche St√§rken (Welche Verhaltenskompetenzen zeichnen besonders aus?):",
                development: "D.2 Entwicklungsfelder & Ma√ünahmen",
                devIntro: "Welche Kompetenzen sollen gest√§rkt werden?",
                measure: "Ma√ünahme",
                responsible: "Verantwortlich",
                deadline: "Umsetzung bis",
                careerIntro: "Welche Zielvorstellungen hat der/die Mitarbeiter:in?",
                careerOptions: [
                    "Weiterentwicklung in h√∂herwertige T√§tigkeit",
                    "Vertiefung in der aktuellen Rolle (Spezialist:in)",
                    "F√ºhrungskarriere anstreben",
                    "Lateraler Move (anderer Bereich)",
                    "Beibehaltung der aktuellen T√§tigkeit (keine Ver√§nderung gew√ºnscht)"
                ],
                comments: "Erl√§uterung:",
                feedbackIntro: "Bitte teile deine Einsch√§tzung zur Zusammenarbeit, den Arbeitsbedingungen und Entwicklungsm√∂glichkeiten mit.",
                feedbackQ1: "1. F√ºhlst du dich ausreichend unterst√ºtzt und gef√∂rdert?",
                feedbackQ2: "2. Welche Verbesserungsvorschl√§ge hast du (Prozesse, Tools, Arbeitsbedingungen)?",
                feedbackQ3: "3. Auf welche gr√∂√üeren Schwierigkeiten bist du dieses Jahr gesto√üen?",
                feedbackQ4: "4. Was war dein gr√∂√üter pers√∂nlicher Erfolgsmoment?",
                feedbackQ5: "5. Wie nimmst du die √Ñnderung der Unternehmensstrategie wahr?",
                feedbackQ6: "6. Welche Projekte w√ºrdest du f√ºr deine Abteilung vorschlagen?",
                feedbackQ7: "7. Wie bewertest du deine Work-Life-Balance? (1=sehr schlecht, 5=sehr gut)",
                signatureNote: "Mit der Unterschrift wird best√§tigt, dass das Gespr√§ch stattgefunden hat.",
                signatureEmp: "Unterschrift Mitarbeiter:in",
                signatureMgr: "Unterschrift F√ºhrungskraft",
                print: "Als PDF herunterladen",
                generating: "Erstelle PDF...",
                calcAuto: "Automatisch berechnet",
                totalWas: "WAS-Score",
                totalWie: "WIE-Score",
                addGoal: "Ziel hinzuf√ºgen",
                addDev: "Ma√ünahme hinzuf√ºgen",
                addComp: "Kompetenz hinzuf√ºgen",
                totalWeight: "Gesamtgewicht",
                shouldBe100: "sollte 100% sein",
                rating: "Rating",
                comment: "Kommentar / Begr√ºndung",
                barsCompetency: {
                    fach: {
                        1: "Erf√ºllt nicht ‚Äì Fehlerhaft, kein fachliches Fundament",
                        2: "Verbesserungsbedarf ‚Äì Standardprozesse okay, bei Abweichungen √ºberfordert",
                        3: "Baseline ‚Äì Souver√§n, selbstst√§ndig, qualitativ hochwertig",
                        4: "√úbertrifft ‚Äì Durchdringt komplexe Zusammenh√§nge, agiert pr√§ventiv",
                        5: "Herausragend ‚Äì Fachliche Autorit√§t, standort√ºbergreifend anerkannt"
                    },
                    komm: {
                        1: "Erf√ºllt nicht ‚Äì Kapselt sich ab, Absicherungs-Mentalit√§t",
                        2: "Verbesserungsbedarf ‚Äì Reaktiv, ineffiziente Kan√§le",
                        3: "Baseline ‚Äì Proaktiv, wertsch√§tzend, teilt Wissen bereitwillig",
                        4: "√úbertrifft ‚Äì Schafft Verst√§ndnis, baut Silos ab, vermittelt bei Konflikten",
                        5: "Herausragend ‚Äì Etabliert neue Standards, Netzwerk des Vertrauens"
                    },
                    prob: {
                        1: "Erf√ºllt nicht ‚Äì Blockiert, wartet passiv auf L√∂sung von au√üen",
                        2: "Verbesserungsbedarf ‚Äì Bearbeitet Symptome, eskaliert zu fr√ºh",
                        3: "Baseline ‚Äì Analysiert strukturiert, findet pragmatische L√∂sungen",
                        4: "√úbertrifft ‚Äì Erkennt Muster, denkt in L√∂sungsalternativen",
                        5: "Herausragend ‚Äì L√∂st strategische Probleme, Vorbild bei Krisen"
                    },
                    adapt: {
                        1: "Erf√ºllt nicht ‚Äì Str√§ubt sich gegen Ver√§nderungen",
                        2: "Verbesserungsbedarf ‚Äì Wenig Eigeninitiative zur Weiterbildung",
                        3: "Baseline ‚Äì Neugierig, reflektiert, passt sich z√ºgig an",
                        4: "√úbertrifft ‚Äì Sucht aktiv Wissen, Katalysator f√ºr Neues",
                        5: "Herausragend ‚Äì Antizipiert Trends, bereitet Organisation vor"
                    },
                    orga: {
                        1: "Erf√ºllt nicht ‚Äì Chaotisch, h√§lt Fristen nicht ein",
                        2: "Verbesserungsbedarf ‚Äì Funktioniert unter F√ºhrung, bei Autonomie unsicher",
                        3: "Baseline ‚Äì Organisiert, priorisiert, h√§lt Commitments ein",
                        4: "√úbertrifft ‚Äì Vorausschauend, optimiert Prozesse, entlastet andere",
                        5: "Herausragend ‚Äì Koordiniert komplexe Vorhaben, setzt Ma√üst√§be"
                    },
                    lead: {
                        1: "Erf√ºllt nicht ‚Äì Kein Commitment zum Team, Mikromanagement",
                        2: "Verbesserungsbedarf ‚Äì F√ºhrt nur 'gef√§llige' Gespr√§che",
                        3: "Baseline ‚Äì Gibt klare Richtung, f√∂rdert individuell, coacht",
                        4: "√úbertrifft ‚Äì Strategisches Teamdesign, entwickelt High Performer",
                        5: "Herausragend ‚Äì Baut standort√ºbergreifende F√ºhrungskultur auf"
                    },
                    strat: {
                        1: "Erf√ºllt nicht ‚Äì Tunnelblick, keine Weitsicht",
                        2: "Verbesserungsbedarf ‚Äì Tagesgesch√§ft dominiert, wenig Bezug zur Strategie",
                        3: "Baseline ‚Äì √úbersetzt Strategie in Bereichsziele, zeigt Zusammenh√§nge",
                        4: "√úbertrifft ‚Äì Antizipiert Entwicklungen, fordert Status quo heraus",
                        5: "Herausragend ‚Äì Pr√§gt strategische Ausrichtung, M&A-Kompetenz"
                    },
                    decide: {
                        1: "Erf√ºllt nicht ‚Äì Vermeidet Entscheidungen, delegiert st√§ndig nach oben",
                        2: "Verbesserungsbedarf ‚Äì Entscheidet nur bei perfekter Info-Lage",
                        3: "Baseline ‚Äì Entscheidet z√ºgig, transparent, steht zu Entscheidungen",
                        4: "√úbertrifft ‚Äì Trifft auch unbequeme Entscheidungen, dosiert Risiko klug",
                        5: "Herausragend ‚Äì Entscheidet strategisch mit Mut, bei Unsicherheit souver√§n"
                    },
                    exec: {
                        1: "Erf√ºllt nicht ‚Äì Plant nicht, keine Verbindlichkeit",
                        2: "Verbesserungsbedarf ‚Äì Nachverfolgung inkonsistent, l√§sst nachsichtig durchgehen",
                        3: "Baseline ‚Äì Klare Ziele, nachvollziehbare Erwartungen, fordert ein",
                        4: "√úbertrifft ‚Äì Stringent, balanciert Druck & F√∂rderung, denkt in KPIs",
                        5: "Herausragend ‚Äì Performance-Kultur √ºber Standorte hinweg"
                    },
                    stake: {
                        1: "Erf√ºllt nicht ‚Äì Ignoriert Stakeholder, provoziert Konflikte",
                        2: "Verbesserungsbedarf ‚Äì Reagiert nur auf Eskalationen",
                        3: "Baseline ‚Äì Pflegt proaktiv Beziehungen, moderiert sachlich",
                        4: "√úbertrifft ‚Äì Orchestriert Stakeholder, findet Win-Win-L√∂sungen",
                        5: "Herausragend ‚Äì Diplomatie auf Executive-Level, verhindert Eskalationen"
                    }
                }
            },
            it: {
                headerTitle: "Colloquio Annuale & Performance Review",
                headerSubtitle: "Annual Performance Review | Strategia 2035",
                partA: "Parte A: Dati del Colloquio",
                formType: "Tipo di modulo",
                formTypeSelf: "Autoriflessione (Collaboratore)",
                formTypeManager: "Valutazione (Manager)",
                selfReflectionNote: "‚ö†Ô∏è Si prega di inviare questa autoriflessione al proprio manager almeno una settimana prima del colloquio.",
                partB: "Parte B: Raggiungimento Obiettivi (COSA) ‚Äì Peso 50%",
                partC: "Parte C: Competenze Chiave (COME)",
                compName: "Competenza",
                partCLead: "Parte C.2: Competenze Leadership",
                partC3: "Parte C.3: Global Performance Score (GPS)",
                partD: "Parte D: Punti di forza & Pianificazione Sviluppo",
                partE: "Parte E: Prospettiva di carriera & Obiettivi",
                partF: "Parte F: Feedback del Collaboratore",
                partH: "Parte G: Firme & Accettazione",
                employee: "Collaboratore (Cognome, Nome)",
                position: "Posizione / Funzione",
                manager: "Responsabile (Cognome, Nome)",
                date: "Data del colloquio",
                period: "Periodo di valutazione",
                to: "al",
                hintGPS: "Nota: Il GPS viene calcolato interattivamente qui. Trasferire i valori finali dalla calibrazione.",
                profile: "Profilo / Ruolo",
                roleEmp: "Collaboratore (50% COSA / 50% Comp. Chiave)",
                roleMgr: "Manager (50% COSA / 25% Chiave / 25% Lead)",
                goalName: "Descrizione Obiettivo",
                weight: "Peso %",
                achievement: "Raggiunto %",
                barsLevel: "Voto BARS",
                strengths: "D.1 Punti di forza identificati",
                strengthsProfessional: "Punti di forza tecnici (Cosa riesce particolarmente bene?):",
                strengthsPersonal: "Punti di forza personali (Quali competenze comportamentali si distinguono?):",
                development: "D.2 Aree di sviluppo & Misure",
                devIntro: "Quali competenze devono essere rafforzate?",
                measure: "Misura",
                responsible: "Responsabile",
                deadline: "Attuazione entro",
                careerIntro: "Quali obiettivi di carriera ha il collaboratore?",
                careerOptions: [
                    "Sviluppo verso attivit√† di livello superiore",
                    "Approfondimento nel ruolo attuale (Specialista)",
                    "Aspirazione alla carriera manageriale",
                    "Spostamento laterale (altro settore)",
                    "Mantenimento dell'attivit√† attuale (nessun cambiamento desiderato)"
                ],
                comments: "Spiegazione:",
                feedbackIntro: "Condividi la tua valutazione sulla collaborazione, le condizioni di lavoro e le opportunit√† di sviluppo.",
                feedbackQ1: "1. Ti senti sufficientemente supportato e incoraggiato?",
                feedbackQ2: "2. Quali suggerimenti di miglioramento hai (processi, strumenti, condizioni di lavoro)?",
                feedbackQ3: "3. Quali difficolt√† maggiori hai incontrato quest'anno?",
                feedbackQ4: "4. Qual √® stato il tuo pi√π grande momento di successo personale?",
                feedbackQ5: "5. Come percepisci il cambiamento della strategia aziendale?",
                feedbackQ6: "6. Quali progetti proporresti per il tuo reparto?",
                feedbackQ7: "7. Come valuti il tuo equilibrio vita-lavoro? (1=molto scarso, 5=molto buono)",
                signatureNote: "La firma conferma che il colloquio ha avuto luogo.",
                signatureEmp: "Firma Collaboratore",
                signatureMgr: "Firma Responsabile",
                print: "Scarica come PDF",
                generating: "Generazione PDF...",
                calcAuto: "Calcolato automaticamente",
                totalWas: "Score COSA",
                totalWie: "Score COME",
                addGoal: "Aggiungi Obiettivo",
                addDev: "Aggiungi Misura",
                addComp: "Aggiungi Competenza",
                totalWeight: "Peso Totale",
                shouldBe100: "dovrebbe essere 100%",
                rating: "Rating",
                comment: "Commento / Motivazione",
                barsCompetency: {
                    fach: {
                        1: "Non soddisfa ‚Äì Lacune evidenti, nessuna base tecnica",
                        2: "Necessita miglioramento ‚Äì Processi standard ok, in difficolt√† con deviazioni",
                        3: "Baseline ‚Äì Autonomo, affidabile, alta qualit√†",
                        4: "Supera ‚Äì Padroneggia contesti complessi, agisce preventivamente",
                        5: "Eccezionale ‚Äì Autorit√† tecnica, riconosciuto tra sedi"
                    },
                    komm: {
                        1: "Non soddisfa ‚Äì Si isola, mentalit√† difensiva",
                        2: "Necessita miglioramento ‚Äì Reattivo, canali inefficienti",
                        3: "Baseline ‚Äì Proattivo, rispettoso, condivide conoscenze",
                        4: "Supera ‚Äì Crea comprensione, abbatte silos, media conflitti",
                        5: "Eccezionale ‚Äì Stabilisce nuovi standard, rete di fiducia"
                    },
                    prob: {
                        1: "Non soddisfa ‚Äì Blocca, attende passivamente soluzioni esterne",
                        2: "Necessita miglioramento ‚Äì Tratta sintomi, escalation prematura",
                        3: "Baseline ‚Äì Analizza strutturalmente, trova soluzioni pragmatiche",
                        4: "Supera ‚Äì Riconosce pattern, pensa in alternative",
                        5: "Eccezionale ‚Äì Risolve problemi strategici, modello nelle crisi"
                    },
                    adapt: {
                        1: "Non soddisfa ‚Äì Resiste ai cambiamenti",
                        2: "Necessita miglioramento ‚Äì Poca iniziativa per formazione",
                        3: "Baseline ‚Äì Curioso, riflette, si adatta rapidamente",
                        4: "Supera ‚Äì Cerca attivamente conoscenza, catalizzatore per novit√†",
                        5: "Eccezionale ‚Äì Anticipa trend, prepara organizzazione"
                    },
                    orga: {
                        1: "Non soddisfa ‚Äì Caotico, non rispetta scadenze",
                        2: "Necessita miglioramento ‚Äì Funziona sotto guida, insicuro in autonomia",
                        3: "Baseline ‚Äì Organizzato, prioritizza, mantiene impegni",
                        4: "Supera ‚Äì Previdente, ottimizza processi, alleggerisce altri",
                        5: "Eccezionale ‚Äì Coordina progetti complessi, stabilisce standard"
                    },
                    lead: {
                        1: "Non soddisfa ‚Äì Nessun impegno per team, micromanagement",
                        2: "Necessita miglioramento ‚Äì Conduce solo conversazioni 'comode'",
                        3: "Baseline ‚Äì Direzione chiara, sviluppo individuale, coaching",
                        4: "Supera ‚Äì Design strategico team, sviluppa high performer",
                        5: "Eccezionale ‚Äì Costruisce cultura leadership cross-site"
                    },
                    strat: {
                        1: "Non soddisfa ‚Äì Visione tunnel, nessuna lungimiranza",
                        2: "Necessita miglioramento ‚Äì Domina operativit√†, poco legame strategico",
                        3: "Baseline ‚Äì Traduce strategia in obiettivi, mostra connessioni",
                        4: "Supera ‚Äì Anticipa sviluppi, sfida status quo",
                        5: "Eccezionale ‚Äì Plasma direzione strategica, competenza M&A"
                    },
                    decide: {
                        1: "Non soddisfa ‚Äì Evita decisioni, delega sempre verso l'alto",
                        2: "Necessita miglioramento ‚Äì Decide solo con informazioni perfette",
                        3: "Baseline ‚Äì Decide rapidamente, trasparente, sostiene decisioni",
                        4: "Supera ‚Äì Prende decisioni scomode, dosa rischio intelligentemente",
                        5: "Eccezionale ‚Äì Decide strategicamente con coraggio, sovrano nell'incertezza"
                    },
                    exec: {
                        1: "Non soddisfa ‚Äì Non pianifica, nessuna affidabilit√†",
                        2: "Necessita miglioramento ‚Äì Follow-up incoerente, troppo indulgente",
                        3: "Baseline ‚Äì Obiettivi chiari, aspettative comprensibili, richiede risultati",
                        4: "Supera ‚Äì Rigoroso, bilancia pressione & supporto, pensa in KPI",
                        5: "Eccezionale ‚Äì Cultura performance cross-site"
                    },
                    stake: {
                        1: "Non soddisfa ‚Äì Ignora stakeholder, provoca conflitti",
                        2: "Necessita miglioramento ‚Äì Reagisce solo a escalation",
                        3: "Baseline ‚Äì Coltiva relazioni proattivamente, modera oggettivamente",
                        4: "Supera ‚Äì Orchestra stakeholder, trova soluzioni win-win",
                        5: "Eccezionale ‚Äì Diplomazia executive-level, previene escalation"
                    }
                }
            },
            en: {
                headerTitle: "Annual Meeting & Performance Review",
                headerSubtitle: "Annual Performance Review | Strategy 2035",
                partA: "Part A: Meeting Data",
                formType: "Form Type",
                formTypeSelf: "Self-Reflection (Employee)",
                formTypeManager: "Assessment (Manager)",
                selfReflectionNote: "‚ö†Ô∏è Please send this self-reflection to your manager at least one week before the meeting.",
                partB: "Part B: Goal Achievement (WHAT) ‚Äì 50% Weight",
                partC: "Part C: Core Competencies (HOW)",
                compName: "Competency",
                partCLead: "Part C.2: Leadership Competencies",
                partC3: "Part C.3: Global Performance Score (GPS)",
                partD: "Part D: Strengths & Development Planning",
                partE: "Part E: Career Perspective & Goals",
                partF: "Part F: Employee Feedback",
                partH: "Part G: Signatures & Agreement",
                employee: "Employee (Last Name, First Name)",
                position: "Position / Function",
                manager: "Manager (Last Name, First Name)",
                date: "Meeting Date",
                period: "Evaluation Period",
                to: "to",
                hintGPS: "Note: The GPS is calculated interactively here. Transfer the final values from calibration.",
                profile: "Profile / Role",
                roleEmp: "Employee (50% WHAT / 50% Core Comp.)",
                roleMgr: "Manager (50% WHAT / 25% Core / 25% Lead)",
                goalName: "Goal Description",
                weight: "Weight %",
                achievement: "Achievement %",
                barsLevel: "BARS Score",
                strengths: "D.1 Identified Strengths",
                strengthsProfessional: "Professional Strengths (What works particularly well?):",
                strengthsPersonal: "Personal Strengths (Which behavioral competencies stand out?):",
                development: "D.2 Development Areas & Measures",
                devIntro: "Which competencies should be strengthened?",
                measure: "Measure",
                responsible: "Responsible",
                deadline: "Implementation by",
                careerIntro: "What career goals does the employee have?",
                careerOptions: [
                    "Development into higher-level activity",
                    "Deepening in current role (Specialist)",
                    "Pursue leadership career",
                    "Lateral move (different area)",
                    "Maintain current activity (no change desired)"
                ],
                comments: "Explanation:",
                feedbackIntro: "Please share your assessment of collaboration, working conditions, and development opportunities.",
                feedbackQ1: "1. Do you feel sufficiently supported and encouraged?",
                feedbackQ2: "2. What improvement suggestions do you have (processes, tools, working conditions)?",
                feedbackQ3: "3. What major difficulties did you encounter this year?",
                feedbackQ4: "4. What was your greatest personal moment of success?",
                feedbackQ5: "5. How do you perceive the change in company strategy?",
                feedbackQ6: "6. What projects would you propose for your department?",
                feedbackQ7: "7. How do you rate your work-life balance? (1=very poor, 5=very good)",
                signatureNote: "The signature confirms that the meeting took place.",
                signatureEmp: "Employee Signature",
                signatureMgr: "Manager Signature",
                print: "Download as PDF",
                generating: "Generating PDF...",
                calcAuto: "Calculated automatically",
                totalWas: "WHAT Score",
                totalWie: "HOW Score",
                addGoal: "Add Goal",
                addDev: "Add Measure",
                addComp: "Add Competency",
                totalWeight: "Total Weight",
                shouldBe100: "should be 100%",
                rating: "Rating",
                comment: "Comment / Justification",
                barsCompetency: {
                    fach: {
                        1: "Does Not Meet ‚Äì Faulty, no professional foundation",
                        2: "Needs Improvement ‚Äì Standard processes okay, overwhelmed with deviations",
                        3: "Baseline ‚Äì Confident, independent, high quality",
                        4: "Exceeds ‚Äì Masters complex contexts, acts preventively",
                        5: "Outstanding ‚Äì Professional authority, recognized across locations"
                    },
                    komm: {
                        1: "Does Not Meet ‚Äì Isolates themselves, defensive mentality",
                        2: "Needs Improvement ‚Äì Reactive, inefficient channels",
                        3: "Baseline ‚Äì Proactive, respectful, shares knowledge willingly",
                        4: "Exceeds ‚Äì Creates understanding, breaks down silos, mediates conflicts",
                        5: "Outstanding ‚Äì Establishes new standards, network of trust"
                    },
                    prob: {
                        1: "Does Not Meet ‚Äì Blocks, passively waits for external solutions",
                        2: "Needs Improvement ‚Äì Addresses symptoms, escalates too early",
                        3: "Baseline ‚Äì Analyzes structurally, finds pragmatic solutions",
                        4: "Exceeds ‚Äì Recognizes patterns, thinks in solution alternatives",
                        5: "Outstanding ‚Äì Solves strategic problems, role model in crises"
                    },
                    adapt: {
                        1: "Does Not Meet ‚Äì Resists changes",
                        2: "Needs Improvement ‚Äì Little initiative for further training",
                        3: "Baseline ‚Äì Curious, reflective, adapts quickly",
                        4: "Exceeds ‚Äì Actively seeks knowledge, catalyst for new things",
                        5: "Outstanding ‚Äì Anticipates trends, prepares organization"
                    },
                    orga: {
                        1: "Does Not Meet ‚Äì Chaotic, misses deadlines",
                        2: "Needs Improvement ‚Äì Functions under guidance, insecure with autonomy",
                        3: "Baseline ‚Äì Organized, prioritizes, keeps commitments",
                        4: "Exceeds ‚Äì Forward-thinking, optimizes processes, relieves others",
                        5: "Outstanding ‚Äì Coordinates complex projects, sets standards"
                    },
                    lead: {
                        1: "Does Not Meet ‚Äì No team commitment, micromanagement",
                        2: "Needs Improvement ‚Äì Only conducts 'comfortable' conversations",
                        3: "Baseline ‚Äì Clear direction, individual development, coaching",
                        4: "Exceeds ‚Äì Strategic team design, develops high performers",
                        5: "Outstanding ‚Äì Builds cross-site leadership culture"
                    },
                    strat: {
                        1: "Does Not Meet ‚Äì Tunnel vision, no foresight",
                        2: "Needs Improvement ‚Äì Dominated by operations, little strategic connection",
                        3: "Baseline ‚Äì Translates strategy into goals, shows connections",
                        4: "Exceeds ‚Äì Anticipates developments, challenges status quo",
                        5: "Outstanding ‚Äì Shapes strategic direction, M&A competence"
                    },
                    decide: {
                        1: "Does Not Meet ‚Äì Avoids decisions, always delegates upward",
                        2: "Needs Improvement ‚Äì Only decides with perfect information",
                        3: "Baseline ‚Äì Decides quickly, transparent, stands by decisions",
                        4: "Exceeds ‚Äì Makes uncomfortable decisions, intelligently manages risk",
                        5: "Outstanding ‚Äì Decides strategically with courage, sovereign in uncertainty"
                    },
                    exec: {
                        1: "Does Not Meet ‚Äì No planning, no reliability",
                        2: "Needs Improvement ‚Äì Inconsistent follow-up, too lenient",
                        3: "Baseline ‚Äì Clear goals, understandable expectations, demands results",
                        4: "Exceeds ‚Äì Rigorous, balances pressure & support, thinks in KPIs",
                        5: "Outstanding ‚Äì Cross-site performance culture"
                    },
                    stake: {
                        1: "Does Not Meet ‚Äì Ignores stakeholders, provokes conflicts",
                        2: "Needs Improvement ‚Äì Only reacts to escalations",
                        3: "Baseline ‚Äì Proactively cultivates relationships, moderates objectively",
                        4: "Exceeds ‚Äì Orchestrates stakeholders, finds win-win solutions",
                        5: "Outstanding ‚Äì Executive-level diplomacy, prevents escalations"
                    }
                }
            }
        };

        const CORE_COMPETENCIES_CALC = [
          { id: 'fach', name: 'Fachkompetenz & Anwendung', nameIt: 'Competenza tecnica & Applicazione', nameEn: 'Technical Expertise & Application', weight: 20 },
          { id: 'komm', name: 'Kommunikation & Zusammenarbeit', nameIt: 'Comunicazione & Collaborazione', nameEn: 'Communication & Collaboration', weight: 20 },
          { id: 'prob', name: 'Probleml√∂sekompetenz', nameIt: 'Capacit√† di problem solving', nameEn: 'Problem-Solving Skills', weight: 20 },
          { id: 'adapt', name: 'Anpassungsf√§higkeit', nameIt: 'Adattabilit√†', nameEn: 'Adaptability', weight: 20 },
          { id: 'orga', name: 'Selbstorganisation', nameIt: 'Autogestione', nameEn: 'Self-Organization', weight: 20 },
        ];

        const LEADERSHIP_COMPETENCIES_CALC = [
          { id: 'lead', name: 'Mitarbeiterf√ºhrung & -entwicklung', nameIt: 'Gestione & Sviluppo del personale', nameEn: 'Employee Management & Development', weight: 20 },
          { id: 'strat', name: 'Strategisches Denken', nameIt: 'Pensiero strategico', nameEn: 'Strategic Thinking', weight: 20 },
          { id: 'decide', name: 'Entscheidungsf√§higkeit', nameIt: 'Capacit√† decisionale', nameEn: 'Decision-Making', weight: 20 },
          { id: 'exec', name: 'Execution & Performance Mgmt', nameIt: 'Execution & Performance Mgmt', nameEn: 'Execution & Performance Mgmt', weight: 20 },
          { id: 'stake', name: 'Stakeholder-Mgmt & Konflikte', nameIt: 'Gestione degli stakeholder & Conflitti', nameEn: 'Stakeholder Mgmt & Conflicts', weight: 20 },
        ];

        const DEFAULTS = {
            de: {
                core: CORE_COMPETENCIES_CALC.map(c => ({...c, rating: 3, comment: ''})),
                lead: LEADERSHIP_COMPETENCIES_CALC.map(c => ({...c, rating: 3, comment: ''}))
            },
            it: {
                core: CORE_COMPETENCIES_CALC.map(c => ({...c, name: c.nameIt, rating: 3, comment: ''})),
                lead: LEADERSHIP_COMPETENCIES_CALC.map(c => ({...c, name: c.nameIt, rating: 3, comment: ''}))
            },
            en: {
                core: CORE_COMPETENCIES_CALC.map(c => ({...c, name: c.nameEn, rating: 3, comment: ''})),
                lead: LEADERSHIP_COMPETENCIES_CALC.map(c => ({...c, name: c.nameEn, rating: 3, comment: ''}))
            }
        };

        // --- APPLICATION DATA (Competencies and Levels) ---
        const APP_DATA = {
          de: {
            intro: {
              values: [
                { key: "Fast", desc: "Wir agieren schnell und l√∂sungsorientiert.", icon: Zap, color: "text-yellow-600" },
                { key: "Fair", desc: "Wir arbeiten respektvoll und auf Augenh√∂he zusammen.", icon: Scale, color: "text-blue-600" },
                { key: "Personal", desc: "Wir √ºbernehmen Verantwortung und gestalten aktiv.", icon: Heart, color: "text-red-600" }
              ]
            },
            competencies: [
            {
              id: "c1",
              title: "Fachkompetenz & Anwendung",
              category: "core",
              icon: Briefcase,
              definition: `Bewertet spezifisches Fachwissen und dessen Anwendung. Es geht nicht nur um theoretisches K√∂nnen, sondern den Beitrag zu Prozesssicherheit und Qualit√§t.`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende verf√ºgt nicht √ºber das f√ºr die Position zwingend erforderliche fachliche Fundament. Aufgaben werden h√§ufig fehlerhaft oder unvollst√§ndig ausgef√ºhrt (z. B. falsche Dateneingaben, Fehlbedienung von Anlagen, Falschausk√ºnfte an Kunden), was zu Nacharbeit, Beschwerden oder Risiken f√ºhrt. Es fehlt das Verst√§ndnis f√ºr die fachlichen Standards und Regeln des eigenen Bereichs. Auch nach Einarbeitung oder Feedback treten dieselben inhaltlichen Fehler wiederholt auf. Der/die Mitarbeitende zeigt wenig Antrieb, diese Wissensl√ºcken eigenst√§ndig zu schlie√üen. Komplexe Zusammenh√§nge des eigenen Fachgebiets werden nicht durchdrungen; man verl√§sst sich darauf, dass andere die fachliche Richtigkeit pr√ºfen.`, 
                  example: `Admin: Pflegt Stammdaten wiederholt falsch ein, versteht die Auswirkung auf Rechnungen nicht.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende beherrscht Standardprozesse und Routineaufgaben in seinem Fachgebiet sicher, st√∂√üt aber bei Abweichungen, Spezialf√§llen oder neuen Anforderungen schnell an Grenzen. Das Wissen wird eher nach ‚ÄûVorschrift‚Äú angewendet, ohne das tiefere ‚ÄûWarum‚Äú oder die Auswirkungen auf angrenzende Bereiche zu verstehen. Zur L√∂sung von fachlichen Problemen wird prim√§r auf Anweisung gewartet oder sofort eskaliert, anstatt vorhandene Ressourcen (Dokumentation, Recherche, System-Hilfen) zu nutzen. Die Qualit√§t der Arbeitsergebnisse ist schwankend, insbesondere wenn es stressig wird. Fachliche Neuerungen (z.B. neue Software-Features, ge√§nderte Kundenanforderungen) werden nur z√∂gerlich adaptiert.`, 
                  example: `IT: L√∂st Standard-Passw√∂rter, ist aber bei komplexeren Netzwerkproblemen sofort √ºberfordert und eskaliert ohne Diagnose.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende beherrscht sein Aufgabengebiet souver√§n und liefert konstant qualitativ hochwertige Ergebnisse (korrekte Auftragsabwicklung, stabile Systemverf√ºgbarkeit, pr√§zise Werkst√ºcke). Er/Sie arbeitet im Tagesgesch√§ft vollkommen selbstst√§ndig. Auftretende fachliche Probleme l√∂st er/sie z√ºgig eigenst√§ndig oder holt gezielt und rechtzeitig Unterst√ºtzung ein. Er/Sie ist in der Lage, sein Wissen situativ an Kollegen weiterzugeben (kurze Einweisungen, Troubleshooting-Tipps) und tr√§gt damit zur Stabilit√§t des Teams bei. Fachliche Standards werden konsequent eingehalten.`, 
                  example: `Produktion: Bedient Anlage fehlerfrei nach Spezifikation. Behebt kleine St√∂rungen (Sensor-Reset, Materialstau) selbstst√§ndig innerhalb von 10 Minuten. Zeigt neuen Kollegen die kritischen Handgriffe ohne lange Erkl√§rungen.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende durchdringt auch komplexe fachliche Zusammenh√§nge tiefgehend und erkennt Wechselwirkungen, die anderen entgehen (z.B. wie eine √Ñnderung im Auftrag die Produktionsplanung beeinflusst). Er/Sie agiert pr√§ventiv: Risiken oder Fehlerquellen werden identifiziert und eliminiert, bevor sie zum Problem werden. Das Fachwissen wird genutzt, um bestehende Abl√§ufe aktiv zu optimieren und effizienter zu gestalten. Kollegen wenden sich bei kniffligen fachlichen Fragen aktiv an diese Person (‚ÄûGo-to-Person‚Äú). Der/die Mitarbeitende gibt Wissen proaktiv weiter und sorgt f√ºr einen hohen Standard im Team. Er/Sie blickt √ºber den eigenen Schreibtisch hinaus und versteht die Anforderungen der internen Schnittstellenpartner genau.`, 
                  example: `Customer Service: Pr√ºft bei spezifischer Frage proaktiv mit Labor die Machbarkeit und schl√§gt sicherere Alternative vor.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende gilt als absolute fachliche Autorit√§t auf seinem Gebiet, deren Expertise auch standort√ºbergreifend (Sulzberg/Bozen/Campogalliano) gesch√§tzt und angefragt wird. Er/Sie nutzt sein exzellentes Wissen, um signifikante Verbesserungen f√ºr die Gruppe zu erzielen (z. B. Einf√ºhrung konzernweiter Standards im Customer Service, massive Effizienzsteigerung durch neue IT-L√∂sungen). Diese Person fungiert als Multiplikator. Sie bereitet komplexes Fachwissen so auf, dass es f√ºr die Organisation nutzbar wird (z.B. Schulungen, Best-Practice-Leitf√§den). Er/Sie antizipiert zuk√ºnftige Entwicklungen im Fachbereich (z.B. Markttrends, neue Technologien) und bereitet das Unternehmen proaktiv darauf vor. Fachliche Exzellenz wird hier zum direkten Mehrwert f√ºr den Unternehmenserfolg.`, 
                  example: `Group Function: Entwickelt einheitlichen Service-Standard f√ºr alle Standorte (DE/IT), schult Teams, sorgt f√ºr 'One Voice'.` 
                }
              }
            },
            {
              id: "c2",
              title: "Kommunikation & Zusammenarbeit",
              category: "core",
              icon: MessageCircle,
              definition: `Qualit√§t des Informationsaustauschs und das Miteinander. 'One Niederwieser' bedeutet: Zusammenarbeit endet nicht an der B√ºrot√ºr oder L√§ndergrenze.`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende beh√§lt arbeitskritische Informationen f√ºr sich oder gibt sie so unvollst√§ndig weiter, dass Kollegen oder Kunden nachfragen m√ºssen und Fehler entstehen. Er/Sie kapselt sich ab und zeigt kein Interesse an gemeinsamer Zielerreichung. Bei Problemen wird Verantwortung abgeschoben (‚ÄûNicht meine Zust√§ndigkeit") oder Unterst√ºtzung verweigert. Die Kommunikation ist gepr√§gt von Absicherungsmentalit√§t (CC-Schlachten) statt L√∂sungsorientierung. Konflikte werden ignoriert, hinter dem R√ºcken ausgetragen oder unsachlich eskaliert. Das Verhalten verletzt Grundwerte des Respekts und der Fairness.`, 
                  example: `Produktion: Gibt bei Schicht√ºbergabe trotz kritischer Maschinenst√∂rung nur ‚ÄûAlles ok" weiter, um schnell nach Hause zu gehen. Nachschicht entdeckt Problem erst nach 2 Stunden Stillstand.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende kommuniziert prim√§r reaktiv: Informationen flie√üen oft erst auf explizite Nachfrage (‚ÄûHolschuld‚Äú statt ‚ÄûBringschuld‚Äú). Er/Sie fokussiert sich stark auf den eigenen Aufgabenbereich und blendet die Bed√ºrfnisse angrenzender Abteilungen oder Kollegen aus. In Meetings oder Projekten bringt er/sie sich kaum proaktiv ein. Der gew√§hlte Kommunikationskanal ist h√§ufig ineffizient (z. B. langes Hin-und-Her-Schreiben bei komplexen Themen statt eines kurzen, kl√§renden Anrufs ‚Äì entgegen dem Prinzip ‚ÄûPhone before Email‚Äú). Feedback wird oft pers√∂nlich genommen oder defensiv abgewehrt. Die Zusammenarbeit funktioniert im Routinebetrieb, wird aber bei Stress, Unklarheit oder abteilungs√ºbergreifenden Themen schnell holprig.`, 
                  example: `Backoffice: Schreibt tagelang E-Mails hin und her statt den Fall in 2 Minuten telefonisch zu kl√§ren.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende informiert Kollegen und Schnittstellenpartner proaktiv, vollst√§ndig und rechtzeitig √ºber alles Relevante (z.B. Status-Updates, Verz√∂gerungen, Abwesenheiten). Er/Sie w√§hlt situationsbedingt den effizientesten Kanal (greift zum H√∂rer, wenn Dinge schnell gekl√§rt werden m√ºssen). Der Umgangston ist stets wertsch√§tzend und auf Augenh√∂he, unabh√§ngig von Hierarchie oder Standort. Er/Sie bietet Kollegen Unterst√ºtzung an, wenn Not am Mann ist, und teilt Wissen bereitwillig. In Meetings ist er/sie pr√§sent, gut vorbereitet und konstruktiv. Konflikte werden sachlich und direkt angesprochen. Er/Sie tr√§gt stabil zu einer positiven, professionellen Arbeitsatmosph√§re bei.`, 
                  example: `Sales: Informiert bei Lieferverzug sofort Kunden und Au√üendienst proaktiv mit neuem Termin.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende kommuniziert nicht nur Informationen, sondern schafft Verst√§ndnis. Er/Sie passt die Kommunikation gezielt an das Gegen√ºber an (z. B. √ºbersetzt technische Details f√ºr Laien, bereitet Daten f√ºr Entscheider auf) und stellt sicher, dass die Botschaft korrekt ankommt. Er/Sie agiert aktiv als Bindeglied zwischen Abteilungen und baut Silos ab. Bei Konflikten oder Missverst√§ndnissen im Team √ºbernimmt er/sie eine vermittelnde Rolle und sucht nach einer gemeinsamen L√∂sung (‚ÄûWin-Win‚Äú), anstatt Recht haben zu wollen. Er/Sie gibt konstruktives, entwicklungsorientiertes Feedback, das anderen hilft, besser zu werden. Die Zusammenarbeit mit dieser Person macht das gesamte Umfeld messbar effizienter und motivierter.`, 
                  example: `Schnittstelle: Moderiert bei Konflikt zwischen Produktion und Service, schafft Regelung f√ºr Eilauftr√§ge.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende etabliert neue Standards der Zusammenarbeit, die √ºber das eigene Team hinauswirken (z. B. Initiierung regelm√§√üiger Austauschformate zwischen den Standorten Sulzberg und Campogalliano oder zwischen Sales und Technik). Er/Sie lebt die Werte Fast, Fair, Personal so vorbildlich, dass er/sie als Rollenmodell wirkt und andere mitrei√üt. Er/Sie schafft ein Netzwerk des Vertrauens im gesamten Unternehmen und nutzt dieses, um komplexe, abteilungs√ºbergreifende Probleme schnell und unb√ºrokratisch zu l√∂sen. Er/Sie wird bei schwierigen Kommunikationssituationen (z. B. Change-Prozesse, Krisen) als Mentor oder Mediator hinzugezogen. Er/Sie sorgt aktiv daf√ºr, dass wir intern und extern ‚Äûmit einer Stimme‚Äú sprechen.`, 
                  example: `HR: Initiiert standort√ºbergreifendes Sounding Board, um kulturelle Unterschiede zwischen Bozen und Sulzberg zu kl√§ren.` 
                }
              }
            },
            {
              id: "c3",
              title: "Probleml√∂sekompetenz",
              category: "core",
              icon: ShieldAlert,
              definition: `Umgang mit Hindernissen. Wir unterscheiden Troubleshooting (Symptome) vs. Ursachenforschung (Wurzel).`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende erkennt Probleme oft erst, wenn sie bereits eskaliert sind, oder ignoriert offensichtliche Warnsignale (z.B. Fehlermeldungen, Kundenbeschwerden, Qualit√§tsabweichungen). Er/Sie zeigt keine Eigeninitiative zur L√∂sung, sondern wartet passiv auf Anweisungen (‚ÄûDienst nach Vorschrift‚Äú). Bei Schwierigkeiten wird schnell aufgegeben oder die Verantwortung auf andere (Kollegen, IT, Lieferanten) geschoben. Fehler werden vertuscht oder kleingeredet, statt sie offen anzusprechen. Es findet kein Lernen aus Fehlern statt: Das exakt gleiche Problem tritt immer wieder auf, ohne dass das Verhalten ge√§ndert wird.`, 
                  example: `Admin: Klickt Fehlermeldung im ERP einfach weg, ohne Info. Am Monatsende stimmen Zahlen nicht.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende meldet Probleme zwar (‚ÄûHier stimmt was nicht‚Äú), tr√§gt aber kaum selbst zur L√∂sung bei. Er/Sie verl√§sst sich stark auf die F√ºhrungskraft oder erfahrene Kollegen, um den Weg aus der Krise zu finden. L√∂sungsversuche bleiben oft an der Oberfl√§che: Es werden Symptome bek√§mpft (z. B. Maschine einfach neustarten, Kunde vertr√∂sten), aber nicht die eigentlichen Ursachen. Sobald ein erstes Hindernis bei der L√∂sungsfindung auftaucht, stoppt der Prozess. Er/Sie ben√∂tigt detaillierte Anleitung, um auch Standardprobleme zu beheben. Es fehlt der Blick f√ºr die Konsequenzen: Eine ‚Äûschnelle L√∂sung‚Äú schafft oft an anderer Stelle neue Probleme.`, 
                  example: `Produktion: Reduziert Maschinengeschwindigkeit damit Falten verschwinden, statt mechanische Ursache zu suchen.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende erkennt Probleme im eigenen Aufgabenbereich fr√ºhzeitig und geht sie eigenst√§ndig an. Er/Sie nutzt verf√ºgbare Informationen (Daten, Handb√ºcher, Historie) und Werkzeuge, um pragmatische L√∂sungen zu finden, die funktionieren. Er/Sie unterscheidet sicher, was er/sie selbst l√∂sen kann und wann eine Eskalation notwendig ist ‚Äì informiert dann aber pr√§zise und l√∂sungsorientiert (kommt mit einem Vorschlag, nicht nur mit der Beschwerde). Die L√∂sungen sind solide und nachhaltig f√ºr den Arbeitsalltag. Er/Sie bleibt auch in stressigen Situationen handlungsf√§hig (‚ÄûK√ºhler Kopf‚Äú). Nach einem Fehler wird Verantwortung √ºbernommen (‚ÄûAccountability‚Äú) und korrigiert, statt Ausreden zu suchen.`, 
                  example: `Customer Service: Lokalisiert fehlende Ware, informiert Kunden ehrlich, l√∂st Konflikt professionell.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende l√∂st nicht nur das akute Problem, sondern betreibt systematische Ursachenforschung (z.B. ‚Äû5-Why‚Äú-Methode, Datenanalyse), um zu verstehen, warum es passiert ist. Er/Sie entwickelt Ma√ünahmen, die verhindern, dass der Fehler jemals wieder auftritt (Fehlervermeidung). Er/Sie denkt √ºber den eigenen Bereich hinaus: Wenn ein Problem Schnittstellen betrifft (z. B. √úbergabe Sales an Produktion), wird das aktiv adressiert und gel√∂st. Er/Sie unterst√ºtzt Kollegen bei schwierigen Herausforderungen und bringt kreative, unkonventionelle Ans√§tze ein, wenn Standardl√∂sungen nicht greifen. Probleme werden als Chance zur Verbesserung begriffen.`, 
                  example: `Logistik: Analysiert Versp√§tungs-Daten, spricht mit Spediteur und passt Abholprozess dauerhaft an.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende identifiziert komplexe, strukturelle Probleme oder Risiken, die anderen noch gar nicht aufgefallen sind, und entwickelt daf√ºr umfassende Konzepte. Die L√∂sungen haben oft positiven Einfluss auf mehrere Abteilungen oder Standorte der Gruppe (Sulzberg/Bozen/Campogalliano). Er/Sie etabliert neue Standards oder ‚ÄûBest Practices‚Äú zur Probleml√∂sung, die im Unternehmen √ºbernommen werden. Er/Sie verwandelt Probleme in echte Innovationen oder Wettbewerbsvorteile f√ºr Niederwieser. Bei Krisen √ºbernimmt er/sie informell die F√ºhrung (‚ÄûTroubleshooter‚Äú) und navigiert das Team sicher durch unsicheres Terrain.`, 
                  example: `Quality: Initiiert Task-Force f√ºr Materialfehler √ºber Standorte hinweg, f√ºhrt neuen Gruppen-Standard ein.` 
                }
              }
            },
            {
              id: "c4",
              title: "Anpassungsf√§higkeit & Lernbereitschaft",
              category: "core",
              icon: BookOpen,
              definition: `Wille, sich auf neue Rahmenbedingungen (IT, Markt, Prozesse) einzustellen. 'Growth Mindset' statt Status Quo.`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende reagiert auf Neuerungen (z.B. neue Software, Umstrukturierungen) mit offener Ablehnung, Zynismus oder Blockadehaltung. Er/Sie h√§lt starr an veralteten Methoden fest (‚ÄûDas haben wir schon immer so gemacht‚Äú) und weigert sich, neue F√§higkeiten zu erlernen. Ver√§nderungen f√ºhren zu einem massiven Leistungseinbruch oder schlechter Laune, die das Team ansteckt. Er/Sie ben√∂tigt unverh√§ltnism√§√üig viel √úberzeugungsarbeit und Druck, um selbst kleinste Anpassungen im Arbeitsablauf umzusetzen. Feedback zur pers√∂nlichen Weiterentwicklung wird ignoriert oder als Angriff gewertet.`, 
                  example: `Lager: Weigert sich, neue Scanner zu nutzen, f√ºhrt private Handlisten weiter.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende akzeptiert Ver√§nderungen erst nach l√§ngerem Z√∂gern oder Murren. Er/Sie wartet ab, ob die Neuerung ‚Äûwirklich bleibt‚Äú, bevor er/sie sich bewegt. Das Erlernen neuer Aufgaben oder Systeme dauert deutlich l√§nger als bei vergleichbaren Kollegen, da die innere Motivation fehlt. Er/Sie zeigt wenig Eigeninitiative zur Weiterbildung; neues Wissen wird nur angeeignet, wenn es explizit angeordnet oder ‚Äûvorgekaut‚Äú wird. In Stresssituationen oder bei unklaren neuen Anforderungen f√§llt er/sie schnell in alte, ineffiziente Verhaltensmuster zur√ºck. Die Anpassungsf√§higkeit reicht f√ºr dynamische Phasen nicht aus.`, 
                  example: `Finance: Druckt trotz papierlosem System weiter Mails aus. Lernt neuen Prozess nur langsam.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende geht konstruktiv mit Ver√§nderungen um und passt seine Arbeitsweise an neue Gegebenheiten an. Er/Sie setzt neue Vorgaben (z. B. Nutzung eines neuen Tools, ge√§nderter Schichtplan) verl√§sslich und ohne gro√ües Klagen um. Die Einarbeitung in neue Themen erfolgt in angemessener Zeit. Er/Sie erkennt, wann Wissen fehlt, und nutzt die angebotenen Schulungen oder Hilfsmittel, um die L√ºcke zu schlie√üen. Er/Sie blockiert Innovationen nicht, sondern tr√§gt sie im Tagesgesch√§ft mit. Man kann sich darauf verlassen, dass er/sie auch in einem sich wandelnden Umfeld stabil seine Leistung bringt (‚ÄûFair‚Äú gegen√ºber dem Team).`, 
                  example: `Sales: Nimmt an Schulung f√ºr neue nachhaltige Folien teil und ber√§t Kunden ab Stichtag kompetent.` 
                },
                4: { 
                  text: `Der/die Mitarbeitende sieht Ver√§nderungen als Chance zur Verbesserung. Er/Sie wartet nicht auf Schulungen, sondern eignet sich neues Wissen (z. B. √ºber neue Produkte, Markttrends oder Software-Kniffe) eigenst√§ndig an. Er/Sie experimentiert mit neuen L√∂sungsans√§tzen und teilt die Erkenntnisse mit dem Team. In Phasen des Umbruchs wirkt er/sie stabilisierend auf andere und hilft Kollegen, die sich mit der Ver√§nderung schwerer tun (z.B. als ‚ÄûBuddy‚Äú bei neuen Systemen). Er/Sie hinterfragt den Status quo konstruktiv und macht Vorschl√§ge, wie man sich besser an neue Anforderungen anpassen kann.`, 
                  example: `Service: Klickt sich schon vor Schulung durch neues CRM, hilft danach Kollegen beim Start.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende antizipiert notwendige Ver√§nderungen oft fr√ºher als andere und bereitet sich und das Umfeld proaktiv darauf vor (z.B. Erwerb von Zukunftskompetenzen, bevor sie akut gebraucht werden). Er/Sie treibt Innovationen voran, die das Unternehmen zukunftsf√§hig machen (z. B. Pilotierung komplett neuer Arbeitsweisen). Er/Sie etabliert eine Kultur des Lernens im eigenen Bereich, indem er/sie Fehler als Lernchance vorlebt und andere zum Ausprobieren ermutigt (‚ÄûEmpowerment‚Äú). Er/Sie agiert als Leuchtturm bei strategischen Gro√üprojekten (z.B. Harmonisierung der Standorte) und schafft Begeisterung f√ºr den neuen Weg, selbst bei anf√§nglichen Widerst√§nden.`, 
                  example: `IT: Initiiert eigenst√§ndig KI-Pilotprojekt (Copilot), kl√§rt Datenschutz und schult andere Standorte.` 
                }
              }
            },
            {
              id: "c5",
              title: "Selbstorganisation & Zuverl√§ssigkeit",
              category: "core",
              icon: Clock,
              definition: `Strukturierung der Arbeit, Priorisierung und Accountability. Kann man sich auf das Wort verlassen?`,
              levels: {
                1: { 
                  text: `Der/die Mitarbeitende arbeitet unsystematisch und ohne erkennbare Struktur. Aufgaben werden vergessen, Deadlines ohne Vorwarnung gerissen oder Termine vers√§umt. Er/Sie l√§sst sich leicht ablenken und verliert den Fokus auf das Wesentliche. Die F√ºhrungskraft oder Kollegen m√ºssen st√§ndig nachfassen (‚ÄûBabysitting‚Äú), damit Ergebnisse geliefert werden. Es fehlt der √úberblick √ºber offene Aufgaben; Zusagen werden leichtfertig gemacht und nicht eingehalten. Der Arbeitsplatz (physisch oder digital) ist unorganisiert, sodass wichtige Unterlagen oder Informationen nicht griffbereit sind. Die Unzuverl√§ssigkeit belastet das Team massiv.`, 
                  example: `Sales: Vergisst Besuchsberichte, verlegt Zettel mit Kundenanfragen. Kein √úberblick.` 
                },
                2: { 
                  text: `Der/die Mitarbeitende erledigt einfache Routineaufgaben zuverl√§ssig, ger√§t aber bei mehreren parallelen Aufgaben oder Zeitdruck schnell ins Schwimmen. Er/Sie hat Schwierigkeiten, Wichtiges von Unwichtigem zu unterscheiden (macht z.B. das, was Spa√ü macht, zuerst, nicht das, was eilt). Planung findet nur sehr kurzfristig (von Tag zu Tag) statt. Wenn es eng wird, kommuniziert er/sie dies nicht rechtzeitig, sondern erst, wenn das Kind bereits in den Brunnen gefallen ist. Die Qualit√§t der Arbeit leidet unter fehlender Sorgfalt oder Zeitmanagement. Er/Sie ben√∂tigt regelm√§√üige Steuerung und Erinnerungen durch die F√ºhrungskraft, um auf Kurs zu bleiben.`, 
                  example: `Werkstatt: R√§umt auf, obwohl dringende Eil-Reparatur die Produktion blockiert.` 
                },
                3: { 
                  text: `BASELINE: Der/die Mitarbeitende organisiert seinen Arbeitsalltag selbstst√§ndig und priorisiert Aufgaben sinnvoll nach Dringlichkeit und Wichtigkeit. Zusagen und Termine werden verl√§sslich eingehalten. Sollte eine Deadline gef√§hrdet sein, informiert er/sie mindestens 48 Stunden im Voraus proaktiv (‚ÄûTransparency"). Sein Arbeitsplatz und seine Systeme sind so strukturiert, dass wichtige Informationen jederzeit in unter 2 Minuten auffindbar sind (saubere Ablage, gepflegte To-Do-Listen). Man kann sich auf sein Wort verlassen.`, 
                  example: `Admin: Hat digitale Wiedervorlage im Griff (farbcodierte Priorit√§ten). Meldet am Dienstag, dass Monatsabschluss wegen Krankheitsausfall im Team 2 Tage sp√§ter kommt ‚Äì schl√§gt gleichzeitig L√∂sung vor (Unterst√ºtzung aus anderem Standort).` 
                },
                4: { 
                  text: `Der/die Mitarbeitende plant vorausschauend (2-3 Monate im Voraus) und erkennt Engp√§sse, bevor sie entstehen (Urlaubszeiten, Projekt-Deadlines, Ressourcenknappheit). Er/Sie optimiert aktiv die eigene Arbeitsweise (Nutzung digitaler Tools, Checklisten, B√ºndelung √§hnlicher Aufgaben). Er/Sie bleibt auch bei 120% Auslastung strukturiert und liefert Ergebnisse p√ºnktlich ab. Seine Zuverl√§ssigkeit macht ihn/sie zu einer festen S√§ule im Team ‚Äì Kollegen wissen: ‚ÄûBei X ist es sicher aufgehoben."`, 
                  example: `Projektmanagement: Erstellt 4 Wochen vor Urlaub detaillierte √úbergabemappe mit Status aller Projekte, offenen Punkten und Ansprechpartnern. Bereitet kritische Aufgaben vor (Vorratsbriefings, vorgefertigte Entscheidungsvorlagen). Vertretung kann nahtlos √ºbernehmen.` 
                },
                5: { 
                  text: `Der/die Mitarbeitende entwickelt Organisationssysteme oder Workflows, die nicht nur ihm/ihr selbst, sondern dem ganzen Team oder der Abteilung helfen, effizienter zu arbeiten (z. B. Einf√ºhrung eines Kanban-Boards, Standardisierung der Ablage f√ºr die Gruppe). Er/Sie managt hochkomplexe Aufgabenpakete mit vielen Abh√§ngigkeiten (z. B. standort√ºbergreifende Projekte) souver√§n und termingerecht. Er/Sie gilt als ‚Äûsicherer Hafen‚Äú f√ºr kritische Aufgaben: Wenn er/sie es √ºbernimmt, ist der Erfolg garantiert. Er/Sie schafft durch exzellente Organisation Freir√§ume f√ºr strategische Themen und Innovationen.`, 
                  example: `Marketing: Etabliert digitales Planungstool f√ºr alle Standorte (Sulzberg/Bozen/Campo), eliminiert Doppelarbeit.` 
                }
              }
            },
            {
              id: "l1",
              title: "Mitarbeiterf√ºhrung & -entwicklung", // Korrigierte Titel
              category: "leadership",
              icon: Users,
              definition: `Steuerung, Motivation und Entwicklung des Teams. 'Leadership' statt nur 'Management'.`, // Ge√§ndert f√ºr DE
              levels: {
                1: { 
                  text: `Die F√ºhrungskraft vernachl√§ssigt ihre Kernaufgaben: Mitarbeitergespr√§che (Jahresgespr√§ch, Check-ins) finden nicht statt, sind extrem versp√§tet oder werden als l√§stige Pflicht√ºbung abgehandelt. Es gibt kein konstruktives Feedback; Kritik erfolgt oft unsachlich oder vor anderen. Entwicklungsw√ºnsche der Mitarbeitenden werden ignoriert oder blockiert (‚ÄûDaf√ºr haben wir keine Zeit‚Äú). Ziele werden unklar oder gar nicht kommuniziert, was zu Orientierungslosigkeit f√ºhrt. Das Verhalten widerspricht unseren Werten massiv (z.B. Respektlosigkeit, ‚ÄûDivide and Conquer‚Äú). Im Team herrscht eine Atmosph√§re der Angst oder Gleichg√ºltigkeit, was zu hoher Fluktuation oder innerer K√ºndigung f√ºhrt.`, 
                  example: `Prod-Leiter: Sagt Jahresgespr√§ch 3x ab, f√ºhrt es dann in 15min zwischen T√ºr und Angel.` 
                },
                2: { 
                  text: `Die F√ºhrungskraft erledigt die administrativen Pflichten (Urlaubsfreigabe, formale Gespr√§che), aber ohne Tiefe. Feedback gibt es meist nur, wenn etwas schiefgelaufen ist (reaktiv), kaum Lob oder Orientierung f√ºr die Zukunft. Die F√ºhrungsarbeit beschr√§nkt sich auf das Zuweisen von Aufgaben (‚ÄûMicromanagement‚Äú), statt Verantwortung zu delegieren. Entwicklungspl√§ne (IDPs) werden zwar ausgef√ºllt, verschwinden dann aber in der Schublade und werden nicht nachverfolgt. Die F√ºhrungskraft nimmt sich zu wenig Zeit f√ºr das Team (‚ÄûT√ºr zu‚Äú). Es fehlt an Klarheit und Inspiration; das Team arbeitet ‚ÄûDienst nach Vorschrift‚Äú, aber nicht mehr.`, 
                  example: `Teamleiter: Nutzt Copy-Paste f√ºr Ziele. Antwortet auf Entwicklungswunsch vage 'Schauen wir mal'.` 
                },
                3: { 
                  text: `BASELINE: Die F√ºhrungskraft f√ºhrt alle verpflichtenden Gespr√§che (Review, Zielsetzung) p√ºnktlich, gut vorbereitet und auf Augenh√∂he durch. Sie sorgt f√ºr klare Ziele und Erwartungen, sodass jeder wei√ü, was zu tun ist. Feedback erfolgt regelm√§√üig und fair ‚Äì sowohl positiv als auch korrigierend. Sie unterst√ºtzt die fachliche Weiterentwicklung (z.B. Genehmigung von Schulungen) und ist f√ºr die Mitarbeitenden bei Problemen ansprechbar. Sie lebt die Werte ‚ÄûFast, Fair, Personal‚Äú im Alltag vor und sorgt f√ºr ein stabiles, positives Arbeitsklima. Sie behandelt alle Teammitglieder gerecht und diskriminierungsfrei.`, 
                  example: `Sales Director: Regelm√§√üige Check-ins, lobt Erfolge, spricht Defizite offen an. Team kennt Ziele.` 
                },
                4: { 
                  text: `Die F√ºhrungskraft nutzt F√ºhrung aktiv, um Mitarbeitende besser zu machen. Sie delegiert nicht nur Aufgaben, sondern Verantwortung, um Wachstum zu erm√∂glichen (‚ÄûEmpowerment‚Äú). Sie f√ºhrt regelm√§√üige, informelle Feedback-Gespr√§che (√ºber den Standardprozess hinaus) und nutzt Coaching-Methoden, um Mitarbeitende zur eigenen L√∂sungsfindung anzuregen. Sie erkennt Potenziale proaktiv und schl√§gt individuelle Entwicklungsma√ünahmen vor (z. B. Projektleitung, Job Rotation). Sie schafft eine Teamkultur, in der Fehler offen besprochen werden, um daraus zu lernen. Die Zusammenarbeit mit dieser Person macht das gesamte Umfeld messbar effizienter und motivierter.`, 
                  example: `IT-Leiter: Delegiert Projektleitung an Talent, gibt spezifisches Feedback, st√§rkt Selbstvertrauen.` 
                },
                5: { 
                  text: `Die F√ºhrungskraft baut systematisch Nachfolger auf und entwickelt High-Potentials auch √ºber den eigenen Bedarf hinaus (f√ºr die Gruppe). Sie gilt als Mentor im gesamten Unternehmen, dessen Rat auch von Mitarbeitenden anderer Bereiche gesucht wird. Sie schafft ein Umfeld der Exzellenz, in dem sich Talente entfalten k√∂nnen, und bindet Leistungstr√§ger langfristig an Niederwieser. Sie steuert die Personalplanung strategisch vorausschauend (z.B. f√ºr die n√§chsten 2-3 Jahre) und sorgt daf√ºr, dass das Team bereit f√ºr zuk√ºnftige Herausforderungen der Strategie 2035. Unter ihrer F√ºhrung entstehen Innovationen und √ºberdurchschnittliche Ergebnisse durch Synergieeffekte.`, 
                  example: `Manager: Empfiehlt Top-Mitarbeiter proaktiv f√ºr Stelle an anderem Standort, statt ihn zu 'horten'.` 
                }
              }
            },
            {
              id: "l2",
              title: "Strategisches Denken",
              category: "leadership",
              icon: Brain,
              definition: `Das 'gro√üe Ganze' sehen. Weg vom Silo-Denken hin zum Gruppen-Denken ('One Niederwieser').`,
              levels: {
                1: { 
                  text: `Die F√ºhrungskraft handelt fast ausschlie√ülich reaktiv und verliert sich im Mikromanagement des Tagesgesch√§fts (‚ÄûFirefighting‚Äú). Sie zeigt kein Interesse an der Unternehmensstrategie oder versteht sie nicht. Entscheidungen werden isoliert f√ºr die eigene Abteilung getroffen, oft sogar zum Nachteil anderer Bereiche oder der Gruppe (Suboptimierung). Sie plant Budget und Ressourcen nur f√ºr den momentanen Bedarf ohne Weitblick. Strategische Initiativen der Gesch√§ftsleitung werden ignoriert, bel√§chelt oder als ‚Äûst√∂rend‚Äú f√ºr den Betrieb empfunden. Das Team hat keine Orientierung, wohin die Reise langfristig geht.`, 
                  example: `Prod-Leiter: Produziert auf Halde f√ºr 100% Auslastung, obwohl Vertrieb das Produkt nicht verkauft.` 
                },
                2: { 
                  text: `Die F√ºhrungskraft kennt die Schlagworte der Strategie (z. B. Nachhaltigkeit, Wachstum), schafft es aber nicht, diese in den Alltag ihres Teams zu integrieren. Strategie bleibt Theorie (‚ÄûFolie an der Wand‚Äú), w√§hrend operativ ‚Äûweiter wie bisher‚Äú gearbeitet wird. Planung erfolgt meist nur kurzfristig (Quartal/Jahr). Zusammenh√§nge zwischen Abteilungen oder Standorten werden nur erkannt, wenn man explizit darauf hingewiesen wird. Sie wartet darauf, dass Strategie ‚Äûvon oben‚Äú vorgegeben wird, statt selbst Vorschl√§ge f√ºr den eigenen Bereich zu entwickeln.`, 
                  example: `Sales: Kennt Nachhaltigkeits-Ziel, steuert Team aber weiter nur √ºber reine Menge/Umsatz.` 
                },
                3: { 
                  text: `BASELINE: Die F√ºhrungskraft leitet die Ziele ihres Bereichs logisch aus der Unternehmensstrategie ab. Sie erkl√§rt ihrem Team das ‚ÄûWarum‚Äú hinter Entscheidungen und stellt sicher, dass alle an einem Strang ziehen. Sie ber√ºcksichtigt bei ihrer Planung (Budget, Personal, Kapazit√§t) einen Horizont von 12-18 Monaten. Sie erkennt relevante Trends im eigenen Fachbereich (z. B. Digitalisierung in der Admin, neue Technologien in der Produktion) und passt die Ausrichtung ihres Teams rechtzeitig an. Sie denkt √ºber Standortgrenzen hinweg und unterst√ºtzt die Harmonisierung der Gruppe (‚ÄûOne Niederwieser‚Äú), indem sie Standards einh√§lt und Kooperation f√∂rdert.`, 
                  example: `IT-Leiter: Plant Budget proaktiv f√ºr Harmonisierung der ERP-Systeme (Bozen/Sulzberg).` 
                },
                4: { 
                  text: `Die F√ºhrungskraft erkennt Markt- oder interne Ver√§nderungen, bevor sie offensichtlich werden, und bereitet ihren Bereich proaktiv darauf vor. Sie entwickelt eigeninitiativ strategische Vorschl√§ge (z.B. neue Gesch√§ftsfelder, strukturelle Anpassungen), die √ºber das Tagesgesch√§ft hinausgehen. Sie sucht aktiv nach Synergien mit anderen Standorten (z.B. gemeinsame Nutzung von Ressourcen zwischen Sulzberg und Campogalliano) und bricht Silos auf. Sie denkt in Szenarien (‚ÄûWas w√§re, wenn...‚Äú) und hat Plan B in der Tasche. Sie wird von Peers als strategischer Sparringspartner gesch√§tzt.`, 
                  example: `Marketing: Schichtet Budget von Produktwerbung auf 'Solution-Kampagnen' um, bevor Markt dreht.` 
                },
                5: { 
                  text: `Die F√ºhrungskraft entwickelt Konzepte, die das Gesch√§ftsmodell oder die Arbeitsweise der gesamten Gruppe nachhaltig ver√§ndern (z.B. Erschlie√üung eines neuen Marktes, Einf√ºhrung einer bahnbrechenden Technologie). Ihre Ideen flie√üen direkt in die Weiterentwicklung der Unternehmensstrategie ein. Sie erkennt disruptive Risiken oder Chancen sehr fr√ºh und steuert das Unternehmen durch mutige Entscheidungen in eine erfolgreiche Richtung. Sie gilt intern und extern als Vordenker (‚ÄûThought Leader‚Äú) und inspiriert nicht nur das eigene Team, sondern die ganze Organisation, gr√∂√üer zu denken.`, 
                  example: `Standortleiter: Erarbeitet Business Case f√ºr √úbernahme in Nische, erm√∂glicht Markteinstieg.` 
                }
              }
            },
            {
              id: "l3",
              title: "Entscheidungsf√§higkeit",
              category: "leadership",
              icon: Target,
              definition: `Zeitnah und verbindlich entscheiden, auch unter Unsicherheit. Balance zwischen Analyse und Speed.`,
              levels: {
                1: { 
                  text: `Die F√ºhrungskraft trifft Entscheidungen extrem z√∂gerlich oder gar nicht (‚ÄûAussitzen‚Äú). Dringende Themen bleiben liegen, wodurch Fristen verstreichen oder Chancen verloren gehen. Sie fordert f√ºr kleinste Entscheidungen immer wieder neue Daten an oder delegiert die Entscheidung an den Vorgesetzten (‚ÄûR√ºckdelegation‚Äú), um blo√ü keinen Fehler zu machen. Getroffene Entscheidungen werden bei leichtem Gegenwind sofort revidiert (‚ÄûFlip-Flopping‚Äú), was das Team verunsichert. Wenn eine Entscheidung falsch war, sucht sie die Schuld bei anderen oder den Umst√§nden, statt Verantwortung zu √ºbernehmen. Es fehlt der Mut zur Klarheit.`, 
                  example: `Einkauf: Entscheidet wochenlang nicht √ºber Preiserh√∂hung. Frist l√§uft ab, Konditionen werden schlechter.` 
                },
                2: { 
                  text: `Die F√ºhrungskraft entscheidet oft zu sp√§t, sodass das Team in Warteposition verharrt. Sie verl√§sst sich zu stark auf Bauchgef√ºhl oder Einzelmeinungen, statt verf√ºgbare Fakten und Daten (‚ÄûData driven‚Äú) hinzuzuziehen. Entscheidungen werden ‚Äûim stillen K√§mmerlein‚Äú getroffen und dem Team ohne Begr√ºndung vorgesetzt. Schwierige oder unpopul√§re Entscheidungen (z. B. Absagen an Bewerber, Stoppen von Projekten) werden aufgeschoben, in der Hoffnung, dass sich das Problem von selbst l√∂st. Die F√ºhrungskraft braucht viel R√ºckversicherung von oben, um sich sicher zu f√ºhlen.`, 
                  example: `Recruiting: Kann sich nicht zwischen Kandidaten entscheiden. Beide springen ab.` 
                },
                3: { 
                  text: `BASELINE: Die F√ºhrungskraft trifft Entscheidungen im Tagesgesch√§ft zeitnah und sicher. Sie w√§gt Chancen und Risiken vern√ºnftig ab und nutzt die vorhandenen Informationen effizient. Sie kommuniziert die Entscheidung und das ‚ÄûWarum‚Äú dahinter klar an ihr Team und betroffene Schnittstellen. Sie steht auch dann zu ihrer Entscheidung, wenn es Kritik gibt, ist aber bereit, den Kurs zu korrigieren, wenn neue Fakten auf den Tisch kommen (keine Sturheit). Sie unterscheidet sicher, was sie selbst entscheiden darf und was eskaliert werden muss ‚Äì und liefert bei Eskalationen eine klare Empfehlung mit.`, 
                  example: `Schichtleiter: Entscheidet nachts selbstst√§ndig Umplanung bei Maschinenausfall, informiert Planung.` 
                },
                4: { 
                  text: `Die F√ºhrungskraft bleibt auch in un√ºbersichtlichen Situationen, unter Zeitdruck oder bei unvollst√§ndiger Informationslage handlungsf√§hig. Sie trifft mutige Entscheidungen (‚ÄûCourage‚Äú), um Stillstand zu vermeiden, und managt das Risiko aktiv. Sie bezieht relevante Stakeholder (z.B. andere Standorte) rechtzeitig ein, um die Qualit√§t der Entscheidung zu sichern, verliert sich aber nicht in endlosen Abstimmungsschleifen. Sie erkl√§rt auch unpopul√§re Entscheidungen so transparent und wertsch√§tzend (‚ÄûFair‚Äú), dass das Team sie mittragen kann.`, 
                  example: `Sales Dir: Lehnt unprofitablen Gro√üauftrag mutig ab ('Courage'), erkl√§rt Strategie 'Wert vor Volumen'.` 
                },
                5: { 
                  text: `Die F√ºhrungskraft trifft wegweisende Entscheidungen, die positive Auswirkungen weit √ºber den eigenen Bereich hinaus haben (z.B. f√ºr die gesamte Gruppe). In Krisensituationen √ºbernimmt sie sofort das Steuer, schafft Ruhe und gibt durch klare Entscheidungen Sicherheit und Orientierung. Sie etabliert Prinzipien oder Rahmenbedingungen, die es ihren Mitarbeitenden erm√∂glichen, selbstst√§ndig bessere Entscheidungen zu treffen (‚ÄûEmpowerment‚Äú). Sie hat den Mut, alte Z√∂pfe abzuschneiden (z. B. unrentable Projekte oder Produkte zu stoppen), um Ressourcen f√ºr Neues freizumachen.`, 
                  example: `IT-Group: Kappt bei Cyber-Verdacht sofort alle Verbindungen der Gruppe, nimmt Prod-Ausfall in Kauf.` 
                }
              }
            },
            {
              id: "l4",
              title: "Execution & Performance",
              category: "leadership",
              icon: TrendingUp,
              definition: `Ziele in Ergebnisse umsetzen. Daten nutzen ('Clarity'), Prozesse beherrschen und konsequent steuern.`,
              levels: {
                1: { 
                  text: `Die F√ºhrungskraft arbeitet ohne erkennbaren Plan oder Struktur. Projekte und Aufgaben werden begonnen, aber nicht konsequent zu Ende gef√ºhrt. Es gibt keine klaren Meilensteine oder Verantwortlichkeiten. Die Leistung des Teams wird nicht gemessen oder gesteuert; Abweichungen (z.B. Budget√ºberzug, Terminverzug) fallen erst auf, wenn es zu sp√§t ist. Ziele werden regelm√§√üig und deutlich verfehlt, ohne dass die F√ºhrungskraft gegensteuert oder die Ursachen analysiert. Es herrscht eine Kultur der Ausreden statt der Ergebnisse.`, 
                  example: `Projektleiter: Software-Rollout Monate √ºberf√§llig. Kein neuer Plan, keine Info an User.` 
                },
                2: { 
                  text: `Die F√ºhrungskraft ist bem√ºht, verliert aber im Tagesgesch√§ft oft den Fokus. Planung erfolgt eher grob (‚ÄûWird schon passen‚Äú), Risiken oder Engp√§sse werden nicht antizipiert. Die Steuerung erfolgt sporadisch (z.B. nur wenn der Chef nachfragt), nicht systematisch. Ziele werden teilweise erreicht, aber oft nur durch hektische ‚ÄûLast-Minute-Aktionen‚Äú (Feuerl√∂schen) auf Kosten der Qualit√§t oder der Mitarbeiter-Ressourcen. Es fehlt an Transparenz dar√ºber, wo das Team wirklich steht. Prozesse werden nicht eingehalten oder st√§ndig umgangen, um kurzfristige Ergebnisse zu erzwingen.`, 
                  example: `Sales: Merkt Zielverfehlung erst am 25., macht Druck f√ºr schlechte Margen-Deals.` 
                },
                3: { 
                  text: `BASELINE: Die F√ºhrungskraft plant Aufgaben und Projekte strukturiert mit realistischen Zeitpl√§nen und Ressourcen. Sie definiert klare Erfolgskriterien (KPIs) und √ºberpr√ºft den Fortschritt regelm√§√üig (z.B. in Jour Fixes). Bei Abweichungen greift sie zeitnah ein und leitet Korrekturma√ünahmen ein, um das Ziel noch zu erreichen. Sie sorgt daf√ºr, dass ihr Team die vereinbarten Ziele (Qualit√§t, Kosten, Zeit) verl√§sslich erf√ºllt. Sie kommuniziert den Status transparent an Vorgesetzte und Schnittstellen. Man kann sich auf ihre Zusagen verlassen (‚ÄûFair‚Äú).`, 
                  example: `Resp. Prod: Organisiert sofort Samstagsschicht bei Ausfall, informiert Vertrieb proaktiv.` 
                },
                4: { 
                  text: `Die F√ºhrungskraft verwaltet nicht nur, sondern optimiert aktiv. Sie nutzt Daten und Kennzahlen systematisch, um Ineffizienzen oder Bottlenecks aufzudecken, bevor sie zum Problem werden. Sie etabliert Routinen, die eine konstant hohe Performance sicherstellen. Sie liefert Ergebnisse oft schneller (‚ÄûFast‚Äú) oder kosteng√ºnstiger als geplant, ohne die Qualit√§t zu gef√§hrden. Sie schafft es, auch bei unvorhergesehenen Hindernissen (z.B. Krankheitswelle, Lieferausfall) den Betrieb stabil zu halten, weil sie Szenarien vorausgeplant hat.`, 
                  example: `HR: Analysiert Prozess, f√ºhrt digitales Tool ein, verk√ºrzt 'Time-to-Hire' drastisch.` 
                },
                5: { 
                  text: `Die F√ºhrungskraft etabliert Best-Practice-Prozesse, die als Vorbild f√ºr die gesamte Gruppe dienen (z.B. ein neues Reporting-System, das sp√§ter in Sulzberg und Bozen ausgerollt wird). Sie treibt kontinuierliche Verbesserung (KVP) so voran, dass Performance-Spr√ºnge (z. B. signifikante Senkung der Ausschussquote oder Durchlaufzeit) erreicht werden. Sie schafft eine Hochleistungskultur, in der das Team sich selbstst√§ndig steuert und permanent √ºbertrifft. Sie realisiert strategische Gro√üprojekte in ‚ÄûTime, Budget & Quality‚Äú und liefert damit einen direkten Beitrag zum Unternehmenserfolg (‚Äû1 Result‚Äú).`, 
                  example: `Logistik: B√ºndelt Transporte Sulzberg/Bozen, senkt Kosten um 15% durch neues Cross-Docking.` 
                }
              }
            },
            {
              id: "l5",
              title: "Stakeholder & Konfliktl√∂sung",
              category: "leadership",
              icon: Award,
              definition: `Beziehungen pflegen, politische Interessen moderieren. Br√ºckenbauer zwischen Silos.`,
              levels: {
                1: { 
                  text: `Die F√ºhrungskraft ignoriert die Interessen anderer Abteilungen oder Standorte komplett. Sie kommuniziert nicht mit wichtigen Stakeholdern, was zu √úberraschungen und Widerst√§nden f√ºhrt. In Konflikten verh√§lt sie sich destruktiv: Sie sucht Schuldige statt L√∂sungen, redet schlecht √ºber andere Bereiche (‚ÄûDie da oben/unten‚Äú) oder tr√§gt Konflikte aggressiv und unsachlich aus. Alternativ werden Konflikte ignoriert oder ausgesessen, bis sie eskalieren. Das Verhalten besch√§digt das Vertrauen und die Zusammenarbeit in der Gruppe massiv.`, 
                  example: `Prod-Leiter: Schimpft √ºber 'unf√§hige Verk√§ufer' statt Machbarkeit direkt zu kl√§ren.` 
                },
                2: { 
                  text: `Die F√ºhrungskraft pflegt Beziehungen nur, wenn sie akut etwas braucht (transaktional). Sie vergisst h√§ufig, relevante Partner (z.B. HR, IT, andere Standorte) rechtzeitig einzubinden, was Projekte verz√∂gert. Sie erkennt politische Fettn√§pfchen oft zu sp√§t. Bei Konflikten reagiert sie defensiv oder zieht sich zur√ºck, um ‚Äûden Frieden zu wahren‚Äú, obwohl eine Kl√§rung n√∂tig w√§re. L√∂sungen sind oft faule Kompromisse, die niemanden zufriedenstellen. Sie tut sich schwer, die Perspektive des Gegen√ºbers einzunehmen.`, 
                  example: `Projektleiter: Vergisst Betriebsrat zu informieren. Zieht Projekt beleidigt zur√ºck bei Veto.` 
                },
                3: { 
                  text: `BASELINE: Die F√ºhrungskraft kennt ihre wichtigsten Stakeholder und h√§lt sie regelm√§√üig informiert. Sie stimmt sich proaktiv ab, um Missverst√§ndnisse zu vermeiden. Sie begegnet Partnern ‚Äì egal ob intern oder extern ‚Äì respektvoll und auf Augenh√∂he. Konflikte werden zeitnah (‚ÄûFast‚Äú) angesprochen und sachlich diskutiert. Sie vertritt die Interessen ihres Bereichs, ist aber bereit, Argumente der Gegenseite zu h√∂ren und faire L√∂sungen zu finden. Sie sorgt daf√ºr, dass die Zusammenarbeit reibungslos funktioniert.`, 
                  example: `Service/Supply: Legt Zahlen offen, einigt sich sachlich auf Mindestbestand (Kompromiss).` 
                },
                4: { 
                  text: `Die F√ºhrungskraft baut aktiv ein belastbares Netzwerk √ºber Abteilungsgrenzen hinweg auf. Sie antizipiert potenzielle Konflikte (z.B. Ressourcenengp√§sse zwischen Projekten) und moderiert diese pr√§ventiv, bevor sie eskalieren. Sie versteht die Zw√§nge und Ziele der anderen Seite und bietet L√∂sungen an, die beiden helfen (‚ÄûWin-Win‚Äú). Sie wird von anderen Abteilungen als verl√§sslicher Partner gesch√§tzt, der nicht nur fordert, sondern auch unterst√ºtzt. Sie kann auch schwierige Botschaften diplomatisch und wertsch√§tzend vermitteln.`, 
                  example: `Quality: Reist an Standorte, moderiert Workshop f√ºr gemeinsamen Standard.` 
                },
                5: { 
                  text: `Die F√ºhrungskraft l√∂st komplexe, verfahrene Konflikte (z. B. kulturelle Spannungen zwischen Standorten oder historische Grabenk√§mpfe), an denen andere gescheitert sind. Sie schafft es, unterschiedliche Interessen auf das gemeinsame strategische Ziel (‚ÄûOne Niederwieser‚Äú) auszurichten. Sie etabliert Gremien oder Formate, die den Austausch und das Stakeholder-Management strukturell verbessern. Sie genie√üt h√∂chstes Vertrauen bei der Gesch√§ftsf√ºhrung und den Belegschaftsvertretungen und nutzt dieses Kapital zum Wohle des Unternehmens. Sie macht aus Gegnern Partner.`, 
                  example: `Manager: Rompe vecchi silos, integra team ostili in un'unit√† di successo.` 
                }
              }
            }
          ],
          },
          it: {
            intro: {
              values: [
                { key: "Fast", desc: "Agiamo velocemente e orientati alla soluzione.", icon: Zap, color: "text-yellow-600" },
                { key: "Fair", desc: "Lavoriamo insieme con rispetto e alla pari.", icon: Scale, color: "text-blue-600" },
                { key: "Personal", desc: "Ci assumiamo la responsabilit√† e partecipiamo attivamente.", icon: Heart, color: "text-red-600" }
              ]
            },
            competencies: [
            {
              id: "c1",
              title: "Competenza tecnica & Applicazione",
              category: "core",
              icon: Briefcase,
              definition: `Valuta le conoscenze tecniche specifiche e la loro applicazione. Non si tratta solo di abilit√† teoriche, ma del contributo alla sicurezza dei processi e alla qualit√†.`,
              levels: {
                1: { 
                  text: `Il collaboratore non possiede le basi tecniche essenziali richieste per la posizione. I compiti vengono eseguiti frequentemente in modo errato o incompleto (es. inserimento dati errati, uso scorretto degli impianti, informazioni errate ai clienti), portando a rilavorazioni, reclami o rischi. Manca la comprensione degli standard tecnici e delle regole del proprio settore. Anche dopo la formazione o il feedback, si verificano ripetutamente gli stessi errori di contenuto. Il collaboratore mostra poca iniziativa nel colmare autonomamente queste lacune. I contesti complessi del proprio campo non vengono compresi; si fa affidamento sugli altri per verificare la correttezza tecnica.`, 
                  example: `Admin: Inserisce ripetutamente i dati anagrafici in modo errato, non comprende l'impatto sulle fatture.` 
                },
                2: { 
                  text: `Il collaboratore padroneggia i processi standard e i compiti di routine nel suo campo, ma raggiunge rapidamente i limiti in caso di deviazioni, casi speciali o nuove esigenze. La conoscenza viene applicata pi√π secondo le "prescrizioni", senza comprendere il "perch√©" pi√π profondo o gli effetti sulle aree adiacenti. Per risolvere problemi tecnici si attende principalmente un'istruzione o si scala immediatamente, invece di utilizzare le risorse disponibili (documentazione, ricerca, guide di sistema). La qualit√† dei risultati √® altalenante, specialmente sotto stress. Le novit√† tecniche (es. nuove funzionalit√† software, richieste dei clienti modificate) vengono adottate con esitazione.`, 
                  example: `IT: Risolve problemi di password standard, ma √® subito sopraffatto da problemi di rete pi√π complessi e scala senza diagnosi.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore padroneggia con sicurezza la propria area e fornisce costantemente risultati di alta qualit√† (elaborazione ordini corretta, sistemi stabili, pezzi precisi). Lavora in completa autonomia nelle attivit√† quotidiane. Risolve rapidamente problemi tecnici da solo o richiede supporto mirato e tempestivo. √à in grado di trasmettere conoscenze ai colleghi situazionalmente (brevi istruzioni, suggerimenti troubleshooting) e contribuisce alla stabilit√† del team. Gli standard tecnici vengono rispettati costantemente.`, 
                  example: `Produzione: Opera l'impianto senza errori secondo specifica. Risolve piccoli guasti (reset sensore, blocco materiale) autonomamente entro 10 minuti. Mostra ai nuovi colleghi le manovre critiche senza lunghe spiegazioni.` 
                },
                4: { 
                  text: `Il collaboratore comprende a fondo anche contesti tecnici complessi e riconosce interazioni che sfuggono ad altri (es. come una modifica nell'ordine influenza la pianificazione della produzione). Agisce preventivamente: rischi o fonti di errore vengono identificati ed eliminati prima che diventino un problema. La conoscenza tecnica viene utilizzata per ottimizzare attivamente i processi esistenti e renderli pi√π efficienti. I colleghi si rivolgono attivamente a questa persona per domande tecniche difficili ("Go-to-Person"). Il collaboratore trasmette proattivamente le conoscenze e garantisce un alto standard nel team. Guarda oltre la propria scrivania e comprende esattamente le esigenze dei partner di interfaccia interni.`, 
                  example: `Customer Service: Verifica proattivamente la fattibilit√† con il laboratorio su domande specifiche e propone alternative pi√π sicure.` 
                },
                5: { 
                  text: `Il collaboratore √® considerato un'autorit√† tecnica assoluta nel suo campo, la cui competenza √® apprezzata e richiesta anche tra le diverse sedi (Sulzberg/Bolzano/Campogalliano). Utilizza la sua eccellente conoscenza per ottenere miglioramenti significativi per il gruppo (es. introduzione di standard a livello di gruppo nel Customer Service, massiccio aumento dell'efficienza tramite nuove soluzioni IT). Questa persona funge da moltiplicatore. Elabora conoscenze complesse in modo che siano utilizzabili per l'organizzazione (es. corsi di formazione, linee guida best practice). Anticipa sviluppi futuri nel settore (es. trend di mercato, nuove tecnologie) e prepara l'azienda proattivamente. L'eccellenza tecnica diventa qui un valore aggiunto diretto per il successo aziendale.`, 
                  example: `Group Function: Sviluppa standard di servizio uniformi per tutte le sedi (DE/IT), forma i team, garantisce 'One Voice'.` 
                }
              }
            },
            {
              id: "c2",
              title: "Comunicazione & Collaborazione",
              category: "core",
              icon: MessageCircle,
              definition: `Qualit√† dello scambio di informazioni e della convivenza. 'One Niederwieser' significa: La collaborazione non finisce alla porta dell'ufficio o al confine nazionale.`,
              levels: {
                1: { 
                  text: `Il collaboratore trattiene informazioni critiche o le trasmette in modo incompleto, costringendo colleghi o clienti a chiedere chiarimenti e causando errori. Si isola e non mostra interesse per obiettivi comuni. In caso di problemi, scarica responsabilit√† ("Non √® mia competenza") o rifiuta supporto. La comunicazione √® caratterizzata da mentalit√† difensiva (battaglie in CC) anzich√© orientamento alla soluzione. I conflitti vengono ignorati, gestiti alle spalle o fatti escalare in modo non costruttivo. Il comportamento viola i valori fondamentali di rispetto e correttezza.`, 
                  example: `Produzione: Al cambio turno, nonostante guasto critico alla macchina, comunica solo "Tutto ok" per andare a casa velocemente. Il turno successivo scopre il problema solo dopo 2 ore di fermo.` 
                },
                2: { 
                  text: `Il collaboratore comunica principalmente in modo reattivo: le informazioni fluiscono solo su richiesta esplicita ("Dovere di informarsi" invece di "Dovere di informare"). Si concentra sulla propria area ignorando esigenze di reparti adiacenti o colleghi. In riunioni o progetti contribuisce raramente proattivamente. Il canale di comunicazione √® spesso inefficiente (es. lunghi scambi email su temi complessi invece di breve chiamata chiarificatrice ‚Äì contrariamente al principio "Phone before Email"). Il feedback viene preso personalmente o respinto difensivamente. La collaborazione funziona nella routine, ma diventa difficile con stress, incertezza o temi interfunzionali.`, 
                  example: `Backoffice: Scrive email avanti e indietro per giorni invece di chiarire il caso in 2 minuti al telefono.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore informa colleghi e partner proattivamente, completamente e tempestivamente su tutto ci√≤ che √® rilevante (es. aggiornamenti stato, ritardi, assenze). Sceglie il canale pi√π efficiente situazionalmente (prende il telefono se le cose devono essere chiarite rapidamente). Il tono √® sempre rispettoso e alla pari, indipendentemente da gerarchia o sede. Offre supporto ai colleghi quando necessario e condivide volentieri conoscenze. Nelle riunioni √® presente, preparato e costruttivo. I conflitti vengono affrontati oggettivamente e direttamente. Contribuisce stabilmente a un'atmosfera lavorativa positiva e professionale.`, 
                  example: `Sales: In caso di ritardo nella consegna, informa subito proattivamente cliente e agente con nuova data.` 
                },
                4: { 
                  text: `Il collaboratore non comunica solo informazioni, ma crea comprensione. Adatta la comunicazione in modo mirato all'interlocutore (es. traduce dettagli tecnici per i non addetti ai lavori, prepara dati per i decisori) e assicura che il messaggio arrivi correttamente. Agisce attivamente come legame tra i reparti e abbatte i silos. In caso di conflitti o malintesi nel team, assume un ruolo di mediazione e cerca una soluzione comune ("Win-Win"), invece di voler avere ragione. Fornisce feedback costruttivi e orientati allo sviluppo che aiutano gli altri a migliorare. La collaborazione con questa persona rende l'intero ambiente misurabilmente pi√π efficiente e motivato.`, 
                  example: `Interfaccia: Modera in caso di conflitto tra produzione e servizio, crea regolamentazione per ordini urgenti.` 
                },
                5: { 
                  text: `Il collaboratore stabilisce nuovi standard di collaborazione che vanno oltre il proprio team (es. avvio di formati di scambio regolari tra le sedi di Sulzberg e Campogalliano o tra Sales e Tecnica). Vive i valori Fast, Fair, Personal in modo cos√¨ esemplare da fungere da modello e trascinare gli altri. Crea una rete di fiducia nell'intera azienda e la utilizza per risolvere problemi complessi e interfunzionali in modo rapido e non burocratico. Viene coinvolto come mentore o mediatore in situazioni comunicative difficili (es. processi di cambiamento, crisi). Si assicura attivamente che parliamo internamente ed esternamente "con una sola voce".`, 
                  example: `HR: Avvia Sounding Board inter-sede per chiarire differenze culturali tra Bolzano e Sulzberg.` 
                }
              }
            },
            {
              id: "c3",
              title: "Competenza nel Problem Solving",
              category: "core",
              icon: ShieldAlert,
              definition: `Gestione degli ostacoli. Distinguiamo tra Troubleshooting (sintomi) e ricerca delle cause (radice).`,
              levels: {
                1: { 
                  text: `Il collaboratore riconosce i problemi spesso solo quando sono gi√† degenerati, o ignora segnali di avvertimento evidenti (es. messaggi di errore, reclami clienti, deviazioni di qualit√†). Non mostra iniziativa per la soluzione, ma attende passivamente istruzioni ("Lavoro secondo prescrizione"). Di fronte alle difficolt√† si arrende rapidamente o scarica la responsabilit√† su altri (colleghi, IT, fornitori). Gli errori vengono nascosti o minimizzati invece di parlarne apertamente. Non c'√® apprendimento dagli errori: lo stesso identico problema si verifica ancora e ancora senza che il comportamento venga modificato.`, 
                  example: `Admin: Chiude semplicemente il messaggio di errore nell'ERP, senza info. A fine mese i numeri non tornano.` 
                },
                2: { 
                  text: `Il collaboratore segnala i problemi ("Qui c'√® qualcosa che non va"), ma contribuisce poco alla soluzione. Si affida molto al responsabile o a colleghi esperti per trovare la via d'uscita dalla crisi. I tentativi di soluzione rimangono spesso in superficie: si combattono i sintomi (es. riavviare semplicemente la macchina, temporeggiare col cliente), ma non le cause reali. Appena sorge un primo ostacolo nella ricerca della soluzione, il processo si ferma. Necessita di istruzioni dettagliate per risolvere anche problemi standard. Manca la visione delle conseguenze: una "soluzione rapida" crea spesso nuovi problemi altrove.`, 
                  example: `Produzione: Riduce velocit√† macchina per nascondere pieghe, invece di cercare causa meccanica.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore riconosce tempestivamente i problemi nel proprio ambito di competenza e li affronta autonomamente. Utilizza le informazioni disponibili (dati, manuali, storico) e gli strumenti per trovare soluzioni pragmatiche che funzionano. Distingue con sicurezza cosa pu√≤ risolvere da solo e quando √® necessaria un'escalation ‚Äì informando poi in modo preciso e orientato alla soluzione (arriva con una proposta, non solo con il lamento). Le soluzioni sono solide e sostenibili per il lavoro quotidiano. Rimane capace di agire anche in situazioni stressanti ("Sangue freddo"). Dopo un errore si assume la responsabilit√† ("Accountability") e corregge, invece di cercare scuse.`, 
                  example: `Customer Service: Localizza merce mancante, informa cliente onestamente, risolve conflitto professionalmente.` 
                },
                4: { 
                  text: `Il collaboratore non risolve solo il problema acuto, ma conduce una ricerca sistematica delle cause (es. metodo "5-Why", analisi dati) per capire perch√© √® successo. Sviluppa misure che impediscono che l'errore si verifichi di nuovo (prevenzione errori). Pensa oltre il proprio ambito: se un problema riguarda le interfacce (es. passaggio Sales a Produzione), questo viene indirizzato e risolto attivamente. Supporta i colleghi in sfide difficili e apporta approcci creativi e non convenzionali quando le soluzioni standard non funzionano. I problemi vengono concepiti come opportunit√† di miglioramento.`, 
                  example: `Logistica: Analizza dati ritardi, parla con spedizioniere e adatta processo di ritiro permanentemente.` 
                },
                5: { 
                  text: `Il collaboratore identifica problemi complessi e strutturali o rischi che altri non hanno ancora notato e sviluppa concetti completi per risolverli. Le soluzioni hanno spesso un impatto positivo su pi√π reparti o sedi del gruppo (Sulzberg/Bolzano/Campogalliano). Stabilisce nuovi standard o "Best Practices" per la risoluzione dei problemi che vengono adottati in azienda. Trasforma i problemi in vere innovazioni o vantaggi competitivi per Niederwieser. Nelle crisi assume informalmente la guida ("Troubleshooter") e naviga il team con sicurezza attraverso terreni incerti.`, 
                  example: `Quality: Avvia Task-Force per difetti materiali tra le sedi, introduce nuovo standard di gruppo.` 
                }
              }
            },
            {
              id: "c4",
              title: "Adattabilit√† & Volont√† di apprendere",
              category: "core",
              icon: BookOpen,
              definition: `Volont√† di adattarsi a nuove condizioni quadro (IT, mercato, processi). 'Growth Mindset' invece di Status Quo.`,
              levels: {
                1: { 
                  text: `Il collaboratore reagisce alle novit√† (es. nuovo software, ristrutturazioni) con aperto rifiuto, cinismo o ostruzionismo. Si aggrappa rigidamente a metodi obsoleti ("Abbiamo sempre fatto cos√¨") e si rifiuta di apprendere nuove abilit√†. I cambiamenti portano a un massiccio calo delle prestazioni o a malumore che contagia il team. Necessita di una sproporzionata opera di convincimento e pressione per attuare anche i minimi adattamenti nel flusso di lavoro. Il feedback sullo sviluppo personale viene ignorato o valutato come un attacco.`, 
                  example: `Magazzino: Si rifiuta di usare nuovi scanner, continua a tenere liste manuali private.` 
                },
                2: { 
                  text: `Il collaboratore accetta i cambiamenti solo dopo lunga esitazione o mugugni. Aspetta di vedere se la novit√† "rimane davvero" prima di muoversi. L'apprendimento di nuovi compiti o sistemi dura molto pi√π a lungo rispetto a colleghi comparabili, poich√© manca la motivazione interna. Mostra poca iniziativa per l'aggiornamento; nuove conoscenze vengono acquisite solo se esplicitamente ordinate o "pre-digerite". In situazioni di stress o con nuove esigenze poco chiare, ricade rapidamente in vecchi modelli comportamentali inefficienti. L'adattabilit√† non √® sufficiente per fasi dinamiche.`, 
                  example: `Finance: Stampa email nonostante sistema paperless. Impara nuovo processo solo lentamente.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore gestisce i cambiamenti in modo costruttivo e adatta il suo modo di lavorare alle nuove condizioni. Attua le nuove direttive (es. uso di un nuovo strumento, piano turni modificato) in modo affidabile e senza grandi lamentele. L'inserimento in nuovi temi avviene in tempi adeguati. Riconosce quando mancano conoscenze e utilizza i corsi offerti o gli ausili per colmare la lacuna. Non blocca le innovazioni, ma le supporta nel lavoro quotidiano. Ci si pu√≤ fidare che fornisca stabilmente la sua prestazione anche in un ambiente in evoluzione ("Fair" verso il team).`, 
                  example: `Sales: Partecipa a corso su nuovi film sostenibili e consiglia i clienti con competenza dalla data stabilita.` 
                },
                4: { 
                  text: `Il collaboratore vede i cambiamenti come opportunit√† di miglioramento. Non aspetta i corsi, ma acquisisce nuove conoscenze (es. su nuovi prodotti, trend di mercato o trucchi software) autonomamente. Sperimenta nuovi approcci risolutivi e condivide le scoperte con il team. Nelle fasi di transizione agisce in modo stabilizzante sugli altri e aiuta i colleghi che hanno pi√π difficolt√† con il cambiamento (es. come "Buddy" per nuovi sistemi). Mette in discussione lo status quo in modo costruttivo e fa proposte su come adattarsi meglio alle nuove esigenze.`, 
                  example: `Service: Esplora il nuovo CRM prima del corso, aiuta poi i colleghi all'avvio.` 
                },
                5: { 
                  text: `Il collaboratore anticipa i cambiamenti necessari spesso prima degli altri e prepara s√© stesso e l'ambiente proattivamente (es. acquisizione di competenze future prima che servano acutamente). Spinge innovazioni che rendono l'azienda pronta per il futuro (es. pilotaggio di modalit√† di lavoro completamente nuove). Stabilisce una cultura dell'apprendimento nel proprio ambito, vivendo gli errori come opportunit√† di apprendimento e incoraggiando gli altri a provare ("Empowerment"). Agisce come faro in grandi progetti strategici (es. armonizzazione delle sedi) e crea entusiasmo per la nuova strada, anche in caso di resistenze iniziali.`, 
                  example: `IT: Avvia autonomamente progetto pilota AI (Copilot), chiarisce privacy e forma altre sedi.` 
                }
              }
            },
            {
              id: "c5",
              title: "Auto-organizzazione & Affidabilit√†",
              category: "core",
              icon: Clock,
              definition: `Strutturazione del lavoro, priorizzazione e Accountability. Ci si pu√≤ fidare della parola data?`,
              levels: {
                1: { 
                  text: `Il collaboratore lavora in modo asistematico e senza struttura riconoscibile. I compiti vengono dimenticati, le scadenze mancate senza preavviso o gli appuntamenti persi. Si lascia distrarre facilmente e perde il focus sull'essenziale. Il responsabile o i colleghi devono costantemente controllare ("Babysitting") affinch√© i risultati vengano consegnati. Manca la panoramica sui compiti aperti; le promesse vengono fatte con leggerezza e non mantenute. Il posto di lavoro (fisico o digitale) √® disorganizzato, cosicch√© documenti o informazioni importanti non sono a portata di mano. L'inaffidabilit√† pesa massicciamente sul team.`, 
                  example: `Sales: Dimentica rapporti visita, smarrisce fogli con richieste clienti. Nessuna panoramica.` 
                },
                2: { 
                  text: `Il collaboratore sbriga compiti di routine semplici in modo affidabile, ma va rapidamente in difficolt√† con pi√π compiti paralleli o pressione temporale. Ha difficolt√† a distinguere l'importante dal non importante (fa es. ci√≤ che diverte prima, non ci√≤ che urge). La pianificazione avviene solo a brevissimo termine (giorno per giorno). Quando i tempi si stringono, non lo comunica tempestivamente, ma solo quando il danno √® gi√† fatto. La qualit√† del lavoro soffre per mancanza di cura o gestione del tempo. Necessita di guida regolare e promemoria dal responsabile per rimanere in rotta.`, 
                  example: `Officina: Riordina, anche se riparazione urgente blocca la produzione.` 
                },
                3: { 
                  text: `BASELINE: Il collaboratore organizza autonomamente la giornata lavorativa e stabilisce priorit√† sensate per urgenza e importanza. Rispetta impegni e scadenze in modo affidabile. Se una scadenza √® a rischio, informa con almeno 48 ore di anticipo proattivamente ("Transparency"). Postazione e sistemi sono strutturati in modo che informazioni importanti siano reperibili in meno di 2 minuti (archiviazione ordinata, liste to-do curate). Si pu√≤ fare affidamento sulla sua parola.`, 
                  example: `Admin: Ha scadenziario digitale sotto controllo (priorit√† codificate per colore). Segnala marted√¨ che chiusura mensile arriver√† 2 giorni dopo per assenza malattia nel team ‚Äì propone contestualmente soluzione (supporto da altra sede).` 
                },
                4: { 
                  text: `Il collaboratore pianifica con anticipo (2-3 mesi) e riconosce colli di bottiglia prima che si verifichino (ferie, scadenze progetti, carenza risorse). Ottimizza attivamente il proprio metodo di lavoro (strumenti digitali, checklist, raggruppamento attivit√† simili). Rimane strutturato anche con carico di lavoro al 120% e consegna risultati puntuali. La sua affidabilit√† lo rende pilastro fisso del team ‚Äì i colleghi sanno: "Con X √® al sicuro."`, 
                  example: `Project Management: Prepara 4 settimane prima delle ferie dossier dettagliato con stato di tutti i progetti, punti aperti e referenti. Predispone attivit√† critiche (briefing di scorta, template decisionali precompilati). Il sostituto pu√≤ subentrare senza interruzioni.` 
                },
                5: { 
                  text: `Il collaboratore sviluppa sistemi organizzativi o flussi di lavoro che aiutano non solo lui/lei, ma l'intero team o reparto a lavorare pi√π efficientemente (es. introduzione di una Kanban-Board, standardizzazione dell'archiviazione per il gruppo). Gestisce pacchetti di compiti altamente complessi con molte dipendenze (es. progetti inter-sede) con sovranit√† e puntualit√†. √à considerato un "porto sicuro" per compiti critici: se se ne occupa lui/lei, il successo √® garantito. Crea spazi per temi strategici e innovazioni attraverso un'eccellente organizzazione.`, 
                  example: `Marketing: Stabilisce tool di pianificazione digitale per tutte le sedi (Sulzberg/BZ/Campo), elimina doppi lavori.` 
                }
              }
            },
            {
              id: "l1",
              title: "Gestione & Sviluppo dei collaboratori",
              category: "leadership",
              icon: Users,
              definition: `Guida, motivazione e sviluppo del team. 'Leadership' invece di solo 'Management'.`,
              levels: {
                1: { 
                  text: `Il manager trascura i suoi compiti principali: i colloqui con i collaboratori (colloquio annuale, check-in) non hanno luogo, sono estremamente in ritardo o vengono sbrigati come fastidioso dovere. Non c'√® feedback costruttivo; la critica avviene spesso in modo non oggettivo o davanti ad altri. I desideri di sviluppo dei collaboratori vengono ignorati o bloccati ("Non abbiamo tempo per questo"). Gli obiettivi vengono comunicati in modo poco chiaro o per nulla, portando a disorientamento. Il comportamento contraddice massicciamente i nostri valori (es. mancanza di rispetto, "Divide and Conquer"). Nel team regna un'atmosfera di paura o indifferenza, portando ad alto turnover o dimissioni interne.`, 
                  example: `Resp. Prod: Annulla colloquio annuale 3 volte, lo fa poi in 15min in piedi.` 
                },
                2: { 
                  text: `Il manager sbriga i doveri amministrativi (approvazione ferie, colloqui formali), ma senza profondit√†. Il feedback c'√® per lo pi√π solo se qualcosa √® andato storto (reattivo), quasi nessuna lode o orientamento per il futuro. Il lavoro di leadership si limita all'assegnazione di compiti ("Micromanagement"), invece di delegare responsabilit√†. I piani di sviluppo (IDP) vengono s√¨ compilati, ma spariscono poi nel cassetto e non vengono seguiti. Il manager si prende troppo poco tempo per il team ("Porta chiusa"). Manca chiarezza e ispirazione; il team lavora "secondo prescrizione", ma non oltre.`, 
                  example: `Team Leader: Usa Copia-Incolla per obiettivi. Risponde a desiderio sviluppo vagamente 'Vediamo'.` 
                },
                3: { 
                  text: `BASELINE: Il manager conduce tutti i colloqui obbligatori (Review, definizione obiettivi) puntualmente, ben preparato e alla pari. Assicura obiettivi e aspettative chiari, cosicch√© ognuno sappia cosa fare. Il feedback avviene regolarmente ed equamente ‚Äì sia positivo che correttivo. Supporta lo sviluppo professionale (es. approvazione corsi) ed √® disponibile per i collaboratori in caso di problemi. Vive i valori "Fast, Fair, Personal" nel quotidiano e garantisce un clima lavorativo stabile e positivo. Tratta tutti i membri del team equamente e senza discriminazioni.`, 
                  example: `Sales Director: Check-in regolari, loda successi, parla apertamente dei deficit. Team conosce obiettivi.` 
                },
                4: { 
                  text: `Il manager usa la leadership attivamente per rendere i collaboratori migliori. Non delega solo compiti, ma responsabilit√†, per permettere la crescita ("Empowerment"). Conduce regolari colloqui di feedback informali (oltre il processo standard) e usa metodi di coaching per stimolare i collaboratori a trovare soluzioni proprie. Riconosce potenziali proattivamente e propone misure di sviluppo individuali (es. guida progetto, Job Rotation). Crea una cultura di team in cui gli errori vengono discussi apertamente per impararne. Il team si sente supportato e porta prestazioni misurabilmente pi√π alte grazie all'alta motivazione.`, 
                  example: `Resp. IT: Delega guida progetto a talento, d√† feedback specifico, rafforza autostima.` 
                },
                5: { 
                  text: `Il manager costruisce sistematicamente successori e sviluppa High-Potentials auch √ºber den eigenen Bedarf hinaus (per il gruppo). √à considerato un mentore nell'intera azienda, il cui consiglio √® cercato anche da collaboratori di altri settori. Crea un ambiente di eccellenza in cui i talenti possono svilupparsi e lega i top performer a lungo termine a Niederwieser. Gestisce la pianificazione del personale strategicamente in modo lungimirante (es. per i prossimi 2-3 anni) e assicura che il team sia pronto per le sfide future della Strategia 2035. Sotto la sua guida nascono innovazioni e risultati sopra la media grazie a effetti sinergici.`, 
                  example: `Manager: Raccomanda Top-Mitarbeiter proattivamente per posizione in altra sede, invece di 'accumularlo'.` 
                }
              }
            },
            {
              id: "l2",
              title: "Pensiero strategico",
              category: "leadership",
              icon: Brain,
              definition: `Vedere il 'quadro generale'. Via dal pensiero a silos verso il pensiero di gruppo ('One Niederwieser').`,
              levels: {
                1: { 
                  text: `Il manager agisce quasi esclusivamente in modo reattivo e si perde nel micromanagement del quotidiano ("Firefighting"). Non mostra interesse per la strategia aziendale o non la comprende. Le decisioni vengono prese isolatamente per il proprio reparto, spesso addirittura a svantaggio di altri settori o del gruppo (Subottimizzazione). Pianifica budget e risorse solo per il fabbisogno momentaneo senza lungimiranza. Le iniziative strategiche della direzione vengono ignorate, derise o percepite come "disturbo" per l'operativit√†. Il team non ha orientamento su dove vada il viaggio a lungo termine.`, 
                  example: `Resp. Prod: Produce a magazzino per 100% utilizzo, anche se vendite non vendono il prodotto.` 
                },
                2: { 
                  text: `Il manager conosce le parole chiave della strategia (es. sostenibilit√†, crescita), ma non riesce a integrarle nel quotidiano del suo team. La strategia rimane teoria ("Slide sul muro"), mentre operativamente si lavora "come sempre". La pianificazione avviene per lo pi√π solo a breve termine (trimestre/anno). Le connessioni tra reparti o sedi vengono riconosciute solo se esplicitamente segnalate. Aspetta che la strategia venga data "dall'alto", invece di sviluppare proposte per il proprio ambito.`, 
                  example: `Sales: Conosce obiettivo sostenibilit√†, ma guida team ancora solo su pura quantit√†/fatturato.` 
                },
                3: { 
                  text: `BASELINE: Il manager deriva logicamente gli obiettivi del suo settore dalla strategia aziendale. Spiega al suo team il "Perch√©" dietro le decisioni e assicura che tutti tirino dalla stessa parte. Considera nella sua pianificazione (budget, personale, capacit√†) un orizzonte di 12-18 mesi. Riconosce trend rilevanti nel proprio ambito (es. digitalizzazione in amministrazione, nuove tecnologie in produzione) e adatta l'orientamento del suo team tempestivamente. Pensa oltre i confini della sede e supporta la harmonizzazione del gruppo ("One Niederwieser"), rispettando standard e promuovendo la cooperazione.`, 
                  example: `Resp. IT: Pianifica budget proattivamente per armonizzazione sistemi ERP (Bolzano/Sulzberg).` 
                },
                4: { 
                  text: `Il manager riconosce cambiamenti di mercato o interni prima che diventino ovvi e prepara il suo settore proattivamente. Sviluppa di propria iniziativa proposte strategiche (es. nuovi campi di business, adattamenti strutturali) che vanno oltre il quotidiano. Cerca attivamente sinergie con altre sedi (es. uso comune di risorse tra Sulzberg und Campogalliano) und rompe i silos. Pensa in scenari ("Cosa succederebbe se...") e ha un piano B in tasca. √à apprezzato dai pari come sparring partner strategico.`, 
                  example: `Marketing: Sposta budget da pubblicit√† prodotto a 'campagne soluzioni' prima che il mercato giri.` 
                },
                5: { 
                  text: `Il manager sviluppa concetti che cambiano il modello di business o il modo di lavorare dell'intero gruppo in modo sostenibile (es. apertura di un nuovo mercato, introduzione di una tecnologia rivoluzionaria). Le sue idee fluiscono direttamente nello sviluppo della strategia aziendale. Riconosce rischi o opportunit√† distruttivi molto presto e guida l'azienda attraverso decisioni coraggiose in una direzione di successo. √à considerato internamente ed esternamente come precursore ("Thought Leader") e inspira non solo il proprio team, ma l'intera organizzazione a pensare pi√π in grande.`, 
                  example: `Resp. Sede: Elabora Business Case per acquisizione in nicchia, permette ingresso mercato.` 
                }
              }
            },
            {
              id: "l3",
              title: "Capacit√† decisionale",
              category: "leadership",
              icon: Target,
              definition: `Decidere tempestivamente e in modo vincolante, anche nell'incertezza. Equilibrio tra analisi e velocit√†.`,
              levels: {
                1: { 
                  text: `Il manager prende decisioni con estrema esitazione o non le prende affatto ("Temporeggiare"). Temi urgenti rimangono fermi, facendo scadere termini o perdere opportunit√†. Richiede per le minime decisioni sempre nuovi dati o delega la decisione al superiore ("Delega di ritorno"), pur di non fare errori. Le decisioni prese vengono riviste immediatamente al minimo vento contrario ("Flip-Flopping"), cosa che disorienta il team. Se una decisione era sbagliata, cerca la colpa negli altri o nelle circostanze, invece di assumersi la responsabilit√†. Manca il coraggio della chiarezza.`, 
                  example: `Acquisti: Non decide per settimane su aumento prezzi. Scadenza passa, condizioni peggiorano.` 
                },
                2: { 
                  text: `Il manager decide spesso troppo tardi, cosicch√© il team rimane in posizione di attesa. Si affida troppo alla sensazione di pancia o a opinioni singole, invece di consultare fatti e dati disponibili ("Data driven"). Le decisioni vengono prese "nel chiuso della stanza" e presentate al team senza giustificazione. Decisioni difficili o impopolari (es. rifiuti a candidati, stop di progetti) vengono rimandate, nella speranza che il problema si risolva da solo. Il manager necessita di molta rassicurazione dall'alto per sentirsi sicuro.`, 
                  example: `Recruiting: Non riesce a decidere tra candidati. Entrambi rinunciano.` 
                },
                3: { 
                  text: `BASELINE: Il manager prende decisioni nel quotidiano tempestivamente e con sicurezza. Pesa opportunit√† e rischi ragionevolmente e utilizza le informazioni esistenti in modo efficiente. Comunica la decisione e il "Perch√©" dietro di essa chiaramente al suo team e alle interfacce interessate. Mantiene la sua decisione anche se c'√® critica, ma √® pronto a correggere la rotta se arrivano nuovi fatti sul tavolo (nessuna testardaggine). Distingue con sicurezza cosa pu√≤ decidere lui stesso e cosa deve essere scalato ‚Äì e fornisce in caso di escalation una chiara raccomandazione.`, 
                  example: `Capoturno: Decide di notte autonomamente riprogrammazione per guasto macchina, informa pianificazione.` 
                },
                4: { 
                  text: `Il manager rimane capace di agire anche in situazioni confuse, sotto pressione temporale o con informazioni incomplete. Prende decisioni coraggiose ("Courage") per evitare lo stallo und gestisce il rischio attivamente. Coinvolge gli stakeholder rilevanti (es. altre sedi) tempestivamente per assicurare la qualit√† della decisione, ma non si perde in infiniti cicli di coordinamento. Spiega anche decisioni impopolari in modo cos√¨ trasparente und wertsch√§tzend ("Fair") che il team pu√≤ sostenerle.`, 
                  example: `Sales Dir: Rifiuta coraggiosamente grande ordine non profittevole ('Courage'), erkl√§rt Strategie 'Wert vor Volumen'.` 
                },
                5: { 
                  text: `Il manager prende decisioni pionieristiche che hanno effetti positivi ben oltre il proprio ambito (es. per l'intero gruppo). In situazioni di crisi prende immediatamente il timone, crea calma und d√† sicurezza und orientamento tramite decisioni chiare. Stabilisce principi o condizioni quadro che permettono ai suoi collaboratori di prendere autonomamente decisioni migliori ("Empowerment"). Ha il coraggio di tagliare rami secchi (es. fermare progetti o prodotti non redditizi) per liberare risorse per il nuovo.`, 
                  example: `IT-Group: Kappt bei Cyber-Verdacht sofort alle Verbindungen der Gruppe, accetta stop prod.` 
                }
              }
            },
            {
              id: "l4",
              title: "Execution & Performance",
              category: "leadership",
              icon: TrendingUp,
              definition: `Trasformare obiettivi in risultati. Usare i dati ('Clarity'), padroneggiare i processi e guidare coerentemente.`,
              levels: {
                1: { 
                  text: `Il manager lavora senza piano o struttura riconoscibile. Progetti e compiti vengono iniziati, ma non portati a termine coerentemente. Non ci sono chiare pietre miliari o responsabilit√†. La prestazione del team non viene misurata o controllata; deviazioni (es. sforamento budget, ritardo termini) si notano solo quando √® troppo tardi. Gli obiettivi vengono mancati regolarmente e chiaramente, ohne dass die F√ºhrungskraft gegensteuert oder die Ursachen analysiert. Es herrscht eine Kultur der Ausreden statt der Ergebnisse.`, 
                  example: `Projektleiter: Software-Rollout Monate √ºberf√§llig. Kein neuer Plan, keine Info an User.` 
                },
                2: { 
                  text: `Il manager si impegna, ma perde spesso il focus nel quotidiano. La pianificazione avviene in modo approssimativo ("Andr√† bene"), rischi o colli di bottiglia non vengono anticipati. Il controllo avviene sporadicamente (es. solo quando il capo chiede), non sistematicamente. Gli obiettivi vengono parzialmente raggiunti, ma spesso solo tramite frenetiche "azioni last-minute" (spegnere incendi) a spese della qualit√† o delle risorse dei collaboratori. Manca trasparenza su dove si trovi veramente il team. I processi non vengono rispettati o costantemente aggirati per forzare risultati a breve termine.`, 
                  example: `Sales: Nota mancato obiettivo solo il 25, fa pressione per deal a basso margine.` 
                },
                3: { 
                  text: `BASELINE: Il manager pianifica compiti e progetti in modo strutturato con tempistiche e risorse realistiche. Definisce chiari criteri di successo (KPI) e controlla il progresso regolarmente (es. in Jour Fixes). In caso di deviazioni interviene tempestivamente e avvia misure correttive per raggiungere ancora l'obiettivo. Assicura che il suo team soddisfi gli obiettivi concordati (Qualit√†, Costi, Tempo) in modo affidabile. Comunica lo stato in modo trasparente ai superiori e alle interfacce. Ci si pu√≤ fidare delle sue promesse ("Fair").`, 
                  example: `Resp. Prod: Organizza subito turno sabato in caso di guasto, informa Vendite proattivamente.` 
                },
                4: { 
                  text: `Il manager non solo amministra, ma ottimizza attivamente. Utilizza dati e indicatori sistematicamente per scoprire inefficienze o colli di bottiglia prima che diventino un problema. Stabilisce routine che assicurano una performance costantemente alta. Fornisce risultati spesso pi√π velocemente ("Fast") o in modo pi√π economico del previsto, senza mettere a rischio la qualit√†. Riesce a mantenere stabile l'operativit√† anche in caso di ostacoli imprevisti (es. ondata di malattia, mancata consegna), perch√© ha pianificato scenari in anticipo.`, 
                  example: `HR: Analizza processo, introduce tool digitale, accorcia 'Time-to-Hire' drasticamente.` 
                },
                5: { 
                  text: `Il manager stabilisce processi Best-Practice che servono da modello per l'intero gruppo (es. un nuovo sistema di reporting che viene poi implementato a Sulzberg e Bolzano). Spinge il miglioramento continuo (KVP) in modo tale da raggiungere salti di performance (es. significativa riduzione della quota scarti o tempo di attraversamento). Crea una cultura di alta prestazione in cui il team si autogestisce e si supera permanentemente. Realizza grandi progetti strategici in "Time, Budget & Quality" e fornisce cos√¨ un contributo diretto al successo aziendale ("1 Result").`, 
                  example: `Logistica: Raggruppa trasporti Sulzberg/Bolzano, riduce costi del 15% con nuovo Cross-Docking.` 
                }
              }
            },
            {
              id: "l5",
              title: "Stakeholder & Risoluzione dei conflitti",
              category: "leadership",
              icon: Award,
              definition: `Curare le relazioni, moderare interessi politici. Costruttore di ponti tra i silos.`,
              levels: {
                1: { 
                  text: `Il manager ignora completamente gli interessi di altri reparti o sedi. Non comunica con stakeholder importanti, portando a sorprese e resistenze. Nei conflitti si comporta in modo distruttivo: cerca colpevoli invece di soluzioni, parla male di altri settori ("Quelli lass√π/laggi√π") o porta avanti conflitti in modo aggressivo e non oggettivo. Alternativamente i conflitti vengono ignorati o attesi finch√© non degenerano. Il comportamento danneggia massicciamente la fiducia e la collaborazione nel gruppo.`, 
                  example: `Resp. Prod: Impreca su 'venditori incapaci' invece di chiarire fattibilit√† direttamente.` 
                },
                2: { 
                  text: `Il manager cura le relazioni solo quando ha acutamente bisogno di qualcosa (transazionale). Dimentica frequentemente di coinvolgere partner rilevanti (es. HR, IT, altre sedi) tempestivamente, ritardando i progetti. Riconosce gaffe politiche spesso troppo tardi. In caso di conflitti reagisce difensivamente o si ritira per "mantenere la pace", anche se sarebbe necessario un chiarimento. Le soluzioni sono spesso compromessi deboli che non soddisfano nessuno. Fa fatica ad assumere la prospettiva dell'interlocutore.`, 
                  example: `Project Leader: Dimentica di informare il consiglio di fabbrica. Ritira progetto offeso in caso di veto.` 
                },
                3: { 
                  text: `BASELINE: Il manager conosce i suoi stakeholder pi√π importanti e li tiene regolarmente informati. Si coordina proattivamente per evitare malintesi. Incontra i partner ‚Äì interni or esterni ‚Äì con rispetto e alla pari. I conflitti vengono affrontati tempestivamente ("Fast") und diskutiert oggettivamente. Rappresenta gli interessi del suo settore, ma √® pronto ad ascoltare argomenti della controparte e trovare soluzioni eque. Assicura che la collaborazione funzioni senza intoppi.`, 
                  example: `Service/Supply: Mostra numeri, concorda oggettivamente scorta minima (Compromesso).` 
                },
                4: { 
                  text: `Il manager costruisce attivamente una rete resiliente oltre i confini del reparto. Anticipa potenziali conflitti (es. colli di bottiglia risorse tra progetti) und moderiert diese pr√§ventiv, bevor sie eskalieren. Comprende i vincoli e gli obiettivi dell'altra parte e offre soluzioni che aiutano entrambi ("Win-Win"). √à apprezzato da altri reparti come partner affidabile che non solo chiede, ma supporta anche. Sa comunicare anche messaggi difficili in modo diplomatico e rispettoso.`, 
                  example: `Quality: Viaggia nelle sedi, modera workshop per standard comune.` 
                },
                5: { 
                  text: `Il manager risolve conflitti complessi e bloccati (es. tensioni culturali tra sedi o guerre di trincea storiche) dove altri hanno fallito. Riesce a orientare interessi diversi verso l'obiettivo strategico comune ("One Niederwieser"). Stabilisce comitati o formati che migliorano strutturalmente lo scambio e la gestione degli stakeholder. Gode della massima fiducia presso la direzione e le rappresentanze dei lavoratori e utilizza questo capitale per il bene dell'azienda. Trasforma avversari in partner.`, 
                  example: `Manager: Rompe vecchi silos, integra team ostili in un'unit√† di successo.` 
                }
              }
            }
          ]
          },
          en: {
            intro: {
              values: [
                { key: "Fast", desc: "We act quickly and solution-oriented.", icon: Zap, color: "text-yellow-600" },
                { key: "Fair", desc: "We work together respectfully and on equal footing.", icon: Scale, color: "text-blue-600" },
                { key: "Personal", desc: "We take responsibility and actively shape things.", icon: Heart, color: "text-red-600" }
              ]
            },
            competencies: [
            {
              id: "c1",
              title: "Technical Expertise & Application",
              category: "core",
              icon: Briefcase,
              definition: `Evaluates specific professional knowledge and its application. It's not just about theoretical ability, but the contribution to process safety and quality.`,
              levels: {
                1: { 
                  text: `The employee lacks the necessary knowledge to perform core tasks. Regular errors jeopardize quality or safety. Requires constant monitoring and correction. Does not independently recognize when to seek help, leading to hidden problems that later have expensive consequences. Instructions are often misunderstood or forgotten. Mistakes are repeated, learning curve remains flat.`, 
                  example: `Machine operator: Repeatedly sets wrong parameters despite standard procedure, causes waste.` 
                },
                2: { 
                  text: `The employee reliably handles standard tasks with established knowledge. When procedures deviate (new products, machine changes, special requests), insecurity arises and support is necessary. Recognizes own limits, but often too late. Learns slowly and needs time with new topics. Work can usually be used, but occasionally requires corrections.`, 
                  example: `Shift worker: Routine runs; struggles with new recipes, needs coaching.` 
                },
                3: { 
                  text: `BASELINE: Solid and continuously current professional knowledge. Works independently and quality-consciously; delivers consistently reliable work. Proactively fills gaps and stays up-to-date in their field. Actively shares experience with colleagues and asks targeted questions when needed. Acts as a reliable element in daily operations. Contributes good ideas based on practical experience.`, 
                  example: `Maintenance: Identifies cause for repeat failure ‚Äì proposes preventive schedule.` 
                },
                4: { 
                  text: `Deep specialist knowledge that goes beyond the role. Understands complex connections and draws preventive conclusions. Is frequently consulted by colleagues for support and is considered a mentor. Can translate new technical requirements (e.g., new materials, certifications) quickly into practice. Thinks in processes, not isolated tasks.`, 
                  example: `Quality: Anticipates customer objection before audit by initiating corrective action proactively.` 
                },
                5: { 
                  text: `Recognized across departments as expert and reference. Initiates and leads training measures; develops internal standards. Represents the company externally as technical authority (customer discussions, certifications, trade fairs). Drives innovations and improvements that demonstrably strengthen competitiveness or quality. Shapes the specialized knowledge of the entire area.`, 
                  example: `Process Engineer: Develops recognized procedure for complex laminate; trains colleagues at all locations.` 
                }
              }
            },
            {
              id: "c2",
              title: "Communication & Collaboration",
              category: "core",
              icon: MessageCircle,
              definition: `Covers information sharing, knowledge exchange, feedback culture, and cross-departmental cooperation. Essential for breaking down silos.`,
              levels: {
                1: { 
                  text: `Actively refuses to share information or works in a "protective mentality." Colleagues are surprised by important developments because the person didn't inform them. In team situations, an oppressive or dismissive atmosphere arises. Uses language that excludes or attacks others. Ignores requests or gives delayed, incomplete answers. Own performance is prioritized while team needs are neglected.`, 
                  example: `Production: Conceals machine problems, causes delays downstream.` 
                },
                2: { 
                  text: `Passes information only upon request or sporadically. Occasionally forgets to inform relevant parties. Uses inefficient channels (e.g., informal instead of written), leading to misunderstandings. May become defensive when receiving feedback or dismisses criticism as personal attacks. Team cooperation depends heavily on mood or is perceived as extra effort.`, 
                  example: `Shift worker: Forgot shift handover entry ‚Äì follow-up shift runs into avoidable problem.` 
                },
                3: { 
                  text: `BASELINE: Proactively informs all relevant people ‚Äì timely, in appropriate form. Gives and receives constructive feedback respectfully. Actively shares knowledge within the team. Uses existing channels (meetings, ticket systems, emails) reliably. Contributes actively in team situations and takes colleagues' perspectives into account. Cooperates appreciatively and smoothly within and outside own team.`, 
                  example: `Maintenance: Emails shift leaders after repair, logs action in system.` 
                },
                4: { 
                  text: `Creates understanding across departments and roles: explains backgrounds, invites dialogue, asks for input. Recognizes silos and actively works to break them down. Builds bridges in conflicts and finds constructive solutions. Is a valued sparring partner for ideas. Promotes transparent culture by sharing information broadly and voluntarily.`, 
                  example: `Team Lead: Organizes weekly cross-department briefing to prevent information gaps.` 
                },
                5: { 
                  text: `Establishes new standards for collaboration (processes, tools, meetings) that are adopted by other teams. Recognized mediator for complex interpersonal tensions. Builds a network of trust across all locations. Maintains a feedback culture that promotes continuous improvement and strengthens trust. Represents "Fast, Fair, Personal" in every interaction.`, 
                  example: `Manager: Introduces cross-location video standup; makes implicit knowledge visible.` 
                }
              }
            },
            {
              id: "c3",
              title: "Problem-Solving Skills",
              category: "core",
              icon: Lightbulb,
              definition: `Systematic analysis of problems, development of sustainable solutions, and self-responsible action. No passing the buck.`,
              levels: {
                1: { 
                  text: `The employee blocks at the first hurdle. Complains about problems but shows no initiative to solve them. Either does nothing or escalates everything immediately without own contribution. Reacts passively-aggressively when asked to contribute to solutions. Work remains unfinished. At best, fixes symptoms but not root causes. Appears overwhelmed by even minor changes or obstacles.`, 
                  example: `Production: Stops work, waits hours instead of seeking solution independently.` 
                },
                2: { 
                  text: `Addresses only symptoms, not root causes ‚Äì problems recur. Escalates too early without own solution attempts or too late so that the situation worsens. Applies known patterns schematically even when inadequate. Does not transfer solutions to other contexts. Requires guidance to analyze situations. Ideas remain superficial.`, 
                  example: `Operator: Replaces same part repeatedly, fails to recognize underlying defect.` 
                },
                3: { 
                  text: `BASELINE: Analyzes problems structurally, identifies causes. Develops independent, pragmatic solutions within own area. Uses existing escalation paths when necessary, but not prematurely. Documents problems and solutions so they remain traceable. Distinguishes urgent from important and acts accordingly. Accepts responsibility for failures and works on their improvement.`, 
                  example: `Shift Lead: Reduces setup time through structured analysis and small process adjustment.` 
                },
                4: { 
                  text: `Recognizes patterns across cases and derives improvements that go beyond a single incident. Develops alternative solutions and weighs them against each other. Leads team-wide problem analyses (root cause analysis, retrospectives). Makes complex technical or organizational problems understandable. Provides impulses for process optimization.`, 
                  example: `Quality: Leads 5-Why workshop, closes systematic complaints.` 
                },
                5: { 
                  text: `Solves strategically relevant problems (e.g., cross-location process, major customer complaints, investment decisions). Acts as a role model in crisis situations: remains calm, establishes structure, leads others out of chaos. Recognizes systemic weaknesses that others overlook and initiates structural changes that contribute to sustainable development.`, 
                  example: `Ops Manager: Leads turnaround in failing project; afterward becomes mentor for problem solving.` 
                }
              }
            },
            {
              id: "c4",
              title: "Adaptability",
              category: "core",
              icon: Brain,
              definition: `Willingness to embrace new processes, technologies, responsibilities. Openness to feedback and personal development.`,
              levels: {
                1: { 
                  text: `Actively resists changes or new processes. Expresses openly negative attitudes: "That's how we've always done it." Shows no interest in own development, ignores training offerings. Stays in comfort zone and avoids learning experiences. Refuses to transfer tasks and behaves in a way that makes change more difficult.`, 
                  example: `Veteran: Refuses to learn new software; blocks colleagues' learning.` 
                },
                2: { 
                  text: `Goes along with changes only under pressure and often half-heartedly. New knowledge is learned slowly; interest in further development is low. Uses training but shows little initiative for independent learning. Sometimes passive when priorities shift. Waits for instructions instead of adapting proactively.`, 
                  example: `Technician: Uses new tool only when forced; has to be reminded repeatedly.` 
                },
                3: { 
                  text: `BASELINE: Is curious about new topics and approaches. Reflects on own work style and accepts constructive criticism. Responds flexibly to priority changes and adapts without loss of motivation. Uses offered training and implements what was learned. Contributes to continuous improvement, such as suggestions that make daily work easier.`, 
                  example: `Warehouse: Proposes new labeling after attending logistics training.` 
                },
                4: { 
                  text: `Actively seeks new knowledge, recognizes trends, and brings them to the team. Acts as a catalyst for change: convinces skeptics and supports implementation. Creates learning opportunities for self and others. Adapts quickly to fundamental changes without drop in motivation.`, 
                  example: `Team Lead: Introduces new production method from trade fair, leads pilot run.` 
                },
                5: { 
                  text: `Anticipates future trends or challenges and prepares the organization. Builds structures that increase adaptability (cross-training, modular processes). Shapes cultural change by embodying openness and learning orientation. Inspires others to embrace change.`, 
                  example: `Plant Manager: Initiates Transformation Workshop Series; equips plant for Industry 4.0.` 
                }
              }
            },
            {
              id: "c5",
              title: "Self-Organization",
              category: "core",
              icon: Clock,
              definition: `Time management, prioritization, reliability, resource management. Ensures personal contribution is plannable and predictable.`,
              levels: {
                1: { 
                  text: `Is chaotic: deadlines are frequently missed, tasks are forgotten or handled only partially. Work can hardly be planned for others. No visible priorities ‚Äì works on random items. Commits to things but doesn't keep commitments, causing domino effects. Meetings and work start late, materials are not found.`, 
                  example: `Admin: Forgot important deadline ‚Äì customer loses order.` 
                },
                2: { 
                  text: `Requires external structure and guidance to stay organized. Works reasonably well with clear instructions but has difficulties managing own time when given more autonomy. Re-prioritizes only when pointed out. Occasionally shows reactivity in case of overload but no forward-looking capacity management.`, 
                  example: `Assistant: Needs reminders for recurring tasks; forgets follow-ups.` 
                },
                3: { 
                  text: `BASELINE: Plans work reliably, keeps appointments and deadlines. Prioritizes sensibly and identifies time-critical tasks. Keeps commitments and communicates early when obstacles arise. Works with clear focus and avoids unnecessary distractions. Has a transparent overview of current projects and contributes personal share to team success.`, 
                  example: `Controller: Prepares monthly closing on time, communicates bottleneck proactively.` 
                },
                4: { 
                  text: `Plans ahead, anticipates bottlenecks, and reserves buffers. Relieves others by taking over coordination tasks. Continuously optimizes own ways of working (tools, routines) and shares improvements. Can successfully manage multiple work streams simultaneously without loss of quality.`, 
                  example: `Planner: Synchronizes three parallel projects, avoids bottleneck through early resource coordination.` 
                },
                5: { 
                  text: `Coordinates complex projects across departments or locations and brings them to a successful conclusion on schedule. Establishes standards for self-organization that others adopt (templates, checklists, work principles). Is trusted for particularly complex or ambiguous tasks. Acts as role model for organized and structured work.`, 
                  example: `Project Lead: Coordinates major investment across all locations, delivers on time and under budget.` 
                }
              }
            },
            {
              id: "l1",
              title: "Employee Management & Development",
              category: "leadership",
              icon: Users,
              definition: `Leadership through development ‚Äì motivation, coaching, feedback, personnel development in the team.`,
              levels: {
                1: { 
                  text: `The manager shows no interest in the professional or personal development of their team. Team discussions are avoided or only superficial; annual conversations (if held at all) are formalistic and without value. There's constant micromanagement, creating a climate of distrust and leading to high turnover. High performers leave. Conflicts in the team are ignored or made worse. No succession planning or talent development visible.`, 
                  example: `Shift Lead: Criticizes only, never praises. Demotivates team, increases sick leave.` 
                },
                2: { 
                  text: `The manager holds mandatory conversations but avoids clear, uncomfortable feedback ("uncomfortable conversations"). High performers are insufficiently challenged, low performers not addressed. Development is left to HR or chance. The manager tends to reward loyalty or personal sympathy rather than performance. Team dynamics are hardly shaped, impulses for development are lacking. Little structured follow-up on coaching discussions.`, 
                  example: `Team Lead: Holds annual reviews superficially; forgets development agreements.` 
                },
                3: { 
                  text: `BASELINE: Regular, prepared team discussions with specific feedback (strengths, development areas). Coaching approach: promotes independent solutions instead of just prescribing. Addresses performance differences early and follows up on agreements. Delegates consciously, transfers responsibility for development. Interested in individual career aspirations and promotes appropriate measures (training, projects, mentoring).`, 
                  example: `Manager: Implements monthly feedback loops, prepares successors targeted.` 
                },
                4: { 
                  text: `The manager has a strategic development plan for their team: knows potentials, identifies and develops high performers, supports lateral moves for stagnating employees. Holds difficult conversations (low performance, conflicts) with clear outcome. Creates a learning environment where mistakes are allowed. Attracts and retains talents. Engages personally in mentoring and is valued for it.`, 
                  example: `Department Head: Promotes talent visibly, makes own team diverse and resilient.` 
                },
                5: { 
                  text: `Creates a sustainable leadership culture: the manager develops successors who themselves become excellent leaders. Exports best practices for people development to other locations. Has an outstanding record for talent retention and employee satisfaction. Is internally and externally known as employer of choice advocate. Leaves behind a sustainably strong team.`, 
                  example: `Director: Builds talent factory ‚Äì team members develop into successful leaders.` 
                }
              }
            },
            {
              id: "l2",
              title: "Strategic Thinking",
              category: "leadership",
              icon: TrendingUp,
              definition: `Thinking ahead: understands competitive environment, develops foresight, initiates strategically.`,
              levels: {
                1: { 
                  text: `The manager is trapped in tunnel vision. Works purely reactively, always on the next acute fire without understanding context. Strategic topics (strategy 2035, market changes, competitive position) are ignored or not even understood. Sees neither risks nor opportunities at the horizon. Decisions are short-term and not aligned with the bigger picture. Doesn't communicate company goals to the team.`, 
                  example: `Manager: Focuses only on delivery pressure; ignores changing customer requirements.` 
                },
                2: { 
                  text: `The manager understands strategic guidelines but hardly translates them into own area. Operational day-to-day dominates thinking. Rarely links decisions to the strategic context or larger goals. Reacts to external changes (customer requirements, market shifts) only with delay. Rarely brings own ideas for strategic improvement.`, 
                  example: `Sales Lead: Focuses on ongoing business; misses emerging product trend.` 
                },
                3: { 
                  text: `BASELINE: The manager translates company strategy into tangible goals for their team. Shows connections to the bigger picture. Recognizes strategic developments (e.g., sustainability, automation) and aligns own planning accordingly. Actively informs themselves about customer, market, and industry trends. Makes strategic statements comprehensible for the team.`, 
                  example: `Production: Aligns shift planning to known plant strategy, takes capacity reserves.` 
                },
                4: { 
                  text: `The manager anticipates developments (technology, customer, competitive situation) and proactively builds competencies or capacities. Challenges the status quo ("What if...?") and brings substantiated proposals for improvement or innovation. Thinks in scenarios and prepares alternatives. Continuously brings external impulses (trade fairs, networks, publications) into the team.`, 
                  example: `Operations: Initiates automation pilot before cost pressure occurs.` 
                },
                5: { 
                  text: `The manager shapes strategic direction for their area or beyond ‚Äì develops new business models, negotiates partnerships, or leads M&A projects. Is involved in strategic decision-making of the group. Has a broad overview of the competitive situation and contributes recognized impulses. Is a thought leader who influences direction inside and outside the organization.`, 
                  example: `Division Lead: Develops new service offering, opens new revenue stream.` 
                }
              }
            },
            {
              id: "l3",
              title: "Decision-Making",
              category: "leadership",
              icon: ShieldAlert,
              definition: `Deciding under uncertainty, courage for risky decisions, transparency about what and why.`,
              levels: {
                1: { 
                  text: `The manager chronically avoids decisions. Every somewhat significant question is escalated upward. Employees remain in limbo, initiative is blocked. If decisions are made, they are reversed at the smallest resistance. Taking responsibility is refused; in case of failures, blame is shifted to others. Decisions are not communicated transparently ‚Äì the team doesn't know what applies and why.`, 
                  example: `Manager: Keeps everything in limbo, escalates everything. Team frustrated.` 
                },
                2: { 
                  text: `The manager makes decisions when information situation is almost perfect, but hesitates when data are ambiguous. Avoids politically sensitive decisions. Sticks too long to wrong decisions because of loss aversion or not to appear inconsistent. Doesn't always communicate decisions clearly or justifies them insufficiently. Risk considerations are superficial.`, 
                  example: `Team Lead: Holds back project budget until last minute; misses deadline.` 
                },
                3: { 
                  text: `BASELINE: The manager makes decisions within their mandate in a timely and transparent manner. Weighs risks and opportunities, documents considerations, and stands by results. Communicates decisions clearly ‚Äì everyone knows what applies and why. Accepts that some decisions turn out wrong and draws learnings from this.`, 
                  example: `Shift Lead: Decides on overtime with clear reasoning, stands by when questioned.` 
                },
                4: { 
                  text: `The manager makes uncomfortable decisions (layoffs, reprioritization, investment stop) when necessary, even if these are unpopular. Intelligently manages risk: takes calculated risks for improvement without gambling. Shows courage to decide without full consensus when time is of the essence. Weighs costs of delaying decisions.`, 
                  example: `Plant Manager: Decides on shift restructuring ‚Äì communicates personally, accompanies change.` 
                },
                5: { 
                  text: `The manager makes strategic, far-reaching decisions with courage and clarity ‚Äì including in ambiguous situations or under high political pressure. Is known for principled decision-making that is later validated. Maintains decision quality even in crisis mode (no panic decisions). Actively seeks feedback on decision quality.`, 
                  example: `Director: Decides on fundamental reorientation during market downturn ‚Äì leads restructuring successfully.` 
                }
              }
            },
            {
              id: "l4",
              title: "Execution & Performance Management",
              category: "leadership",
              icon: Target,
              definition: `Achieving results, consistent follow-through, demanding and supporting. Getting things done.`,
              levels: {
                1: { 
                  text: `The manager neither sets clear goals nor follows up on them. Expectations are unclear, performance is neither measured nor addressed. Promises to customers, management, or other stakeholders are frequently broken or missed ‚Äì without consequences. No prioritization recognizable. In the team, anything goes; low performers run with no response. Meetings end without clear actions.`, 
                  example: `Manager: Tolerates delay after delay; customer loses trust.` 
                },
                2: { 
                  text: `Goals are stated but not consistently followed up. The manager remembers agreements only when already off track. Feedback on performance gaps is superficial or avoided. Requires only under pressure, then too harshly; no balance. Responds to performance problems too late or not at all. Tracking in meetings is unstructured.`, 
                  example: `Team Lead: Lets quota slip, only notices at month end.` 
                },
                3: { 
                  text: `BASELINE: The manager sets clear, understandable goals for their team. Expectations are transparent, performance is regularly discussed. Requires adherence to agreements and addresses deviations early. Supports team in goal achievement but doesn't take over responsibility. Distinguishes conscious goal adjustment from failure. Establishes a reliable progress tracking.`, 
                  example: `Production: Visualizes weekly targets, follows up on deviations, supports team.` 
                },
                4: { 
                  text: `The manager is rigorously consistent but without demotivating. Balances pressure and support. Establishes a performance culture where everyone gives their best. Reduces KPI blind spots through targeted measurement concepts. Proactively identifies risks for goal achievement and initiates countermeasures. Can simultaneously track multiple important initiatives.`, 
                  example: `Operations: Drives cost optimization, celebrates milestones, maintains team morale.` 
                },
                5: { 
                  text: `The manager establishes a cross-site performance culture that sets standards for the group. Leads major initiatives with strategic significance and track record of success. Is known for delivering what is promised. Shapes improvement practices (OKR, KPIs, retros) that are adopted by other areas. Develops leaders who bring the same rigor.`, 
                  example: `VP: Drives group-wide Lean initiative; measurable productivity gains.` 
                }
              }
            },
            {
              id: "l5",
              title: "Stakeholder & Conflict Resolution",
              category: "leadership",
              icon: Award,
              definition: `Cultivating relationships, moderating political interests. Bridge builder between silos.`,
              levels: {
                1: { 
                  text: `The manager completely ignores the interests of other departments or locations. Doesn't communicate with important stakeholders, leading to surprises and resistance. In conflicts behaves destructively: searches for culprits instead of solutions, speaks badly about other areas ("Those up/down there") or carries out conflicts aggressively and non-objectively. Alternatively, conflicts are ignored or waited out until they escalate. Behavior massively damages trust and cooperation in the group.`, 
                  example: `Prod Manager: Curses about 'incompetent sales' instead of clarifying feasibility directly.` 
                },
                2: { 
                  text: `The manager cultivates relationships only when acutely needing something (transactional). Frequently forgets to involve relevant partners (e.g., HR, IT, other locations) in time, delaying projects. Recognizes political faux pas often too late. In case of conflicts reacts defensively or withdraws to "keep the peace" even when clarification would be necessary. Solutions are often weak compromises that satisfy no one. Struggles to take the counterpart's perspective.`, 
                  example: `Project Lead: Forgets to inform works council. Withdraws project offended at veto.` 
                },
                3: { 
                  text: `BASELINE: The manager knows their most important stakeholders and keeps them regularly informed. Coordinates proactively to avoid misunderstandings. Meets partners ‚Äì internal or external ‚Äì with respect and on equal footing. Conflicts are addressed in a timely manner ("Fast") and discussed objectively. Represents the interests of their area, but is ready to listen to counterarguments and find fair solutions. Ensures cooperation runs smoothly.`, 
                  example: `Service/Supply: Shows figures, agrees objectively on minimum stock (Compromise).` 
                },
                4: { 
                  text: `The manager actively builds a resilient network beyond department boundaries. Anticipates potential conflicts (e.g., resource bottlenecks between projects) and moderates them preventively before they escalate. Understands the constraints and goals of the other side and offers solutions that help both ("Win-Win"). Is appreciated by other departments as a reliable partner who not only asks but also supports. Can communicate even difficult messages diplomatically and respectfully.`, 
                  example: `Quality: Travels to locations, moderates workshop for common standard.` 
                },
                5: { 
                  text: `The manager resolves complex, stuck conflicts (e.g., cultural tensions between locations or historical turf wars) where others have failed. Succeeds in aligning diverse interests toward the common strategic goal ("One Niederwieser"). Establishes committees or formats that structurally improve exchange and stakeholder management. Enjoys highest trust with management and employee representatives and uses this capital for the company's good. Transforms adversaries into partners.`, 
                  example: `Manager: Breaks old silos, integrates hostile teams into successful unit.` 
                }
              }
            }
          ]
          }
        };

        // --- QUIZ DATA (Removed, but keeping definition for completeness) ---
        const QUIZ_QUESTIONS = { de: [], it: [], en: [] }; // Leeren, da Quiz entfernt wird

        // --- REACT COMPONENT ---

        // ============================================
        // PRINT LAYOUT COMPONENT - Professioneller PDF-Export
        // ============================================
        const PrintLayout = ({ type, data, lang }) => {
          const e = React.createElement;
          
          // Texte f√ºr verschiedene Sprachen
          const texts = {
            de: {
              coverTitle: type === 'goals' ? 'Zielvereinbarung' : type === 'review' ? 'Leistungsbeurteilung' : 'Selbstreflexion',
              coverSubtitle: 'Performance Management',
              period: 'Beurteilungszeitraum',
              employee: 'Mitarbeiter/in',
              manager: 'F√ºhrungskraft',
              position: 'Position',
              department: 'Abteilung',
              date: 'Datum',
              confidential: 'Vertraulich - Nur f√ºr den internen Gebrauch',
              goals: 'Zieldefinition',
              weight: 'Gewichtung',
              target: 'Zielwert / Beschreibung',
              development: 'Entwicklungsma√ünahmen',
              measure: 'Ma√ünahme',
              responsible: 'Verantwortlich',
              deadline: 'Termin',
              signatures: 'Unterschriften',
              signatureNote: 'Mit ihrer Unterschrift best√§tigen beide Parteien die Kenntnisnahme und Zustimmung.',
              dateSignature: 'Datum, Unterschrift',
              plannedBonus: 'Geplanter Bonus bei 100%'
            },
            it: {
              coverTitle: type === 'goals' ? 'Accordo sugli Obiettivi' : type === 'review' ? 'Valutazione delle Prestazioni' : 'Autovalutazione',
              coverSubtitle: 'Performance Management',
              period: 'Periodo di valutazione',
              employee: 'Collaboratore',
              manager: 'Responsabile',
              position: 'Posizione',
              department: 'Reparto',
              date: 'Data',
              confidential: 'Riservato - Solo per uso interno',
              goals: 'Definizione degli obiettivi',
              weight: 'Peso',
              target: 'Valore target / Descrizione',
              development: 'Misure di sviluppo',
              measure: 'Misura',
              responsible: 'Responsabile',
              deadline: 'Scadenza',
              signatures: 'Firme',
              signatureNote: 'Con la firma, entrambe le parti confermano la presa visione e l\'accordo.',
              dateSignature: 'Data, Firma',
              plannedBonus: 'Bonus previsto al 100%'
            },
            en: {
              coverTitle: type === 'goals' ? 'Goal Agreement' : type === 'review' ? 'Performance Review' : 'Self-Reflection',
              coverSubtitle: 'Performance Management',
              period: 'Review Period',
              employee: 'Employee',
              manager: 'Manager',
              position: 'Position',
              department: 'Department',
              date: 'Date',
              confidential: 'Confidential - Internal Use Only',
              goals: 'Goal Definition',
              weight: 'Weight',
              target: 'Target Value / Description',
              development: 'Development Measures',
              measure: 'Measure',
              responsible: 'Responsible',
              deadline: 'Deadline',
              signatures: 'Signatures',
              signatureNote: 'With their signature, both parties confirm acknowledgment and agreement.',
              dateSignature: 'Date, Signature',
              plannedBonus: 'Planned Bonus at 100%'
            }
          };
          
          const t = texts[lang] || texts.de;
          const currentDate = new Date().toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB');
          
          // Zahlenformatierung
          const formatNumber = (num) => {
            return new Intl.NumberFormat(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB').format(num);
          };

          // === COVER PAGE ===
          const CoverPage = () => e('div', { 
            style: { 
              pageBreakAfter: 'always', 
              minHeight: '297mm',
              display: 'flex',
              flexDirection: 'column',
              padding: '60px 50px',
              boxSizing: 'border-box'
            }
          },
            // Logo & Branding
            e('div', { style: { marginBottom: '80px' } },
              e('h1', { style: { color: '#243186', fontSize: '42pt', margin: 0, fontWeight: 700, letterSpacing: '-1px' } }, 'nƒ±ederwƒ±eser'),
              e('p', { style: { color: '#6EBD84', fontSize: '11pt', margin: '5px 0 0 0', fontWeight: 600, letterSpacing: '3px' } }, 'FLEXIBLE FOOD PACKAGING')
            ),
            
            // Haupttitel
            e('div', { style: { flex: 1, display: 'flex', flexDirection: 'column', justifyContent: 'center' } },
              e('div', { style: { 
                background: 'linear-gradient(135deg, #243186 0%, #1a2564 100%)', 
                color: 'white', 
                padding: '40px 50px',
                borderRadius: '12px',
                marginBottom: '50px'
              }},
                e('h2', { style: { fontSize: '32pt', margin: 0, fontWeight: 700 } }, t.coverTitle),
                e('p', { style: { fontSize: '14pt', margin: '10px 0 0 0', opacity: 0.9 } }, t.coverSubtitle)
              ),
              
              // Stammdaten-Box
              e('div', { style: { 
                background: '#f8fafc', 
                border: '1px solid #e2e8f0',
                borderRadius: '8px',
                padding: '30px 40px'
              }},
                e('div', { style: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' } },
                  e('div', null,
                    e('p', { style: { color: '#64748b', fontSize: '9pt', margin: '0 0 5px 0', textTransform: 'uppercase', letterSpacing: '1px' } }, t.employee),
                    e('p', { style: { color: '#1e293b', fontSize: '14pt', margin: 0, fontWeight: 600 } }, data.employee || '‚Äì')
                  ),
                  e('div', null,
                    e('p', { style: { color: '#64748b', fontSize: '9pt', margin: '0 0 5px 0', textTransform: 'uppercase', letterSpacing: '1px' } }, t.manager),
                    e('p', { style: { color: '#1e293b', fontSize: '14pt', margin: 0, fontWeight: 600 } }, data.manager || '‚Äì')
                  ),
                  e('div', null,
                    e('p', { style: { color: '#64748b', fontSize: '9pt', margin: '0 0 5px 0', textTransform: 'uppercase', letterSpacing: '1px' } }, t.position),
                    e('p', { style: { color: '#1e293b', fontSize: '12pt', margin: 0 } }, data.position || '‚Äì')
                  ),
                  e('div', null,
                    e('p', { style: { color: '#64748b', fontSize: '9pt', margin: '0 0 5px 0', textTransform: 'uppercase', letterSpacing: '1px' } }, t.period),
                    e('p', { style: { color: '#1e293b', fontSize: '12pt', margin: 0 } }, data.period || new Date().getFullYear())
                  )
                )
              )
            ),
            
            // Footer
            e('div', { style: { textAlign: 'center', paddingTop: '40px', borderTop: '1px solid #e2e8f0' } },
              e('p', { style: { color: '#94a3b8', fontSize: '9pt', margin: 0 } }, t.confidential),
              e('p', { style: { color: '#cbd5e1', fontSize: '8pt', margin: '5px 0 0 0' } }, `${t.date}: ${currentDate}`)
            )
          );

          // === GOALS PAGE ===
          const GoalsPage = () => {
            if (!data.goals || data.goals.length === 0) return null;
            
            const totalWeight = data.goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
            
            return e('div', { style: { pageBreakAfter: 'always', padding: '40px 50px' } },
              // Header
              e('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px', paddingBottom: '15px', borderBottom: '2px solid #243186' } },
                e('div', null,
                  e('h1', { style: { color: '#243186', fontSize: '18pt', margin: 0, fontWeight: 700 } }, 'nƒ±ederwƒ±eser'),
                  e('p', { style: { color: '#6EBD84', fontSize: '8pt', margin: '2px 0 0 0', letterSpacing: '2px' } }, 'PERFORMANCE MANAGEMENT')
                ),
                e('div', { style: { textAlign: 'right' } },
                  e('p', { style: { color: '#64748b', fontSize: '9pt', margin: 0 } }, data.employee),
                  e('p', { style: { color: '#94a3b8', fontSize: '8pt', margin: '2px 0 0 0' } }, data.period || new Date().getFullYear())
                )
              ),
              
              // Ziele Sektion
              e('div', { style: { marginBottom: '30px' } },
                e('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: '#f8fafc', padding: '12px 16px', borderLeft: '4px solid #3b82f6', marginBottom: '15px' } },
                  e('h3', { style: { fontSize: '14pt', margin: 0, color: '#1e40af', fontWeight: 600 } }, t.goals),
                  e('span', { style: { 
                    background: totalWeight === 100 ? '#dcfce7' : '#fef9c3', 
                    color: totalWeight === 100 ? '#166534' : '#854d0e',
                    padding: '4px 12px',
                    borderRadius: '20px',
                    fontSize: '10pt',
                    fontWeight: 600
                  }}, `${t.weight}: ${totalWeight}%`)
                ),
                
                // Ziele Tabelle
                e('table', { style: { width: '100%', borderCollapse: 'collapse', fontSize: '10pt' } },
                  e('thead', null,
                    e('tr', { style: { background: '#1e40af', color: 'white' } },
                      e('th', { style: { padding: '10px 12px', textAlign: 'left', fontWeight: 600, width: '35%' } }, t.goals),
                      e('th', { style: { padding: '10px 12px', textAlign: 'center', fontWeight: 600, width: '60px' } }, t.weight),
                      data.plannedBonus && e('th', { style: { padding: '10px 12px', textAlign: 'right', fontWeight: 600, width: '80px' } }, 'Bonus ‚Ç¨'),
                      e('th', { style: { padding: '10px 12px', textAlign: 'left', fontWeight: 600 } }, t.target)
                    )
                  ),
                  e('tbody', null,
                    data.goals.map((goal, idx) => {
                      const goalBonus = data.plannedBonus ? (parseFloat(data.plannedBonus) * (parseFloat(goal.weight) || 0) / 100) : 0;
                      return e('tr', { key: idx, style: { background: idx % 2 === 0 ? '#ffffff' : '#f8fafc' } },
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', fontWeight: 500, verticalAlign: 'top', whiteSpace: 'pre-wrap', wordWrap: 'break-word' } }, goal.name || '‚Äì'),
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', textAlign: 'center', verticalAlign: 'top' } },
                          e('span', { style: { background: '#dbeafe', color: '#1e40af', padding: '2px 8px', borderRadius: '10px', fontWeight: 700, fontSize: '9pt' } }, `${goal.weight}%`)
                        ),
                        data.plannedBonus && e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', textAlign: 'right', fontWeight: 600, color: '#065f46', verticalAlign: 'top' } }, `${formatNumber(Math.round(goalBonus))} ‚Ç¨`),
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', color: '#475569', fontSize: '9pt', verticalAlign: 'top', whiteSpace: 'pre-wrap', wordWrap: 'break-word' } }, goal.target || '‚Äì')
                      );
                    })
                  )
                ),
                
                // Bonus Summe
                data.plannedBonus && e('div', { style: { 
                  marginTop: '15px', 
                  padding: '15px 20px', 
                  background: 'linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%)', 
                  border: '1px solid #6ee7b7',
                  borderRadius: '8px',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }},
                  e('span', { style: { fontSize: '11pt', color: '#065f46', fontWeight: 600 } }, t.plannedBonus + ':'),
                  e('span', { style: { fontSize: '20pt', fontWeight: 900, color: '#065f46' } }, `${formatNumber(data.plannedBonus)} ‚Ç¨`)
                )
              ),
              
              // Entwicklungsma√ünahmen
              data.devPlan && data.devPlan.length > 0 && data.devPlan[0].measure && e('div', { style: { marginBottom: '30px' } },
                e('div', { style: { background: '#f8fafc', padding: '12px 16px', borderLeft: '4px solid #6EBD84', marginBottom: '15px' } },
                  e('h3', { style: { fontSize: '14pt', margin: 0, color: '#166534', fontWeight: 600 } }, t.development)
                ),
                e('table', { style: { width: '100%', borderCollapse: 'collapse', fontSize: '10pt' } },
                  e('thead', null,
                    e('tr', { style: { background: '#166534', color: 'white' } },
                      e('th', { style: { padding: '10px 12px', textAlign: 'left', fontWeight: 600 } }, t.measure),
                      e('th', { style: { padding: '10px 12px', textAlign: 'left', fontWeight: 600, width: '120px' } }, t.responsible),
                      e('th', { style: { padding: '10px 12px', textAlign: 'center', fontWeight: 600, width: '100px' } }, t.deadline)
                    )
                  ),
                  e('tbody', null,
                    data.devPlan.filter(d => d.measure).map((dev, idx) => 
                      e('tr', { key: idx, style: { background: idx % 2 === 0 ? '#ffffff' : '#f0fdf4' } },
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', verticalAlign: 'top', whiteSpace: 'pre-wrap', wordWrap: 'break-word' } }, dev.measure || '‚Äì'),
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', verticalAlign: 'top' } }, dev.responsible || '‚Äì'),
                        e('td', { style: { padding: '10px 12px', borderBottom: '1px solid #e2e8f0', textAlign: 'center', verticalAlign: 'top' } }, dev.deadline || '‚Äì')
                      )
                    )
                  )
                )
              )
            );
          };

          // === SIGNATURE PAGE ===
          const SignaturePage = () => e('div', { style: { padding: '40px 50px' } },
            // Header
            e('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px', paddingBottom: '15px', borderBottom: '2px solid #243186' } },
              e('div', null,
                e('h1', { style: { color: '#243186', fontSize: '18pt', margin: 0, fontWeight: 700 } }, 'nƒ±ederwƒ±eser'),
                e('p', { style: { color: '#6EBD84', fontSize: '8pt', margin: '2px 0 0 0', letterSpacing: '2px' } }, 'PERFORMANCE MANAGEMENT')
              ),
              e('div', { style: { textAlign: 'right' } },
                e('p', { style: { color: '#64748b', fontSize: '9pt', margin: 0 } }, data.employee),
                e('p', { style: { color: '#94a3b8', fontSize: '8pt', margin: '2px 0 0 0' } }, data.period || new Date().getFullYear())
              )
            ),
            
            // Unterschriften Box
            e('div', { style: { 
              marginTop: '40px',
              padding: '30px 40px', 
              border: '2px solid #243186', 
              borderRadius: '12px'
            }},
              e('h3', { style: { fontSize: '14pt', margin: '0 0 15px 0', color: '#243186', fontWeight: 600, textAlign: 'center' } }, t.signatures),
              e('p', { style: { fontSize: '10pt', color: '#64748b', textAlign: 'center', marginBottom: '50px' } }, t.signatureNote),
              
              e('div', { style: { display: 'flex', justifyContent: 'space-between', marginTop: '60px' } },
                e('div', { style: { width: '42%', textAlign: 'center' } },
                  e('div', { style: { borderBottom: '2px solid #1e293b', height: '60px' } }),
                  e('p', { style: { margin: '10px 0 0 0', fontSize: '10pt', color: '#64748b' } }, t.employee),
                  e('p', { style: { margin: '3px 0 0 0', fontSize: '8pt', color: '#94a3b8' } }, t.dateSignature)
                ),
                e('div', { style: { width: '42%', textAlign: 'center' } },
                  e('div', { style: { borderBottom: '2px solid #1e293b', height: '60px' } }),
                  e('p', { style: { margin: '10px 0 0 0', fontSize: '10pt', color: '#64748b' } }, t.manager),
                  e('p', { style: { margin: '3px 0 0 0', fontSize: '8pt', color: '#94a3b8' } }, t.dateSignature)
                )
              )
            ),
            
            // Footer
            e('div', { style: { marginTop: '60px', paddingTop: '15px', borderTop: '1px solid #e2e8f0', textAlign: 'center' } },
              e('p', { style: { fontSize: '9pt', color: '#94a3b8', margin: 0 } }, 
                `Niederwieser Group | ${t.coverSubtitle} | ${currentDate}`
              ),
              e('p', { style: { fontSize: '8pt', color: '#cbd5e1', margin: '5px 0 0 0' } }, t.confidential)
            )
          );

          // === MAIN RENDER ===
          return e('div', { 
            id: 'print-layout-container',
            style: { 
              fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
              fontSize: '10pt',
              color: '#1e293b',
              background: 'white'
            }
          },
            e(CoverPage),
            e(GoalsPage),
            e(SignaturePage)
          );
        };

        // === ZIELVEREINBARUNG COMPONENT (Simplified Goal Agreement) ===
        const Zielvereinbarung = ({ lang, onSaveTeam, onCancel }) => {
            const t = FORM_TEXT[lang] || FORM_TEXT['de'];
            const formRef = useRef(null);

            
            // === TEAM CONTEXT ===
            const [teamContext, setTeamContext] = useState(null);
            const [teamButtonsVisible, setTeamButtonsVisible] = useState(false);
            
            useEffect(() => {
              const ctx = localStorage.getItem('nw_current_employee');
              console.log('üîç Zielvereinbarung useEffect triggered');
              console.log('   localStorage nw_current_employee:', ctx);
              
              if (ctx) {
                try {
                  const data = JSON.parse(ctx);
                  console.log('‚úì Parsed team context:', data);
                  setTeamContext(data);
                  setTeamButtonsVisible(true);
                  console.log('‚úì teamButtonsVisible set to TRUE');
                  
                  // Load existing data if available
                  if (data.existingData) {
                    const existing = data.existingData;
                    
                    // Set form data
                    setFormData(prev => ({
                      ...prev,
                      employee: existing.employeeName || data.employee.name,
                      position: existing.position || data.employee.position,
                      manager: existing.formData?.manager || prev.manager,
                      date: existing.updatedAt ? existing.updatedAt.split('T')[0] : prev.date,
                      plannedBonus: existing.formData?.plannedBonus || ''
                    }));
                    
                    // Set goals if exists
                    if (existing.goals && existing.goals.length > 0) {
                      setGoals(existing.goals);
                    }
                    
                    // Set devPlan if exists
                    if (existing.devPlan && existing.devPlan.length > 0) {
                      setDevPlan(existing.devPlan);
                    }
                  } else {
                    // New appraisal - set employee data
                    setFormData(prev => ({
                      ...prev,
                      employee: data.employee.name,
                      position: data.employee.position
                    }));
                  }
                } catch (e) {
                  console.error('Error loading team context:', e);
                }
              }
            }, []);
            
            const handleSaveTeamAppraisal = (status) => {
              if (!teamContext || !onSaveTeam) {
                alert('Team-Kontext fehlt!');
                return;
              }
              
              // F√ºr Zielvereinbarungen: kein GPS-Score berechnen
              const appraisal = {
                id: teamContext.appraisalId,
                type: 'goals', // WICHTIG: Typ auf 'goals' setzen
                employeeId: teamContext.employee.id,
                employeeName: teamContext.employee.name,
                position: teamContext.employee.position,
                period: teamContext.period,
                status: status,
                createdAt: teamContext.existingData?.createdAt || new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                goals: goals,
                devPlan: devPlan,
                formData: formData,
                // F√ºr Zielvereinbarungen keine GPS-relevanten Scores
                gpsScore: 0,
                wasScore: 0,
                wieCoreScore: 0,
                wieLeaderScore: 0
              };
              
              // Debug-Log
              console.log('üíæ Speichere Zielvereinbarung:', {
                status,
                goalsCount: goals.length,
                totalWeight: goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0)
              });
              
              onSaveTeam(appraisal);
            };
            
            const handleCancelTeam = () => {
              if (confirm(lang === 'de' ? 'Abbrechen? √Ñnderungen gehen verloren.' : lang === 'it' ? 'Annullare? Le modifiche andranno perse.' : 'Cancel? Changes will be lost.')) {
                localStorage.removeItem('nw_current_employee');
                if (onCancel) onCancel();
              }
            };
            
            const [isGenerating, setIsGenerating] = useState(false);
            
            const [formData, setFormData] = useState({
                employee: '', 
                position: '', 
                manager: '', 
                date: new Date().toISOString().split('T')[0],
                plannedBonus: ''  // Geplanter Bonus (100%)
            });
            
            const [goals, setGoals] = useState([
                { id: 101, name: '', weight: 60, target: '' },
                { id: 102, name: '', weight: 40, target: '' }
            ]);
            
            const [devPlan, setDevPlan] = useState([
                { id: 201, measure: '', responsible: '', deadline: '' }
            ]);

            const handleFormChange = (field, val) => setFormData({...formData, [field]: val});
            
            // Hilfsfunktion: Tausenderpunkte aus Eingabe entfernen (1.000 ‚Üí 1000)
            const parseGermanNumber = (str) => {
                if (!str) return '';
                // Entferne Tausenderpunkte und ersetze Komma durch Punkt f√ºr Dezimalzahlen
                return str.replace(/\./g, '').replace(',', '.');
            };
            
            // Hilfsfunktion: Zahl mit Tausenderpunkten formatieren (1000 ‚Üí 1.000)
            const formatGermanNumber = (num) => {
                if (!num && num !== 0) return '';
                const numStr = String(num).replace(/[^\d]/g, '');
                if (!numStr) return '';
                return Number(numStr).toLocaleString('de-DE');
            };
            
            // Handler f√ºr Bonus-Feld mit Tausenderpunkt-Unterst√ºtzung
            const handleBonusChange = (val) => {
                // Erlaube nur Zahlen und Punkte
                const cleanVal = val.replace(/[^\d.]/g, '');
                // Speichere den rohen Wert ohne Formatierung f√ºr die Berechnung
                const numericVal = parseGermanNumber(cleanVal);
                setFormData({...formData, plannedBonus: numericVal});
            };
            
            // Formatierter Bonus f√ºr die Anzeige
            const displayBonus = formData.plannedBonus ? formatGermanNumber(formData.plannedBonus) : '';
            
            const updateItem = (list, setList, id, field, val) => {
                setList(list.map(i => {
                    if (i.id !== id) return i;
                    // Parse numeric fields to ensure calculations work correctly
                    if (field === 'weight') {
                        return { ...i, [field]: parseFloat(val) || 0 };
                    }
                    return { ...i, [field]: val };
                }));
            };
            const addItem = (list, setList, template) => setList([...list, { ...template, id: Date.now() }]);
            const removeItem = (list, setList, id) => setList(list.filter(i => i.id !== id));

            const handleDownloadPDF = async () => {
                if (!window.html2pdf) {
                    alert("PDF-Bibliothek nicht geladen. Bitte Seite neu laden.");
                    return;
                }
                
                // Validierung: Warnung bei sehr langen Texten
                const allGoalTexts = goals.map(g => (g.name || '').length).reduce((a, b) => a + b, 0);
                const allDevTexts = devPlan.map(d => (d.measure || '').length).reduce((a, b) => a + b, 0);
                const totalTextLength = allGoalTexts + allDevTexts;
                
                if (totalTextLength > 5000) {
                    const proceed = confirm(lang === 'de' 
                        ? `‚ö†Ô∏è Das Dokument enth√§lt sehr viel Text (${Math.round(totalTextLength/1000)}k Zeichen).\n\nBei extrem langen Texten k√∂nnen Seitenumbr√ºche im PDF problematisch sein.\n\nTipp: Formulieren Sie pr√§gnant und verwenden Sie Stichpunkte.\n\nTrotzdem fortfahren?`
                        : lang === 'it'
                        ? `‚ö†Ô∏è Il documento contiene molto testo (${Math.round(totalTextLength/1000)}k caratteri).\n\nCon testi molto lunghi, le interruzioni di pagina nel PDF possono essere problematiche.\n\nSuggerimento: Formulare in modo conciso e usare punti elenco.\n\nContinuare comunque?`
                        : `‚ö†Ô∏è Document contains a lot of text (${Math.round(totalTextLength/1000)}k characters).\n\nWith very long texts, page breaks in the PDF may be problematic.\n\nTip: Formulate concisely and use bullet points.\n\nProceed anyway?`
                    );
                    if (!proceed) return;
                }
                
                setIsGenerating(true);
                let pdfContainer = null;
                let printRoot = null;
                
                try {
                    // Daten f√ºr PrintLayout vorbereiten
                    const pdfData = {
                        employee: formData.employee || '‚Äì',
                        manager: formData.manager || '‚Äì',
                        position: formData.position || '‚Äì',
                        period: formData.date ? (() => {
                            const parts = formData.date.split('-');
                            return parts.length === 3 ? `${parts[2]}.${parts[1]}.${parts[0]}` : formData.date;
                        })() : new Date().getFullYear().toString(),
                        goals: goals,
                        devPlan: devPlan,
                        plannedBonus: formData.plannedBonus
                    };
                    
                    // Container f√ºr PrintLayout erstellen
                    pdfContainer = document.createElement('div');
                    pdfContainer.id = 'pdf-render-container';
                    pdfContainer.className = 'pdf-export-mode pdf-mode';
                    pdfContainer.setAttribute('data-pdf-export', 'true');
                    pdfContainer.style.cssText = `
                        width: 210mm;
                        background: white;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        color: #1e293b;
                        font-size: 10pt;
                        line-height: 1.5;
                        position: absolute;
                        left: -9999px;
                        top: 0;
                    `;
                    document.body.appendChild(pdfContainer);
                    
                    // PrintLayout rendern
                    printRoot = ReactDOM.createRoot(pdfContainer);
                    printRoot.render(React.createElement(PrintLayout, {
                        type: 'goals',
                        data: pdfData,
                        lang: lang
                    }));
                    
                    // Promise-basiertes Warten auf DOM-Rendering
                    await new Promise(resolve => {
                        requestAnimationFrame(() => {
                            requestAnimationFrame(resolve);
                        });
                    });
                    // Zus√§tzliche Wartezeit f√ºr React-Rendering
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    // === KRITISCH: Sanitize PDF-Container - entferne alle no-print Elemente ===
                    sanitizePdfContainer(pdfContainer);
                    
                    const opt = {
                        margin: [10, 10, 10, 10],
                        filename: `Zielvereinbarung_${(formData.employee || 'Export').replace(/[^a-z0-9√§√∂√º√ü]/gi, '_')}.pdf`,
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { 
                            scale: 2,
                            useCORS: true,
                            logging: false,
                            backgroundColor: '#ffffff',
                            windowWidth: 794, // A4 Breite in px bei 96dpi
                            scrollY: 0,
                            scrollX: 0
                        },
                        jsPDF: { 
                            unit: 'mm', 
                            format: 'a4', 
                            orientation: 'portrait',
                            compress: true,
                            hotfixes: ['px_scaling'] // Fix f√ºr Skalierungsprobleme
                        },
                        pagebreak: { 
                            mode: ['css', 'legacy'], // 'avoid-all' entfernt - kann zu Abschneidungen f√ºhren
                            before: '.pdf-page-break-before',
                            after: '.pdf-page-break-after',
                            avoid: '.pdf-keep-together'
                        }
                    };
                    
                    await window.html2pdf()
                        .set(opt)
                        .from(pdfContainer)
                        .save();
                        
                } catch (error) {
                    console.error('PDF Generation Error:', error);
                    alert(lang === 'de' 
                      ? "Fehler beim PDF-Export: " + error.message + "\n\nTipp: Versuchen Sie, sehr lange Texte zu k√ºrzen."
                      : "Errore export PDF: " + error.message);
                } finally {
                    // Cleanup immer ausf√ºhren
                    if (printRoot) {
                        try { printRoot.unmount(); } catch (e) {}
                    }
                    if (pdfContainer && document.body.contains(pdfContainer)) {
                        document.body.removeChild(pdfContainer);
                    }
                    setIsGenerating(false);
                }
            };

            const renderGoalRow = (item) => {
                const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
                const goalBonus = plannedBonusNum > 0 ? (plannedBonusNum * (parseFloat(item.weight) || 0) / 100) : 0;
                
                return e('tr', { key: item.id, className: "break-inside-avoid" },
                    e('td', { className: "p-2 border align-top" }, 
                        e('textarea', { 
                            className: "w-full bg-transparent outline-none font-medium resize-none", 
                            value: item.name, 
                            maxLength: 500,
                            rows: 2,
                            placeholder: lang === 'de' ? 'Zielbezeichnung (max. 500 Zeichen)...' : lang === 'it' ? 'Nome obiettivo (max. 500 caratteri)...' : 'Goal name (max. 500 characters)...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'name', ev.target.value) 
                        }),
                        e('div', { className: 'text-xs text-slate-400 text-right mt-1' }, 
                            `${(item.name || '').length}/500`
                        )
                    ),
                    e('td', { className: "p-2 border text-center w-20 align-top" }, 
                        e('div', { className: "flex items-center justify-center" },
                            e('input', { 
                                type: "number", 
                                className: "w-full bg-transparent outline-none text-right pr-1", 
                                value: item.weight, 
                                onChange: (ev) => updateItem(goals, setGoals, item.id, 'weight', ev.target.value) 
                            }), 
                            e('span', null, "%")
                        )
                    ),
                    // Bonus-Spalte (nur wenn Bonus eingegeben)
                    plannedBonusNum > 0 && e('td', { className: "p-2 border text-center w-24 align-top bg-emerald-50" }, 
                        e('span', { className: "font-semibold text-emerald-700" }, 
                            goalBonus > 0 ? `${formatGermanNumber(goalBonus.toFixed(0))} ‚Ç¨` : '‚Äì'
                        )
                    ),
                    e('td', { className: "p-2 border align-top" }, 
                        e('input', { 
                            className: "w-full bg-transparent outline-none", 
                            value: item.target, 
                            placeholder: lang === 'de' ? 'z.B. 500.000‚Ç¨, 95% Qualit√§t...' : lang === 'it' ? 'es. 500.000‚Ç¨, 95% qualit√†...' : 'e.g. 500,000‚Ç¨, 95% quality...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'target', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border text-center no-print w-8 align-top" }, 
                        e('button', { 
                            onClick: () => removeItem(goals, setGoals, item.id), 
                            className: "text-slate-300 hover:text-red-500" 
                        }, e(Trash2, { size: 14 }))
                    )
                );
            };
            
            // === MOBILE KARTEN-ANSICHT F√úR ZIELE ===
            const renderGoalCard = (item, index) => {
                const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
                const goalBonus = plannedBonusNum > 0 ? (plannedBonusNum * (parseFloat(item.weight) || 0) / 100) : 0;
                
                return e('div', { 
                    key: item.id, 
                    className: 'bg-white border border-slate-200 rounded-xl p-4 shadow-sm'
                },
                    // Header mit Nummer und L√∂schen
                    e('div', { className: 'flex justify-between items-center mb-3' },
                        e('span', { className: 'bg-[#243186] text-white text-xs font-bold px-2 py-1 rounded' },
                            `${lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'} ${index + 1}`
                        ),
                        e('button', { 
                            onClick: () => removeItem(goals, setGoals, item.id), 
                            className: 'text-slate-400 hover:text-red-500 p-1'
                        }, e(Trash2, { size: 16 }))
                    ),
                    
                    // Zielbezeichnung
                    e('div', { className: 'mb-3' },
                        e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, 
                            t.goalName
                        ),
                        e('textarea', { 
                            className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm resize-none focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                            value: item.name, 
                            maxLength: 500,
                            rows: 2,
                            placeholder: lang === 'de' ? 'Zielbezeichnung eingeben...' : lang === 'it' ? 'Inserisci nome obiettivo...' : 'Enter goal name...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'name', ev.target.value) 
                        }),
                        e('div', { className: 'text-xs text-slate-400 text-right' }, 
                            `${(item.name || '').length}/500`
                        )
                    ),
                    
                    // Gewichtung & Bonus in einer Zeile
                    e('div', { className: 'grid grid-cols-2 gap-3 mb-3' },
                        // Gewichtung
                        e('div', null,
                            e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, 
                                t.weight
                            ),
                            e('div', { className: 'flex items-center border border-slate-200 rounded-lg overflow-hidden' },
                                e('input', { 
                                    type: 'number', 
                                    className: 'flex-1 p-2 text-center text-lg font-bold outline-none', 
                                    value: item.weight, 
                                    onChange: (ev) => updateItem(goals, setGoals, item.id, 'weight', ev.target.value) 
                                }),
                                e('span', { className: 'bg-slate-100 px-3 py-2 text-slate-600 font-medium' }, '%')
                            )
                        ),
                        // Bonus (falls vorhanden)
                        plannedBonusNum > 0 && e('div', null,
                            e('label', { className: 'text-xs font-medium text-emerald-600 block mb-1' }, 
                                'Bonus'
                            ),
                            e('div', { className: 'bg-emerald-50 border border-emerald-200 rounded-lg p-2 text-center' },
                                e('span', { className: 'text-lg font-bold text-emerald-700' }, 
                                    goalBonus > 0 ? `${formatGermanNumber(goalBonus.toFixed(0))} ‚Ç¨` : '‚Äì'
                                )
                            )
                        )
                    ),
                    
                    // Zielwert
                    e('div', null,
                        e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, 
                            lang === 'de' ? 'Zielwert / Beschreibung' : lang === 'it' ? 'Valore target' : 'Target Value'
                        ),
                        e('input', { 
                            type: 'text',
                            className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                            value: item.target, 
                            placeholder: lang === 'de' ? 'z.B. 500.000‚Ç¨, 95% Qualit√§t...' : lang === 'it' ? 'es. 500.000‚Ç¨, 95% qualit√†...' : 'e.g. 500,000‚Ç¨, 95% quality...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'target', ev.target.value) 
                        })
                    )
                );
            };

            const renderDevRow = (item) => (
                e('tr', { key: item.id, className: "break-inside-avoid" },
                    e('td', { className: "p-2 border" }, 
                        e('input', { 
                            className: "w-full bg-transparent outline-none", 
                            value: item.measure, 
                            placeholder: "...", 
                            onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'measure', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border" }, 
                        e('input', { 
                            className: "w-full bg-transparent outline-none", 
                            value: item.responsible, 
                            placeholder: "...", 
                            onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'responsible', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border" }, 
                        e('input', { 
                            type: "date", 
                            className: "w-full bg-transparent outline-none", 
                            value: item.deadline, 
                            onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'deadline', ev.target.value) 
                        })
                    ),
                    e('td', { className: "p-2 border text-center no-print w-8" }, 
                        e('button', { 
                            onClick: () => removeItem(devPlan, setDevPlan, item.id), 
                            className: "text-slate-300 hover:text-red-500" 
                        }, e(Trash2, { size: 14 }))
                    )
                )
            );
            
            // === MOBILE KARTE F√úR ENTWICKLUNGSMASSNAHMEN ===
            const renderDevCardZiel = (item, index) => {
                return e('div', { 
                    key: item.id, 
                    className: 'bg-white border border-slate-200 rounded-xl p-4 shadow-sm'
                },
                    e('div', { className: 'flex justify-between items-center mb-3' },
                        e('span', { className: 'bg-emerald-100 text-emerald-700 text-xs font-bold px-2 py-1 rounded' },
                            `${lang === 'de' ? 'Ma√ünahme' : lang === 'it' ? 'Misura' : 'Measure'} ${index + 1}`
                        ),
                        e('button', { 
                            onClick: () => removeItem(devPlan, setDevPlan, item.id), 
                            className: 'text-slate-400 hover:text-red-500 p-1'
                        }, e(Trash2, { size: 16 }))
                    ),
                    e('div', { className: 'space-y-3' },
                        e('div', null,
                            e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.measure),
                            e('input', { 
                                type: 'text',
                                className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                                value: item.measure, 
                                placeholder: '...', 
                                onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'measure', ev.target.value) 
                            })
                        ),
                        e('div', { className: 'grid grid-cols-2 gap-3' },
                            e('div', null,
                                e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.responsible),
                                e('input', { 
                                    type: 'text',
                                    className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                                    value: item.responsible, 
                                    placeholder: '...', 
                                    onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'responsible', ev.target.value) 
                                })
                            ),
                            e('div', null,
                                e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.deadline),
                                e('input', { 
                                    type: 'date',
                                    className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                                    value: item.deadline, 
                                    onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'deadline', ev.target.value) 
                                })
                            )
                        )
                    )
                );
            };

            return e('div', { ref: formRef, className: "max-w-5xl mx-auto space-y-8 pb-20" },
                
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100" },
                    e('div', { className: "flex justify-between items-start mb-6" },
                        e('div', null, 
                            e('h1', { className: "text-3xl font-bold", style: { color: "#243186" } }, "nƒ±ederwƒ±eser"), 
                            e('span', { className: "text-sm tracking-wider font-medium", style: { color: "#6EBD84" } }, "FLEXIBLE FOOD PACKAGING")
                        ),
                        e('button', { 
                            onClick: handleDownloadPDF, 
                            disabled: isGenerating, 
                            className: "no-print flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-2xl hover:bg-blue-700 transition-colors disabled:opacity-50" 
                        }, 
                            isGenerating ? e(Loader2, { className: "animate-spin", size: 18 }) : e(Download, { size: 18 }), 
                            isGenerating ? t.generating : t.print
                        )
                    ),
                    e('div', { className: "border-b-2 border-slate-100 mb-4" }),
                    
                    // === DEBUG: Check Team Buttons ===
                    (() => {
                      console.log('üé® Rendering form - teamButtonsVisible:', teamButtonsVisible, 'teamContext:', teamContext);
                      return null;
                    })(),
                    
                    // === TEAM BUTTONS (wenn teamContext) ===
                    teamButtonsVisible && teamContext && e('div', {
                      className: 'mb-6 p-5 bg-gradient-to-r from-[#243186] to-[#1a2564] rounded-xl shadow-2xl border-2 border-[#6EBD84]'
                    },
                      e('div', { className: 'flex flex-col gap-4' },
                        e('div', { className: 'flex justify-between items-start' },
                          e('div', { className: 'text-white' },
                            e('h2', { className: 'text-3xl font-bold mb-1', style: { color: '#6EBD84' } }, 
                              teamContext.employee.name
                            ),
                            e('p', { className: 'text-blue-200 text-base font-semibold' }, 
                              teamContext.employee.position + (teamContext.employee.department ? ' ‚Ä¢ ' + teamContext.employee.department : '')
                            ),
                            e('p', { className: 'text-blue-100 text-sm mt-2 font-medium' }, 
                              (lang === 'de' ? 'Bewertungszeitraum: ' : lang === 'it' ? 'Periodo: ' : 'Assessment period: ') + teamContext.period
                            )
                          ),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'text-white/80 hover:text-white transition-colors text-4xl leading-none font-bold'
                          }, '√ó')
                        ),
                        e('div', { className: 'grid grid-cols-3 gap-4 mt-2' },
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('draft'),
                            type: 'button',
                            className: 'bg-slate-200 hover:bg-slate-300 text-slate-900 py-4 px-5 rounded-xl font-bold text-base transition-all transform hover:scale-105 shadow-lg'
                          }, 'üíæ ' + (lang === 'de' ? 'Als Entwurf' : lang === 'it' ? 'Bozza' : 'Save Draft')),
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('completed'),
                            type: 'button',
                            className: 'bg-[#6EBD84] hover:bg-[#5da872] text-white py-4 px-5 rounded-xl font-bold text-base transition-all transform hover:scale-105 shadow-lg'
                          }, '‚úì ' + (lang === 'de' ? 'Abschlie√üen' : lang === 'it' ? 'Completa' : 'Complete')),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'border-2 border-white/40 text-white py-4 px-5 rounded-xl font-bold hover:bg-white/20 transition-all shadow-lg text-base'
                          }, lang === 'de' ? 'Abbrechen' : lang === 'it' ? 'Annulla' : 'Cancel')
                        )
                      )
                    ),
                    
                    e('h2', { className: "text-2xl font-bold", style: { color: "#243186" } }, lang === 'de' ? 'Zielvereinbarung' : lang === 'it' ? 'Accordo sugli obiettivi' : 'Goal Agreement'),
                    e('p', { className: "font-medium", style: { color: "#6EBD84" } }, t.headerSubtitle)
                ),

                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partA),
                    e('div', { className: "grid grid-cols-2 gap-6" },
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.employee), e('input', { type: "text", value: formData.employee, onChange: (ev) => handleFormChange('employee', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.manager), e('input', { type: "text", value: formData.manager, onChange: (ev) => handleFormChange('manager', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.position), e('input', { type: "text", value: formData.position, onChange: (ev) => handleFormChange('position', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.date), e('input', { type: "date", value: formData.date, onChange: (ev) => handleFormChange('date', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" }))
                    )
                ),

                e('div', { className: "bg-white p-4 md:p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, lang === 'de' ? 'Zieldefinition' : lang === 'it' ? 'Definizione degli obiettivi' : 'Goal Definition'),
                    
                    // === DESKTOP: Tabellen-Ansicht (hidden on mobile) ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm" },
                            e('thead', { className: "bg-slate-50 text-left" }, 
                                e('tr', null, 
                                    e('th', { className: "p-2 border w-1/3" }, t.goalName), 
                                    e('th', { className: "p-2 border w-20" }, t.weight), 
                                    // Bonus-Spalte Header (nur wenn Bonus eingegeben)
                                    parseFloat(formData.plannedBonus) > 0 && e('th', { className: "p-2 border w-24 bg-emerald-50 text-emerald-700" }, lang === 'de' ? 'Bonus ‚Ç¨' : lang === 'it' ? 'Bonus ‚Ç¨' : 'Bonus ‚Ç¨'),
                                    e('th', { className: "p-2 border" }, lang === 'de' ? 'Zielwert / Beschreibung' : lang === 'it' ? 'Valore target / Descrizione' : 'Target Value / Description'), 
                                    e('th', { className: "p-2 border no-print w-8" }, "")
                                )
                            ),
                            e('tbody', null, goals.map(item => renderGoalRow(item)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht (hidden on desktop) ===
                    e('div', { className: 'md:hidden space-y-4' },
                        goals.map((item, index) => renderGoalCard(item, index)),
                        // Gewichtungs-Summe f√ºr Mobile
                        e('div', { 
                            className: `mt-3 p-3 rounded-lg flex items-center justify-between ${
                                goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0) === 100 
                                    ? 'bg-green-50 border border-green-200' 
                                    : 'bg-amber-50 border border-amber-200'
                            }`
                        },
                            e('span', { className: 'font-semibold text-sm' }, 
                                lang === 'de' ? 'Gewichtungssumme:' : lang === 'it' ? 'Somma ponderazioni:' : 'Weight Sum:'
                            ),
                            e('span', { className: 'text-xl font-bold' }, 
                                `${goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0)}%`
                            )
                        )
                    ),
                    
                    e('button', { 
                        onClick: () => addItem(goals, setGoals, {name:'', weight:0, target:''}), 
                        className: "no-print mt-3 text-xs flex items-center gap-1 text-blue-600" 
                    }, e(PlusCircle, {size:14}), t.addGoal),
                    
                    // Geplanter Bonus (100%) Feld
                    e('div', { className: "mt-6 pt-4 border-t border-slate-200" },
                        e('div', { className: "flex items-center gap-4" },
                            e('label', { className: "text-sm font-semibold text-slate-700 whitespace-nowrap" }, 
                                lang === 'de' ? 'Geplanter Bonus (100%):' : lang === 'it' ? 'Bonus previsto (100%):' : 'Planned Bonus (100%):'
                            ),
                            e('div', { className: "relative w-48" },
                                e('input', { 
                                    type: "text", 
                                    value: displayBonus,
                                    onChange: (ev) => handleBonusChange(ev.target.value),
                                    placeholder: lang === 'de' ? 'z.B. 5.000' : lang === 'it' ? 'es. 5.000' : 'e.g. 5,000',
                                    className: "w-full border border-slate-300 rounded-lg px-3 py-2 pr-8 outline-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] text-right font-medium"
                                }),
                                e('span', { className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium" }, '‚Ç¨')
                            ),
                            e('span', { className: "text-xs text-slate-400" }, 
                                lang === 'de' ? '(Tausenderpunkte erlaubt: 1.000 = 1000)' : lang === 'it' ? '(Punti per migliaia: 1.000 = 1000)' : '(Thousands separators allowed: 1,000 = 1000)'
                            )
                        )
                    )
                ),

                e('div', { className: "bg-white p-4 md:p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.development),
                    e('p', { className: "text-xs text-slate-500 mb-2" }, t.devIntro),
                    
                    // === DESKTOP: Tabellen-Ansicht ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm mb-2" },
                            e('thead', { className: "bg-slate-50 text-left" }, 
                                e('tr', null, 
                                    e('th', { className: "p-2 border" }, t.measure), 
                                    e('th', { className: "p-2 border" }, t.responsible), 
                                    e('th', { className: "p-2 border" }, t.deadline), 
                                    e('th', { className: "p-2 border no-print" }, "")
                                )
                            ),
                            e('tbody', null, devPlan.map(item => renderDevRow(item)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht ===
                    e('div', { className: 'md:hidden space-y-4' },
                        devPlan.map((item, index) => renderDevCardZiel(item, index))
                    ),
                    
                    e('button', { 
                        onClick: () => addItem(devPlan, setDevPlan, {measure:'', responsible:'', deadline:''}), 
                        className: "no-print mt-2 text-xs flex items-center gap-1 text-blue-600" 
                    }, e(PlusCircle, {size:14}), t.addDev)
                ),

                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-8 border-b pb-2" }, t.partH),
                    e('div', { className: "grid grid-cols-2 gap-12" },
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.employee)),
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.manager))
                    )
                )
            );
        };

        // === APPRAISAL FORM COMPONENT ===
        const AppraisalForm = ({ lang, onSaveTeam, onCancel, db, setActiveView }) => {
            console.log('üîÑ AppraisalForm wird gerendert...');
            console.log('   Props:', { lang, onSaveTeam: !!onSaveTeam, onCancel: !!onCancel, db: !!db });
            
            const t = FORM_TEXT[lang] || FORM_TEXT['de'];
            const defs = DEFAULTS[lang] || DEFAULTS['de'];
            const formRef = useRef(null);
            
            console.log('   t loaded:', !!t);
            console.log('   defs loaded:', !!defs, defs ? { coreCount: defs.core?.length, leadCount: defs.lead?.length } : null);
            
            const [isManager, setIsManager] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);
            const [formType, setFormType] = useState('manager'); // 'self' or 'manager'
            
            // === LINKED SELF ASSESSMENT (Selbstreflexion des Mitarbeiters) ===
            const [linkedSelfAssessment, setLinkedSelfAssessment] = useState(null);
            const [showSelfAssessmentHint, setShowSelfAssessmentHint] = useState(true);
            const [isRefreshingSelf, setIsRefreshingSelf] = useState(false);
            
            // Funktion zum Laden/Refresh der Selbstreflexion
            const refreshLinkedSelfAssessment = async (employeeId, employeeEmail) => {
              if (!db || (!employeeId && !employeeEmail)) return;
              setIsRefreshingSelf(true);
              try {
                // Suche nach Selbstreflexion (type: 'self' oder 'self_assessment')
                // Strategie: Erst nach employeeId, dann nach employeeEmail suchen
                let allSelf = [];
                let pdfSelf = null;
                
                // 1. Suche nach employeeId (klassische Verkn√ºpfung)
                if (employeeId) {
                  const byIdSnapshot = await db.collection('teamAppraisals')
                    .where('employeeId', '==', employeeId)
                    .get();
                  const allDocs = byIdSnapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                  
                  // Digitale Selbstreflexionen (OHNE isPdfUpload)
                  allSelf = allDocs.filter(a => 
                    (a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection') &&
                    !a.isPdfUpload
                  );
                  
                  // PDF-Selbstreflexion (separat)
                  pdfSelf = allDocs.find(a => a.type === 'self_pdf' || a.isPdfUpload === true);
                }
                
                // 2. Falls nichts gefunden und Email vorhanden: Suche nach employeeEmail
                if (allSelf.length === 0 && employeeEmail) {
                  const byEmailSnapshot = await db.collection('teamAppraisals')
                    .where('employeeEmail', '==', employeeEmail)
                    .get();
                  const allDocs = byEmailSnapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                  
                  allSelf = allDocs.filter(a => 
                    (a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection') &&
                    !a.isPdfUpload
                  );
                  
                  if (!pdfSelf) {
                    pdfSelf = allDocs.find(a => a.type === 'self_pdf' || a.isPdfUpload === true);
                  }
                }
                
                if (allSelf.length > 0) {
                  // Sortiere nach Datum (neueste zuerst)
                  allSelf.sort((a, b) => {
                    const dateA = a.updatedAt || a.createdAt || '0';
                    const dateB = b.updatedAt || b.createdAt || '0';
                    return dateB.localeCompare(dateA);
                  });
                  const selfAssessment = allSelf[0];
                  // F√ºge PDF-Info hinzu falls vorhanden
                  if (pdfSelf) {
                    selfAssessment._hasPdf = true;
                    selfAssessment._pdfFileName = pdfSelf.pdfFileName;
                    selfAssessment._pdfUrl = pdfSelf.pdfUrl || pdfSelf.pdfData; // Support both URL and Base64
                  }
                  console.log('üîÑ Selbstreflexion refreshed:', selfAssessment, pdfSelf ? '(+ PDF)' : '');
                  setLinkedSelfAssessment(selfAssessment);
                } else if (pdfSelf) {
                  // Nur PDF vorhanden - zeige Hinweis
                  console.log('üìÑ Nur PDF-Selbstreflexion gefunden:', pdfSelf.pdfFileName);
                  setLinkedSelfAssessment({
                    _isPdfOnly: true,
                    pdfFileName: pdfSelf.pdfFileName,
                    pdfUrl: pdfSelf.pdfUrl || pdfSelf.pdfData, // Support both URL and Base64
                    employeeName: pdfSelf.employeeName,
                    createdAt: pdfSelf.createdAt
                  });
                } else {
                  console.log('‚ÑπÔ∏è Keine Selbstreflexion gefunden f√ºr', employeeId, employeeEmail);
                  setLinkedSelfAssessment(null);
                }
              } catch (err) {
                console.error('‚ùå Fehler beim Laden der Selbstreflexion:', err);
              }
              setIsRefreshingSelf(false);
            };
            
            // === TEAM CONTEXT ===
            const [teamContext, setTeamContext] = useState(null);
            const [teamButtonsVisible, setTeamButtonsVisible] = useState(false);
            
            const [formData, setFormData] = useState({
                employee: '', position: '', manager: '', date: new Date().toISOString().split('T')[0],
                strengths1: '', strengths2: '', careerComment: '', 
                feedbackQ1: '', feedbackQ2: '', feedbackQ3: '', feedbackQ4: '', feedbackQ5: '', feedbackQ6: '', feedbackQ7: 0,
                plannedBonus: ''  // Geplanter Bonus (100%)
            });
            
            const [careerChecks, setCareerChecks] = useState([false, false, false, false, false]);
            const [goals, setGoals] = useState([
                { id: 101, name: '', weight: 60, achievement: 0 },
                { id: 102, name: '', weight: 40, achievement: 0 }
            ]);
            const [devPlan, setDevPlan] = useState([
                { id: 201, measure: '', responsible: '', deadline: '' }
            ]);
            const [coreList, setCoreList] = useState(defs.core);
            const [leadList, setLeadList] = useState(defs.lead);
            
            console.log('   States initialized. coreList:', coreList?.length, 'leadList:', leadList?.length);
            
            // Hilfsfunktion: Tausenderpunkte aus Eingabe entfernen (1.000 ‚Üí 1000)
            const parseGermanNumber = (str) => {
                if (!str) return '';
                return str.replace(/\./g, '').replace(',', '.');
            };
            
            // Hilfsfunktion: Zahl mit Tausenderpunkten formatieren (1000 ‚Üí 1.000)
            const formatGermanNumber = (num) => {
                if (!num && num !== 0) return '';
                const numStr = String(num).replace(/[^\d]/g, '');
                if (!numStr) return '';
                return Number(numStr).toLocaleString('de-DE');
            };
            
            // Handler f√ºr Bonus-Feld mit Tausenderpunkt-Unterst√ºtzung
            const handleBonusChange = (val) => {
                const cleanVal = val.replace(/[^\d.]/g, '');
                const numericVal = parseGermanNumber(cleanVal);
                setFormData({...formData, plannedBonus: numericVal});
            };
            
            // Formatierter Bonus f√ºr die Anzeige
            const displayBonus = formData.plannedBonus ? formatGermanNumber(formData.plannedBonus) : '';

            // === TEAM CONTEXT EFFECT ===
            useEffect(() => {
              const ctx = localStorage.getItem('nw_current_employee');
              console.log('üîç AppraisalForm useEffect triggered');
              console.log('   localStorage nw_current_employee:', ctx);
              
              if (ctx) {
                try {
                  const data = JSON.parse(ctx);
                  console.log('‚úì Parsed team context:', data);
                  setTeamContext(data);
                  setTeamButtonsVisible(true);
                  
                  // Load existing data if available
                  if (data.existingData) {
                    const existing = data.existingData;
                    
                    // Set form data
                    setFormData(prev => ({
                      ...prev,
                      employee: existing.employeeName || data.employee.name,
                      position: existing.position || data.employee.position,
                      manager: existing.formData?.manager || prev.manager,
                      date: existing.updatedAt ? existing.updatedAt.split('T')[0] : prev.date,
                      strengths1: existing.formData?.strengths1 || '',
                      strengths2: existing.formData?.strengths2 || '',
                      careerComment: existing.formData?.careerComment || '',
                      feedbackQ1: existing.formData?.feedbackQ1 || '',
                      feedbackQ2: existing.formData?.feedbackQ2 || '',
                      feedbackQ3: existing.formData?.feedbackQ3 || '',
                      feedbackQ4: existing.formData?.feedbackQ4 || '',
                      feedbackQ5: existing.formData?.feedbackQ5 || '',
                      feedbackQ6: existing.formData?.feedbackQ6 || '',
                      feedbackQ7: existing.formData?.feedbackQ7 || 0,
                      plannedBonus: existing.formData?.plannedBonus || ''
                    }));
                    
                    // Set goals if exists
                    if (existing.goals && existing.goals.length > 0) {
                      setGoals(existing.goals);
                    }
                    
                    // Set core scores if exists
                    if (existing.coreScores && Object.keys(existing.coreScores).length > 0) {
                      setCoreList(prev => prev.map(c => ({
                        ...c,
                        rating: existing.coreScores[c.id] || c.rating,
                        comment: existing.coreComments?.[c.id] || c.comment || ''
                      })));
                    }
                    
                    // Set leader scores if exists
                    if (existing.leaderScores && Object.keys(existing.leaderScores).length > 0) {
                      setLeadList(prev => prev.map(c => ({
                        ...c,
                        rating: existing.leaderScores[c.id] || c.rating,
                        comment: existing.leaderComments?.[c.id] || c.comment || ''
                      })));
                    }
                    
                    // Set isManager if leadership was included
                    if (existing.includeLeadership) {
                      setIsManager(true);
                    }
                    
                    // Set career checks if exists
                    if (existing.careerChecks) {
                      setCareerChecks(existing.careerChecks);
                    }
                    
                    // Set dev plan if exists
                    if (existing.devPlan && existing.devPlan.length > 0) {
                      setDevPlan(existing.devPlan);
                    }
                    
                  } else {
                    // New appraisal - set employee data
                    setFormData(prev => ({
                      ...prev,
                      employee: data.employee.name,
                      position: data.employee.position
                    }));
                  }
                  
                  // === SUCHE NACH VERKN√úPFTER SELBSTREFLEXION ===
                  // Nutze die neue refreshLinkedSelfAssessment Funktion
                  if (data.employee?.id || data.employee?.email) {
                    refreshLinkedSelfAssessment(data.employee.id, data.employee.email);
                  }
                  
                } catch (e) {
                  console.error('Error loading team context:', e);
                }
              }
            }, []);
            
            // === TEAM SAVE HANDLER ===
            const handleSaveTeamAppraisal = (status) => {
              if (!teamContext || !onSaveTeam) {
                alert('Team-Kontext fehlt!');
                return;
              }
              
              // === BERECHNE SCORES DIREKT BEIM SPEICHERN (f√ºr Konsistenz) ===
              // WAS Score berechnen
              const calculateWASForSave = () => {
                let sum = 0, weight = 0;
                goals.forEach(g => {
                  const w = parseFloat(g.weight) || 0;
                  if(w > 0) { sum += getBarsScore(g.achievement) * (w/100); weight += w; }
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
              };
              
              // WIE Score berechnen
              const calculateWIEForSave = (list) => {
                let sum = 0, weight = 0;
                list.forEach(i => {
                  const w = parseFloat(i.weight) || 0;
                  sum += i.rating * (w/100);
                  weight += w;
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
              };
              
              const currentWasScore = calculateWASForSave();
              const currentWieCoreScore = calculateWIEForSave(coreList);
              const currentWieLeadScore = calculateWIEForSave(leadList);
              const currentTotalGoalWeight = goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
              
              // GPS berechnen
              let currentFinalGPS;
              if (goals.length === 0 || currentTotalGoalWeight === 0) {
                currentFinalGPS = isManager 
                  ? (currentWieCoreScore * 0.5) + (currentWieLeadScore * 0.5)
                  : currentWieCoreScore;
              } else {
                currentFinalGPS = isManager 
                  ? (currentWasScore * 0.5) + (currentWieCoreScore * 0.25) + (currentWieLeadScore * 0.25)
                  : (currentWasScore * 0.5) + (currentWieCoreScore * 0.5);
              }
              
              // Collect core scores
              const coreScoresObj = {};
              const coreCommentsObj = {};
              coreList.forEach(c => {
                coreScoresObj[c.id] = c.rating;
                coreCommentsObj[c.id] = c.comment || '';
              });
              
              // Collect leader scores
              const leaderScoresObj = {};
              const leaderCommentsObj = {};
              leadList.forEach(c => {
                leaderScoresObj[c.id] = c.rating;
                leaderCommentsObj[c.id] = c.comment || '';
              });
              
              const appraisal = {
                id: teamContext.appraisalId,
                type: 'review',
                employeeId: teamContext.employee.id,
                employeeName: teamContext.employee.name,
                position: teamContext.employee.position,
                period: teamContext.period,
                status: status,
                createdAt: teamContext.existingData?.createdAt || new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                goals: goals,
                coreScores: coreScoresObj,
                coreComments: coreCommentsObj,
                leaderScores: leaderScoresObj,
                leaderComments: leaderCommentsObj,
                includeLeadership: isManager,
                wasScore: currentWasScore,
                wieCoreScore: currentWieCoreScore,
                wieLeaderScore: currentWieLeadScore,
                gpsScore: currentFinalGPS,
                formData: formData,
                careerChecks: careerChecks,
                devPlan: devPlan
              };
              
              // Debug-Log
              console.log('üíæ Speichere Review:', {
                status,
                goals: goals.length,
                wasScore: currentWasScore.toFixed(2),
                wieCoreScore: currentWieCoreScore.toFixed(2),
                wieLeadScore: currentWieLeadScore.toFixed(2),
                gpsScore: currentFinalGPS.toFixed(2)
              });
              
              onSaveTeam(appraisal);
            };
            
            // === TEAM CANCEL HANDLER ===
            const handleCancelTeam = () => {
              if (confirm(lang === 'de' ? 'Abbrechen? √Ñnderungen gehen verloren.' : lang === 'it' ? 'Annullare? Le modifiche andranno perse.' : 'Cancel? Changes will be lost.')) {
                localStorage.removeItem('nw_current_employee');
                if (onCancel) onCancel();
              }
            };

            useEffect(() => {
                setCoreList(prev => prev.map((p, i) => {
                    if (defs.core[i]) {
                        return {
                            ...p,
                            name: lang === 'it' && CORE_COMPETENCIES_CALC[i].nameIt ? 
                                CORE_COMPETENCIES_CALC[i].nameIt : 
                                CORE_COMPETENCIES_CALC[i].name
                        };
                    }
                    return p;
                }));
                setLeadList(prev => prev.map((p, i) => {
                    if (defs.lead[i]) {
                        return {
                            ...p,
                            name: lang === 'it' && LEADERSHIP_COMPETENCIES_CALC[i].nameIt ? 
                                LEADERSHIP_COMPETENCIES_CALC[i].nameIt : 
                                LEADERSHIP_COMPETENCIES_CALC[i].name
                        };
                    }
                    return p;
                }));
            }, [lang]);

            const calculateWAS = () => {
                let sum = 0, weight = 0;
                goals.forEach(g => {
                    const w = parseFloat(g.weight) || 0;
                    if(w > 0) { sum += getBarsScore(g.achievement) * (w/100); weight += w; }
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
            };

            const calculateWIE = (list) => {
                let sum = 0, weight = 0;
                list.forEach(i => {
                    const w = parseFloat(i.weight) || 0;
                    sum += i.rating * (w/100);
                    weight += w;
                });
                return weight > 0 ? (sum / (weight/100)) : 0;
            };

            const wasScore = calculateWAS();
            const wieCoreScore = calculateWIE(coreList);
            const wieLeadScore = calculateWIE(leadList);
            
            // === HALO-EFFEKT ERKENNUNG ===
            // Warnung wenn alle Core-Kompetenzen exakt gleich bewertet wurden
            const coreRatings = coreList.map(c => c.rating).filter(r => r > 0);
            const allCoreRatingsSame = coreRatings.length >= 5 && coreRatings.every(r => r === coreRatings[0]);
            const haloEffectWarning = allCoreRatingsSame && coreRatings.length >= 5;
            
            // === GAP-ANALYSE (Selbst vs. Fremd) ===
            // Berechne Gaps f√ºr alle Kompetenzen
            const calculateGaps = () => {
              if (!linkedSelfAssessment) return {};
              const selfScores = linkedSelfAssessment.selfCoreScores || {};
              const gaps = {};
              
              // Core Kompetenzen
              const idMapping = { fach: 'c1', komm: 'c2', prob: 'c3', adapt: 'c4', orga: 'c5' };
              coreList.forEach(c => {
                const selfKey = idMapping[c.id] || c.id;
                const selfScore = selfScores[selfKey] || selfScores[c.id];
                if (selfScore && c.rating) {
                  const gap = c.rating - selfScore;
                  if (Math.abs(gap) > 1) {
                    gaps[c.id] = { 
                      gap, 
                      selfScore, 
                      fkScore: c.rating,
                      direction: gap > 0 ? 'fk_higher' : 'self_higher'
                    };
                  }
                }
              });
              
              // Leader Kompetenzen (falls vorhanden)
              if (linkedSelfAssessment.selfLeaderScores) {
                const selfLeaderScores = linkedSelfAssessment.selfLeaderScores;
                const leaderMapping = { lead: 'l1', strat: 'l2', decide: 'l3', exec: 'l4', stake: 'l5' };
                leadList.forEach(c => {
                  const selfKey = leaderMapping[c.id] || c.id;
                  const selfScore = selfLeaderScores[selfKey] || selfLeaderScores[c.id];
                  if (selfScore && c.rating) {
                    const gap = c.rating - selfScore;
                    if (Math.abs(gap) > 1) {
                      gaps[c.id] = { 
                        gap, 
                        selfScore, 
                        fkScore: c.rating,
                        direction: gap > 0 ? 'fk_higher' : 'self_higher'
                      };
                    }
                  }
                });
              }
              
              return gaps;
            };
            const competencyGaps = calculateGaps();
            const hasSignificantGaps = Object.keys(competencyGaps).length > 0;
            
            // Calculate total goal weight for validation
            const totalGoalWeight = goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
            
            // === BONUS-BERECHNUNG ===
            // Bonus basiert auf Gewichtung und Zielerreichung pro Ziel
            // Max. 100% Auszahlung pro Ziel (keine √úberschreitung)
            const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
            
            // Berechne Bonus pro Ziel und Gesamtauszahlung
            const bonusPerGoal = goals.map(g => {
                const weight = parseFloat(g.weight) || 0;
                const achievement = parseFloat(g.achievement) || 0;
                const goalBonus = plannedBonusNum * (weight / 100);
                // Auszahlung gedeckelt auf 100% Zielerreichung
                const achievementFactor = Math.min(achievement / 100, 1.0);
                const payout = goalBonus * achievementFactor;
                return {
                    goalName: g.name,
                    weight: weight,
                    achievement: achievement,
                    goalBonus: goalBonus,
                    achievementFactor: achievementFactor,
                    payout: payout
                };
            });
            
            const totalBonusPayout = bonusPerGoal.reduce((sum, b) => sum + b.payout, 0);
            const bonusPayoutPercentage = plannedBonusNum > 0 ? (totalBonusPayout / plannedBonusNum * 100) : 0;
            
            // GPS-Berechnung: Wenn keine Ziele vorhanden, nur WIE-Kompetenzen (100%)
            // Fix: Pr√ºfe ob Leadership-Scores tats√§chlich > 0 sind bevor sie einflie√üen
            let finalGPS;
            const hasLeadershipScores = isManager && wieLeadScore > 0;
            
            if (goals.length === 0 || totalGoalWeight === 0) {
                // Keine Ziele: GPS = 100% WIE
                if (isManager && hasLeadershipScores) {
                    finalGPS = (wieCoreScore * 0.5) + (wieLeadScore * 0.5);
                } else {
                    // Nur Core-Kompetenzen (auch f√ºr Manager ohne Leadership-Bewertung)
                    finalGPS = wieCoreScore;
                }
            } else {
                // Mit Zielen: Standard-Formel
                if (isManager && hasLeadershipScores) {
                    finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.25) + (wieLeadScore * 0.25);
                } else {
                    // Standard f√ºr MA oder Manager ohne Leadership-Bewertung
                    finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.5);
                }
            }

            const handleFormChange = (field, val) => setFormData({...formData, [field]: val});
            const updateItem = (list, setList, id, field, val) => {
                setList(list.map(i => {
                    if (i.id !== id) return i;
                    // Parse numeric fields to ensure calculations work correctly
                    if (field === 'weight' || field === 'achievement') {
                        return { ...i, [field]: parseFloat(val) || 0 };
                    }
                    if (field === 'rating') {
                        return { ...i, [field]: parseInt(val) || 3 };
                    }
                    return { ...i, [field]: val };
                }));
            };
            const addItem = (list, setList, template) => setList([...list, { ...template, id: Date.now() }]);
            const removeItem = (list, setList, id) => setList(list.filter(i => i.id !== id));
            const toggleCareer = (index) => {
                const newChecks = [...careerChecks];
                newChecks[index] = !newChecks[index];
                setCareerChecks(newChecks);
            };

            const handleDownloadPDF = () => {
                if (!window.html2pdf) {
                    alert("PDF-Bibliothek nicht geladen. Bitte Seite neu laden.");
                    return;
                }
                
                // Validierung: Warnung bei sehr langen Texten (arbeitsrechtlich relevant!)
                const feedbackTexts = [
                    formData.strengths1, formData.strengths2,
                    formData.feedbackQ1, formData.feedbackQ2, formData.feedbackQ3,
                    formData.feedbackQ4, formData.feedbackQ5, formData.feedbackQ6, formData.feedbackQ7,
                    formData.careerComment
                ].filter(Boolean);
                const totalFeedbackLength = feedbackTexts.reduce((sum, t) => sum + t.length, 0);
                const coreCommentLength = coreList.reduce((sum, c) => sum + (c.comment || '').length, 0);
                const leadCommentLength = leadList.reduce((sum, c) => sum + (c.comment || '').length, 0);
                const totalTextLength = totalFeedbackLength + coreCommentLength + leadCommentLength;
                
                if (totalTextLength > 8000) {
                    const proceed = confirm(lang === 'de' 
                        ? `‚ö†Ô∏è Arbeitsrechtlicher Hinweis\n\nDas Dokument enth√§lt sehr viel Text (${Math.round(totalTextLength/1000)}k Zeichen).\n\nBei extrem langen Texten k√∂nnen Seitenumbr√ºche problematisch sein ‚Äì Text k√∂nnte abgeschnitten werden.\n\n‚úì Pr√ºfen Sie das PDF nach dem Download auf Vollst√§ndigkeit\n‚úì Formulieren Sie ggf. pr√§gnanter\n\nTrotzdem fortfahren?`
                        : lang === 'it'
                        ? `‚ö†Ô∏è Avviso legale\n\nIl documento contiene molto testo (${Math.round(totalTextLength/1000)}k caratteri).\n\nCon testi molto lunghi, le interruzioni di pagina possono causare problemi ‚Äì il testo potrebbe essere tagliato.\n\n‚úì Verifichi il PDF dopo il download\n‚úì Formuli in modo pi√π conciso se necessario\n\nContinuare comunque?`
                        : `‚ö†Ô∏è Legal Notice\n\nDocument contains a lot of text (${Math.round(totalTextLength/1000)}k characters).\n\nWith very long texts, page breaks may cause issues ‚Äì text could be cut off.\n\n‚úì Check the PDF for completeness after download\n‚úì Consider more concise wording\n\nProceed anyway?`
                    );
                    if (!proceed) return;
                }
                
                setIsGenerating(true);
                
                setTimeout(() => {
                    try {
                        const pdfContainer = document.createElement('div');
                        pdfContainer.className = 'pdf-export-container pdf-export-mode pdf-mode';
                        pdfContainer.setAttribute('data-pdf-export', 'true');
                        pdfContainer.style.cssText = `
                            width: 177mm;
                            padding: 0;
                            background: white;
                            font-family: 'Segoe UI', Arial, sans-serif;
                            color: #1e293b;
                            font-size: 10pt;
                            line-height: 1.5;
                        `;
                        
                        const currentDate = new Date().toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
                        
                        // Formatiere das Bewertungsdatum korrekt (von YYYY-MM-DD zu DD.MM.YYYY)
                        const formatDateForPDF = (dateStr) => {
                            if (!dateStr) return '‚Äì';
                            const parts = dateStr.split('-');
                            if (parts.length === 3) {
                                return `${parts[2]}.${parts[1]}.${parts[0]}`;
                            }
                            return dateStr;
                        };
                        const formattedPeriod = formatDateForPDF(formData.date);
                        
                        // Profil-Text k√ºrzen f√ºr PDF
                        const profileShort = isManager 
                            ? (lang === 'de' ? 'FK (50/25/25)' : lang === 'it' ? 'Dir. (50/25/25)' : 'Mgr (50/25/25)')
                            : (lang === 'de' ? 'MA (50/50)' : lang === 'it' ? 'Coll. (50/50)' : 'Emp (50/50)');
                        
                        // Professional PDF Layout
                        let pdfHTML = `
                            <!-- HEADER -->
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #243186;">
                                <div style="flex: 1;">
                                    <h1 style="color: #243186; font-size: 26pt; margin: 0; font-weight: 700; letter-spacing: -0.5px;">nƒ±ederwƒ±eser</h1>
                                    <p style="color: #6EBD84; font-size: 8pt; margin: 2px 0 0 0; font-weight: 600; letter-spacing: 1.5px;">FLEXIBLE FOOD PACKAGING</p>
                                </div>
                                <div style="text-align: right; flex-shrink: 0; padding-left: 10px;">
                                    <p style="font-size: 8pt; color: #64748b; margin: 0;">Dok.: ${currentDate}</p>
                                    <p style="font-size: 8pt; color: #64748b; margin: 2px 0 0 0;">${lang === 'de' ? 'Periode' : lang === 'it' ? 'Periodo' : 'Period'}: ${formattedPeriod}</p>
                                </div>
                            </div>
                            
                            <!-- DOCUMENT TITLE -->
                            <div style="background: linear-gradient(135deg, #243186 0%, #1a2564 100%); color: white; padding: 15px 20px; margin-bottom: 20px; border-radius: 4px;">
                                <h2 style="margin: 0; font-size: 16pt; font-weight: 600;">${t.headerTitle}</h2>
                                <p style="margin: 5px 0 0 0; font-size: 11pt; opacity: 0.9;">${t.headerSubtitle}</p>
                            </div>
                            
                            <!-- TEIL A: STAMMDATEN -->
                            <div style="margin-bottom: 20px; page-break-inside: avoid;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partA}</h3>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                                    <tr>
                                        <td style="padding: 8px 10px; width: 22%; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.employee}</span>
                                        </td>
                                        <td style="padding: 8px 10px; width: 28%; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.employee || '‚Äì'}</td>
                                        <td style="padding: 8px 10px; width: 22%; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.manager}</span>
                                        </td>
                                        <td style="padding: 8px 10px; width: 28%; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.manager || '‚Äì'}</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px 10px; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.position}</span>
                                        </td>
                                        <td style="padding: 8px 10px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${formData.position || '‚Äì'}</td>
                                        <td style="padding: 8px 10px; background: #f1f5f9; border: 1px solid #e2e8f0;">
                                            <span style="font-size: 7pt; color: #64748b; text-transform: uppercase;">${t.profile}</span>
                                        </td>
                                        <td style="padding: 8px 10px; border: 1px solid #e2e8f0; font-weight: 600; font-size: 9pt;">${profileShort}</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <!-- TEIL B: ZIELERREICHUNG -->
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #3b82f6; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #1e40af; font-weight: 600;">${t.partB}</h3>
                                    <span style="background: #dbeafe; color: #1e40af; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                                        Score: ${wasScore.toFixed(2)}
                                    </span>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #1e40af; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.goalName}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 65px;">${t.weight}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 75px;">${t.achievement}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 50px;">BARS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${goals.map((g, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${g.name || '‚Äì'}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 600; vertical-align: top;">${g.weight}%</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                                    <span style="background: ${g.achievement >= 100 ? '#dcfce7' : g.achievement >= 70 ? '#fef9c3' : '#fee2e2'}; color: ${g.achievement >= 100 ? '#166534' : g.achievement >= 70 ? '#854d0e' : '#dc2626'}; padding: 2px 8px; border-radius: 10px; font-weight: 600;">
                                                        ${g.achievement}%
                                                    </span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; font-weight: 700; font-size: 11pt; vertical-align: top;">${getBarsScore(g.achievement)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                                
                                ${plannedBonusNum > 0 && goals.length > 0 ? `
                                <!-- BONUS-BERECHNUNG -->
                                <div style="margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 1px solid #6ee7b7; border-radius: 6px;">
                                    <h4 style="font-size: 11pt; font-weight: 700; color: #065f46; margin: 0 0 12px 0; display: flex; align-items: center;">
                                        üí∞ ${lang === 'de' ? 'Bonus-Berechnung' : lang === 'it' ? 'Calcolo Bonus' : 'Bonus Calculation'}
                                    </h4>
                                    <table style="width: 100%; border-collapse: collapse; font-size: 9pt;">
                                        <thead>
                                            <tr style="background: rgba(6, 95, 70, 0.1);">
                                                <th style="padding: 8px; text-align: left; color: #065f46; font-weight: 600;">${lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'}</th>
                                                <th style="padding: 8px; text-align: center; color: #065f46; font-weight: 600; width: 60px;">${lang === 'de' ? 'Gewicht' : lang === 'it' ? 'Peso' : 'Weight'}</th>
                                                <th style="padding: 8px; text-align: right; color: #065f46; font-weight: 600; width: 80px;">${lang === 'de' ? 'Anteil' : lang === 'it' ? 'Quota' : 'Share'}</th>
                                                <th style="padding: 8px; text-align: center; color: #065f46; font-weight: 600; width: 70px;">${lang === 'de' ? 'Erreicht' : lang === 'it' ? 'Raggiunto' : 'Achieved'}</th>
                                                <th style="padding: 8px; text-align: right; color: #065f46; font-weight: 600; width: 90px;">${lang === 'de' ? 'Auszahlung' : lang === 'it' ? 'Pagamento' : 'Payout'}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${bonusPerGoal.map((b, idx) => `
                                                <tr style="border-top: 1px solid #a7f3d0;">
                                                    <td style="padding: 8px; color: #334155;">${b.goalName || (lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal') + ' ' + (idx + 1)}</td>
                                                    <td style="padding: 8px; text-align: center; color: #64748b;">${b.weight}%</td>
                                                    <td style="padding: 8px; text-align: right; color: #64748b;">${formatGermanNumber(b.goalBonus.toFixed(0))} ‚Ç¨</td>
                                                    <td style="padding: 8px; text-align: center;">
                                                        <span style="padding: 2px 6px; border-radius: 10px; font-size: 8pt; font-weight: 600; background: ${b.achievement >= 100 ? '#dcfce7' : b.achievement >= 70 ? '#fef9c3' : '#fee2e2'}; color: ${b.achievement >= 100 ? '#166534' : b.achievement >= 70 ? '#854d0e' : '#dc2626'};">
                                                            ${b.achievement}%
                                                        </span>
                                                    </td>
                                                    <td style="padding: 8px; text-align: right; font-weight: 700; color: #065f46;">${formatGermanNumber(b.payout.toFixed(0))} ‚Ç¨</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 12px; margin-top: 12px; border-top: 2px solid #6ee7b7;">
                                        <div>
                                            <span style="font-size: 9pt; color: #065f46;">${lang === 'de' ? 'Geplanter Bonus:' : lang === 'it' ? 'Bonus previsto:' : 'Planned Bonus:'}</span>
                                            <span style="font-weight: 700; margin-left: 5px;">${formatGermanNumber(plannedBonusNum.toFixed(0))} ‚Ç¨</span>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 8pt; color: #059669;">${lang === 'de' ? 'Tats√§chliche Auszahlung' : lang === 'it' ? 'Pagamento effettivo' : 'Actual Payout'}</div>
                                            <div style="font-size: 18pt; font-weight: 900; color: #065f46;">${formatGermanNumber(totalBonusPayout.toFixed(0))} ‚Ç¨</div>
                                            <div style="font-size: 8pt; font-weight: 600; color: ${bonusPayoutPercentage >= 100 ? '#16a34a' : bonusPayoutPercentage >= 70 ? '#ca8a04' : '#dc2626'};">
                                                (${bonusPayoutPercentage.toFixed(1)}% ${lang === 'de' ? 'vom Zielbonus' : lang === 'it' ? 'del target' : 'of target bonus'})
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                            
                            <!-- TEIL C: WIE-KOMPETENZEN (CORE) -->
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #6EBD84; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #166534; font-weight: 600;">${t.partC}</h3>
                                    <span style="background: #dcfce7; color: #166534; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                                        Score: ${wieCoreScore.toFixed(2)}
                                    </span>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #166534; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 30%;">${t.compName}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 60px;">${t.rating}</th>
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.comment}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${coreList.map((c, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f0fdf4'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-weight: 500; vertical-align: top;">${c.name}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                                    <span style="display: inline-block; width: 24px; height: 24px; line-height: 24px; background: #166534; color: white; border-radius: 50%; font-weight: 700; font-size: 10pt;">${c.rating}</span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-size: 9pt; color: #475569; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${c.comment || '‚Äì'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            
                            ${isManager ? `
                            <!-- TEIL C: WIE-KOMPETENZEN (LEADERSHIP) -->
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 8px 12px; border-left: 4px solid #059669; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #059669; font-weight: 600;">${t.partCLead}</h3>
                                    <span style="background: #d1fae5; color: #059669; padding: 4px 12px; border-radius: 20px; font-size: 10pt; font-weight: 700;">
                                        Score: ${wieLeadScore.toFixed(2)}
                                    </span>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #059669; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 30%;">${t.compName}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 60px;">${t.rating}</th>
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.comment}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${leadList.map((l, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#ecfdf5'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-weight: 500; vertical-align: top;">${l.name}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">
                                                    <span style="display: inline-block; width: 24px; height: 24px; line-height: 24px; background: #059669; color: white; border-radius: 50%; font-weight: 700; font-size: 10pt;">${l.rating}</span>
                                                </td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; font-size: 9pt; color: #475569; vertical-align: top; word-wrap: break-word; white-space: pre-wrap;">${l.comment || '‚Äì'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            ` : ''}
                            
                            <!-- GPS ERGEBNIS -->
                            <div style="margin-bottom: 20px; padding: 25px; background: linear-gradient(135deg, #243186 0%, #1a2564 100%); border-radius: 8px; text-align: center; page-break-inside: avoid;">
                                <p style="font-size: 10pt; color: rgba(255,255,255,0.7); margin: 0 0 5px 0; text-transform: uppercase; letter-spacing: 2px;">FINAL GPS</p>
                                <p style="font-size: 52pt; font-weight: 900; margin: 10px 0; color: white;">${finalGPS.toFixed(2)}</p>
                                <p style="font-size: 10pt; color: #6EBD84; font-weight: 600; margin: 10px 0 0 0;">
                                    ${goals.length === 0 || totalGoalWeight === 0
                                        ? (isManager 
                                            ? (lang === 'de' ? '(100% WIE: 50% Kern + 50% Leadership)' : lang === 'it' ? '(100% COME: 50% Core + 50% Leadership)' : '(100% HOW: 50% Core + 50% Leadership)')
                                            : (lang === 'de' ? '(100% WIE: Kern-Kompetenzen)' : lang === 'it' ? '(100% COME: Competenze Core)' : '(100% HOW: Core Competencies)'))
                                        : (isManager 
                                            ? '(WAS 50% + WIE Core 25% + WIE Lead 25%)' 
                                            : '(WAS 50% + WIE Core 50%)')}
                                </p>
                                ${goals.length === 0 ? `<p style="font-size: 9pt; color: #fbbf24; margin-top: 8px;">‚ö†Ô∏è ${lang === 'de' ? 'Ohne Zielvereinbarung' : lang === 'it' ? 'Senza accordo obiettivi' : 'Without Goal Agreement'}</p>` : ''}
                            </div>
                            
                            <!-- TEIL D: ST√ÑRKEN & ENTWICKLUNG -->
                            <div style="margin-bottom: 20px;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partD}</h3>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <p style="font-weight: 600; margin: 0 0 5px 0; font-size: 10pt; color: #334155;">${t.strengthsProfessional}</p>
                                    <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; min-height: 40px; word-wrap: break-word; overflow-wrap: break-word; white-space: pre-wrap; font-size: 10pt; line-height: 1.4;">${(formData.strengths1 || '‚Äì').substring(0, 2000)}${(formData.strengths1 || '').length > 2000 ? '...' : ''}</div>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <p style="font-weight: 600; margin: 0 0 5px 0; font-size: 10pt; color: #334155;">${t.strengthsPersonal}</p>
                                    <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; min-height: 40px; word-wrap: break-word; overflow-wrap: break-word; white-space: pre-wrap; font-size: 10pt; line-height: 1.4;">${(formData.strengths2 || '‚Äì').substring(0, 2000)}${(formData.strengths2 || '').length > 2000 ? '...' : ''}</div>
                                </div>
                                
                                <p style="font-weight: 600; margin: 15px 0 8px 0; font-size: 11pt; color: #243186;">${t.development}</p>
                                <table style="width: 100%; border-collapse: collapse; font-size: 9pt; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #243186; color: white;">
                                            <th style="padding: 8px; text-align: left; font-weight: 600;">${t.measure}</th>
                                            <th style="padding: 8px; text-align: left; font-weight: 600; width: 120px;">${t.responsible}</th>
                                            <th style="padding: 8px; text-align: center; font-weight: 600; width: 85px;">${t.deadline}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${devPlan.map((d, idx) => `
                                            <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f8fafc'}; page-break-inside: avoid;">
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top; word-wrap: break-word; overflow-wrap: break-word; white-space: pre-wrap;">${(d.measure || '‚Äì').substring(0, 500)}${(d.measure || '').length > 500 ? '...' : ''}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">${d.responsible || '‚Äì'}</td>
                                                <td style="padding: 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: top;">${d.deadline || '‚Äì'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- TEIL E: KARRIEREPERSPEKTIVEN -->
                            <div style="margin-bottom: 20px; page-break-inside: avoid;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partE}</h3>
                                </div>
                                <p style="font-size: 9pt; color: #64748b; margin-bottom: 8px;">${t.careerIntro}</p>
                                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
                                    ${t.careerOptions.map((opt, i) => careerChecks[i] ? `
                                        <span style="padding: 6px 12px; background: #dcfce7; border: 1px solid #86efac; border-radius: 20px; font-size: 9pt; color: #166534;">‚úì ${opt}</span>
                                    ` : '').join('') || `<span style="font-size: 9pt; color: #94a3b8; font-style: italic;">${lang === 'de' ? 'Keine Auswahl getroffen' : lang === 'it' ? 'Nessuna selezione' : 'No selection made'}</span>`}
                                </div>
                                <div style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; font-size: 9pt; word-wrap: break-word; white-space: pre-wrap; min-height: 40px;">
                                    ${formData.careerComment || `<span style="color: #94a3b8; font-style: italic;">${lang === 'de' ? 'Kein Kommentar' : lang === 'it' ? 'Nessun commento' : 'No comment'}</span>`}
                                </div>
                            </div>
                            
                            <!-- TEIL F: FEEDBACK -->
                            <div style="margin-bottom: 20px;">
                                <div style="background: #f8fafc; padding: 8px 12px; border-left: 4px solid #243186; margin-bottom: 10px;">
                                    <h3 style="font-size: 12pt; margin: 0; color: #243186; font-weight: 600;">${t.partF}</h3>
                                </div>
                                <p style="font-size: 9pt; color: #64748b; margin-bottom: 12px;">${t.feedbackIntro}</p>
                                
                                ${[
                                    { q: t.feedbackQ1, a: formData.feedbackQ1 },
                                    { q: t.feedbackQ2, a: formData.feedbackQ2 },
                                    { q: t.feedbackQ3, a: formData.feedbackQ3 },
                                    { q: t.feedbackQ4, a: formData.feedbackQ4 },
                                    { q: t.feedbackQ5, a: formData.feedbackQ5 },
                                    { q: t.feedbackQ6, a: formData.feedbackQ6 },
                                    { q: t.feedbackQ7, a: formData.feedbackQ7 }
                                ].map(item => {
                                    // Erlaube Seitenumbruch bei langen Antworten (>200 Zeichen)
                                    const isLongText = (item.a || '').length > 200;
                                    return `
                                    <div style="margin-bottom: 10px; ${isLongText ? '' : 'page-break-inside: avoid;'}">
                                        <p style="font-weight: 600; margin: 0 0 4px 0; font-size: 9pt; color: #334155; page-break-after: avoid;">${item.q}</p>
                                        <div style="padding: 8px 10px; border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; font-size: 9pt; min-height: 20px; word-wrap: break-word; white-space: pre-wrap; overflow-wrap: break-word; orphans: 3; widows: 3;">${item.a || '‚Äì'}</div>
                                    </div>
                                `}).join('')}
                            </div>
                            
                            <!-- TEIL H: UNTERSCHRIFTEN (niemals umbrechen) -->
                            <div style="margin-top: 30px; padding: 20px; border: 2px solid #243186; border-radius: 6px; page-break-inside: avoid; break-inside: avoid;">
                                <h3 style="font-size: 12pt; margin: 0 0 25px 0; color: #243186; font-weight: 600; text-align: center;">${t.partH}</h3>
                                <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                                    <div style="width: 42%; text-align: center;">
                                        <div style="border-bottom: 2px solid #1e293b; height: 60px;"></div>
                                        <p style="margin: 8px 0 0 0; font-size: 9pt; color: #64748b;">${t.employee}</p>
                                        <p style="margin: 2px 0 0 0; font-size: 8pt; color: #94a3b8;">${lang === 'de' ? 'Datum, Unterschrift' : lang === 'it' ? 'Data, Firma' : 'Date, Signature'}</p>
                                    </div>
                                    <div style="width: 42%; text-align: center;">
                                        <div style="border-bottom: 2px solid #1e293b; height: 60px;"></div>
                                        <p style="margin: 8px 0 0 0; font-size: 9pt; color: #64748b;">${t.manager}</p>
                                        <p style="margin: 2px 0 0 0; font-size: 8pt; color: #94a3b8;">${lang === 'de' ? 'Datum, Unterschrift' : lang === 'it' ? 'Data, Firma' : 'Date, Signature'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- FOOTER -->
                            <div style="margin-top: 30px; padding-top: 10px; border-top: 1px solid #e2e8f0; text-align: center;">
                                <p style="font-size: 8pt; color: #94a3b8; margin: 0;">
                                    Niederwieser Group | ${lang === 'de' ? 'Performance Management System' : lang === 'it' ? 'Sistema di Gestione delle Performance' : 'Performance Management System'} | ${currentDate}
                                </p>
                                <p style="font-size: 7pt; color: #cbd5e1; margin: 3px 0 0 0;">
                                    ${lang === 'de' ? 'Dieses Dokument ist vertraulich und nur f√ºr den internen Gebrauch bestimmt.' : lang === 'it' ? 'Questo documento √® riservato e destinato esclusivamente all\'uso interno.' : 'This document is confidential and intended for internal use only.'}
                                </p>
                            </div>
                        `;
                        
                        pdfContainer.innerHTML = pdfHTML;
                        
                        // === KRITISCH: Sanitize PDF-Container - entferne alle no-print Elemente ===
                        sanitizePdfContainer(pdfContainer);
                        
                        document.body.appendChild(pdfContainer);
                        
                        const opt = {
                            margin: [15, 18, 15, 15], // [top, right, bottom, left] in mm
                            filename: `Performance_Review_${(formData.employee || 'Export').replace(/[^a-z0-9√§√∂√º√ü]/gi, '_')}.pdf`,
                            image: { type: 'jpeg', quality: 0.98 },
                            html2canvas: { 
                                scale: 2,
                                useCORS: true,
                                logging: false,
                                backgroundColor: '#ffffff'
                            },
                            jsPDF: { 
                                unit: 'mm', 
                                format: 'a4', 
                                orientation: 'portrait'
                            },
                            pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
                        };
                        
                        window.html2pdf()
                            .set(opt)
                            .from(pdfContainer)
                            .save()
                            .then(() => {
                                document.body.removeChild(pdfContainer);
                                setIsGenerating(false);
                            })
                            .catch(err => {
                                console.error('PDF Error:', err);
                                alert("Fehler beim PDF-Export: " + err.message);
                                if (document.body.contains(pdfContainer)) {
                                    document.body.removeChild(pdfContainer);
                                }
                                setIsGenerating(false);
                            });
                            
                    } catch (error) {
                        console.error('PDF Generation Error:', error);
                        alert("Fehler beim PDF-Export: " + error.message);
                        setIsGenerating(false);
                    }
                }, 300);
            };

            const renderRow = (item, setList, list, isGoal) => {
                // Hole MA-Selbsteinsch√§tzung f√ºr diese Kompetenz (falls vorhanden)
                const getSelfScore = () => {
                  if (!linkedSelfAssessment || isGoal) return null;
                  const selfScores = linkedSelfAssessment.selfCoreScores || {};
                  const selfLeaderScores = linkedSelfAssessment.selfLeaderScores || {};
                  const selfComments = linkedSelfAssessment.selfCoreComments || {};
                  
                  // Mapping: item.id (fach, komm, prob, adapt, orga) ‚Üí selfScores Key (c1, c2, c3, c4, c5)
                  const idMapping = { fach: 'c1', komm: 'c2', prob: 'c3', adapt: 'c4', orga: 'c5' };
                  const leaderMapping = { lead: 'l1', strat: 'l2', decide: 'l3', exec: 'l4', stake: 'l5' };
                  
                  // Check if it's a leadership competency
                  const isLeader = ['lead', 'strat', 'decide', 'exec', 'stake', 'l1', 'l2', 'l3', 'l4', 'l5'].includes(item.id);
                  const selfKey = isLeader 
                    ? (leaderMapping[item.id] || item.id)
                    : (idMapping[item.id] || item.id);
                  const scores = isLeader ? selfLeaderScores : selfScores;
                  
                  return {
                    score: scores[selfKey] || scores[item.id] || null,
                    comment: selfComments[selfKey] || selfComments[item.id] || null
                  };
                };
                const selfData = getSelfScore();
                
                // Gap-Analyse f√ºr diese Kompetenz
                const gapData = competencyGaps[item.id];
                const hasGap = gapData && Math.abs(gapData.gap) > 1;
                
                return e(React.Fragment, { key: item.id },
                    e('tr', { 
                      className: `break-inside-avoid ${hasGap ? 'ring-2 ring-amber-400 ring-inset bg-amber-50/50' : ''}`
                    },
                        e('td', { className: "p-2 border align-top" }, 
                            isGoal 
                                ? e('div', null,
                                    e('textarea', { 
                                        className: "w-full bg-transparent outline-none font-medium resize-none", 
                                        value: item.name, 
                                        maxLength: 500,
                                        rows: 2,
                                        placeholder: lang === 'de' ? 'Zielbezeichnung (max. 500 Zeichen)...' : lang === 'it' ? 'Nome obiettivo (max. 500 caratteri)...' : 'Goal name (max. 500 characters)...',
                                        onChange: (ev) => updateItem(list, setList, item.id, 'name', ev.target.value) 
                                    }),
                                    e('div', { className: 'text-xs text-slate-400 text-right mt-1' }, 
                                        `${(item.name || '').length}/500`
                                    )
                                  )
                                : e('div', null,
                                    e('input', { className: "w-full bg-transparent outline-none font-medium", value: item.name, placeholder: "...", onChange: (ev) => updateItem(list, setList, item.id, 'name', ev.target.value) }),
                                    // Gap-Warnung als Hinweis unter dem Namen
                                    hasGap && e('div', { 
                                      className: 'mt-1 text-xs px-2 py-1 rounded bg-amber-100 text-amber-800 border-l-3 border-amber-500 no-print flex items-start gap-1.5'
                                    },
                                      e('span', { className: 'text-amber-600 flex-shrink-0' }, '‚ö†Ô∏è'),
                                      e('span', null,
                                        lang === 'de' 
                                          ? `Gap: MA sieht sich bei ${gapData.selfScore}, Sie bei ${gapData.fkScore}. Fragen Sie nach konkreten Beispielen!`
                                          : lang === 'it'
                                          ? `Gap: MA si vede a ${gapData.selfScore}, Lei a ${gapData.fkScore}. Chieda esempi concreti!`
                                          : `Gap: Employee rates ${gapData.selfScore}, you rate ${gapData.fkScore}. Ask for specific examples!`
                                      )
                                    )
                                  )
                        ),
                        isGoal && e('td', { className: "p-2 border text-center w-16 align-top" }, 
                            e('div', { className: "flex items-center justify-center" },
                                e('input', { type: "number", className: "w-full bg-transparent outline-none text-right pr-1", value: item.weight, onChange: (ev) => updateItem(list, setList, item.id, 'weight', ev.target.value) }), e('span', null, "%")
                            )
                        ),
                        isGoal && e('td', { className: "p-2 border text-center w-16 align-top" }, 
                            e('div', { className: "flex items-center justify-center" },
                                e('input', { type: "number", className: "w-full bg-transparent outline-none text-right pr-1", value: item.achievement, onChange: (ev) => updateItem(list, setList, item.id, 'achievement', ev.target.value) }), e('span', null, "%")
                            )
                        ),
                        e('td', { className: `p-2 border text-center w-24 font-bold align-top ${hasGap ? 'bg-amber-100' : 'bg-slate-50'}` }, 
                            isGoal ? getBarsScore(item.achievement) : 
                            e('div', { className: 'flex flex-col items-center gap-1' },
                              e('select', { 
                                className: `bg-transparent w-full text-center outline-none font-bold ${hasGap ? 'text-amber-700' : ''}`, 
                                value: item.rating, 
                                onChange: (ev) => updateItem(list, setList, item.id, 'rating', parseInt(ev.target.value)) 
                              }, 
                                  [1,2,3,4,5].map(n => e('option', {key:n, value:n}, n))),
                              // MA-Selbsteinsch√§tzung Badge (falls vorhanden)
                              selfData && selfData.score && e('div', { 
                                className: `text-xs px-2 py-0.5 rounded font-medium mt-1 no-print ${hasGap ? 'bg-amber-200 text-amber-800' : 'bg-teal-100 text-teal-700'}`,
                                title: lang === 'de' 
                                  ? (hasGap ? `Abweichung: ${Math.abs(gapData.gap)} Stufen - Gespr√§chsbedarf!` : 'Selbsteinsch√§tzung des Mitarbeiters')
                                  : (hasGap ? `Scostamento: ${Math.abs(gapData.gap)} livelli - da discutere!` : 'Autovalutazione del collaboratore')
                              }, 'MA: ', selfData.score)
                            )
                        ),
                        !isGoal && e('td', { className: "p-2 border" }, 
                            e('div', null,
                              e('textarea', { className: "w-full bg-transparent outline-none resize-none text-sm", rows: 1, value: item.comment, placeholder: "...", onChange: (ev) => updateItem(list, setList, item.id, 'comment', ev.target.value) }),
                              // MA-Kommentar Hinweis (falls vorhanden)
                              selfData && selfData.comment && e('div', { 
                                className: 'mt-1 text-xs text-teal-600 bg-teal-50 p-1.5 rounded border-l-2 border-teal-400 no-print'
                              }, 
                                e('span', { className: 'font-medium' }, 'MA: '),
                                selfData.comment.length > 80 ? selfData.comment.substring(0, 80) + '...' : selfData.comment
                              )
                            )
                        ),
                        // L√∂schen-Button f√ºr Ziele
                        isGoal && e('td', { className: "p-2 border text-center no-print w-8 align-top" }, 
                            e('button', { 
                                onClick: () => removeItem(list, setList, item.id), 
                                className: "text-slate-300 hover:text-red-500 transition-colors",
                                title: lang === 'de' ? 'Ziel l√∂schen' : lang === 'it' ? 'Elimina obiettivo' : 'Delete Goal'
                            }, e(Trash2, { size: 14 }))
                        )
                    ),
                    !isGoal && item.rating && (() => {
                        // Map competency id to BARS key
                        const compKey = item.id === 'fach' || (typeof item.id === 'string' && item.id.length <= 10) ? item.id : 
                                       CORE_COMPETENCIES_CALC.find(c => c.name === item.name || c.nameIt === item.name)?.id ||
                                       LEADERSHIP_COMPETENCIES_CALC.find(c => c.name === item.name || c.nameIt === item.name)?.id;
                        const description = compKey && t.barsCompetency && t.barsCompetency[compKey] ? 
                                           t.barsCompetency[compKey][item.rating] : 
                                           '';
                        return description ? e('tr', { className: "break-inside-avoid no-print" },
                            e('td', { colSpan: 4, className: "px-2 py-1 border-l border-r bg-blue-50 text-xs text-blue-700 italic" },
                                description
                            )
                        ) : null;
                    })()
                );
            };
            
            const renderDevRow = (item) => (
                e('tr', { key: item.id, className: "break-inside-avoid" },
                    e('td', { className: "p-2 border" }, 
                        e('input', { className: "w-full bg-transparent outline-none", value: item.measure, placeholder: "...", onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'measure', ev.target.value) })
                    ),
                    e('td', { className: "p-2 border" }, 
                        e('input', { className: "w-full bg-transparent outline-none", value: item.responsible, placeholder: "...", onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'responsible', ev.target.value) })
                    ),
                    e('td', { className: "p-2 border" }, 
                        e('input', { type: "date", className: "w-full bg-transparent outline-none", value: item.deadline, onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'deadline', ev.target.value) })
                    ),
                    e('td', { className: "p-2 border text-center no-print w-8" }, 
                        e('button', { onClick: () => removeItem(devPlan, setDevPlan, item.id), className: "text-slate-300 hover:text-red-500" }, e(Trash2, { size: 14 }))
                    )
                )
            );
            
            // === MOBILE KARTEN-KOMPONENTEN F√úR APPRAISAL FORM ===
            
            // Mobile Karte f√ºr Ziele (WAS)
            const renderGoalCardAppraisal = (item, index) => {
                const barsScore = getBarsScore(item.achievement);
                return e('div', { 
                    key: item.id, 
                    className: 'bg-white border border-slate-200 rounded-xl p-4 shadow-sm'
                },
                    // Header
                    e('div', { className: 'flex justify-between items-center mb-3' },
                        e('span', { className: 'bg-[#243186] text-white text-xs font-bold px-2 py-1 rounded' },
                            `${lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'} ${index + 1}`
                        ),
                        e('div', { className: 'flex items-center gap-2' },
                            e('span', { className: `text-lg font-bold px-2 py-0.5 rounded ${
                                barsScore >= 4 ? 'bg-green-100 text-green-700' :
                                barsScore >= 3 ? 'bg-blue-100 text-blue-700' :
                                barsScore >= 2 ? 'bg-amber-100 text-amber-700' :
                                'bg-red-100 text-red-700'
                            }` }, barsScore),
                            e('button', { 
                                onClick: () => removeItem(goals, setGoals, item.id), 
                                className: 'text-slate-400 hover:text-red-500 p-1'
                            }, e(Trash2, { size: 16 }))
                        )
                    ),
                    // Zielbezeichnung
                    e('div', { className: 'mb-3' },
                        e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.goalName),
                        e('textarea', { 
                            className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm resize-none focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                            value: item.name, 
                            maxLength: 500,
                            rows: 2,
                            placeholder: lang === 'de' ? 'Zielbezeichnung...' : lang === 'it' ? 'Nome obiettivo...' : 'Goal name...', 
                            onChange: (ev) => updateItem(goals, setGoals, item.id, 'name', ev.target.value) 
                        }),
                        e('div', { className: 'text-xs text-slate-400 text-right' }, `${(item.name || '').length}/500`)
                    ),
                    // Gewichtung & Erreichung
                    e('div', { className: 'grid grid-cols-2 gap-3' },
                        e('div', null,
                            e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.weight),
                            e('div', { className: 'flex items-center border border-slate-200 rounded-lg overflow-hidden' },
                                e('input', { 
                                    type: 'number', 
                                    className: 'flex-1 p-2 text-center text-lg font-bold outline-none', 
                                    value: item.weight, 
                                    onChange: (ev) => updateItem(goals, setGoals, item.id, 'weight', ev.target.value) 
                                }),
                                e('span', { className: 'bg-slate-100 px-3 py-2 text-slate-600 font-medium' }, '%')
                            )
                        ),
                        e('div', null,
                            e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.achievement),
                            e('div', { className: 'flex items-center border border-slate-200 rounded-lg overflow-hidden' },
                                e('input', { 
                                    type: 'number', 
                                    className: 'flex-1 p-2 text-center text-lg font-bold outline-none', 
                                    value: item.achievement, 
                                    onChange: (ev) => updateItem(goals, setGoals, item.id, 'achievement', ev.target.value) 
                                }),
                                e('span', { className: 'bg-slate-100 px-3 py-2 text-slate-600 font-medium' }, '%')
                            )
                        )
                    )
                );
            };
            
            // Mobile Karte f√ºr Kompetenzen (WIE)
            const renderCompetencyCard = (item, setList, list, isLeadership = false) => {
                const getSelfScore = () => {
                    if (!linkedSelfAssessment) return null;
                    const selfScores = linkedSelfAssessment.selfCoreScores || {};
                    const selfLeaderScores = linkedSelfAssessment.selfLeaderScores || {};
                    const selfComments = linkedSelfAssessment.selfCoreComments || {};
                    const idMapping = { fach: 'c1', komm: 'c2', prob: 'c3', adapt: 'c4', orga: 'c5' };
                    const leaderMapping = { lead: 'l1', strat: 'l2', decide: 'l3', exec: 'l4', stake: 'l5' };
                    const isLeader = ['lead', 'strat', 'decide', 'exec', 'stake', 'l1', 'l2', 'l3', 'l4', 'l5'].includes(item.id);
                    const selfKey = isLeader ? (leaderMapping[item.id] || item.id) : (idMapping[item.id] || item.id);
                    const scores = isLeader ? selfLeaderScores : selfScores;
                    return { score: scores[selfKey] || scores[item.id] || null, comment: selfComments[selfKey] || selfComments[item.id] || null };
                };
                const selfData = getSelfScore();
                const gapData = competencyGaps[item.id];
                const hasGap = gapData && Math.abs(gapData.gap) > 1;
                
                // Get BARS description
                const compKey = item.id;
                const description = compKey && t.barsCompetency && t.barsCompetency[compKey] ? t.barsCompetency[compKey][item.rating] : '';
                
                return e('div', { 
                    key: item.id, 
                    className: `bg-white border rounded-xl p-4 shadow-sm ${hasGap ? 'border-amber-400 ring-2 ring-amber-200' : 'border-slate-200'}`
                },
                    // Header mit Name und Rating
                    e('div', { className: 'flex justify-between items-start mb-3' },
                        e('div', { className: 'flex-1' },
                            e('span', { className: `text-xs font-bold px-2 py-0.5 rounded mb-1 inline-block ${isLeadership ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'}` },
                                isLeadership ? (lang === 'de' ? 'F√ºhrung' : 'Leadership') : (lang === 'de' ? 'Kern' : 'Core')
                            ),
                            e('h4', { className: 'font-bold text-slate-800 mt-1' }, item.name)
                        ),
                        // Rating Auswahl
                        e('div', { className: 'flex flex-col items-center' },
                            e('select', { 
                                className: `text-2xl font-bold p-2 rounded-lg border-2 outline-none ${
                                    item.rating >= 4 ? 'border-green-300 bg-green-50 text-green-700' :
                                    item.rating >= 3 ? 'border-blue-300 bg-blue-50 text-blue-700' :
                                    item.rating >= 2 ? 'border-amber-300 bg-amber-50 text-amber-700' :
                                    'border-red-300 bg-red-50 text-red-700'
                                }`, 
                                value: item.rating, 
                                onChange: (ev) => updateItem(list, setList, item.id, 'rating', parseInt(ev.target.value)) 
                            }, [1,2,3,4,5].map(n => e('option', {key:n, value:n}, n))),
                            selfData && selfData.score && e('div', { 
                                className: `text-xs px-2 py-0.5 rounded font-medium mt-1 ${hasGap ? 'bg-amber-200 text-amber-800' : 'bg-teal-100 text-teal-700'}`
                            }, 'MA: ', selfData.score)
                        )
                    ),
                    
                    // Gap-Warnung
                    hasGap && e('div', { className: 'mb-3 p-2 bg-amber-100 border-l-4 border-amber-500 rounded text-xs text-amber-800' },
                        '‚ö†Ô∏è ', lang === 'de' 
                            ? `Abweichung: MA sieht sich bei ${gapData.selfScore}, Sie bei ${gapData.fkScore}`
                            : `Gap: MA si vede a ${gapData.selfScore}, Lei a ${gapData.fkScore}`
                    ),
                    
                    // BARS Beschreibung
                    description && e('div', { className: 'mb-3 p-3 bg-slate-50 rounded-lg border border-slate-200' },
                        e('p', { className: 'text-xs text-slate-500 font-medium mb-1' }, 'BARS'),
                        e('p', { className: 'text-sm text-slate-700 italic' }, description)
                    ),
                    
                    // Kommentar
                    e('div', null,
                        e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, 
                            lang === 'de' ? 'Begr√ºndung / Beispiele' : lang === 'it' ? 'Motivazione / Esempi' : 'Justification / Examples'
                        ),
                        e('textarea', { 
                            className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm resize-none focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                            rows: 2, 
                            value: item.comment, 
                            placeholder: lang === 'de' ? 'Konkrete Beispiele...' : lang === 'it' ? 'Esempi concreti...' : 'Specific examples...', 
                            onChange: (ev) => updateItem(list, setList, item.id, 'comment', ev.target.value) 
                        }),
                        selfData && selfData.comment && e('div', { className: 'mt-2 text-xs text-teal-600 bg-teal-50 p-2 rounded border-l-2 border-teal-400' }, 
                            e('span', { className: 'font-medium' }, 'MA: '),
                            selfData.comment.length > 100 ? selfData.comment.substring(0, 100) + '...' : selfData.comment
                        )
                    )
                );
            };
            
            // Mobile Karte f√ºr Entwicklungsma√ünahmen
            const renderDevCard = (item, index) => {
                return e('div', { 
                    key: item.id, 
                    className: 'bg-white border border-slate-200 rounded-xl p-4 shadow-sm'
                },
                    e('div', { className: 'flex justify-between items-center mb-3' },
                        e('span', { className: 'bg-emerald-100 text-emerald-700 text-xs font-bold px-2 py-1 rounded' },
                            `${lang === 'de' ? 'Ma√ünahme' : lang === 'it' ? 'Misura' : 'Measure'} ${index + 1}`
                        ),
                        e('button', { 
                            onClick: () => removeItem(devPlan, setDevPlan, item.id), 
                            className: 'text-slate-400 hover:text-red-500 p-1'
                        }, e(Trash2, { size: 16 }))
                    ),
                    e('div', { className: 'space-y-3' },
                        e('div', null,
                            e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.measure),
                            e('input', { 
                                type: 'text',
                                className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                                value: item.measure, 
                                placeholder: '...', 
                                onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'measure', ev.target.value) 
                            })
                        ),
                        e('div', { className: 'grid grid-cols-2 gap-3' },
                            e('div', null,
                                e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.responsible),
                                e('input', { 
                                    type: 'text',
                                    className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                                    value: item.responsible, 
                                    placeholder: '...', 
                                    onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'responsible', ev.target.value) 
                                })
                            ),
                            e('div', null,
                                e('label', { className: 'text-xs font-medium text-slate-500 block mb-1' }, t.deadline),
                                e('input', { 
                                    type: 'date',
                                    className: 'w-full bg-slate-100/80 border-transparent rounded-xl p-3 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none', 
                                    value: item.deadline, 
                                    onChange: (ev) => updateItem(devPlan, setDevPlan, item.id, 'deadline', ev.target.value) 
                                })
                            )
                        )
                    )
                );
            };

            // Error Boundary f√ºr Debugging
            try {
            
            // === SPLIT-SCREEN SIDEBAR COMPONENT (NUR DESKTOP) ===
            const SelfAssessmentSidebar = () => {
              if (!linkedSelfAssessment || !teamContext) return null;
              
              // SPEZIALFALL: Nur PDF vorhanden (keine strukturierten Daten)
              if (linkedSelfAssessment._isPdfOnly) {
                const pdfT = {
                  de: { title: 'PDF-Selbstreflexion', info: 'Es liegt nur eine PDF vor. Klicken Sie zum Herunterladen.', download: 'PDF herunterladen' },
                  it: { title: 'Autovalutazione PDF', info: '√à disponibile solo un PDF. Clicca per scaricare.', download: 'Scarica PDF' },
                  en: { title: 'PDF Self-Reflection', info: 'Only a PDF is available. Click to download.', download: 'Download PDF' }
                }[lang] || { title: 'PDF Self-Reflection', info: 'Only PDF available.', download: 'Download' };
                
                return e('div', { 
                  className: 'hidden lg:block w-80 flex-shrink-0',
                  style: { position: 'sticky', top: '20px', alignSelf: 'flex-start' }
                },
                  e('div', { className: 'bg-amber-50 border-2 border-amber-200 rounded-xl p-4 shadow-lg' },
                    e('div', { className: 'flex items-center gap-2 mb-4 pb-3 border-b border-amber-200' },
                      e('div', { className: 'bg-amber-500 text-white p-2 rounded-full' }, e(FileText, { size: 16 })),
                      e('div', null,
                        e('h3', { className: 'font-bold text-amber-800' }, pdfT.title),
                        e('p', { className: 'text-xs text-amber-600' }, linkedSelfAssessment.employeeName)
                      )
                    ),
                    e('p', { className: 'text-sm text-amber-700 mb-4' }, pdfT.info),
                    e('p', { className: 'text-xs text-amber-600 mb-3' }, 'üìÑ ' + (linkedSelfAssessment.pdfFileName || 'Selbstreflexion.pdf')),
                    (linkedSelfAssessment.pdfUrl || linkedSelfAssessment.pdfData) && e('button', {
                      onClick: () => {
                        const pdfSource = linkedSelfAssessment.pdfUrl || linkedSelfAssessment.pdfData;
                        // √ñffne in neuem Tab (f√ºr URL) oder download (f√ºr Base64)
                        if (pdfSource.startsWith('http')) {
                          window.open(pdfSource, '_blank');
                        } else {
                          const link = document.createElement('a');
                          link.href = pdfSource;
                          link.download = linkedSelfAssessment.pdfFileName || 'Selbstreflexion.pdf';
                          link.click();
                        }
                      },
                      className: 'w-full py-2 px-3 bg-amber-500 text-white rounded-lg text-sm font-semibold hover:bg-amber-600 transition-all flex items-center justify-center gap-2'
                    }, e(Download, { size: 14 }), pdfT.download)
                  )
                );
              }
              
              const selfScores = linkedSelfAssessment.selfCoreScores || {};
              const selfLeaderScores = linkedSelfAssessment.selfLeaderScores || {};
              const selfComments = linkedSelfAssessment.selfCoreComments || {};
              const selfLeaderComments = linkedSelfAssessment.selfLeaderComments || {};
              
              const sidebarT = {
                de: { title: 'Selbstreflexion', strengths: 'St√§rken', development: 'Entwicklungsw√ºnsche', core: 'Kernkompetenzen', leadership: 'F√ºhrungskomp.', noData: 'Keine Angabe', hasPdf: '+ PDF vorhanden' },
                it: { title: 'Autovalutazione', strengths: 'Punti di forza', development: 'Sviluppo', core: 'Competenze base', leadership: 'Competenze leader', noData: 'Nessun dato', hasPdf: '+ PDF disponibile' },
                en: { title: 'Self-Reflection', strengths: 'Strengths', development: 'Development', core: 'Core Competencies', leadership: 'Leadership Comp.', noData: 'No data', hasPdf: '+ PDF available' }
              }[lang] || { title: 'Self-Reflection', strengths: 'Strengths', development: 'Development', core: 'Core', leadership: 'Leadership', noData: 'No data', hasPdf: '+ PDF' };
              
              return e('div', { 
                className: 'hidden lg:block w-80 flex-shrink-0',
                style: { position: 'sticky', top: '20px', alignSelf: 'flex-start', maxHeight: 'calc(100vh - 40px)', overflowY: 'auto' }
              },
                e('div', { className: 'bg-teal-50 border-2 border-teal-200 rounded-xl p-4 shadow-lg' },
                  // Header
                  e('div', { className: 'flex items-center gap-2 mb-4 pb-3 border-b border-teal-200' },
                    e('div', { className: 'bg-teal-500 text-white p-2 rounded-full' }, e(Users, { size: 16 })),
                    e('div', null,
                      e('h3', { className: 'font-bold text-teal-800' }, sidebarT.title),
                      e('p', { className: 'text-xs text-teal-600' }, linkedSelfAssessment.employeeName),
                      // Hinweis wenn zus√§tzlich PDF vorhanden
                      linkedSelfAssessment._hasPdf && e('p', { className: 'text-xs text-amber-600 mt-1' }, 'üìÑ ', sidebarT.hasPdf)
                    )
                  ),
                  
                  // PDF-Download Button wenn _hasPdf
                  linkedSelfAssessment._hasPdf && linkedSelfAssessment._pdfUrl && e('button', {
                    onClick: () => {
                      const pdfSource = linkedSelfAssessment._pdfUrl;
                      if (pdfSource.startsWith('http')) {
                        window.open(pdfSource, '_blank');
                      } else {
                        const link = document.createElement('a');
                        link.href = pdfSource;
                        link.download = linkedSelfAssessment._pdfFileName || 'Selbstreflexion.pdf';
                        link.click();
                      }
                    },
                    className: 'w-full mb-3 py-1.5 px-2 bg-amber-100 text-amber-700 rounded-lg text-xs font-medium hover:bg-amber-200 transition-all flex items-center justify-center gap-1'
                  }, e(Download, { size: 12 }), linkedSelfAssessment._pdfFileName || 'PDF herunterladen'),
                  
                  // St√§rken
                  linkedSelfAssessment.formData?.strengths1 && e('div', { className: 'mb-3' },
                    e('h4', { className: 'text-xs font-bold text-teal-700 mb-1 flex items-center gap-1' }, 'üí™ ', sidebarT.strengths),
                    e('p', { className: 'text-xs text-slate-600 bg-white p-2 rounded border border-teal-100' }, 
                      linkedSelfAssessment.formData.strengths1 || sidebarT.noData
                    )
                  ),
                  
                  // Entwicklungsw√ºnsche
                  linkedSelfAssessment.formData?.strengths2 && e('div', { className: 'mb-3' },
                    e('h4', { className: 'text-xs font-bold text-teal-700 mb-1 flex items-center gap-1' }, 'üå± ', sidebarT.development),
                    e('p', { className: 'text-xs text-slate-600 bg-white p-2 rounded border border-teal-100' }, 
                      linkedSelfAssessment.formData.strengths2 || sidebarT.noData
                    )
                  ),
                  
                  // Kernkompetenzen Scores
                  Object.keys(selfScores).length > 0 && e('div', { className: 'mb-3' },
                    e('h4', { className: 'text-xs font-bold text-teal-700 mb-2' }, 'üìä ', sidebarT.core),
                    e('div', { className: 'space-y-1' },
                      Object.entries(selfScores).slice(0, 5).map(([key, score]) => {
                        const compName = defs.core.find(c => c.id === key)?.name || key;
                        return e('div', { key, className: 'flex items-center justify-between text-xs bg-white px-2 py-1 rounded' },
                          e('span', { className: 'text-slate-600 truncate', style: { maxWidth: '150px' } }, compName),
                          e('span', { className: `font-bold px-1.5 py-0.5 rounded ${
                            score >= 4 ? 'bg-green-100 text-green-700' : 
                            score >= 3 ? 'bg-blue-100 text-blue-700' : 
                            score >= 2 ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'
                          }` }, score)
                        );
                      })
                    )
                  ),
                  
                  // F√ºhrungskompetenzen Scores (falls vorhanden)
                  Object.keys(selfLeaderScores).length > 0 && e('div', { className: 'mb-3' },
                    e('h4', { className: 'text-xs font-bold text-teal-700 mb-2' }, 'üëî ', sidebarT.leadership),
                    e('div', { className: 'space-y-1' },
                      Object.entries(selfLeaderScores).slice(0, 5).map(([key, score]) => {
                        const compName = defs.lead.find(c => c.id === key)?.name || key;
                        return e('div', { key, className: 'flex items-center justify-between text-xs bg-white px-2 py-1 rounded' },
                          e('span', { className: 'text-slate-600 truncate', style: { maxWidth: '150px' } }, compName),
                          e('span', { className: `font-bold px-1.5 py-0.5 rounded ${
                            score >= 4 ? 'bg-green-100 text-green-700' : 
                            score >= 3 ? 'bg-blue-100 text-blue-700' : 
                            score >= 2 ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'
                          }` }, score)
                        );
                      })
                    )
                  ),
                  
                  // Button zur vollst√§ndigen Ansicht - MIT AUTO-SAVE
                  e('button', {
                    onClick: () => {
                      try {
                        // AUTO-SAVE: Speichere aktuellen Formular-Stand als Entwurf
                        if (teamContext && onSaveTeam) {
                          console.log('üíæ Auto-Save vor Wechsel zur Selbstreflexion...');
                          
                          // Collect scores - mit Fallback
                          const coreScoresObj = {};
                          const coreCommentsObj = {};
                          (coreList || []).forEach(c => {
                            coreScoresObj[c.id] = c.rating;
                            coreCommentsObj[c.id] = c.comment || '';
                          });
                          const leaderScoresObj = {};
                          const leaderCommentsObj = {};
                          (leadList || []).forEach(c => {
                            leaderScoresObj[c.id] = c.rating;
                            leaderCommentsObj[c.id] = c.comment || '';
                          });
                          
                          const autoSaveData = {
                            id: teamContext.appraisalId,
                            type: 'review',
                            employeeId: teamContext.employee?.id,
                            employeeName: teamContext.employee?.name,
                            position: teamContext.employee?.position,
                            period: teamContext.period,
                            status: 'draft',
                            createdAt: teamContext.existingData?.createdAt || new Date().toISOString(),
                            updatedAt: new Date().toISOString(),
                            goals: goals || [],
                            coreScores: coreScoresObj,
                            coreComments: coreCommentsObj,
                            leaderScores: leaderScoresObj,
                            leaderComments: leaderCommentsObj,
                            includeLeadership: isManager || false,
                            wasScore: currentWasScore || 0,
                            wieCoreScore: currentWieCoreScore || 0,
                            wieLeaderScore: currentWieLeadScore || 0,
                            gpsScore: currentFinalGPS || 0,
                            formData: formData || {},
                            careerChecks: careerChecks || [],
                            devPlan: devPlan || []
                          };
                          
                          onSaveTeam(autoSaveData);
                          console.log('‚úÖ Auto-Save abgeschlossen');
                        }
                        
                        // Speichere R√ºckkehr-Kontext
                        localStorage.setItem('nw_return_to_appraisal', JSON.stringify({
                          employeeId: teamContext?.employee?.id,
                          employeeName: teamContext?.employee?.name,
                          period: teamContext?.period,
                          timestamp: Date.now()
                        }));
                        
                        localStorage.setItem('nw_view_self_assessment', JSON.stringify(linkedSelfAssessment));
                        
                        // Direkt zur Selbstreflexions-Ansicht wechseln
                        if (setActiveView) {
                          setActiveView('viewSelfAssessment');
                          console.log('‚úÖ View gewechselt zu: viewSelfAssessment');
                        } else {
                          window.dispatchEvent(new CustomEvent('viewSelfAssessment'));
                          console.log('‚úÖ Event dispatched: viewSelfAssessment');
                        }
                      } catch (err) {
                        console.error('‚ùå Fehler beim √ñffnen der Selbstreflexion:', err);
                        // Trotzdem versuchen die Ansicht zu √∂ffnen
                        localStorage.setItem('nw_view_self_assessment', JSON.stringify(linkedSelfAssessment));
                        if (setActiveView) {
                          setActiveView('viewSelfAssessment');
                        } else {
                          window.dispatchEvent(new CustomEvent('viewSelfAssessment'));
                        }
                      }
                    },
                    className: 'w-full mt-2 px-3 py-2 bg-teal-600 text-white rounded-2xl hover:bg-teal-700 text-xs font-medium flex items-center justify-center gap-2 transition-colors'
                  }, 
                    e(Eye, { size: 12 }),
                    lang === 'de' ? 'Vollst√§ndig ansehen' : lang === 'it' ? 'Visualizza tutto' : 'View Complete'
                  )
                )
              );
            };
            
            // === MAIN LAYOUT: Split-Screen wenn linkedSelfAssessment vorhanden ===
            return e('div', { className: linkedSelfAssessment && teamContext ? 'lg:flex lg:gap-6 lg:max-w-7xl lg:mx-auto' : '' },
              // Sticky Sidebar (nur Desktop, nur wenn Selbstreflexion vorhanden)
              e(SelfAssessmentSidebar),
              
              // Hauptformular
              e('div', { ref: formRef, className: "max-w-5xl mx-auto space-y-8 pb-20 flex-1" },
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100" },
                    e('div', { className: "flex justify-between items-start mb-6" },
                        e('div', null, 
                            e('h1', { className: "text-3xl font-bold", style: { color: "#243186" } }, "nƒ±ederwƒ±eser"), 
                            e('span', { className: "text-sm tracking-wider font-medium", style: { color: "#6EBD84" } }, "FLEXIBLE FOOD PACKAGING")
                        ),
                        e('button', { onClick: handleDownloadPDF, disabled: isGenerating, className: "no-print flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-2xl hover:bg-blue-700 transition-colors disabled:opacity-50" }, 
                            isGenerating ? e(Loader2, { className: "animate-spin", size: 18 }) : e(Download, { size: 18 }), 
                            isGenerating ? t.generating : t.print
                        )
                    ),
                    e('div', { className: "border-b-2 border-slate-100 mb-4" }),
                    
                    // === TEAM BUTTONS (wenn teamContext) ===
                    teamButtonsVisible && teamContext && e('div', {
                      className: 'mb-6 p-5 bg-gradient-to-r from-[#243186] to-[#1a2564] rounded-xl shadow-2xl border-2 border-[#6EBD84]'
                    },
                      e('div', { className: 'flex flex-col gap-4' },
                        e('div', { className: 'flex justify-between items-start' },
                          e('div', { className: 'text-white' },
                            e('h2', { className: 'text-2xl font-bold mb-1', style: { color: '#6EBD84' } }, 
                              teamContext.employee.name
                            ),
                            e('p', { className: 'text-blue-200 text-sm font-medium' }, 
                              teamContext.employee.position + (teamContext.employee.department ? ' ‚Ä¢ ' + teamContext.employee.department : '')
                            ),
                            e('p', { className: 'text-blue-100 text-xs mt-1' }, 
                              (lang === 'de' ? 'Bewertungszeitraum: ' : lang === 'it' ? 'Periodo: ' : 'Assessment period: ') + teamContext.period
                            )
                          ),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'text-white/80 hover:text-white transition-colors text-2xl leading-none font-bold'
                          }, '√ó')
                        ),
                        e('div', { className: 'grid grid-cols-3 gap-3 mt-2' },
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('draft'),
                            type: 'button',
                            className: 'bg-slate-200 hover:bg-slate-300 text-slate-900 py-3 px-4 rounded-lg font-bold text-sm transition-all shadow-lg flex items-center justify-center gap-2'
                          }, 'üíæ ', lang === 'de' ? 'Entwurf speichern' : lang === 'it' ? 'Salva bozza' : 'Save Draft'),
                          e('button', {
                            onClick: () => handleSaveTeamAppraisal('completed'),
                            type: 'button',
                            className: 'bg-[#6EBD84] hover:bg-[#5da872] text-white py-3 px-4 rounded-lg font-bold text-sm transition-all shadow-lg flex items-center justify-center gap-2'
                          }, '‚úì ', lang === 'de' ? 'Abschlie√üen' : lang === 'it' ? 'Completa' : 'Complete'),
                          e('button', {
                            onClick: handleCancelTeam,
                            type: 'button',
                            className: 'border-2 border-white/40 text-white py-3 px-4 rounded-lg font-bold hover:bg-white/20 transition-all shadow-lg text-sm'
                          }, lang === 'de' ? 'Abbrechen' : lang === 'it' ? 'Annulla' : 'Cancel')
                        )
                      )
                    ),
                    
                    // === SELBSTREFLEXION VERKN√úPFUNGS-BANNER ===
                    // NUR anzeigen wenn teamContext existiert (Manager bewertet MA)
                    linkedSelfAssessment && showSelfAssessmentHint && teamContext && e('div', {
                      className: 'mt-4 p-4 bg-teal-50 border-2 border-teal-300 rounded-xl no-print',
                      'data-no-print': 'true',
                      style: { WebkitPrintColorAdjust: 'exact' }
                    },
                      e('div', { className: 'flex items-start justify-between' },
                        e('div', { className: 'flex items-center gap-3' },
                          e('div', { className: 'bg-teal-100 p-2 rounded-full' },
                            e(Users, { size: 20, className: 'text-teal-600' })
                          ),
                          e('div', null,
                            e('p', { className: 'font-bold text-teal-800' },
                              lang === 'de' ? '‚ú® Selbstreflexion verf√ºgbar!' : lang === 'it' ? '‚ú® Autovalutazione disponibile!' : '‚ú® Self-Reflection Available!'
                            ),
                            e('p', { className: 'text-sm text-teal-600' },
                              lang === 'de' 
                                ? `${linkedSelfAssessment.employeeName} hat eine Selbstreflexion eingereicht. Die Antworten werden in diesem Formular als Referenz angezeigt.`
                                : lang === 'it' ? `${linkedSelfAssessment.employeeName} ha inviato un\'autovalutazione. Le risposte vengono visualizzate come riferimento in questo modulo.`
                                : `${linkedSelfAssessment.employeeName} has submitted a self-reflection. The responses are displayed as reference in this form.`
                            ),
                            e('p', { className: 'text-xs text-teal-500 mt-1' },
                              lang === 'de' 
                                ? `Eingereicht am ${new Date(linkedSelfAssessment.submittedAt || linkedSelfAssessment.createdAt).toLocaleDateString('de-DE')}`
                                : lang === 'it' ? `Inviato il ${new Date(linkedSelfAssessment.submittedAt || linkedSelfAssessment.createdAt).toLocaleDateString('it-IT')}`
                                : `Submitted on ${new Date(linkedSelfAssessment.submittedAt || linkedSelfAssessment.createdAt).toLocaleDateString('en-GB')}`
                            )
                          )
                        ),
                        e('button', {
                          onClick: () => setShowSelfAssessmentHint(false),
                          className: 'text-teal-400 hover:text-teal-600 transition-colors'
                        }, e(X, { size: 18 }))
                      ),
                      e('div', { className: 'flex items-center justify-between mt-3' },
                        e('span', { className: 'flex items-center gap-1 text-teal-600 text-xs' },
                          e('span', { className: 'px-2 py-0.5 bg-teal-100 rounded font-medium' }, 'MA: X'),
                          lang === 'de' ? '= Selbsteinsch√§tzung des Mitarbeiters' : lang === 'it' ? '= Autovalutazione del collaboratore' : '= Employee Self-Assessment'
                        ),
                        e('div', { className: 'flex gap-2' },
                          // Refresh-Button
                          e('button', {
                            onClick: () => (teamContext?.employee?.id || teamContext?.employee?.email) && refreshLinkedSelfAssessment(teamContext.employee.id, teamContext.employee.email),
                            disabled: isRefreshingSelf,
                            className: 'px-3 py-1.5 bg-teal-100 text-teal-700 rounded-2xl hover:bg-teal-200 text-sm font-medium flex items-center gap-2 transition-colors disabled:opacity-50'
                          }, 
                            isRefreshingSelf ? e(Loader2, { size: 14, className: 'animate-spin' }) : e(RefreshCw, { size: 14 }),
                            lang === 'de' ? 'Aktualisieren' : 'Refresh'
                          ),
                          // Button zum Ansehen der kompletten Selbstreflexion - MIT AUTO-SAVE
                          e('button', {
                            onClick: () => {
                              try {
                                // AUTO-SAVE: Speichere aktuellen Formular-Stand als Entwurf
                                if (teamContext && onSaveTeam) {
                                  console.log('üíæ Auto-Save vor Wechsel zur Selbstreflexion...');
                                  
                                  const coreScoresObj = {};
                                  const coreCommentsObj = {};
                                  (coreList || []).forEach(c => {
                                    coreScoresObj[c.id] = c.rating;
                                    coreCommentsObj[c.id] = c.comment || '';
                                  });
                                  const leaderScoresObj = {};
                                  const leaderCommentsObj = {};
                                  (leadList || []).forEach(c => {
                                    leaderScoresObj[c.id] = c.rating;
                                    leaderCommentsObj[c.id] = c.comment || '';
                                  });
                                  
                                  const autoSaveData = {
                                    id: teamContext.appraisalId,
                                    type: 'review',
                                    employeeId: teamContext.employee?.id,
                                    employeeName: teamContext.employee?.name,
                                    position: teamContext.employee?.position,
                                    period: teamContext.period,
                                    status: 'draft',
                                    createdAt: teamContext.existingData?.createdAt || new Date().toISOString(),
                                    updatedAt: new Date().toISOString(),
                                    goals: goals || [],
                                    coreScores: coreScoresObj,
                                    coreComments: coreCommentsObj,
                                    leaderScores: leaderScoresObj,
                                    leaderComments: leaderCommentsObj,
                                    includeLeadership: isManager || false,
                                    wasScore: currentWasScore || 0,
                                    wieCoreScore: currentWieCoreScore || 0,
                                    wieLeaderScore: currentWieLeadScore || 0,
                                    gpsScore: currentFinalGPS || 0,
                                    formData: formData || {},
                                    careerChecks: careerChecks || [],
                                    devPlan: devPlan || []
                                  };
                                  
                                  onSaveTeam(autoSaveData);
                                  console.log('‚úÖ Auto-Save abgeschlossen');
                                }
                                
                                // Speichere R√ºckkehr-Kontext
                                localStorage.setItem('nw_return_to_appraisal', JSON.stringify({
                                  employeeId: teamContext?.employee?.id,
                                  employeeName: teamContext?.employee?.name,
                                  period: teamContext?.period,
                                  timestamp: Date.now()
                                }));
                                
                                localStorage.setItem('nw_view_self_assessment', JSON.stringify(linkedSelfAssessment));
                                
                                // Direkt zur Selbstreflexions-Ansicht wechseln
                                if (setActiveView) {
                                  setActiveView('viewSelfAssessment');
                                  console.log('‚úÖ View gewechselt zu: viewSelfAssessment');
                                } else {
                                  window.dispatchEvent(new CustomEvent('viewSelfAssessment'));
                                  console.log('‚úÖ Event dispatched: viewSelfAssessment');
                                }
                              } catch (err) {
                                console.error('‚ùå Fehler beim √ñffnen der Selbstreflexion:', err);
                                // Trotzdem versuchen die Ansicht zu √∂ffnen
                                localStorage.setItem('nw_view_self_assessment', JSON.stringify(linkedSelfAssessment));
                                if (setActiveView) {
                                  setActiveView('viewSelfAssessment');
                                } else {
                                  window.dispatchEvent(new CustomEvent('viewSelfAssessment'));
                                }
                              }
                            },
                            className: 'px-3 py-1.5 bg-teal-600 text-white rounded-2xl hover:bg-teal-700 text-sm font-medium flex items-center gap-2 transition-colors'
                          }, 
                            e(Eye, { size: 14 }),
                            lang === 'de' ? 'Vollst√§ndig ansehen' : lang === 'it' ? 'Visualizza completo' : 'View Complete'
                          )
                        )
                      )
                    ),
                    
                    // === HINWEIS: KEINE SELBSTREFLEXION VORHANDEN ===
                    // NUR anzeigen wenn: teamContext existiert UND formType 'manager'
                    !linkedSelfAssessment && showSelfAssessmentHint && teamContext && formType === 'manager' && e('div', {
                      className: 'mt-4 p-4 bg-amber-50 border-2 border-amber-200 rounded-xl no-print',
                      'data-no-print': 'true',
                      style: { WebkitPrintColorAdjust: 'exact' }
                    },
                      e('div', { className: 'flex items-start justify-between' },
                        e('div', { className: 'flex items-center gap-3' },
                          e('div', { className: 'bg-amber-100 p-2 rounded-full' },
                            e(AlertCircle, { size: 20, className: 'text-amber-600' })
                          ),
                          e('div', null,
                            e('p', { className: 'font-bold text-amber-800' },
                              lang === 'de' ? 'üìã Keine Selbstreflexion eingereicht' : lang === 'it' ? 'üìã Nessuna autovalutazione inviata' : 'üìã No Self-Reflection Submitted'
                            ),
                            e('p', { className: 'text-sm text-amber-600' },
                              lang === 'de' 
                                ? 'Der Mitarbeiter hat noch keine Selbstreflexion ausgef√ºllt. Sie k√∂nnen den Selbstreflexions-Link √ºber "Team-√úbersicht" versenden.'
                                : lang === 'it' 
                                ? 'Il collaboratore non ha ancora compilato l\'autovalutazione. Puoi inviare il link tramite "Panoramica team".'
                                : 'The employee has not yet completed a self-reflection. You can send the self-reflection link via "Team Overview".'
                            )
                          )
                        ),
                        e('button', {
                          onClick: () => setShowSelfAssessmentHint(false),
                          className: 'text-amber-400 hover:text-amber-600 transition-colors'
                        }, e(X, { size: 18 }))
                      )
                    ),
                    
                    e('h2', { className: "text-2xl font-bold", style: { color: "#243186" } }, t.headerTitle),
                    e('p', { className: "font-medium", style: { color: "#6EBD84" } }, t.headerSubtitle)
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partA),
                    e('div', { className: "no-print mb-6 bg-blue-50 p-4 rounded-lg border border-blue-200" },
                        e('span', { className: "font-bold text-sm text-blue-800 block mb-3" }, t.formType + ":"),
                        e('div', { className: "flex gap-6 mb-3" },
                            e('label', { className: "flex items-center gap-2 text-sm cursor-pointer" }, 
                                e('input', { type: "radio", checked: formType === 'self', onChange: () => setFormType('self'), name: "formType" }), 
                                t.formTypeSelf
                            ),
                            e('label', { className: "flex items-center gap-2 text-sm cursor-pointer" }, 
                                e('input', { type: "radio", checked: formType === 'manager', onChange: () => setFormType('manager'), name: "formType" }), 
                                t.formTypeManager
                            )
                        ),
                        formType === 'self' && e('div', { className: "bg-yellow-50 border border-yellow-300 p-3 rounded text-sm text-yellow-900" }, t.selfReflectionNote)
                    ),
                    e('div', { className: "hidden print:block pdf-only mb-4 p-3 bg-slate-50 border rounded" }, 
                        e('strong', null, t.formType + ": "), 
                        formType === 'self' ? t.formTypeSelf : t.formTypeManager
                    ),
                    e('div', { className: "no-print mb-6 bg-[#F4FAF7] p-3 rounded flex gap-6 items-center" },
                        e('span', { className: "font-bold text-sm text-[#4D9360]" }, t.profile + ":"),
                        e('label', { className: "flex items-center gap-2 text-sm cursor-pointer" }, e('input', { type: "radio", checked: !isManager, onChange: () => setIsManager(false) }), t.roleEmp),
                        e('label', { className: "flex items-center gap-2 text-sm cursor-pointer" }, e('input', { type: "radio", checked: isManager, onChange: () => setIsManager(true) }), t.roleMgr)
                    ),
                    e('div', { className: "hidden print:block pdf-only mb-4 font-bold" }, `${t.profile}: ${isManager ? t.roleMgr : t.roleEmp}`),
                    e('div', { className: "grid grid-cols-2 gap-6" },
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.employee), e('input', { type: "text", value: formData.employee, onChange: (ev) => handleFormChange('employee', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.manager), e('input', { type: "text", value: formData.manager, onChange: (ev) => handleFormChange('manager', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.position), e('input', { type: "text", value: formData.position, onChange: (ev) => handleFormChange('position', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" })),
                        e('div', null, e('label', { className: "text-xs text-slate-500 block" }, t.date), e('input', { type: "date", value: formData.date, onChange: (ev) => handleFormChange('date', ev.target.value), className: "w-full border-b border-slate-300 py-1 outline-none" }))
                    )
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('div', { className: "flex justify-between items-center mb-4 border-b pb-2" },
                        e('h3', { className: "text-lg font-bold text-slate-700" }, t.partB),
                        e('span', { className: "bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-bold" }, 
                            goals.length > 0 ? `Score: ${wasScore.toFixed(2)}` : (lang === 'de' ? 'Keine Ziele (nur WIE)' : lang === 'it' ? 'Nessun obiettivo (solo COME)' : 'No goals (HOW only)')
                        )
                    ),
                    // NEUER HINWEIS: Keine Ziele vorhanden
                    e('div', { className: "no-print mb-4 p-4 rounded-lg bg-amber-50 border border-amber-200" },
                        e('div', { className: "flex items-start gap-3" },
                            e(Info, { size: 20, className: "text-amber-600 mt-0.5 flex-shrink-0" }),
                            e('div', null,
                                e('p', { className: "text-sm font-semibold text-amber-800 mb-1" }, 
                                    lang === 'de' ? 'Keine Zielvereinbarung vorhanden?' : lang === 'it' ? 'Nessun accordo sugli obiettivi?' : 'No Goal Agreement found?'
                                ),
                                e('p', { className: "text-xs text-amber-700" }, 
                                    lang === 'de' 
                                        ? 'Falls f√ºr diesen Mitarbeiter keine Ziele vereinbart wurden, l√∂schen Sie bitte alle Zeilen mit dem üóëÔ∏è-Button. Der GPS wird dann automatisch nur aus Teil C (Kompetenzen = 100%) berechnet.'
                                        : 'Se non sono stati concordati obiettivi per questo collaboratore, eliminare tutte le righe con il pulsante üóëÔ∏è. Il GPS verr√† calcolato automaticamente solo dalla Parte C (Competenze = 100%).'
                                )
                            )
                        )
                    ),
                    
                    // === DESKTOP: Tabellen-Ansicht (hidden on mobile) ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm" },
                            e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, 
                                e('th', { className: "p-2 border w-1/3" }, t.goalName), 
                                e('th', { className: "p-2 border" }, t.weight), 
                                e('th', { className: "p-2 border" }, t.achievement), 
                                e('th', { className: "p-2 border" }, "BARS"),
                                e('th', { className: "p-2 border no-print w-8" }, "")
                            )),
                            e('tbody', null, goals.map(item => renderRow(item, setGoals, goals, true)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht (hidden on desktop) ===
                    e('div', { className: 'md:hidden space-y-4' },
                        goals.map((item, index) => renderGoalCardAppraisal(item, index)),
                        goals.length > 0 && e('div', { 
                            className: `mt-3 p-3 rounded-lg flex items-center justify-between ${
                                totalGoalWeight === 100 ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'
                            }`
                        },
                            e('span', { className: 'font-semibold text-sm' }, 
                                lang === 'de' ? 'Gewichtungssumme:' : lang === 'it' ? 'Somma pesi:' : 'Weight Sum:'
                            ),
                            e('span', { className: `text-xl font-bold ${totalGoalWeight === 100 ? 'text-green-700' : 'text-amber-700'}` }, 
                                `${totalGoalWeight}%`
                            )
                        )
                    ),
                    
                    e('button', { onClick: () => addItem(goals, setGoals, {name:'', weight:0, achievement:0}), className: "no-print mt-3 text-xs flex items-center gap-1 text-blue-600" }, e(PlusCircle, {size:14}), t.addGoal),
                    goals.length === 0 && e('div', { 
                        className: 'text-sm p-4 mt-3 rounded-lg bg-green-50 text-green-700 border border-green-200'
                    }, 
                        e('div', { className: "flex items-center gap-2" },
                            e(CheckCircle2, { size: 18 }),
                            e('span', { className: "font-semibold" },
                                lang === 'de' 
                                    ? '‚úì GPS wird zu 100% aus WIE-Kompetenzen berechnet'
                                    : '‚úì GPS calcolato al 100% dalle competenze COME'
                            )
                        ),
                        e('p', { className: "text-xs mt-1 ml-6" },
                            lang === 'de'
                                ? isManager 
                                    ? 'Formel: 50% Kern-Kompetenzen + 50% Leadership-Kompetenzen'
                                    : 'Formel: 100% Kern-Kompetenzen'
                                : isManager
                                    ? 'Formula: 50% Competenze Core + 50% Competenze Leadership'
                                    : 'Formula: 100% Competenze Core'
                        )
                    ),
                    goals.length > 0 && totalGoalWeight !== 100 && e('div', { 
                        className: `no-print text-sm p-3 mt-3 rounded-lg ${
                            totalGoalWeight > 100 ? 'bg-red-50 text-red-700 border border-red-200' : 
                            'bg-yellow-50 text-yellow-700 border border-yellow-200'
                        }`
                    }, 
                        `${t.totalWeight}: ${totalGoalWeight}% ${totalGoalWeight !== 100 ? `(${t.shouldBe100})` : ''}`
                    ),
                    
                    // Geplanter Bonus (100%) Feld und Berechnung
                    e('div', { className: "mt-6 pt-4 border-t border-slate-200" },
                        // Eingabefeld f√ºr geplanten Bonus
                        e('div', { className: "flex items-center gap-4 mb-4" },
                            e('label', { className: "text-sm font-semibold text-slate-700 whitespace-nowrap" }, 
                                lang === 'de' ? 'Geplanter Bonus (100%):' : lang === 'it' ? 'Bonus previsto (100%):' : 'Planned Bonus (100%):'
                            ),
                            e('div', { className: "relative w-48" },
                                e('input', { 
                                    type: "text", 
                                    value: displayBonus,
                                    onChange: (ev) => handleBonusChange(ev.target.value),
                                    placeholder: lang === 'de' ? 'z.B. 5.000' : lang === 'it' ? 'es. 5.000' : 'e.g. 5,000',
                                    className: "w-full border border-slate-300 rounded-lg px-3 py-2 pr-8 outline-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] text-right font-medium"
                                }),
                                e('span', { className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium" }, '‚Ç¨')
                            ),
                            e('span', { className: "text-xs text-slate-400" }, 
                                lang === 'de' ? '(Tausenderpunkte erlaubt)' : lang === 'it' ? '(Punti per migliaia)' : '(Thousands separators allowed)'
                            )
                        ),
                        
                        // Bonus-Berechnung anzeigen (nur wenn Bonus eingegeben)
                        plannedBonusNum > 0 && goals.length > 0 && e('div', { className: "bg-gradient-to-r from-emerald-50 to-green-50 p-4 rounded-xl border border-emerald-200" },
                            e('h4', { className: "font-bold text-emerald-800 mb-3 flex items-center gap-2" },
                                e(Calculator, { size: 18 }),
                                lang === 'de' ? 'Bonus-Berechnung' : lang === 'it' ? 'Calcolo Bonus' : 'Bonus Calculation'
                            ),
                            
                            // Tabelle mit Bonus pro Ziel
                            e('table', { className: "w-full text-sm mb-3" },
                                e('thead', { className: "bg-emerald-100/50" },
                                    e('tr', null,
                                        e('th', { className: "p-2 text-left text-emerald-800 font-semibold" }, 
                                            lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'),
                                        e('th', { className: "p-2 text-center text-emerald-800 font-semibold w-20" }, 
                                            lang === 'de' ? 'Gewicht' : lang === 'it' ? 'Peso' : 'Weight'),
                                        e('th', { className: "p-2 text-right text-emerald-800 font-semibold w-24" }, 
                                            lang === 'de' ? 'Anteil' : lang === 'it' ? 'Quota' : 'Share'),
                                        e('th', { className: "p-2 text-center text-emerald-800 font-semibold w-20" }, 
                                            lang === 'de' ? 'Erreicht' : lang === 'it' ? 'Raggiunto' : 'Achieved'),
                                        e('th', { className: "p-2 text-right text-emerald-800 font-semibold w-28" }, 
                                            lang === 'de' ? 'Auszahlung' : lang === 'it' ? 'Pagamento' : 'Payout')
                                    )
                                ),
                                e('tbody', null,
                                    bonusPerGoal.map((b, idx) => 
                                        e('tr', { key: idx, className: "border-t border-emerald-200" },
                                            e('td', { className: "p-2 text-slate-700" }, 
                                                b.goalName || `${lang === 'de' ? 'Ziel' : lang === 'it' ? 'Obiettivo' : 'Goal'} ${idx + 1}`
                                            ),
                                            e('td', { className: "p-2 text-center text-slate-600" }, `${b.weight}%`),
                                            e('td', { className: "p-2 text-right text-slate-600" }, 
                                                `${formatGermanNumber(b.goalBonus.toFixed(0))} ‚Ç¨`
                                            ),
                                            e('td', { className: "p-2 text-center" },
                                                e('span', { 
                                                    className: `px-2 py-0.5 rounded text-xs font-medium ${
                                                        b.achievement >= 100 ? 'bg-green-100 text-green-800' :
                                                        b.achievement >= 70 ? 'bg-yellow-100 text-yellow-800' :
                                                        'bg-red-100 text-red-800'
                                                    }`
                                                }, `${b.achievement}%`)
                                            ),
                                            e('td', { className: "p-2 text-right font-semibold text-emerald-700" }, 
                                                `${formatGermanNumber(b.payout.toFixed(0))} ‚Ç¨`
                                            )
                                        )
                                    )
                                )
                            ),
                            
                            // Summenzeile
                            e('div', { className: "flex justify-between items-center pt-3 border-t-2 border-emerald-300" },
                                e('div', { className: "text-sm text-emerald-800" },
                                    e('span', { className: "font-medium" }, 
                                        lang === 'de' ? 'Geplant: ' : lang === 'it' ? 'Previsto: ' : 'Planned: '
                                    ),
                                    e('span', { className: "font-bold" }, `${formatGermanNumber(plannedBonusNum.toFixed(0))} ‚Ç¨`)
                                ),
                                e('div', { className: "text-right" },
                                    e('div', { className: "text-xs text-emerald-600 mb-1" },
                                        lang === 'de' ? 'Tats√§chliche Auszahlung:' : lang === 'it' ? 'Pagamento effettivo:' : 'Actual Payout:'
                                    ),
                                    e('div', { className: "text-2xl font-black text-emerald-700" },
                                        `${formatGermanNumber(totalBonusPayout.toFixed(0))} ‚Ç¨`
                                    ),
                                    e('div', { className: `text-xs font-medium ${bonusPayoutPercentage >= 100 ? 'text-green-600' : bonusPayoutPercentage >= 70 ? 'text-yellow-600' : 'text-red-600'}` },
                                        `(${bonusPayoutPercentage.toFixed(1)}% ${lang === 'de' ? 'vom Zielbonus' : lang === 'it' ? 'del bonus target' : 'of target bonus'})`
                                    )
                                )
                            ),
                            
                            // Hinweis bei >100% Zielerreichung
                            bonusPerGoal.some(b => b.achievement > 100) && e('div', { className: "mt-3 p-2 bg-blue-50 border border-blue-200 rounded-lg text-xs text-blue-700" },
                                lang === 'de' 
                                    ? 'üí° Hinweis: Bei >100% Zielerreichung wird der Bonus auf max. 100% des Ziel-Anteils gedeckelt.'
                                    : 'üí° Nota: Con >100% di raggiungimento, il bonus √® limitato al max. 100% della quota obiettivo.'
                            )
                        )
                    )
                ),
                
                // === HALO-EFFEKT WARNUNG ===
                haloEffectWarning && e('div', { 
                  className: "bg-amber-50 border-2 border-amber-400 rounded-xl p-4 no-print",
                  'data-no-print': 'true',
                  style: { WebkitPrintColorAdjust: 'exact' }
                },
                  e('div', { className: "flex items-start gap-3" },
                    e('div', { className: "text-2xl flex-shrink-0" }, "üé≠"),
                    e('div', null,
                      e('div', { className: "font-bold text-amber-800 mb-1" }, 
                        lang === 'de' ? 'M√∂glicher Halo-Effekt' : lang === 'it' ? 'Possibile Effetto Halo' : 'Possible Halo Effect'
                      ),
                      e('div', { className: "text-sm text-amber-700" },
                        lang === 'de' 
                          ? `Alle 5 Core-Kompetenzen wurden mit Level ${coreRatings[0]} bewertet. Es ist unwahrscheinlich, dass jemand in allen Bereichen exakt gleich stark ist. Wo liegen echte St√§rken, wo Entwicklungsfelder?`
                          : lang === 'it'
                          ? `Tutte le 5 competenze core sono valutate livello ${coreRatings[0]}. √à improbabile che qualcuno sia uguale in tutte le aree. Dove sono i punti di forza, dove le aree di sviluppo?`
                          : `All 5 core competencies rated at level ${coreRatings[0]}. It's unlikely someone performs exactly the same in all areas. Where are real strengths, where development areas?`
                      )
                    )
                  )
                ),
                
                // === GAP-ANALYSE SUMMARY ===
                hasSignificantGaps && linkedSelfAssessment && e('div', { 
                  className: "bg-purple-50 border-2 border-purple-400 rounded-xl p-4 no-print",
                  'data-no-print': 'true',
                  style: { WebkitPrintColorAdjust: 'exact' }
                },
                  e('div', { className: "flex items-start gap-3" },
                    e('div', { className: "text-2xl flex-shrink-0" }, "üîç"),
                    e('div', null,
                      e('div', { className: "font-bold text-purple-800 mb-1" }, 
                        lang === 'de' 
                          ? `${Object.keys(competencyGaps).length} Wahrnehmungs-Gap${Object.keys(competencyGaps).length > 1 ? 's' : ''}`
                          : lang === 'it'
                          ? `${Object.keys(competencyGaps).length} gap di percezione`
                          : `${Object.keys(competencyGaps).length} perception gap${Object.keys(competencyGaps).length > 1 ? 's' : ''}`
                      ),
                      e('div', { className: "text-sm text-purple-700 mb-2" },
                        lang === 'de' 
                          ? 'Bei den gelb markierten Kompetenzen weicht Ihre Einsch√§tzung um >1 Stufe vom Selbstbild ab. Nutzen Sie das Gespr√§ch zum Abgleich.'
                          : lang === 'it'
                          ? 'Nelle competenze evidenziate in giallo, la valutazione differisce di >1 livello. Usi il colloquio per allineare.'
                          : 'For yellow-marked competencies, your rating differs by >1 level from self-assessment. Use the conversation to align.'
                      ),
                      e('div', { className: "text-xs text-purple-600 bg-purple-100 p-2 rounded italic" },
                        lang === 'de' 
                          ? 'üí° "K√∂nnen Sie mir ein konkretes Beispiel nennen, wo Sie das gezeigt haben?"'
                          : lang === 'it'
                          ? 'üí° "Pu√≤ darmi un esempio concreto in cui lo ha dimostrato?"'
                          : 'üí° "Can you give me a specific example where you demonstrated this?"'
                      )
                    )
                  )
                ),
                
                e('div', { className: "bg-white p-4 md:p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('div', { className: "flex justify-between items-center mb-4 border-b pb-2" },
                        e('h3', { className: "text-lg font-bold text-slate-700" }, t.partC),
                        e('span', { className: "bg-[#E8F5ED] text-[#4D9360] px-2 py-1 rounded text-xs font-bold" }, `Score: ${wieCoreScore.toFixed(2)}`)
                    ),
                    
                    // === DESKTOP: Tabellen-Ansicht ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm" },
                            e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, 
                                e('th', { className: "p-2 border" }, t.compName), 
                                e('th', { className: "p-2 border w-24" }, t.rating), 
                                e('th', { className: "p-2 border" }, t.comment)
                            )),
                            e('tbody', null, coreList.map(item => renderRow(item, setCoreList, coreList, false)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht ===
                    e('div', { className: 'md:hidden space-y-4' },
                        coreList.map(item => renderCompetencyCard(item, setCoreList, coreList, false))
                    ),
                    
                    e('button', { onClick: () => addItem(coreList, setCoreList, {name:'', weight:20, rating:3, comment:''}), className: "no-print mt-3 text-xs flex items-center gap-1 text-[#6EBD84]" }, e(PlusCircle, {size:14}), t.addComp)
                ),
                isManager && e('div', { className: "bg-white p-4 md:p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('div', { className: "flex justify-between items-center mb-4 border-b pb-2" },
                        e('h3', { className: "text-lg font-bold text-[#5CA872]" }, t.partCLead),
                        e('span', { className: "bg-[#E8F5ED] text-[#4D9360] px-2 py-1 rounded text-xs font-bold" }, `Score: ${wieLeadScore.toFixed(2)}`)
                    ),
                    
                    // === DESKTOP: Tabellen-Ansicht ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm" },
                            e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, 
                                e('th', { className: "p-2 border" }, t.compName), 
                                e('th', { className: "p-2 border w-24" }, t.rating), 
                                e('th', { className: "p-2 border" }, t.comment)
                            )),
                            e('tbody', null, leadList.map(item => renderRow(item, setLeadList, leadList, false)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht ===
                    e('div', { className: 'md:hidden space-y-4' },
                        leadList.map(item => renderCompetencyCard(item, setLeadList, leadList, true))
                    ),
                    
                    e('button', { onClick: () => addItem(leadList, setLeadList, {name:'', weight:20, rating:3, comment:''}), className: "no-print mt-3 text-xs flex items-center gap-1 text-[#6EBD84]" }, e(PlusCircle, {size:14}), t.addComp)
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partC3),
                    e('div', { className: "bg-slate-50 p-6 rounded-xl text-center border border-slate-200" },
                        e('div', { className: "text-sm text-slate-500 uppercase tracking-widest mb-2" }, "Final GPS"),
                        e('div', { className: "text-5xl font-black text-slate-800" }, finalGPS.toFixed(2)),
                        e('div', { className: "mt-2 font-medium text-[#6EBD84]" }, 
                            goals.length === 0 || totalGoalWeight === 0
                                ? (isManager 
                                    ? (lang === 'de' ? '(100% WIE: 50% Kern + 50% Leadership)' : lang === 'it' ? '(100% COME: 50% Core + 50% Leadership)' : '(100% HOW: 50% Core + 50% Leadership)')
                                    : (lang === 'de' ? '(100% WIE: Kern-Kompetenzen)' : lang === 'it' ? '(100% COME: Competenze Core)' : '(100% HOW: Core Competencies)'))
                                : (isManager 
                                    ? '(WAS 50% + WIE Core 25% + WIE Lead 25%)' 
                                    : '(WAS 50% + WIE Core 50%)')
                        ),
                        goals.length === 0 && e('div', { className: "mt-3 text-xs text-amber-600 bg-amber-50 px-3 py-1 rounded-full inline-block" },
                            lang === 'de' ? '‚ö†Ô∏è Ohne Zielvereinbarung' : lang === 'it' ? '‚ö†Ô∏è Senza accordo obiettivi' : '‚ö†Ô∏è Without Goal Agreement'
                        ),
                        // === NEU: GPS Konfidenz-Anzeige ===
                        (() => {
                          const confidence = calculateGPSConfidence(goals, coreList, leadList, isManager);
                          return e('div', { 
                            className: `mt-4 px-4 py-2 rounded-lg inline-flex items-center gap-2 no-print ${confidence.bgColor}`,
                            'data-no-print': 'true'
                          },
                            e('span', { className: confidence.color }, confidence.icon),
                            e('span', { className: `text-sm font-medium ${confidence.color}` },
                              lang === 'de' ? `Bewertungs-Vollst√§ndigkeit: ${confidence.label.de}` 
                                : lang === 'it' ? `Completezza valutazione: ${confidence.label.it}`
                                : `Assessment completeness: ${confidence.label.en}`
                            ),
                            e('span', { className: `text-xs ${confidence.color} opacity-75` }, `(${Math.round(confidence.score)}%)`)
                          );
                        })()
                    )
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partD),
                    e('div', { className: "mb-6" },
                        e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.strengthsProfessional),
                        // MA-Selbstreflexion Hinweis f√ºr St√§rken
                        linkedSelfAssessment && linkedSelfAssessment.formData?.strengths1 && e('div', { 
                          className: 'mb-2 p-3 bg-teal-50 border border-teal-200 rounded-lg text-sm no-print',
                          'data-no-print': 'true',
                          style: { WebkitPrintColorAdjust: 'exact' }
                        },
                          e('div', { className: 'flex items-center gap-2 text-teal-700 font-medium mb-1' },
                            e(Users, { size: 14 }),
                            lang === 'de' ? 'Selbsteinsch√§tzung MA (St√§rken):' : lang === 'it' ? 'Autovalutazione MA (Punti di forza):' : 'Employee Self-Assessment (Strengths):'
                          ),
                          e('p', { className: 'text-teal-600 text-xs whitespace-pre-wrap' }, 
                            linkedSelfAssessment.formData.strengths1
                          )
                        ),
                        e('textarea', { 
                          className: `w-full border rounded p-2 text-sm ${(formData.strengths1 || '').length > 1500 ? 'border-amber-400 bg-amber-50' : 'border-slate-300'}`, 
                          rows: 3, 
                          value: formData.strengths1, 
                          maxLength: 2000,
                          onChange: (ev) => handleFormChange('strengths1', ev.target.value) 
                        }),
                        e('div', { className: 'flex justify-between items-center mt-1' },
                          (formData.strengths1 || '').length > 1500 && e('span', { className: 'text-xs text-amber-600' }, 
                            lang === 'de' ? '‚ö†Ô∏è Langer Text kann im PDF umbrechen' : '‚ö†Ô∏è Testo lungo pu√≤ andare a capo nel PDF'
                          ),
                          e('span', { className: `text-xs ${(formData.strengths1 || '').length > 1500 ? 'text-amber-600' : 'text-slate-400'}` }, 
                            `${(formData.strengths1 || '').length}/2000`
                          )
                        ),
                        e('label', { className: "block text-sm font-bold mt-4 mb-1 text-slate-700" }, t.strengthsPersonal),
                        // MA-Selbstreflexion Hinweis f√ºr Entwicklungsfelder
                        linkedSelfAssessment && linkedSelfAssessment.formData?.strengths2 && e('div', { 
                          className: 'mb-2 p-3 bg-teal-50 border border-teal-200 rounded-lg text-sm no-print',
                          'data-no-print': 'true',
                          style: { WebkitPrintColorAdjust: 'exact' }
                        },
                          e('div', { className: 'flex items-center gap-2 text-teal-700 font-medium mb-1' },
                            e(Users, { size: 14 }),
                            lang === 'de' ? 'Selbsteinsch√§tzung MA (Entwicklungsfelder):' : lang === 'it' ? 'Autovalutazione MA (Aree di sviluppo):' : 'Employee Self-Assessment (Development Areas):'
                          ),
                          e('p', { className: 'text-teal-600 text-xs whitespace-pre-wrap' }, 
                            linkedSelfAssessment.formData.strengths2
                          )
                        ),
                        e('textarea', { 
                          className: `w-full border rounded p-2 text-sm ${(formData.strengths2 || '').length > 1500 ? 'border-amber-400 bg-amber-50' : 'border-slate-300'}`, 
                          rows: 3, 
                          value: formData.strengths2, 
                          maxLength: 2000,
                          onChange: (ev) => handleFormChange('strengths2', ev.target.value) 
                        }),
                        e('div', { className: 'flex justify-between items-center mt-1' },
                          (formData.strengths2 || '').length > 1500 && e('span', { className: 'text-xs text-amber-600' }, 
                            lang === 'de' ? '‚ö†Ô∏è Langer Text kann im PDF umbrechen' : '‚ö†Ô∏è Testo lungo pu√≤ andare a capo nel PDF'
                          ),
                          e('span', { className: `text-xs ${(formData.strengths2 || '').length > 1500 ? 'text-amber-600' : 'text-slate-400'}` }, 
                            `${(formData.strengths2 || '').length}/2000`
                          )
                        )
                    ),
                    // MA-W√ºnsche anzeigen (falls vorhanden)
                    linkedSelfAssessment && linkedSelfAssessment.formData?.wishesNextYear && e('div', { 
                      className: 'mb-4 p-3 bg-purple-50 border border-purple-200 rounded-lg text-sm no-print',
                      'data-no-print': 'true',
                      style: { WebkitPrintColorAdjust: 'exact' }
                    },
                      e('div', { className: 'flex items-center gap-2 text-purple-700 font-medium mb-1' },
                        e(Target, { size: 14 }),
                        lang === 'de' ? 'MA-W√ºnsche f√ºr das kommende Jahr:' : lang === 'it' ? 'Desideri del MA per l\'anno prossimo:' : 'Employee wishes for next year:'
                      ),
                      e('p', { className: 'text-purple-600 text-xs whitespace-pre-wrap' }, 
                        linkedSelfAssessment.formData.wishesNextYear
                      )
                    ),
                    // MA-Feedback an FK anzeigen (falls vorhanden) - hervorgehoben!
                    linkedSelfAssessment && linkedSelfAssessment.formData?.feedbackManager && e('div', { 
                      className: 'mb-4 p-4 bg-blue-50 border-2 border-blue-300 rounded-lg text-sm no-print',
                      'data-no-print': 'true',
                      style: { WebkitPrintColorAdjust: 'exact' }
                    },
                      e('div', { className: 'flex items-center gap-2 text-blue-800 font-bold mb-2' },
                        e(MessageCircle, { size: 16 }),
                        'üí¨ ', lang === 'de' ? 'Feedback des Mitarbeiters an Sie:' : lang === 'it' ? 'Feedback del collaboratore per Lei:' : 'Employee Feedback to You:'
                      ),
                      e('p', { className: 'text-blue-700 whitespace-pre-wrap' }, 
                        linkedSelfAssessment.formData.feedbackManager
                      )
                    ),
                    e('h4', { className: "font-bold text-slate-700 mb-2" }, t.development),
                    e('p', { className: "text-xs text-slate-500 mb-2" }, t.devIntro),
                    
                    // === DESKTOP: Tabellen-Ansicht ===
                    e('div', { className: 'hidden md:block' },
                        e('table', { className: "w-full text-sm mb-2" },
                            e('thead', { className: "bg-slate-50 text-left" }, e('tr', null, e('th', { className: "p-2 border" }, t.measure), e('th', { className: "p-2 border" }, t.responsible), e('th', { className: "p-2 border" }, t.deadline), e('th', { className: "p-2 border no-print" }, ""))),
                            e('tbody', null, devPlan.map(item => renderDevRow(item)))
                        )
                    ),
                    
                    // === MOBILE: Karten-Ansicht ===
                    e('div', { className: 'md:hidden space-y-4' },
                        devPlan.map((item, index) => renderDevCard(item, index))
                    ),
                    
                    e('button', { onClick: () => addItem(devPlan, setDevPlan, {measure:'', responsible:'', deadline:''}), className: "no-print mt-2 text-xs flex items-center gap-1 text-blue-600" }, e(PlusCircle, {size:14}), t.addDev)
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partE),
                    e('p', { className: "text-xs text-slate-500 mb-2" }, t.careerIntro),
                    e('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-2 mb-4" },
                        t.careerOptions.map((opt, i) => 
                            e('label', { key: i, className: "flex items-center gap-2 text-sm p-2 border rounded cursor-pointer hover:bg-slate-50" },
                                e('input', { type: "checkbox", checked: careerChecks[i], onChange: () => toggleCareer(i) }), opt
                            )
                        )
                    ),
                    e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.comments),
                    e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.careerComment, onChange: (ev) => handleFormChange('careerComment', ev.target.value) })
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-4 border-b pb-2" }, t.partF),
                    e('p', { className: "text-xs text-slate-500 mb-4" }, t.feedbackIntro),
                    e('div', { className: "space-y-4" },
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ1),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ1, onChange: (ev) => handleFormChange('feedbackQ1', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ2),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ2, onChange: (ev) => handleFormChange('feedbackQ2', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ3),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ3, onChange: (ev) => handleFormChange('feedbackQ3', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ4),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ4, onChange: (ev) => handleFormChange('feedbackQ4', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ5),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ5, onChange: (ev) => handleFormChange('feedbackQ5', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-1 text-slate-700" }, t.feedbackQ6),
                            e('textarea', { className: "w-full border border-slate-300 rounded p-2 text-sm", rows: 2, value: formData.feedbackQ6, onChange: (ev) => handleFormChange('feedbackQ6', ev.target.value) })
                        ),
                        e('div', null, 
                            e('label', { className: "block text-sm font-bold mb-2 text-slate-700" }, t.feedbackQ7),
                            e('div', { className: "flex gap-4" },
                                [1,2,3,4,5].map(n => 
                                    e('label', { key: n, className: "flex items-center gap-1 cursor-pointer" },
                                        e('input', { type: "radio", name: "balance", value: n, checked: formData.feedbackQ7 == n, onChange: (ev) => handleFormChange('feedbackQ7', ev.target.value) }), n
                                    )
                                )
                            )
                        )
                    )
                ),
                e('div', { className: "bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid" },
                    e('h3', { className: "text-lg font-bold text-slate-700 mb-8 border-b pb-2" }, t.partH),
                    e('div', { className: "grid grid-cols-2 gap-12" },
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.employee)),
                        e('div', null, e('div', { className: "border-b border-black h-8" }), e('p', { className: "text-xs mt-1" }, t.manager))
                    )
                )
              )
            );
            } catch (renderError) {
                console.error('AppraisalForm render error:', renderError);
                return e('div', { className: 'p-8 bg-red-50 rounded-xl border-2 border-red-300' },
                    e('h2', { className: 'text-xl font-bold text-red-700 mb-4' }, '‚ö†Ô∏è Fehler beim Laden des Formulars'),
                    e('p', { className: 'text-red-600 mb-2' }, 'Error: ' + renderError.message),
                    e('pre', { className: 'text-xs bg-red-100 p-4 rounded overflow-auto' }, renderError.stack),
                    e('button', { 
                        onClick: onCancel,
                        className: 'mt-4 px-4 py-2 bg-red-600 text-white rounded-lg'
                    }, 'Zur√ºck')
                );
            }
        };

        // === HELP CHAT / SMART HR COPILOT ===
        // === KNOWLEDGE BASE ===
        const KNOWLEDGE_BASE = {
          // A. Strategie & Werte
          strategy: {
            name: { de: 'Strategie 2035', it: 'Strategia 2035', en: 'Strategy 2035' },
            goal: { de: 'Smartest Solution Provider', it: 'Smartest Solution Provider', en: 'Smartest Solution Provider' },
            description: {
              de: 'Unser Ziel ist die Entwicklung zum "Smartest Solution Provider" bis 2035. Wir setzen auf Innovation, Nachhaltigkeit und exzellente Kundenbeziehungen.',
              it: 'Il nostro obiettivo √® diventare il "Smartest Solution Provider" entro il 2035. Puntiamo su innovazione, sostenibilit√† ed eccellenti relazioni con i clienti.',
              en: 'Our goal is to become the "Smartest Solution Provider" by 2035. We focus on innovation, sustainability, and excellent customer relationships.'
            }
          },
          values: {
            fast: {
              de: { name: 'Fast', desc: 'Wir agieren schnell und l√∂sungsorientiert. Geschwindigkeit ist ein Wettbewerbsvorteil.' },
              it: { name: 'Fast', desc: 'Agiamo velocemente e orientati alle soluzioni. La velocit√† √® un vantaggio competitivo.' },
              en: { name: 'Fast', desc: 'We act quickly and solution-oriented. Speed is a competitive advantage.' }
            },
            fair: {
              de: { name: 'Fair', desc: 'Wir arbeiten respektvoll und auf Augenh√∂he zusammen. Transparenz und Ehrlichkeit sind uns wichtig.' },
              it: { name: 'Fair', desc: 'Lavoriamo con rispetto e alla pari. Trasparenza e onest√† sono importanti per noi.' },
              en: { name: 'Fair', desc: 'We work respectfully and as equals. Transparency and honesty are important to us.' }
            },
            personal: {
              de: { name: 'Personal', desc: 'Wir √ºbernehmen Verantwortung und gestalten aktiv. Jeder Einzelne macht den Unterschied.' },
              it: { name: 'Personal', desc: 'Ci assumiamo responsabilit√† e contribuiamo attivamente. Ogni individuo fa la differenza.' },
              en: { name: 'Personal', desc: 'We take responsibility and actively contribute. Every individual makes a difference.' }
            }
          },
          
          // B. GPS-Formel
          gps: {
            formula: {
              de: 'GPS = (WAS + WIE) √∑ 2',
              it: 'GPS = (COSA + COME) √∑ 2',
              en: 'GPS = (WHAT + HOW) √∑ 2'
            },
            profiles: {
              employee: {
                de: '50% WAS (Ziele) + 50% WIE (5 Kern-Kompetenzen)',
                it: '50% COSA (Obiettivi) + 50% COME (5 Competenze Core)',
                en: '50% WHAT (Goals) + 50% HOW (5 Core Competencies)'
              },
              leader: {
                de: '50% WAS (Ziele) + 25% WIE (Kern) + 25% WIE (Leadership)',
                it: '50% COSA (Obiettivi) + 25% COME (Core) + 25% COME (Leadership)',
                en: '50% WHAT (Goals) + 25% HOW (Core) + 25% HOW (Leadership)'
              }
            },
            ratings: [
              { range: '4.51-5.00', rating: 5, name: { de: 'Outstanding', it: 'Outstanding', en: 'Outstanding' }, consequence: { de: 'Top Bonus / Gehaltssprung', it: 'Top Bonus / Aumento significativo', en: 'Top Bonus / Salary Jump' }},
              { range: '3.51-4.50', rating: 4, name: { de: 'Exceeds Expectations', it: 'Supera le aspettative', en: 'Exceeds Expectations' }, consequence: { de: 'Basis-Bonus / Erh√∂hung', it: 'Bonus base / Aumento', en: 'Base Bonus / Increase' }},
              { range: '2.51-3.50', rating: 3, name: { de: 'Meets Expectations', it: 'Soddisfa le aspettative', en: 'Meets Expectations' }, consequence: { de: 'Baseline / Standard', it: 'Baseline / Standard', en: 'Baseline / Standard' }},
              { range: '1.51-2.50', rating: 2, name: { de: 'Needs Improvement', it: 'Da migliorare', en: 'Needs Improvement' }, consequence: { de: 'PIP / Enge F√ºhrung', it: 'PIP / Supervisione stretta', en: 'PIP / Close Management' }},
              { range: '0.00-1.50', rating: 1, name: { de: 'Does Not Meet', it: 'Non soddisfa', en: 'Does Not Meet' }, consequence: { de: 'Eskalation / HR-Gespr√§ch', it: 'Escalation / Colloquio HR', en: 'Escalation / HR Meeting' }}
            ]
          },
          
          // C. Zielerreichung
          goalAchievement: {
            conversion: [
              { percent: '‚â•130%', score: 5, desc: { de: 'Herausragend √ºbertroffen', it: 'Eccezionalmente superato', en: 'Exceptionally exceeded' }},
              { percent: '111-129%', score: 4, desc: { de: 'Deutlich √ºbertroffen', it: 'Nettamente superato', en: 'Clearly exceeded' }},
              { percent: '90-110%', score: 3, desc: { de: 'Baseline erreicht ‚úì', it: 'Baseline raggiunta ‚úì', en: 'Baseline achieved ‚úì' }},
              { percent: '70-89%', score: 2, desc: { de: 'Teilweise erreicht', it: 'Parzialmente raggiunto', en: 'Partially achieved' }},
              { percent: '<70%', score: 1, desc: { de: 'Nicht erreicht', it: 'Non raggiunto', en: 'Not achieved' }}
            ]
          },
          
          // D. Kompetenzen
          competencies: {
            core: [
              { id: 'c1', key: 'fach', name: { de: 'Fachkompetenz & Anwendung', it: 'Competenza Tecnica', en: 'Technical Expertise' },
                keywords: ['fach', 'technical', 'tecnic', 'expertise', 'wissen', 'knowledge', 'qualit√§t', 'quality', 'prozess'],
                desc: { de: 'Fachwissen, Prozesssicherheit, Qualit√§t, Weitergabe von Wissen. Nicht nur Theorie, sondern praktische Anwendung!', it: 'Conoscenza tecnica, sicurezza dei processi, qualit√†, trasferimento di conoscenze.', en: 'Technical knowledge, process safety, quality, knowledge transfer.' }},
              { id: 'c2', key: 'komm', name: { de: 'Kommunikation & Zusammenarbeit', it: 'Comunicazione & Collaborazione', en: 'Communication & Collaboration' },
                keywords: ['kommunikation', 'communication', 'comunicazione', 'zusammenarbeit', 'collabor', 'team', 'one niederwieser', 'phone before email', 'silo'],
                desc: { de: '"One Niederwieser" Mindset, Silos abbauen, "Phone before Email", proaktiver Informationsfluss.', it: 'Mentalit√† "One Niederwieser", eliminare i silos, "Phone before Email", flusso informativo proattivo.', en: '"One Niederwieser" mindset, breaking silos, "Phone before Email", proactive information flow.' }},
              { id: 'c3', key: 'prob', name: { de: 'Probleml√∂sekompetenz', it: 'Capacit√† di Problem Solving', en: 'Problem Solving' },
                keywords: ['problem', 'l√∂sung', 'solution', 'soluzione', 'root cause', 'ursache', 'troubleshoot', 'analyse', 'analysis'],
                desc: { de: 'Root Cause Analysis statt nur Symptome bek√§mpfen. Eigenst√§ndigkeit bei der L√∂sungsfindung.', it: 'Root Cause Analysis invece di combattere solo i sintomi. Autonomia nella ricerca di soluzioni.', en: 'Root Cause Analysis instead of just fighting symptoms. Independence in finding solutions.' }},
              { id: 'c4', key: 'adapt', name: { de: 'Anpassungsf√§higkeit', it: 'Adattabilit√†', en: 'Adaptability' },
                keywords: ['anpass', 'adapt', 'adatt', 'change', 'ver√§nder', 'cambio', 'growth mindset', 'flexib', 'agil', 'agile', 'neu', 'new'],
                desc: { de: 'Growth Mindset, positiver Umgang mit Ver√§nderung, Bereitschaft neue Tools und Methoden zu lernen.', it: 'Growth Mindset, approccio positivo al cambiamento, disponibilit√† ad apprendere nuovi strumenti.', en: 'Growth Mindset, positive approach to change, willingness to learn new tools and methods.' }},
              { id: 'c5', key: 'orga', name: { de: 'Selbstorganisation', it: 'Auto-organizzazione', en: 'Self-Organization' },
                keywords: ['selbstorganisation', 'self-organiz', 'auto-organiz', 'priorit', 'deadline', 'zuverl√§ss', 'reliab', 'affidabil', 'struktur', 'time management'],
                desc: { de: 'Priorisierung, Einhaltung von Deadlines, Zuverl√§ssigkeit, strukturiertes Arbeiten.', it: 'Prioritizzazione, rispetto delle scadenze, affidabilit√†, lavoro strutturato.', en: 'Prioritization, meeting deadlines, reliability, structured work.' }}
            ],
            leadership: [
              { id: 'l1', key: 'lead', name: { de: 'Mitarbeiterf√ºhrung', it: 'Gestione Personale', en: 'People Management' },
                keywords: ['mitarbeiterf√ºhrung', 'people management', 'gestione personale', 'coaching', 'feedback', 'entwicklung', 'development', 'sviluppo', 'empower', 'delegation'],
                desc: { de: 'Coaching, regelm√§√üiges Feedback, Entwicklung f√∂rdern, Empowerment durch Delegation.', it: 'Coaching, feedback regolare, promuovere lo sviluppo, empowerment attraverso la delega.', en: 'Coaching, regular feedback, fostering development, empowerment through delegation.' }},
              { id: 'l2', key: 'strat', name: { de: 'Strategisches Denken', it: 'Pensiero Strategico', en: 'Strategic Thinking' },
                keywords: ['strateg', 'big picture', 'langfrist', 'long-term', 'lungo termine', 'trend', 'vision', 'zukunft', 'future', 'futuro'],
                desc: { de: 'Big Picture verstehen, langfristige Planung, Trends erkennen und antizipieren.', it: 'Capire il Big Picture, pianificazione a lungo termine, riconoscere e anticipare i trend.', en: 'Understanding the Big Picture, long-term planning, recognizing and anticipating trends.' }},
              { id: 'l3', key: 'decide', name: { de: 'Entscheidungsf√§higkeit', it: 'Capacit√† Decisionale', en: 'Decision Making' },
                keywords: ['entscheid', 'decision', 'decis', 'mut', 'courage', 'coraggio', 'risiko', 'risk', 'rischio', 'geschwindigkeit', 'speed'],
                desc: { de: 'Mut (Courage), schnelle Entscheidungen, kalkuliertes Risiko-Management.', it: 'Coraggio, decisioni rapide, gestione calcolata del rischio.', en: 'Courage, quick decisions, calculated risk management.' }},
              { id: 'l4', key: 'exec', name: { de: 'Execution', it: 'Execution', en: 'Execution' },
                keywords: ['execution', 'umsetz', 'implement', 'kpi', 'performance', 'ergebnis', 'result', 'risultato', 'deliver'],
                desc: { de: 'KPIs definieren und tracken, konsequente Umsetzung, Performance-Kultur etablieren.', it: 'Definire e tracciare KPI, implementazione coerente, stabilire una cultura della performance.', en: 'Defining and tracking KPIs, consistent implementation, establishing performance culture.' }},
              { id: 'l5', key: 'stake', name: { de: 'Stakeholder-Management', it: 'Gestione Stakeholder', en: 'Stakeholder Management' },
                keywords: ['stakeholder', 'konflikt', 'conflict', 'conflitto', 'netzwerk', 'network', 'rete', 'diplomat', 'verhandl', 'negotiat', 'negozia'],
                desc: { de: 'Konfliktl√∂sung, Netzwerke aufbauen und pflegen, diplomatisches Geschick.', it: 'Risoluzione dei conflitti, costruire e mantenere reti, abilit√† diplomatica.', en: 'Conflict resolution, building and maintaining networks, diplomatic skills.' }}
            ]
          },
          
          // E. Kalibrierung & Archetypen (mit psychologisch fundierten F√ºhrungsempfehlungen)
          calibration: {
            archetypes: {
              roleModel: { 
                name: { de: 'Role Model', it: 'Role Model', en: 'Role Model' }, 
                desc: { 
                  de: 'High WAS + High WIE. Vorbild & Leistungstr√§ger. ‚Üí Karriereperspektive kl√§ren, als Mentor einsetzen, Retention sichern!', 
                  it: 'High COSA + High COME. Modello & top performer. ‚Üí Chiarire prospettive, usare come mentor, assicurare retention!', 
                  en: 'High WHAT + High HOW. Role model & top performer. ‚Üí Clarify career path, deploy as mentor, secure retention!' 
                }
              },
              hiddenGem: { 
                name: { de: 'Hidden Gem', it: 'Hidden Gem', en: 'Hidden Gem' }, 
                desc: { 
                  de: 'Low WAS + High WIE. Tolles Verhalten, Ziele unklar. ‚Üí SMART-Ziele setzen, Quick Wins erm√∂glichen, Selbstwirksamkeit st√§rken!', 
                  it: 'Low COSA + High COME. Ottimo comportamento, obiettivi poco chiari. ‚Üí Obiettivi SMART, quick wins, rafforzare autoefficacia!', 
                  en: 'Low WHAT + High HOW. Great behavior, unclear goals. ‚Üí Set SMART goals, enable quick wins, boost self-efficacy!' 
                }
              },
              soloStar: { 
                name: { de: 'Solo Star', it: 'Solo Star', en: 'Solo Star' }, 
                desc: { 
                  de: 'High WAS + Low WIE. Ergebnisse top, Verhalten kritisch. ‚Üí Feedback zu Wirkung geben, Konsequenzen aufzeigen, Verhaltenscoaching!', 
                  it: 'High COSA + Low COME. Risultati top, comportamento critico. ‚Üí Feedback su impatto, mostrare conseguenze, coaching comportamentale!', 
                  en: 'High WHAT + Low HOW. Top results, critical behavior. ‚Üí Feedback on impact, show consequences, behavioral coaching!' 
                }
              },
              actionRequired: { 
                name: { de: 'Handlungsbedarf', it: 'Azione Richiesta', en: 'Action Required' }, 
                desc: { 
                  de: 'Low WAS + Low WIE. ‚Üí Ursache kl√§ren (K√∂nnen/Wollen/D√ºrfen), 90-Tage-Plan, w√∂chentliche Check-ins, Rollenpassung pr√ºfen.', 
                  it: 'Low COSA + Low COME. ‚Üí Chiarire causa (capacit√†/volont√†/contesto), piano 90 giorni, check-in settimanali, verificare ruolo.', 
                  en: 'Low WHAT + Low HOW. ‚Üí Clarify root cause (skill/will/context), 90-day plan, weekly check-ins, review role fit.' 
                }
              },
              solidBackbone: { 
                name: { de: 'Solid Backbone', it: 'Solid Backbone', en: 'Solid Backbone' }, 
                desc: { 
                  de: 'Rating 3 ‚Äì das R√ºckgrat! ‚Üí Wertsch√§tzung zeigen, nicht nur "Stars" loben. Stabilit√§t anerkennen, individuelle St√§rken nutzen.', 
                  it: 'Rating 3 ‚Äì la spina dorsale! ‚Üí Mostrare apprezzamento, non solo le "star". Riconoscere stabilit√†, usare punti di forza.', 
                  en: 'Rating 3 ‚Äì the backbone! ‚Üí Show appreciation, not just "stars". Recognize stability, leverage individual strengths.' 
                }
              }
            },
            killerCriteria: {
              de: 'Killer Criteria Warnung: Wenn GPS > 2.5, aber "Kommunikation" ODER "Mitarbeiterf√ºhrung" auf Level 1 bewertet wurde. Diese Kompetenzen sind kulturkritisch!',
              it: 'Avviso Killer Criteria: Se GPS > 2.5, ma "Comunicazione" O "Gestione Personale" √® valutata al livello 1. Queste competenze sono critiche per la cultura!',
              en: 'Killer Criteria Warning: If GPS > 2.5, but "Communication" OR "People Management" is rated at level 1. These competencies are culture-critical!'
            }
          }
        };
        
        // === WORKFLOW ANSWERS - Deep App Knowledge ===
        const WORKFLOW_ANSWERS = {
          selfReflection: {
            de: {
              title: 'üìù Selbstreflexion starten',
              text: `**So funktioniert's:**

1. Gehe zu **"Team-√úbersicht"** in der Navigation
2. Klicke beim Mitarbeiter auf **"üîó Selbstreflexions-Link erstellen"**
3. Der Link wird automatisch in die Zwischenablage kopiert
4. Sende den Link per E-Mail oder Teams an den MA

**Erinnerung senden:**
‚Ä¢ Klicke auf den **"Erinnern"**-Button beim eingeladenen MA
‚Ä¢ Der Link wird erneut kopiert ‚Äì sende ihn nochmals

**Wichtig:**
‚Ä¢ Der MA kann den Link **ohne Login** √∂ffnen
‚Ä¢ Er sieht NUR seine eigene Selbsteinsch√§tzung
‚Ä¢ Die Ergebnisse erscheinen automatisch in deiner Bewertung`
            },
            it: {
              title: 'üìù Avviare autovalutazione',
              text: `**Come funziona:**

1. Vai a **"Il mio Team"** nella navigazione
2. Clicca su **"üîó Crea link autovalutazione"** per il collaboratore
3. Il link viene copiato automaticamente negli appunti
4. Invia il link via email o Teams al collaboratore

**Inviare promemoria:**
‚Ä¢ Clicca sul pulsante **"Ricorda"** per il collaboratore invitato
‚Ä¢ Il link viene ricopiato ‚Äì invialo di nuovo

**Importante:**
‚Ä¢ Il collaboratore pu√≤ aprire il link **senza login**
‚Ä¢ Vede SOLO la sua autovalutazione
‚Ä¢ I risultati appaiono automaticamente nella tua valutazione`
            },
            en: {
              title: 'üìù Start Self-Reflection',
              text: `**How it works:**

1. Go to **"My Team"** in the navigation
2. Click **"üîó Create self-reflection link"** for the employee
3. The link is automatically copied to clipboard
4. Send the link via email or Teams to the employee

**Send reminder:**
‚Ä¢ Click the **"Remind"** button for the invited employee
‚Ä¢ The link is copied again ‚Äì send it once more

**Important:**
‚Ä¢ The employee can open the link **without login**
‚Ä¢ They see ONLY their self-assessment
‚Ä¢ Results automatically appear in your appraisal

üí° If an email is on file, you can also use the üìß button.`
            }
          },
          
          saveDraftVsComplete: {
            de: {
              title: 'üíæ Entwurf vs. Abschlie√üen',
              text: `**"Als Entwurf speichern" (üíæ):**
‚Ä¢ Speichert den aktuellen Stand
‚Ä¢ Bleibt **editierbar**
‚Ä¢ GPS wird vorl√§ufig berechnet
‚Ä¢ Ideal f√ºr mehrt√§gige Bewertungen

**"Bewertung abschlie√üen" (‚úÖ):**
‚Ä¢ **Fixiert** die Bewertung endg√ºltig
‚Ä¢ Berechnet den finalen GPS-Score
‚Ä¢ Danach ist **keine √Ñnderung** mehr m√∂glich
‚Ä¢ Wird in HR-Reports aufgenommen

‚ö†Ô∏è Erst abschlie√üen, wenn das Feedbackgespr√§ch gef√ºhrt wurde!`
            },
            it: {
              title: 'üíæ Bozza vs. Completare',
              text: `**"Salva come bozza" (üíæ):**
‚Ä¢ Salva lo stato attuale
‚Ä¢ Rimane **modificabile**
‚Ä¢ GPS calcolato provvisoriamente
‚Ä¢ Ideale per valutazioni su pi√π giorni

**"Completa valutazione" (‚úÖ):**
‚Ä¢ **Fissa** la valutazione definitivamente
‚Ä¢ Calcola il GPS finale
‚Ä¢ Dopo **non √® pi√π modificabile**
‚Ä¢ Viene inclusa nei report HR

‚ö†Ô∏è Completa solo dopo il colloquio di feedback!`
            },
            en: {
              title: 'üíæ Draft vs. Complete',
              text: `**"Save as Draft" (üíæ):**
‚Ä¢ Saves current progress
‚Ä¢ Remains **editable**
‚Ä¢ GPS calculated provisionally
‚Ä¢ Ideal for multi-day evaluations

**"Complete Appraisal" (‚úÖ):**
‚Ä¢ **Locks** the appraisal permanently
‚Ä¢ Calculates final GPS score
‚Ä¢ **No changes** possible afterwards
‚Ä¢ Included in HR reports

‚ö†Ô∏è Only complete after the feedback conversation!`
            }
          },
          
          excelExport: {
            de: {
              title: 'üìä Excel Export',
              text: `**So exportierst du alle Daten:**

1. Gehe zum **HR Dashboard** (nur f√ºr HR-Admins)
2. Klicke auf **"üìä Excel Export"**
3. Eine CSV-Datei wird heruntergeladen

**Enthaltene Daten:**
‚Ä¢ Alle Mitarbeiter mit GPS, WAS, WIE Scores
‚Ä¢ Einzelne Kompetenz-Scores (C1-C5, L1-L5)
‚Ä¢ Freitexte: St√§rken, Karriere-Kommentar, W√ºnsche
‚Ä¢ Feedback an FK
‚Ä¢ Status (Entwurf/Fertig) und Zeitstempel

üí° Die CSV √∂ffnet sich direkt in Excel mit korrekten Umlauten.`
            },
            it: {
              title: 'üìä Export Excel',
              text: `**Come esportare tutti i dati:**

1. Vai alla **Dashboard HR** (solo per admin HR)
2. Clicca su **"üìä Esporta Excel"**
3. Viene scaricato un file CSV

**Dati inclusi:**
‚Ä¢ Tutti i collaboratori con GPS, COSA, COME Scores
‚Ä¢ Singoli punteggi competenze (C1-C5, L1-L5)
‚Ä¢ Testi liberi: Punti di forza, Commento carriera, Desideri
‚Ä¢ Feedback al responsabile
‚Ä¢ Stato (Bozza/Completato) e timestamp

üí° Il CSV si apre direttamente in Excel con caratteri corretti.`
            },
            en: {
              title: 'üìä Excel Export',
              text: `**How to export all data:**

1. Go to **HR Dashboard** (HR admins only)
2. Click **"üìä Excel Export"**
3. A CSV file will download

**Included data:**
‚Ä¢ All employees with GPS, WHAT, HOW scores
‚Ä¢ Individual competency scores (C1-C5, L1-L5)
‚Ä¢ Free text: Strengths, Career comment, Wishes
‚Ä¢ Feedback to manager
‚Ä¢ Status (Draft/Complete) and timestamps

üí° The CSV opens directly in Excel with correct characters.`
            }
          },
          
          statusColors: {
            de: {
              title: 'üö¶ Status-Farben erkl√§rt',
              text: `**In der Team-√úbersicht:**

üü¢ **Gr√ºn** = Bewertung abgeschlossen
üü° **Gelb** = Entwurf vorhanden (in Arbeit)
‚ö™ **Grau** = Noch keine Bewertung gestartet

**In der Kalibrierung (9-Box):**

üü¢ **Gr√ºne Bubble** = Rating 4-5 (Top Performer)
üîµ **Blaue gestrichelte Zone** = Solid Backbone (Rating 3)
üü† **Orange Bubble** = Rating 2 (Entwicklungsbedarf)
üî¥ **Rote Bubble** = Rating 1 (Handlungsbedarf)

üí° Bubble-Gr√∂√üe = GPS-Score (gr√∂√üer = h√∂her)`
            },
            it: {
              title: 'üö¶ Colori di stato spiegati',
              text: `**Nella panoramica team:**

üü¢ **Verde** = Valutazione completata
üü° **Giallo** = Bozza presente (in corso)
‚ö™ **Grigio** = Nessuna valutazione iniziata

**Nella calibrazione (9-Box):**

üü¢ **Bolla verde** = Rating 4-5 (Top Performer)
üîµ **Zona tratteggiata blu** = Solid Backbone (Rating 3)
üü† **Bolla arancione** = Rating 2 (Da sviluppare)
üî¥ **Bolla rossa** = Rating 1 (Azione richiesta)

üí° Dimensione bolla = GPS Score (pi√π grande = pi√π alto)`
            },
            en: {
              title: 'üö¶ Status Colors Explained',
              text: `**In team overview:**

üü¢ **Green** = Appraisal completed
üü° **Yellow** = Draft exists (in progress)
‚ö™ **Gray** = No appraisal started yet

**In calibration (9-Box):**

üü¢ **Green bubble** = Rating 4-5 (Top Performer)
üîµ **Blue dashed zone** = Solid Backbone (Rating 3)
üü† **Orange bubble** = Rating 2 (Development needed)
üî¥ **Red bubble** = Rating 1 (Action required)

üí° Bubble size = GPS score (larger = higher)`
            }
          },
          
          barsLevels: {
            de: {
              title: 'üìè BARS-Level erkl√§rt',
              text: `**Die 5 Bewertungsstufen:**

**Level 1** ‚ùå Ungen√ºgend
Grundanforderungen nicht erf√ºllt

**Level 2** ‚ö†Ô∏è Verbesserungsw√ºrdig  
Routine ok, bei Spezialf√§llen Probleme

**Level 3** ‚úÖ Erf√ºllt Erwartungen (BASELINE)
Konstant gute Leistung - DAS IST DER STANDARD!

**Level 4** ‚≠ê √úbertrifft Erwartungen
Proaktiv, "Go-to-Person" im Team

**Level 5** üèÜ Herausragend
Gruppenweiter Impact, Rollenmodell

üí° Level 3 ist KEINE schlechte Bewertung - es ist die Baseline!`
            },
            it: {
              title: 'üìè Livelli BARS spiegati',
              text: `**I 5 livelli di valutazione:**

**Livello 1** ‚ùå Insufficiente
Requisiti base non soddisfatti

**Livello 2** ‚ö†Ô∏è Da migliorare
Routine ok, problemi con casi speciali

**Livello 3** ‚úÖ Soddisfa le aspettative (BASELINE)
Performance costante - QUESTO √à LO STANDARD!

**Livello 4** ‚≠ê Supera le aspettative
Proattivo, "Go-to-Person" nel team

**Livello 5** üèÜ Eccellente
Impatto di gruppo, Role Model

üí° Livello 3 NON √® una valutazione negativa - √® la baseline!`
            },
            en: {
              title: 'üìè BARS Levels Explained',
              text: `**The 5 rating levels:**

**Level 1** ‚ùå Unsatisfactory
Basic requirements not met

**Level 2** ‚ö†Ô∏è Needs Improvement
Routine ok, problems with special cases

**Level 3** ‚úÖ Meets Expectations (BASELINE)
Consistent good performance - THIS IS THE STANDARD!

**Level 4** ‚≠ê Exceeds Expectations
Proactive, "Go-to-Person" in team

**Level 5** üèÜ Outstanding
Group-wide impact, Role Model

üí° Level 3 is NOT a bad rating - it's the baseline!`
            }
          },
          
          nineBox: {
            de: {
              title: 'üìä 9-Box Grid erkl√§rt',
              text: `**Das Bubble Chart zeigt 4 Quadranten:**

**Oben rechts** ‚≠ê Role Model
High WAS + High WIE
‚Üí Bef√∂rdern, als Mentor einsetzen

**Oben links** üíé Hidden Gem  
Low WAS + High WIE
‚Üí Klarere Ziele setzen

**Unten rechts** üéØ Solo Star
High WAS + Low WIE
‚Üí Verhaltens-Coaching

**Unten links** üö® Handlungsbedarf
Low WAS + Low WIE
‚Üí PIP oder Rollenpassung pr√ºfen

**Mitte (gestrichelt)** üîµ Solid Backbone
Das stabile R√ºckgrat - Wertsch√§tzung zeigen!`
            },
            it: {
              title: 'üìä 9-Box Grid spiegato',
              text: `**Il Bubble Chart mostra 4 quadranti:**

**In alto a destra** ‚≠ê Role Model
High COSA + High COME
‚Üí Promuovere, usare come mentore

**In alto a sinistra** üíé Hidden Gem
Low COSA + High COME
‚Üí Obiettivi pi√π chiari

**In basso a destra** üéØ Solo Star
High COSA + Low COME
‚Üí Coaching comportamentale

**In basso a sinistra** üö® Azione richiesta
Low COSA + Low COME
‚Üí PIP o verificare ruolo

**Centro (tratteggiato)** üîµ Solid Backbone
Spina dorsale stabile - Mostrare apprezzamento!`
            },
            en: {
              title: 'üìä 9-Box Grid Explained',
              text: `**The Bubble Chart shows 4 quadrants:**

**Top right** ‚≠ê Role Model
High WHAT + High HOW
‚Üí Promote, use as mentor

**Top left** üíé Hidden Gem
Low WHAT + High HOW
‚Üí Set clearer goals

**Bottom right** üéØ Solo Star
High WHAT + Low HOW
‚Üí Behavioral coaching

**Bottom left** üö® Action Required
Low WHAT + Low HOW
‚Üí PIP or review role fit

**Center (dashed)** üîµ Solid Backbone
Stable backbone - Show appreciation!`
            }
          },
          
          smartGoals: {
            de: {
              title: 'üéØ SMART Ziele',
              text: `**Gute Ziele sind SMART:**

**S**pezifisch
Was genau soll erreicht werden?

**M**essbar  
Wie wird Erfolg gemessen? (KPI, %)

**A**ttraktiv
Ist das Ziel motivierend?

**R**ealistisch
Ist es erreichbar mit den Ressourcen?

**T**erminiert
Bis wann? (Deadline)

**Beispiel:**
‚ùå "Umsatz steigern"
‚úÖ "Umsatz in Q2 um 10% steigern durch 5 Neukunden"`
            },
            it: {
              title: 'üéØ Obiettivi SMART',
              text: `**Buoni obiettivi sono SMART:**

**S**pecifico
Cosa deve essere raggiunto esattamente?

**M**isurabile
Come viene misurato il successo? (KPI, %)

**A**ccettabile
L'obiettivo √® motivante?

**R**ealistico
√à raggiungibile con le risorse?

**T**emporizzato
Entro quando? (Scadenza)

**Esempio:**
‚ùå "Aumentare il fatturato"
‚úÖ "Aumentare il fatturato del 10% in Q2 con 5 nuovi clienti"`
            },
            en: {
              title: 'üéØ SMART Goals',
              text: `**Good goals are SMART:**

**S**pecific
What exactly should be achieved?

**M**easurable
How is success measured? (KPI, %)

**A**chievable
Is the goal motivating?

**R**ealistic
Is it achievable with resources?

**T**ime-bound
By when? (Deadline)

**Example:**
‚ùå "Increase sales"
‚úÖ "Increase Q2 sales by 10% through 5 new customers"`
            }
          },
          
          goalWeighting: {
            de: {
              title: '‚öñÔ∏è Ziel-Gewichtung',
              text: `**So funktioniert die Gewichtung:**

‚Ä¢ Jedes Ziel erh√§lt eine Gewichtung (%)
‚Ä¢ Alle Gewichtungen m√ºssen **100%** ergeben
‚Ä¢ Die Zielerreichung wird gewichtet verrechnet

**Beispiel:**
Ziel 1: 50% Gewichtung, 120% erreicht ‚Üí 60 Punkte
Ziel 2: 30% Gewichtung, 100% erreicht ‚Üí 30 Punkte  
Ziel 3: 20% Gewichtung, 80% erreicht ‚Üí 16 Punkte
**Gesamt: 106%** ‚Üí Score 3-4

üí° Wichtigere Ziele h√∂her gewichten!`
            },
            it: {
              title: '‚öñÔ∏è Ponderazione obiettivi',
              text: `**Come funziona la ponderazione:**

‚Ä¢ Ogni obiettivo riceve una ponderazione (%)
‚Ä¢ Tutte le ponderazioni devono sommare a **100%**
‚Ä¢ Il raggiungimento viene calcolato ponderato

**Esempio:**
Obiettivo 1: 50% peso, 120% raggiunto ‚Üí 60 punti
Obiettivo 2: 30% peso, 100% raggiunto ‚Üí 30 punti
Obiettivo 3: 20% peso, 80% raggiunto ‚Üí 16 punti
**Totale: 106%** ‚Üí Score 3-4

üí° Ponderare di pi√π gli obiettivi pi√π importanti!`
            },
            en: {
              title: '‚öñÔ∏è Goal Weighting',
              text: `**How weighting works:**

‚Ä¢ Each goal gets a weight (%)
‚Ä¢ All weights must total **100%**
‚Ä¢ Achievement is calculated weighted

**Example:**
Goal 1: 50% weight, 120% achieved ‚Üí 60 points
Goal 2: 30% weight, 100% achieved ‚Üí 30 points
Goal 3: 20% weight, 80% achieved ‚Üí 16 points
**Total: 106%** ‚Üí Score 3-4

üí° Weight more important goals higher!`
            }
          }
        };
        
        // === SUGGESTED CHIPS per View ===
        const VIEW_CHIPS = {
          team: [
            { de: 'üîó Link generieren?', it: 'üîó Generare link?', en: 'üîó Generate link?', query: 'selbstreflexion link' },
            { de: '‚ûï Neuer MA', it: '‚ûï Nuovo collab.', en: '‚ûï New employee', query: 'mitarbeiter anlegen' },
            { de: 'üö¶ Status Farben', it: 'üö¶ Colori stato', en: 'üö¶ Status colors', query: 'status farben' }
          ],
          zielvereinbarung: [
            { de: 'üéØ SMART Ziele', it: 'üéØ Obiettivi SMART', en: 'üéØ SMART Goals', query: 'smart ziele' },
            { de: '‚öñÔ∏è Gewichtung', it: '‚öñÔ∏è Ponderazione', en: '‚öñÔ∏è Weighting', query: 'gewichtung' },
            { de: 'üí∞ Bonus?', it: 'üí∞ Bonus?', en: 'üí∞ Bonus?', query: 'bonus gehalt' }
          ],
          teamcalibration: [
            { de: 'üìä 4 Quadranten', it: 'üìä 4 Quadranti', en: 'üìä 4 Quadrants', query: '9 box grid' },
            { de: 'üîµ Solid Backbone', it: 'üîµ Solid Backbone', en: 'üîµ Solid Backbone', query: 'solid backbone' },
            { de: '‚ö†Ô∏è Warnungen?', it: '‚ö†Ô∏è Avvisi?', en: '‚ö†Ô∏è Warnings?', query: 'killer criteria' }
          ],
          formular: [
            { de: 'üìè BARS Level', it: 'üìè Livelli BARS', en: 'üìè BARS Levels', query: 'bars level' },
            { de: 'üíæ Entwurf?', it: 'üíæ Bozza?', en: 'üíæ Draft?', query: 'entwurf speichern' },
            { de: 'üìä GPS Formel', it: 'üìä Formula GPS', en: 'üìä GPS Formula', query: 'gps formel' }
          ],
          dashboard: [
            { de: 'üöÄ Schnellstart', it: 'üöÄ Avvio rapido', en: 'üöÄ Quick start', query: 'wie starte ich' },
            { de: 'üìä GPS erkl√§rt', it: 'üìä GPS spiegato', en: 'üìä GPS explained', query: 'gps' },
            { de: 'üéØ Kompetenzen', it: 'üéØ Competenze', en: 'üéØ Competencies', query: 'kompetenzen √ºbersicht' }
          ],
          hrdashboard: [
            { de: 'üìä Excel Export', it: 'üìä Export Excel', en: 'üìä Excel Export', query: 'excel export' },
            { de: 'üìà Kalibrierung', it: 'üìà Calibrazione', en: 'üìà Calibration', query: 'kalibrierung' },
            { de: '‚ö†Ô∏è Killer Criteria', it: '‚ö†Ô∏è Killer Criteria', en: '‚ö†Ô∏è Killer Criteria', query: 'killer criteria' }
          ]
        };
        
        function HelpChat({ lang, setActiveView, activeView, setSelectedCompetencyId }) {
          const [isOpen, setIsOpen] = useState(false);
          const [messages, setMessages] = useState([]);
          const [inputValue, setInputValue] = useState('');
          const [isTyping, setIsTyping] = useState(false);
          const messagesEndRef = React.useRef(null);
          
          // Scroll to bottom when new messages arrive
          React.useEffect(() => {
            if (messagesEndRef.current) {
              messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
            }
          }, [messages]);
          
          // Kontextsensitive Willkommensnachricht
          const getWelcomeMessage = () => {
            const contextMsg = {
              team: { de: 'Du bist im Team-Bereich. Brauchst du Hilfe beim Einladen oder Link erstellen?', it: 'Sei nella sezione team. Hai bisogno di aiuto per invitare o creare link?', en: 'You\'re in the team section. Need help inviting or creating links?' },
              formular: { de: 'Du f√ºllst gerade eine Bewertung aus. Frag mich zu den BARS-Leveln!', it: 'Stai compilando una valutazione. Chiedimi dei livelli BARS!', en: 'You\'re filling out an appraisal. Ask me about BARS levels!' },
              teamcalibration: { de: 'Willkommen zur Kalibrierung! Ich erkl√§re dir gerne das 9-Box Grid.', it: 'Benvenuto alla calibrazione! Ti spiego volentieri il 9-Box Grid.', en: 'Welcome to calibration! I\'ll gladly explain the 9-Box Grid.' },
              zielvereinbarung: { de: 'Du bist bei den Zielen. Soll ich SMART erkl√§ren?', it: 'Sei negli obiettivi. Devo spiegare SMART?', en: 'You\'re in goals. Shall I explain SMART?' },
              hrdashboard: { de: 'Du bist im HR Dashboard. Ich kann dir beim Export helfen!', it: 'Sei nella Dashboard HR. Posso aiutarti con l\'export!', en: 'You\'re in the HR Dashboard. I can help with exports!' }
            };
            
            const context = contextMsg[activeView];
            const baseMsg = {
              de: 'üëã Hallo! Ich bin dein HR-Copilot.\n\n',
              it: 'üëã Ciao! Sono il tuo HR-Copilot.\n\n',
              en: 'üëã Hello! I\'m your HR Copilot.\n\n'
            };
            
            if (context) {
              return baseMsg[lang] + context[lang];
            }
            
            return baseMsg[lang] + (lang === 'de' 
              ? 'Ich kenne die App in- und auswendig. Frag mich zu:\n‚Ä¢ Workflows (Selbstreflexion, Speichern)\n‚Ä¢ GPS-Berechnung & BARS-Level\n‚Ä¢ Kompetenzen & Archetypen'
              : lang === 'it' ? 'Conosco l\'app a fondo. Chiedimi di:\n‚Ä¢ Workflow (Autovalutazione, Salvare)\n‚Ä¢ Calcolo GPS & Livelli BARS\n‚Ä¢ Competenze & Archetipi'
              : 'I know the app inside out. Ask me about:\n‚Ä¢ Workflows (Self-reflection, Saving)\n‚Ä¢ GPS calculation & BARS levels\n‚Ä¢ Competencies & Archetypes');
          };
          
          // Initial welcome message
          React.useEffect(() => {
            if (isOpen && messages.length === 0) {
              setMessages([{ type: 'bot', text: getWelcomeMessage(), actions: getQuickActions() }]);
            }
          }, [isOpen, activeView]);
          
          // Reset chat
          const resetChat = () => {
            setMessages([{ type: 'bot', text: getWelcomeMessage(), actions: getQuickActions() }]);
          };
          
          // Quick Actions
          const getQuickActions = () => [
            { label: lang === 'de' ? 'üìä GPS' : lang === 'it' ? 'üìä GPS' : 'üìä GPS', action: () => handleQuickAction('gps formel') },
            { label: lang === 'de' ? 'üìù Workflow' : lang === 'it' ? 'üìù Workflow' : 'üìù Workflow', action: () => handleQuickAction('prozess workflow') },
            { label: lang === 'de' ? 'üéØ Kompetenzen' : lang === 'it' ? 'üéØ Competenze' : 'üéØ Competencies', action: () => handleQuickAction('kompetenzen √ºbersicht') }
          ];
          
          // Get chips for current view
          const getCurrentChips = () => {
            return VIEW_CHIPS[activeView] || VIEW_CHIPS.dashboard;
          };
          
          const handleQuickAction = (query) => {
            setInputValue('');
            const userMsg = { type: 'user', text: query };
            setMessages(prev => [...prev, userMsg]);
            setIsTyping(true);
            
            setTimeout(() => {
              const response = analyzeInput(query);
              setMessages(prev => [...prev, { type: 'bot', text: response.text, actions: response.actions }]);
              setIsTyping(false);
            }, 600);
          };
          
          // Smart Brain - Analyze input with Workflow Knowledge
          const analyzeInput = (text) => {
            const input = text.toLowerCase().trim();
            const KB = KNOWLEDGE_BASE;
            const WF = WORKFLOW_ANSWERS;
            
            // === WORKFLOW: SELBSTREFLEXION ===
            if (input.match(/selbstreflexion|self.?reflect|autovalutazione|link.*send|link.*erst|einlad|invit|mitarbeiter.*perspektive/)) {
              const ans = WF.selfReflection[lang] || WF.selfReflection.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? 'üë• Zum Team' : lang === 'it' ? 'üë• Vai al team' : 'üë• Go to Team', action: () => { setActiveView('teamoverview'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: ENTWURF VS ABSCHLIESSEN ===
            if (input.match(/entwurf|draft|bozza|speicher.*unterschied|abschlie|complet|finaliz|status.*unterschied/)) {
              const ans = WF.saveDraftVsComplete[lang] || WF.saveDraftVsComplete.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === WORKFLOW: EXCEL EXPORT ===
            if (input.match(/excel|export|csv|download|herunterlad|scarica/)) {
              const ans = WF.excelExport[lang] || WF.excelExport.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? 'üìä HR Dashboard' : lang === 'it' ? 'üìä Dashboard HR' : 'üìä HR Dashboard', action: () => { setActiveView('hrdashboard'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: STATUS FARBEN ===
            if (input.match(/status.*farb|color|colori|ampel|gr√ºn|gelb|rot|verde|giallo|rosso|green|yellow|red/)) {
              const ans = WF.statusColors[lang] || WF.statusColors.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === WORKFLOW: BARS LEVEL ===
            if (input.match(/bars|level|stufe|livello|bewertungsstufe|1-5|skala|scala|scale|baseline/)) {
              const ans = WF.barsLevels[lang] || WF.barsLevels.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === WORKFLOW: 9-BOX GRID ===
            if (input.match(/9.?box|nine.?box|quadrant|bubble.*chart|grid|verteilung|distribu/)) {
              const ans = WF.nineBox[lang] || WF.nineBox.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? 'üìä Zur Kalibrierung' : lang === 'it' ? 'üìä Vai alla calibrazione' : 'üìä Go to Calibration', action: () => { setActiveView('teamcalibration'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: SMART ZIELE ===
            if (input.match(/smart|ziel.*setzen|obiettiv.*definir|goal.*set/)) {
              const ans = WF.smartGoals[lang] || WF.smartGoals.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: [{ label: lang === 'de' ? 'üìã Zielvereinbarung' : lang === 'it' ? 'üìã Obiettivi' : 'üìã Goals', action: () => { setActiveView('zielvereinbarung'); setIsOpen(false); }}]
              };
            }
            
            // === WORKFLOW: GEWICHTUNG ===
            if (input.match(/gewicht|weight|ponder|prozent.*ziel|percent.*goal/)) {
              const ans = WF.goalWeighting[lang] || WF.goalWeighting.de;
              return {
                text: `${ans.title}\n\n${ans.text}`,
                actions: []
              };
            }
            
            // === HILFE / WAS KANNST DU ===
            if (input.match(/hilfe|help|aiuto|was kannst|cosa puoi|what can|was wei√üt|wie starte|come inizi|how.*start/)) {
              return {
                text: lang === 'de' 
                  ? `üß† **Ich bin dein HR-Copilot!**\n\nIch kenne die App und alle Workflows:\n\n**üìã Prozesse:**\n‚Ä¢ Selbstreflexion starten & Link senden\n‚Ä¢ Mitarbeiter mit anderer FK teilen\n‚Ä¢ Entwurf vs. Abschlie√üen\n‚Ä¢ Excel Export\n\n**üìä Bewertung:**\n‚Ä¢ GPS-Formel & Rating-Skala\n‚Ä¢ BARS-Level (1-5)\n‚Ä¢ Alle 10 Kompetenzen\n\n**üìà Kalibrierung:**\n‚Ä¢ 9-Box Grid & 4 Archetypen\n‚Ä¢ Killer Criteria\n‚Ä¢ Status-Farben\n\n**‚ö° Strategie:**\n‚Ä¢ Strategie 2035\n‚Ä¢ Werte: Fast, Fair, Personal\n\nüí° Frag mich z.B.:\n‚Ä¢ "Wie teile ich einen Mitarbeiter?"\n‚Ä¢ "Wie sende ich den Selbstreflexions-Link?"`
                  : lang === 'it' ? `üß† **Sono il tuo HR-Copilot!**\n\nConosco l'app e tutti i workflow:\n\n**üìã Processi:**\n‚Ä¢ Avviare autovalutazione & inviare link\n‚Ä¢ Condividere collaboratore con altro manager\n‚Ä¢ Bozza vs. Completare\n‚Ä¢ Export Excel\n\n**üìä Valutazione:**\n‚Ä¢ Formula GPS & Scala Rating\n‚Ä¢ Livelli BARS (1-5)\n‚Ä¢ Tutte le 10 competenze\n\n**üìà Calibrazione:**\n‚Ä¢ 9-Box Grid & 4 Archetipi\n‚Ä¢ Killer Criteria\n‚Ä¢ Colori stato\n\n**‚ö° Strategia:**\n‚Ä¢ Strategia 2035\n‚Ä¢ Valori: Fast, Fair, Personal\n\nüí° Chiedimi ad es.:\n‚Ä¢ "Come condivido un collaboratore?"\n‚Ä¢ "Come invio il link autovalutazione?"`
                  : `üß† **I'm your HR Copilot!**\n\nI know the app and all workflows:\n\n**üìã Processes:**\n‚Ä¢ Start self-reflection & send link\n‚Ä¢ Share employee with other manager\n‚Ä¢ Draft vs. Complete\n‚Ä¢ Excel Export\n\n**üìä Evaluation:**\n‚Ä¢ GPS formula & Rating scale\n‚Ä¢ BARS levels (1-5)\n‚Ä¢ All 10 competencies\n\n**üìà Calibration:**\n‚Ä¢ 9-Box Grid & 4 Archetypes\n‚Ä¢ Killer Criteria\n‚Ä¢ Status colors\n\n**‚ö° Strategy:**\n‚Ä¢ Strategy 2035\n‚Ä¢ Values: Fast, Fair, Personal\n\nüí° Ask me e.g.:\n‚Ä¢ "How do I share an employee?"\n‚Ä¢ "How do I send the self-reflection link?"`,
                actions: getQuickActions()
              };
            }
            
            // === KONTEXT-SENSITIVIT√ÑT: Proaktive Tipps je nach View ===
            if (input.match(/tipp|tip|consiglio|wo bin ich|where am i|dove sono/)) {
              const contextTips = {
                team: { de: 'üë• **Du bist im Team-Bereich**\n\nHier kannst du:\n‚Ä¢ Mitarbeiter anlegen\n‚Ä¢ Selbstreflexions-Links erstellen\n‚Ä¢ Bewertungen starten\n\nüí° Tipp: Klicke auf "üîó" um einen Link zu generieren!', it: 'üë• **Sei nella sezione team**\n\nQui puoi:\n‚Ä¢ Creare collaboratori\n‚Ä¢ Generare link autovalutazione\n‚Ä¢ Avviare valutazioni\n\nüí° Suggerimento: Clicca "üîó" per generare un link!', en: 'üë• **You\'re in the team section**\n\nHere you can:\n‚Ä¢ Create employees\n‚Ä¢ Generate self-reflection links\n‚Ä¢ Start appraisals\n\nüí° Tip: Click "üîó" to generate a link!' },
                formular: { de: 'üìù **Du f√ºllst eine Bewertung aus**\n\nüí° Tipps:\n‚Ä¢ Level 3 ist die Baseline (nicht schlecht!)\n‚Ä¢ Nutze "Entwurf" f√ºr mehrt√§gige Bewertungen\n‚Ä¢ Konkrete Beispiele in Freitexten nennen', it: 'üìù **Stai compilando una valutazione**\n\nüí° Suggerimenti:\n‚Ä¢ Livello 3 √® la baseline (non negativo!)\n‚Ä¢ Usa "Bozza" per valutazioni su pi√π giorni\n‚Ä¢ Cita esempi concreti nei testi liberi', en: 'üìù **You\'re filling out an appraisal**\n\nüí° Tips:\n‚Ä¢ Level 3 is the baseline (not bad!)\n‚Ä¢ Use "Draft" for multi-day evaluations\n‚Ä¢ Mention concrete examples in free text' },
                teamcalibration: { de: 'üìä **Du bist in der Kalibrierung**\n\nüí° Tipps:\n‚Ä¢ Achte auf "Killer Criteria" Warnungen\n‚Ä¢ Solid Backbone (Rating 3) ist das R√ºckgrat\n‚Ä¢ Nutze die Peer-Learning Matches!', it: 'üìä **Sei nella calibrazione**\n\nüí° Suggerimenti:\n‚Ä¢ Fai attenzione agli avvisi "Killer Criteria"\n‚Ä¢ Solid Backbone (Rating 3) √® la spina dorsale\n‚Ä¢ Usa i match Peer-Learning!', en: 'üìä **You\'re in calibration**\n\nüí° Tips:\n‚Ä¢ Watch for "Killer Criteria" warnings\n‚Ä¢ Solid Backbone (Rating 3) is the backbone\n‚Ä¢ Use the Peer-Learning matches!' }
              };
              
              const tip = contextTips[activeView];
              if (tip) {
                return { text: tip[lang] || tip.de, actions: [] };
              }
            }
            
            // === BONUS / GEHALT ===
            if (input.match(/bonus|gehalt|salary|stipendio|verg√ºtung|compensation|geld|money|soldi/)) {
              const g = KB.gps;
              const ratingsText = g.ratings.map(r => `‚Ä¢ ${r.range}: **${r.name[lang] || r.name.de}** ‚Üí ${r.consequence[lang] || r.consequence.de}`).join('\n');
              return {
                text: lang === 'de' 
                  ? `üí∞ **GPS ‚Üí Verg√ºtung**\n\nDer GPS-Score ist mit der variablen Verg√ºtung verkn√ºpft:\n\n${ratingsText}\n\nüìå Die genauen Betr√§ge sind in der Compensation Policy definiert.`
                  : lang === 'it' ? `üí∞ **GPS ‚Üí Compensazione**\n\nIl GPS Score √® collegato alla retribuzione variabile:\n\n${ratingsText}\n\nüìå Gli importi esatti sono definiti nella Compensation Policy.`
                  : `üí∞ **GPS ‚Üí Compensation**\n\nThe GPS score is linked to variable compensation:\n\n${ratingsText}\n\nüìå Exact amounts are defined in the Compensation Policy.`,
                actions: [{ label: lang === 'de' ? 'üìä GPS Details' : lang === 'it' ? 'üìä Dettagli GPS' : 'üìä GPS Details', action: () => { setActiveView('gpsexplainer'); setIsOpen(false); }}]
              };
            }
            
            // === KILLER CRITERIA ===
            if (input.match(/killer|kritisch|critical|critico|warnung|warning|avviso|level 1|stufe 1/)) {
              return {
                text: lang === 'de' 
                  ? `‚ö†Ô∏è **Killer Criteria**\n\n${KB.calibration.killerCriteria.de}\n\n**Warum?**\nKommunikation und F√ºhrung sind kulturkritisch. Ein "Solo Star" mit Top-Ergebnissen aber toxischem Verhalten schadet dem Team.\n\nüìå Das System zeigt automatisch eine gelbe Warnung an.`
                  : lang === 'it' ? `‚ö†Ô∏è **Killer Criteria**\n\n${KB.calibration.killerCriteria.it}\n\n**Perch√©?**\nComunicazione e leadership sono critiche per la cultura. Un "Solo Star" con top risultati ma comportamento tossico danneggia il team.\n\nüìå Il sistema mostra automaticamente un avviso giallo.`
                  : `‚ö†Ô∏è **Killer Criteria**\n\n${KB.calibration.killerCriteria.en}\n\n**Why?**\nCommunication and leadership are culture-critical. A "Solo Star" with top results but toxic behavior harms the team.\n\nüìå The system automatically shows a yellow warning.`,
                actions: []
              };
            }
            
            // === GPS FORMEL ===
            if (input.match(/gps|berechnung|formel|calcolo|formula|calculation|score|50.*50|wie.*berechnet/)) {
              const g = KB.gps;
              return {
                text: lang === 'de' 
                  ? `üìä **GPS = Global Performance Score**\n\n**Formel:** ${g.formula.de}\n\n**Mitarbeiter:**\n${g.profiles.employee.de}\n\n**F√ºhrungskr√§fte:**\n${g.profiles.leader.de}\n\nüí° Beide Dimensionen (WAS + WIE) z√§hlen je 50%!`
                  : lang === 'it' ? `üìä **GPS = Global Performance Score**\n\n**Formula:** ${g.formula.it}\n\n**Collaboratore:**\n${g.profiles.employee.it}\n\n**Manager:**\n${g.profiles.leader.it}\n\nüí° Entrambe le dimensioni (COSA + COME) contano 50% ciascuna!`
                  : `üìä **GPS = Global Performance Score**\n\n**Formula:** ${g.formula.en}\n\n**Employee:**\n${g.profiles.employee.en}\n\n**Manager:**\n${g.profiles.leader.en}\n\nüí° Both dimensions (WHAT + HOW) count 50% each!`,
                actions: [{ label: lang === 'de' ? 'üîç GPS Explainer' : lang === 'it' ? 'üîç GPS Explainer' : 'üîç GPS Explainer', action: () => { setActiveView('gpsexplainer'); setIsOpen(false); }}]
              };
            }
            
            // === STRATEGIE 2035 ===
            if (input.match(/strategie|strategy|strategia|2035|smartest|solution provider/)) {
              return {
                text: lang === 'de' 
                  ? `üöÄ **${KB.strategy.name.de}**\n\n**Ziel:** "${KB.strategy.goal.de}"\n\n${KB.strategy.description.de}\n\nDie Strategie wird durch unsere Werte Fast, Fair, Personal gelebt.`
                  : lang === 'it' ? `üöÄ **${KB.strategy.name.it}**\n\n**Obiettivo:** "${KB.strategy.goal.it}"\n\n${KB.strategy.description.it}\n\nLa strategia viene vissuta attraverso i nostri valori Fast, Fair, Personal.`
                  : `üöÄ **${KB.strategy.name.en}**\n\n**Goal:** "${KB.strategy.goal.en}"\n\n${KB.strategy.description.en}\n\nThe strategy is lived through our values Fast, Fair, Personal.`,
                actions: [{ label: lang === 'de' ? '‚ö° Werte' : lang === 'it' ? '‚ö° Valori' : '‚ö° Values', action: () => handleQuickAction('werte') }]
              };
            }
            
            // === WERTE ===
            if (input.match(/wert|value|valor|fast|fair|personal|kultur|culture/)) {
              const v = KB.values;
              return {
                text: lang === 'de' 
                  ? `‚ö° **Unsere Werte**\n\nüèÉ **${v.fast.de.name}**\n${v.fast.de.desc}\n\n‚öñÔ∏è **${v.fair.de.name}**\n${v.fair.de.desc}\n\nüí™ **${v.personal.de.name}**\n${v.personal.de.desc}`
                  : lang === 'it' ? `‚ö° **I nostri valori**\n\nüèÉ **${v.fast.it.name}**\n${v.fast.it.desc}\n\n‚öñÔ∏è **${v.fair.it.name}**\n${v.fair.it.desc}\n\nüí™ **${v.personal.it.name}**\n${v.personal.it.desc}`
                  : `‚ö° **Our Values**\n\nüèÉ **${v.fast.en.name}**\n${v.fast.en.desc}\n\n‚öñÔ∏è **${v.fair.en.name}**\n${v.fair.en.desc}\n\nüí™ **${v.personal.en.name}**\n${v.personal.en.desc}`,
                actions: []
              };
            }
            
            // === ARCHETYPEN ===
            if (input.match(/archetyp|archetype|archetipo|role model|hidden gem|solo star|handlungsbedarf|action required|solid backbone|backbone/)) {
              const arch = KB.calibration.archetypes;
              return {
                text: lang === 'de' 
                  ? `üìà **Die 4 Archetypen + Solid Backbone**\n\n‚≠ê **Role Model:** ${arch.roleModel.desc.de}\n\nüíé **Hidden Gem:** ${arch.hiddenGem.desc.de}\n\nüéØ **Solo Star:** ${arch.soloStar.desc.de}\n\nüö® **Handlungsbedarf:** ${arch.actionRequired.desc.de}\n\n‚úÖ **Solid Backbone:** ${arch.solidBackbone.desc.de}`
                  : lang === 'it' ? `üìà **I 4 Archetipi + Solid Backbone**\n\n‚≠ê **Role Model:** ${arch.roleModel.desc.it}\n\nüíé **Hidden Gem:** ${arch.hiddenGem.desc.it}\n\nüéØ **Solo Star:** ${arch.soloStar.desc.it}\n\nüö® **Azione Richiesta:** ${arch.actionRequired.desc.it}\n\n‚úÖ **Solid Backbone:** ${arch.solidBackbone.desc.it}`
                  : `üìà **The 4 Archetypes + Solid Backbone**\n\n‚≠ê **Role Model:** ${arch.roleModel.desc.en}\n\nüíé **Hidden Gem:** ${arch.hiddenGem.desc.en}\n\nüéØ **Solo Star:** ${arch.soloStar.desc.en}\n\nüö® **Action Required:** ${arch.actionRequired.desc.en}\n\n‚úÖ **Solid Backbone:** ${arch.solidBackbone.desc.en}`,
                actions: [{ label: lang === 'de' ? 'üìä Kalibrierung' : lang === 'it' ? 'üìä Calibrazione' : 'üìä Calibration', action: () => { setActiveView('teamcalibration'); setIsOpen(false); }}]
              };
            }
            
            // === EINZELNE KOMPETENZEN ===
            const allComps = [...KB.competencies.core, ...KB.competencies.leadership];
            for (const comp of allComps) {
              if (comp.keywords.some(kw => input.includes(kw))) {
                const isLeadership = KB.competencies.leadership.includes(comp);
                return {
                  text: lang === 'de' 
                    ? `${isLeadership ? 'üëî' : 'üéØ'} **${comp.name.de}**\n${isLeadership ? '(Leadership-Kompetenz)' : '(Core-Kompetenz)'}\n\n${comp.desc.de}\n\nüìå Bewertung auf der BARS-Skala 1-5.`
                    : lang === 'it' ? `${isLeadership ? 'üëî' : 'üéØ'} **${comp.name.it}**\n${isLeadership ? '(Competenza Leadership)' : '(Competenza Core)'}\n\n${comp.desc.it}\n\nüìå Valutazione sulla scala BARS 1-5.`
                    : `${isLeadership ? 'üëî' : 'üéØ'} **${comp.name.en}**\n${isLeadership ? '(Leadership Competency)' : '(Core Competency)'}\n\n${comp.desc.en}\n\nüìå Evaluation on BARS scale 1-5.`,
                  actions: [{ 
                    label: lang === 'de' ? 'üîç Details' : lang === 'it' ? 'üîç Dettagli' : 'üîç Details', 
                    action: () => { if(setSelectedCompetencyId) setSelectedCompetencyId(comp.id); setActiveView('detail'); setIsOpen(false); }
                  }]
                };
              }
            }
            
            // === KOMPETENZEN √úBERSICHT ===
            if (input.match(/kompetenz|competenc|abilit|skill|alle|tutt|all|√ºbersicht|overview/)) {
              const coreNames = KB.competencies.core.map(c => c.name[lang] || c.name.de).join(', ');
              const leaderNames = KB.competencies.leadership.map(c => c.name[lang] || c.name.de).join(', ');
              return {
                text: lang === 'de' 
                  ? `üìö **Alle 10 Kompetenzen**\n\nüéØ **5 Core:**\n${coreNames}\n\nüëî **5 Leadership:**\n${leaderNames}\n\nFrag mich nach einer bestimmten Kompetenz!`
                  : lang === 'it' ? `üìö **Tutte le 10 Competenze**\n\nüéØ **5 Core:**\n${coreNames}\n\nüëî **5 Leadership:**\n${leaderNames}\n\nChiedimi di una competenza specifica!`
                  : `üìö **All 10 Competencies**\n\nüéØ **5 Core:**\n${coreNames}\n\nüëî **5 Leadership:**\n${leaderNames}\n\nAsk me about a specific competency!`,
                actions: [{ label: lang === 'de' ? 'üìã Liste' : lang === 'it' ? 'üìã Lista' : 'üìã List', action: () => { setActiveView('list'); setIsOpen(false); }}]
              };
            }
            
            // === PROZESS / WORKFLOW ALLGEMEIN ===
            if (input.match(/prozess|workflow|ablauf|processo|flusso|wie.*funktioniert|come.*funziona|schritt|step/)) {
              return {
                text: lang === 'de' 
                  ? `‚öôÔ∏è **Bewertungs-Workflow**\n\n**Der typische Ablauf:**\n\n1Ô∏è‚É£ **Team:** Mitarbeiter anlegen\n2Ô∏è‚É£ **Link:** Selbstreflexions-Link senden\n3Ô∏è‚É£ **Bewertung:** WAS + WIE bewerten\n4Ô∏è‚É£ **GPS:** Wird automatisch berechnet\n5Ô∏è‚É£ **Gespr√§ch:** Feedbackgespr√§ch f√ºhren\n6Ô∏è‚É£ **Abschluss:** Bewertung finalisieren\n\nüí° Frag mich zu einem Schritt f√ºr Details!`
                  : lang === 'it' ? `‚öôÔ∏è **Workflow di valutazione**\n\n**Il flusso tipico:**\n\n1Ô∏è‚É£ **Team:** Creare collaboratore\n2Ô∏è‚É£ **Link:** Inviare link autovalutazione\n3Ô∏è‚É£ **Valutazione:** Valutare COSA + COME\n4Ô∏è‚É£ **GPS:** Calcolato automaticamente\n5Ô∏è‚É£ **Colloquio:** Condurre feedback\n6Ô∏è‚É£ **Conclusione:** Finalizzare\n\nüí° Chiedimi di un passo per dettagli!`
                  : `‚öôÔ∏è **Appraisal Workflow**\n\n**The typical flow:**\n\n1Ô∏è‚É£ **Team:** Create employee\n2Ô∏è‚É£ **Link:** Send self-reflection link\n3Ô∏è‚É£ **Evaluation:** Evaluate WHAT + HOW\n4Ô∏è‚É£ **GPS:** Calculated automatically\n5Ô∏è‚É£ **Meeting:** Conduct feedback\n6Ô∏è‚É£ **Completion:** Finalize\n\nüí° Ask me about a step for details!`,
                actions: []
              };
            }
            
            // === MITARBEITER ANLEGEN ===
            if (input.match(/mitarbeiter.*anleg|collaborator.*crea|employee.*creat|neuer.*ma|nuovo.*collab|new.*employ/)) {
              return {
                text: lang === 'de' 
                  ? `‚ûï **Neuen Mitarbeiter anlegen**\n\n1. Gehe zu **"Team-√úbersicht"**\n2. Klicke auf **"‚ûï Mitarbeiter hinzuf√ºgen"**\n3. F√ºlle Name, Position, E-Mail aus\n4. W√§hle: F√ºhrungskraft? (Ja/Nein)\n\n**Automatisch erstellt:**\n‚Ä¢ Pers√∂nlicher Zugangs-Link\n‚Ä¢ Selbstreflexions-Formular\n\nüí° E-Mail ist optional, erm√∂glicht aber automatische Einladung.`
                  : lang === 'it' ? `‚ûï **Creare nuovo collaboratore**\n\n1. Vai a **"Panoramica team"**\n2. Clicca su **"‚ûï Aggiungi collaboratore"**\n3. Compila Nome, Posizione, Email\n4. Scegli: Manager? (S√¨/No)\n\n**Creato automaticamente:**\n‚Ä¢ Link di accesso personale\n‚Ä¢ Modulo autovalutazione\n\nüí° Email √® opzionale, ma permette invito automatico.`
                  : `‚ûï **Create new employee**\n\n1. Go to **"Team Overview"**\n2. Click **"‚ûï Add employee"**\n3. Fill in Name, Position, Email\n4. Choose: Manager? (Yes/No)\n\n**Automatically created:**\n‚Ä¢ Personal access link\n‚Ä¢ Self-reflection form\n\nüí° Email is optional, but enables automatic invitation.`,
                actions: [{ label: lang === 'de' ? 'üë• Zum Team' : lang === 'it' ? 'üë• Vai al team' : 'üë• Go to Team', action: () => { setActiveView('teamoverview'); setIsOpen(false); }}]
              };
            }
            
            // === MITARBEITER TEILEN ===
            if (input.match(/teilen|share|condivid|mitarbeiter.*teilen|share.*employee|condivid.*collabor|zweite.*f√ºhrung|andere.*fk|co-manage|gemeinsam.*verwalten/)) {
              return {
                text: lang === 'de' 
                  ? `üîó **Mitarbeiter mit anderer F√ºhrungskraft teilen**\n\n**So geht's:**\n\n1Ô∏è‚É£ Gehe zu **"Team-√úbersicht"**\n\n2Ô∏è‚É£ Finde den Mitarbeiter und klicke auf **"üë• Teilen"** (Share-Icon)\n\n3Ô∏è‚É£ Gib die **E-Mail-Adresse** der anderen F√ºhrungskraft ein\n\n4Ô∏è‚É£ Klicke **"Teilen & Link generieren"**\n\n5Ô∏è‚É£ **Zwei Optionen:**\n   ‚Ä¢ **"Link kopieren"** ‚Üí per Teams/WhatsApp versenden\n   ‚Ä¢ **"Per E-Mail senden"** ‚Üí √∂ffnet E-Mail-Programm mit vorausgef√ºllter Nachricht\n\n**Was passiert?**\n‚Ä¢ Die andere FK erh√§lt den Link\n‚Ä¢ Nach Login sieht sie den geteilten Mitarbeiter\n‚Ä¢ Beide FKs k√∂nnen die Beurteilung sehen und bearbeiten\n\nüí° Die andere FK muss sich mit der angegebenen E-Mail einloggen!`
                  : lang === 'it' ? `üîó **Condividere collaboratore con altro manager**\n\n**Ecco come:**\n\n1Ô∏è‚É£ Vai a **"Panoramica team"**\n\n2Ô∏è‚É£ Trova il collaboratore e clicca su **"üë• Condividi"** (icona Share)\n\n3Ô∏è‚É£ Inserisci l'**indirizzo email** dell'altro manager\n\n4Ô∏è‚É£ Clicca **"Condividi & genera link"**\n\n5Ô∏è‚É£ **Due opzioni:**\n   ‚Ä¢ **"Copia link"** ‚Üí invia via Teams/WhatsApp\n   ‚Ä¢ **"Invia via email"** ‚Üí apre programma email con messaggio precompilato\n\n**Cosa succede?**\n‚Ä¢ L'altro manager riceve il link\n‚Ä¢ Dopo login vede il collaboratore condiviso\n‚Ä¢ Entrambi possono vedere e modificare la valutazione\n\nüí° L'altro manager deve accedere con l'email specificata!`
                  : `üîó **Share employee with another manager**\n\n**Here's how:**\n\n1Ô∏è‚É£ Go to **"Team Overview"**\n\n2Ô∏è‚É£ Find the employee and click **"üë• Share"** (Share icon)\n\n3Ô∏è‚É£ Enter the **email address** of the other manager\n\n4Ô∏è‚É£ Click **"Share & Generate Link"**\n\n5Ô∏è‚É£ **Two options:**\n   ‚Ä¢ **"Copy Link"** ‚Üí send via Teams/WhatsApp\n   ‚Ä¢ **"Send via Email"** ‚Üí opens email program with pre-filled message\n\n**What happens?**\n‚Ä¢ The other manager receives the link\n‚Ä¢ After login they see the shared employee\n‚Ä¢ Both managers can view and edit the appraisal\n\nüí° The other manager must log in with the specified email!`,
                actions: [{ label: lang === 'de' ? 'üë• Zum Team' : lang === 'it' ? 'üë• Vai al team' : 'üë• Go to Team', action: () => { setActiveView('teamoverview'); setIsOpen(false); }}]
              };
            }
            
            // === SELBSTREFLEXION LINK VERSENDEN ===
            if (input.match(/selbstreflexion.*versend|selbstreflexion.*link|autovalutazione.*inviar|autovalutazione.*link|self.*reflection.*send|self.*reflection.*link|link.*senden|link.*generier|wie.*schicke.*selbst|come.*invio.*auto/)) {
              return {
                text: lang === 'de' 
                  ? `üìß **Selbstreflexions-Link an Mitarbeiter senden**\n\n**So geht's:**\n\n1Ô∏è‚É£ Gehe zu **"Team-√úbersicht"**\n\n2Ô∏è‚É£ Finde den Mitarbeiter\n\n3Ô∏è‚É£ Klicke auf das **"üîó" Symbol** (Link-Icon)\n\n4Ô∏è‚É£ Ein Link wird generiert - **zwei Optionen:**\n   ‚Ä¢ **"Link kopieren"** ‚Üí per Teams/WhatsApp versenden\n   ‚Ä¢ **"Per E-Mail senden"** ‚Üí √∂ffnet E-Mail-Programm mit vorausgef√ºllter Nachricht\n\n**Was der Mitarbeiter erh√§lt:**\n‚Ä¢ Einen personalisierten Link\n‚Ä¢ Zugang zum Selbstreflexions-Formular\n‚Ä¢ Kann alle Teile ausf√ºllen (Ziele, Kompetenzen, Feedback)\n\n**Nach dem Ausf√ºllen:**\n‚Ä¢ Die Selbstreflexion erscheint automatisch bei dir\n‚Ä¢ Du siehst sie in der Sidebar beim Beurteilungsbogen\n‚Ä¢ Du kannst sie mit der eigenen Bewertung vergleichen\n\nüí° Der Mitarbeiter braucht kein Login - der Link ist sein Zugang!`
                  : lang === 'it' ? `üìß **Inviare link autovalutazione al collaboratore**\n\n**Ecco come:**\n\n1Ô∏è‚É£ Vai a **"Panoramica team"**\n\n2Ô∏è‚É£ Trova il collaboratore\n\n3Ô∏è‚É£ Clicca sul simbolo **"üîó"** (icona Link)\n\n4Ô∏è‚É£ Viene generato un link - **due opzioni:**\n   ‚Ä¢ **"Copia link"** ‚Üí invia via Teams/WhatsApp\n   ‚Ä¢ **"Invia via email"** ‚Üí apre programma email con messaggio precompilato\n\n**Cosa riceve il collaboratore:**\n‚Ä¢ Un link personalizzato\n‚Ä¢ Accesso al modulo di autovalutazione\n‚Ä¢ Pu√≤ compilare tutte le parti (Obiettivi, Competenze, Feedback)\n\n**Dopo la compilazione:**\n‚Ä¢ L'autovalutazione appare automaticamente da te\n‚Ä¢ La vedi nella sidebar del modulo di valutazione\n‚Ä¢ Puoi confrontarla con la tua valutazione\n\nüí° Il collaboratore non ha bisogno di login - il link √® il suo accesso!`
                  : `üìß **Send self-reflection link to employee**\n\n**Here's how:**\n\n1Ô∏è‚É£ Go to **"Team Overview"**\n\n2Ô∏è‚É£ Find the employee\n\n3Ô∏è‚É£ Click the **"üîó" symbol** (Link icon)\n\n4Ô∏è‚É£ A link is generated - **two options:**\n   ‚Ä¢ **"Copy Link"** ‚Üí send via Teams/WhatsApp\n   ‚Ä¢ **"Send via Email"** ‚Üí opens email program with pre-filled message\n\n**What the employee receives:**\n‚Ä¢ A personalized link\n‚Ä¢ Access to the self-reflection form\n‚Ä¢ Can fill in all parts (Goals, Competencies, Feedback)\n\n**After completion:**\n‚Ä¢ The self-reflection appears automatically for you\n‚Ä¢ You see it in the sidebar of the appraisal form\n‚Ä¢ You can compare it with your own evaluation\n\nüí° The employee doesn't need a login - the link is their access!`,
                actions: [{ label: lang === 'de' ? 'üë• Zum Team' : lang === 'it' ? 'üë• Vai al team' : 'üë• Go to Team', action: () => { setActiveView('teamoverview'); setIsOpen(false); }}]
              };
            }
            
            // === FALLBACK ===
            return {
              text: lang === 'de' 
                ? `ü§î Dazu habe ich keine spezifische Antwort.\n\n**Versuch es mit:**\n‚Ä¢ "Selbstreflexion starten"\n‚Ä¢ "Entwurf vs. Abschlie√üen"\n‚Ä¢ "BARS Level erkl√§rt"\n‚Ä¢ "9-Box Grid"\n‚Ä¢ Name einer Kompetenz\n\nüí° Oder tippe "Hilfe" f√ºr eine √úbersicht!`
                : lang === 'it' ? `ü§î Non ho una risposta specifica.\n\n**Prova con:**\n‚Ä¢ "Avviare autovalutazione"\n‚Ä¢ "Bozza vs. Completare"\n‚Ä¢ "Livelli BARS spiegati"\n‚Ä¢ "9-Box Grid"\n‚Ä¢ Nome di una competenza\n\nüí° Oppure scrivi "Aiuto" per una panoramica!`
                : `ü§î I don't have a specific answer for that.\n\n**Try:**\n‚Ä¢ "Start self-reflection"\n‚Ä¢ "Draft vs. Complete"\n‚Ä¢ "BARS levels explained"\n‚Ä¢ "9-Box Grid"\n‚Ä¢ Name of a competency\n\nüí° Or type "Help" for an overview!`,
              actions: getQuickActions()
            };
          };
          
          // Handle send message
          const handleSend = () => {
            if (!inputValue.trim()) return;
            
            const userMsg = { type: 'user', text: inputValue };
            setMessages(prev => [...prev, userMsg]);
            setInputValue('');
            setIsTyping(true);
            
            setTimeout(() => {
              const response = analyzeInput(inputValue);
              setMessages(prev => [...prev, { type: 'bot', text: response.text, actions: response.actions }]);
              setIsTyping(false);
            }, 600);
          };
          
          const handleKeyPress = (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              handleSend();
            }
          };
          
          return React.createElement(React.Fragment, null,
            // Floating Action Button - APPLE STYLE mit Blur
            React.createElement('button', {
              onClick: () => setIsOpen(!isOpen),
              className: `fixed bottom-6 right-6 z-50 w-16 h-16 rounded-full flex items-center justify-center transition-all duration-500 ease-out ${
                isOpen 
                  ? 'bg-slate-800/90 backdrop-blur-xl rotate-180 scale-90' 
                  : 'bg-gradient-to-br from-[#243186] to-[#1a2460] hover:scale-110 hover:shadow-2xl'
              }`,
              style: { 
                boxShadow: isOpen 
                  ? '0 8px 32px rgba(0,0,0,0.3)' 
                  : '0 8px 40px rgba(36, 49, 134, 0.5), 0 0 0 4px rgba(255,255,255,0.1)',
                backdropFilter: isOpen ? 'blur(20px)' : 'none'
              }
            },
              isOpen 
                ? React.createElement(X, { size: 26, className: 'text-white' })
                : React.createElement(MessageCircle, { size: 26, className: 'text-white' })
            ),
            
            // Chat Window - Apple Style
            isOpen && React.createElement('div', {
              className: 'fixed bottom-28 right-6 z-50 w-80 md:w-96 bg-white/95 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/50 overflow-hidden',
              style: { 
                maxHeight: '70vh',
                boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255,255,255,0.1)'
              }
            },
              // Header with Reset Button
              React.createElement('div', { 
                className: 'px-5 py-4 flex items-center gap-3 border-b border-slate-100',
                style: { background: 'linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(248,250,252,1) 100%)' }
              },
                React.createElement('div', { 
                  className: 'w-11 h-11 rounded-2xl bg-gradient-to-br from-[#243186] to-[#1a2460] flex items-center justify-center shadow-lg shadow-[#243186]/30'
                },
                  React.createElement(Sparkles, { size: 20, className: 'text-white' })
                ),
                React.createElement('div', { className: 'flex-1' },
                  React.createElement('h3', { className: 'font-semibold text-slate-900 text-sm' }, 
                    lang === 'de' ? 'HR-Copilot' : lang === 'it' ? 'HR-Copilot' : 'HR Copilot'
                  ),
                  React.createElement('p', { className: 'text-xs text-slate-500' },
                    lang === 'de' ? 'Ich kenne die App!' : lang === 'it' ? 'Conosco l\'app!' : 'I know the app!'
                  )
                ),
                // Reset Button
                React.createElement('button', {
                  onClick: resetChat,
                  className: 'w-8 h-8 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors',
                  title: lang === 'de' ? 'Chat zur√ºcksetzen' : lang === 'it' ? 'Resetta chat' : 'Reset chat'
                },
                  React.createElement(RotateCcw, { size: 14, className: 'text-slate-500' })
                ),
                // Close Button
                React.createElement('button', {
                  onClick: () => setIsOpen(false),
                  className: 'w-8 h-8 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors'
                },
                  React.createElement(X, { size: 16, className: 'text-slate-500' })
                )
              ),
              
              // Messages
              React.createElement('div', { 
                className: 'p-4 space-y-3 overflow-y-auto',
                style: { maxHeight: '320px', minHeight: '180px' }
              },
                ...messages.map((msg, idx) => 
                  React.createElement('div', { 
                    key: idx,
                    className: `flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`
                  },
                    React.createElement('div', { 
                      className: `max-w-[85%] rounded-2xl px-4 py-2.5 ${msg.type === 'user' ? 'bg-slate-100 text-slate-800 rounded-br-md' : 'bg-gradient-to-br from-[#243186] to-[#3b4cad] text-white rounded-bl-md'}`
                    },
                      React.createElement('p', { 
                        className: 'text-sm whitespace-pre-line',
                        style: { lineHeight: '1.5' }
                      }, msg.text),
                      msg.actions && msg.actions.length > 0 && React.createElement('div', { className: 'mt-2 flex flex-wrap gap-1.5' },
                        ...msg.actions.map((action, i) => 
                          React.createElement('button', {
                            key: i,
                            onClick: action.action,
                            className: `px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${msg.type === 'user' ? 'bg-slate-200 text-slate-700 hover:bg-slate-300' : 'bg-white/20 text-white hover:bg-white/30'}`
                          }, action.label)
                        )
                      )
                    )
                  )
                ),
                // Typing indicator
                isTyping && React.createElement('div', { className: 'flex justify-start' },
                  React.createElement('div', { className: 'bg-slate-100 rounded-2xl rounded-bl-md px-4 py-3' },
                    React.createElement('div', { className: 'flex gap-1' },
                      React.createElement('span', { className: 'w-2 h-2 bg-slate-400 rounded-full animate-bounce', style: { animationDelay: '0ms' } }),
                      React.createElement('span', { className: 'w-2 h-2 bg-slate-400 rounded-full animate-bounce', style: { animationDelay: '150ms' } }),
                      React.createElement('span', { className: 'w-2 h-2 bg-slate-400 rounded-full animate-bounce', style: { animationDelay: '300ms' } })
                    )
                  )
                ),
                React.createElement('div', { ref: messagesEndRef })
              ),
              
              // Suggested Chips (context-aware)
              React.createElement('div', { 
                className: 'px-3 py-2 border-t border-slate-100 bg-slate-50/50 overflow-x-auto flex gap-2',
                style: { scrollbarWidth: 'none', msOverflowStyle: 'none' }
              },
                ...getCurrentChips().map((chip, idx) =>
                  React.createElement('button', {
                    key: idx,
                    onClick: () => handleQuickAction(chip.query),
                    className: 'whitespace-nowrap px-3 py-1.5 rounded-full text-xs font-medium bg-white border border-slate-200 text-slate-600 hover:bg-slate-100 hover:border-slate-300 transition-colors'
                  }, chip[lang] || chip.de)
                )
              ),
              
              // Input
              React.createElement('div', { className: 'p-3 border-t border-slate-100 bg-white' },
                React.createElement('div', { className: 'flex gap-2' },
                  React.createElement('input', {
                    type: 'text',
                    value: inputValue,
                    onChange: (e) => setInputValue(e.target.value),
                    onKeyPress: handleKeyPress,
                    placeholder: lang === 'de' ? 'Frag mich...' : lang === 'it' ? 'Chiedimi...' : 'Ask me...',
                    className: 'flex-1 px-4 py-2.5 rounded-xl border border-slate-200 text-sm focus:outline-none focus:ring-2 focus:ring-[#243186]/30 focus:border-[#243186]'
                  }),
                  React.createElement('button', {
                    onClick: handleSend,
                    disabled: !inputValue.trim(),
                    className: 'w-10 h-10 rounded-xl bg-[#6EBD84] text-white flex items-center justify-center hover:bg-[#5da872] transition-colors disabled:opacity-50 disabled:cursor-not-allowed'
                  },
                    React.createElement(Send, { size: 18 })
                  )
                )
              )
            )
          );
        }

        function PerformanceApp() {
          const [activeView, setActiveView] = useState('dashboard');

          // === FIREBASE AUTH STATE ===
          const [user, setUser] = useState(null);
          const [authLoading, setAuthLoading] = useState(true);
          const [accessCodeChecking, setAccessCodeChecking] = useState(false); // NEU: Pr√ºft ob AccessCode-Check l√§uft
          
          // === GUEST MODE STATE (f√ºr Selbstreflexion via Link) ===
          const [guestMode, setGuestMode] = useState(false);
          const [guestEmployee, setGuestEmployee] = useState(null);
          const [guestManagerId, setGuestManagerId] = useState(null); // userId der FK f√ºr Firestore-Zugriff
          
          // === GUEST FORM STATES (f√ºr Selbstreflexion-Formular) ===
          const [guestFormData, setGuestFormData] = useState({
            strengths1: '',
            strengths2: '',
            wishesNextYear: '',
            feedbackManager: '',
            additionalComments: ''
          });
          const [guestCoreScores, setGuestCoreScores] = useState({ c1: 3, c2: 3, c3: 3, c4: 3, c5: 3 });
          const [guestCoreComments, setGuestCoreComments] = useState({ c1: '', c2: '', c3: '', c4: '', c5: '' });
          const [guestFormStep, setGuestFormStep] = useState(1);
          const [guestFormSaving, setGuestFormSaving] = useState(false);
          const [guestFormSubmitted, setGuestFormSubmitted] = useState(false);
          const [guestLastAutoSave, setGuestLastAutoSave] = useState(null);
          const [guestShowDraftRecovery, setGuestShowDraftRecovery] = useState(false);
          const [guestExistingAssessment, setGuestExistingAssessment] = useState(null);
          const [guestShowDuplicateWarning, setGuestShowDuplicateWarning] = useState(false);
          
          // === IMPORT SELF-ASSESSMENT STATE ===
          const [showImportModal, setShowImportModal] = useState(false);
          const [importData, setImportData] = useState(null);
          const [importStatus, setImportStatus] = useState(null); // null, 'success', 'error'
          
          // === PENDING SELF-ASSESSMENTS STATE (f√ºr FK beim Login) ===
          const [pendingSelfAssessments, setPendingSelfAssessments] = useState([]);
          const [showPendingModal, setShowPendingModal] = useState(false);
          const [claimingPending, setClaimingPending] = useState(false);
          
          // === SHARE MODAL STATE (f√ºr Mitarbeiter teilen) ===
          const [shareModalOpen, setShareModalOpen] = useState(false);
          const [shareModalMember, setShareModalMember] = useState(null);
          const [shareModalEmail, setShareModalEmail] = useState('');
          const [shareModalLink, setShareModalLink] = useState('');
          const [shareModalStep, setShareModalStep] = useState(1); // 1 = Email eingeben, 2 = Link anzeigen
          
          // === GUEST FORM useEffects (Draft Recovery & Auto-Save) ===
          // Draft Recovery beim Laden des Guest Forms
          useEffect(() => {
            if (!guestMode || !guestEmployee) return;
            
            const draftId = `guest_${guestEmployee.id}_${new Date().getFullYear()}`;
            const loadedDraft = DraftManager.loadDraft(draftId);
            
            if (loadedDraft && loadedDraft.guestFormData) {
              setGuestShowDraftRecovery(true);
              window._tempDraft = loadedDraft;
            }
            
            // Pr√ºfe auf existierende Selbstreflexion
            const checkExisting = async () => {
              if (!db) return;
              const result = await checkExistingSelfAssessment(
                db, 
                guestEmployee.id, 
                new Date().getFullYear().toString()
              );
              if (result.exists) {
                setGuestExistingAssessment(result);
                setGuestShowDuplicateWarning(true);
              }
            };
            checkExisting();
          }, [guestMode, guestEmployee, db]);
          
          // Auto-Save f√ºr Guest Form alle 30 Sekunden
          useEffect(() => {
            if (!guestMode || !guestEmployee) return;
            
            const hasContent = guestFormData.strengths1 || guestFormData.strengths2 || 
                               guestFormData.wishesNextYear || guestFormData.feedbackManager ||
                               Object.values(guestCoreScores).some(v => v !== 3) ||
                               Object.values(guestCoreComments).some(v => v?.trim());
            
            if (!hasContent) return;
            
            const draftId = `guest_${guestEmployee.id}_${new Date().getFullYear()}`;
            const autoSaveInterval = setInterval(() => {
              DraftManager.saveDraft(draftId, {
                guestFormData,
                selfCoreScores: guestCoreScores,
                selfCoreComments: guestCoreComments,
                currentStep: guestFormStep
              });
              setGuestLastAutoSave(Date.now());
            }, 30000);
            
            return () => clearInterval(autoSaveInterval);
          }, [guestMode, guestEmployee, guestFormData, guestCoreScores, guestCoreComments, guestFormStep]);
          
          // === BUBBLE CHART TOOLTIP STATE ===
          const [bubbleTooltip, setBubbleTooltip] = useState(null);
          
          // === TEAM CALIBRATION STATES ===
          const [calibrationSort, setCalibrationSort] = useState({ field: 'name', direction: 'asc' }); // Sortierung
          const [calibrationFilter, setCalibrationFilter] = useState('all'); // 'all', 'completed', 'draft'
          const [calibrationNotes, setCalibrationNotes] = useState({}); // { reviewId: 'Notiz...' }
          const [editingNoteId, setEditingNoteId] = useState(null); // ID der gerade bearbeiteten Notiz
          
          // === MIGRATION STATE ===
          const [migrationStatus, setMigrationStatus] = useState(null); // null, 'pending', 'done', 'error'
          const [migrationResult, setMigrationResult] = useState(null); // { members: X, appraisals: Y }
          
          // === IMPORT SELF-ASSESSMENT FROM URL ===
          useEffect(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const importSelfParam = urlParams.get('import_self');
            
            if (importSelfParam) {
              try {
                const decoded = JSON.parse(decodeURIComponent(atob(importSelfParam)));
                console.log('üì• Import-Daten aus URL gefunden:', decoded);
                setImportData(decoded);
                setShowImportModal(true);
                
                // URL bereinigen (Parameter entfernen)
                const cleanUrl = window.location.href.split('?')[0];
                window.history.replaceState({}, document.title, cleanUrl);
              } catch (err) {
                console.error('‚ùå Fehler beim Dekodieren der Import-Daten:', err);
              }
            }
          }, []);
          
          // === EVENT LISTENER f√ºr View-Wechsel aus Kind-Komponenten ===
          useEffect(() => {
            const handleViewSelfAssessment = () => {
              setActiveView('viewSelfAssessment');
            };
            window.addEventListener('viewSelfAssessment', handleViewSelfAssessment);
            return () => window.removeEventListener('viewSelfAssessment', handleViewSelfAssessment);
          }, []);
          
          // === MIGRATION FUNCTION: localStorage ‚Üí Firestore ===
          // Migriert alte lokale Daten in die Cloud beim ersten Login
          const migrateLocalDataToFirebase = async (currentUser) => {
            // Guard: Nur f√ºr echte User (nicht anonym), nur wenn DB verf√ºgbar
            if (!currentUser || !db || currentUser.isAnonymous) {
              return { migrated: false, members: 0, appraisals: 0 };
            }
            
            // Check: Bereits migriert?
            const migrationKey = `nw_migrated_${currentUser.uid}`;
            if (localStorage.getItem(migrationKey)) {
              console.log('‚ÑπÔ∏è Migration bereits durchgef√ºhrt f√ºr User:', currentUser.uid);
              return { migrated: false, members: 0, appraisals: 0, reason: 'already_migrated' };
            }
            
            // Alte Daten laden
            const localMembersRaw = localStorage.getItem('nw_team_members');
            const localAppraisalsRaw = localStorage.getItem('nw_team_appraisals');
            
            const localMembers = localMembersRaw ? JSON.parse(localMembersRaw) : [];
            const localAppraisals = localAppraisalsRaw ? JSON.parse(localAppraisalsRaw) : [];
            
            // Keine Daten vorhanden?
            if (localMembers.length === 0 && localAppraisals.length === 0) {
              console.log('‚ÑπÔ∏è Keine lokalen Daten zum Migrieren gefunden.');
              localStorage.setItem(migrationKey, 'true');
              return { migrated: false, members: 0, appraisals: 0, reason: 'no_data' };
            }
            
            console.log('üîÑ Starte Migration:', localMembers.length, 'Mitarbeiter,', localAppraisals.length, 'Bewertungen');
            setMigrationStatus('pending');
            
            try {
              // Hilfsfunktion: AccessCode generieren (gleiche Logik wie in addTeamMember)
              const generateMigrationAccessCode = () => {
                if (typeof crypto !== 'undefined' && crypto.randomUUID) {
                  return crypto.randomUUID();
                }
                // Sicherer Fallback mit crypto.getRandomValues
                if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
                  const array = new Uint8Array(16);
                  crypto.getRandomValues(array);
                  const hex = Array.from(array, b => b.toString(16).padStart(2, '0')).join('');
                  return `${hex.slice(0,8)}-${hex.slice(8,12)}-${hex.slice(12,16)}-${hex.slice(16,20)}-${hex.slice(20,32)}`;
                }
                // Letzter Fallback
                return 'xxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'.replace(/x/g, () => 
                  Math.floor(Math.random() * 16).toString(16)
                );
              };
              
              // Mapping: alte lokale ID ‚Üí neue Firestore ID
              // Wichtig f√ºr die Verkn√ºpfung von Appraisals mit Mitarbeitern
              const idMapping = {};
              
              let memberCount = 0;
              let appraisalCount = 0;
              
              // === SCHRITT 1: Mitarbeiter migrieren ===
              for (const member of localMembers) {
                try {
                  const oldId = member.id;
                  
                  // Neues Dokument mit allen erforderlichen Feldern
                  const newMemberData = {
                    userId: currentUser.uid,
                    name: member.name || 'Unbekannt',
                    position: member.position || '',
                    department: member.department || '',
                    accessCode: generateMigrationAccessCode(), // NEU: F√ºr Selbstreflexions-Link
                    createdAt: member.createdAt || new Date().toISOString(),
                    migratedAt: new Date().toISOString(),
                    migratedFromLocal: true
                  };
                  
                  // In Firestore speichern
                  const docRef = await db.collection('teamMembers').add(newMemberData);
                  
                  // ID-Mapping speichern
                  idMapping[oldId] = docRef.id;
                  memberCount++;
                  
                  console.log(`  ‚úì Mitarbeiter migriert: ${member.name} (${oldId} ‚Üí ${docRef.id})`);
                } catch (memberError) {
                  console.error(`  ‚úó Fehler bei Mitarbeiter ${member.name}:`, memberError);
                }
              }
              
              // === SCHRITT 2: Bewertungen/Appraisals migrieren ===
              for (const appraisal of localAppraisals) {
                try {
                  const oldEmployeeId = appraisal.employeeId;
                  const newEmployeeId = idMapping[oldEmployeeId] || oldEmployeeId;
                  
                  // Neues Dokument mit allen erforderlichen Feldern
                  const newAppraisalData = {
                    ...appraisal, // Alle bestehenden Daten √ºbernehmen
                    userId: currentUser.uid,
                    employeeId: newEmployeeId, // Aktualisierte ID
                    type: appraisal.type || 'review', // Fallback f√ºr alte Daten ohne Typ
                    createdAt: appraisal.createdAt || new Date().toISOString(),
                    migratedAt: new Date().toISOString(),
                    migratedFromLocal: true
                  };
                  
                  // Alte lokale ID entfernen (Firestore generiert eigene)
                  delete newAppraisalData.id;
                  
                  // In Firestore speichern
                  await db.collection('teamAppraisals').add(newAppraisalData);
                  appraisalCount++;
                  
                  console.log(`  ‚úì Bewertung migriert: ${appraisal.employeeName || 'Unbekannt'} (${appraisal.type || 'review'})`);
                } catch (appraisalError) {
                  console.error(`  ‚úó Fehler bei Bewertung:`, appraisalError);
                }
              }
              
              // === SCHRITT 3: Aufr√§umen ===
              // Migration als abgeschlossen markieren (User-spezifisch)
              localStorage.setItem(migrationKey, 'true');
              
              // Alte Daten als Backup umbenennen (nicht l√∂schen, zur Sicherheit)
              if (localMembersRaw) {
                localStorage.setItem('nw_team_members_backup', localMembersRaw);
                localStorage.removeItem('nw_team_members');
              }
              if (localAppraisalsRaw) {
                localStorage.setItem('nw_team_appraisals_backup', localAppraisalsRaw);
                localStorage.removeItem('nw_team_appraisals');
              }
              
              console.log('‚úÖ Migration abgeschlossen:', memberCount, 'Mitarbeiter,', appraisalCount, 'Bewertungen');
              
              const result = { migrated: true, members: memberCount, appraisals: appraisalCount };
              setMigrationResult(result);
              setMigrationStatus('done');
              
              return result;
              
            } catch (error) {
              console.error('‚ùå Migration fehlgeschlagen:', error);
              setMigrationStatus('error');
              return { migrated: false, members: 0, appraisals: 0, error: error.message };
            }
          };
          
          // Auth State Listener (erweitert um Migration)
          // WICHTIG: Pr√ºft zuerst ob ein accessCode in der URL ist
          React.useEffect(() => {
            if (!auth) {
              setAuthLoading(false);
              return;
            }
            
            // Pr√ºfe ZUERST ob ein accessCode in der URL ist
            const params = new URLSearchParams(window.location.search);
            const hasAccessCode = params.get('accessCode');
            
            if (hasAccessCode) {
              // AccessCode vorhanden - setze Flag und warte auf checkAccessCode
              console.log('üîó AccessCode in URL erkannt, warte auf Pr√ºfung...');
              setAccessCodeChecking(true);
              // authLoading bleibt true bis checkAccessCode fertig ist
            }
            
            const unsubscribe = auth.onAuthStateChanged(async (currentUser) => {
              setUser(currentUser);
              
              // Migration beim ersten Login durchf√ºhren (nur f√ºr echte User)
              if (currentUser && !currentUser.isAnonymous && db) {
                try {
                  const result = await migrateLocalDataToFirebase(currentUser);
                  if (result.migrated && (result.members > 0 || result.appraisals > 0)) {
                    console.log('üéâ Daten erfolgreich migriert:', result);
                    // Benutzerfreundliche Erfolgsmeldung
                    setTimeout(() => {
                      const alertMsg = lang === 'en'
                        ? `‚ú® Welcome back!\n\nWe have successfully transferred your local data to the cloud:\n‚Ä¢ ${result.members} employees\n‚Ä¢ ${result.appraisals} appraisals\n\nYour data is now securely stored in Firebase and accessible from any device.`
                        : lang === 'it'
                          ? `‚ú® Bentornato!\n\nAbbiamo trasferito con successo i tuoi dati locali nel cloud:\n‚Ä¢ ${result.members} collaboratori\n‚Ä¢ ${result.appraisals} valutazioni\n\nI tuoi dati sono ora salvati in Firebase e accessibili da qualsiasi dispositivo.`
                          : `‚ú® Willkommen zur√ºck!\n\nWir haben Ihre lokalen Daten erfolgreich in die Cloud √ºbertragen:\n‚Ä¢ ${result.members} Mitarbeiter\n‚Ä¢ ${result.appraisals} Bewertungen\n\nIhre Daten sind jetzt sicher in Firebase gespeichert und von jedem Ger√§t abrufbar.`;
                      alert(alertMsg);
                    }, 500); // Kurze Verz√∂gerung damit UI fertig geladen ist
                  }
                } catch (migrationError) {
                  console.error('Migration error:', migrationError);
                }
                
                // === NEU: Pr√ºfe auf wartende Selbstreflexionen (pendingForEmail) ===
                try {
                  const userEmail = currentUser.email?.toLowerCase();
                  if (userEmail) {
                    console.log('üîç Pr√ºfe auf wartende Selbstreflexionen f√ºr:', userEmail);
                    const pendingSnapshot = await db.collection('teamAppraisals')
                      .where('pendingForEmail', '==', userEmail)
                      .where('pendingStatus', '==', 'pending_claim')
                      .get();
                    
                    if (!pendingSnapshot.empty) {
                      const pendingCount = pendingSnapshot.size;
                      const pendingDocs = pendingSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                      console.log(`üì• ${pendingCount} wartende Selbstreflexion(en) gefunden!`);
                      
                      // Speichere pending Daten f√ºr Modal
                      setPendingSelfAssessments(pendingDocs);
                      setShowPendingModal(true);
                    }
                  }
                } catch (pendingError) {
                  console.error('Fehler beim Pr√ºfen wartender Selbstreflexionen:', pendingError);
                }
              }
              
              // WICHTIG: authLoading nur auf false setzen wenn KEIN accessCode-Check l√§uft
              // Wenn accessCode vorhanden, wird authLoading von checkAccessCode gesteuert
              if (!hasAccessCode) {
                setAuthLoading(false);
              }
            });
            return () => unsubscribe();
          }, [db]);
          
          // === ACCESS CODE CHECK (f√ºr Gast-Modus via Link) ===
          // WICHTIG: Auch eingeloggte User k√∂nnen Selbstreflexion ausf√ºllen (FK ist auch MA f√ºr seinen Vorgesetzten)
          React.useEffect(() => {
            const checkAccessCode = async () => {
              const params = new URLSearchParams(window.location.search);
              const code = params.get('accessCode');
              
              if (!code) {
                // Kein AccessCode - nichts zu tun
                setAccessCodeChecking(false);
                return;
              }
              
              // Warte auf db und auth - WICHTIG: Nicht fr√ºh returnen ohne State zu setzen
              if (!db || !auth) {
                console.log('‚è≥ Warte auf Firebase... (db:', !!db, ', auth:', !!auth, ')');
                // Nicht accessCodeChecking auf false setzen - useEffect wird erneut aufgerufen wenn db/auth bereit
                return;
              }
              
              console.log('üîó AccessCode Check startet:', code);
              setAccessCodeChecking(true);
              
              try {
                // Warte kurz auf Auth-State (wichtig f√ºr anonyme Authentifizierung)
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Hole aktuellen User direkt von Firebase Auth
                let currentUser = auth.currentUser;
                
                // Wenn KEIN User eingeloggt ist ‚Üí Anonymen Login f√ºr Firestore-Zugriff
                if (!currentUser) {
                  console.log('üîê Kein User eingeloggt, starte anonyme Authentifizierung...');
                  const userCredential = await auth.signInAnonymously();
                  currentUser = userCredential.user;
                  console.log('‚úì Anonymer Login erfolgreich');
                } else {
                  console.log('‚úì User bereits eingeloggt:', currentUser.email || 'Anonym');
                }
                
                // Firestore-Query um Mitarbeiter zu finden
                console.log('üîç Suche Mitarbeiter mit accessCode...');
                const snapshot = await db.collection('teamMembers')
                  .where('accessCode', '==', code)
                  .limit(1)
                  .get();
                
                if (snapshot.empty) {
                  console.log('‚ùå Kein Mitarbeiter mit diesem accessCode gefunden:', code);
                  // Bei ung√ºltigem Code: Nur anonymen User ausloggen
                  if (currentUser?.isAnonymous) {
                    await auth.signOut();
                  }
                  alert(lang === 'de' 
                    ? 'Ung√ºltiger oder abgelaufener Link. Bitte wenden Sie sich an Ihre F√ºhrungskraft.' 
                    : lang === 'it'
                    ? 'Link non valido o scaduto. Contatta il tuo responsabile.'
                    : 'Invalid or expired link. Please contact your manager.');
                  // URL bereinigen
                  window.history.replaceState({}, document.title, window.location.pathname);
                  setAccessCodeChecking(false);
                  setAuthLoading(false);
                  return;
                }
                
                const employeeDoc = snapshot.docs[0];
                const employeeData = {
                  id: employeeDoc.id,
                  ...employeeDoc.data()
                };
                
                console.log('‚úì Mitarbeiter gefunden:', employeeData.name);
                
                // Aktiviere Gast-Modus (funktioniert auch f√ºr eingeloggte User)
                // Der "Gast-Modus" bedeutet hier: Selbstreflexions-Ansicht
                setGuestMode(true);
                setGuestEmployee(employeeData);
                setGuestManagerId(employeeData.userId); // Die userId ist die des Managers
                setActiveView('guestWelcome');
                setAccessCodeChecking(false);
                setAuthLoading(false);
                
              } catch (error) {
                console.error('‚ùå Fehler beim Laden des Mitarbeiters:', error);
                // Bei Fehler: Nur anonymen User ausloggen
                if (auth.currentUser?.isAnonymous) {
                  try { await auth.signOut(); } catch (e) { /* ignore */ }
                }
                alert(lang === 'de' 
                  ? 'Fehler beim Laden. Bitte versuchen Sie es erneut.' 
                  : lang === 'it'
                  ? 'Errore di caricamento. Riprova.'
                  : 'Error loading. Please try again.');
                window.history.replaceState({}, document.title, window.location.pathname);
                setAccessCodeChecking(false);
                setAuthLoading(false);
              }
            };
            
            checkAccessCode();
          }, [db, auth]); // Nur einmal beim Start, wenn db und auth verf√ºgbar
          
          // === TEAM STATES ===
          const [teamMembers, setTeamMembers] = useState([]);
          const [teamAppraisals, setTeamAppraisals] = useState([]);
          const [firestoreLoading, setFirestoreLoading] = useState(false);
          
          // === MEMOIZED CALIBRATION DATA (Performance-Optimierung) ===
          // Diese Berechnungen sind teuer und werden nur bei √Ñnderungen der Abh√§ngigkeiten neu berechnet
          const calibrationData = useMemo(() => {
            // Fr√ºhzeitiger Return wenn keine Daten
            if (!teamAppraisals || teamAppraisals.length === 0) {
              return { employeeData: [], teamAvg: null, allReviews: [], hasAnyLeadership: false, filteredReviews: [] };
            }
            
            const allReviews = teamAppraisals.filter(a => a.type === 'review' || !a.type);
            const hasAnyLeadership = allReviews.some(r => r.includeLeadership && r.leaderScores);
            
            // Filtere Reviews
            const filteredReviews = (() => {
              if (calibrationFilter === 'completed') return allReviews.filter(r => r.status === 'completed');
              if (calibrationFilter === 'draft') return allReviews.filter(r => r.status === 'draft' || !r.status);
              return allReviews;
            })();
            
            // Bereite Mitarbeiter-Daten auf (teure Operation)
            const employeeData = filteredReviews.map(review => {
              const member = teamMembers.find(m => m.id === review.employeeId);
              const name = review.employeeName || member?.name || 'Unknown';
              const wasScore = review.wasScore || 0;
              
              // Normalisiere Core Scores
              const rawCoreScores = review.coreScores || {};
              const coreKeys = Object.keys(rawCoreScores);
              const coreValues = Object.values(rawCoreScores).filter(v => typeof v === 'number' && v > 0);
              const isNumericKeys = coreKeys.length > 0 && coreKeys.every(k => !isNaN(parseFloat(k)));
              
              let coreScores;
              if (isNumericKeys && coreValues.length >= 5) {
                const sortedKeys = coreKeys.sort();
                coreScores = { fach: rawCoreScores[sortedKeys[0]] || 0, komm: rawCoreScores[sortedKeys[1]] || 0, prob: rawCoreScores[sortedKeys[2]] || 0, adapt: rawCoreScores[sortedKeys[3]] || 0, orga: rawCoreScores[sortedKeys[4]] || 0 };
              } else {
                coreScores = { fach: rawCoreScores.fach || rawCoreScores.c1 || 0, komm: rawCoreScores.komm || rawCoreScores.c2 || 0, prob: rawCoreScores.prob || rawCoreScores.c3 || 0, adapt: rawCoreScores.adapt || rawCoreScores.c4 || 0, orga: rawCoreScores.orga || rawCoreScores.c5 || 0 };
              }
              
              // Normalisiere Leader Scores
              const rawLeaderScores = review.leaderScores || {};
              const leaderKeys = Object.keys(rawLeaderScores);
              const leaderValues = Object.values(rawLeaderScores).filter(v => typeof v === 'number' && v > 0);
              const isNumericLeaderKeys = leaderKeys.length > 0 && leaderKeys.every(k => !isNaN(parseFloat(k)));
              
              let leaderScores;
              if (isNumericLeaderKeys && leaderValues.length >= 5) {
                const sortedKeys = leaderKeys.sort();
                leaderScores = { lead: rawLeaderScores[sortedKeys[0]] || 0, strat: rawLeaderScores[sortedKeys[1]] || 0, decide: rawLeaderScores[sortedKeys[2]] || 0, exec: rawLeaderScores[sortedKeys[3]] || 0, stake: rawLeaderScores[sortedKeys[4]] || 0 };
              } else {
                leaderScores = { lead: rawLeaderScores.lead || rawLeaderScores.l1 || 0, strat: rawLeaderScores.strat || rawLeaderScores.l2 || 0, decide: rawLeaderScores.decide || rawLeaderScores.l3 || 0, exec: rawLeaderScores.exec || rawLeaderScores.l4 || 0, stake: rawLeaderScores.stake || rawLeaderScores.l5 || 0 };
              }
              
              // WIE Durchschnitt
              const allWieScores = [...Object.values(coreScores).filter(v => v > 0), ...(review.includeLeadership ? Object.values(leaderScores).filter(v => v > 0) : [])];
              const wieAvg = allWieScores.length > 0 ? allWieScores.reduce((s, v) => s + v, 0) / allWieScores.length : 0;
              
              return { id: review.id, employeeId: review.employeeId, name, status: review.status, gps: review.gpsScore || 0, wasScore, wieAvg, coreScores, leaderScores, includeLeadership: review.includeLeadership };
            })
            // Sortierung
            .sort((a, b) => {
              let comparison = 0;
              switch (calibrationSort.field) {
                case 'name': comparison = a.name.localeCompare(b.name); break;
                case 'gps': comparison = a.gps - b.gps; break;
                case 'was': comparison = a.wasScore - b.wasScore; break;
                case 'wie': comparison = a.wieAvg - b.wieAvg; break;
                default: comparison = a.name.localeCompare(b.name);
              }
              return calibrationSort.direction === 'desc' ? -comparison : comparison;
            });
            
            // Team-Durchschnitte (teure Operation)
            const calcAvg = (arr) => arr.length > 0 ? arr.reduce((s, v) => s + v, 0) / arr.length : 0;
            const coreCompIds = ['fach', 'komm', 'prob', 'adapt', 'orga'];
            const leaderCompIds = ['lead', 'strat', 'decide', 'exec', 'stake'];
            
            const teamAvg = {
              gps: calcAvg(employeeData.map(e => e.gps).filter(v => v > 0)),
              was: calcAvg(employeeData.map(e => e.wasScore).filter(v => v > 0)),
              wie: calcAvg(employeeData.map(e => e.wieAvg).filter(v => v > 0)),
              core: {},
              leader: {}
            };
            
            coreCompIds.forEach(id => { teamAvg.core[id] = calcAvg(employeeData.map(e => e.coreScores[id]).filter(v => v > 0)); });
            if (hasAnyLeadership) {
              leaderCompIds.forEach(id => { teamAvg.leader[id] = calcAvg(employeeData.filter(e => e.includeLeadership).map(e => e.leaderScores[id]).filter(v => v > 0)); });
            }
            
            return { employeeData, teamAvg, allReviews, hasAnyLeadership, filteredReviews };
          }, [teamAppraisals, teamMembers, calibrationFilter, calibrationSort]);
          
          // === MEMOIZED PEER-LEARNING MATCHES (Performance-Optimierung) ===
          const peerLearningMatches = useMemo(() => {
            const { employeeData, hasAnyLeadership } = calibrationData;
            if (!employeeData || employeeData.length < 2) return [];
            
            const coreCompIds = ['fach', 'komm', 'prob', 'adapt', 'orga'];
            const leaderCompIds = ['lead', 'strat', 'decide', 'exec', 'stake'];
            const allCompIds = [...coreCompIds, ...(hasAnyLeadership ? leaderCompIds : [])];
            
            const allMatches = [];
            allCompIds.forEach(compId => {
              const isLeadership = leaderCompIds.includes(compId);
              const mentors = [];
              const mentees = [];
              
              employeeData.forEach(emp => {
                const score = isLeadership ? (emp.includeLeadership ? emp.leaderScores[compId] : 0) : emp.coreScores[compId];
                if (score >= 4) mentors.push({ name: emp.name, score, employeeId: emp.employeeId });
                else if (score > 0 && score <= 2) mentees.push({ name: emp.name, score, employeeId: emp.employeeId });
              });
              
              if (mentors.length > 0 && mentees.length > 0) {
                mentors.sort((a, b) => b.score - a.score);
                mentees.sort((a, b) => a.score - b.score);
                const mentor = mentors[0];
                const mentee = mentees[0];
                if (mentor.employeeId !== mentee.employeeId) {
                  allMatches.push({ mentor, mentee, compId, isLeadership, scoreDiff: mentor.score - mentee.score });
                }
              }
            });
            
            allMatches.sort((a, b) => b.scoreDiff - a.scoreDiff);
            return allMatches.slice(0, 3);
          }, [calibrationData]);
          
          // === HR ADMIN STATES ===
          const [isHRAdmin, setIsHRAdmin] = useState(false);
          const [allCompanyAppraisals, setAllCompanyAppraisals] = useState([]);
          const [allCompanyMembers, setAllCompanyMembers] = useState([]);
          const [hrDataLoading, setHRDataLoading] = useState(false);
          const [hrFilter, setHrFilter] = useState('all');
          const [hrSearch, setHrSearch] = useState('');
          
          // HR Admin Check
          React.useEffect(() => {
            if (user && user.email) {
              const admin = isUserHRAdmin(user.email);
              setIsHRAdmin(admin);
              if (admin) console.log('üîê HR Admin erkannt:', user.email);
            } else {
              setIsHRAdmin(false);
            }
          }, [user]);
          
          // HR Admin: Lade ALLE Daten
          React.useEffect(() => {
            if (!isHRAdmin || !db || guestMode) {
              setAllCompanyAppraisals([]);
              setAllCompanyMembers([]);
              return;
            }
            
            setHRDataLoading(true);
            console.log('üìä HR Admin: Lade unternehmensweite Daten...');
            
            const unsub1 = db.collection('teamAppraisals').onSnapshot(snap => {
              const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
              setAllCompanyAppraisals(data);
              console.log('üìä HR Admin:', data.length, 'Beurteilungen geladen');
            }, err => console.error('HR appraisals error:', err));
            
            const unsub2 = db.collection('teamMembers').onSnapshot(snap => {
              const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
              setAllCompanyMembers(data);
              setHRDataLoading(false);
              console.log('üë• HR Admin:', data.length, 'Mitarbeiter geladen');
            }, err => { console.error('HR members error:', err); setHRDataLoading(false); });
            
            return () => { unsub1(); unsub2(); };
          }, [isHRAdmin, guestMode]);
          
          // Firestore Listener f√ºr teamMembers - NUR wenn user eingeloggt UND NICHT Gast-Modus
          React.useEffect(() => {
            // Im Gast-Modus keine Team-Daten laden (anonymer User hat eigene UID)
            if (!user || !db || guestMode) {
              setTeamMembers([]);
              return;
            }
            
            // Anonyme User ausschlie√üen (haben isAnonymous = true)
            if (user.isAnonymous) {
              setTeamMembers([]);
              return;
            }
            
            setFirestoreLoading(true);
            console.log('üîÑ Lade Team-Mitarbeiter f√ºr:', user.email, '(UID:', user.uid, ')');
            
            // === ZWEI SEPARATE REAL-TIME LISTENER ===
            let ownedMembers = [];
            let sharedMembers = [];
            
            // Funktion zum Kombinieren und Setzen der Mitarbeiter
            const updateCombinedMembers = () => {
              // Kombiniere und entferne Duplikate (eigene haben Vorrang)
              const ownedIds = new Set(ownedMembers.map(m => m.id));
              const uniqueShared = sharedMembers.filter(m => !ownedIds.has(m.id));
              
              const combined = [...ownedMembers, ...uniqueShared];
              console.log('‚úÖ Team kombiniert:', ownedMembers.length, 'eigene +', uniqueShared.length, 'geteilte =', combined.length, 'gesamt');
              
              setTeamMembers(combined);
              setFirestoreLoading(false);
            };
            
            // LISTENER 1: Eigene Mitarbeiter (Real-time)
            console.log('üì° Starte Listener 1: Eigene Mitarbeiter');
            const unsubOwned = db.collection('teamMembers')
              .where('userId', '==', user.uid)
              .onSnapshot(async (snapshot) => {
                console.log('üë§ [Listener 1] Eigene Mitarbeiter:', snapshot.docs.length);
                
                // Auto-Fix: Generiere fehlende accessCodes
                const needAccessCode = snapshot.docs.filter(doc => !doc.data().accessCode);
                for (const doc of needAccessCode) {
                  const newCode = generateAccessCode();
                  await db.collection('teamMembers').doc(doc.id).update({ accessCode: newCode });
                  console.log('  üîß AccessCode generiert f√ºr:', doc.data().name);
                }
                
                ownedMembers = snapshot.docs.map(doc => ({
                  id: doc.id,
                  ...doc.data(),
                  accessCode: doc.data().accessCode || 'pending',
                  _isOwner: true
                }));
                
                updateCombinedMembers();
              }, (err) => {
                console.error('‚ùå [Listener 1] Fehler:', err);
                setFirestoreLoading(false);
              });
            
            // LISTENER 2: Geteilte Mitarbeiter (Real-time) - NUR wenn E-Mail vorhanden
            let unsubShared = () => {};
            
            if (user.email) {
              const userEmailLower = user.email.toLowerCase();
              console.log('üì° Starte Listener 2: Geteilte Mitarbeiter f√ºr:', userEmailLower);
              
              try {
                unsubShared = db.collection('teamMembers')
                  .where('sharedWith', 'array-contains', userEmailLower)
                  .onSnapshot((snapshot) => {
                    console.log('üì• [Listener 2] Geteilte Mitarbeiter:', snapshot.docs.length);
                    
                    if (snapshot.docs.length === 0) {
                      console.log('   ‚ÑπÔ∏è Keine geteilten Mitarbeiter gefunden f√ºr:', userEmailLower);
                      console.log('   ‚ÑπÔ∏è Pr√ºfen Sie: Ist die E-Mail in Firestore EXAKT so gespeichert?');
                    }
                    
                    sharedMembers = snapshot.docs.map(doc => {
                      const data = doc.data();
                      console.log('  ‚Üí Geteilt:', data.name, '| von:', data.userId, '| sharedWith:', JSON.stringify(data.sharedWith));
                      return {
                        id: doc.id,
                        ...data,
                        _isOwner: false,
                        _sharedBy: data.userId,
                        _sharedWithMe: true
                      };
                    });
                    
                    updateCombinedMembers();
                  }, (err) => {
                    console.error('‚ùå [Listener 2] Fehler:', err);
                    console.error('   Fehlercode:', err.code);
                    console.error('   Fehlermeldung:', err.message);
                    
                    // Pr√ºfe ob Index fehlt
                    if (err.message && err.message.includes('index')) {
                      console.error('   ‚ö†Ô∏è FIRESTORE INDEX FEHLT!');
                      console.error('   Bitte erstellen Sie einen Index f√ºr: teamMembers.sharedWith');
                    }
                    
                    // Bei Fehler trotzdem mit eigenen Mitarbeitern fortfahren
                    updateCombinedMembers();
                  });
              } catch (setupErr) {
                console.error('‚ùå Listener 2 Setup Fehler:', setupErr);
                updateCombinedMembers();
              }
            } else {
              console.log('‚ö†Ô∏è Keine E-Mail verf√ºgbar - Listener 2 √ºbersprungen');
              console.log('   user.email ist:', user.email);
            }
            
            // Cleanup: Beide Listener aufr√§umen
            return () => {
              console.log('üßπ R√§ume Listener auf');
              unsubOwned();
              unsubShared();
            };
          }, [user, guestMode]);
          
          // Firestore Listener f√ºr teamAppraisals - NUR wenn user eingeloggt UND NICHT Gast-Modus
          React.useEffect(() => {
            // Im Gast-Modus keine Appraisals laden
            if (!user || !db || guestMode) {
              setTeamAppraisals([]);
              return;
            }
            
            // Anonyme User ausschlie√üen
            if (user.isAnonymous) {
              setTeamAppraisals([]);
              return;
            }
            
            // === CO-MANAGEMENT: Lade Appraisals basierend auf teamMembers ===
            // Wir laden alle Appraisals f√ºr Mitarbeiter, auf die wir Zugriff haben
            // Das bedeutet: Eigene Appraisals PLUS Appraisals f√ºr geteilte Mitarbeiter
            
            const unsubscribe = db.collection('teamAppraisals')
              .where('userId', '==', user.uid)
              .onSnapshot((snapshot) => {
                const ownedAppraisals = snapshot.docs.map(doc => ({
                  id: doc.id,
                  ...doc.data(),
                  _isOwner: true
                }));
                
                // Zus√§tzlich: Lade Appraisals f√ºr geteilte Mitarbeiter
                // Diese sind verkn√ºpft √ºber employeeId mit teamMembers
                // Da teamMembers bereits geladen sind, filtern wir sp√§ter
                setTeamAppraisals(ownedAppraisals);
                
                // Cache f√ºr AppraisalForm (Selbstreflexion-Verkn√ºpfung)
                localStorage.setItem('nw_team_appraisals_cache', JSON.stringify(ownedAppraisals));
              }, (error) => {
                console.error('Firestore teamAppraisals error:', error);
              });
            
            return () => unsubscribe();
          }, [user, guestMode]);
          
          const [selectedCompetencyId, setSelectedCompetencyId] = useState(null);
          const [activeScore, setActiveScore] = useState(3);
          
          // Quiz-spezifische States entfernt
          const [lang, setLang] = useState('de'); // 'de' or 'it'
          
          // === TERMIN MODAL STATES (App-Level) ===
          const [scheduleModalOpen, setScheduleModalOpen] = useState(false);
          const [scheduleModalMember, setScheduleModalMember] = useState(null);
          const [scheduleModalDate, setScheduleModalDate] = useState('');
          
          // SAFE DATA ACCESS (Bug Fix)
          const t = UI_TEXT[lang] || UI_TEXT['de']; 
          const data = APP_DATA[lang] || APP_DATA['de']; 

          const navigateToCompetency = (id) => {
            setSelectedCompetencyId(id);
            setActiveScore(3);
            setActiveView('detail');
          };
          
          const getActiveCompetencyData = () => {
            if (!data || !data.competencies) return null;
            return data.competencies.find(c => c.id === selectedCompetencyId);
          };

          // Components
          const ScoreBadge = ({ score, active }) => {
            const colors = {
              1: "bg-red-100 text-red-800 border-red-200",
              2: "bg-orange-100 text-orange-800 border-orange-200",
              3: "bg-green-100 text-green-800 border-green-200",
              4: "bg-blue-100 text-blue-800 border-blue-200",
              5: "bg-[#E8F5ED] text-[#4D9360] border-[#D1EBE0]"
            };
            
            return React.createElement('div', {
              className: `flex items-center justify-center w-10 h-10 rounded-full font-bold border-2 cursor-pointer transition-all ${active ? 'scale-110 shadow-md ring-2 ring-offset-2 ring-[#6EBD84] ' + colors[score] : 'opacity-60 grayscale hover:grayscale-0'}`,
              onClick: () => setActiveScore(score)
            }, score);
          };

          
          // === TEAM FUNCTIONS (mit Firestore) ===
          
          // Hilfsfunktion: Generiere accessCode (crypto.randomUUID mit sicherem Fallback)
          const generateAccessCode = () => {
            // Prim√§r: crypto.randomUUID() (modern, sicher)
            if (typeof crypto !== 'undefined' && crypto.randomUUID) {
              return crypto.randomUUID();
            }
            // Fallback: crypto.getRandomValues (sicherer als Math.random)
            if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
              const array = new Uint8Array(16);
              crypto.getRandomValues(array);
              // Format als UUID-√§hnlicher String
              const hex = Array.from(array, b => b.toString(16).padStart(2, '0')).join('');
              return `${hex.slice(0,8)}-${hex.slice(8,12)}-${hex.slice(12,16)}-${hex.slice(16,20)}-${hex.slice(20,32)}`;
            }
            // Letzter Fallback f√ºr sehr alte Browser (nicht kryptographisch sicher)
            console.warn('Using insecure Math.random() for accessCode - please update browser');
            return 'xxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'.replace(/x/g, () => 
              Math.floor(Math.random() * 16).toString(16)
            );
          };
          
          const addTeamMember = async (data) => {
            if (!user || !db) return;
            
            try {
              const accessCode = generateAccessCode();
              const selfReflectionUrl = window.location.origin + window.location.pathname + '?accessCode=' + accessCode;
              const managerName = user.displayName || user.email?.split('@')[0] || 'Your Manager';
              
              // Mitarbeiter in Firestore speichern
              const memberRef = await db.collection('teamMembers').add({
                userId: user.uid,
                name: data.name,
                position: data.position,
                email: data.email || '',
                department: data.department || '',
                accessCode: accessCode,
                createdAt: new Date().toISOString(),
                invitedAt: null,  // Wird erst beim Einladen/Link-Erstellen gesetzt
                lastReminderAt: null
              });
              console.log('‚úì Mitarbeiter erstellt mit accessCode:', accessCode);
              
              // Info: Selbstreflexions-Link muss manuell versendet werden
              // (Firebase Trigger Email Extension nicht konfiguriert)
              
              return memberRef.id; // Gebe die ID zur√ºck f√ºr Import-Verkn√ºpfung
            } catch (error) {
              console.error('Error adding team member:', error);
              alert(lang === 'de' ? 'Fehler beim Speichern!' : lang === 'it' ? 'Errore durante il salvataggio!' : 'Error saving!');
              return null;
            }
          };
          
          // === IMPORT SELF-ASSESSMENT FROM LINK ===
          const importSelfAssessment = async () => {
            if (!user || !db || !importData) {
              alert(lang === 'de' ? 'Bitte zuerst einloggen!' : lang === 'it' ? 'Effettua prima il login!' : 'Please log in first!');
              return;
            }
            
            try {
              console.log('üì• Importiere Selbstreflexion:', importData);
              
              // 1. Mitarbeiter anlegen (falls noch nicht vorhanden)
              const employeeName = importData.n || 'Unbekannt';
              const employeePosition = importData.p || '';
              const employeeEmail = importData.e || '';
              
              // Pr√ºfe ob Mitarbeiter mit gleicher Email bereits existiert
              let existingMember = null;
              if (employeeEmail) {
                const existingSnapshot = await db.collection('teamMembers')
                  .where('userId', '==', user.uid)
                  .where('email', '==', employeeEmail)
                  .limit(1)
                  .get();
                
                if (!existingSnapshot.empty) {
                  existingMember = { id: existingSnapshot.docs[0].id, ...existingSnapshot.docs[0].data() };
                  console.log('‚úì Mitarbeiter existiert bereits:', existingMember.name);
                }
              }
              
              let memberId;
              if (existingMember) {
                memberId = existingMember.id;
              } else {
                // Neuen Mitarbeiter anlegen
                memberId = await addTeamMember({
                  name: employeeName,
                  position: employeePosition,
                  email: employeeEmail
                });
              }
              
              if (!memberId) {
                throw new Error('Mitarbeiter konnte nicht erstellt werden');
              }
              
              // 2. Selbstreflexion speichern (mit Verkn√ºpfung zum Mitarbeiter)
              const selfCoreScores = {};
              const selfCoreComments = {};
              if (importData.c && importData.c.length > 0) {
                importData.c.forEach(c => {
                  selfCoreScores[c.i] = c.r;
                  selfCoreComments[c.i] = c.t || '';
                });
              }
              
              const selfLeaderScores = {};
              const selfLeaderComments = {};
              if (importData.im && importData.l && importData.l.length > 0) {
                importData.l.forEach(c => {
                  selfLeaderScores[c.i] = c.r;
                  selfLeaderComments[c.i] = c.t || '';
                });
              }
              
              // Berechne Scores
              const coreValues = Object.values(selfCoreScores).filter(v => v > 0);
              const wieCoreScore = coreValues.length > 0 ? coreValues.reduce((s, v) => s + v, 0) / coreValues.length : 0;
              
              let wieLeadScore = null;
              if (importData.im) {
                const leadValues = Object.values(selfLeaderScores).filter(v => v > 0);
                wieLeadScore = leadValues.length > 0 ? leadValues.reduce((s, v) => s + v, 0) / leadValues.length : 0;
              }
              
              // WAS Score aus Zielen
              let wasScore = 0;
              if (importData.g && importData.g.length > 0) {
                const totalWeight = importData.g.reduce((s, g) => s + (g.w || 0), 0);
                if (totalWeight > 0) {
                  wasScore = importData.g.reduce((s, g) => s + ((g.a || 0) * (g.w || 0) / totalWeight), 0);
                }
              }
              
              // GPS berechnen
              let finalGPS;
              if (wasScore > 0) {
                if (importData.im && wieLeadScore !== null) {
                  finalGPS = (wasScore * 0.5 / 100 * 5) + (wieCoreScore * 0.25) + (wieLeadScore * 0.25);
                } else {
                  finalGPS = (wasScore * 0.5 / 100 * 5) + (wieCoreScore * 0.5);
                }
              } else {
                if (importData.im && wieLeadScore !== null) {
                  finalGPS = (wieCoreScore * 0.5) + (wieLeadScore * 0.5);
                } else {
                  finalGPS = wieCoreScore;
                }
              }
              
              const selfAssessmentData = {
                type: 'self_assessment',
                status: 'completed',
                userId: user.uid,
                employeeId: memberId,
                employeeName: employeeName,
                employeeEmail: employeeEmail,
                period: importData.period || new Date().getFullYear().toString(),
                formData: {
                  employee: employeeName,
                  position: employeePosition,
                  manager: importData.m || '',
                  strengths1: importData.s1 || '',
                  strengths2: importData.s2 || '',
                  careerComment: importData.cc || ''
                },
                goals: importData.g ? importData.g.map((g, i) => ({
                  id: i + 1,
                  name: g.n,
                  weight: g.w,
                  achievement: g.a
                })) : [],
                selfCoreScores: selfCoreScores,
                selfCoreComments: selfCoreComments,
                selfLeaderScores: importData.im ? selfLeaderScores : null,
                selfLeaderComments: importData.im ? selfLeaderComments : null,
                devPlan: importData.d ? importData.d.map((d, i) => ({
                  id: i + 1,
                  measure: d.m,
                  responsible: d.r,
                  deadline: d.dl
                })) : [],
                careerChecks: importData.ck || [false, false, false, false, false],
                isManager: importData.im || false,
                wasScore: wasScore,
                wieCoreScore: wieCoreScore,
                wieLeadScore: wieLeadScore,
                gpsScore: finalGPS,
                importedAt: new Date().toISOString(),
                originalTimestamp: importData.ts,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
              };
              
              await db.collection('teamAppraisals').add(selfAssessmentData);
              console.log('‚úÖ Selbstreflexion erfolgreich importiert f√ºr:', employeeName);
              
              setImportStatus('success');
              
              // Nach 2 Sekunden Modal schlie√üen und zur Team√ºbersicht wechseln
              setTimeout(() => {
                setShowImportModal(false);
                setImportData(null);
                setImportStatus(null);
                setActiveView('teamoverview');
              }, 2500);
              
            } catch (error) {
              console.error('‚ùå Fehler beim Import:', error);
              setImportStatus('error');
            }
          };
          
          // === CLAIM PENDING SELF-ASSESSMENTS ===
          // √úbernimmt alle wartenden Selbstreflexionen f√ºr die aktuelle FK
          const claimPendingSelfAssessments = async () => {
            if (!user || !db || pendingSelfAssessments.length === 0) return;
            
            setClaimingPending(true);
            let successCount = 0;
            let errorCount = 0;
            
            try {
              for (const pending of pendingSelfAssessments) {
                try {
                  const employeeName = pending.employeeName || pending.formData?.employee || 'Unbekannt';
                  const employeeEmail = pending.employeeEmail || '';
                  const employeePosition = pending.formData?.position || '';
                  
                  // 1. Pr√ºfe ob Mitarbeiter bereits existiert
                  let memberId = null;
                  if (employeeEmail) {
                    const existingSnapshot = await db.collection('teamMembers')
                      .where('userId', '==', user.uid)
                      .where('email', '==', employeeEmail)
                      .limit(1)
                      .get();
                    
                    if (!existingSnapshot.empty) {
                      memberId = existingSnapshot.docs[0].id;
                    }
                  }
                  
                  // 2. Falls nicht vorhanden: Neuen Mitarbeiter anlegen
                  if (!memberId) {
                    memberId = await addTeamMember({
                      name: employeeName,
                      position: employeePosition,
                      email: employeeEmail
                    });
                  }
                  
                  if (!memberId) {
                    console.error('Konnte Mitarbeiter nicht anlegen f√ºr:', employeeName);
                    errorCount++;
                    continue;
                  }
                  
                  // 3. Selbstreflexion updaten: userId setzen, pendingStatus entfernen
                  await db.collection('teamAppraisals').doc(pending.id).update({
                    userId: user.uid,
                    employeeId: memberId,
                    pendingStatus: 'claimed',
                    claimedAt: new Date().toISOString(),
                    claimedByEmail: user.email
                  });
                  
                  console.log('‚úÖ Selbstreflexion √ºbernommen f√ºr:', employeeName);
                  successCount++;
                  
                } catch (singleError) {
                  console.error('Fehler bei einzelner Selbstreflexion:', singleError);
                  errorCount++;
                }
              }
              
              // 4. Modal schlie√üen und Erfolg anzeigen
              setShowPendingModal(false);
              setPendingSelfAssessments([]);
              
              const message = lang === 'de'
                ? `‚úÖ ${successCount} Selbstreflexion(en) erfolgreich √ºbernommen!${errorCount > 0 ? `\n‚ö†Ô∏è ${errorCount} konnten nicht importiert werden.` : ''}`
                : lang === 'it'
                ? `‚úÖ ${successCount} autovalutazione(i) importata(e) con successo!${errorCount > 0 ? `\n‚ö†Ô∏è ${errorCount} non potevano essere importate.` : ''}`
                : `‚úÖ ${successCount} self-assessment(s) successfully claimed!${errorCount > 0 ? `\n‚ö†Ô∏è ${errorCount} could not be imported.` : ''}`;
              
              alert(message);
              setActiveView('teamoverview');
              
            } catch (error) {
              console.error('‚ùå Fehler beim √úbernehmen:', error);
              alert(lang === 'de' ? 'Fehler beim √úbernehmen der Selbstreflexionen.' : 'Error claiming self-assessments.');
            }
            
            setClaimingPending(false);
          };
          
          // Hilfsfunktion: Zeitdifferenz formatieren
          const getTimeSinceInvite = (invitedAt) => {
            if (!invitedAt) return null;
            const now = new Date();
            const invited = new Date(invitedAt);
            const diffMs = now - invited;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            
            if (diffDays > 0) {
              return lang === 'de' ? `vor ${diffDays} Tag${diffDays > 1 ? 'en' : ''}` 
                   : lang === 'it' ? `${diffDays} giorn${diffDays > 1 ? 'i' : 'o'} fa`
                   : `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            } else if (diffHours > 0) {
              return lang === 'de' ? `vor ${diffHours} Stunde${diffHours > 1 ? 'n' : ''}`
                   : lang === 'it' ? `${diffHours} or${diffHours > 1 ? 'e' : 'a'} fa`
                   : `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            }
            return lang === 'de' ? 'gerade eben' : lang === 'it' ? 'poco fa' : 'just now';
          };
          
          const deleteTeamMember = async (id) => {
            if (!user || !db) return;
            
            if (confirm(lang === 'de' ? 'Wirklich l√∂schen?' : lang === 'it' ? 'Eliminare?' : 'Delete?')) {
              try {
                // L√∂sche Mitarbeiter
                await db.collection('teamMembers').doc(id).delete();
                
                // L√∂sche zugeh√∂rige Appraisals
                const appraisalsSnapshot = await db.collection('teamAppraisals')
                  .where('userId', '==', user.uid)
                  .where('employeeId', '==', id)
                  .get();
                
                const batch = db.batch();
                appraisalsSnapshot.docs.forEach(doc => {
                  batch.delete(doc.ref);
                });
                await batch.commit();
              } catch (error) {
                console.error('Error deleting team member:', error);
                alert(lang === 'de' ? 'Fehler beim L√∂schen!' : lang === 'it' ? 'Errore durante l\'eliminazione!' : 'Error deleting!');
              }
            }
          };
          
          const startTeamAppraisal = (employeeId, period, existingAppraisal = null) => {
            const employee = teamMembers.find(e => e.id === employeeId);
            if (!employee) return;
            
            // Wenn existingAppraisal √ºbergeben wurde, nutze diesen, sonst suche nach Draft
            const existingDraft = existingAppraisal || teamAppraisals.find(
              a => a.employeeId === employeeId && a.period === period && a.status === 'draft' && a.type === 'review'
            );
            
            localStorage.setItem('nw_current_employee', JSON.stringify({
              employee, period,
              type: 'review',
              appraisalId: existingDraft ? existingDraft.id : 'appr_' + Date.now(),
              existingData: existingDraft
            }));
            
            setActiveView('formular');
          };
          
          // Neue Funktion f√ºr Zielvereinbarungen
          const startTeamGoalSetting = (employeeId, period, existingGoal = null) => {
            const employee = teamMembers.find(e => e.id === employeeId);
            if (!employee) return;
            
            // Wenn existingGoal √ºbergeben wurde, nutze diesen, sonst suche nach Draft
            const existingDraft = existingGoal || teamAppraisals.find(
              a => a.employeeId === employeeId && a.period === period && a.status === 'draft' && a.type === 'goals'
            );
            
            localStorage.setItem('nw_current_employee', JSON.stringify({
              employee, period,
              type: 'goals',
              appraisalId: existingDraft ? existingDraft.id : 'goal_' + Date.now(),
              existingData: existingDraft
            }));
            
            setActiveView('zielvereinbarung');
          };
          
          const saveTeamAppraisal = async (appraisal) => {
            if (!user || !db) return;
            
            // Stelle sicher, dass type gesetzt ist (default: 'review')
            const appraisalWithType = {
              ...appraisal,
              type: appraisal.type || 'review',
              userId: user.uid
            };
            
            try {
              // Pr√ºfe, ob das Dokument bereits existiert
              const docRef = db.collection('teamAppraisals').doc(appraisalWithType.id);
              const docSnap = await docRef.get();
              
              if (docSnap.exists) {
                // Update existierendes Dokument mit merge
                await docRef.set(appraisalWithType, { merge: true });
                console.log('‚úì Dokument aktualisiert:', appraisalWithType.id);
              } else {
                // Neues Dokument erstellen
                await docRef.set(appraisalWithType);
                console.log('‚úì Neues Dokument erstellt:', appraisalWithType.id);
              }
              
              // === SMART-SYNC: Termin automatisch √ºbernehmen ===
              // Wenn im Formular ein Datum eingetragen ist, sync es zum teamMember
              if (appraisalWithType.formData?.date && appraisalWithType.employeeId) {
                try {
                  const dateStr = appraisalWithType.formData.date;
                  // Versuche das Datum zu parsen (Format: YYYY-MM-DD oder mit Zeit)
                  let scheduledDate;
                  if (dateStr.includes('T') || dateStr.includes(' ')) {
                    scheduledDate = new Date(dateStr);
                  } else {
                    // Nur Datum - setze auf 10:00 Uhr als Standard
                    scheduledDate = new Date(dateStr + 'T10:00:00');
                  }
                  
                  if (!isNaN(scheduledDate.getTime())) {
                    // Finde den teamMember und aktualisiere scheduledAt
                    const memberRef = db.collection('teamMembers').doc(appraisalWithType.employeeId);
                    await memberRef.update({ 
                      scheduledAt: scheduledDate.toISOString(),
                      scheduledSource: 'form' // Markiere als "aus Formular √ºbernommen"
                    });
                    console.log('üìÖ Smart-Sync: Termin automatisch √ºbernommen:', scheduledDate.toLocaleDateString('de-DE'));
                  }
                } catch (syncError) {
                  console.warn('Smart-Sync Termin konnte nicht √ºbernommen werden:', syncError);
                  // Fehler beim Sync soll Hauptspeicherung nicht blockieren
                }
              }
              // === ENDE SMART-SYNC ===
              
              // Debug-Log
              console.log('üíæ Gespeicherte Daten:', {
                id: appraisalWithType.id,
                type: appraisalWithType.type,
                status: appraisalWithType.status,
                gpsScore: appraisalWithType.gpsScore,
                wasScore: appraisalWithType.wasScore,
                employeeName: appraisalWithType.employeeName
              });
              
              localStorage.removeItem('nw_current_employee');
              
              // Angepasste Meldung je nach Typ
              const typeLabel = appraisalWithType.type === 'goals' 
                ? (lang === 'de' ? 'Zielvereinbarung' : lang === 'it' ? 'Accordo obiettivi' : 'Goal Agreement')
                : (lang === 'de' ? 'Bewertung' : lang === 'it' ? 'Valutazione' : 'Assessment');
              const statusLabel = appraisalWithType.status === 'draft'
                ? (lang === 'de' ? ' (Entwurf)' : lang === 'it' ? ' (Bozza)' : ' (Draft)')
                : '';
              alert(typeLabel + statusLabel + (lang === 'de' ? ' gespeichert!' : lang === 'it' ? ' salvato!' : ' saved!'));
              setActiveView('teamoverview');
            } catch (error) {
              console.error('Error saving appraisal:', error);
              alert(lang === 'de' ? 'Fehler beim Speichern!' : lang === 'it' ? 'Errore durante il salvataggio!' : 'Error saving!');
            }
          };
          
          const renderTeamOverview = () => {
            // === ERROR BOUNDARY ===
            try {
            // === LOGIN PR√úFUNG ===
            if (!user) {
              return React.createElement(LoginView, { 
                lang: lang, 
                onLoginSuccess: () => {}
              });
            }
            
            // === HELPER FUNCTIONS ===
            const handleLogout = async () => {
              try { await auth.signOut(); setActiveView('dashboard'); } catch (e) { console.error(e); }
            };
            
            // Selbstreflexions-Link generieren
            const getSelfLink = (member) => member.accessCode 
              ? `${window.location.origin}${window.location.pathname}?accessCode=${member.accessCode}` 
              : null;
            
            // E-Mail mit Link √∂ffnen
            const sendEmail = (member) => {
              const link = getSelfLink(member);
              if (!member.email || !link) return;
              
              const subject = encodeURIComponent(
                lang === 'de' ? `Vorbereitung Jahresgespr√§ch ‚Äì Selbstreflexion` : 
                lang === 'it' ? `Preparazione colloquio annuale ‚Äì Autovalutazione` :
                `Annual Review Preparation ‚Äì Self-Reflection`
              );
              
              const body = encodeURIComponent(
                lang === 'de' 
                  ? `Hallo ${member.name},

zur Vorbereitung auf unser Jahresgespr√§ch bitte ich dich, deine Selbstreflexion digital auszuf√ºllen.

üìã SO FUNKTIONIERT'S:
1. Klicke auf den Link unten
2. F√ºlle die Fragen zu deinen St√§rken und Entwicklungsfeldern aus
3. Bewerte deine Kompetenzen selbst ein
4. Klicke am Ende auf "Absenden"

üîó Dein pers√∂nlicher Link (keine Anmeldung n√∂tig):
${link}

‚è∞ Bitte bis eine Woche vor unserem Gespr√§ch ausf√ºllen.

üí° Hinweis: Deine Eingaben werden automatisch gespeichert. Du kannst das Formular auch unterbrechen und sp√§ter fortsetzen.

Bei Fragen melde dich gerne bei mir.

Viele Gr√º√üe`
                  : lang === 'it'
                  ? `Ciao ${member.name},

per prepararti al nostro colloquio annuale, ti chiedo di compilare la tua autovalutazione in formato digitale.

üìã COME FUNZIONA:
1. Clicca sul link qui sotto
2. Compila le domande sui tuoi punti di forza e aree di sviluppo
3. Valuta le tue competenze
4. Clicca su "Invia" alla fine

üîó Il tuo link personale (nessuna registrazione necessaria):
${link}

‚è∞ Ti prego di compilarlo almeno una settimana prima del nostro incontro.

üí° Nota: I tuoi dati vengono salvati automaticamente. Puoi interrompere e riprendere in qualsiasi momento.

Per qualsiasi domanda, non esitare a contattarmi.

Cordiali saluti`
                  : `Hello ${member.name},

To prepare for our annual review meeting, please complete your self-reflection digitally.

üìã HOW IT WORKS:
1. Click on the link below
2. Answer questions about your strengths and development areas
3. Rate your own competencies
4. Click "Submit" at the end

üîó Your personal link (no login required):
${link}

‚è∞ Please complete this at least one week before our meeting.

üí° Note: Your entries are saved automatically. You can pause and continue later.

If you have any questions, feel free to reach out.

Best regards`
              );
              
              window.location.href = `mailto:${member.email}?subject=${subject}&body=${body}`;
            };
            
            // Link kopieren
            const copyLink = (member) => {
              const link = getSelfLink(member);
              if (link) { navigator.clipboard.writeText(link); alert(lang === 'de' ? '‚úì Link kopiert!' : '‚úì Link copied!'); }
            };
            
            // === PDF UPLOAD F√úR SELBSTREFLEXION ===
            const handleSelfReflectionPdfUpload = async (member, file) => {
              console.log('üì§ PDF Upload gestartet f√ºr:', member.name, file?.name);
              
              if (!file) {
                console.error('‚ùå Keine Datei √ºbergeben');
                return;
              }
              if (!db) {
                console.error('‚ùå Datenbank nicht verf√ºgbar');
                alert('Fehler: Datenbank nicht verbunden.');
                return;
              }
              if (!user) {
                console.error('‚ùå Benutzer nicht angemeldet');
                alert('Fehler: Bitte melden Sie sich an.');
                return;
              }
              
              // Pr√ºfe ob User wirklich authentifiziert ist (nicht anonym)
              console.log('üë§ User Status:', {
                uid: user.uid,
                email: user.email,
                isAnonymous: user.isAnonymous,
                emailVerified: user.emailVerified
              });
              
              if (user.isAnonymous) {
                alert(lang === 'de' 
                  ? 'PDF-Upload ist nur f√ºr angemeldete Benutzer m√∂glich.\n\nBitte melden Sie sich mit Ihrer E-Mail an.' 
                  : 'PDF upload is only available for logged-in users.\n\nPlease sign in with your email.');
                return;
              }
              
              // Validiere Dateityp
              if (file.type !== 'application/pdf') {
                alert(lang === 'de' ? 'Bitte nur PDF-Dateien hochladen.' : lang === 'it' ? 'Caricare solo file PDF.' : 'Please upload PDF files only.');
                return;
              }
              
              // Validiere Dateigr√∂√üe (max 10MB f√ºr Firebase Storage)
              const maxSize = 10 * 1024 * 1024; // 10MB
              if (file.size > maxSize) {
                alert(lang === 'de' 
                  ? `Die Datei ist zu gro√ü (${(file.size/1024/1024).toFixed(1)} MB).\n\nMaximal erlaubt: 10 MB.` 
                  : `File too large (${(file.size/1024/1024).toFixed(1)} MB). Max: 10 MB.`
                );
                return;
              }
              
              // Zeige Ladehinweis
              console.log('üì§ PDF Upload gestartet...');
              
              try {
                const currentPeriod = new Date().getFullYear().toString();
                
                // Pr√ºfe ob Storage verf√ºgbar
                if (!storage) {
                  throw new Error('Firebase Storage nicht initialisiert');
                }
                
                // Pr√ºfe ob bereits eine PDF-Selbstreflexion existiert
                console.log('üîç Suche existierende PDFs f√ºr:', member.id);
                const existingSnapshot = await db.collection('teamAppraisals')
                  .where('employeeId', '==', member.id)
                  .where('period', '==', currentPeriod)
                  .get();
                
                // Filtere manuell nach PDF-Typ
                const existingPdfs = existingSnapshot.docs.filter(doc => {
                  const data = doc.data();
                  return data.type === 'self_pdf' || data.isPdfUpload === true;
                });
                
                console.log('üìã Gefundene PDFs:', existingPdfs.length);
                
                if (existingPdfs.length > 0) {
                  const confirmOverwrite = confirm(
                    lang === 'de' 
                      ? `‚ö†Ô∏è Es existiert bereits eine hochgeladene PDF f√ºr ${currentPeriod}.\n\nM√∂chten Sie diese ersetzen?`
                      : `‚ö†Ô∏è A PDF already exists for ${currentPeriod}.\n\nReplace it?`
                  );
                  
                  if (!confirmOverwrite) {
                    console.log('‚ùå Upload abgebrochen durch Benutzer');
                    return;
                  }
                  
                  // L√∂sche alte PDFs aus Storage und Firestore
                  for (const doc of existingPdfs) {
                    const oldData = doc.data();
                    console.log('üóëÔ∏è L√∂sche alte PDF:', doc.id);
                    
                    // L√∂sche aus Storage falls vorhanden
                    if (oldData.storagePath) {
                      try {
                        await storage.ref(oldData.storagePath).delete();
                        console.log('üóëÔ∏è Alte PDF aus Storage gel√∂scht');
                      } catch (e) {
                        console.log('‚ö†Ô∏è Storage-Datei nicht gefunden (bereits gel√∂scht?)');
                      }
                    }
                    
                    await db.collection('teamAppraisals').doc(doc.id).delete();
                  }
                }
                
                // === UPLOAD ZU FIREBASE STORAGE (MIT FALLBACK) ===
                const storagePath = `self_reflections/${user.uid}/${member.id}_${currentPeriod}_${Date.now()}.pdf`;
                console.log('üìÅ Storage-Pfad:', storagePath);
                
                let downloadURL = null;
                let useStorageFallback = false;
                
                try {
                  const storageRef = storage.ref(storagePath);
                  
                  // Upload mit Progress-Tracking
                  console.log('‚¨ÜÔ∏è Versuche Upload zu Firebase Storage...');
                  const uploadTask = storageRef.put(file);
                  
                  // Warte auf Upload-Abschluss
                  await new Promise((resolve, reject) => {
                    uploadTask.on('state_changed',
                      (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log('üìä Upload-Fortschritt:', Math.round(progress), '%');
                      },
                      (error) => {
                        console.error('‚ùå Storage Upload Fehler:', error);
                        reject(error);
                      },
                      () => {
                        console.log('‚úÖ Upload zu Storage abgeschlossen');
                        resolve();
                      }
                    );
                  });
                  
                  // Hole Download-URL
                  downloadURL = await storageRef.getDownloadURL();
                  console.log('üîó Download-URL erhalten');
                  
                } catch (storageError) {
                  console.warn('‚ö†Ô∏è Firebase Storage fehlgeschlagen, verwende Base64-Fallback');
                  console.warn('   Fehler:', storageError.message);
                  useStorageFallback = true;
                }
                
                // Erstelle eindeutige ID
                const pdfDocId = 'self_pdf_' + member.id + '_' + currentPeriod;
                
                // Daten-Objekt f√ºr Firestore
                let pdfUploadData = {
                  id: pdfDocId,
                  type: 'self_pdf',
                  isPdfUpload: true,
                  pdfFileName: file.name,
                  pdfSize: file.size,
                  employeeId: member.id,
                  employeeName: member.name,
                  position: member.position || '',
                  department: member.department || '',
                  userId: user.uid,
                  period: currentPeriod,
                  status: 'pdf_uploaded',
                  uploadedBy: user.email || 'F√ºhrungskraft',
                  uploadedAt: new Date().toISOString(),
                  createdAt: new Date().toISOString()
                };
                
                if (useStorageFallback) {
                  // FALLBACK: Speichere als Base64 in Firestore (f√ºr kleine PDFs)
                  if (file.size > 1024 * 1024) { // > 1MB
                    throw new Error(lang === 'de' 
                      ? 'PDF zu gro√ü f√ºr Fallback-Speicherung. Bitte Firebase Storage Rules pr√ºfen.'
                      : 'PDF too large for fallback storage. Please check Firebase Storage Rules.');
                  }
                  
                  console.log('üì¶ Konvertiere PDF zu Base64...');
                  const base64 = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                  });
                  
                  pdfUploadData.pdfData = base64; // Base64-Daten
                  pdfUploadData.storageMethod = 'base64';
                  console.log('‚úÖ Base64-Konvertierung abgeschlossen');
                  
                } else {
                  // Normal: URL von Firebase Storage
                  pdfUploadData.pdfUrl = downloadURL;
                  pdfUploadData.storagePath = storagePath;
                  pdfUploadData.storageMethod = 'firebase_storage';
                }
                
                console.log('üíæ Speichere Metadaten in Firestore...');
                
                // Speichern in Firestore
                await db.collection('teamAppraisals').doc(pdfDocId).set(pdfUploadData);
                
                console.log('‚úÖ PDF erfolgreich hochgeladen:', pdfDocId);
                
                alert(lang === 'de' 
                  ? `‚úÖ PDF "${file.name}" erfolgreich hochgeladen!\n\nDateigr√∂√üe: ${(file.size/1024/1024).toFixed(2)} MB\nDie Ansicht wird automatisch aktualisiert.` 
                  : `‚úÖ PDF "${file.name}" uploaded successfully!\n\nSize: ${(file.size/1024/1024).toFixed(2)} MB`
                );
                
              } catch (error) {
                console.error('‚ùå PDF Upload Fehler:', error);
                console.error('   Fehlercode:', error.code);
                console.error('   Fehlermeldung:', error.message);
                
                let errorMsg = '';
                
                if (error.code === 'storage/unauthorized' || error.code === 'storage/unauthenticated') {
                  errorMsg = lang === 'de'
                    ? '‚ùå Keine Berechtigung f√ºr PDF-Upload.\n\n' +
                      'M√∂gliche Ursachen:\n' +
                      '1. Firebase Storage Rules nicht korrekt konfiguriert\n' +
                      '2. Sie sind nicht richtig angemeldet\n\n' +
                      'L√∂sung: Bitte melden Sie sich ab und wieder an.'
                    : '‚ùå No permission for PDF upload.\n\nPlease sign out and sign in again.';
                } else if (error.message && error.message.includes('permission')) {
                  errorMsg = lang === 'de'
                    ? '‚ùå Keine Berechtigung.\n\nBitte melden Sie sich ab und wieder an.'
                    : '‚ùå Permission denied.\n\nPlease sign out and sign in again.';
                } else {
                  errorMsg = lang === 'de'
                    ? '‚ùå Fehler beim Hochladen: ' + (error.message || 'Unbekannter Fehler')
                    : '‚ùå Upload error: ' + (error.message || 'Unknown error');
                }
                
                alert(errorMsg);
              }
            };
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // MITARBEITER TEILEN - VEREINFACHTE, ROBUSTE IMPLEMENTIERUNG
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            
            // √ñffne das Share-Modal f√ºr einen Mitarbeiter
            const shareMember = (member) => {
              console.log('üîó shareMember aufgerufen f√ºr:', member.name);
              setShareModalMember(member);
              setShareModalEmail('');
              setShareModalLink('');
              setShareModalStep(1);
              setShareModalOpen(true);
            };
            
            // Einfaches Share Modal - direkt hier definiert f√ºr bessere Lesbarkeit
            const renderShareModal = () => {
              if (!shareModalOpen) return null;
              
              const currentMember = shareModalMember;
              const currentEmail = shareModalEmail;
              const currentLink = shareModalLink;
              const currentStep = shareModalStep;
              
              // Funktion: Teilen ausf√ºhren
              const handleShare = () => {
                console.log('üì§ handleShare aufgerufen');
                
                // Validierung
                if (!currentMember) {
                  alert('Fehler: Kein Mitarbeiter ausgew√§hlt');
                  return;
                }
                
                const email = (currentEmail || '').trim().toLowerCase();
                console.log('üì§ E-Mail:', email);
                
                if (!email) {
                  alert(lang === 'de' ? 'Bitte E-Mail eingeben' : 'Please enter email');
                  return;
                }
                
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                  alert(lang === 'de' ? 'Ung√ºltige E-Mail-Adresse' : 'Invalid email address');
                  return;
                }
                
                // Bereits geteilt? (case-insensitive pr√ºfen)
                const existingShared = (currentMember.sharedWith || []).map(e => e.toLowerCase());
                if (existingShared.includes(email)) {
                  alert(lang === 'de' ? 'Bereits mit dieser Person geteilt!' : 'Already shared with this person!');
                  return;
                }
                
                // Firestore Update
                console.log('üîÑ Speichere in Firestore...');
                
                const newSharedWith = [...(currentMember.sharedWith || []), email];
                
                db.collection('teamMembers').doc(currentMember.id).update({
                  sharedWith: newSharedWith
                })
                .then(() => {
                  console.log('‚úÖ Firestore Update erfolgreich');
                  
                  // Lokalen State aktualisieren
                  setTeamMembers(prev => prev.map(m => 
                    m.id === currentMember.id ? { ...m, sharedWith: newSharedWith } : m
                  ));
                  
                  // Link generieren (einfach - nur App-URL, FK2 muss sich einloggen)
                  const baseUrl = window.location.origin + window.location.pathname;
                  setShareModalLink(baseUrl);
                  setShareModalStep(2);
                  
                  console.log('‚úÖ Teilen erfolgreich');
                })
                .catch((err) => {
                  console.error('‚ùå Firestore Fehler:', err);
                  alert(lang === 'de' ? 'Fehler beim Speichern: ' + err.message : 'Error saving: ' + err.message);
                });
              };
              
              // Funktion: Link kopieren
              const handleCopyLink = () => {
                const textToCopy = currentLink || window.location.origin + window.location.pathname;
                navigator.clipboard.writeText(textToCopy)
                  .then(() => alert(lang === 'de' ? '‚úÖ Link kopiert!' : '‚úÖ Link copied!'))
                  .catch(() => {
                    // Fallback
                    const ta = document.createElement('textarea');
                    ta.value = textToCopy;
                    document.body.appendChild(ta);
                    ta.select();
                    document.execCommand('copy');
                    document.body.removeChild(ta);
                    alert(lang === 'de' ? '‚úÖ Link kopiert!' : '‚úÖ Link copied!');
                  });
              };
              
              // Funktion: Per E-Mail senden
              const handleSendEmail = () => {
                const memberName = currentMember ? currentMember.name : 'Mitarbeiter';
                const appUrl = currentLink || window.location.origin + window.location.pathname;
                const subject = encodeURIComponent(
                  lang === 'de' 
                    ? `Einladung: Mitarbeiter "${memberName}" wurde mit Ihnen geteilt`
                    : `Invitation: Employee "${memberName}" shared with you`
                );
                const body = encodeURIComponent(
                  lang === 'de'
                    ? `Hallo,\n\nich habe den Mitarbeiter "${memberName}" im Performance Management System mit Ihnen geteilt.\n\nBitte loggen Sie sich unter folgendem Link ein:\n${appUrl}\n\nNach dem Login sehen Sie den Mitarbeiter in Ihrer Team-√úbersicht.\n\nMit freundlichen Gr√º√üen`
                    : `Hello,\n\nI have shared the employee "${memberName}" with you in the Performance Management System.\n\nPlease log in at:\n${appUrl}\n\nAfter logging in, you will see the employee in your team overview.\n\nBest regards`
                );
                window.open('mailto:' + currentEmail + '?subject=' + subject + '&body=' + body);
              };
              
              // Modal schlie√üen
              const handleClose = () => {
                setShareModalOpen(false);
                setShareModalMember(null);
                setShareModalEmail('');
                setShareModalLink('');
                setShareModalStep(1);
              };
              
              // RENDER MODAL
              return React.createElement('div', {
                className: 'fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4',
                onClick: (e) => { if (e.target === e.currentTarget) handleClose(); }
              },
                React.createElement('div', { 
                  className: 'bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden',
                  onClick: (e) => e.stopPropagation()
                },
                  // Header
                  React.createElement('div', { 
                    className: 'bg-gradient-to-r from-[#243186] to-[#1a2460] text-white p-5'
                  },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                      React.createElement('div', { className: 'flex items-center gap-3' },
                        React.createElement(Users, { size: 22 }),
                        React.createElement('div', null,
                          React.createElement('h3', { className: 'font-bold text-lg' }, 
                            lang === 'de' ? 'Mitarbeiter teilen' : 'Share Employee'
                          ),
                          currentMember && React.createElement('p', { className: 'text-white/80 text-sm' }, 
                            currentMember.name
                          )
                        )
                      ),
                      React.createElement('button', {
                        onClick: handleClose,
                        className: 'text-white/80 hover:text-white p-1'
                      }, React.createElement(X, { size: 22 }))
                    )
                  ),
                  
                  // Content
                  React.createElement('div', { className: 'p-5' },
                    currentStep === 1 ? (
                      // STEP 1: E-Mail eingeben
                      React.createElement('div', { className: 'space-y-4' },
                        React.createElement('p', { className: 'text-slate-600 text-sm' },
                          lang === 'de' 
                            ? 'Geben Sie die E-Mail-Adresse der F√ºhrungskraft ein, die diesen Mitarbeiter mitverwalten soll:'
                            : 'Enter the email of the manager who should co-manage this employee:'
                        ),
                        React.createElement('input', {
                          type: 'email',
                          value: currentEmail,
                          onChange: (e) => setShareModalEmail(e.target.value),
                          onKeyDown: (e) => { if (e.key === 'Enter') handleShare(); },
                          placeholder: 'email@example.com',
                          className: 'w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-[#243186] focus:outline-none text-base',
                          autoFocus: true
                        }),
                        React.createElement('button', {
                          onClick: handleShare,
                          disabled: !currentEmail,
                          className: 'w-full py-3 bg-[#6EBD84] hover:bg-[#5da872] disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2'
                        },
                          React.createElement(Share2, { size: 18 }),
                          lang === 'de' ? 'Teilen' : 'Share'
                        )
                      )
                    ) : (
                      // STEP 2: Erfolg + Link
                      React.createElement('div', { className: 'space-y-4' },
                        // Erfolgs-Banner
                        React.createElement('div', { 
                          className: 'bg-green-50 border border-green-200 rounded-xl p-4 flex items-center gap-3'
                        },
                          React.createElement(CheckCircle2, { size: 24, className: 'text-green-600 flex-shrink-0' }),
                          React.createElement('div', null,
                            React.createElement('p', { className: 'font-bold text-green-800' },
                              lang === 'de' ? 'Erfolgreich geteilt!' : 'Successfully shared!'
                            ),
                            React.createElement('p', { className: 'text-green-600 text-sm' },
                              currentEmail
                            )
                          )
                        ),
                        
                        // Info-Box
                        React.createElement('div', { 
                          className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 text-sm text-blue-800'
                        },
                          React.createElement('p', { className: 'font-medium mb-1' },
                            lang === 'de' ? 'Was passiert jetzt?' : 'What happens now?'
                          ),
                          React.createElement('p', null,
                            lang === 'de' 
                              ? `Wenn sich ${currentEmail} einloggt, sieht diese Person "${currentMember ? currentMember.name : ''}" automatisch in ihrer Team-√úbersicht.`
                              : `When ${currentEmail} logs in, they will automatically see "${currentMember ? currentMember.name : ''}" in their team overview.`
                          )
                        ),
                        
                        // Buttons
                        React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                          React.createElement('button', {
                            onClick: handleCopyLink,
                            className: 'py-3 bg-[#243186] hover:bg-[#1a2460] text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2'
                          },
                            React.createElement(Copy, { size: 16 }),
                            lang === 'de' ? 'Link kopieren' : 'Copy Link'
                          ),
                          React.createElement('button', {
                            onClick: handleSendEmail,
                            className: 'py-3 bg-[#6EBD84] hover:bg-[#5da872] text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2'
                          },
                            React.createElement(Mail, { size: 16 }),
                            lang === 'de' ? 'E-Mail senden' : 'Send Email'
                          )
                        ),
                        
                        // Schlie√üen
                        React.createElement('button', {
                          onClick: handleClose,
                          className: 'w-full py-2 text-slate-500 hover:text-slate-700 text-sm'
                        },
                          lang === 'de' ? 'Schlie√üen' : 'Close'
                        )
                      )
                    )
                  )
                )
              );
            };
            
            // Termin setzen - √∂ffnet Modal statt prompt()
            const scheduleDate = (member) => {
              setScheduleModalMember(member);
              // Pre-fill mit bestehendem Termin oder leer
              const existing = member.scheduledAt 
                ? new Date(member.scheduledAt).toISOString().slice(0, 16) 
                : '';
              setScheduleModalDate(existing);
              setScheduleModalOpen(true);
            };
            
            // Termin speichern (aus Modal)
            const saveScheduleDate = async () => {
              if (!scheduleModalMember || !scheduleModalDate) {
                setScheduleModalOpen(false);
                return;
              }
              
              const parsed = new Date(scheduleModalDate);
              if (isNaN(parsed)) { 
                alert(lang === 'de' ? 'Ung√ºltiges Datum!' : 'Invalid date!'); 
                return; 
              }
              
              try {
                await db.collection('teamMembers').doc(scheduleModalMember.id).update({ 
                  scheduledAt: parsed.toISOString(),
                  scheduledSource: 'manual' // Markiere als "manuell gesetzt"
                });
                
                // ICS Download
                const end = new Date(parsed.getTime() + 3600000);
                const fmt = d => d.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                const ics = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Niederwieser//Performance Manager//DE\nBEGIN:VEVENT\nUID:${scheduleModalMember.id}@niederwieser.com\nDTSTART:${fmt(parsed)}\nDTEND:${fmt(end)}\nSUMMARY:Jahresgespr√§ch ${scheduleModalMember.name}\nDESCRIPTION:Performance Review Meeting\nEND:VEVENT\nEND:VCALENDAR`;
                const a = document.createElement('a');
                a.href = URL.createObjectURL(new Blob([ics], {type:'text/calendar'}));
                a.download = `Termin_${scheduleModalMember.name.replace(/\s+/g,'_')}.ics`;
                a.click();
                
                setScheduleModalOpen(false);
                setScheduleModalMember(null);
              } catch (e) { 
                console.error(e); 
                alert(lang === 'de' ? 'Fehler beim Speichern!' : 'Error saving!');
              }
            };
            
            // Termin l√∂schen
            const deleteScheduleDate = async () => {
              if (!scheduleModalMember) return;
              if (!confirm(lang === 'de' ? 'Termin wirklich l√∂schen?' : 'Really delete appointment?')) return;
              
              try {
                await db.collection('teamMembers').doc(scheduleModalMember.id).update({ 
                  scheduledAt: null,
                  scheduledSource: null
                });
                setScheduleModalOpen(false);
                setScheduleModalMember(null);
              } catch (e) { 
                console.error(e); 
              }
            };
            
            // Status berechnen
            const getStatus = (member) => {
              const appraisals = teamAppraisals.filter(a => a.employeeId === member.id);
              
              // Finde digitale Selbstreflexion (ohne PDF)
              const digitalSelf = appraisals.find(a => 
                (a.type === 'self' || a.type === 'self-reflection' || a.type === 'self_assessment') && 
                !a.isPdfUpload
              );
              
              // Finde PDF-Selbstreflexion
              const pdfSelf = appraisals.find(a => 
                (a.type === 'self_pdf' || a.isPdfUpload === true)
              );
              
              // Bevorzuge digitale wenn vorhanden, sonst PDF
              const selfReflection = digitalSelf || pdfSelf;
              
              return {
                self: selfReflection,
                selfDigital: digitalSelf,  // Neu: Explizit digital
                selfPdf: pdfSelf,          // Neu: Explizit PDF
                review: appraisals.find(a => (a.type === 'review' || !a.type) && a.type !== 'self' && a.type !== 'self-reflection' && a.type !== 'self_assessment' && a.type !== 'self_pdf'),
                goals: appraisals.find(a => a.type === 'goal' || a.type === 'goals')
              };
            };
            
            // Fortschritt berechnen
            const totalTasks = teamMembers.length * 3;
            let completedTasks = 0;
            teamMembers.forEach(m => {
              const s = getStatus(m);
              if (s.self) completedTasks++;
              if (s.review) completedTasks++;
              if (s.goals) completedTasks++;
            });
            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            // === ERWEITERTE KPIs ===
            const now = new Date();
            const thisWeekEnd = new Date(now);
            thisWeekEnd.setDate(now.getDate() + 7);
            
            // Reviews ausstehend (ohne Review oder nur Entwurf)
            const pendingReviews = teamMembers.filter(m => {
              const s = getStatus(m);
              return !s.review || s.review.status === 'draft';
            }).length;
            
            // Selbstreflexionen fehlen (MA hat noch keine eingereicht)
            const pendingSelfReflections = teamMembers.filter(m => !getStatus(m).self).length;
            
            // Termine diese Woche
            const appointmentsThisWeek = teamMembers.filter(m => {
              if (!m.scheduledAt) return false;
              const d = new Date(m.scheduledAt);
              return d >= now && d <= thisWeekEnd;
            });
            
            // √úberf√§llige Termine
            const overdueAppointments = teamMembers.filter(m => {
              if (!m.scheduledAt) return false;
              return new Date(m.scheduledAt) < now;
            });
            
            // GPS-Durchschnitt
            const reviewsWithGPS = teamMembers.map(m => getStatus(m).review).filter(r => r && r.gpsScore);
            const avgGPS = reviewsWithGPS.length > 0 
              ? (reviewsWithGPS.reduce((sum, r) => sum + r.gpsScore, 0) / reviewsWithGPS.length).toFixed(1)
              : null;
            
            // === RENDER ===
            return React.createElement('div', { className: 'space-y-6 pb-10 max-w-5xl mx-auto' },
              
              // === HEADER (Kompakter) ===
              React.createElement('div', { 
                className: 'rounded-3xl p-6 text-white relative overflow-hidden',
                style: { background: 'linear-gradient(135deg, #243186 0%, #1a2563 100%)' }
              },
                // Decorative circles
                React.createElement('div', { 
                  className: 'absolute -right-10 -top-10 w-40 h-40 rounded-full bg-white/5'
                }),
                React.createElement('div', { 
                  className: 'absolute -right-5 -bottom-10 w-32 h-32 rounded-full bg-white/5'
                }),
                
                React.createElement('div', { className: 'relative flex justify-between items-start' },
                  React.createElement('div', null,
                    React.createElement('h1', { className: 'text-2xl font-bold flex items-center gap-3' },
                      React.createElement(Users, { size: 28 }),
                      lang === 'de' ? 'Team-√úbersicht' : lang === 'it' ? 'Panoramica team' : 'Team Overview'
                    ),
                    React.createElement('p', { className: 'text-blue-200 mt-1 text-sm' },
                      `${teamMembers.length} ${lang === 'de' ? 'Mitarbeiter' : 'employees'}`
                    )
                  ),
                  React.createElement('button', {
                    onClick: handleLogout,
                    className: 'px-4 py-2 bg-white/10 hover:bg-white/20 rounded-2xl text-sm flex items-center gap-2 backdrop-blur-sm border border-white/10'
                  }, React.createElement(LogOut, { size: 16 }), 'Logout')
                ),
                
                // Mini Progress
                teamMembers.length > 0 && React.createElement('div', { className: 'relative mt-4 flex items-center gap-3' },
                  React.createElement('div', { className: 'flex-1 bg-white/20 rounded-full h-2' },
                    React.createElement('div', { 
                      className: 'h-full rounded-full bg-[#6EBD84] transition-all',
                      style: { width: `${progress}%` }
                    })
                  ),
                  React.createElement('span', { className: 'text-sm font-semibold' }, `${progress}%`)
                )
              ),
              
              // === KPI-DASHBOARD CARDS ===
              teamMembers.length > 0 && React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-3' },
                // Card 1: Offene Reviews
                React.createElement('div', { 
                  className: `p-4 rounded-2xl border-2 transition-all cursor-pointer hover:shadow-lg ${
                    pendingReviews > 0 ? 'bg-amber-50 border-amber-200 hover:border-amber-400' : 'bg-green-50 border-green-200'
                  }`,
                  onClick: () => {} // TODO: Filter
                },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('div', { 
                      className: `w-10 h-10 rounded-xl flex items-center justify-center ${
                        pendingReviews > 0 ? 'bg-amber-500 text-white' : 'bg-green-500 text-white'
                      }`
                    }, React.createElement(ClipboardList, { size: 20 })),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, pendingReviews),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        lang === 'de' ? 'Reviews offen' : 'Reviews pending'
                      )
                    )
                  )
                ),
                
                // Card 2: Selbstreflexionen
                React.createElement('div', { 
                  className: `p-4 rounded-2xl border-2 transition-all cursor-pointer hover:shadow-lg ${
                    pendingSelfReflections > 0 ? 'bg-teal-50 border-teal-200 hover:border-teal-400' : 'bg-green-50 border-green-200'
                  }`
                },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('div', { 
                      className: `w-10 h-10 rounded-xl flex items-center justify-center ${
                        pendingSelfReflections > 0 ? 'bg-teal-500 text-white' : 'bg-green-500 text-white'
                      }`
                    }, React.createElement(FileText, { size: 20 })),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, pendingSelfReflections),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        lang === 'de' ? 'Selbstrefl. fehlen' : 'Self-refl. missing'
                      )
                    )
                  )
                ),
                
                // Card 3: Termine diese Woche
                React.createElement('div', { 
                  className: `p-4 rounded-2xl border-2 transition-all cursor-pointer hover:shadow-lg ${
                    overdueAppointments.length > 0 ? 'bg-red-50 border-red-200 hover:border-red-400' :
                    appointmentsThisWeek.length > 0 ? 'bg-blue-50 border-blue-200 hover:border-blue-400' : 
                    'bg-slate-50 border-slate-200'
                  }`
                },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('div', { 
                      className: `w-10 h-10 rounded-xl flex items-center justify-center ${
                        overdueAppointments.length > 0 ? 'bg-red-500 text-white' :
                        appointmentsThisWeek.length > 0 ? 'bg-blue-500 text-white' : 'bg-slate-400 text-white'
                      }`
                    }, React.createElement(Calendar, { size: 20 })),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, 
                        overdueAppointments.length > 0 ? overdueAppointments.length : appointmentsThisWeek.length
                      ),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        overdueAppointments.length > 0 
                          ? (lang === 'de' ? '‚ö†Ô∏è √úberf√§llig!' : '‚ö†Ô∏è Overdue!')
                          : (lang === 'de' ? 'Diese Woche' : 'This week')
                      )
                    )
                  )
                ),
                
                // Card 4: GPS-Durchschnitt
                React.createElement('div', { 
                  className: `p-4 rounded-2xl border-2 transition-all ${
                    avgGPS ? (avgGPS >= 3 ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200') : 'bg-slate-50 border-slate-200'
                  }`
                },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('div', { 
                      className: `w-10 h-10 rounded-xl flex items-center justify-center ${
                        avgGPS ? (avgGPS >= 3 ? 'bg-green-500 text-white' : 'bg-amber-500 text-white') : 'bg-slate-400 text-white'
                      }`
                    }, React.createElement(TrendingUp, { size: 20 })),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-2xl font-bold text-slate-800' }, avgGPS || '‚Äî'),
                      React.createElement('div', { className: 'text-xs text-slate-500' }, 
                        lang === 'de' ? '√ò GPS-Score' : 'Avg GPS Score'
                      )
                    )
                  )
                )
              ),
              
              // === HILFE-HINWEIS (Chatbot) ===
              teamMembers.length > 0 && React.createElement('div', { 
                className: 'flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-[#243186]/5 to-transparent rounded-2xl border border-[#243186]/10'
              },
                React.createElement('div', { className: 'w-8 h-8 rounded-xl bg-[#243186] flex items-center justify-center' },
                  React.createElement(MessageCircle, { size: 16, className: 'text-white' })
                ),
                React.createElement('div', { className: 'flex-1' },
                  React.createElement('span', { className: 'text-sm text-slate-600' },
                    lang === 'de' 
                      ? 'Brauchst du Hilfe? Der HR-Copilot unten rechts kennt alle Prozesse!' 
                      : 'Need help? The HR Copilot in the bottom right knows all processes!'
                  )
                ),
                React.createElement('div', { className: 'text-xs text-slate-400 animate-bounce' }, 'üëá')
              ),
              
              // === MITARBEITER HINZUF√úGEN (Apple Style) ===
              React.createElement('div', { className: 'bg-white rounded-2xl p-5 shadow-sm border border-slate-100' },
                React.createElement('div', { className: 'flex items-center gap-2 mb-3' },
                  React.createElement(UserPlus, { size: 18, className: 'text-slate-400' }),
                  React.createElement('span', { className: 'font-medium text-slate-700' }, 
                    lang === 'de' ? 'Neuen Mitarbeiter hinzuf√ºgen' : 'Add new employee'
                  )
                ),
                React.createElement('div', { className: 'flex flex-wrap gap-3 items-center' },
                  React.createElement('input', { 
                    id: 'add-name', type: 'text', 
                    placeholder: lang === 'de' ? 'Name *' : 'Name *',
                    className: 'flex-1 min-w-[150px] bg-slate-100 border-transparent rounded-xl px-4 py-2.5 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none transition-all' 
                  }),
                  React.createElement('input', { 
                    id: 'add-pos', type: 'text', 
                    placeholder: lang === 'de' ? 'Position *' : 'Position *',
                    className: 'flex-1 min-w-[150px] bg-slate-100 border-transparent rounded-xl px-4 py-2.5 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none transition-all' 
                  }),
                  React.createElement('input', { 
                    id: 'add-email', type: 'email', 
                    placeholder: 'E-Mail (optional)',
                    className: 'flex-1 min-w-[180px] bg-slate-100 border-transparent rounded-xl px-4 py-2.5 text-sm focus:bg-white focus:ring-2 focus:ring-[#243186]/20 outline-none transition-all' 
                  }),
                  React.createElement('button', {
                    onClick: () => {
                      const name = document.getElementById('add-name').value.trim();
                      const position = document.getElementById('add-pos').value.trim();
                      const email = document.getElementById('add-email').value.trim();
                      if (name && position) {
                        addTeamMember({ name, position, email });
                        document.getElementById('add-name').value = '';
                        document.getElementById('add-pos').value = '';
                        document.getElementById('add-email').value = '';
                      } else {
                        alert(lang === 'de' ? 'Name und Position sind Pflichtfelder!' : 'Name and position required!');
                      }
                    },
                    className: 'px-5 py-2.5 bg-[#6EBD84] text-white rounded-xl hover:bg-[#5da872] font-semibold flex items-center gap-2 shadow-lg shadow-[#6EBD84]/30 transition-all hover:scale-105'
                  }, React.createElement(UserPlus, { size: 18 }), lang === 'de' ? 'Hinzuf√ºgen' : 'Add')
                )
              ),
              
              // === MITARBEITER-LISTE (Neu gestaltet) ===
              teamMembers.length === 0 
                ? React.createElement('div', { className: 'bg-slate-50 rounded-2xl p-12 text-center' },
                    React.createElement('div', { className: 'w-16 h-16 mx-auto mb-4 rounded-2xl bg-slate-200 flex items-center justify-center' },
                      React.createElement(Users, { size: 32, className: 'text-slate-400' })
                    ),
                    React.createElement('h3', { className: 'font-semibold text-slate-700 mb-1' }, 
                      lang === 'de' ? 'Noch keine Mitarbeiter' : 'No employees yet'
                    ),
                    React.createElement('p', { className: 'text-sm text-slate-500' },
                      lang === 'de' ? 'F√ºgen Sie oben Ihre Teammitglieder hinzu.' : 'Add your team members above.'
                    )
                  )
                : React.createElement('div', { className: 'space-y-4' },
                    teamMembers.map(member => {
                      const status = getStatus(member);
                      const isOwner = member._isOwner !== false;
                      const isShared = member.sharedWith?.length > 0;
                      const gps = status.review?.gpsScore;
                      const done = [status.self, status.review, status.goals].filter(Boolean).length;
                      const selfLink = getSelfLink(member);
                      
                      // Termin-Status
                      const scheduledDate = member.scheduledAt ? new Date(member.scheduledAt) : null;
                      const isOverdue = scheduledDate && scheduledDate < now;
                      const daysUntil = scheduledDate ? Math.ceil((scheduledDate - now) / (1000 * 60 * 60 * 24)) : null;
                      
                      return React.createElement('div', { 
                        key: member.id,
                        className: `bg-white rounded-2xl shadow-sm border-2 overflow-hidden transition-all hover:shadow-lg ${
                          done === 3 ? 'border-green-300' : 
                          isOverdue ? 'border-red-300' :
                          !isOwner ? 'border-indigo-200' : 
                          'border-slate-200 hover:border-[#6EBD84]'
                        }`
                      },
                        // === HEADER-ZEILE ===
                        React.createElement('div', { 
                          className: `px-5 py-4 flex items-center gap-4 ${
                            done === 3 ? 'bg-green-50' : isOverdue ? 'bg-red-50' : !isOwner ? 'bg-indigo-50' : 'bg-slate-50'
                          }`
                        },
                          // Avatar
                          React.createElement('div', { 
                            className: `w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${
                              done === 3 ? 'bg-green-500 text-white' :
                              gps ? (gps >= 3 ? 'bg-gradient-to-br from-green-400 to-green-600 text-white' : 'bg-gradient-to-br from-amber-400 to-amber-600 text-white') :
                              'bg-slate-200 text-slate-600'
                            }`
                          }, member.name.split(' ').map(n => n[0]).join('').slice(0,2).toUpperCase()),
                          
                          // Name & Info
                          React.createElement('div', { className: 'flex-1 min-w-0' },
                            React.createElement('div', { className: 'flex items-center gap-2 flex-wrap' },
                              React.createElement('span', { className: 'font-semibold text-slate-900 truncate' }, member.name),
                              gps && React.createElement('span', { 
                                className: `text-xs font-bold px-2 py-0.5 rounded-full ${
                                  gps >= 3 ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'
                                }`
                              }, `GPS ${gps.toFixed(1)}`),
                              done === 3 && React.createElement('span', { className: 'text-xs bg-green-500 text-white px-2 py-0.5 rounded-full' }, '‚úì Komplett'),
                              !isOwner && React.createElement('span', { className: 'text-xs bg-indigo-100 text-indigo-600 px-2 py-0.5 rounded-full' }, 'Geteilt')
                            ),
                            React.createElement('div', { className: 'text-sm text-slate-500' }, member.position)
                          ),
                          
                          // Quick Actions (minimiert)
                          React.createElement('div', { className: 'flex items-center gap-1' },
                            isOwner && React.createElement('button', {
                              onClick: () => shareMember(member),
                              className: `w-8 h-8 rounded-lg flex items-center justify-center transition-all ${isShared ? 'bg-purple-100 text-purple-600' : 'bg-slate-100 text-slate-400 hover:bg-purple-50 hover:text-purple-500'}`,
                              title: lang === 'de' ? 'Teilen' : 'Share'
                            }, React.createElement(Share2, { size: 14 })),
                            isOwner && React.createElement('button', {
                              onClick: () => { if (confirm(`"${member.name}" entfernen?`)) deleteTeamMember(member.id); },
                              className: 'w-8 h-8 rounded-lg flex items-center justify-center bg-slate-100 text-slate-400 hover:bg-red-50 hover:text-red-500 transition-all',
                              title: lang === 'de' ? 'Entfernen' : 'Remove'
                            }, React.createElement(Trash2, { size: 14 }))
                          )
                        ),
                        
                        // === TERMIN-ZEILE (wenn vorhanden oder n√∂tig) ===
                        React.createElement('div', { 
                          className: 'px-5 py-3 border-t border-slate-100 flex items-center gap-3 flex-wrap',
                          style: { background: scheduledDate ? (isOverdue ? '#fef2f2' : '#f0f9ff') : '#fafafa' }
                        },
                          // Termin-Info oder CTA
                          scheduledDate 
                            ? React.createElement('div', { 
                                className: `flex items-center gap-2 px-3 py-1.5 rounded-lg cursor-pointer transition-all ${
                                  isOverdue ? 'bg-red-100 text-red-700 hover:bg-red-200' : 'bg-blue-100 text-blue-700 hover:bg-blue-200'
                                }`,
                                onClick: () => scheduleDate(member)
                              },
                                member.scheduledSource === 'form' ? React.createElement(FileText, { size: 14 }) : React.createElement(Calendar, { size: 14 }),
                                React.createElement('span', { className: 'text-sm font-medium' },
                                  isOverdue 
                                    ? `‚ö†Ô∏è √úberf√§llig: ${scheduledDate.toLocaleDateString('de-DE')}`
                                    : daysUntil === 0 
                                      ? `HEUTE ${scheduledDate.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}`
                                      : daysUntil <= 7
                                        ? `In ${daysUntil} Tagen ‚Ä¢ ${scheduledDate.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit' })}`
                                        : scheduledDate.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' })
                                )
                              )
                            : React.createElement('button', {
                                onClick: () => scheduleDate(member),
                                className: 'flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-100 text-slate-500 hover:bg-blue-50 hover:text-blue-600 transition-all text-sm'
                              },
                                React.createElement(Calendar, { size: 14 }),
                                lang === 'de' ? 'üìÖ Termin festlegen' : 'üìÖ Schedule meeting'
                              ),
                          
                          // Spacer
                          React.createElement('div', { className: 'flex-1' }),
                          
                          // Einladungslink (wenn Selbstreflexion fehlt)
                          !status.self && selfLink && React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('button', {
                              onClick: () => copyLink(member),
                              className: 'flex items-center gap-1.5 px-3 py-1.5 bg-slate-600 text-white rounded-lg hover:bg-slate-700 text-xs font-medium transition-all'
                            }, React.createElement(Link, { size: 12 }), lang === 'de' ? 'Link f√ºr Selbstreflexion kopieren' : lang === 'it' ? 'Copia link autovalutazione' : 'Copy self-reflection link'),
                            member.email && React.createElement('button', {
                              onClick: () => sendEmail(member),
                              className: 'flex items-center gap-1.5 px-3 py-1.5 bg-teal-600 text-white rounded-lg hover:bg-teal-700 text-xs font-medium transition-all'
                            }, React.createElement(Mail, { size: 12 }), lang === 'de' ? 'Link per E-Mail senden' : lang === 'it' ? 'Invia link via e-mail' : 'Send link via email')
                          )
                        ),
                        
                        // === STATUS-KARTEN (3 Spalten mit klaren Labels) ===
                        React.createElement('div', { className: 'p-5 grid grid-cols-3 gap-3' },
                          // SELBSTREFLEXION (Verbessert mit 3 Aktionen inkl. PDF-Upload)
                          React.createElement('div', { 
                            className: `p-4 rounded-xl transition-all ${
                              status.self 
                                ? 'bg-teal-50 border-2 border-teal-200' 
                                : 'bg-slate-50 border-2 border-dashed border-slate-200'
                            }`
                          },
                            React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                              React.createElement('div', { 
                                className: `w-8 h-8 rounded-lg flex items-center justify-center ${status.self ? 'bg-teal-500 text-white' : 'bg-slate-200 text-slate-400'}`
                              }, status.self ? React.createElement(CheckCircle2, { size: 16 }) : React.createElement(FileText, { size: 16 })),
                              React.createElement('span', { className: 'font-semibold text-sm text-slate-700' }, 
                                lang === 'de' ? 'Selbstreflexion' : lang === 'it' ? 'Autovalutazione' : 'Self-Reflection'
                              )
                            ),
                            // Status-Label - zeige beide Typen wenn vorhanden
                            React.createElement('div', { className: `text-xs mb-3 space-y-1` },
                              // Digital vorhanden?
                              status.selfDigital && React.createElement('div', { className: 'text-teal-600' },
                                `‚úì ${lang === 'de' ? 'Digital eingegangen' : lang === 'it' ? 'Ricevuta digitale' : 'Digital received'}${status.selfDigital.createdAt || status.selfDigital.submittedAt ? ` ${new Date(status.selfDigital.createdAt || status.selfDigital.submittedAt).toLocaleDateString(lang === 'de' ? 'de-DE' : lang === 'it' ? 'it-IT' : 'en-GB')}` : ''}`
                              ),
                              // PDF vorhanden?
                              status.selfPdf && React.createElement('div', { className: 'text-amber-600' },
                                `üìÑ PDF: ${status.selfPdf.pdfFileName || 'Dokument'}`
                              ),
                              // Nichts vorhanden?
                              !status.selfDigital && !status.selfPdf && React.createElement('div', { className: 'text-slate-400' },
                                `‚è≥ ${lang === 'de' ? 'Noch nicht ausgef√ºllt' : lang === 'it' ? 'Non ancora compilata' : 'Not yet completed'}`
                              )
                            ),
                            // === AKTIONS-BUTTONS ===
                            React.createElement('div', { className: 'flex flex-col gap-2 pt-2 border-t border-slate-100' },
                              // Buttons f√ºr Digital-Ansicht (wenn vorhanden)
                              status.selfDigital && React.createElement('button', {
                                onClick: (e) => {
                                  e.stopPropagation();
                                  setActiveView('viewSelfAssessment');
                                  localStorage.setItem('nw_view_self_assessment', JSON.stringify(status.selfDigital));
                                },
                                className: 'w-full py-2 px-3 bg-teal-500 text-white rounded-lg text-xs font-semibold hover:bg-teal-600 transition-all flex items-center justify-center gap-2'
                              }, 
                                React.createElement(Eye, { size: 14 }),
                                lang === 'de' ? 'Digital ansehen' : lang === 'it' ? 'Visualizza digitale' : 'View Digital'
                              ),
                              
                              // PDF-Bereich (wenn vorhanden)
                              status.selfPdf && React.createElement('div', {
                                className: 'w-full bg-amber-50 border border-amber-200 rounded-lg p-2 space-y-2'
                              },
                                // PDF-Info
                                React.createElement('div', { className: 'flex items-center gap-2 text-amber-700 text-xs' },
                                  React.createElement(FileText, { size: 14 }),
                                  React.createElement('span', { className: 'truncate flex-1' }, status.selfPdf.pdfFileName || 'Selbstreflexion.pdf'),
                                  React.createElement('span', { className: 'text-amber-500' }, 
                                    status.selfPdf.pdfSize ? (status.selfPdf.pdfSize / 1024 / 1024).toFixed(2) + ' MB' : ''
                                  )
                                ),
                                // Buttons
                                React.createElement('div', { className: 'flex gap-1' },
                                  // Ansehen-Button (√∂ffnet im neuen Tab)
                                  React.createElement('button', {
                                    onClick: async (e) => {
                                      e.stopPropagation();
                                      try {
                                        let pdfSource = status.selfPdf.pdfUrl || status.selfPdf.pdfData;
                                        
                                        // Wenn storagePath vorhanden, hole frische URL
                                        if (status.selfPdf.storagePath && storage) {
                                          console.log('üîÑ Hole frische Download-URL...');
                                          pdfSource = await storage.ref(status.selfPdf.storagePath).getDownloadURL();
                                          console.log('‚úÖ URL erhalten');
                                        }
                                        
                                        // √ñffne PDF in neuem Tab
                                        if (pdfSource && pdfSource.startsWith('http')) {
                                          window.open(pdfSource, '_blank');
                                        } else if (pdfSource) {
                                          const pdfWindow = window.open('', '_blank');
                                          pdfWindow.document.write(
                                            '<html><head><title>' + (status.selfPdf.pdfFileName || 'PDF') + '</title></head>' +
                                            '<body style="margin:0;padding:0;">' +
                                            '<embed width="100%" height="100%" src="' + pdfSource + '" type="application/pdf">' +
                                            '</body></html>'
                                          );
                                        }
                                      } catch (err) {
                                        console.error('‚ùå Fehler beim √ñffnen der PDF:', err);
                                        alert(lang === 'de' 
                                          ? 'Fehler beim √ñffnen der PDF. Bitte pr√ºfen Sie die Firebase Storage Regeln.'
                                          : 'Error opening PDF. Please check Firebase Storage rules.');
                                      }
                                    },
                                    className: 'flex-1 py-1.5 px-2 bg-amber-100 text-amber-700 rounded text-xs font-medium hover:bg-amber-200 transition-all flex items-center justify-center gap-1'
                                  }, 
                                    React.createElement(Eye, { size: 12 }),
                                    lang === 'de' ? 'Ansehen' : lang === 'it' ? 'Visualizza' : 'View'
                                  ),
                                  // Download-Button
                                  React.createElement('button', {
                                    onClick: async (e) => {
                                      e.stopPropagation();
                                      try {
                                        let pdfSource = status.selfPdf.pdfUrl || status.selfPdf.pdfData;
                                        
                                        // Wenn storagePath vorhanden, hole frische URL
                                        if (status.selfPdf.storagePath && storage) {
                                          console.log('üîÑ Hole frische Download-URL...');
                                          pdfSource = await storage.ref(status.selfPdf.storagePath).getDownloadURL();
                                        }
                                        
                                        if (pdfSource) {
                                          const link = document.createElement('a');
                                          link.href = pdfSource;
                                          link.target = '_blank';
                                          link.download = status.selfPdf.pdfFileName || 'Selbstreflexion.pdf';
                                          link.click();
                                        }
                                      } catch (err) {
                                        console.error('‚ùå Fehler beim Download:', err);
                                        alert(lang === 'de' 
                                          ? 'Fehler beim Download. Bitte pr√ºfen Sie die Firebase Storage Regeln.'
                                          : 'Download error. Please check Firebase Storage rules.');
                                      }
                                    },
                                    className: 'flex-1 py-1.5 px-2 bg-amber-500 text-white rounded text-xs font-semibold hover:bg-amber-600 transition-all flex items-center justify-center gap-1'
                                  }, 
                                    React.createElement(Download, { size: 12 }),
                                    lang === 'de' ? 'Download' : lang === 'it' ? 'Scarica' : 'Download'
                                  )
                                )
                              ),
                              
                              // Info wenn nichts vorhanden
                              !status.selfDigital && !status.selfPdf && React.createElement('div', {
                                className: 'w-full py-2 px-3 bg-slate-100 text-slate-500 rounded-lg text-xs text-center'
                              }, 
                                lang === 'de' ? 'Noch keine Daten vorhanden' : lang === 'it' ? 'Nessun dato disponibile' : 'No data available'
                              ),
                              
                              // Button-Reihe 2: Link + E-Mail
                              React.createElement('div', { className: 'flex gap-1' },
                                React.createElement('button', {
                                  onClick: (e) => {
                                    e.stopPropagation();
                                    copyLink(member);
                                  },
                                  className: 'flex-1 py-1.5 px-2 bg-slate-200 text-slate-600 rounded-lg text-xs font-medium hover:bg-slate-300 transition-all flex items-center justify-center gap-1',
                                  title: lang === 'de' ? 'Link f√ºr Selbstreflexion kopieren' : lang === 'it' ? 'Copia link autovalutazione' : 'Copy self-reflection link'
                                }, 
                                  React.createElement(Link, { size: 12 }),
                                  lang === 'de' ? 'SR-Link' : 'Link'
                                ),
                                member.email && React.createElement('button', {
                                  onClick: (e) => {
                                    e.stopPropagation();
                                    sendEmail(member);
                                  },
                                  className: 'flex-1 py-1.5 px-2 bg-[#243186] text-white rounded-lg text-xs font-medium hover:bg-[#1a2563] transition-all flex items-center justify-center gap-1',
                                  title: lang === 'de' ? 'Selbstreflexions-Link per E-Mail senden' : lang === 'it' ? 'Invia link autovalutazione via email' : 'Send self-reflection link via email'
                                }, 
                                  React.createElement(Mail, { size: 12 }),
                                  'E-Mail'
                                )
                              ),
                              // Button 3: PDF Upload (NEU)
                              React.createElement('label', {
                                className: 'w-full py-1.5 px-2 bg-amber-100 text-amber-700 rounded-lg text-xs font-medium hover:bg-amber-200 transition-all flex items-center justify-center gap-1 cursor-pointer',
                                title: lang === 'de' ? 'PDF-Selbstreflexion hochladen' : lang === 'it' ? 'Carica PDF autovalutazione' : 'Upload PDF self-reflection'
                              },
                                React.createElement('input', {
                                  type: 'file',
                                  accept: '.pdf',
                                  className: 'hidden',
                                  onChange: (e) => {
                                    const file = e.target.files?.[0];
                                    if (file) {
                                      handleSelfReflectionPdfUpload(member, file);
                                      e.target.value = ''; // Reset f√ºr erneuten Upload
                                    }
                                  }
                                }),
                                React.createElement(Upload, { size: 12 }),
                                lang === 'de' ? 'PDF hochladen' : lang === 'it' ? 'Carica PDF' : 'Upload PDF'
                              )
                            )
                          ),
                          
                          // BEURTEILUNG
                          React.createElement('div', { 
                            onClick: () => startTeamAppraisal(member.id, new Date().getFullYear().toString(), status.review || null),
                            className: `p-4 rounded-xl cursor-pointer transition-all hover:shadow-md ${
                              status.review 
                                ? status.review.status === 'completed'
                                  ? 'bg-blue-50 border-2 border-blue-200 hover:border-blue-400'
                                  : 'bg-amber-50 border-2 border-amber-200 hover:border-amber-400'
                                : 'bg-slate-50 border-2 border-dashed border-slate-200 hover:border-blue-400 hover:bg-blue-50'
                            }`
                          },
                            React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                              React.createElement('div', { 
                                className: `w-8 h-8 rounded-lg flex items-center justify-center ${
                                  status.review 
                                    ? status.review.status === 'completed' ? 'bg-blue-500 text-white' : 'bg-amber-500 text-white'
                                    : 'bg-slate-200 text-slate-400'
                                }`
                              }, 
                                status.review 
                                  ? status.review.status === 'completed' 
                                    ? React.createElement(CheckCircle2, { size: 16 })
                                    : React.createElement(Edit3, { size: 16 })
                                  : React.createElement(ClipboardList, { size: 16 })
                              ),
                              React.createElement('span', { className: 'font-semibold text-sm text-slate-700' }, 'Beurteilung')
                            ),
                            // Status-Label
                            React.createElement('div', { className: `text-xs ${
                              status.review 
                                ? status.review.status === 'completed' ? 'text-blue-600' : 'text-amber-600'
                                : 'text-slate-400'
                            }` },
                              status.review 
                                ? status.review.status === 'completed'
                                  ? `‚úì Abgeschlossen${status.review.gpsScore ? ` ‚Ä¢ GPS ${status.review.gpsScore.toFixed(1)}` : ''}`
                                  : '‚úé Entwurf gespeichert'
                                : '‚óã Noch nicht begonnen'
                            ),
                            // CTA
                            React.createElement('div', { className: 'mt-2 pt-2 border-t border-slate-100 text-xs font-medium text-center' },
                              status.review 
                                ? status.review.status === 'completed'
                                  ? React.createElement('span', { className: 'text-blue-600' }, '‚Üí Bearbeiten')
                                  : React.createElement('span', { className: 'text-amber-600' }, '‚Üí Fortsetzen')
                                : React.createElement('span', { className: 'text-[#243186] font-bold' }, '‚Üí Review starten')
                            )
                          ),
                          
                          // ZIELVEREINBARUNG
                          React.createElement('div', { 
                            onClick: () => startTeamGoalSetting(member.id, new Date().getFullYear().toString(), status.goals || null),
                            className: `p-4 rounded-xl cursor-pointer transition-all hover:shadow-md ${
                              status.goals 
                                ? 'bg-purple-50 border-2 border-purple-200 hover:border-purple-400' 
                                : 'bg-slate-50 border-2 border-dashed border-slate-200 hover:border-purple-400 hover:bg-purple-50'
                            }`
                          },
                            React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                              React.createElement('div', { 
                                className: `w-8 h-8 rounded-lg flex items-center justify-center ${status.goals ? 'bg-purple-500 text-white' : 'bg-slate-200 text-slate-400'}`
                              }, status.goals ? React.createElement(CheckCircle2, { size: 16 }) : React.createElement(Target, { size: 16 })),
                              React.createElement('span', { className: 'font-semibold text-sm text-slate-700' }, 'Zielvereinbarung')
                            ),
                            // Status-Label
                            React.createElement('div', { className: `text-xs ${status.goals ? 'text-purple-600' : 'text-slate-400'}` },
                              status.goals 
                                ? `‚úì ${status.goals.goals?.length || 0} Ziele definiert`
                                : '‚óã Noch nicht erstellt'
                            ),
                            // CTA
                            React.createElement('div', { className: 'mt-2 pt-2 border-t border-slate-100 text-xs font-medium text-center' },
                              status.goals 
                                ? React.createElement('span', { className: 'text-purple-600' }, '‚Üí Bearbeiten')
                                : React.createElement('span', { className: 'text-slate-500' }, '‚Üí Erstellen')
                            )
                          )
                        ),
                        
                        // === FOOTER: Fortschritt ===
                        React.createElement('div', { className: 'px-5 py-3 bg-slate-50 border-t border-slate-100 flex items-center gap-3' },
                          React.createElement('div', { className: 'flex gap-1 flex-1' },
                            [0, 1, 2].map(i => React.createElement('div', {
                              key: i,
                              className: `h-1.5 flex-1 rounded-full transition-all ${i < done ? (done === 3 ? 'bg-green-500' : 'bg-[#6EBD84]') : 'bg-slate-200'}`
                            }))
                          ),
                          React.createElement('span', { className: `text-xs font-semibold ${done === 3 ? 'text-green-600' : 'text-slate-500'}` },
                            done === 3 ? '‚úì Alles erledigt' : `${done} von 3 erledigt`
                          )
                        )
                      );
                    })
                  ),
              
              // === TERMIN-MODAL (Apple Style) ===
              scheduleModalOpen && React.createElement('div', { 
                className: 'fixed inset-0 z-50 flex items-center justify-center',
                onClick: () => setScheduleModalOpen(false)
              },
                // Backdrop mit Blur
                React.createElement('div', { 
                  className: 'absolute inset-0 bg-black/40 backdrop-blur-sm'
                }),
                // Modal
                React.createElement('div', { 
                  className: 'relative bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/50 p-6 w-full max-w-sm mx-4',
                  onClick: e => e.stopPropagation(),
                  style: { boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)' }
                },
                  // Header
                  React.createElement('div', { className: 'text-center mb-6' },
                    React.createElement('div', { 
                      className: 'w-14 h-14 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/30'
                    },
                      React.createElement(Calendar, { size: 28, className: 'text-white' })
                    ),
                    React.createElement('h3', { className: 'font-semibold text-lg text-slate-900' }, 
                      lang === 'de' ? 'Termin festlegen' : 'Schedule Meeting'
                    ),
                    scheduleModalMember && React.createElement('p', { className: 'text-sm text-slate-500 mt-1' }, 
                      scheduleModalMember.name
                    )
                  ),
                  
                  // Date Input
                  React.createElement('div', { className: 'mb-6' },
                    React.createElement('label', { className: 'block text-xs font-medium text-slate-500 mb-2' },
                      lang === 'de' ? 'Datum & Uhrzeit' : 'Date & Time'
                    ),
                    React.createElement('input', {
                      type: 'datetime-local',
                      value: scheduleModalDate,
                      onChange: e => setScheduleModalDate(e.target.value),
                      className: 'w-full px-4 py-3 bg-slate-100 border-transparent rounded-2xl text-slate-900 text-center text-lg font-medium focus:bg-white focus:ring-2 focus:ring-blue-500/20 outline-none transition-all'
                    })
                  ),
                  
                  // Quelle-Hinweis wenn aus Formular
                  scheduleModalMember?.scheduledSource === 'form' && React.createElement('div', { 
                    className: 'mb-4 px-3 py-2 bg-amber-50 border border-amber-200 rounded-xl text-xs text-amber-700 text-center'
                  },
                    'üìù ' + (lang === 'de' ? 'Automatisch aus Bewertungsbogen √ºbernommen' : 'Auto-synced from evaluation form')
                  ),
                  
                  // Buttons
                  React.createElement('div', { className: 'flex gap-3' },
                    // L√∂schen (nur wenn Termin existiert)
                    scheduleModalMember?.scheduledAt && React.createElement('button', {
                      onClick: deleteScheduleDate,
                      className: 'flex-1 py-3 rounded-2xl font-semibold text-red-600 bg-red-50 hover:bg-red-100 transition-colors'
                    }, lang === 'de' ? 'L√∂schen' : 'Delete'),
                    
                    // Speichern
                    React.createElement('button', {
                      onClick: saveScheduleDate,
                      className: 'flex-1 py-3 rounded-2xl font-semibold text-white bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/30 transition-all'
                    }, 
                      React.createElement('span', { className: 'flex items-center justify-center gap-2' },
                        React.createElement(Calendar, { size: 16 }),
                        lang === 'de' ? 'Speichern' : 'Save'
                      )
                    )
                  ),
                  
                  // Close Button
                  React.createElement('button', {
                    onClick: () => setScheduleModalOpen(false),
                    className: 'absolute top-4 right-4 w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors'
                  },
                    React.createElement(X, { size: 16, className: 'text-slate-500' })
                  )
                )
              ),
              
              // === LEGENDE ===
              teamMembers.length > 0 && React.createElement('div', { className: 'flex flex-wrap gap-4 text-xs text-slate-500 justify-center' },
                React.createElement('span', { className: 'flex items-center gap-1' },
                  React.createElement('span', { className: 'w-3 h-3 rounded bg-teal-100 border border-teal-300' }), 'Selbstreflexion'),
                React.createElement('span', { className: 'flex items-center gap-1' },
                  React.createElement('span', { className: 'w-3 h-3 rounded bg-blue-100 border border-blue-300' }), 'Beurteilung'),
                React.createElement('span', { className: 'flex items-center gap-1' },
                  React.createElement('span', { className: 'w-3 h-3 rounded bg-purple-100 border border-purple-300' }), 'Ziele'),
                React.createElement('span', { className: 'flex items-center gap-1' },
                  React.createElement('span', { className: 'w-3 h-3 rounded bg-indigo-100 border border-indigo-300' }), 'Geteilt')
              ),
              
              // === SHARE MODAL ===
              renderShareModal()
            );
            } catch (renderError) {
              console.error('‚ùå renderTeamOverview ERROR:', renderError);
              return React.createElement('div', { className: 'p-8 bg-red-50 rounded-xl border border-red-200 text-center' },
                React.createElement('h2', { className: 'text-red-700 font-bold text-xl mb-2' }, '‚ö†Ô∏è Rendering-Fehler'),
                React.createElement('p', { className: 'text-red-600 mb-4' }, renderError.message || 'Unbekannter Fehler'),
                React.createElement('pre', { className: 'text-left text-xs bg-red-100 p-4 rounded overflow-auto max-h-40' }, 
                  renderError.stack || 'Kein Stack-Trace verf√ºgbar'
                ),
                React.createElement('button', {
                  onClick: () => window.location.reload(),
                  className: 'mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700'
                }, 'Seite neu laden')
              );
            }
          };
          
          const renderHRDashboard = () => {
            if (hrDataLoading) {
              return React.createElement('div', { className: 'flex justify-center py-20' },
                React.createElement(Loader2, { className: 'w-12 h-12 animate-spin text-purple-600' })
              );
            }
            
            // Filter
            let filtered = [...allCompanyAppraisals];
            if (hrFilter === 'completed') filtered = filtered.filter(a => a.status === 'completed');
            if (hrFilter === 'draft') filtered = filtered.filter(a => a.status === 'draft');
            if (hrFilter === 'self') filtered = filtered.filter(a => a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection' || a.type === 'self_pdf');
            if (hrFilter === 'reviews') filtered = filtered.filter(a => a.type === 'review' || !a.type);
            
            if (hrSearch) {
              const s = hrSearch.toLowerCase();
              filtered = filtered.filter(a => 
                (a.employeeName || '').toLowerCase().includes(s) ||
                (a.formData?.employee || '').toLowerCase().includes(s) ||
                (a.formData?.manager || '').toLowerCase().includes(s)
              );
            }
            
            filtered.sort((a, b) => new Date(b.updatedAt || b.createdAt || 0) - new Date(a.updatedAt || a.createdAt || 0));
            
            // Stats
            const stats = {
              members: allCompanyMembers.length,
              appraisals: allCompanyAppraisals.length,
              completed: allCompanyAppraisals.filter(a => a.status === 'completed').length,
              reviews: allCompanyAppraisals.filter(a => a.type === 'review' || !a.type).length,
              self: allCompanyAppraisals.filter(a => a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection' || a.type === 'self_pdf').length
            };
            
            const reviewsWithGPS = allCompanyAppraisals.filter(a => (a.type === 'review' || !a.type) && a.gpsScore > 0);
            const avgGPS = reviewsWithGPS.length > 0 
              ? (reviewsWithGPS.reduce((sum, a) => sum + a.gpsScore, 0) / reviewsWithGPS.length).toFixed(2)
              : '‚Äì';
            
            return React.createElement('div', { className: 'space-y-6 pb-12' },
              // Header
              React.createElement('div', { 
                className: 'rounded-2xl p-6 text-white',
                style: { background: 'linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%)' }
              },
                React.createElement('h1', { className: 'text-2xl font-bold mb-2 flex items-center gap-3' },
                  React.createElement(Building2, { size: 28 }),
                  'üîê HR Admin Dashboard'
                ),
                React.createElement('p', { className: 'text-white/80 mb-4' },
                  getText(lang, 'Unternehmensweite √úbersicht aller Performance-Daten', 'Panoramica aziendale', 'Company-wide overview')
                ),
                React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-3' },
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.members),
                    React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Mitarbeiter', 'Collaboratori', 'Employees'))
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.reviews),
                    React.createElement('div', { className: 'text-xs text-white/70' }, 'Reviews')
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, stats.self),
                    React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Selbstrefl.', 'Autorifless.', 'Self-Assess.'))
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, avgGPS),
                    React.createElement('div', { className: 'text-xs text-white/70' }, '√ò GPS')
                  ),
                  React.createElement('div', { className: 'bg-white/10 rounded-xl p-3 text-center' },
                    React.createElement('div', { className: 'text-2xl font-bold' }, `${stats.completed}/${stats.reviews}`),
                    React.createElement('div', { className: 'text-xs text-white/70' }, getText(lang, 'Fertig', 'Completate', 'Done'))
                  )
                )
              ),
              
              // === NEU: ANALYTICS SECTION ===
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border p-6' },
                React.createElement('h3', { className: 'text-lg font-bold text-purple-800 mb-4 flex items-center gap-2' },
                  React.createElement(TrendingUp, { size: 20 }),
                  getText(lang, 'üìä Analytics & Verteilung', 'üìä Analytics e Distribuzione', 'üìä Analytics & Distribution')
                ),
                React.createElement('div', { className: 'grid md:grid-cols-3 gap-6' },
                  
                  // GPS Verteilung
                  (() => {
                    const gpsDistribution = {
                      outstanding: reviewsWithGPS.filter(a => a.gpsScore >= 4.51).length,
                      exceeds: reviewsWithGPS.filter(a => a.gpsScore >= 3.51 && a.gpsScore < 4.51).length,
                      meets: reviewsWithGPS.filter(a => a.gpsScore >= 2.51 && a.gpsScore < 3.51).length,
                      needs: reviewsWithGPS.filter(a => a.gpsScore >= 1.51 && a.gpsScore < 2.51).length,
                      doesNot: reviewsWithGPS.filter(a => a.gpsScore < 1.51).length
                    };
                    const total = reviewsWithGPS.length || 1;
                    
                    return React.createElement('div', { className: 'space-y-3' },
                      React.createElement('h4', { className: 'font-semibold text-slate-700 text-sm' }, 
                        getText(lang, 'GPS Verteilung', 'Distribuzione GPS', 'GPS Distribution')
                      ),
                      // Outstanding (5)
                      React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs w-20 text-slate-600' }, '5 Outstanding'),
                        React.createElement('div', { className: 'flex-1 h-4 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: 'h-full bg-green-500 rounded-full transition-all',
                            style: { width: `${(gpsDistribution.outstanding / total) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs w-8 text-right font-medium' }, gpsDistribution.outstanding)
                      ),
                      // Exceeds (4)
                      React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs w-20 text-slate-600' }, '4 Exceeds'),
                        React.createElement('div', { className: 'flex-1 h-4 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: 'h-full bg-emerald-500 rounded-full transition-all',
                            style: { width: `${(gpsDistribution.exceeds / total) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs w-8 text-right font-medium' }, gpsDistribution.exceeds)
                      ),
                      // Meets (3)
                      React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs w-20 text-slate-600' }, '3 Meets'),
                        React.createElement('div', { className: 'flex-1 h-4 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: 'h-full bg-blue-500 rounded-full transition-all',
                            style: { width: `${(gpsDistribution.meets / total) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs w-8 text-right font-medium' }, gpsDistribution.meets)
                      ),
                      // Needs Improvement (2)
                      React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs w-20 text-slate-600' }, '2 Needs Imp.'),
                        React.createElement('div', { className: 'flex-1 h-4 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: 'h-full bg-orange-500 rounded-full transition-all',
                            style: { width: `${(gpsDistribution.needs / total) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs w-8 text-right font-medium' }, gpsDistribution.needs)
                      ),
                      // Does Not Meet (1)
                      React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs w-20 text-slate-600' }, '1 Does Not'),
                        React.createElement('div', { className: 'flex-1 h-4 bg-slate-100 rounded-full overflow-hidden' },
                          React.createElement('div', { 
                            className: 'h-full bg-red-500 rounded-full transition-all',
                            style: { width: `${(gpsDistribution.doesNot / total) * 100}%` }
                          })
                        ),
                        React.createElement('span', { className: 'text-xs w-8 text-right font-medium' }, gpsDistribution.doesNot)
                      )
                    );
                  })(),
                  
                  // Fortschritts-√úbersicht
                  (() => {
                    const completionRate = stats.appraisals > 0 ? ((stats.completed / stats.appraisals) * 100).toFixed(0) : 0;
                    const selfRate = stats.members > 0 ? ((stats.self / stats.members) * 100).toFixed(0) : 0;
                    const reviewRate = stats.members > 0 ? ((stats.reviews / stats.members) * 100).toFixed(0) : 0;
                    
                    return React.createElement('div', { className: 'space-y-3' },
                      React.createElement('h4', { className: 'font-semibold text-slate-700 text-sm' }, 
                        getText(lang, 'Fortschritt', 'Progresso', 'Progress')
                      ),
                      // Completion Rate Ring
                      React.createElement('div', { className: 'flex items-center gap-4' },
                        React.createElement('div', { 
                          className: 'relative w-20 h-20',
                          style: {
                            background: `conic-gradient(#7c3aed ${completionRate}%, #e2e8f0 ${completionRate}%)`,
                            borderRadius: '50%'
                          }
                        },
                          React.createElement('div', { 
                            className: 'absolute inset-2 bg-white rounded-full flex items-center justify-center'
                          },
                            React.createElement('span', { className: 'text-lg font-bold text-purple-700' }, completionRate + '%')
                          )
                        ),
                        React.createElement('div', null,
                          React.createElement('p', { className: 'font-semibold text-slate-800' }, 
                            getText(lang, 'Abschlussrate', 'Tasso completamento', 'Completion Rate')
                          ),
                          React.createElement('p', { className: 'text-xs text-slate-500' }, 
                            `${stats.completed}/${stats.appraisals} ${getText(lang, 'abgeschlossen', 'completate', 'completed')}`
                          )
                        )
                      ),
                      React.createElement('div', { className: 'grid grid-cols-2 gap-2 text-xs' },
                        React.createElement('div', { className: 'bg-purple-50 p-2 rounded-lg text-center' },
                          React.createElement('div', { className: 'font-bold text-purple-700' }, selfRate + '%'),
                          React.createElement('div', { className: 'text-purple-600' }, getText(lang, 'Selbstrefl.', 'Autorifless.', 'Self-Assess.'))
                        ),
                        React.createElement('div', { className: 'bg-blue-50 p-2 rounded-lg text-center' },
                          React.createElement('div', { className: 'font-bold text-blue-700' }, reviewRate + '%'),
                          React.createElement('div', { className: 'text-blue-600' }, 'Reviews')
                        )
                      )
                    );
                  })(),
                  
                  // Top/Bottom Performer Hinweise
                  (() => {
                    const sortedByGPS = [...reviewsWithGPS].sort((a, b) => b.gpsScore - a.gpsScore);
                    // FIX: Nur echte Top Performer (GPS >= 3.0) anzeigen
                    const topPerformers = sortedByGPS.filter(p => p.gpsScore >= 3.0).slice(0, 3);
                    const needsAttention = reviewsWithGPS.filter(a => a.gpsScore < 2.5);
                    
                    return React.createElement('div', { className: 'space-y-3' },
                      React.createElement('h4', { className: 'font-semibold text-slate-700 text-sm' }, 
                        getText(lang, 'Highlights', 'Highlights', 'Highlights')
                      ),
                      
                      // Top Performers (nur GPS >= 3.0)
                      React.createElement('div', { className: 'bg-green-50 rounded-lg p-3' },
                        React.createElement('p', { className: 'text-xs font-semibold text-green-700 mb-2' }, 
                          'üåü ' + getText(lang, 'Top Performer (GPS ‚â•3)', 'Top Performer (GPS ‚â•3)', 'Top Performers (GPS ‚â•3)')
                        ),
                        topPerformers.length > 0 
                          ? React.createElement('div', { className: 'space-y-1' },
                              topPerformers.map((p, i) => 
                                React.createElement('div', { key: i, className: 'flex justify-between text-xs' },
                                  React.createElement('span', { className: 'text-green-800 truncate max-w-[120px]' }, 
                                    p.employeeName || p.formData?.employee || 'N/A'
                                  ),
                                  React.createElement('span', { className: 'font-bold text-green-600' }, 
                                    p.gpsScore?.toFixed(2)
                                  )
                                )
                              )
                            )
                          : React.createElement('p', { className: 'text-xs text-green-600 italic' }, 
                              getText(lang, 'Noch keine (alle unter GPS 3.0)', 'Nessuno (tutti sotto GPS 3.0)', 'None yet (all below GPS 3.0)')
                            )
                      ),
                      
                      // Attention Needed
                      needsAttention.length > 0 && 
                        React.createElement('div', { className: 'bg-amber-50 rounded-lg p-3' },
                          React.createElement('p', { className: 'text-xs font-semibold text-amber-700 mb-2' }, 
                            '‚ö†Ô∏è ' + getText(lang, 'Achtung erforderlich', 'Attenzione richiesta', 'Attention Needed')
                          ),
                          React.createElement('p', { className: 'text-xs text-amber-600' },
                            needsAttention.length + ' ' +
                            getText(lang, 'Mitarbeiter unter GPS 2.5', 'collaboratori sotto GPS 2.5', 'employees below GPS 2.5')
                          )
                        )
                    );
                  })()
                )
              ),
              
              // Filter + Export
              React.createElement('div', { className: 'bg-white rounded-xl p-4 shadow-sm border flex flex-wrap gap-3 items-center' },
                React.createElement('input', {
                  type: 'text',
                  placeholder: getText(lang, 'üîç Suche...', 'üîç Cerca...', 'üîç Search...'),
                  value: hrSearch,
                  onChange: (e) => setHrSearch(e.target.value),
                  className: 'flex-1 min-w-[200px] px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none'
                }),
                React.createElement('select', {
                  value: hrFilter,
                  onChange: (e) => setHrFilter(e.target.value),
                  className: 'px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none'
                },
                  React.createElement('option', { value: 'all' }, getText(lang, 'Alle', 'Tutti', 'All')),
                  React.createElement('option', { value: 'reviews' }, 'Reviews'),
                  React.createElement('option', { value: 'self' }, getText(lang, 'Selbstreflexionen', 'Autoriflessioni', 'Self-Assessments')),
                  React.createElement('option', { value: 'completed' }, '‚úì ' + getText(lang, 'Fertig', 'Completate', 'Completed')),
                  React.createElement('option', { value: 'draft' }, '‚úé ' + getText(lang, 'Entw√ºrfe', 'Bozze', 'Drafts'))
                ),
                React.createElement('span', { className: 'text-sm text-slate-500' }, filtered.length + ' ' + getText(lang, 'Eintr√§ge', 'voci', 'entries')),
                // Excel Export Button
                React.createElement('button', {
                  onClick: () => {
                    // Erstelle CSV-Daten f√ºr Excel
                    const headers = [
                      'Mitarbeiter', 'Position', 'F√ºhrungskraft', 'Typ', 'Status',
                      'GPS', 'WAS', 'WIE Core', 'WIE Lead',
                      'C1 Fachkompetenz', 'C2 Kommunikation', 'C3 Probleml√∂sung', 'C4 Adaptivit√§t', 'C5 Organisation',
                      'L1 F√ºhrung', 'L2 Strategie', 'L3 Entscheidung', 'L4 Execution', 'L5 Stakeholder',
                      'St√§rken 1', 'St√§rken 2', 'Karriere-Kommentar', 'W√ºnsche n√§chstes Jahr',
                      'Feedback an FK', 'Erstellt am', 'Aktualisiert am'
                    ];
                    
                    const rows = allCompanyAppraisals.map(a => {
                      const coreScores = a.coreScores || {};
                      const leaderScores = a.leaderScores || {};
                      const formData = a.formData || {};
                      
                      return [
                        a.employeeName || formData.employee || '',
                        formData.position || a.position || '',
                        formData.manager || '',
                        (a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection') ? 'Selbstreflexion' : a.type === 'self_pdf' ? 'PDF-Selbstreflexion' : a.type === 'goals' ? 'Zielvereinbarung' : 'Review',
                        a.status === 'completed' ? 'Fertig' : a.status === 'pdf_uploaded' ? 'PDF hochgeladen' : 'Entwurf',
                        a.gpsScore || '',
                        a.wasScore || '',
                        a.wieCoreScore || '',
                        a.wieLeaderScore || '',
                        // Core Scores mit korrekten IDs (fach, komm, prob, adapt, orga)
                        coreScores.fach || coreScores.c1 || '',
                        coreScores.komm || coreScores.c2 || '',
                        coreScores.prob || coreScores.c3 || '',
                        coreScores.adapt || coreScores.c4 || '',
                        coreScores.orga || coreScores.c5 || '',
                        // Leader Scores mit korrekten IDs (lead, strat, decide, exec, stake)
                        leaderScores.lead || leaderScores.l1 || '',
                        leaderScores.strat || leaderScores.l2 || '',
                        leaderScores.decide || leaderScores.l3 || '',
                        leaderScores.exec || leaderScores.l4 || '',
                        leaderScores.stake || leaderScores.l5 || '',
                        (formData.strengths1 || '').replace(/[\n\r]+/g, ' ').substring(0, 200),
                        (formData.strengths2 || '').replace(/[\n\r]+/g, ' ').substring(0, 200),
                        (formData.careerComment || '').replace(/[\n\r]+/g, ' ').substring(0, 200),
                        (formData.wishesNextYear || a.formData?.wishesNextYear || '').replace(/[\n\r]+/g, ' ').substring(0, 200),
                        (formData.feedbackManager || a.formData?.feedbackManager || '').replace(/[\n\r]+/g, ' ').substring(0, 200),
                        a.createdAt ? new Date(a.createdAt).toLocaleDateString('de-DE') : '',
                        a.updatedAt ? new Date(a.updatedAt).toLocaleDateString('de-DE') : ''
                      ];
                    });
                    
                    // CSV erstellen mit BOM f√ºr Excel-Kompatibilit√§t
                    const escapeCSV = (val) => {
                      if (val === null || val === undefined) return '';
                      const str = String(val);
                      if (str.includes(';') || str.includes('"') || str.includes('\n')) {
                        return '"' + str.replace(/"/g, '""') + '"';
                      }
                      return str;
                    };
                    
                    const csvContent = '\uFEFF' + // BOM f√ºr UTF-8 in Excel
                      headers.map(escapeCSV).join(';') + '\n' +
                      rows.map(row => row.map(escapeCSV).join(';')).join('\n');
                    
                    // Download
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = 'Niederwieser_Performance_Export_' + new Date().toISOString().split('T')[0] + '.csv';
                    link.click();
                    URL.revokeObjectURL(link.href);
                  },
                  className: 'px-4 py-2 bg-green-600 text-white rounded-2xl hover:bg-green-700 text-sm font-medium flex items-center gap-2 transition-colors'
                },
                  React.createElement(Download, { size: 16 }),
                  getText(lang, 'üìä Excel Export', 'üìä Esporta Excel', 'üìä Excel Export')
                )
              ),
              
              // Tabelle
              React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border overflow-hidden' },
                React.createElement('div', { className: 'overflow-x-auto' },
                  React.createElement('table', { className: 'w-full text-sm' },
                    React.createElement('thead', { className: 'bg-slate-50 border-b' },
                      React.createElement('tr', null,
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'Mitarbeiter', 'Collaboratore', 'Employee')),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'F√ºhrungskraft', 'Manager', 'Manager')),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'Typ', 'Tipo', 'Type')),
                        React.createElement('th', { className: 'px-4 py-3 text-center font-semibold' }, 'GPS'),
                        React.createElement('th', { className: 'px-4 py-3 text-center font-semibold' }, getText(lang, 'WAS', 'COSA', 'WHAT')),
                        React.createElement('th', { className: 'px-4 py-3 text-center font-semibold' }, getText(lang, 'WIE', 'COME', 'HOW')),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, 'Status'),
                        React.createElement('th', { className: 'px-4 py-3 text-left font-semibold' }, getText(lang, 'Datum', 'Data', 'Date'))
                      )
                    ),
                    React.createElement('tbody', { className: 'divide-y' },
                      filtered.length === 0 
                        ? React.createElement('tr', null,
                            React.createElement('td', { colSpan: 8, className: 'px-4 py-12 text-center text-slate-500' },
                              getText(lang, 'Keine Daten gefunden', 'Nessun dato', 'No data found')
                            )
                          )
                        : filtered.map(a => {
                            const name = a.employeeName || a.formData?.employee || '‚Äì';
                            const manager = a.formData?.manager || '‚Äì';
                            const position = a.formData?.position || a.position || '';
                            const gps = a.gpsScore || 0;
                            const was = a.wasScore || 0;
                            const wie = a.wieCoreScore || 0;
                            
                            const isSelf = a.type === 'self' || a.type === 'self_assessment' || a.type === 'self-reflection';
                            const isPdf = a.type === 'self_pdf' || a.isPdfUpload === true;
                            const typeLabel = isPdf ? 'üìÑ PDF' : isSelf ? 'Self' : a.type === 'goals' ? 'Goals' : 'Review';
                            const typeColor = isPdf ? 'bg-amber-100 text-amber-700' : isSelf ? 'bg-purple-100 text-purple-700' : 
                                              a.type === 'goals' ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700';
                            
                            const gpsColor = gps >= 3.5 ? 'bg-green-50 text-green-700' : 
                                             gps >= 2.5 ? 'bg-blue-50 text-blue-700' : 
                                             gps > 0 ? 'bg-orange-50 text-orange-700' : 'bg-slate-50 text-slate-400';
                            
                            return React.createElement('tr', { key: a.id, className: 'hover:bg-slate-50' },
                              React.createElement('td', { className: 'px-4 py-3' },
                                React.createElement('div', { className: 'font-medium text-slate-800' }, name),
                                React.createElement('div', { className: 'text-xs text-slate-500' }, position)
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-slate-600' }, manager),
                              React.createElement('td', { className: 'px-4 py-3' },
                                React.createElement('span', { className: 'px-2 py-1 rounded-full text-xs font-medium ' + typeColor }, typeLabel)
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-center' },
                                React.createElement('span', { className: 'px-2 py-1 rounded font-bold ' + gpsColor }, gps > 0 ? gps.toFixed(2) : '‚Äì')
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-center text-slate-600' }, was > 0 ? was.toFixed(2) : '‚Äì'),
                              React.createElement('td', { className: 'px-4 py-3 text-center text-slate-600' }, wie > 0 ? wie.toFixed(2) : '‚Äì'),
                              React.createElement('td', { className: 'px-4 py-3' },
                                React.createElement('span', { 
                                  className: 'px-2 py-1 rounded-full text-xs ' + (a.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700')
                                }, a.status === 'completed' ? '‚úì' : '‚úé')
                              ),
                              React.createElement('td', { className: 'px-4 py-3 text-slate-500 text-xs' },
                                a.updatedAt ? new Date(a.updatedAt).toLocaleDateString('de-DE') : 
                                a.createdAt ? new Date(a.createdAt).toLocaleDateString('de-DE') : '‚Äì'
                              )
                            );
                          })
                    )
                  )
                )
              ),
              
              // Footer
              React.createElement('div', { className: 'text-center text-xs text-slate-400 py-4' },
                'üîê HR Admin ‚Äì ' + (user?.email || '')
              )
            );
          };
          
          // === TEAM CALIBRATION RENDER FUNCTION ===
          const renderTeamCalibration = () => {
            // Sammle alle Reviews (type: 'review' oder kein type f√ºr R√ºckw√§rtskompatibilit√§t)
            const allReviews = teamAppraisals.filter(a => a.type === 'review' || !a.type);
            
            // Completed = Reviews mit status 'completed' UND gpsScore > 0
            const completedReviews = allReviews.filter(a => a.status === 'completed' && a.gpsScore && a.gpsScore > 0);
            
            // Drafts = Reviews mit status 'draft' ODER ohne gpsScore
            const draftReviews = allReviews.filter(a => a.status === 'draft' || !a.gpsScore || a.gpsScore === 0);
            
            // Reviews mit GPS f√ºr Statistiken (alle mit gpsScore > 0, unabh√§ngig vom Status)
            const reviewsWithGPS = allReviews.filter(a => a.gpsScore && a.gpsScore > 0);
            
            // Debug-Log
            console.log('üìä Team Calibration Filter:', {
              totalAppraisals: teamAppraisals.length,
              allReviews: allReviews.length,
              completed: completedReviews.length,
              drafts: draftReviews.length,
              withGPS: reviewsWithGPS.length,
              sample: allReviews[0] || null
            });
            
            // Team-Name aus user oder Fallback
            const teamName = user?.displayName ? `Team ${user.displayName.split(' ')[0]}` : getText(lang, 'Team-√úbersicht', 'Panoramica team', 'Team Overview');
            
            // Aktuelle Review-Periode
            const currentPeriod = new Date().getFullYear().toString();
            
            // === STATISTIK-BERECHNUNGEN ===
            
            // Hilfsfunktion: WAS % zu BARS konvertieren
            const convertWAStoBARS = (percentage) => {
              if (percentage < 70) return 1;
              if (percentage < 90) return 2;
              if (percentage <= 110) return 3;
              if (percentage <= 130) return 4;
              return 5;
            };
            
            // Hilfsfunktion: Standardabweichung berechnen
            const calculateStdDev = (values) => {
              if (values.length === 0) return 0;
              if (values.length === 1) return 0; // Keine Streuung bei einem Wert
              const avg = values.reduce((sum, v) => sum + v, 0) / values.length;
              const squareDiffs = values.map(v => Math.pow(v - avg, 2));
              const avgSquareDiff = squareDiffs.reduce((sum, v) => sum + v, 0) / values.length;
              return Math.sqrt(avgSquareDiff);
            };
            
            // Hilfsfunktion: WIE-Durchschnitt aus Kompetenzen berechnen
            // WICHTIG: Daten werden als coreScores/leaderScores Objekte gespeichert, NICHT als Arrays!
            const calculateWieAverage = (review) => {
              const ratings = [];
              
              // Core Scores aus coreScores Objekt (Format: { c1: 3, c2: 4, ... })
              if (review.coreScores && typeof review.coreScores === 'object') {
                Object.values(review.coreScores).forEach(rating => {
                  if (typeof rating === 'number' && rating > 0) {
                    ratings.push(rating);
                  }
                });
              }
              
              // Leadership Scores aus leaderScores Objekt (Format: { l1: 3, l2: 4, ... })
              if (review.leaderScores && typeof review.leaderScores === 'object') {
                Object.values(review.leaderScores).forEach(rating => {
                  if (typeof rating === 'number' && rating > 0) {
                    ratings.push(rating);
                  }
                });
              }
              
              // Fallback: Direkt wieCoreScore und wieLeaderScore nutzen falls vorhanden
              if (ratings.length === 0) {
                if (review.wieCoreScore && review.wieCoreScore > 0) {
                  ratings.push(review.wieCoreScore);
                }
                if (review.wieLeaderScore && review.wieLeaderScore > 0) {
                  ratings.push(review.wieLeaderScore);
                }
              }
              
              return ratings.length > 0 ? ratings.reduce((sum, r) => sum + r, 0) / ratings.length : 0;
            };
            
            // Hilfsfunktion: WAS-Score berechnen (aus goals)
            const calculateWasScore = (review) => {
              // Erst pr√ºfen ob wasScore direkt gespeichert ist
              if (review.wasScore && review.wasScore > 0) {
                return review.wasScore;
              }
              
              // Sonst aus goals berechnen
              if (!review.goals || !Array.isArray(review.goals) || review.goals.length === 0) return null;
              const validGoals = review.goals.filter(g => g.weight > 0);
              if (validGoals.length === 0) return null;
              
              let weightedSum = 0;
              let totalWeight = 0;
              validGoals.forEach(g => {
                const achievement = g.achievement || 0;
                const barsScore = convertWAStoBARS(achievement);
                weightedSum += barsScore * (g.weight / 100);
                totalWeight += g.weight / 100;
              });
              return totalWeight > 0 ? weightedSum / totalWeight : null;
            };
            
            // Z√§hle eindeutige Mitarbeiter aus allen Reviews (unternehmenweit)
            const uniqueEmployees = new Set();
            allReviews.forEach(r => {
              if (r.employeeId) uniqueEmployees.add(r.employeeId);
              if (r.employeeName) uniqueEmployees.add(r.employeeName);
            });
            // Fallback auf teamMembers wenn keine Reviews vorhanden
            const totalEmployeeCount = uniqueEmployees.size > 0 ? uniqueEmployees.size : teamMembers.length;
            
            // Berechne Selbstreflexionen separat (alle Typen)
            const selfReflections = teamAppraisals.filter(a => a.type === 'self' || a.type === 'self-reflection' || a.type === 'self_assessment' || a.type === 'self_pdf');
            
            // Berechne alle Statistiken
            const stats = {
              totalMembers: totalEmployeeCount,
              totalReviews: allReviews.length,
              completedReviews: completedReviews.length,
              draftReviews: draftReviews.length,
              selfReflections: selfReflections.length,
              avgGPS: 0,
              avgWAS: 0,
              avgWIE: 0,
              stdDev: 0
            };
            
            // Nur berechnen wenn Reviews mit GPS vorhanden
            if (reviewsWithGPS.length > 0) {
              // GPS Durchschnitt
              const gpsValues = reviewsWithGPS.map(r => r.gpsScore || 0).filter(v => v > 0);
              if (gpsValues.length > 0) {
                stats.avgGPS = gpsValues.reduce((sum, v) => sum + v, 0) / gpsValues.length;
                // Standardabweichung
                stats.stdDev = calculateStdDev(gpsValues);
              }
              
              // WAS Durchschnitt - nutze wasScore direkt falls vorhanden
              const wasScores = reviewsWithGPS
                .map(r => r.wasScore || calculateWasScore(r))
                .filter(s => s !== null && s > 0);
              if (wasScores.length > 0) {
                stats.avgWAS = wasScores.reduce((sum, v) => sum + v, 0) / wasScores.length;
              }
              
              // WIE Durchschnitt - nutze wieCoreScore/wieLeaderScore falls vorhanden
              const wieScores = reviewsWithGPS.map(r => {
                // Erst direkte Scores nutzen
                if (r.wieCoreScore && r.wieCoreScore > 0) {
                  if (r.includeLeadership && r.wieLeaderScore && r.wieLeaderScore > 0) {
                    return (r.wieCoreScore + r.wieLeaderScore) / 2;
                  }
                  return r.wieCoreScore;
                }
                // Sonst berechnen
                return calculateWieAverage(r);
              }).filter(s => s > 0);
              
              if (wieScores.length > 0) {
                stats.avgWIE = wieScores.reduce((sum, v) => sum + v, 0) / wieScores.length;
              }
            }
            
            // Debug-Log (kann sp√§ter entfernt werden)
            console.log('üìä Team Calibration Stats:', {
              allReviews: allReviews.length,
              reviewsWithGPS: reviewsWithGPS.length,
              stats,
              sampleReview: reviewsWithGPS[0] || null
            });
            
            // === RENDER ===
            return React.createElement('div', { className: "space-y-6 pb-12" },
              
              // HERO HEADER mit Gradient (Unternehmensfarben)
              React.createElement('div', { 
                className: "rounded-2xl p-6 md:p-8 text-white shadow-xl",
                style: { background: "linear-gradient(135deg, #243186 0%, #1a2563 50%, #243186 100%)" }
              },
                // Titel-Zeile
                React.createElement('div', { className: "flex flex-col md:flex-row md:items-center md:justify-between mb-6" },
                  React.createElement('div', null,
                    React.createElement('h1', { className: "text-2xl md:text-3xl font-bold mb-2 flex items-center gap-3" },
                      React.createElement(Scale, { size: 28 }),
                      lang === 'de' ? `Team-Kalibrierung: ${teamName}` : lang === 'it' ? `Calibrazione Team: ${teamName}` : `Team Calibration: ${teamName}`
                    ),
                    React.createElement('p', { className: "text-white/80" },
                      `${stats.totalMembers} ${lang === 'de' ? 'Mitarbeiter' : lang === 'it' ? 'Collaboratori' : 'Employees'} | Review-Periode: ${currentPeriod}`
                    )
                  ),
                  // Status-Badge
                  React.createElement('div', { className: "mt-4 md:mt-0 flex items-center gap-2" },
                    React.createElement('span', { 
                      className: "bg-white/20 backdrop-blur px-4 py-2 rounded-full text-sm font-medium"
                    },
                      `${stats.draftReviews} ${lang === 'de' ? 'Entw√ºrfe' : lang === 'it' ? 'Bozze' : 'Drafts'} | ${stats.completedReviews} ${lang === 'de' ? 'Fertig' : lang === 'it' ? 'Completate' : 'Completed'}`
                    )
                  )
                ),
                
                // Stats Grid
                reviewsWithGPS.length > 0 
                  ? React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4" },
                      // GPS Durchschnitt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, stats.avgGPS.toFixed(1)),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'GPS √ò' : lang === 'it' ? 'GPS Medio' : 'GPS Avg'
                        )
                      ),
                      // WAS Durchschnitt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, 
                          stats.avgWAS > 0 ? stats.avgWAS.toFixed(1) : '‚Äì'
                        ),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'WAS √ò' : lang === 'it' ? 'COSA Medio' : 'WHAT Avg'
                        )
                      ),
                      // WIE Durchschnitt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, stats.avgWIE.toFixed(1)),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'WIE √ò' : lang === 'it' ? 'COME Medio' : 'HOW Avg'
                        )
                      ),
                      // Standardabweichung
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, stats.stdDev.toFixed(2)),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, "Std.Dev")
                      ),
                      // Fortschritt
                      React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center col-span-2 md:col-span-1" },
                        React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-1" }, 
                          `${stats.completedReviews}/${stats.totalMembers}`
                        ),
                        React.createElement('div', { className: "text-xs md:text-sm text-white/70" }, 
                          lang === 'de' ? 'Fortschritt' : lang === 'it' ? 'Progresso' : 'Progress'
                        )
                      )
                    )
                  : // Keine Reviews vorhanden
                    React.createElement('div', { className: "bg-white/10 backdrop-blur rounded-xl p-6 text-center" },
                      React.createElement('p', { className: "text-white/80 text-lg" },
                        lang === 'de' 
                          ? 'üìã Noch keine Reviews abgeschlossen. Starte mit dem ersten Performance Review!'
                          : 'üìã Nessuna review completata. Inizia con la prima Performance Review!'
                      )
                    )
              ),
              
              // === FILTER & SORTIERUNGS-TOOLBAR ===
              reviewsWithGPS.length > 0 && React.createElement('div', { 
                className: "bg-white rounded-xl p-4 shadow-sm border border-slate-200 flex flex-col md:flex-row md:items-center gap-4"
              },
                // Filter
                React.createElement('div', { className: "flex items-center gap-2" },
                  React.createElement('span', { className: "text-sm font-medium text-slate-600" }, 
                    lang === 'de' ? 'Filter:' : lang === 'it' ? 'Filtro:' : 'Filter:'
                  ),
                  React.createElement('div', { className: "flex bg-slate-100 rounded-lg p-1" },
                    React.createElement('button', {
                      onClick: () => setCalibrationFilter('all'),
                      className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${
                        calibrationFilter === 'all' 
                          ? 'bg-white text-slate-800 shadow-sm' 
                          : 'text-slate-500 hover:text-slate-700'
                      }`
                    }, lang === 'de' ? 'Alle' : lang === 'it' ? 'Tutti' : 'All'),
                    React.createElement('button', {
                      onClick: () => setCalibrationFilter('completed'),
                      className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${
                        calibrationFilter === 'completed' 
                          ? 'bg-green-100 text-green-800 shadow-sm' 
                          : 'text-slate-500 hover:text-slate-700'
                      }`
                    }, `‚úì ${lang === 'de' ? 'Fertig' : lang === 'it' ? 'Completate' : 'Completed'}`),
                    React.createElement('button', {
                      onClick: () => setCalibrationFilter('draft'),
                      className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${
                        calibrationFilter === 'draft' 
                          ? 'bg-amber-100 text-amber-800 shadow-sm' 
                          : 'text-slate-500 hover:text-slate-700'
                      }`
                    }, `‚úé ${lang === 'de' ? 'Entw√ºrfe' : lang === 'it' ? 'Bozze' : 'Drafts'}`)
                  )
                ),
                
                // Trennlinie
                React.createElement('div', { className: "hidden md:block w-px h-8 bg-slate-200" }),
                
                // Sortierung
                React.createElement('div', { className: "flex items-center gap-2" },
                  React.createElement('span', { className: "text-sm font-medium text-slate-600" }, 
                    lang === 'de' ? 'Sortieren:' : lang === 'it' ? 'Ordina:' : 'Sort:'
                  ),
                  React.createElement('select', {
                    value: `${calibrationSort.field}-${calibrationSort.direction}`,
                    onChange: (e) => {
                      const [field, direction] = e.target.value.split('-');
                      setCalibrationSort({ field, direction });
                    },
                    className: "px-3 py-1.5 text-sm border border-slate-200 rounded-lg bg-white focus:ring-2 focus:ring-[#6EBD84] outline-none"
                  },
                    React.createElement('option', { value: 'name-asc' }, lang === 'de' ? 'Name A-Z' : lang === 'it' ? 'Nome A-Z' : 'Name A-Z'),
                    React.createElement('option', { value: 'name-desc' }, lang === 'de' ? 'Name Z-A' : lang === 'it' ? 'Nome Z-A' : 'Name Z-A'),
                    React.createElement('option', { value: 'gps-desc' }, lang === 'de' ? 'GPS ‚Üì (h√∂chste)' : lang === 'it' ? 'GPS ‚Üì (pi√π alto)' : 'GPS ‚Üì (highest)'),
                    React.createElement('option', { value: 'gps-asc' }, lang === 'de' ? 'GPS ‚Üë (niedrigste)' : lang === 'it' ? 'GPS ‚Üë (pi√π basso)' : 'GPS ‚Üë (lowest)'),
                    React.createElement('option', { value: 'was-desc' }, lang === 'de' ? 'WAS ‚Üì (h√∂chste)' : lang === 'it' ? 'COSA ‚Üì (pi√π alto)' : 'WHAT ‚Üì (highest)'),
                    React.createElement('option', { value: 'was-asc' }, lang === 'de' ? 'WAS ‚Üë (niedrigste)' : lang === 'it' ? 'COSA ‚Üë (pi√π basso)' : 'WHAT ‚Üë (lowest)'),
                    React.createElement('option', { value: 'wie-desc' }, lang === 'de' ? 'WIE ‚Üì (h√∂chste)' : lang === 'it' ? 'COME ‚Üì (pi√π alto)' : 'HOW ‚Üì (highest)'),
                    React.createElement('option', { value: 'wie-asc' }, lang === 'de' ? 'WIE ‚Üë (niedrigste)' : lang === 'it' ? 'COME ‚Üë (pi√π basso)' : 'HOW ‚Üë (lowest)')
                  )
                ),
                
                // Spacer
                React.createElement('div', { className: "flex-1" }),
                
                // Anzahl gefiltert
                React.createElement('span', { className: "text-sm text-slate-500" },
                  (() => {
                    const filtered = calibrationFilter === 'all' ? reviewsWithGPS :
                                     calibrationFilter === 'completed' ? completedReviews : draftReviews;
                    return `${filtered.length} ${lang === 'de' ? 'angezeigt' : lang === 'it' ? 'visualizzati' : 'displayed'}`;
                  })()
                )
              ),
              
              // Info-Box (falls keine Reviews)
              reviewsWithGPS.length === 0 && React.createElement('div', { 
                className: "bg-gradient-to-br from-amber-50 to-orange-50 border-2 border-amber-200 rounded-2xl p-8 text-center" 
              },
                React.createElement('div', { className: "max-w-md mx-auto" },
                  React.createElement('div', { className: "bg-amber-100 rounded-full p-4 w-16 h-16 mx-auto mb-4 flex items-center justify-center" },
                    React.createElement(Info, { size: 32, className: "text-amber-600" })
                  ),
                  React.createElement('h3', { className: "font-bold text-amber-900 text-xl mb-3" },
                    lang === 'de' ? 'Noch keine Daten f√ºr Kalibrierung' : lang === 'it' ? 'Nessun dato per la calibrazione' : 'No data for calibration yet'
                  ),
                  React.createElement('p', { className: "text-amber-800 mb-4 leading-relaxed" },
                    lang === 'de' 
                      ? 'Um Bubble Chart, Heatmap und Warnungen zu sehen, m√ºssen zuerst Performance Reviews mit GPS-Bewertung f√ºr deine Team-Mitglieder erstellt werden.'
                      : 'Per visualizzare Bubble Chart, Heatmap e avvisi, devono prima essere create le Performance Review con valutazione GPS per i membri del team.'
                  ),
                  // Checkliste
                  React.createElement('div', { className: "bg-white rounded-xl p-4 mb-4 text-left border border-amber-200" },
                    React.createElement('div', { className: "text-sm font-medium text-amber-900 mb-2" },
                      lang === 'de' ? 'So startest du:' : lang === 'it' ? 'Come iniziare:' : 'How to start:'
                    ),
                    React.createElement('ul', { className: "text-sm text-amber-800 space-y-1.5" },
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "1."),
                        lang === 'de' ? 'Gehe zu "Team-√úbersicht"' : lang === 'it' ? 'Vai a "Panoramica team"' : 'Go to "Team Overview"'
                      ),
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "2."),
                        lang === 'de' ? 'W√§hle einen Mitarbeiter und starte ein Review' : lang === 'it' ? 'Seleziona un collaboratore e inizia una review' : 'Select an employee and start a review'
                      ),
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "3."),
                        lang === 'de' ? 'F√ºlle WAS (Ziele) und WIE (Kompetenzen) aus' : lang === 'it' ? 'Compila COSA (obiettivi) e COME (competenze)' : 'Fill in WHAT (goals) and HOW (competencies)'
                      ),
                      React.createElement('li', { className: "flex items-center gap-2" },
                        React.createElement('span', { className: "text-amber-500" }, "4."),
                        lang === 'de' ? 'Speichere das Review (GPS wird automatisch berechnet)' : lang === 'it' ? 'Salva la review (GPS viene calcolato automaticamente)' : 'Save the review (GPS is calculated automatically)'
                      )
                    )
                  ),
                  React.createElement('button', {
                    onClick: () => setActiveView('teamoverview'),
                    className: "flex items-center gap-2 px-6 py-3 bg-amber-600 text-white rounded-2xl hover:bg-amber-700 transition-colors font-medium mx-auto shadow-lg shadow-amber-200"
                  },
                    React.createElement(Users, { size: 18 }),
                    lang === 'de' ? 'Zur Team-√úbersicht' : lang === 'it' ? 'Vai alla panoramica team' : 'Go to Team Overview'
                  ),
                  // Draft-Hinweis falls vorhanden
                  draftReviews.length > 0 && React.createElement('p', { className: "text-sm text-amber-700 mt-4" },
                    lang === 'de' 
                      ? `üí° Du hast ${draftReviews.length} Entw√ºrfe. Schlie√üe diese ab, um GPS-Werte zu erhalten.`
                      : `üí° Hai ${draftReviews.length} bozze. Completale per ottenere i valori GPS.`
                  )
                )
              ),
              
              // === AUTO-WARNUNGEN ===
              reviewsWithGPS.length > 0 && (() => {
                const warnings = [];
                
                // Bereite Daten f√ºr Analyse vor
                const analysisData = reviewsWithGPS.map(review => {
                  const member = teamMembers.find(m => m.id === review.employeeId);
                  const name = review.employeeName || member?.name || 'Unbekannt';
                  const coreScores = review.coreScores || {};
                  const leaderScores = review.leaderScores || {};
                  
                  return {
                    name,
                    gps: review.gpsScore || 0,
                    wasScore: review.wasScore || 0,
                    kommunikation: coreScores.komm || coreScores.c2 || 0, // Kommunikation
                    mitarbeiterfuehrung: leaderScores.lead || leaderScores.l1 || 0, // Mitarbeiterf√ºhrung
                    includeLeadership: review.includeLeadership,
                    allScores: { ...coreScores, ...leaderScores }
                  };
                });
                
                // CHECK 1: Killer Criteria Verletzung
                // GPS > 2.5 aber Level 1 bei Kommunikation oder Mitarbeiterf√ºhrung
                analysisData.forEach(emp => {
                  if (emp.gps > 2.5) {
                    if (emp.kommunikation > 0 && emp.kommunikation === 1) {
                      warnings.push({
                        type: 'error',
                        title: lang === 'de' ? 'Killer Criteria Verletzung' : lang === 'it' ? 'Violazione Killer Criteria' : 'Killer Criteria Violation',
                        message: lang === 'de' 
                          ? `${emp.name}: GPS ${emp.gps.toFixed(1)} trotz Level ${emp.kommunikation} bei Kommunikation ‚Üí GPS sollte max. 2.5 sein!`
                          : `${emp.name}: GPS ${emp.gps.toFixed(1)} nonostante Livello ${emp.kommunikation} in Comunicazione ‚Üí GPS dovrebbe essere max. 2.5!`
                      });
                    }
                    if (emp.includeLeadership && emp.mitarbeiterfuehrung > 0 && emp.mitarbeiterfuehrung === 1) {
                      warnings.push({
                        type: 'error',
                        title: lang === 'de' ? 'Killer Criteria Verletzung' : lang === 'it' ? 'Violazione Killer Criteria' : 'Killer Criteria Violation',
                        message: lang === 'de'
                          ? `${emp.name}: GPS ${emp.gps.toFixed(1)} trotz Level ${emp.mitarbeiterfuehrung} bei Mitarbeiterf√ºhrung ‚Üí GPS sollte max. 2.5 sein!`
                          : `${emp.name}: GPS ${emp.gps.toFixed(1)} nonostante Livello ${emp.mitarbeiterfuehrung} in Gestione Personale ‚Üí GPS dovrebbe essere max. 2.5!`
                      });
                    }
                  }
                });
                
                // CHECK 2: ENTFERNT - WAS-GPS Unterschiede sind durch WIE-Komponente beabsichtigt
                // Die GPS-Formel (50% WAS + 50% WIE) f√ºhrt nat√ºrlich zu unterschiedlichen GPS bei gleichem WAS
                
                // CHECK 3: Verteilungs-Probleme (nur bei ausreichender Teamgr√∂√üe)
                const totalCount = analysisData.length;
                if (totalCount >= 5) {
                  // Zu viele Top-Performer (GPS >= 4.5) - nur bei mindestens 5 MA sinnvoll
                  const topPerformers = analysisData.filter(e => e.gps >= 4.5).length;
                  const topPercent = (topPerformers / totalCount) * 100;
                  if (topPercent > 25) {
                    warnings.push({
                      type: 'info',
                      title: lang === 'de' ? 'Verteilungs-Hinweis' : lang === 'it' ? 'Nota distribuzione' : 'Distribution Note',
                      message: lang === 'de'
                        ? `${topPercent.toFixed(0)}% mit GPS ‚â• 4.5 (${topPerformers}/${totalCount}). √úblich: 10-20%. Bewertung pr√ºfen?`
                        : `${topPercent.toFixed(0)}% con GPS ‚â• 4.5 (${topPerformers}/${totalCount}). Normale: 10-20%. Verificare?`
                    });
                  }
                  
                  // Check f√ºr Level 1 bei irgendeiner Kompetenz mit gutem GPS
                  analysisData.forEach(emp => {
                    const hasLevel1 = Object.values(emp.allScores).some(score => score === 1);
                    if (hasLevel1 && emp.gps >= 3.5) {
                      warnings.push({
                        type: 'warning',
                        title: lang === 'de' ? 'Level 1 bei gutem GPS' : lang === 'it' ? 'Livello 1 con buon GPS' : 'Level 1 with good GPS',
                        message: lang === 'de'
                          ? `${emp.name}: GPS ${emp.gps.toFixed(1)} aber mindestens 1x Level 1. Entwicklungsbedarf?`
                          : `${emp.name}: GPS ${emp.gps.toFixed(1)} ma almeno 1x Livello 1. Necessit√† di sviluppo?`
                      });
                    }
                  });
                }
                
                // Render Warnungen
                if (warnings.length === 0) {
                  // Keine Warnungen - Alles OK
                  return React.createElement('div', { 
                    className: "bg-green-50 border-2 border-green-300 rounded-xl p-4 mb-6 flex items-center gap-3"
                  },
                    React.createElement('span', { className: "text-2xl" }, "‚úÖ"),
                    React.createElement('div', { className: "text-green-800" },
                      React.createElement('span', { className: "font-semibold" }, 
                        lang === 'de' ? 'Keine Warnungen' : lang === 'it' ? 'Nessun avviso' : 'No warnings'
                      ),
                      React.createElement('span', { className: "ml-2" }, 
                        lang === 'de' ? '‚Äì Deine Bewertungen sind konsistent!' : lang === 'it' ? '‚Äì Le tue valutazioni sono coerenti!' : '‚Äì Your assessments are consistent!'
                      )
                    )
                  );
                }
                
                // Warnungen anzeigen
                return React.createElement('div', { className: "space-y-3 mb-6" },
                  // Header
                  React.createElement('div', { className: "flex items-center gap-2 text-slate-600 text-sm mb-2" },
                    React.createElement(AlertCircle, { size: 16 }),
                    React.createElement('span', null, 
                      lang === 'de' 
                        ? `${warnings.length} ${warnings.length === 1 ? 'Hinweis' : 'Hinweise'} zur Kalibrierung:`
                        : `${warnings.length} ${warnings.length === 1 ? 'avviso' : 'avvisi'} per la calibrazione:`
                    )
                  ),
                  // Warnungen
                  ...warnings.slice(0, 5).map((w, idx) => {
                    let bgColor, borderColor, textColor, icon;
                    if (w.type === 'error') {
                      bgColor = 'bg-red-50'; borderColor = 'border-red-400'; textColor = 'text-red-800'; icon = 'üö®';
                    } else if (w.type === 'warning') {
                      bgColor = 'bg-yellow-50'; borderColor = 'border-yellow-400'; textColor = 'text-yellow-800'; icon = '‚ö†Ô∏è';
                    } else {
                      bgColor = 'bg-blue-50'; borderColor = 'border-blue-400'; textColor = 'text-blue-800'; icon = 'üí°';
                    }
                    
                    return React.createElement('div', { 
                      key: idx,
                      className: `${bgColor} border-2 ${borderColor} rounded-lg p-4 flex items-start gap-3`
                    },
                      React.createElement('span', { className: "text-xl flex-shrink-0" }, icon),
                      React.createElement('div', { className: textColor },
                        React.createElement('div', { className: "font-semibold text-sm mb-1" }, w.title),
                        React.createElement('div', { className: "text-sm" }, w.message)
                      )
                    );
                  }),
                  // Falls mehr als 5 Warnungen
                  warnings.length > 5 && React.createElement('div', { 
                    className: "text-sm text-slate-500 text-center py-2"
                  },
                    lang === 'de' 
                      ? `... und ${warnings.length - 5} weitere Hinweise`
                      : `... e altri ${warnings.length - 5} avvisi`
                  )
                );
              })(),
              
              // === BUBBLE CHART: WAS vs. WIE ===
              reviewsWithGPS.length > 0 && (() => {
                // Chart-Dimensionen
                const width = 650;
                const height = 450;
                const padding = 55;
                
                // Scale-Funktionen (0-5 auf Pixel)
                const scaleX = (was) => padding + ((was / 5) * (width - 2 * padding));
                const scaleY = (wie) => height - padding - ((wie / 5) * (height - 2 * padding));
                
                // === CI-KONFORME BUBBLE-FARBEN (strikt nach GPS-Rating) ===
                const getBubbleColor = (gps) => {
                  if (gps > 4.50) return '#16a34a'; // Rating 5: Outstanding (Green-600)
                  if (gps > 3.50) return '#10b981'; // Rating 4: Exceeds (Emerald-500)
                  if (gps > 2.50) return '#2563eb'; // Rating 3: Meets (Blue-600)
                  if (gps > 1.50) return '#f97316'; // Rating 2: Needs Improvement (Orange-500)
                  return '#dc2626';                  // Rating 1: Fail (Red-600)
                };
                
                // === ACTION CARDS basierend auf GPS-Rating (A&O-Psychologie & F√ºhrungscoach-Perspektive) ===
                const getActionCard = (gps) => {
                  if (gps > 4.50) return { 
                    icon: 'üåü', 
                    rating: 'OUTSTANDING (5)', 
                    action: lang === 'de' 
                      ? '‚Üí Karrieregespr√§ch f√ºhren: Aufstiegsperspektiven kl√§ren\n‚Üí Stretch-Assignments & strategische Projekte\n‚Üí Als Mentor f√ºr andere einsetzen\n‚Üí Retention: Bindung aktiv st√§rken!' 
                      : lang === 'it' 
                      ? '‚Üí Colloquio carriera: chiarire prospettive\n‚Üí Progetti strategici & sfidanti\n‚Üí Usare come mentor per altri\n‚Üí Retention: rafforzare il legame!' 
                      : '‚Üí Career talk: clarify growth path\n‚Üí Stretch assignments & strategic projects\n‚Üí Deploy as mentor for others\n‚Üí Retention: actively strengthen bond!',
                    color: '#16a34a', bg: '#dcfce7'
                  };
                  if (gps > 3.50) return { 
                    icon: 'üöÄ', 
                    rating: 'EXCEEDS (4)', 
                    action: lang === 'de' 
                      ? '‚Üí St√§rken gezielt ausbauen & sichtbar machen\n‚Üí Verantwortung erweitern (Job Enrichment)\n‚Üí Als fachlicher Ansprechpartner positionieren\n‚Üí Entwicklungsziel f√ºr n√§chstes Level definieren' 
                      : lang === 'it' 
                      ? '‚Üí Sviluppare punti di forza & renderli visibili\n‚Üí Ampliare responsabilit√† (Job Enrichment)\n‚Üí Posizionare come referente tecnico\n‚Üí Definire obiettivo per il prossimo livello' 
                      : '‚Üí Leverage strengths & increase visibility\n‚Üí Expand responsibility (Job Enrichment)\n‚Üí Position as subject matter expert\n‚Üí Define goal for next level',
                    color: '#10b981', bg: '#d1fae5'
                  };
                  if (gps > 2.50) return { 
                    icon: '‚úÖ', 
                    rating: 'MEETS (3)', 
                    action: lang === 'de' 
                      ? '‚Üí Wertsch√§tzung aussprechen ‚Äì R√ºckgrat des Teams!\n‚Üí Stabilit√§t anerkennen, nicht nur "Stars" loben\n‚Üí Individuelle St√§rken identifizieren & nutzen\n‚Üí Bei Interesse: gezielte Entwicklungsimpulse' 
                      : lang === 'it' 
                      ? '‚Üí Esprimere apprezzamento ‚Äì spina dorsale!\n‚Üí Riconoscere stabilit√†, non solo le "star"\n‚Üí Identificare & utilizzare punti di forza\n‚Üí Se interessato: impulsi di sviluppo mirati' 
                      : '‚Üí Express appreciation ‚Äì team backbone!\n‚Üí Recognize stability, not just "stars"\n‚Üí Identify & leverage individual strengths\n‚Üí If interested: targeted development',
                    color: '#2563eb', bg: '#dbeafe'
                  };
                  if (gps > 1.50) return { 
                    icon: '‚ö†Ô∏è', 
                    rating: 'NEEDS IMPR. (2)', 
                    action: lang === 'de' 
                      ? '‚Üí Ursachenanalyse: Kompetenz, Motivation oder Kontext?\n‚Üí Klare Erwartungen & messbare Ziele setzen\n‚Üí Engmaschiges Feedback (alle 2-4 Wochen)\n‚Üí 90-Tage-Entwicklungsplan mit Meilensteinen' 
                      : lang === 'it' 
                      ? '‚Üí Analisi cause: competenza, motivazione o contesto?\n‚Üí Aspettative chiare & obiettivi misurabili\n‚Üí Feedback frequente (ogni 2-4 settimane)\n‚Üí Piano sviluppo 90 giorni con milestone' 
                      : '‚Üí Root cause: skill, motivation or context?\n‚Üí Clear expectations & measurable goals\n‚Üí Frequent feedback (every 2-4 weeks)\n‚Üí 90-day development plan with milestones',
                    color: '#f97316', bg: '#ffedd5'
                  };
                  return { 
                    icon: 'üö®', 
                    rating: 'FAIL (1)', 
                    action: lang === 'de' 
                      ? '‚Üí Sofortiges HR-Gespr√§ch ansetzen\n‚Üí Schriftlicher PIP mit klaren Konsequenzen\n‚Üí W√∂chentliche Check-ins dokumentieren\n‚Üí Rollenpassung & Alternativen pr√ºfen' 
                      : lang === 'it' 
                      ? '‚Üí Colloquio HR immediato\n‚Üí PIP scritto con conseguenze chiare\n‚Üí Check-in settimanali documentati\n‚Üí Verificare idoneit√† ruolo & alternative' 
                      : '‚Üí Schedule immediate HR meeting\n‚Üí Written PIP with clear consequences\n‚Üí Document weekly check-ins\n‚Üí Review role fit & alternatives',
                    color: '#dc2626', bg: '#fee2e2'
                  };
                };
                
                // Initialen aus Name
                const getInitials = (name) => {
                  const parts = name.trim().split(' ');
                  if (parts.length >= 2) {
                    return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
                  }
                  return name.substring(0, 2).toUpperCase();
                };
                
                // Bereite Mitarbeiter-Daten auf
                const bubbleData = reviewsWithGPS.map(review => {
                  const member = teamMembers.find(m => m.id === review.employeeId);
                  const name = review.employeeName || member?.name || 'Unknown';
                  const wasScore = review.wasScore || 0;
                  const coreScores = review.coreScores || {};
                  const leaderScores = review.leaderScores || {};
                  
                  const allWieScores = [
                    ...Object.values(coreScores).filter(v => v > 0),
                    ...(review.includeLeadership ? Object.values(leaderScores).filter(v => v > 0) : [])
                  ];
                  const wieAvg = allWieScores.length > 0 
                    ? allWieScores.reduce((s, v) => s + v, 0) / allWieScores.length 
                    : 0;
                  
                  return {
                    name,
                    gps: review.gpsScore || 0,
                    was: wasScore,
                    wie: wieAvg,
                    initials: getInitials(name)
                  };
                }).filter(e => e.gps > 0);
                
                // === SOLID BACKBONE ZONE (Rating 3 = 2.5 bis 3.5) ===
                const solidBackboneX1 = scaleX(2.5);
                const solidBackboneX2 = scaleX(3.5);
                const solidBackboneY1 = scaleY(3.5);
                const solidBackboneY2 = scaleY(2.5);
                
                // === 4 ARCHETYPEN-ZONEN ===
                const zones = [
                  { 
                    id: 'handlungsbedarf',
                    name: lang === 'de' ? 'HANDLUNGSBEDARF' : lang === 'it' ? 'AZIONE RICHIESTA' : 'ACTION REQUIRED',
                    x: padding, 
                    y: scaleY(2.5), 
                    w: scaleX(2.5) - padding, 
                    h: height - padding - scaleY(2.5),
                    fill: '#fee2e2', textColor: '#991b1b', icon: 'üö®'
                  },
                  { 
                    id: 'solo-star',
                    name: 'SOLO STAR',
                    x: scaleX(2.5), 
                    y: scaleY(2.5), 
                    w: width - padding - scaleX(2.5), 
                    h: height - padding - scaleY(2.5),
                    fill: '#ffedd5', textColor: '#9a3412', icon: 'üéØ'
                  },
                  { 
                    id: 'hidden-gem',
                    name: 'HIDDEN GEM',
                    x: padding, 
                    y: padding, 
                    w: scaleX(2.5) - padding, 
                    h: scaleY(2.5) - padding,
                    fill: '#fef9c3', textColor: '#854d0e', icon: 'üíé'
                  },
                  { 
                    id: 'role-model',
                    name: 'ROLE MODEL',
                    x: scaleX(2.5), 
                    y: padding, 
                    w: width - padding - scaleX(2.5), 
                    h: scaleY(2.5) - padding,
                    fill: '#dcfce7', textColor: '#166534', icon: '‚≠ê'
                  }
                ];
                
                return React.createElement('div', { className: "bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-slate-200 mb-6" },
                  // Header mit Icon
                  React.createElement('div', { className: "flex items-center justify-between mb-6" },
                    React.createElement('div', { className: "flex items-center gap-3" },
                      React.createElement('div', { className: "w-12 h-12 rounded-xl bg-gradient-to-br from-[#243186] to-[#1a2564] flex items-center justify-center shadow-lg" },
                        React.createElement('span', { className: "text-2xl" }, "üìä")
                      ),
                      React.createElement('div', null,
                        React.createElement('h3', { className: "text-xl md:text-2xl font-bold", style: { color: "#243186" } },
                          lang === 'de' ? 'GPS-Verteilung (9-Box Grid)' : lang === 'it' ? 'Distribuzione GPS (9-Box Grid)' : 'GPS Distribution (9-Box Grid)'
                        ),
                        React.createElement('p', { className: "text-sm text-slate-500" },
                          lang === 'de' ? 'WAS (Ergebnisse) vs. WIE (Verhalten)' : lang === 'it' ? 'COSA (Risultati) vs. COME (Comportamento)' : 'WHAT (Results) vs. HOW (Behavior)'
                        )
                      )
                    ),
                    // Legende (Rating-Farben)
                    React.createElement('div', { className: "hidden lg:flex items-center gap-3 text-xs" },
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#dc2626' } }),
                        React.createElement('span', { className: "text-slate-600" }, "1 (‚â§1.5)")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#f97316' } }),
                        React.createElement('span', { className: "text-slate-600" }, "2")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#2563eb' } }),
                        React.createElement('span', { className: "text-slate-600" }, "3")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#10b981' } }),
                        React.createElement('span', { className: "text-slate-600" }, "4")
                      ),
                      React.createElement('div', { className: "flex items-center gap-1.5" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: '#16a34a' } }),
                        React.createElement('span', { className: "text-slate-600" }, "5 (>4.5)")
                      )
                    )
                  ),
                  
                  // Chart Container
                  React.createElement('div', { className: "relative", style: { maxWidth: '850px', margin: '0 auto' } },
                    
                    // SVG Chart
                    React.createElement('svg', { 
                      viewBox: `0 0 ${width} ${height}`, 
                      className: "w-full h-auto",
                      style: { minHeight: '420px' }
                    },
                      // Definitionen (Schatten, etc.)
                      React.createElement('defs', null,
                        React.createElement('filter', { id: 'bubbleShadow', x: '-50%', y: '-50%', width: '200%', height: '200%' },
                          React.createElement('feDropShadow', { dx: '0', dy: '3', stdDeviation: '4', floodOpacity: '0.25' })
                        )
                      ),
                      
                      // === 4 ARCHETYPEN-ZONEN (Hintergrund) ===
                      ...zones.map(zone => 
                        React.createElement('g', { key: zone.id },
                          // Zone-Rechteck
                          React.createElement('rect', {
                            x: zone.x, y: zone.y, width: zone.w, height: zone.h,
                            fill: zone.fill, opacity: 0.7
                          }),
                          // Zone-Icon
                          React.createElement('text', {
                            x: zone.x + zone.w / 2, y: zone.y + zone.h / 2 - 8,
                            textAnchor: 'middle', fontSize: '28', opacity: 0.5
                          }, zone.icon),
                          // Zone-Label
                          React.createElement('text', {
                            x: zone.x + zone.w / 2, y: zone.y + zone.h / 2 + 20,
                            textAnchor: 'middle', fontSize: '11', fontWeight: 700,
                            fill: zone.textColor, opacity: 0.9
                          }, zone.name)
                        )
                      ),
                      
                      // === SOLID BACKBONE ZONE (Rating 3 - Meets Expectations) ===
                      React.createElement('rect', {
                        x: solidBackboneX1, y: solidBackboneY1,
                        width: solidBackboneX2 - solidBackboneX1,
                        height: solidBackboneY2 - solidBackboneY1,
                        fill: 'rgba(255,255,255,0.6)',
                        stroke: '#243186', strokeWidth: 2, strokeDasharray: '8,4',
                        rx: 6
                      }),
                      React.createElement('text', {
                        x: (solidBackboneX1 + solidBackboneX2) / 2, 
                        y: (solidBackboneY1 + solidBackboneY2) / 2 + 4,
                        textAnchor: 'middle', fontSize: '10', fontWeight: 600,
                        fill: '#243186', opacity: 0.8
                      }, 'SOLID BACKBONE'),
                      React.createElement('text', {
                        x: (solidBackboneX1 + solidBackboneX2) / 2, 
                        y: (solidBackboneY1 + solidBackboneY2) / 2 + 18,
                        textAnchor: 'middle', fontSize: '9', 
                        fill: '#243186', opacity: 0.6
                      }, '(Rating 3)'),
                      
                      // === ACHSEN-LABELS (CI-Blau) ===
                      React.createElement('text', {
                        x: width / 2, y: height - 8, textAnchor: 'middle',
                        fontSize: '13', fill: '#243186', fontWeight: 600
                      }, lang === 'de' ? 'WAS: Ergebnisse (Ziele) ‚Üí' : lang === 'it' ? 'COSA: Risultati (Obiettivi) ‚Üí' : 'WHAT: Results (Goals) ‚Üí'),
                      
                      React.createElement('text', {
                        x: 14, y: height / 2, textAnchor: 'middle',
                        transform: `rotate(-90 14 ${height / 2})`,
                        fontSize: '13', fill: '#243186', fontWeight: 600
                      }, lang === 'de' ? '‚Üë WIE: Verhalten (Kompetenzen)' : lang === 'it' ? '‚Üë COME: Comportamento (Competenze)' : '‚Üë HOW: Behavior (Competencies)'),
                      
                      // === SKALA X-ACHSE ===
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('g', { key: `x-${v}` },
                          React.createElement('line', {
                            x1: scaleX(v), y1: height - padding, x2: scaleX(v), y2: height - padding + 6,
                            stroke: '#243186', strokeWidth: 1.5
                          }),
                          React.createElement('text', {
                            x: scaleX(v), y: height - padding + 20, textAnchor: 'middle',
                            fontSize: '12', fill: '#243186', fontWeight: 500
                          }, v)
                        )
                      ),
                      
                      // === SKALA Y-ACHSE ===
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('g', { key: `y-${v}` },
                          React.createElement('line', {
                            x1: padding - 6, y1: scaleY(v), x2: padding, y2: scaleY(v),
                            stroke: '#243186', strokeWidth: 1.5
                          }),
                          React.createElement('text', {
                            x: padding - 14, y: scaleY(v) + 4, textAnchor: 'middle',
                            fontSize: '12', fill: '#243186', fontWeight: 500
                          }, v)
                        )
                      ),
                      
                      // === GRID-LINIEN (dezent) ===
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('line', {
                          key: `grid-x-${v}`,
                          x1: scaleX(v), y1: padding, x2: scaleX(v), y2: height - padding,
                          stroke: v === 3 ? '#243186' : '#cbd5e1', 
                          strokeWidth: v === 3 ? 1.5 : 0.5,
                          strokeDasharray: v === 3 ? '6,3' : 'none',
                          opacity: v === 3 ? 0.6 : 0.5
                        })
                      ),
                      ...[1, 2, 3, 4, 5].map(v => 
                        React.createElement('line', {
                          key: `grid-y-${v}`,
                          x1: padding, y1: scaleY(v), x2: width - padding, y2: scaleY(v),
                          stroke: v === 3 ? '#243186' : '#cbd5e1', 
                          strokeWidth: v === 3 ? 1.5 : 0.5,
                          strokeDasharray: v === 3 ? '6,3' : 'none',
                          opacity: v === 3 ? 0.6 : 0.5
                        })
                      ),
                      
                      // === BUBBLES (Mitarbeiter) ===
                      ...bubbleData.map((emp, idx) => {
                        // Deterministischer Jitter basierend auf Name
                        const hashCode = (str) => {
                          let hash = 0;
                          for (let i = 0; i < str.length; i++) {
                            hash = ((hash << 5) - hash) + str.charCodeAt(i);
                            hash = hash & hash;
                          }
                          return hash;
                        };
                        
                        const nameHash = hashCode(emp.name || `emp${idx}`);
                        const jitterX = ((nameHash % 21) - 10);
                        const jitterY = (((nameHash >> 8) % 21) - 10);
                        
                        const baseCx = scaleX(emp.was || 3);
                        const baseCy = scaleY(emp.wie || 3);
                        const cx = Math.max(padding + 20, Math.min(width - padding - 20, baseCx + jitterX));
                        const cy = Math.max(padding + 20, Math.min(height - padding - 20, baseCy + jitterY));
                        
                        const r = Math.max(20, Math.min(38, emp.gps * 7.5));
                        const color = getBubbleColor(emp.gps);
                        
                        return React.createElement('g', { 
                          key: idx,
                          style: { cursor: 'pointer' },
                          onMouseEnter: () => setBubbleTooltip({ ...emp, cx, cy, r, actionCard: getActionCard(emp.gps) }),
                          onMouseLeave: () => setBubbleTooltip(null)
                        },
                          // Bubble mit Schatten
                          React.createElement('circle', {
                            cx, cy, r,
                            fill: color,
                            opacity: 0.85,
                            filter: 'url(#bubbleShadow)',
                            className: 'transition-all duration-200 hover:opacity-100'
                          }),
                          // Wei√üer Ring
                          React.createElement('circle', {
                            cx, cy, r: r - 2,
                            fill: 'none', stroke: 'white', strokeWidth: 2.5, opacity: 0.6
                          }),
                          // Initialen
                          React.createElement('text', {
                            x: cx, y: cy, textAnchor: 'middle', dy: '0.35em',
                            fill: 'white', fontWeight: 700, fontSize: r > 26 ? '14px' : '11px',
                            style: { textShadow: '0 1px 3px rgba(0,0,0,0.4)' }
                          }, emp.initials)
                        );
                      })
                    ),
                    
                    // === TOOLTIP MIT ACTION CARD ===
                    bubbleTooltip && (() => {
                      const tooltipX = (bubbleTooltip.cx / width) * 100;
                      const tooltipY = ((bubbleTooltip.cy - bubbleTooltip.r - 10) / height) * 100;
                      const showBelow = tooltipY < 20;
                      const adjustLeft = tooltipX < 20 ? 'translateX(-5%)' : tooltipX > 80 ? 'translateX(-95%)' : 'translateX(-50%)';
                      const action = bubbleTooltip.actionCard;
                      
                      return React.createElement('div', {
                        className: "absolute bg-white text-slate-800 rounded-xl shadow-2xl text-sm z-50 pointer-events-none border border-slate-200 overflow-hidden",
                        style: { 
                          left: `${tooltipX}%`, 
                          top: showBelow 
                            ? `${((bubbleTooltip.cy + bubbleTooltip.r + 10) / height) * 100}%`
                            : `${tooltipY}%`,
                          transform: showBelow ? `${adjustLeft} translateY(0)` : `${adjustLeft} translateY(-100%)`,
                          minWidth: '220px',
                          maxWidth: '280px'
                        }
                      },
                        // Header mit Name
                        React.createElement('div', { 
                          className: "px-4 py-3 border-b border-slate-100",
                          style: { backgroundColor: '#243186' }
                        },
                          React.createElement('div', { className: "font-bold text-white" }, bubbleTooltip.name)
                        ),
                        // GPS Score
                        React.createElement('div', { className: "px-4 py-3" },
                          React.createElement('div', { className: "flex items-center justify-between mb-3" },
                            React.createElement('span', { className: "text-slate-500 text-xs uppercase tracking-wide" }, "GPS Score"),
                            React.createElement('span', { 
                              className: "text-2xl font-bold",
                              style: { color: action.color }
                            }, bubbleTooltip.gps.toFixed(2))
                          ),
                          // WAS & WIE
                          React.createElement('div', { className: "grid grid-cols-2 gap-2 text-xs mb-3" },
                            React.createElement('div', { className: "bg-slate-50 rounded p-2 text-center" },
                              React.createElement('div', { className: "text-slate-400 mb-0.5" }, lang === 'de' ? 'WAS' : lang === 'it' ? 'COSA' : 'WHAT'),
                              React.createElement('div', { className: "font-semibold text-sm" }, bubbleTooltip.was > 0 ? bubbleTooltip.was.toFixed(1) : '‚Äì')
                            ),
                            React.createElement('div', { className: "bg-slate-50 rounded p-2 text-center" },
                              React.createElement('div', { className: "text-slate-400 mb-0.5" }, lang === 'de' ? 'WIE' : lang === 'it' ? 'COME' : 'HOW'),
                              React.createElement('div', { className: "font-semibold text-sm" }, bubbleTooltip.wie > 0 ? bubbleTooltip.wie.toFixed(1) : '‚Äì')
                            )
                          ),
                          // === ACTION CARD ===
                          React.createElement('div', { 
                            className: "rounded-lg p-3 text-xs",
                            style: { backgroundColor: action.bg }
                          },
                            React.createElement('div', { 
                              className: "font-bold mb-1 flex items-center gap-1.5",
                              style: { color: action.color }
                            },
                              React.createElement('span', null, action.icon),
                              React.createElement('span', null, action.rating)
                            ),
                            React.createElement('div', { className: "text-slate-700" },
                              React.createElement('span', { className: "font-medium" }, 'Action: '),
                              action.action
                            )
                          )
                        )
                      );
                    })()
                  ),
                  
                  // Mobile Legende
                  React.createElement('div', { className: "flex lg:hidden flex-wrap justify-center gap-2 mt-4 text-xs" },
                    [
                      { color: '#dc2626', label: '1' },
                      { color: '#f97316', label: '2' },
                      { color: '#2563eb', label: '3' },
                      { color: '#10b981', label: '4' },
                      { color: '#16a34a', label: '5' }
                    ].map((item, i) => 
                      React.createElement('div', { key: i, className: "flex items-center gap-1" },
                        React.createElement('div', { className: "w-3 h-3 rounded-full", style: { backgroundColor: item.color } }),
                        React.createElement('span', { className: "text-slate-600" }, item.label)
                      )
                    )
                  ),
                  
                  // === ARCHETYPEN-ERKL√ÑRUNG ===
                  React.createElement('div', { className: "mt-6 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-5 border border-slate-200" },
                    React.createElement('h4', { className: "text-sm font-bold mb-4 flex items-center gap-2", style: { color: '#243186' } },
                      React.createElement(Info, { size: 16 }),
                      lang === 'de' ? 'Die 4 Archetypen verstehen' : lang === 'it' ? 'Capire i 4 archetipi' : 'Understanding the 4 Archetypes'
                    ),
                    React.createElement('div', { className: "grid md:grid-cols-2 gap-3" },
                      // ROLE MODEL (oben rechts)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#166534' } },
                        React.createElement('span', { className: "text-xl" }, "‚≠ê"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#166534' } }, "ROLE MODEL"),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'High WAS + High WIE. Vorbilder, Mentoren, Bef√∂rderungskandidaten.'
                              : lang === 'it' ? 'High COSA + High COME. Modelli, mentori, candidati promozione.'
                              : 'High WHAT + High HOW. Role models, mentors, promotion candidates.'
                          )
                        )
                      ),
                      // HIDDEN GEM (oben links)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#854d0e' } },
                        React.createElement('span', { className: "text-xl" }, "üíé"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#854d0e' } }, "HIDDEN GEM"),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'Low WAS + High WIE. Tolles Verhalten, braucht klarere Ziele.'
                              : lang === 'it' ? 'Low COSA + High COME. Ottimo comportamento, serve obiettivi chiari.'
                              : 'Low WHAT + High HOW. Great behavior, needs clearer goals.'
                          )
                        )
                      ),
                      // SOLO STAR (unten rechts)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#9a3412' } },
                        React.createElement('span', { className: "text-xl" }, "üéØ"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#9a3412' } }, "SOLO STAR"),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'High WAS + Low WIE. Erreicht Ziele, aber WIE ist problematisch. Verhaltens-Coaching n√∂tig.'
                              : lang === 'it' ? 'High COSA + Low COME. Raggiunge obiettivi, ma COME problematico. Serve coaching.'
                              : 'High WHAT + Low HOW. Achieves goals, but HOW is problematic. Behavior coaching needed.'
                          )
                        )
                      ),
                      // HANDLUNGSBEDARF (unten links)
                      React.createElement('div', { className: "flex gap-3 p-3 bg-white rounded-lg border-l-4", style: { borderColor: '#991b1b' } },
                        React.createElement('span', { className: "text-xl" }, "üö®"),
                        React.createElement('div', null,
                          React.createElement('div', { className: "font-semibold text-sm", style: { color: '#991b1b' } }, 
                            lang === 'de' ? 'HANDLUNGSBEDARF' : lang === 'it' ? 'AZIONE RICHIESTA' : 'ACTION REQUIRED'
                          ),
                          React.createElement('p', { className: "text-xs text-slate-600 mt-0.5" },
                            lang === 'de' 
                              ? 'Low WAS + Low WIE. Intensive Unterst√ºtzung oder Rollenpassung pr√ºfen.'
                              : lang === 'it' ? 'Low COSA + Low COME. Supporto intensivo o valutare cambio ruolo.'
                              : 'Low WHAT + Low HOW. Intensive support or review role fit.'
                          )
                        )
                      )
                    )
                  ),
                  
                  // Kompakter Hinweis
                  React.createElement('p', { className: "text-xs text-slate-500 mt-4 text-center" },
                    lang === 'de' 
                      ? 'üí° Bubble-Gr√∂√üe = GPS-Score | Farbe = Rating (1-5) | Gestrichelte Box = Solid Backbone (Rating 3)'
                      : lang === 'it' ? 'üí° Dimensione bolla = GPS | Colore = Rating (1-5) | Box tratteggiata = Solid Backbone (Rating 3)'
                      : 'üí° Bubble size = GPS score | Color = Rating (1-5) | Dashed box = Solid Backbone (Rating 3)'
                  )
                );
              })(),
              
              // === KOMPETENZ-HEATMAP ===
              // Zeige ALLE Reviews (auch Entw√ºrfe), nicht nur die mit GPS > 0
              allReviews.length > 0 && (() => {
                // Hilfsfunktionen f√ºr Farbcodierung (Unternehmensfarben)
                const getColorForGPS = (gps) => {
                  if (!gps || gps <= 0) return 'bg-slate-100 text-slate-400';
                  if (gps < 2.0) return 'bg-red-100 text-red-800';
                  if (gps < 2.5) return 'bg-orange-100 text-orange-800';
                  if (gps < 3.5) return 'bg-[#E8F5ED] text-[#243186]'; // Niederwieser Blau auf hellem Gr√ºn
                  return 'bg-[#6EBD84] text-white'; // Niederwieser Gr√ºn
                };
                
                const getColorForLevel = (level) => {
                  if (!level || level <= 0) return 'bg-slate-50 text-slate-400';
                  if (level <= 1.4) return 'bg-red-100 text-red-800';
                  if (level <= 2.4) return 'bg-orange-100 text-orange-800';
                  if (level <= 3.4) return 'bg-[#E8F5ED] text-[#243186]'; // Niederwieser Blau
                  return 'bg-[#6EBD84] text-white'; // Niederwieser Gr√ºn
                };
                
                // Kompetenz-IDs
                const coreCompIds = ['fach', 'komm', 'prob', 'adapt', 'orga'];
                const leaderCompIds = ['lead', 'strat', 'decide', 'exec', 'stake'];
                
                // Kompetenz-Labels (kurz) - mit korrekten IDs
                const compLabels = {
                  de: { fach: 'Fach', komm: 'Komm', prob: 'Prob', adapt: 'Adapt', orga: 'Orga', lead: 'F√ºhrung', strat: 'Strat', decide: 'Entsch', exec: 'Exec', stake: 'Stakeh' },
                  it: { fach: 'Tecn', komm: 'Comm', prob: 'Prob', adapt: 'Adatt', orga: 'Orga', lead: 'Lead', strat: 'Strat', decide: 'Decis', exec: 'Exec', stake: 'Stakeh' },
                  en: { fach: 'Tech', komm: 'Comm', prob: 'Prob', adapt: 'Adapt', orga: 'Orga', lead: 'Lead', strat: 'Strat', decide: 'Decis', exec: 'Exec', stake: 'Stakeh' }
                };
                const labels = compLabels[lang] || compLabels.de;
                
                // Pr√ºfe ob mindestens ein Review Leadership hat
                const hasAnyLeadership = allReviews.some(r => r.includeLeadership && r.leaderScores);
                
                // === FILTER ANWENDEN ===
                const filteredReviews = (() => {
                  if (calibrationFilter === 'completed') {
                    return allReviews.filter(r => r.status === 'completed');
                  } else if (calibrationFilter === 'draft') {
                    return allReviews.filter(r => r.status === 'draft' || !r.status);
                  }
                  return allReviews;
                })();
                
                // Bereite Mitarbeiter-Daten auf
                const employeeData = filteredReviews.map(review => {
                  // Finde Mitarbeiter-Name
                  const member = teamMembers.find(m => m.id === review.employeeId);
                  const name = review.employeeName || member?.name || (lang === 'de' ? 'Unbekannt' : lang === 'it' ? 'Sconosciuto' : 'Unknown');
                  
                  // WAS Score (direkt oder berechnet)
                  const wasScore = review.wasScore || 0;
                  
                  // WIE Scores - normalisiere IDs (unterst√ºtze alle Formate)
                  const rawCoreScores = review.coreScores || {};
                  const rawLeaderScores = review.leaderScores || {};
                  
                  // Normalisiere Core Scores (unterst√ºtze ALLE ID-Formate)
                  // Format 1: fach, komm, prob, adapt, orga (neu)
                  // Format 2: c1, c2, c3, c4, c5 (alt)
                  // Format 3: Numerische IDs von Math.random() (ganz alt)
                  const coreKeys = Object.keys(rawCoreScores);
                  const coreValues = Object.values(rawCoreScores).filter(v => typeof v === 'number' && v > 0);
                  
                  // Wenn numerische Keys, dann nach Position mappen
                  const isNumericKeys = coreKeys.length > 0 && coreKeys.every(k => !isNaN(parseFloat(k)));
                  
                  let coreScores;
                  if (isNumericKeys && coreValues.length >= 5) {
                    // Alte Math.random() IDs - nimm die ersten 5 numerischen Werte
                    const sortedKeys = coreKeys.sort();
                    coreScores = {
                      fach: rawCoreScores[sortedKeys[0]] || 0,
                      komm: rawCoreScores[sortedKeys[1]] || 0,
                      prob: rawCoreScores[sortedKeys[2]] || 0,
                      adapt: rawCoreScores[sortedKeys[3]] || 0,
                      orga: rawCoreScores[sortedKeys[4]] || 0
                    };
                  } else {
                    // Standard: fach/komm oder c1/c2 Format
                    coreScores = {
                      fach: rawCoreScores.fach || rawCoreScores.c1 || 0,
                      komm: rawCoreScores.komm || rawCoreScores.c2 || 0,
                      prob: rawCoreScores.prob || rawCoreScores.c3 || 0,
                      adapt: rawCoreScores.adapt || rawCoreScores.c4 || 0,
                      orga: rawCoreScores.orga || rawCoreScores.c5 || 0
                    };
                  }
                  
                  // Gleiches f√ºr Leader Scores
                  const leaderKeys = Object.keys(rawLeaderScores);
                  const leaderValues = Object.values(rawLeaderScores).filter(v => typeof v === 'number' && v > 0);
                  const isNumericLeaderKeys = leaderKeys.length > 0 && leaderKeys.every(k => !isNaN(parseFloat(k)));
                  
                  let leaderScores;
                  if (isNumericLeaderKeys && leaderValues.length >= 5) {
                    const sortedKeys = leaderKeys.sort();
                    leaderScores = {
                      lead: rawLeaderScores[sortedKeys[0]] || 0,
                      strat: rawLeaderScores[sortedKeys[1]] || 0,
                      decide: rawLeaderScores[sortedKeys[2]] || 0,
                      exec: rawLeaderScores[sortedKeys[3]] || 0,
                      stake: rawLeaderScores[sortedKeys[4]] || 0
                    };
                  } else {
                    leaderScores = {
                      lead: rawLeaderScores.lead || rawLeaderScores.l1 || 0,
                      strat: rawLeaderScores.strat || rawLeaderScores.l2 || 0,
                      decide: rawLeaderScores.decide || rawLeaderScores.l3 || 0,
                      exec: rawLeaderScores.exec || rawLeaderScores.l4 || 0,
                      stake: rawLeaderScores.stake || rawLeaderScores.l5 || 0
                    };
                  }
                  
                  // WIE Durchschnitt
                  const allWieScores = [
                    ...Object.values(coreScores).filter(v => v > 0),
                    ...(review.includeLeadership ? Object.values(leaderScores).filter(v => v > 0) : [])
                  ];
                  const wieAvg = allWieScores.length > 0 
                    ? allWieScores.reduce((s, v) => s + v, 0) / allWieScores.length 
                    : 0;
                  
                  return {
                    id: review.id,
                    employeeId: review.employeeId,
                    name,
                    status: review.status,
                    gps: review.gpsScore || 0,
                    wasScore,
                    wieAvg,
                    coreScores,
                    leaderScores,
                    includeLeadership: review.includeLeadership,
                    note: calibrationNotes[review.id] || '' // Notiz hinzuf√ºgen
                  };
                })
                // === SORTIERUNG ANWENDEN ===
                .sort((a, b) => {
                  const { field, direction } = calibrationSort;
                  let comparison = 0;
                  
                  switch (field) {
                    case 'name':
                      comparison = a.name.localeCompare(b.name);
                      break;
                    case 'gps':
                      comparison = a.gps - b.gps;
                      break;
                    case 'was':
                      comparison = a.wasScore - b.wasScore;
                      break;
                    case 'wie':
                      comparison = a.wieAvg - b.wieAvg;
                      break;
                    default:
                      comparison = a.name.localeCompare(b.name);
                  }
                  
                  return direction === 'desc' ? -comparison : comparison;
                });
                
                // Team-Durchschnitte berechnen
                const calcAvg = (arr) => arr.length > 0 ? arr.reduce((s, v) => s + v, 0) / arr.length : 0;
                
                const teamAvg = {
                  gps: calcAvg(employeeData.map(e => e.gps).filter(v => v > 0)),
                  was: calcAvg(employeeData.map(e => e.wasScore).filter(v => v > 0)),
                  wie: calcAvg(employeeData.map(e => e.wieAvg).filter(v => v > 0)),
                  core: {},
                  leader: {}
                };
                
                // Durchschnitte pro Kompetenz
                coreCompIds.forEach(id => {
                  const vals = employeeData.map(e => e.coreScores[id]).filter(v => v > 0);
                  teamAvg.core[id] = calcAvg(vals);
                });
                
                if (hasAnyLeadership) {
                  leaderCompIds.forEach(id => {
                    const vals = employeeData.filter(e => e.includeLeadership).map(e => e.leaderScores[id]).filter(v => v > 0);
                    teamAvg.leader[id] = calcAvg(vals);
                  });
                }
                
                // Debug-Log f√ºr Heatmap-Daten
                console.log('üî• Heatmap Data:', {
                  employeeCount: employeeData.length,
                  hasLeadership: hasAnyLeadership,
                  teamAvg,
                  sampleEmployee: employeeData[0] || null,
                  colorTest: {
                    level1: getColorForLevel(1),
                    level2: getColorForLevel(2),
                    level3: getColorForLevel(3),
                    level4: getColorForLevel(4),
                    level5: getColorForLevel(5),
                    gps2_0: getColorForGPS(2.0),
                    gps3_0: getColorForGPS(3.0),
                    gps4_0: getColorForGPS(4.0)
                  }
                });
                
                // Render Heatmap
                return React.createElement('div', { className: "bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-slate-200" },
                  // Header
                  React.createElement('div', { className: "flex flex-col md:flex-row md:items-center md:justify-between mb-4" },
                    React.createElement('h3', { className: "text-xl md:text-2xl font-bold flex items-center gap-2", style: { color: "#243186" } },
                      "üî• ", lang === 'de' ? 'Kompetenz-Heatmap' : lang === 'it' ? 'Heatmap Competenze' : 'Competency Heatmap'
                    ),
                    // Legende (Unternehmensfarben)
                    React.createElement('div', { className: "flex flex-wrap gap-2 mt-3 md:mt-0 text-xs" },
                      React.createElement('span', { className: "px-2 py-1 rounded bg-red-100 text-red-800" }, "1 Kritisch"),
                      React.createElement('span', { className: "px-2 py-1 rounded bg-orange-100 text-orange-800" }, "2 Below"),
                      React.createElement('span', { className: "px-2 py-1 rounded bg-[#E8F5ED] text-[#243186]" }, "3 Baseline"),
                      React.createElement('span', { className: "px-2 py-1 rounded bg-[#6EBD84] text-white" }, "4-5 Top")
                    )
                  ),
                  
                  // === COACHING-INFO BOX ===
                  React.createElement('div', { className: "mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100" },
                    React.createElement('div', { className: "flex items-start gap-3" },
                      React.createElement('div', { className: "w-10 h-10 rounded-lg bg-[#243186] flex items-center justify-center flex-shrink-0" },
                        React.createElement(MessageCircle, { size: 20, className: "text-white" })
                      ),
                      React.createElement('div', { className: "flex-1" },
                        React.createElement('h4', { className: "font-bold text-[#243186] text-sm mb-2" },
                          lang === 'de' ? 'üí° Coaching-Tipps f√ºr das Feedbackgespr√§ch' : lang === 'it' ? 'üí° Suggerimenti di coaching per il colloquio' : 'üí° Coaching Tips for Feedback Conversations'
                        ),
                        React.createElement('div', { className: "grid md:grid-cols-2 gap-3 text-xs text-slate-700" },
                          React.createElement('div', { className: "flex items-start gap-2" },
                            React.createElement('span', { className: "text-red-500 font-bold" }, "1-2:"),
                            React.createElement('span', null, 
                              lang === 'de' ? 'Konkretes Beispiel erfragen. Gemeinsam 1-2 Ma√ünahmen definieren. Follow-up in 4 Wochen.'
                              : lang === 'it' ? 'Chiedere esempio concreto. Definire insieme 1-2 azioni. Follow-up in 4 settimane.'
                              : 'Ask for concrete example. Define 1-2 actions together. Follow-up in 4 weeks.'
                            )
                          ),
                          React.createElement('div', { className: "flex items-start gap-2" },
                            React.createElement('span', { className: "text-[#6EBD84] font-bold" }, "4-5:"),
                            React.createElement('span', null, 
                              lang === 'de' ? 'St√§rke anerkennen! Fragen: "Wie k√∂nnen Sie das Team damit unterst√ºtzen?"'
                              : lang === 'it' ? 'Riconoscere il punto di forza! Chiedere: "Come pu√≤ supportare il team con questo?"'
                              : 'Acknowledge strength! Ask: "How can you support the team with this?"'
                            )
                          )
                        )
                      )
                    )
                  ),
                  
                  // === KOMPETENZ-ERKL√ÑRUNGEN (aufklappbar) ===
                  React.createElement('details', { className: "mb-6 group" },
                    React.createElement('summary', { className: "cursor-pointer text-sm font-medium text-[#243186] hover:text-[#1a2564] flex items-center gap-2" },
                      React.createElement(HelpCircle, { size: 16 }),
                      lang === 'de' ? 'Kompetenzen erkl√§rt + Coaching-Fragen' : lang === 'it' ? 'Competenze spiegate + Domande di coaching' : 'Competencies explained + Coaching questions'
                    ),
                    React.createElement('div', { className: "mt-4 grid md:grid-cols-2 gap-3" },
                      // Kernkompetenzen
                      React.createElement('div', { className: "space-y-2" },
                        React.createElement('h5', { className: "font-bold text-slate-700 text-xs uppercase tracking-wide mb-2" }, 
                          lang === 'de' ? 'üìã Kernkompetenzen' : lang === 'it' ? 'üìã Competenze core' : 'üìã Core Competencies'
                        ),
                        // Fachkompetenz
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Fach ‚Äì Fachkompetenz & Anwendung' : 'Fach ‚Äì Technical Expertise'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Wendet Fachwissen effektiv an, l√∂st technische Probleme selbstst√§ndig.' : 'Applies expertise effectively, solves technical problems independently.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Welche Weiterbildung w√ºrde Ihnen helfen?"' : '‚Üí "What training would help you?"'
                          )
                        ),
                        // Kommunikation
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Komm ‚Äì Kommunikation & Zusammenarbeit' : 'Comm ‚Äì Communication & Collaboration'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Teilt Infos proaktiv, h√∂rt aktiv zu, arbeitet konstruktiv mit anderen.' : 'Shares info proactively, listens actively, works constructively with others.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "In welcher Situation war Kommunikation schwierig?"' : '‚Üí "In which situation was communication difficult?"'
                          )
                        ),
                        // Probleml√∂sung
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Prob ‚Äì Probleml√∂sekompetenz' : 'Prob ‚Äì Problem-Solving'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Analysiert Probleme strukturiert, entwickelt kreative L√∂sungen.' : 'Analyzes problems systematically, develops creative solutions.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Welches Problem haben Sie zuletzt gel√∂st? Wie?"' : '‚Üí "What problem did you solve recently? How?"'
                          )
                        ),
                        // Anpassungsf√§higkeit
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Adapt ‚Äì Anpassungsf√§higkeit' : 'Adapt ‚Äì Adaptability'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Reagiert flexibel auf Ver√§nderungen, bleibt offen f√ºr Neues.' : 'Responds flexibly to changes, stays open to new things.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Was war die gr√∂√üte Ver√§nderung dieses Jahr?"' : '‚Üí "What was the biggest change this year?"'
                          )
                        ),
                        // Selbstorganisation
                        React.createElement('div', { className: "bg-slate-50 rounded-lg p-3 text-xs" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Orga ‚Äì Selbstorganisation' : 'Orga ‚Äì Self-Organization'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Priorisiert eigenst√§ndig, h√§lt Deadlines ein, arbeitet strukturiert.' : 'Prioritizes independently, meets deadlines, works in a structured way.'
                          ),
                          React.createElement('p', { className: "text-[#243186] mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Wie organisieren Sie Ihren Arbeitstag?"' : '‚Üí "How do you organize your workday?"'
                          )
                        )
                      ),
                      // F√ºhrungskompetenzen
                      React.createElement('div', { className: "space-y-2" },
                        React.createElement('h5', { className: "font-bold text-purple-700 text-xs uppercase tracking-wide mb-2" }, 
                          lang === 'de' ? 'üëî F√ºhrungskompetenzen' : lang === 'it' ? 'üëî Competenze leadership' : 'üëî Leadership Competencies'
                        ),
                        // Mitarbeiterf√ºhrung
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'F√ºhrung ‚Äì Mitarbeiterf√ºhrung & -entwicklung' : 'Lead ‚Äì People Management & Development'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'F√∂rdert Teammitglieder, gibt regelm√§√üig Feedback, delegiert sinnvoll.' : 'Develops team members, gives regular feedback, delegates meaningfully.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Wie f√∂rdern Sie Ihre Mitarbeiter individuell?"' : '‚Üí "How do you develop your employees individually?"'
                          )
                        ),
                        // Strategisches Denken
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Strat ‚Äì Strategisches Denken' : 'Strat ‚Äì Strategic Thinking'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Denkt √ºber den Tellerrand, plant langfristig, erkennt Zusammenh√§nge.' : 'Thinks beyond the obvious, plans long-term, sees connections.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Welche Trends beeinflussen unseren Bereich?"' : '‚Üí "What trends affect our area?"'
                          )
                        ),
                        // Entscheidungsf√§higkeit
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Entsch ‚Äì Entscheidungsf√§higkeit' : 'Decis ‚Äì Decision-Making'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Trifft zeitnah fundierte Entscheidungen, steht dazu, kommuniziert klar.' : 'Makes timely informed decisions, stands by them, communicates clearly.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Welche schwierige Entscheidung haben Sie getroffen?"' : '‚Üí "What difficult decision did you make?"'
                          )
                        ),
                        // Execution
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Exec ‚Äì Execution & Performance Mgmt' : 'Exec ‚Äì Execution & Performance Mgmt'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Setzt Strategie um, monitort Ergebnisse, steuert bei Abweichungen nach.' : 'Implements strategy, monitors results, adjusts when needed.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Wie tracken Sie den Fortschritt Ihres Teams?"' : '‚Üí "How do you track your team\'s progress?"'
                          )
                        ),
                        // Stakeholder
                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3 text-xs border border-purple-100" },
                          React.createElement('div', { className: "font-semibold text-slate-800" }, lang === 'de' ? 'Stakeh ‚Äì Stakeholder-Mgmt & Konflikte' : 'Stakeh ‚Äì Stakeholder Mgmt & Conflicts'),
                          React.createElement('p', { className: "text-slate-600 mt-1" }, 
                            lang === 'de' ? 'Managt Erwartungen, l√∂st Konflikte konstruktiv, baut Beziehungen auf.' : 'Manages expectations, resolves conflicts constructively, builds relationships.'
                          ),
                          React.createElement('p', { className: "text-purple-700 mt-1 italic" }, 
                            lang === 'de' ? '‚Üí "Welchen Konflikt haben Sie k√ºrzlich gel√∂st?"' : '‚Üí "What conflict did you resolve recently?"'
                          )
                        )
                      )
                    )
                  ),
                  
                  // === MOBILE: Karten-Ansicht (< md) ===
                  React.createElement('div', { className: "md:hidden space-y-4" },
                    employeeData.map(emp => 
                      React.createElement('div', { 
                        key: emp.id, 
                        className: "bg-slate-50 rounded-xl p-4 border border-slate-200"
                      },
                        // Header mit Name und GPS
                        React.createElement('div', { className: "flex justify-between items-start mb-3" },
                          React.createElement('div', null,
                            React.createElement('div', { className: "font-bold text-slate-800" }, emp.name),
                            React.createElement('div', { className: "text-xs text-slate-500 flex items-center gap-1" },
                              emp.status === 'completed' 
                                ? React.createElement('span', { className: "text-green-600" }, "‚úì Abgeschlossen")
                                : React.createElement('span', { className: "text-amber-600" }, "‚úé Entwurf"),
                              emp.includeLeadership && React.createElement('span', { className: "ml-1 text-purple-600" }, "üëî FK")
                            )
                          ),
                          React.createElement('div', { 
                            className: `px-3 py-1.5 rounded-lg font-bold text-lg ${getColorForGPS(emp.gps)}`
                          }, emp.gps.toFixed(2))
                        ),
                        // Scores Grid
                        React.createElement('div', { className: "grid grid-cols-3 gap-2 text-center text-sm mb-3" },
                          React.createElement('div', { className: "bg-white rounded-lg p-2 border border-slate-200" },
                            React.createElement('div', { className: "text-xs text-slate-500" }, lang === 'de' ? 'WAS' : lang === 'it' ? 'COSA' : 'WHAT'),
                            React.createElement('div', { className: "font-bold" }, emp.wasScore > 0 ? emp.wasScore.toFixed(1) : '‚Äì')
                          ),
                          React.createElement('div', { className: "bg-white rounded-lg p-2 border border-slate-200" },
                            React.createElement('div', { className: "text-xs text-slate-500" }, lang === 'de' ? 'WIE √ò' : lang === 'it' ? 'COME √ò' : 'HOW √ò'),
                            React.createElement('div', { className: "font-bold" }, emp.wieAvg > 0 ? emp.wieAvg.toFixed(1) : '‚Äì')
                          ),
                          React.createElement('div', { className: "bg-white rounded-lg p-2 border border-slate-200" },
                            React.createElement('div', { className: "text-xs text-slate-500" }, "GPS"),
                            React.createElement('div', { className: "font-bold" }, emp.gps.toFixed(2))
                          )
                        ),
                        // Kompetenzen als Tags
                        React.createElement('div', { className: "flex flex-wrap gap-1.5" },
                          ...coreCompIds.map(id => {
                            const score = emp.coreScores[id] || 0;
                            return React.createElement('span', { 
                              key: id, 
                              className: `px-2 py-1 rounded text-xs font-medium ${getColorForLevel(score)}`
                            }, `${labels[id]}: ${score > 0 ? score : '‚Äì'}`);
                          }),
                          ...(emp.includeLeadership ? leaderCompIds.map(id => {
                            const score = emp.leaderScores[id] || 0;
                            return React.createElement('span', { 
                              key: id, 
                              className: `px-2 py-1 rounded text-xs font-medium border border-purple-200 ${getColorForLevel(score)}`
                            }, `${labels[id]}: ${score > 0 ? score : '‚Äì'}`);
                          }) : [])
                        ),
                        // === NOTIZEN-BEREICH (Mobile) ===
                        React.createElement('div', { className: "mt-3 pt-3 border-t border-slate-200" },
                          editingNoteId === emp.id
                            ? // Bearbeitungsmodus
                              React.createElement('div', { className: "space-y-2" },
                                React.createElement('textarea', {
                                  value: calibrationNotes[emp.id] || '',
                                  onChange: (e) => setCalibrationNotes({ ...calibrationNotes, [emp.id]: e.target.value }),
                                  placeholder: lang === 'de' ? 'Notiz f√ºr Kalibrierungs-Meeting...' : lang === 'it' ? 'Note per il meeting di calibrazione...' : 'Note for calibration meeting...',
                                  className: "w-full px-3 py-2 text-sm border border-slate-300 rounded-lg resize-none focus:ring-2 focus:ring-[#6EBD84] outline-none",
                                  rows: 2
                                }),
                                React.createElement('div', { className: "flex gap-2" },
                                  React.createElement('button', {
                                    onClick: () => setEditingNoteId(null),
                                    className: "px-3 py-1 text-xs bg-[#243186] text-white rounded-2xl hover:bg-[#1a2563]"
                                  }, '‚úì ' + (lang === 'de' ? 'Fertig' : lang === 'it' ? 'Fatto' : 'Done')),
                                  React.createElement('button', {
                                    onClick: () => {
                                      const newNotes = { ...calibrationNotes };
                                      delete newNotes[emp.id];
                                      setCalibrationNotes(newNotes);
                                      setEditingNoteId(null);
                                    },
                                    className: "px-3 py-1 text-xs text-red-600 hover:bg-red-50 rounded-lg"
                                  }, lang === 'de' ? 'L√∂schen' : lang === 'it' ? 'Elimina' : 'Delete')
                                )
                              )
                            : // Anzeigemodus
                              React.createElement('div', { 
                                onClick: () => setEditingNoteId(emp.id),
                                className: "cursor-pointer text-sm"
                              },
                                emp.note 
                                  ? React.createElement('div', { className: "bg-amber-50 border border-amber-200 rounded-lg p-2 text-amber-800" },
                                      React.createElement('span', { className: "mr-1" }, "üìù"),
                                      emp.note
                                    )
                                  : React.createElement('div', { className: "text-slate-400 hover:text-slate-600 flex items-center gap-1" },
                                      React.createElement(Edit2, { size: 12 }),
                                      lang === 'de' ? 'Notiz hinzuf√ºgen...' : lang === 'it' ? 'Aggiungi nota...' : 'Add note...'
                                    )
                              )
                        )
                      )
                    ),
                    // Mobile: Team-Durchschnitt
                    React.createElement('div', { className: "bg-[#E8F5ED] rounded-xl p-4 border-2 border-[#6EBD84]" },
                      React.createElement('div', { className: "font-bold text-[#243186] mb-2" }, 
                        `üìä ${lang === 'de' ? 'Team-Durchschnitt' : lang === 'it' ? 'Media Team' : 'Team Average'}`
                      ),
                      React.createElement('div', { className: "grid grid-cols-3 gap-2 text-center text-sm" },
                        React.createElement('div', { className: "bg-white rounded-lg p-2" },
                          React.createElement('div', { className: "text-xs text-slate-500" }, "GPS √ò"),
                          React.createElement('div', { className: "font-bold text-[#243186]" }, teamAvg.gps.toFixed(2))
                        ),
                        React.createElement('div', { className: "bg-white rounded-lg p-2" },
                          React.createElement('div', { className: "text-xs text-slate-500" }, "WAS √ò"),
                          React.createElement('div', { className: "font-bold text-[#243186]" }, teamAvg.was.toFixed(1))
                        ),
                        React.createElement('div', { className: "bg-white rounded-lg p-2" },
                          React.createElement('div', { className: "text-xs text-slate-500" }, "WIE √ò"),
                          React.createElement('div', { className: "font-bold text-[#243186]" }, teamAvg.wie.toFixed(1))
                        )
                      )
                    )
                  ),
                  
                  // === DESKTOP: Tabellen-Ansicht (>= md) ===
                  React.createElement('div', { className: "hidden md:block overflow-x-auto" },
                    React.createElement('table', { className: "w-full text-sm border-collapse" },
                      // Thead
                      React.createElement('thead', null,
                        React.createElement('tr', { className: "bg-slate-100" },
                          React.createElement('th', { className: "px-3 py-3 text-left font-bold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[140px]" }, 
                            lang === 'de' ? 'Mitarbeiter' : lang === 'it' ? 'Collaboratore' : 'Employee'
                          ),
                          React.createElement('th', { className: "px-2 py-3 text-center font-bold text-slate-700 min-w-[50px]" }, "GPS"),
                          React.createElement('th', { className: "px-2 py-3 text-center font-bold text-slate-700 min-w-[50px]" }, lang === 'de' ? 'WAS' : lang === 'it' ? 'COSA' : 'WHAT'),
                          React.createElement('th', { className: "px-2 py-3 text-center font-bold text-slate-700 min-w-[50px]" }, lang === 'de' ? 'WIE' : lang === 'it' ? 'COME' : 'HOW'),
                          // Core Kompetenzen
                          ...coreCompIds.map(id => 
                            React.createElement('th', { key: id, className: "px-2 py-3 text-center font-semibold text-slate-600 min-w-[45px]" }, labels[id])
                          ),
                          // Leadership Kompetenzen (falls vorhanden)
                          ...(hasAnyLeadership ? leaderCompIds.map(id => 
                            React.createElement('th', { key: id, className: "px-2 py-3 text-center font-semibold text-purple-700 min-w-[45px] bg-purple-50" }, labels[id])
                          ) : []),
                          // Notizen-Spalte
                          React.createElement('th', { className: "px-3 py-3 text-left font-bold text-slate-700 min-w-[180px] bg-amber-50" }, 
                            "üìù " + (lang === 'de' ? 'Notizen' : lang === 'it' ? 'Note' : 'Notes')
                          )
                        )
                      ),
                      // Tbody
                      React.createElement('tbody', null,
                        // Mitarbeiter-Zeilen
                        ...employeeData.map((emp, idx) => 
                          React.createElement('tr', { 
                            key: emp.id, 
                            className: `border-b border-slate-100 hover:bg-slate-50 ${idx % 2 === 0 ? 'bg-white' : 'bg-slate-50/50'}`
                          },
                            // Name + Status
                            React.createElement('td', { className: "px-3 py-3 sticky left-0 bg-inherit z-10" },
                              React.createElement('div', { className: "flex items-center gap-2 flex-wrap" },
                                React.createElement('span', { className: "font-semibold text-slate-800" }, emp.name),
                                // Status Badge
                                React.createElement('span', { 
                                  className: `text-xs px-2 py-0.5 rounded-full ${emp.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`
                                }, emp.status === 'completed' ? '‚úì' : '‚úé'),
                                // FK Badge
                                emp.includeLeadership && React.createElement('span', { 
                                  className: "text-xs px-2 py-0.5 rounded-full bg-purple-100 text-purple-700"
                                }, "üëî FK")
                              )
                            ),
                            // GPS
                            React.createElement('td', { className: `px-2 py-3 text-center font-bold rounded ${getColorForGPS(emp.gps)}` },
                              emp.gps > 0 ? emp.gps.toFixed(1) : '‚Äì'
                            ),
                            // WAS
                            React.createElement('td', { className: `px-2 py-3 text-center font-medium rounded ${getColorForLevel(emp.wasScore)}` },
                              emp.wasScore > 0 ? emp.wasScore.toFixed(1) : '‚Äì'
                            ),
                            // WIE √ò
                            React.createElement('td', { className: `px-2 py-3 text-center font-medium rounded ${getColorForLevel(emp.wieAvg)}` },
                              emp.wieAvg > 0 ? emp.wieAvg.toFixed(1) : '‚Äì'
                            ),
                            // Core Kompetenzen - IMMER mit Wert anzeigen
                            ...coreCompIds.map(id => 
                              React.createElement('td', { 
                                key: id, 
                                className: `px-2 py-3 text-center rounded font-bold ${getColorForLevel(emp.coreScores[id])}`
                              }, 
                                React.createElement('span', { className: 'text-sm' }, emp.coreScores[id] || '‚Äì')
                              )
                            ),
                            // Leadership Kompetenzen - IMMER mit Wert anzeigen
                            ...(hasAnyLeadership ? leaderCompIds.map(id => 
                              React.createElement('td', { 
                                key: id, 
                                className: `px-2 py-3 text-center rounded font-bold ${emp.includeLeadership ? getColorForLevel(emp.leaderScores[id]) : 'bg-slate-100 text-slate-300'}`
                              }, 
                                React.createElement('span', { className: 'text-sm' }, emp.includeLeadership ? (emp.leaderScores[id] || '‚Äì') : '‚Äì')
                              )
                            ) : []),
                            // === NOTIZEN-ZELLE ===
                            React.createElement('td', { className: "px-3 py-2 bg-amber-50/50" },
                              editingNoteId === emp.id
                                ? // Bearbeitungsmodus
                                  React.createElement('div', { className: "flex items-center gap-2" },
                                    React.createElement('input', {
                                      type: 'text',
                                      value: calibrationNotes[emp.id] || '',
                                      onChange: (e) => setCalibrationNotes({ ...calibrationNotes, [emp.id]: e.target.value }),
                                      placeholder: lang === 'de' ? 'Notiz...' : lang === 'it' ? 'Nota...' : 'Note...',
                                      className: "flex-1 px-2 py-1 text-sm border border-amber-300 rounded focus:ring-2 focus:ring-amber-500 outline-none",
                                      autoFocus: true,
                                      onKeyDown: (e) => { if (e.key === 'Enter') setEditingNoteId(null); }
                                    }),
                                    React.createElement('button', {
                                      onClick: () => setEditingNoteId(null),
                                      className: "px-2 py-1 text-xs bg-amber-500 text-white rounded hover:bg-amber-600"
                                    }, '‚úì')
                                  )
                                : // Anzeigemodus
                                  React.createElement('div', { 
                                    onClick: () => setEditingNoteId(emp.id),
                                    className: "cursor-pointer text-sm min-h-[24px] flex items-center"
                                  },
                                    emp.note 
                                      ? React.createElement('span', { className: "text-amber-800 truncate max-w-[200px]" }, emp.note)
                                      : React.createElement('span', { className: "text-slate-300 hover:text-amber-600 flex items-center gap-1 text-xs" },
                                          React.createElement(Edit2, { size: 12 }),
                                          lang === 'de' ? 'Notiz...' : lang === 'it' ? 'Nota...' : 'Note...'
                                        )
                                  )
                            )
                          )
                        ),
                        
                        // Team-Durchschnitt Zeile
                        React.createElement('tr', { className: "bg-[#E8F5ED] font-bold sticky bottom-0" },
                          React.createElement('td', { className: "px-3 py-3 sticky left-0 bg-[#E8F5ED] z-10 text-[#243186]" }, 
                            `üìä TEAM √ò (${employeeData.length})`
                          ),
                          React.createElement('td', { className: "px-2 py-3 text-center text-[#243186]" }, 
                            teamAvg.gps > 0 ? teamAvg.gps.toFixed(1) : '‚Äì'
                          ),
                          React.createElement('td', { className: "px-2 py-3 text-center text-[#243186]" }, 
                            teamAvg.was > 0 ? teamAvg.was.toFixed(1) : '‚Äì'
                          ),
                          React.createElement('td', { className: "px-2 py-3 text-center text-[#243186]" }, 
                            teamAvg.wie > 0 ? teamAvg.wie.toFixed(1) : '‚Äì'
                          ),
                          // Core Durchschnitte
                          ...coreCompIds.map(id => 
                            React.createElement('td', { key: id, className: "px-2 py-3 text-center text-[#243186]" }, 
                              teamAvg.core[id] > 0 ? teamAvg.core[id].toFixed(1) : '‚Äì'
                            )
                          ),
                          // Leadership Durchschnitte
                          ...(hasAnyLeadership ? leaderCompIds.map(id => 
                            React.createElement('td', { key: id, className: "px-2 py-3 text-center text-purple-900 bg-purple-100" }, 
                              teamAvg.leader[id] > 0 ? teamAvg.leader[id].toFixed(1) : '‚Äì'
                            )
                          ) : []),
                          // Leere Notizen-Zelle f√ºr Team-Durchschnitt
                          React.createElement('td', { className: "px-3 py-3 bg-[#E8F5ED]" })
                        )
                      )
                    )
                  ),
                  
                  // === TEAM-ENTWICKLUNGSEMPFEHLUNG ===
                  employeeData.length > 0 && (() => {
                    // Finde niedrigsten Durchschnitt pro Kompetenz
                    const compAverages = {};
                    coreCompIds.forEach(id => {
                      const vals = employeeData.map(e => e.coreScores[id]).filter(v => v > 0);
                      compAverages[id] = vals.length > 0 ? vals.reduce((a, b) => a + b, 0) / vals.length : 0;
                    });
                    
                    // Sortiere nach niedrigstem Durchschnitt
                    const sortedComps = Object.entries(compAverages)
                      .filter(([_, avg]) => avg > 0)
                      .sort((a, b) => a[1] - b[1]);
                    
                    if (sortedComps.length === 0) return null;
                    
                    const lowestComp = sortedComps[0];
                    const lowestId = lowestComp[0];
                    const lowestAvg = lowestComp[1];
                    
                    // Empfehlungen pro Kompetenz
                    const devRecommendations = {
                      fach: {
                        de: { title: 'Fachkompetenz st√§rken', actions: ['Peer-Learning Sessions einf√ºhren', 'Externe Schulungen pr√ºfen', 'Mentoring durch erfahrene Kollegen'] },
                        it: { title: 'Rafforzare competenza tecnica', actions: ['Introdurre sessioni di peer-learning', 'Valutare formazione esterna', 'Mentoring da colleghi esperti'] }
                      },
                      komm: {
                        de: { title: 'Kommunikation verbessern', actions: ['Regelm√§√üige Team-Meetings etablieren', 'Feedback-Kultur st√§rken', 'Kommunikationstraining anbieten'] },
                        it: { title: 'Migliorare comunicazione', actions: ['Stabilire meeting regolari', 'Rafforzare cultura del feedback', 'Offrire training comunicazione'] }
                      },
                      prob: {
                        de: { title: 'Probleml√∂sekompetenz entwickeln', actions: ['Strukturierte Problemanalyse √ºben', 'Case Studies im Team bearbeiten', 'Design Thinking Workshop'] },
                        it: { title: 'Sviluppare problem solving', actions: ['Praticare analisi strutturata', 'Lavorare su case studies', 'Workshop Design Thinking'] }
                      },
                      adapt: {
                        de: { title: 'Anpassungsf√§higkeit f√∂rdern', actions: ['Change-Kommunikation verbessern', 'Kleine Experimente ermutigen', 'Lessons Learned teilen'] },
                        it: { title: 'Promuovere adattabilit√†', actions: ['Migliorare comunicazione del cambiamento', 'Incoraggiare piccoli esperimenti', 'Condividere lessons learned'] }
                      },
                      orga: {
                        de: { title: 'Selbstorganisation unterst√ºtzen', actions: ['Priorisierungstechniken vermitteln', 'Klare Deadlines setzen', 'Zeitmanagement-Tools einf√ºhren'] },
                        it: { title: 'Supportare auto-organizzazione', actions: ['Insegnare tecniche di prioritizzazione', 'Definire deadline chiare', 'Introdurre strumenti time management'] }
                      }
                    };
                    
                    const rec = devRecommendations[lowestId]?.[lang] || devRecommendations[lowestId]?.de;
                    if (!rec) return null;
                    
                    return React.createElement('div', { className: "mt-6 bg-amber-50 rounded-xl p-5 border border-amber-200" },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "w-10 h-10 rounded-lg bg-amber-500 flex items-center justify-center flex-shrink-0" },
                          React.createElement(Target, { size: 20, className: "text-white" })
                        ),
                        React.createElement('div', { className: "flex-1" },
                          React.createElement('h4', { className: "font-bold text-amber-800 text-sm mb-1" },
                            lang === 'de' ? 'üéØ Team-Entwicklungsempfehlung' : lang === 'it' ? 'üéØ Raccomandazione sviluppo team' : 'üéØ Team Development Recommendation'
                          ),
                          React.createElement('p', { className: "text-sm text-amber-700 mb-3" },
                            lang === 'de' 
                              ? `Niedrigster Team-Durchschnitt: ${labels[lowestId]} (√ò ${lowestAvg.toFixed(1)}) ‚Äì ${rec.title}`
                              : `Media team pi√π bassa: ${labels[lowestId]} (√ò ${lowestAvg.toFixed(1)}) ‚Äì ${rec.title}`
                          ),
                          React.createElement('div', { className: "flex flex-wrap gap-2" },
                            ...rec.actions.map((action, i) => 
                              React.createElement('span', { 
                                key: i, 
                                className: "inline-flex items-center gap-1 px-2 py-1 bg-white rounded-full text-xs text-amber-800 border border-amber-300"
                              },
                                React.createElement(CheckCircle2, { size: 12 }),
                                action
                              )
                            )
                          )
                        )
                      )
                    );
                  })(),
                  
                  // === PEER-LEARNING / MENTORING ENGINE ===
                  employeeData.length >= 2 && (() => {
                    // Vollst√§ndige Kompetenz-Namen f√ºr bessere Lesbarkeit
                    const fullCompNames = {
                      de: { 
                        fach: 'Fachkompetenz', komm: 'Kommunikation', prob: 'Probleml√∂sung', 
                        adapt: 'Anpassungsf√§higkeit', orga: 'Selbstorganisation',
                        lead: 'Mitarbeiterf√ºhrung', strat: 'Strategisches Denken', 
                        decide: 'Entscheidungsf√§higkeit', exec: 'Execution', stake: 'Stakeholder-Management'
                      },
                      it: { 
                        fach: 'Competenza tecnica', komm: 'Comunicazione', prob: 'Problem solving', 
                        adapt: 'Adattabilit√†', orga: 'Auto-organizzazione',
                        lead: 'Gestione personale', strat: 'Pensiero strategico', 
                        decide: 'Capacit√† decisionale', exec: 'Execution', stake: 'Gestione stakeholder'
                      },
                      en: { 
                        fach: 'Technical Expertise', komm: 'Communication', prob: 'Problem Solving', 
                        adapt: 'Adaptability', orga: 'Self-Organization',
                        lead: 'People Management', strat: 'Strategic Thinking', 
                        decide: 'Decision Making', exec: 'Execution', stake: 'Stakeholder Management'
                      }
                    };
                    const compNames = fullCompNames[lang] || fullCompNames.de;
                    
                    // Sammle alle Mentoring-Matches
                    const allMatches = [];
                    
                    // Durchlaufe alle Kompetenzen
                    const allCompIds = [...coreCompIds, ...(hasAnyLeadership ? leaderCompIds : [])];
                    
                    allCompIds.forEach(compId => {
                      const isLeadership = leaderCompIds.includes(compId);
                      
                      // Finde Mentoren (Score 4 oder 5) und Mentees (Score 1 oder 2)
                      const mentors = [];
                      const mentees = [];
                      
                      employeeData.forEach(emp => {
                        const score = isLeadership 
                          ? (emp.includeLeadership ? emp.leaderScores[compId] : 0)
                          : emp.coreScores[compId];
                        
                        if (score >= 4) {
                          mentors.push({ name: emp.name, score, employeeId: emp.employeeId });
                        } else if (score > 0 && score <= 2) {
                          mentees.push({ name: emp.name, score, employeeId: emp.employeeId });
                        }
                      });
                      
                      // Erstelle Matches wenn es sowohl Mentoren als auch Mentees gibt
                      if (mentors.length > 0 && mentees.length > 0) {
                        // Sortiere f√ºr beste Matches: h√∂chster Mentor-Score mit niedrigstem Mentee-Score
                        mentors.sort((a, b) => b.score - a.score);
                        mentees.sort((a, b) => a.score - b.score);
                        
                        // Erstelle Match (bester Mentor mit schlechtestem Mentee)
                        const mentor = mentors[0];
                        const mentee = mentees[0];
                        
                        // Vermeide Self-Matches
                        if (mentor.employeeId !== mentee.employeeId) {
                          allMatches.push({
                            mentor,
                            mentee,
                            compId,
                            compName: compNames[compId] || compId,
                            isLeadership,
                            scoreDiff: mentor.score - mentee.score
                          });
                        }
                      }
                    });
                    
                    // Sortiere nach gr√∂√üter Differenz und nimm max 3
                    allMatches.sort((a, b) => b.scoreDiff - a.scoreDiff);
                    const topMatches = allMatches.slice(0, 3);
                    
                    // Zeige nur an wenn Matches vorhanden
                    if (topMatches.length === 0) return null;
                    
                    return React.createElement('div', { 
                      className: "mt-6 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-5 border border-indigo-200"
                    },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { 
                          className: "w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",
                          style: { background: 'linear-gradient(135deg, #243186 0%, #6366f1 100%)' }
                        },
                          React.createElement(Users, { size: 20, className: "text-white" })
                        ),
                        React.createElement('div', { className: "flex-1" },
                          React.createElement('h4', { className: "font-bold text-sm mb-1", style: { color: '#243186' } },
                            lang === 'de' ? 'ü§ù Peer-Learning Impulse' 
                              : lang === 'it' ? 'ü§ù Impulsi Peer-Learning' 
                              : 'ü§ù Peer-Learning Opportunities'
                          ),
                          React.createElement('p', { className: "text-xs text-indigo-600 mb-3" },
                            lang === 'de' 
                              ? 'Basierend auf Kompetenz-St√§rken und -L√ºcken im Team'
                              : lang === 'it' ? 'Basato su punti di forza e lacune nelle competenze del team'
                              : 'Based on competency strengths and gaps in the team'
                          ),
                          React.createElement('div', { className: "space-y-2" },
                            ...topMatches.map((match, idx) => 
                              React.createElement('div', { 
                                key: idx,
                                className: "bg-white rounded-lg p-3 border border-indigo-100 flex items-center gap-3 text-sm"
                              },
                                // Mentor
                                React.createElement('div', { className: "flex items-center gap-1.5" },
                                  React.createElement('span', { 
                                    className: "w-7 h-7 rounded-full flex items-center justify-center text-white text-xs font-bold",
                                    style: { backgroundColor: '#6EBD84' }
                                  }, match.mentor.score),
                                  React.createElement('span', { className: "font-medium text-slate-800" }, 
                                    match.mentor.name.split(' ')[0]
                                  )
                                ),
                                // Pfeil
                                React.createElement('span', { className: "text-indigo-400" }, '‚Üí'),
                                // Mentee
                                React.createElement('div', { className: "flex items-center gap-1.5" },
                                  React.createElement('span', { 
                                    className: "w-7 h-7 rounded-full flex items-center justify-center text-white text-xs font-bold",
                                    style: { backgroundColor: match.mentee.score === 1 ? '#dc2626' : '#f97316' }
                                  }, match.mentee.score),
                                  React.createElement('span', { className: "font-medium text-slate-800" }, 
                                    match.mentee.name.split(' ')[0]
                                  )
                                ),
                                // Kompetenz-Badge
                                React.createElement('span', { 
                                  className: `ml-auto px-2 py-0.5 rounded text-xs font-medium ${match.isLeadership ? 'bg-purple-100 text-purple-700' : 'bg-indigo-100 text-indigo-700'}`
                                }, match.compName)
                              )
                            )
                          ),
                          // Hinweis
                          React.createElement('p', { className: "text-xs text-indigo-500 mt-3 italic" },
                            lang === 'de' 
                              ? 'üí° Peer-Mentoring f√∂rdert Wissenstransfer und st√§rkt das Team.'
                              : lang === 'it' ? 'üí° Il peer-mentoring promuove il trasferimento di conoscenze e rafforza il team.'
                              : 'üí° Peer mentoring promotes knowledge transfer and strengthens the team.'
                          )
                        )
                      )
                    );
                  })(),
                  
                  // Hinweis
                  React.createElement('p', { className: "text-xs text-slate-500 mt-4 text-center" },
                    lang === 'de' 
                      ? 'üí° Tipp: Scrolle horizontal um alle Kompetenzen zu sehen. Lila Spalten = Leadership-Kompetenzen.'
                      : 'üí° Suggerimento: Scorri orizzontalmente per vedere tutte le competenze. Colonne viola = Competenze Leadership.'
                  )
                );
              })(),
              
              // Quick Actions
              React.createElement('div', { className: "flex flex-wrap gap-3 justify-center" },
                React.createElement('button', {
                  onClick: () => setActiveView('teamoverview'),
                  className: "flex items-center gap-2 px-5 py-2.5 bg-slate-100 text-slate-700 rounded-2xl hover:bg-slate-200 transition-colors text-sm font-medium"
                },
                  React.createElement(Users, { size: 16 }),
                  getText(lang, 'Team-√úbersicht', 'Panoramica team', 'Team Overview')
                ),
                reviewsWithGPS.length > 0 && React.createElement('button', {
                  onClick: () => setActiveView('formular'),
                  className: "flex items-center gap-2 px-5 py-2.5 bg-[#6EBD84] text-white rounded-2xl hover:bg-[#5da872] transition-colors text-sm font-medium"
                },
                  React.createElement(FileText, { size: 16 }),
                  lang === 'de' ? 'Neues Review' : lang === 'it' ? 'Nuova review' : 'New Review'
                )
              )
            );
          };
          
const renderDashboard = () => {
            // Safety check inside render
            if (!data || !data.intro) return React.createElement('div', null, "Loading...");

            return React.createElement('div', { className: "space-y-8 animate-in fade-in duration-500" },
              // === MIGRATION SUCCESS BANNER ===
              migrationStatus === 'done' && migrationResult && (migrationResult.members > 0 || migrationResult.appraisals > 0) &&
                React.createElement('div', { 
                  className: 'bg-green-50 border border-green-200 rounded-xl p-4 flex items-start gap-3 animate-in fade-in duration-500'
                },
                  React.createElement(CheckCircle2, { size: 24, className: 'text-green-600 flex-shrink-0 mt-0.5' }),
                  React.createElement('div', { className: 'flex-1' },
                    React.createElement('h4', { className: 'font-semibold text-green-800 mb-1' },
                      getText(lang, '‚ú® Daten erfolgreich migriert!', '‚ú® Dati migrati con successo!', '‚ú® Data successfully migrated!')
                    ),
                    React.createElement('p', { className: 'text-sm text-green-700' },
                      getText(lang,
                        `${migrationResult.members} Mitarbeiter und ${migrationResult.appraisals} Bewertungen wurden in die Cloud √ºbertragen. Ihre Daten sind jetzt sicher in Firebase gespeichert.`,
                        `${migrationResult.members} collaboratori e ${migrationResult.appraisals} valutazioni sono stati trasferiti nel cloud. I tuoi dati sono ora salvati in Firebase.`,
                        `${migrationResult.members} employees and ${migrationResult.appraisals} appraisals have been transferred to the cloud. Your data is now securely stored in Firebase.`)
                    )
                  ),
                  React.createElement('button', {
                    onClick: () => { setMigrationStatus(null); setMigrationResult(null); },
                    className: 'text-green-600 hover:text-green-800 p-1'
                  }, React.createElement(X, { size: 18 }))
                ),
              
              // === QUICKSTART GUIDE (GANZ OBEN) ===
              React.createElement('div', { className: "bg-gradient-to-br from-slate-50 to-white rounded-2xl p-6 md:p-8 shadow-lg border border-slate-200" },
                React.createElement('div', { className: "flex items-center gap-3 mb-6" },
                  React.createElement('div', { className: "bg-[#6EBD84] p-3 rounded-xl" },
                    React.createElement(Lightbulb, { size: 28, className: "text-white" })
                  ),
                  React.createElement('div', null,
                    React.createElement('h2', { className: "text-2xl font-bold", style: { color: "#243186" } },
                      lang === 'de' ? 'üöÄ Schnellstart-Guide' : lang === 'it' ? 'üöÄ Guida Rapida' : 'üöÄ Quick Start Guide'
                    ),
                    React.createElement('p', { className: "text-slate-500 text-sm" },
                      lang === 'de' ? 'So nutzen Sie den Performance Manager' : lang === 'it' ? 'Come utilizzare il Performance Manager' : 'How to use the Performance Manager'
                    )
                  )
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 gap-6" },
                  // LINKE SPALTE: F√ºr F√ºhrungskr√§fte
                  React.createElement('div', { className: "bg-[#243186] rounded-xl p-5 text-white" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-4" },
                      React.createElement(Users, { size: 24, className: "text-[#6EBD84]" }),
                      React.createElement('h3', { className: "text-lg font-bold" },
                        lang === 'de' ? 'F√ºr F√ºhrungskr√§fte' : lang === 'it' ? 'Per Manager' : 'For Managers'
                      )
                    ),
                    React.createElement('div', { className: "space-y-4" },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '1'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Account erstellen' : lang === 'it' ? 'Crea account' : 'Create account'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? 'Unter "Team-√úbersicht" registrieren.' : lang === 'it' ? 'Registrati in "Panoramica team".' : 'Register in "Team Overview".')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '2'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Team anlegen' : lang === 'it' ? 'Crea team' : 'Create team'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? 'Unter "Team-√úbersicht" Mitarbeiter hinzuf√ºgen.' : lang === 'it' ? 'In "Panoramica team" aggiungi collaboratori.' : 'Add employees in "Team Overview".')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '3'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Selbstreflexion-Link senden' : lang === 'it' ? 'Invia link autovalutazione' : 'Send self-reflection link'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? '"üìã Selbstreflexion-Link" an Mitarbeiter senden.' : lang === 'it' ? 'Invia "üìã Link autovalutazione" al collaboratore.' : 'Send "üìã Self-Reflection Link" to employee.')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#6EBD84] text-[#243186] font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '4'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold text-[#6EBD84]" }, lang === 'de' ? 'Beurteilung erstellen' : lang === 'it' ? 'Crea valutazione' : 'Create assessment'),
                          React.createElement('p', { className: "text-sm text-slate-300" }, lang === 'de' ? '"üìù Beurteilung starten" oder "üéØ Zielvereinbarung".' : lang === 'it' ? '"üìù Avvia valutazione" o "üéØ Obiettivi".' : '"üìù Start Assessment" or "üéØ Goals".')
                        )
                      )
                    )
                  ),
                  // RECHTE SPALTE: F√ºr Mitarbeiter
                  React.createElement('div', { className: "bg-white rounded-xl p-5 border-2 border-[#6EBD84]" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-4" },
                      React.createElement(User, { size: 24, className: "text-[#243186]" }),
                      React.createElement('h3', { className: "text-lg font-bold", style: { color: "#243186" } },
                        lang === 'de' ? 'F√ºr Mitarbeiter' : lang === 'it' ? 'Per Collaboratori' : 'For Employees'
                      )
                    ),
                    React.createElement('div', { className: "bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4" },
                      React.createElement('div', { className: "flex items-center gap-2" },
                        React.createElement(Link, { size: 16, className: "text-purple-600" }),
                        React.createElement('p', { className: "text-sm font-medium text-purple-700" },
                          lang === 'de' ? 'Link erhalten? Einfach √∂ffnen ‚Äì kein Login n√∂tig!' : lang === 'it' ? 'Ricevuto un link? Aprilo ‚Äì nessun login!' : 'Received a link? Just open it ‚Äì no login needed!'
                        )
                      )
                    ),
                    React.createElement('div', { className: "space-y-4" },
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#243186] text-white font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '1'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold", style: { color: "#243186" } }, lang === 'de' ? 'Link √∂ffnen' : lang === 'it' ? 'Apri link' : 'Open link'),
                          React.createElement('p', { className: "text-sm text-slate-600" }, lang === 'de' ? 'Klicken Sie auf den Link in der E-Mail.' : lang === 'it' ? 'Clicca sul link nell\'email.' : 'Click the link in the email.')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#243186] text-white font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '2'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold", style: { color: "#243186" } }, lang === 'de' ? 'Selbsteinsch√§tzung ausf√ºllen' : lang === 'it' ? 'Compila autovalutazione' : 'Complete self-assessment'),
                          React.createElement('p', { className: "text-sm text-slate-600" }, lang === 'de' ? 'Kompetenzen ehrlich bewerten.' : lang === 'it' ? 'Valuta le competenze onestamente.' : 'Rate competencies honestly.')
                        )
                      ),
                      React.createElement('div', { className: "flex items-start gap-3" },
                        React.createElement('div', { className: "bg-[#243186] text-white font-bold w-7 h-7 rounded-full flex items-center justify-center text-sm flex-shrink-0" }, '3'),
                        React.createElement('div', null,
                          React.createElement('p', { className: "font-semibold", style: { color: "#243186" } }, lang === 'de' ? 'Absenden' : lang === 'it' ? 'Invia' : 'Submit'),
                          React.createElement('p', { className: "text-sm text-slate-600" }, lang === 'de' ? 'Ihre F√ºhrungskraft sieht die Antworten.' : lang === 'it' ? 'Il manager vedr√† le risposte.' : 'Your manager sees the answers.')
                        )
                      )
                    )
                  )
                ),
                React.createElement('div', { className: "mt-4 text-center" },
                  React.createElement('p', { className: "text-sm text-slate-500" },
                    lang === 'de' ? 'üí° Nutzen Sie die Seitenleiste links zur Navigation.' : lang === 'it' ? 'üí° Usa la barra laterale per navigare.' : 'üí° Use the sidebar to navigate.'
                  )
                )
              ),
              
              React.createElement('div', { className: "bg-white rounded-xl p-6 shadow-sm border border-slate-200" },
                React.createElement('h2', { className: "text-2xl font-bold mb-4", style: { color: "#243186" } }, t.welcome),
                React.createElement('p', { className: "mb-6 leading-relaxed", style: { color: "#243186" } },
                  t.intro, React.createElement('strong', null, t.introBold), t.introEnd
                ),
                React.createElement('div', { className: "bg-slate-50 p-5 rounded-lg border border-slate-100 mb-6" },
                  React.createElement('h3', { className: "font-semibold mb-3 flex items-center gap-2", style: { color: "#243186" } },
                    React.createElement(Target, { size: 18 }), " ", t.strategyTitle
                  ),
                  React.createElement('p', { className: "text-sm leading-relaxed", style: { color: "#243186" } },
                    t.strategyDesc, React.createElement('strong', null, t.strategyBold), t.strategyEnd
                  )
                )
              ),
              
              React.createElement('div', { className: "grid md:grid-cols-3 gap-4" },
                // BEGIN: Fast, Fair, Personal Block
                data.intro.values.map((val) => (
                  React.createElement('div', { 
                    key: val.key, 
                    // Dunkler Hintergrund, wei√üer Text, Akzentlinie oben
                    className: "bg-[#243186] p-5 rounded-xl shadow-lg border-t-4 border-t-[#6EBD84] flex flex-col items-center text-center transition-all hover:shadow-xl" 
                  },
                    // Icon: Wei√ü mit Akzentfarbe f√ºr die Hervorhebung
                    React.createElement('div', { className: `mb-3 p-2 rounded-full border-2 border-white/50 text-white/90` }, 
                      React.createElement(val.icon, { size: 32 })
                    ),
                    // Titel: Wei√üer Text, fett
                    React.createElement('h3', { className: "font-bold text-lg text-white mb-1" }, val.key),
                    // Beschreibung: Hellerer wei√üer Text
                    React.createElement('p', { className: "text-sm text-slate-300" }, val.desc)
                  )
                ))
                // END: Fast, Fair, Personal Block
              ),
              
              // Performance Kompass Section
              React.createElement('div', { 
                className: "rounded-xl shadow-lg p-8", 
                style: { background: "linear-gradient(135deg, #243186 0%, #1a2460 100%)" }
              },
                React.createElement('h2', { className: "text-3xl font-bold text-white mb-3" }, 
                  t.performanceCompassTitle
                ),
                React.createElement('p', { className: "text-slate-200 text-lg mb-6 leading-relaxed" }, 
                  t.performanceCompassSubtitle
                ),
                // Top Row: WAS + WIE
                React.createElement('div', { className: "relative mb-6" },
                  React.createElement('div', { className: "grid md:grid-cols-2 gap-6" },
                    // WAS Box
                    React.createElement('div', { 
                      className: "bg-white/10 backdrop-blur-sm rounded-2xl p-6 border-2 border-white/20 hover:border-[#6EBD84] transition-all duration-300 hover:scale-105"
                    },
                      React.createElement('div', { className: "flex items-center justify-between mb-4" },
                        React.createElement('h3', { 
                          className: "text-3xl font-bold",
                          style: { color: "#6EBD84" }
                        }, t.wasBoxTitle),
                        React.createElement(Target, { size: 48, className: "text-white/60" })
                      ),
                      React.createElement('p', { className: "text-white text-lg" }, 
                        t.wasBoxSubtitle
                      )
                    ),
                    
                    // WIE Box - mit dynamischem Inhalt f√ºr Manager/Mitarbeiter
                    React.createElement('div', { 
                      className: "bg-white/10 backdrop-blur-sm rounded-2xl p-6 border-2 border-white/20 hover:border-[#6EBD84] transition-all duration-300 hover:scale-105"
                    },
                      React.createElement('div', { className: "flex items-center justify-between mb-4" },
                        React.createElement('h3', { 
                          className: "text-3xl font-bold",
                          style: { color: "#6EBD84" }
                        }, t.wieBoxTitle),
                        React.createElement(Brain, { size: 48, className: "text-white/60" })
                      ),
                      React.createElement('p', { className: "text-white text-lg mb-2" }, 
                        t.wieBoxSubtitle
                      ),
                      // Manager/Mitarbeiter Unterscheidung
                      React.createElement('div', { className: "mt-3 pt-3 border-t border-white/20" },
                        React.createElement('div', { className: "flex items-start gap-2 text-sm text-white/80" },
                          React.createElement(Users, { size: 14, className: "mt-0.5 flex-shrink-0" }),
                          React.createElement('span', null, 
                            lang === 'de' ? 'Mitarbeitende: 50% Kern-Kompetenzen' : lang === 'it' ? 'Collaboratori: 50% Competenze Core' : 'Employees: 50% Core Competencies'
                          )
                        ),
                        React.createElement('div', { className: "flex items-start gap-2 text-sm text-white/80 mt-1" },
                          React.createElement(Award, { size: 14, className: "mt-0.5 flex-shrink-0" }),
                          React.createElement('span', null, 
                            lang === 'de' ? 'F√ºhrungskr√§fte: 25% Kern-Komp. + 25% Leadership' : lang === 'it' ? 'Dirigenti: 25% Comp. Core + 25% Leadership' : 'Managers: 25% Core Comp. + 25% Leadership'
                          )
                        )
                      )
                    )
                  ),
                  // Plus Symbol zwischen den Boxen (nur Desktop)
                  React.createElement('div', { className: "hidden md:flex absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none" },
                    React.createElement('div', { className: "w-16 h-16 rounded-full bg-white flex items-center justify-center shadow-lg" },
                      React.createElement('span', { className: "text-[#243186] text-4xl font-bold" }, "+")
                    )
                  )
                ),
                
                // Formel-Erkl√§rung unter den Boxen
                React.createElement('div', { className: "flex justify-center mb-4" },
                  React.createElement('div', { className: "bg-white/5 backdrop-blur-sm rounded-lg px-6 py-3 border border-white/10" },
                    React.createElement('p', { className: "text-white/90 text-sm text-center" },
                      lang === 'de' 
                        ? 'üìä GPS = 50% WAS-Zielerreichung + 50% WIE-Kompetenzbewertung'
                        : 'üìä GPS = 50% Raggiungimento COSA + 50% Valutazione COME'
                    )
                  )
                ),
                
                // GPS Result Box - mittig positioniert, zentrierter Text
                React.createElement('div', { className: "flex justify-center" },
                  React.createElement('div', { 
                    className: "w-full md:w-1/2 bg-gradient-to-br from-[#6EBD84] to-[#5aa871] rounded-2xl p-6 border-2 border-white shadow-2xl transform hover:scale-105 transition-all duration-300"
                  },
                    React.createElement('div', { className: "text-center" },
                      React.createElement('h3', { 
                        className: "text-3xl font-bold text-white mb-2"
                      }, "GPS"),
                      React.createElement('p', { className: "text-white text-lg" }, 
                        "Global Performance Score"
                      )
                    )
                  )
                ),
                // Fairness Garantie Badge
                React.createElement('div', { className: "flex justify-center mt-6" },
                  React.createElement('div', { 
                    className: "inline-flex items-center gap-3 px-6 py-3 rounded-full border-2",
                    style: { 
                      backgroundColor: "rgba(110, 189, 132, 0.2)",
                      borderColor: "#6EBD84"
                    }
                  },
                    React.createElement(Scale, { size: 20, style: { color: "#6EBD84" } }),
                    React.createElement('span', { 
                      className: "font-bold text-sm uppercase tracking-wider",
                      style: { color: "#6EBD84" }
                    }, t.fairnessGuarantee)
                  )
                ),
                
                // GPS Rating Scale Table
                React.createElement('div', { className: "mt-6 bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20" },
                  React.createElement('p', { className: "text-white text-center text-sm mb-4" },
                    lang === 'de' 
                      ? 'Der finale GPS-Score wird in ein 5-stufiges Rating √ºberf√ºhrt:'
                      : 'Il punteggio GPS finale viene convertito in un rating a 5 livelli:'
                  ),
                  React.createElement('div', { className: "overflow-hidden rounded-lg border border-white/30" },
                    // Header Row
                    React.createElement('div', { className: "grid grid-cols-3 gap-0" },
                      React.createElement('div', { className: "bg-white/20 backdrop-blur-sm px-4 py-3 font-bold text-white text-sm border-r border-white/30" },
                        lang === 'de' ? 'GPS-Score' : lang === 'it' ? 'Punteggio GPS' : 'GPS Score'
                      ),
                      React.createElement('div', { className: "bg-white/20 backdrop-blur-sm px-4 py-3 font-bold text-white text-sm text-center border-r border-white/30" },
                        'Note'
                      ),
                      React.createElement('div', { className: "bg-white/20 backdrop-blur-sm px-4 py-3 font-bold text-white text-sm" },
                        lang === 'de' ? 'Beschreibung' : 'Descrizione'
                      )
                    ),
                    // Rating 5
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-pink-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '4,51 ‚Äì 5,00'
                      ),
                      React.createElement('div', { className: "bg-pink-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '5'
                      ),
                      React.createElement('div', { className: "bg-pink-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Outstanding'
                      )
                    ),
                    // Rating 4
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-orange-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '3,51 ‚Äì 4,50'
                      ),
                      React.createElement('div', { className: "bg-orange-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '4'
                      ),
                      React.createElement('div', { className: "bg-orange-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Exceeds Expectations'
                      )
                    ),
                    // Rating 3
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-blue-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '2,51 ‚Äì 3,50'
                      ),
                      React.createElement('div', { className: "bg-blue-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '3'
                      ),
                      React.createElement('div', { className: "bg-blue-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Meets Expectations (Baseline)'
                      )
                    ),
                    // Rating 2
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-green-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '1,51 ‚Äì 2,50'
                      ),
                      React.createElement('div', { className: "bg-green-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '2'
                      ),
                      React.createElement('div', { className: "bg-green-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Needs Improvement'
                      )
                    ),
                    // Rating 1
                    React.createElement('div', { className: "grid grid-cols-3 gap-0 border-t border-white/30" },
                      React.createElement('div', { className: "bg-teal-50/10 px-4 py-3 text-white text-sm border-r border-white/30" },
                        '1,00 ‚Äì 1,50'
                      ),
                      React.createElement('div', { className: "bg-teal-50/10 px-4 py-3 text-white text-lg font-bold text-center border-r border-white/30" },
                        '1'
                      ),
                      React.createElement('div', { className: "bg-teal-50/10 px-4 py-3 text-white text-sm font-semibold" },
                        'Does Not Meet'
                      )
                    )
                  )
                )
              ),
              
              // Hintergrundfarbe ge√§ndert auf das CI-Dunkelblau: #243186
              React.createElement('div', { className: "bg-[#243186] rounded-xl p-6 text-white shadow-lg" },
                React.createElement('div', { className: "flex flex-col items-start" },
                  React.createElement('h3', { className: "text-xl font-bold mb-2" }, t.barsTitle),
                  React.createElement('p', { className: "text-[#E8F5ED] text-sm mb-4 opacity-90" }, t.barsDesc),
                  React.createElement('button', {
                    onClick: () => setActiveView('list'),
                    className: "bg-white text-[#6EBD84] px-6 py-2 rounded-lg font-semibold hover:bg-[#F4FAF7] transition-colors"
                  }, t.btnCompetencies)
                )
              ),
              
              React.createElement('div', { className: "mt-12 mb-8" },
                React.createElement('h2', { className: "text-2xl font-bold mb-8 text-center", style: { color: "#243186" } },
                  lang === 'de' ? 'DER JAHRESZYKLUS IM √úBERBLICK' : 'IL CICLO ANNUALE IN SINTESI'
                ),
                // Verwendung der benutzerdefinierten Klasse f√ºr gleich hohe Spalten
                React.createElement('div', { className: "equal-height-grid" },
                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(Scale, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 1' : 'FASE 1'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Entwurf & Kalibrierung' : 'Bozza & Calibrazione'
                      )
                    ),
                    // Inhalt ohne Aufz√§hlungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(ClipboardList, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'F√ºhrungskraft erstellt GPS-Entwurf.' 
                          : 'Il manager crea la bozza GPS.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(CalendarCheck, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Kalibrierungs-Meeting im F√ºhrungskreis sichert Fairness.' 
                          : 'Meeting di calibrazione nel team di leadership garantisce equit√†.')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'WICHTIG: Nach diesem Meeting ist der GPS-Score final und verbindlich.' 
                          : 'IMPORTANTE: Dopo questo meeting il punteggio GPS √® finale e vincolante.'
                      )
                    )
                  ),

                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(Brain, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 2' : 'FASE 2'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Selbstreflexion' : 'Autoriflessione'
                      )
                    ),
                    // Inhalt ohne Aufz√§hlungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(BookOpen, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Mitarbeiter bereitet Selbstreflexion vor.' 
                          : 'Il collaboratore prepara l\'autoriflessione.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Users, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Dient als Basis f√ºr den Dialog auf Augenh√∂he.' 
                          : 'Serve come base per il dialogo alla pari.')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'TIMING: Zusendung an FK ca. eine Woche vor Gespr√§chstermin' 
                          : 'TIMING: Invio al manager ca. una settimana prima del colloquio'
                      )
                    )
                  ),

                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(MessageCircle, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 3' : 'FASE 3'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Review-Gespr√§ch' : 'Colloquio di Review'
                      )
                    ),
                    // Inhalt ohne Aufz√§hlungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Scale, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Erkl√§rung des GPS-Scores' 
                          : 'Spiegazione del punteggio GPS')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Target, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Feedback zu Zielerreichung (WAS) & Kompetenzen (WIE)' 
                          : 'Feedback sul raggiungimento obiettivi (COSA) & competenze (COME)')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'Keine Verhandlung des GPS-Scores, aber offenes Ohr.' 
                          : 'Nessuna negoziazione del punteggio GPS, ma ascolto aperto.'
                      )
                    )
                  ),

                  React.createElement('div', { className: "bg-[#243186] rounded-3xl p-6 text-white shadow-lg border-4 border-[#6EBD84] flex flex-col" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                      React.createElement(Target, { size: 64, className: "text-white" })
                    ),
                    React.createElement('div', { className: "text-center mb-4" },
                      React.createElement('p', { className: "text-sm uppercase tracking-wider text-slate-300 mb-2" }, 
                        lang === 'de' ? 'PHASE 4' : 'FASE 4'
                      ),
                      React.createElement('h3', { className: "text-xl font-bold", style: { color: "#6EBD84" } },
                        lang === 'de' ? 'Zielvereinbarung' : 'Definizione Obiettivi'
                      )
                    ),
                    // Inhalt ohne Aufz√§hlungspunkte/Striche
                    React.createElement('div', { className: "space-y-3 text-sm mb-4 flex-1" },
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(TrendingUp, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Blick nach vorne.' 
                          : 'Sguardo al futuro.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Briefcase, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Vereinbarung der neuen Ziele.' 
                          : 'Definizione dei nuovi obiettivi.')
                      ),
                      React.createElement('div', { className: "flex items-start gap-2" },
                        React.createElement(Lightbulb, { size: 16, className: "text-[#6EBD84] mt-1 shrink-0" }), 
                        React.createElement('span', { className: "text-white" }, lang === 'de' 
                          ? 'Erstellung des Entwicklungsplans' 
                          : 'Creazione del piano di sviluppo')
                      )
                    ),
                    React.createElement('div', { className: "bg-[#6EBD84] rounded-xl p-3 mt-auto" },
                      React.createElement('p', { className: "text-xs font-bold text-[#243186]" },
                        lang === 'de' 
                          ? 'HALBJAHRES-CHECK: Kurzer Boxenstopp zur Kurskorrektur.' 
                          : 'CHECK SEMESTRALE: Breve pit-stop per correzione di rotta.'
                      )
                    )
                  )
                )
              )
            );
          };

          // === HANDLUNGSLEITFADEN / USER GUIDE ===
          const renderGuide = () => {
            const guideSteps = {
              de: [
                { num: 1, icon: 'üîê', title: 'Anmeldung im System', goal: 'Zugang zur App erhalten', items: ['Im Men√º auf ‚ÄûTeam-√úbersicht" klicken', 'Falls noch nicht registriert: ‚ÄûRegistrieren" w√§hlen', 'Firmen-E-Mail und Passwort (min. 6 Zeichen) eingeben', 'Bei erneutem Besuch: ‚ÄûAnmelden" nutzen'], tip: 'Die Registrierung erfolgt direkt √ºber ‚ÄûTeam-√úbersicht" ‚Äì kein separater Anmeldeprozess n√∂tig.' },
                { num: 2, icon: 'üë•', title: 'Team aufbauen', goal: 'Ihre Mitarbeiter im System erfassen', items: ['Nach Anmeldung erscheint ‚ÄûTeam-√úbersicht" automatisch', 'Formular ‚ÄûNeuen Mitarbeiter hinzuf√ºgen" ausf√ºllen', 'Name und Position sind Pflichtfelder', 'E-Mail eingeben f√ºr automatische Einladung'], tip: 'Pro Mitarbeiter wird automatisch ein pers√∂nlicher Zugangs-Link (accessCode) erstellt!' },
                { num: 3, icon: 'üìß', title: 'Zur Selbstreflexion einladen', goal: 'Mitarbeiter aktiv einbinden', items: ['In der Mitarbeiterliste: E-Mail-Button (‚úâÔ∏è) oder Link-Button (üîó)', 'Bei hinterlegter E-Mail: Button √∂ffnet fertigen E-Mail-Entwurf', 'Ohne E-Mail: Link wird in Zwischenablage kopiert', 'Mitarbeiter kann OHNE Registrierung ausf√ºllen'], email: 'Betreff: Vorbereitung Jahresgespr√§ch ‚Äì Selbstreflexion\n\nHallo [Name],\n\nzur Vorbereitung auf unser Jahresgespr√§ch bitte ich dich, deine Selbstreflexion digital auszuf√ºllen.\n\nDein pers√∂nlicher Link (keine Anmeldung n√∂tig):\n[Link wird automatisch eingef√ºgt]\n\nBitte bis eine Woche vor unserem Termin ausf√ºllen.\n\nViele Gr√º√üe' },
                { num: 4, icon: 'üìÖ', title: 'Gespr√§chstermin festlegen (optional)', goal: 'Termin im System dokumentieren', items: ['Bei Mitarbeiter auf ‚ÄûüìÖ Termin" klicken', 'Datum und Uhrzeit eingeben', 'Kalender-Datei (.ics) wird heruntergeladen', 'Termin erscheint in der Mitarbeiterliste als Badge'], tip: 'üí° Dies ist eine Unterst√ºtzungsfunktion ‚Äì die eigentliche Terminorganisation erfolgt wie gewohnt √ºber Outlook. Diese Funktion hilft lediglich, den √úberblick zu behalten und zeigt den Status in der App an.' },
                { num: 5, icon: 'üìã', title: 'Beurteilung durchf√ºhren', goal: 'Leistung fair und objektiv bewerten', items: ['In ‚ÄûTeam-√úbersicht" beim Mitarbeiter auf ‚ÄûReview" klicken', 'Teil B: Zielerreichung bewerten (WAS) ‚Äì Erreichungsgrad in %', 'Teil C: Kompetenzen bewerten (WIE) ‚Äì BARS-Skala 1-5', 'Selbstreflexion des MA erscheint links als Referenz', 'Regelm√§√üig als Entwurf speichern', 'Nach dem Feedbackgespr√§ch auf ‚Äû‚úì Abschlie√üen" klicken'], tip: 'Die Split-Screen Ansicht zeigt links die Selbstreflexion, rechts Ihr Formular. Abgeschlossene Bewertungen k√∂nnen jederzeit bearbeitet werden.' },
                { num: 6, icon: 'üéØ', title: 'Zielvereinbarung erstellen', goal: 'Klare Ziele f√ºr das Folgejahr', items: ['Bei Mitarbeiter auf ‚ÄûZiele" klicken', 'SMART-Ziele formulieren', 'Gewichtung festlegen (Summe = 100%)', 'Bonus-Relevanz markieren', 'Entwicklungsma√ünahmen hinzuf√ºgen'] },
                { num: 7, icon: '‚úÖ', title: 'Fortschritt verfolgen', goal: '√úberblick √ºber alle Aufgaben', items: ['Die Checkliste zeigt pro Mitarbeiter 3 Status-Badges:', '‚Ä¢ Selbstreflexion ‚Äì eingegangen oder ausstehend', '‚Ä¢ Beurteilung ‚Äì erstellt oder offen', '‚Ä¢ Zielvereinbarung ‚Äì vorhanden oder fehlt', 'Graue Badges = Aktion erforderlich (anklickbar)'] },
                { num: 8, icon: 'üìä', title: 'Team-Kalibrierung nutzen', goal: 'Verzerrungen vermeiden, Fairness sichern', items: ['Men√º: ‚ÄûTeam-Kalibrierung"', '9-Box Grid: Leistung (WAS) vs. Verhalten (WIE)', 'Heatmap: Kompetenz-St√§rken und -L√ºcken im Team', 'Killer Criteria: Warnung bei toxischem Verhalten', 'Peer-Learning: Mentoring-Vorschl√§ge'] }
              ],
              it: [
                { num: 1, icon: 'üîê', title: 'Accesso al sistema', goal: 'Ottenere accesso all\'app', items: ['Nel menu cliccare su ‚ÄûIl mio Team"', 'Se non registrato: selezionare ‚ÄûRegistrati"', 'Inserire email aziendale e password (min. 6 caratteri)', 'Per visite successive: usare ‚ÄûAccedi"'], tip: 'La registrazione avviene direttamente da ‚ÄûIl mio Team" ‚Äì nessun processo separato.' },
                { num: 2, icon: 'üë•', title: 'Creare il team', goal: 'Registrare i collaboratori', items: ['Dopo l\'accesso appare automaticamente ‚ÄûIl mio Team"', 'Compilare il modulo ‚ÄûAggiungi nuovo dipendente"', 'Nome e posizione sono obbligatori', 'Inserire email per invito automatico'], tip: 'Per ogni collaboratore viene creato automaticamente un link personale (accessCode)!' },
                { num: 3, icon: 'üìß', title: 'Invitare all\'autovalutazione', goal: 'Coinvolgere attivamente i collaboratori', items: ['Nella lista: pulsante email (‚úâÔ∏è) o link (üîó)', 'Con email: apre bozza email pronta', 'Senza email: link copiato negli appunti', 'Il collaboratore pu√≤ compilare SENZA registrazione'], email: 'Oggetto: Preparazione colloquio annuale ‚Äì Autovalutazione\n\nCiao [Nome],\n\nin preparazione al nostro colloquio annuale, ti chiedo di compilare la tua autovalutazione.\n\nIl tuo link personale (nessun login richiesto):\n[Link inserito automaticamente]\n\nTi prego di completarlo almeno una settimana prima.\n\nCordiali saluti' },
                { num: 4, icon: 'üìÖ', title: 'Fissare appuntamento (opzionale)', goal: 'Documentare il termine nel sistema', items: ['Cliccare ‚ÄûüìÖ Appuntamento" sul collaboratore', 'Inserire data e ora', 'File calendario (.ics) viene scaricato', 'Appuntamento appare come badge nella lista'], tip: 'üí° Questa √® una funzione di supporto ‚Äì l\'organizzazione vera e propria degli appuntamenti avviene come sempre tramite Outlook. Questa funzione aiuta solo a mantenere la panoramica e mostra lo stato nell\'app.' },
                { num: 5, icon: 'üìã', title: 'Eseguire valutazione', goal: 'Valutare in modo equo e oggettivo', items: ['In ‚ÄûIl mio Team" cliccare ‚ÄûReview" sul collaboratore', 'Parte B: Valutare raggiungimento obiettivi (COSA) ‚Äì % raggiungimento', 'Parte C: Valutare competenze (COME) ‚Äì Scala BARS 1-5', 'Autovalutazione del collaboratore appare a sinistra', 'Salvare regolarmente come bozza', 'Cliccare ‚Äû‚úì Completa" dopo il colloquio'], tip: 'La vista Split-Screen mostra l\'autovalutazione a sinistra, il tuo modulo a destra. Le valutazioni completate possono essere modificate.' },
                { num: 6, icon: 'üéØ', title: 'Creare accordo obiettivi', goal: 'Obiettivi chiari per l\'anno prossimo', items: ['Cliccare ‚ÄûObiettivi" sul collaboratore', 'Formulare obiettivi SMART', 'Definire peso (somma = 100%)', 'Indicare rilevanza bonus', 'Aggiungere misure di sviluppo'] },
                { num: 7, icon: '‚úÖ', title: 'Monitorare progressi', goal: 'Panoramica di tutte le attivit√†', items: ['La checklist mostra per collaboratore 3 badge:', '‚Ä¢ Autovalutazione ‚Äì ricevuta o in attesa', '‚Ä¢ Valutazione ‚Äì creata o aperta', '‚Ä¢ Accordo obiettivi ‚Äì presente o mancante', 'Badge grigi = Azione richiesta (cliccabili)'] },
                { num: 8, icon: 'üìä', title: 'Usare calibrazione team', goal: 'Evitare distorsioni, garantire equit√†', items: ['Menu: ‚ÄûCalibrazione Team"', '9-Box Grid: Prestazione (COSA) vs. Comportamento (COME)', 'Heatmap: Punti di forza e lacune nel team', 'Killer Criteria: Avviso per comportamenti tossici', 'Peer-Learning: Suggerimenti mentoring'] }
              ],
              en: [
                { num: 1, icon: 'üîê', title: 'System Login', goal: 'Get app access', items: ['Click ‚ÄûMy Team" in the menu', 'If not registered: select ‚ÄûRegister"', 'Enter company email and password (min. 6 chars)', 'For return visits: use ‚ÄûSign In"'], tip: 'Registration happens directly via ‚ÄûMy Team" ‚Äì no separate process needed.' },
                { num: 2, icon: 'üë•', title: 'Build Your Team', goal: 'Add your employees to the system', items: ['After login ‚ÄûMy Team" appears automatically', 'Fill out ‚ÄûAdd New Employee" form', 'Name and position are required', 'Enter email for automatic invitation'], tip: 'A personal access link (accessCode) is automatically created for each employee!' },
                { num: 3, icon: 'üìß', title: 'Invite for Self-Reflection', goal: 'Actively engage employees', items: ['In the list: email button (‚úâÔ∏è) or link button (üîó)', 'With email: opens ready-made email draft', 'Without email: link copied to clipboard', 'Employee can fill out WITHOUT registration'], email: 'Subject: Annual Review Preparation ‚Äì Self-Reflection\n\nHello [Name],\n\nIn preparation for our annual review, please complete your self-reflection digitally.\n\nYour personal link (no login required):\n[Link automatically inserted]\n\nPlease complete at least one week before our meeting.\n\nBest regards' },
                { num: 4, icon: 'üìÖ', title: 'Schedule Meeting (optional)', goal: 'Document appointment in system', items: ['Click ‚ÄûüìÖ Schedule" on employee', 'Enter date and time', 'Calendar file (.ics) downloads', 'Appointment appears as badge in list'], tip: 'üí° This is a support feature ‚Äì actual appointment organization happens as usual via Outlook. This feature just helps maintain overview and shows the status in the app.' },
                { num: 5, icon: 'üìã', title: 'Conduct Evaluation', goal: 'Assess fairly and objectively', items: ['In ‚ÄûMy Team" click ‚ÄûReview" on employee', 'Part B: Rate goal achievement (WHAT) ‚Äì % achieved', 'Part C: Rate competencies (HOW) ‚Äì BARS scale 1-5', 'Employee self-reflection appears on the left', 'Save regularly as draft', 'Click ‚Äû‚úì Complete" after the feedback meeting'], tip: 'Split-Screen view shows self-reflection on left, your form on right. Completed evaluations can be edited anytime.' },
                { num: 6, icon: 'üéØ', title: 'Create Goal Agreement', goal: 'Clear goals for the next year', items: ['Click ‚ÄûGoals" on employee', 'Formulate SMART goals', 'Set weights (sum = 100%)', 'Mark bonus relevance', 'Add development measures'] },
                { num: 7, icon: '‚úÖ', title: 'Track Progress', goal: 'Overview of all tasks', items: ['The checklist shows 3 status badges per employee:', '‚Ä¢ Self-reflection ‚Äì received or pending', '‚Ä¢ Review ‚Äì created or open', '‚Ä¢ Goal agreement ‚Äì exists or missing', 'Gray badges = Action required (clickable)'] },
                { num: 8, icon: 'üìä', title: 'Use Team Calibration', goal: 'Avoid bias, ensure fairness', items: ['Menu: ‚ÄûTeam Calibration"', '9-Box Grid: Performance (WHAT) vs. Behavior (HOW)', 'Heatmap: Competency strengths and gaps', 'Killer Criteria: Warning for toxic behavior', 'Peer-Learning: Mentoring suggestions'] }
              ]
            };
            const steps = guideSteps[lang] || guideSteps.de;
            const title = lang === 'de' ? 'Handlungsleitfaden f√ºr F√ºhrungskr√§fte' : lang === 'it' ? 'Guida per Manager' : 'Manager Guide';
            const subtitle = lang === 'de' ? 'Schritt-f√ºr-Schritt durch den Performance Review Prozess' : lang === 'it' ? 'Passo dopo passo nel processo di valutazione' : 'Step-by-step through the Performance Review process';
            
            const quickTips = {
              de: ['GPS 3.0 = Erwartungen erf√ºllt (Standardwert)', 'Konkrete Beispiele in Kommentaren nennen', 'Selbstreflexion VOR dem Gespr√§ch lesen', 'Bei GPS < 2.5: Entwicklungsplan erstellen'],
              it: ['GPS 3.0 = Aspettative soddisfatte (valore standard)', 'Citare esempi concreti nei commenti', 'Leggere autovalutazione PRIMA del colloquio', 'Per GPS < 2.5: Creare piano di sviluppo'],
              en: ['GPS 3.0 = Expectations met (standard value)', 'Cite concrete examples in comments', 'Read self-reflection BEFORE the meeting', 'For GPS < 2.5: Create development plan']
            };
            const tips = quickTips[lang] || quickTips.de;
            
            return React.createElement('div', { className: 'space-y-6 pb-12' },
              React.createElement('div', { className: 'rounded-2xl p-6 text-white', style: { background: 'linear-gradient(135deg, #243186 0%, #1a2563 100%)' } },
                React.createElement('h1', { className: 'text-2xl font-bold mb-2 flex items-center gap-3' }, React.createElement(BookOpen, { size: 28 }), title),
                React.createElement('p', { className: 'text-white/80' }, subtitle)
              ),
              React.createElement('div', { className: 'space-y-4' },
                steps.map(step => React.createElement('div', { key: step.num, className: 'bg-white rounded-xl p-5 shadow-sm border border-slate-200 relative overflow-hidden' },
                  React.createElement('div', { className: 'absolute top-0 left-0 w-1.5 h-full', style: { backgroundColor: '#6EBD84' } }),
                  React.createElement('div', { className: 'flex items-start gap-4 ml-2' },
                    React.createElement('div', { className: 'w-10 h-10 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0', style: { backgroundColor: '#243186' } }, step.num),
                    React.createElement('div', { className: 'flex-1' },
                      React.createElement('div', { className: 'flex items-center gap-2 mb-2' },
                        React.createElement('span', { className: 'text-xl' }, step.icon),
                        React.createElement('h3', { className: 'text-lg font-bold text-slate-800' }, step.title)
                      ),
                      React.createElement('p', { className: 'text-sm text-green-700 bg-green-50 px-3 py-1 rounded-full inline-block mb-3' }, 'üéØ ' + step.goal),
                      React.createElement('ul', { className: 'space-y-1 text-slate-600' },
                        step.items.map((item, i) => React.createElement('li', { key: i, className: 'flex items-start gap-2' },
                          React.createElement('span', { className: 'text-[#6EBD84] mt-1' }, '‚ñ∏'), item
                        ))
                      ),
                      step.tip && React.createElement('div', { className: 'mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800' }, 'üí° ' + step.tip),
                      step.email && React.createElement('div', { className: 'mt-3 p-3 bg-slate-50 border-l-4 border-[#243186] rounded text-sm' },
                        React.createElement('p', { className: 'font-bold text-[#243186] mb-1' }, 'üìß ' + (lang === 'de' ? 'E-Mail Vorlage:' : lang === 'it' ? 'Modello email:' : 'Email template:')),
                        React.createElement('pre', { className: 'text-slate-600 whitespace-pre-wrap font-sans' }, step.email)
                      ),
                      step.warning && React.createElement('div', { className: 'mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800 flex items-start gap-2' },
                        React.createElement(AlertCircle, { size: 16, className: 'flex-shrink-0 mt-0.5' }), step.warning
                      )
                    )
                  )
                ))
              ),
              React.createElement('div', { className: 'bg-gradient-to-r from-[#6EBD84] to-[#4D9360] rounded-xl p-5 text-white' },
                React.createElement('h3', { className: 'font-bold mb-3' }, 'üí° Quick Tips'),
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-2' },
                  tips.map((tip, i) =>
                    React.createElement('div', { key: i, className: 'flex items-center gap-2 bg-white/20 rounded px-3 py-2 text-sm' },
                      React.createElement(CheckCircle2, { size: 14 }), tip
                    )
                  )
                )
              )
            );
          };

          const renderCompetencyList = () => {
            if (!data || !data.competencies) return null;
            
            const core = data.competencies.filter(c => c.category === 'core');
            const lead = data.competencies.filter(c => c.category === 'leadership');

            return React.createElement('div', { className: "space-y-8 pb-10" },
              // BARS Explanation Box
              React.createElement('div', { className: "bg-[#243186] rounded-xl p-6 shadow-lg mb-6" },
                React.createElement('h2', { className: "text-2xl font-bold text-white mb-4 flex items-center gap-3" },
                  React.createElement(BookOpen, { size: 28, style: { color: "#6EBD84" } }),
                  lang === 'de' ? 'Bewertung anhand von Verhaltensankern (BARS)' : 'Valutazione tramite ancore comportamentali (BARS)'
                ),
                React.createElement('div', { className: "space-y-4 text-white" },
                  React.createElement('p', { className: "text-lg leading-relaxed" },
                    lang === 'de' 
                      ? 'F√ºr jede Kompetenz wird ein Score von 1 bis 5 vergeben.'
                      : 'Per ogni competenza viene assegnato un punteggio da 1 a 5.'
                  ),
                  React.createElement('p', { className: "text-lg leading-relaxed" },
                    lang === 'de'
                      ? 'Basis ist nicht das "Bauchgef√ºhl", sondern der Vergleich des beobachteten Verhaltens mit den definierten Ankern.'
                      : 'La base non √® l\'intuizione, ma il confronto del comportamento osservato con gli ancore definiti.'
                  ),
                  React.createElement('div', { className: "bg-white/10 rounded-lg p-5 border-l-4", style: { borderColor: "#6EBD84" } },
                    React.createElement('div', { className: "flex items-start gap-3 mb-3" },
                      React.createElement(Lightbulb, { size: 24, style: { color: "#6EBD84" }, className: "flex-shrink-0 mt-1" }),
                      React.createElement('p', { className: "text-lg font-semibold", style: { color: "#6EBD84" } },
                        lang === 'de' 
                          ? 'Die Vorgehensweise f√ºr F√ºhrungskr√§fte:'
                          : 'La procedura per i manager:'
                      )
                    ),
                    React.createElement('p', { className: "text-white italic text-base leading-relaxed pl-9" },
                      lang === 'de'
                        ? 'Lese die Verhaltensanker im Handlungsleitfaden. Frage dich: "Welche Beschreibung passt am besten zu dem Verhalten, das ich dieses Jahr beobachtet habe?"'
                        : 'Leggi gli ancore comportamentali nella guida operativa. Chiediti: "Quale descrizione si adatta meglio al comportamento che ho osservato quest\'anno?"'
                    )
                  )
                )
              ),
              
              React.createElement('div', null,
                React.createElement('h3', { className: "text-lg font-bold text-slate-700 mb-4 flex items-center gap-2" },
                  React.createElement(Users, { size: 20 }), " ", t.coreComp
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 lg:grid-cols-3 gap-4" },
                  core.map(c => (
                    React.createElement('div', {
                      key: c.id,
                      onClick: () => navigateToCompetency(c.id),
                      className: "group bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-[#BAE1CE] cursor-pointer transition-all"
                    },
                      React.createElement('div', { className: "flex justify-between items-start mb-3" },
                        React.createElement('div', { className: "p-2 bg-[#F4FAF7] rounded-lg text-[#6EBD84] group-hover:bg-[#6EBD84] group-hover:text-white transition-colors" }, React.createElement(c.icon, { size: 24 })),
                        React.createElement(ChevronRight, { size: 20, className: "text-slate-300 group-hover:text-[#6EBD84]" })
                      ),
                      React.createElement('h4', { className: "font-bold text-slate-800" }, c.title)
                    )
                  ))
                )
              ),
              React.createElement('div', null,
                React.createElement('h3', { className: "text-lg font-bold text-slate-700 mb-4 flex items-center gap-2" },
                  React.createElement(Briefcase, { size: 20 }), " ", t.leadComp
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 lg:grid-cols-3 gap-4" },
                  lead.map(c => (
                    React.createElement('div', {
                      key: c.id,
                      onClick: () => navigateToCompetency(c.id),
                      className: "group bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-[#BAE1CE] cursor-pointer transition-all"
                    },
                      React.createElement('div', { className: "flex justify-between items-start mb-3" },
                        React.createElement('div', { className: "p-2 bg-[#F4FAF7] rounded-lg text-[#6EBD84] group-hover:bg-[#6EBD84] group-hover:text-white transition-colors" }, React.createElement(c.icon, { size: 24 })),
                        React.createElement(ChevronRight, { size: 20, className: "text-slate-300 group-hover:text-[#6EBD84]" })
                      ),
                      React.createElement('h4', { className: "font-bold text-slate-800" }, c.title)
                    )
                  ))
                )
              )
            );
          };

          const renderDetailView = () => {
            const compData = getActiveCompetencyData();
            if (!compData) return null;
            const currentLevel = compData.levels[activeScore];

            return React.createElement('div', { className: "animate-in slide-in-from-right duration-300 pb-12" },
              React.createElement('button', {
                onClick: () => setActiveView('list'),
                className: "text-sm text-slate-500 hover:text-[#6EBD84] flex items-center gap-1 mb-4"
              }, t.back),
              React.createElement('div', { className: "bg-white rounded-xl shadow-lg overflow-hidden border border-slate-200" },
                React.createElement('div', { className: "p-6 md:p-8 bg-slate-50 border-b border-slate-100" },
                  React.createElement('div', { className: "flex items-center gap-4 mb-4" },
                    React.createElement('div', { className: `p-3 rounded-xl ${compData.category === 'core' ? 'bg-[#6EBD84]' : 'bg-[#6EBD84]'} text-white` }, React.createElement(compData.icon, { size: 32 })),
                    React.createElement('div', null,
                      React.createElement('h2', { className: "text-2xl font-bold text-slate-800" }, compData.title),
                      React.createElement('span', { className: "text-xs uppercase tracking-wider font-semibold text-slate-500" }, compData.category === 'core' ? 'Core' : 'Leadership')
                    )
                  ),
                  React.createElement('p', { className: "text-slate-600 leading-relaxed" }, compData.definition)
                ),
                React.createElement('div', { className: "p-6 md:p-8" },
                  React.createElement('div', { className: "flex flex-col items-center mb-8" },
                    React.createElement('span', { className: "text-sm font-semibold text-slate-400 mb-4 uppercase tracking-widest" }, t.selectScore),
                    React.createElement('div', { className: "flex gap-3 md:gap-6" },
                      [1, 2, 3, 4, 5].map(s => React.createElement(ScoreBadge, { key: s, score: s, active: activeScore === s }))
                    )
                  ),
                  React.createElement('div', { className: "bg-slate-50 rounded-2xl p-6 md:p-8 border border-slate-200 relative overflow-hidden transition-all" },
                    React.createElement('div', { className: `absolute top-0 left-0 w-2 h-full ${activeScore === 1 ? 'bg-red-500' : activeScore === 2 ? 'bg-orange-400' : activeScore === 3 ? 'bg-green-500' : activeScore === 4 ? 'bg-blue-500' : 'bg-[#6EBD84]'}` }),
                    React.createElement('div', { className: "mb-6" },
                      React.createElement('h3', { className: "text-lg font-bold text-slate-800 mb-2 flex items-center gap-2" },
                        activeScore === 3 ? React.createElement(CheckCircle2, { className: "text-green-600", size: 20 }) :
                        activeScore === 5 ? React.createElement(Award, { className: "text-[#6EBD84]", size: 20 }) :
                        activeScore === 1 ? React.createElement(ShieldAlert, { className: "text-red-500", size: 20 }) : React.createElement(BookOpen, { className: "text-slate-400", size: 20 }),
                        activeScore === 1 ? t.level1 :
                        activeScore === 2 ? t.level2 :
                        activeScore === 3 ? t.level3 :
                        activeScore === 4 ? t.level4 : t.level5
                      ),
                      React.createElement('p', { className: "text-slate-700 text-lg leading-relaxed whitespace-pre-line" }, currentLevel.text)
                    ),
                    React.createElement('div', { className: "bg-white rounded-xl p-5 border-l-4 border-l-slate-300 shadow-sm" },
                      React.createElement('h4', { className: "text-sm font-bold text-slate-400 uppercase mb-2 flex items-center gap-2" },
                        React.createElement(Lightbulb, { size: 16 }), " ", t.example
                      ),
                      React.createElement('p', { className: "text-slate-600 italic font-medium" }, `"${currentLevel.example}"`)
                    )
                  )
                )
              )
            );
          };

          // === GPS EXPLAINER RENDER FUNCTION ===
          const renderGPSExplainer = () => {
            return React.createElement('div', { className: "pb-12 space-y-8" },
              // Header
              React.createElement('div', { className: "mb-4" },
                React.createElement('h1', { className: "text-3xl font-bold text-slate-800 mb-2" }, t.gpsExplainerTitle),
                React.createElement('p', { className: "text-slate-600 text-lg" }, t.gpsExplainerSubtitle)
              ),
              
              // OPTIMIERUNG 1: HERO-SEKTION MIT VISUELLER FORMEL
              React.createElement('div', { 
                className: "text-white py-10 px-6 md:px-8 rounded-3xl mb-8 shadow-2xl",
                style: { background: "linear-gradient(135deg, #243186 0%, #1a2460 100%)" }
              },
                React.createElement('h2', { className: "text-2xl md:text-3xl font-bold text-center mb-8" }, 
                  lang === 'de' ? 'Die GPS-Formel' : 'La Formula GPS'
                ),
                
                // Formel-Visualisierung - verbessert f√ºr bessere Darstellung
                React.createElement('div', { className: "flex items-center justify-center gap-3 md:gap-5 flex-wrap" },
                  // WAS Box
                  React.createElement('div', { 
                    className: "bg-white/10 backdrop-blur rounded-xl p-5 md:p-6 w-[140px] md:w-[180px] border border-white/20"
                  },
                    React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-2 text-center" }, "50%"),
                    React.createElement('div', { className: "text-lg md:text-xl font-semibold mb-1 text-center", style: { color: "#6EBD84" } }, 
                      lang === 'de' ? 'WAS' : 'COSA'
                    ),
                    React.createElement('div', { className: "text-xs opacity-80 text-center" }, 
                      lang === 'de' ? 'Ziele & KPIs' : 'Obiettivi & KPI'
                    )
                  ),
                  
                  // Plus Symbol
                  React.createElement('div', { className: "text-3xl md:text-4xl font-bold opacity-70" }, "+"),
                  
                  // WIE Box
                  React.createElement('div', { 
                    className: "bg-white/10 backdrop-blur rounded-xl p-5 md:p-6 w-[140px] md:w-[180px] border border-white/20"
                  },
                    React.createElement('div', { className: "text-3xl md:text-4xl font-bold mb-2 text-center" }, "50%"),
                    React.createElement('div', { className: "text-lg md:text-xl font-semibold mb-1 text-center", style: { color: "#6EBD84" } }, 
                      lang === 'de' ? 'WIE' : 'COME'
                    ),
                    React.createElement('div', { className: "text-xs opacity-80 text-center" }, 
                      lang === 'de' ? 'Kompetenzen' : 'Competenze'
                    )
                  ),
                  
                  // Equals Symbol
                  React.createElement('div', { className: "text-3xl md:text-4xl font-bold opacity-70" }, "="),
                  
                  // GPS Box - jetzt als wei√üer Kasten mit gr√ºnem Text
                  React.createElement('div', { 
                    className: "bg-white rounded-xl p-5 md:p-6 w-[140px] md:w-[180px] shadow-lg"
                  },
                    React.createElement('div', { className: "text-lg md:text-xl font-bold mb-1 text-center", style: { color: "#243186" } }, "GPS"),
                    React.createElement('div', { className: "text-2xl md:text-3xl font-bold mb-1 text-center", style: { color: "#6EBD84" } }, "1.0‚Äì5.0"),
                    React.createElement('div', { className: "text-xs text-center text-slate-600" }, "Performance Score")
                  )
                ),
                
                // Hinweis-Badge - dezenter
                React.createElement('div', { className: "mt-6 text-center" },
                  React.createElement('div', { className: "inline-flex items-center gap-2 bg-white/10 px-4 py-2 rounded-full text-sm" },
                    React.createElement(Info, { size: 16, style: { color: "#6EBD84" } }),
                    React.createElement('span', { className: "opacity-90" }, 
                      lang === 'de' ? 'Beide Dimensionen z√§hlen gleich viel!' : 'Entrambe le dimensioni contano allo stesso modo!'
                    )
                  )
                ),
                
                // Manager/Mitarbeiter Unterscheidung - kompakter
                React.createElement('div', { className: "mt-4 flex justify-center gap-3 flex-wrap text-xs" },
                  React.createElement('div', { className: "bg-white/10 rounded-lg px-3 py-1.5" },
                    React.createElement('span', { className: "opacity-70" }, lang === 'de' ? 'MA: ' : 'Coll: '),
                    React.createElement('span', null, '50% + 50%')
                  ),
                  React.createElement('div', { className: "bg-white/10 rounded-lg px-3 py-1.5" },
                    React.createElement('span', { className: "opacity-70" }, lang === 'de' ? 'FK: ' : 'Dir: '),
                    React.createElement('span', null, '50% + 25% + 25%')
                  )
                )
              ),

              // WAS & WIE Cards - Visuell optimiert
              React.createElement('div', { className: "grid md:grid-cols-2 gap-6 mb-8" },
                
                // WAS Card
                React.createElement('div', { 
                  className: "text-white rounded-2xl p-6 md:p-8 shadow-xl transform hover:scale-[1.02] transition-all duration-300",
                  style: { background: "linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)" }
                },
                  React.createElement('div', { className: "flex items-center gap-4 mb-6" },
                    React.createElement('div', { className: "bg-white/20 rounded-full p-4" },
                      React.createElement(Target, { size: 32 })
                    ),
                    React.createElement('div', null,
                      React.createElement('div', { className: "text-3xl font-bold" }, "50%"),
                      React.createElement('div', { className: "text-lg font-semibold" }, t.wasExplainTitle)
                    )
                  ),
                  
                  React.createElement('div', { className: "space-y-4" },
                    React.createElement('p', { className: "text-white/90 leading-relaxed" }, t.wasExplainText),
                    
                    React.createElement('div', { className: "bg-white/10 rounded-lg p-4 backdrop-blur" },
                      React.createElement('div', { className: "text-xs font-semibold mb-2 opacity-75" }, 
                        lang === 'de' ? 'BEISPIEL:' : 'ESEMPIO:'
                      ),
                      React.createElement('div', { className: "text-sm" }, t.wasExplainExample)
                    ),
                    
                    React.createElement('div', { className: "flex items-center gap-2 text-sm font-semibold bg-white/20 rounded-lg px-4 py-2 w-fit" },
                      React.createElement(CheckCircle2, { size: 18 }),
                      lang === 'de' ? 'Objektiv messbar' : 'Oggettivamente misurabile'
                    )
                  )
                ),
                
                // WIE Card
                React.createElement('div', { 
                  className: "text-white rounded-2xl p-6 md:p-8 shadow-xl transform hover:scale-[1.02] transition-all duration-300",
                  style: { background: "linear-gradient(135deg, #6EBD84 0%, #3E7D4E 100%)" }
                },
                  React.createElement('div', { className: "flex items-center gap-4 mb-6" },
                    React.createElement('div', { className: "bg-white/20 rounded-full p-4" },
                      React.createElement(Brain, { size: 32 })
                    ),
                    React.createElement('div', null,
                      React.createElement('div', { className: "text-3xl font-bold" }, "50%"),
                      React.createElement('div', { className: "text-lg font-semibold" }, t.wieExplainTitle)
                    )
                  ),
                  
                  React.createElement('div', { className: "space-y-4" },
                    React.createElement('p', { className: "text-white/90 leading-relaxed" }, t.wieExplainText),
                    
                    // Gewichtung Pills
                    React.createElement('div', { className: "flex flex-wrap gap-2" },
                      React.createElement('div', { className: "bg-white/20 rounded-full px-4 py-2 text-sm font-semibold backdrop-blur" },
                        t.wieCoreExplainWeight
                      ),
                      React.createElement('div', { className: "bg-white/20 rounded-full px-4 py-2 text-sm font-semibold backdrop-blur" },
                        t.wieLeadExplainWeight
                      )
                    ),
                    
                    React.createElement('div', { className: "flex items-center gap-2 text-sm font-semibold bg-white/20 rounded-lg px-4 py-2 w-fit" },
                      React.createElement(ClipboardList, { size: 18 }),
                      lang === 'de' ? 'BARS-Methodik' : 'Metodologia BARS'
                    )
                  )
                )
              ),

              // Kompetenzen-√úbersicht (kompakt)
              React.createElement('div', { className: "bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 p-6" },
                React.createElement('h3', { className: "text-xl font-bold text-slate-800 mb-4 flex items-center gap-2" },
                  React.createElement(Users, { size: 24, style: { color: "#6EBD84" } }),
                  lang === 'de' ? 'Bewertete Kompetenzen' : 'Competenze valutate'
                ),
                React.createElement('div', { className: "grid md:grid-cols-2 gap-4" },
                  // Kern-Kompetenzen
                  React.createElement('div', { className: "bg-purple-50 rounded-lg p-4 border border-purple-200" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-3" },
                      React.createElement('div', { className: "bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm" }, "5"),
                      React.createElement('span', { className: "font-bold text-purple-900" }, 
                        lang === 'de' ? 'Kern-Kompetenzen' : 'Competenze Core'
                      )
                    ),
                    React.createElement('div', { className: "text-sm text-slate-700 space-y-1" },
                      (lang === 'de' 
                        ? ['Fachkompetenz', 'Kommunikation', 'Probleml√∂sung', 'Anpassungsf√§higkeit', 'Selbstorganisation']
                        : ['Competenza tecnica', 'Comunicazione', 'Problem solving', 'Adattabilit√†', 'Auto-organizzazione']
                      ).map((comp, idx) => 
                        React.createElement('div', { key: idx, className: "flex items-center gap-2" },
                          React.createElement('span', { className: "text-purple-500" }, "‚Ä¢"),
                          comp
                        )
                      )
                    )
                  ),
                  // Leadership-Kompetenzen
                  React.createElement('div', { className: "bg-indigo-50 rounded-lg p-4 border border-indigo-200" },
                    React.createElement('div', { className: "flex items-center gap-2 mb-3" },
                      React.createElement('div', { className: "bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm" }, "5"),
                      React.createElement('span', { className: "font-bold text-indigo-900" }, 
                        lang === 'de' ? 'Leadership-Kompetenzen' : 'Competenze Leadership'
                      ),
                      React.createElement('span', { className: "text-xs text-indigo-600 ml-2" }, 
                        lang === 'de' ? '(nur FK)' : '(solo dirigenti)'
                      )
                    ),
                    React.createElement('div', { className: "text-sm text-slate-700 space-y-1" },
                      (lang === 'de' 
                        ? ['Mitarbeiterf√ºhrung', 'Strategisches Denken', 'Entscheidungsf√§higkeit', 'Execution', 'Stakeholder-Mgmt']
                        : ['Gestione personale', 'Pensiero strategico', 'Capacit√† decisionale', 'Execution', 'Gestione stakeholder']
                      ).map((comp, idx) => 
                        React.createElement('div', { key: idx, className: "flex items-center gap-2" },
                          React.createElement('span', { className: "text-indigo-500" }, "‚Ä¢"),
                          comp
                        )
                      )
                    )
                  )
                )
              ),

              // BARS Conversion Table
              React.createElement('div', { className: "bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 overflow-hidden" },
                React.createElement('div', { className: "p-6 border-b border-slate-200", style: { backgroundColor: "#243186" } },
                  React.createElement('h3', { className: "text-2xl font-bold text-white flex items-center gap-3" },
                    React.createElement(Scale, { className: "w-7 h-7", style: { color: "#6EBD84" } }),
                    t.barsConversionTitle
                  ),
                  React.createElement('p', { className: "mt-2", style: { color: "#6EBD84" } }, t.barsConversionDesc)
                ),
                React.createElement('div', { className: "overflow-x-auto" },
                  React.createElement('table', { className: "w-full" },
                    React.createElement('thead', { className: "bg-slate-50" },
                      React.createElement('tr', null,
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          lang === 'de' ? 'Zielerreichung %' : 'Raggiungimento %'
                        ),
                        React.createElement('th', { className: "px-6 py-3 text-center text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          "BARS-Stufe"
                        ),
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          lang === 'de' ? 'Beschreibung' : 'Descrizione'
                        )
                      )
                    ),
                    React.createElement('tbody', { className: "bg-white divide-y divide-slate-200" },
                      BARS_RANGES.map((range, idx) => React.createElement('tr', { key: idx, className: "hover:bg-slate-50" },
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900" }, 
                          lang === 'de' ? range.label : 
                            (range.score === 5 ? 'Eccezionale (>130%)' :
                             range.score === 4 ? 'Superato (111-130%)' :
                             range.score === 3 ? 'Baseline (90-110%)' :
                             range.score === 2 ? 'Parziale (70-89%)' : 'Non raggiunto (<70%)')
                        ),
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-center" },
                          React.createElement('span', { 
                            className: `inline-flex items-center justify-center w-10 h-10 rounded-full text-white font-bold ${
                              range.score === 5 ? 'bg-green-600' :
                              range.score === 4 ? 'bg-emerald-500' :
                              range.score === 3 ? 'bg-blue-600' :
                              range.score === 2 ? 'bg-orange-500' : 'bg-red-600'
                            }`
                          }, range.score)
                        ),
                        React.createElement('td', { className: "px-6 py-4 text-sm text-slate-700" }, 
                          lang === 'de' ? 
                            (range.score === 5 ? 'Ziel herausragend √ºbertroffen' :
                             range.score === 4 ? 'Ziel √ºbertroffen' :
                             range.score === 3 ? 'Ziel vollst√§ndig erreicht (Baseline)' :
                             range.score === 2 ? 'Ziel teilweise erreicht' : 'Ziel nicht erreicht') :
                            (range.score === 5 ? 'Obiettivo superato eccezionalmente' :
                             range.score === 4 ? 'Obiettivo superato' :
                             range.score === 3 ? 'Obiettivo completamente raggiunto (Baseline)' :
                             range.score === 2 ? 'Obiettivo parzialmente raggiunto' : 'Obiettivo non raggiunto')
                        )
                      ))
                    )
                  )
                )
              ),

              // Performance Rating Table
              React.createElement('div', { className: "bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 overflow-hidden" },
                React.createElement('div', { className: "p-6 border-b border-slate-200", style: { backgroundColor: "#243186" } },
                  React.createElement('h3', { className: "text-2xl font-bold text-white flex items-center gap-3" },
                    React.createElement(Award, { className: "w-7 h-7", style: { color: "#6EBD84" } }),
                    t.performanceRatingTitle
                  ),
                  React.createElement('p', { className: "mt-2", style: { color: "#6EBD84" } }, t.performanceRatingDesc)
                ),
                React.createElement('div', { className: "overflow-x-auto" },
                  React.createElement('table', { className: "w-full" },
                    React.createElement('thead', { className: "bg-slate-50" },
                      React.createElement('tr', null,
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          "GPS Range"
                        ),
                        React.createElement('th', { className: "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider" }, 
                          "Rating"
                        )
                      )
                    ),
                    React.createElement('tbody', { className: "bg-white divide-y divide-slate-200" },
                      RATINGS.map((rating, idx) => React.createElement('tr', { key: idx, className: "hover:bg-slate-50" },
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-bold text-slate-900" }, 
                          `${rating.min.toFixed(2)} - ${rating.max.toFixed(2)}`
                        ),
                        React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" },
                          React.createElement('span', { className: `px-3 py-1 rounded-full text-white text-sm font-bold ${rating.color}` }, 
                            rating.label
                          )
                        )
                      ))
                    )
                  )
                )
              ),

              // Calculation Example
              React.createElement('div', { className: "bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 p-6" },
                React.createElement('h3', { className: "text-2xl font-bold text-slate-800 mb-4 flex items-center gap-3" },
                  React.createElement(Calculator, { className: "w-7 h-7 text-slate-600" }),
                  t.calculationExampleTitle
                ),
                React.createElement('div', { className: "bg-slate-50 rounded-lg p-6 space-y-4" },
                  React.createElement('p', { className: "font-semibold text-slate-700" }, t.calculationExampleIntro),
                  React.createElement('ul', { className: "space-y-2 ml-4" },
                    React.createElement('li', { className: "text-slate-700" }, `‚Ä¢ ${t.calculationStep1}`),
                    React.createElement('li', { className: "text-slate-700" }, `‚Ä¢ ${t.calculationStep2}`),
                    React.createElement('li', { className: "text-slate-700" }, `‚Ä¢ ${t.calculationStep3}`)
                  ),
                  React.createElement('div', { className: "border-t border-slate-300 pt-4 mt-4" },
                    React.createElement('p', { className: "font-semibold text-slate-700 mb-2" }, t.calculationFormula),
                    React.createElement('p', { className: "font-mono text-lg text-slate-800 bg-white p-4 rounded border border-slate-200" }, 
                      "(4,0 √ó 0,5) + (3,2 √ó 0,25) + (4,0 √ó 0,25) = 3,8"
                    )
                  ),
                  React.createElement('div', { className: "bg-green-50 border-l-4 border-green-500 p-4 rounded" },
                    React.createElement('p', { className: "font-bold text-green-900" }, t.calculationResult)
                  )
                )
              ),

              // Why GPS Section
              React.createElement('div', { className: "rounded-xl shadow-lg p-8", style: { backgroundColor: "#243186" } },
                React.createElement('h3', { className: "text-2xl font-bold text-white mb-6 flex items-center gap-3" },
                  React.createElement(Lightbulb, { className: "w-7 h-7", style: { color: "#6EBD84" } }),
                  t.whyGPSTitle
                ),
                React.createElement('div', { className: "grid md:grid-cols-3 gap-6" },
                  React.createElement('div', { className: "bg-white bg-opacity-10 rounded-lg p-6" },
                    React.createElement('div', { className: "w-12 h-12 rounded-full flex items-center justify-center mb-4", style: { backgroundColor: "#6EBD84" } },
                      React.createElement(Scale, { className: "w-6 h-6 text-white" })
                    ),
                    React.createElement('h4', { className: "text-lg font-bold text-white mb-2" }, t.whyGPS1Title),
                    React.createElement('p', { className: "text-slate-300 text-sm" }, t.whyGPS1Text)
                  ),
                  React.createElement('div', { className: "bg-white bg-opacity-10 rounded-lg p-6" },
                    React.createElement('div', { className: "w-12 h-12 rounded-full flex items-center justify-center mb-4", style: { backgroundColor: "#6EBD84" } },
                      React.createElement(Target, { className: "w-6 h-6 text-white" })
                    ),
                    React.createElement('h4', { className: "text-lg font-bold text-white mb-2" }, t.whyGPS2Title),
                    React.createElement('p', { className: "text-slate-300 text-sm" }, t.whyGPS2Text)
                  ),
                  React.createElement('div', { className: "bg-white bg-opacity-10 rounded-lg p-6" },
                    React.createElement('div', { className: "w-12 h-12 rounded-full flex items-center justify-center mb-4", style: { backgroundColor: "#6EBD84" } },
                      React.createElement(TrendingUp, { className: "w-6 h-6 text-white" })
                    ),
                    React.createElement('h4', { className: "text-lg font-bold text-white mb-2" }, t.whyGPS3Title),
                    React.createElement('p', { className: "text-slate-300 text-sm" }, t.whyGPS3Text)
                  )
                )
              )
            );
          };

          // === MEINE SELBSTREFLEXION KOMPONENTE (1:1 identisch mit AppraisalForm) ===
          // === MEINE SELBSTREFLEXION KOMPONENTE (VOLLST√ÑNDIG wie AppraisalForm) ===
          const MySelfReflectionComponent = ({ lang, user, guestEmployee, isGuestMode, onComplete }) => {
            const e = React.createElement;
            const t = FORM_TEXT[lang] || FORM_TEXT['de'];
            const defs = DEFAULTS[lang] || DEFAULTS['de'];
            
            // === STATES (VOLLST√ÑNDIG wie AppraisalForm) ===
            const [isManager, setIsManager] = React.useState(false);
            const [isGenerating, setIsGenerating] = React.useState(false);
            const [firestoreDocId, setFirestoreDocId] = React.useState(null);
            const [loadingFirestore, setLoadingFirestore] = React.useState(true);
            
            // === SHARE-LINK STATES ===
            const [showShareModal, setShowShareModal] = React.useState(false);
            const [shareLink, setShareLink] = React.useState('');
            const [linkCopied, setLinkCopied] = React.useState(false);
            const [managerEmail, setManagerEmail] = React.useState('');
            
            // Initialisiere formData mit guestEmployee-Daten im Guest-Modus
            const [formData, setFormData] = React.useState({
              employee: isGuestMode && guestEmployee ? guestEmployee.name : '', 
              position: isGuestMode && guestEmployee ? (guestEmployee.position || '') : '', 
              manager: '', 
              date: new Date().toISOString().split('T')[0],
              strengths1: '', strengths2: '', careerComment: '',
              feedbackQ1: '', feedbackQ2: '', feedbackQ3: '', feedbackQ4: '', feedbackQ5: '', feedbackQ6: '', feedbackQ7: 3,
              plannedBonus: '',
              managerEmail: '' // NEU: E-Mail der F√ºhrungskraft f√ºr Vorhalten
            });
            
            const [careerChecks, setCareerChecks] = React.useState([false, false, false, false, false]);
            
            // Im Guest-Modus: Option "Keine Ziele" - starte mit leeren Zielen
            const [goals, setGoals] = React.useState([
              { id: 101, name: '', weight: 60, achievement: 0 },
              { id: 102, name: '', weight: 40, achievement: 0 }
            ]);
            
            // State f√ºr "Keine Ziele vorhanden" Checkbox
            const [noGoalsMode, setNoGoalsMode] = React.useState(false);
            
            const [devPlan, setDevPlan] = React.useState([
              { id: 201, measure: '', responsible: '', deadline: '' }
            ]);
            
            const [coreList, setCoreList] = React.useState(defs.core.map(c => ({ ...c, rating: 3, comment: '' })));
            const [leadList, setLeadList] = React.useState(defs.lead.map(c => ({ ...c, rating: 3, comment: '' })));
            
            // UI States
            const [isSaving, setIsSaving] = React.useState(false);
            const [saveStatus, setSaveStatus] = React.useState(null);
            
            // Draft-ID: Im Guest-Modus basierend auf guestEmployee.id
            const draftId = isGuestMode && guestEmployee 
              ? `guest_self_${guestEmployee.id}_${new Date().getFullYear()}`
              : `my_self_${user?.uid}_${new Date().getFullYear()}`;
            const currentYear = new Date().getFullYear();
            const period = `${currentYear}`;
            
            // Handler f√ºr "Keine Ziele" Toggle
            const handleNoGoalsToggle = (checked) => {
              setNoGoalsMode(checked);
              if (checked) {
                // Alle Ziele entfernen
                setGoals([]);
              } else {
                // Standard-Ziele wiederherstellen
                setGoals([
                  { id: 101, name: '', weight: 60, achievement: 0 },
                  { id: 102, name: '', weight: 40, achievement: 0 }
                ]);
              }
            };
            
            // === LADE AUS FIRESTORE (beim Start) ===
            React.useEffect(() => {
              const loadFromFirestore = async () => {
                // Im Guest-Modus: Andere Logik f√ºr Laden
                if (isGuestMode && guestEmployee) {
                  // Pr√ºfe ob bereits eine Selbstreflexion f√ºr diesen Mitarbeiter existiert
                  try {
                    const snapshot = await db.collection('teamAppraisals')
                      .where('employeeId', '==', guestEmployee.id)
                      .where('type', 'in', ['self_assessment', 'self'])
                      .where('period', '==', period)
                      .limit(1)
                      .get();
                    
                    if (!snapshot.empty) {
                      const doc = snapshot.docs[0];
                      const data = doc.data();
                      console.log('‚úÖ Existierende Gast-Selbstreflexion gefunden:', doc.id);
                      setFirestoreDocId(doc.id);
                      
                      // Daten laden
                      if (data.formData) setFormData(prev => ({ ...prev, ...data.formData }));
                      if (data.goals && data.goals.length > 0) {
                        setGoals(data.goals);
                        setNoGoalsMode(false);
                      } else {
                        setNoGoalsMode(true);
                        setGoals([]);
                      }
                      if (data.coreList) setCoreList(data.coreList);
                      if (data.leadList) setLeadList(data.leadList);
                      if (data.devPlan) setDevPlan(data.devPlan);
                      if (data.careerChecks) setCareerChecks(data.careerChecks);
                      if (data.isManager !== undefined) setIsManager(data.isManager);
                    }
                  } catch (err) {
                    console.error('Fehler beim Laden der Gast-Selbstreflexion:', err);
                  }
                  setLoadingFirestore(false);
                  return;
                }
                
                // Normaler Modus (eingeloggter User)
                if (!user?.uid || !db) {
                  setLoadingFirestore(false);
                  return;
                }
                
                try {
                  console.log('üîç Suche Selbstreflexion in Firestore f√ºr User:', user.uid);
                  
                  // Suche existierende Selbstreflexion f√ºr dieses Jahr
                  const snapshot = await db.collection('teamAppraisals')
                    .where('createdByUid', '==', user.uid)
                    .where('type', '==', 'self')
                    .where('period', '==', period)
                    .limit(1)
                    .get();
                  
                  if (!snapshot.empty) {
                    const doc = snapshot.docs[0];
                    const data = doc.data();
                    console.log('‚úÖ Selbstreflexion aus Firestore geladen:', doc.id);
                    
                    setFirestoreDocId(doc.id);
                    
                    // Daten in States laden
                    if (data.formData) setFormData(prev => ({ ...prev, ...data.formData }));
                    if (data.goals) setGoals(data.goals);
                    if (data.coreList) setCoreList(data.coreList);
                    if (data.leadList) setLeadList(data.leadList);
                    if (data.devPlan) setDevPlan(data.devPlan);
                    if (data.careerChecks) setCareerChecks(data.careerChecks);
                    if (data.isManager !== undefined) setIsManager(data.isManager);
                  } else {
                    console.log('üìù Keine existierende Selbstreflexion gefunden, lade lokalen Draft...');
                    // Fallback: Lokalen Draft laden
                    const draft = DraftManager.loadDraft(draftId);
                    if (draft) {
                      if (draft.formData) setFormData(prev => ({ ...prev, ...draft.formData }));
                      if (draft.goals) setGoals(draft.goals);
                      if (draft.coreList) setCoreList(draft.coreList);
                      if (draft.leadList) setLeadList(draft.leadList);
                      if (draft.devPlan) setDevPlan(draft.devPlan);
                      if (draft.careerChecks) setCareerChecks(draft.careerChecks);
                      if (draft.isManager !== undefined) setIsManager(draft.isManager);
                    }
                  }
                } catch (err) {
                  console.error('‚ùå Fehler beim Laden aus Firestore:', err);
                  // Fallback: Lokalen Draft laden
                  const draft = DraftManager.loadDraft(draftId);
                  if (draft) {
                    if (draft.formData) setFormData(prev => ({ ...prev, ...draft.formData }));
                    if (draft.goals) setGoals(draft.goals);
                    if (draft.coreList) setCoreList(draft.coreList);
                    if (draft.leadList) setLeadList(draft.leadList);
                    if (draft.devPlan) setDevPlan(draft.devPlan);
                    if (draft.careerChecks) setCareerChecks(draft.careerChecks);
                    if (draft.isManager !== undefined) setIsManager(draft.isManager);
                  }
                }
                setLoadingFirestore(false);
              };
              
              loadFromFirestore();
            }, [user?.uid]);
            
            // === BERECHNUNGEN (VOLLST√ÑNDIG wie AppraisalForm) ===
            const totalGoalWeight = goals.reduce((sum, g) => sum + (parseFloat(g.weight) || 0), 0);
            
            // WAS-Score
            const calculateWAS = () => {
              let sum = 0, weight = 0;
              goals.forEach(g => {
                const w = parseFloat(g.weight) || 0;
                if (w > 0) { sum += getBarsScore(g.achievement) * (w / 100); weight += w; }
              });
              return weight > 0 ? (sum / (weight / 100)) : 0;
            };
            
            // WIE-Score
            const calculateWIE = (list) => {
              let sum = 0, weight = 0;
              list.forEach(i => {
                const w = parseFloat(i.weight) || 20;
                sum += (i.rating || 3) * (w / 100);
                weight += w;
              });
              return weight > 0 ? (sum / (weight / 100)) : 3;
            };
            
            const wasScore = calculateWAS();
            const wieCoreScore = calculateWIE(coreList);
            const wieLeadScore = calculateWIE(leadList);
            
            // GPS Berechnung (wie AppraisalForm)
            let finalGPS;
            const hasLeadershipScores = isManager && wieLeadScore > 0;
            
            if (goals.length === 0 || totalGoalWeight === 0) {
              if (isManager && hasLeadershipScores) {
                finalGPS = (wieCoreScore * 0.5) + (wieLeadScore * 0.5);
              } else {
                finalGPS = wieCoreScore;
              }
            } else {
              if (isManager && hasLeadershipScores) {
                finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.25) + (wieLeadScore * 0.25);
              } else {
                finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.5);
              }
            }
            
            // Bonus Berechnung
            const plannedBonusNum = parseFloat(formData.plannedBonus) || 0;
            const bonusPerGoal = goals.map(g => {
              const weight = parseFloat(g.weight) || 0;
              const achievement = parseFloat(g.achievement) || 0;
              const goalBonus = plannedBonusNum * (weight / 100);
              const achievementFactor = Math.min(achievement / 100, 1.0);
              return { goalBonus, payout: goalBonus * achievementFactor, achievement };
            });
            const totalBonusPayout = bonusPerGoal.reduce((sum, b) => sum + b.payout, 0);
            const bonusPayoutPercentage = plannedBonusNum > 0 ? (totalBonusPayout / plannedBonusNum * 100) : 0;
            
            // Halo-Effekt Erkennung
            const coreRatings = coreList.map(c => c.rating).filter(r => r > 0);
            const allCoreRatingsSame = coreRatings.length >= 5 && coreRatings.every(r => r === coreRatings[0]);
            const haloEffectWarning = allCoreRatingsSame && coreRatings.length >= 5;
            
            // === HANDLER ===
            const handleFormChange = (field, value) => setFormData(prev => ({ ...prev, [field]: value }));
            
            const handleSave = async (status) => {
              setIsSaving(true);
              
              // Berechne selfCoreScores f√ºr linkedSelfAssessment Kompatibilit√§t
              const selfCoreScores = {};
              const selfCoreComments = {};
              coreList.forEach(c => {
                selfCoreScores[c.id] = c.rating;
                selfCoreComments[c.id] = c.comment || '';
              });
              
              const selfLeaderScores = {};
              const selfLeaderComments = {};
              if (isManager) {
                leadList.forEach(c => {
                  selfLeaderScores[c.id] = c.rating;
                  selfLeaderComments[c.id] = c.comment || '';
                });
              }
              
              // Daten-Objekt f√ºr Firestore - unterschiedlich f√ºr Guest vs. Normal
              const saveData = {
                type: isGuestMode ? 'self_assessment' : 'self',
                status: status,
                period: period,
                employeeName: formData.employee || (isGuestMode && guestEmployee ? guestEmployee.name : user?.displayName) || 'Unbekannt',
                employeeEmail: user?.email || formData.employeeEmail || '',
                // Guest-Modus: userId ist die FK-ID, employeeId ist der Mitarbeiter
                ...(isGuestMode && guestEmployee ? {
                  employeeId: guestEmployee.id,
                  userId: guestEmployee.userId, // Manager's userId
                  isSelfAssessment: true
                } : {
                  createdByUid: user?.uid || null
                }),
                formData: formData,
                goals: noGoalsMode ? [] : goals,
                noGoalsMode: noGoalsMode,
                coreList: coreList,
                leadList: isManager ? leadList : [],
                devPlan: devPlan,
                careerChecks: careerChecks,
                isManager: isManager,
                // F√ºr linkedSelfAssessment Kompatibilit√§t
                selfCoreScores: selfCoreScores,
                selfCoreComments: selfCoreComments,
                selfLeaderScores: isManager ? selfLeaderScores : null,
                selfLeaderComments: isManager ? selfLeaderComments : null,
                // Scores
                wasScore: noGoalsMode ? 0 : wasScore,
                wieCoreScore: wieCoreScore,
                wieLeadScore: isManager ? wieLeadScore : null,
                finalGPS: finalGPS,
                // NEU: Vorhalten f√ºr FK-Email (wenn angegeben)
                pendingForEmail: formData.managerEmail?.trim()?.toLowerCase() || null,
                pendingStatus: formData.managerEmail?.trim() ? 'pending_claim' : null,
                updatedAt: new Date().toISOString()
              };
              
              try {
                if (db && (user?.uid || (isGuestMode && guestEmployee))) {
                  if (firestoreDocId) {
                    // Update existierendes Dokument
                    await db.collection('teamAppraisals').doc(firestoreDocId).update(saveData);
                    console.log('‚úÖ Selbstreflexion in Firestore aktualisiert:', firestoreDocId);
                  } else {
                    // Neues Dokument erstellen
                    saveData.createdAt = new Date().toISOString();
                    if (isGuestMode) {
                      saveData.submittedAt = new Date().toISOString();
                    }
                    const docRef = await db.collection('teamAppraisals').add(saveData);
                    setFirestoreDocId(docRef.id);
                    console.log('‚úÖ Selbstreflexion in Firestore gespeichert:', docRef.id);
                  }
                  setSaveStatus(status === 'completed' ? 'firebase_completed' : 'firebase_draft');
                  
                  // Im Guest-Modus: Callback aufrufen wenn abgeschlossen
                  if (isGuestMode && status === 'completed' && onComplete) {
                    setTimeout(() => onComplete(), 1500);
                  }
                } else {
                  // Fallback: Lokaler Draft
                  DraftManager.saveDraft(draftId, saveData);
                  console.log('üíæ Selbstreflexion lokal gespeichert');
                  setSaveStatus(status);
                }
              } catch (err) {
                console.error('‚ùå Fehler beim Speichern:', err);
                // Fallback: Lokal speichern
                DraftManager.saveDraft(draftId, saveData);
                setSaveStatus('local_fallback');
              }
              
              setTimeout(() => setSaveStatus(null), 3000);
              setIsSaving(false);
            };
            
            // === SHARE-LINK GENERIERUNG ===
            const generateShareLink = () => {
              // Erstelle komprimierte Daten f√ºr den Link
              const shareData = {
                v: 1, // Version
                n: formData.employee || 'Unbekannt',
                p: formData.position || '',
                m: formData.manager || '',
                e: user?.email || formData.employeeEmail || '',
                g: goals.filter(g => g.name?.trim()).map(g => ({
                  n: g.name,
                  w: g.weight,
                  a: g.achievement
                })),
                c: coreList.map(c => ({ i: c.id, r: c.rating, t: c.comment || '' })),
                l: isManager ? leadList.map(c => ({ i: c.id, r: c.rating, t: c.comment || '' })) : [],
                im: isManager,
                d: devPlan.filter(d => d.measure?.trim()).map(d => ({
                  m: d.measure,
                  r: d.responsible,
                  dl: d.deadline
                })),
                s1: formData.strengths1 || '',
                s2: formData.strengths2 || '',
                cc: formData.careerComment || '',
                ck: careerChecks,
                ts: new Date().toISOString(),
                period: period
              };
              
              // Base64-kodieren
              const encoded = btoa(encodeURIComponent(JSON.stringify(shareData)));
              const baseUrl = window.location.href.split('?')[0];
              const link = `${baseUrl}?import_self=${encoded}`;
              
              setShareLink(link);
              setShowShareModal(true);
              setLinkCopied(false);
            };
            
            const copyShareLink = async () => {
              try {
                await navigator.clipboard.writeText(shareLink);
                setLinkCopied(true);
                setTimeout(() => setLinkCopied(false), 3000);
              } catch (err) {
                // Fallback f√ºr √§ltere Browser
                const textArea = document.createElement('textarea');
                textArea.value = shareLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                setLinkCopied(true);
                setTimeout(() => setLinkCopied(false), 3000);
              }
            };
            
            // === SHARE MODAL COMPONENT ===
            const ShareModal = () => {
              if (!showShareModal) return null;
              
              const getText = (de, it, en) => lang === 'de' ? de : lang === 'it' ? it : en;
              
              return e('div', { 
                className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
                onClick: (ev) => ev.target === ev.currentTarget && setShowShareModal(false)
              },
                e('div', { className: 'bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto' },
                  // Header
                  e('div', { className: 'p-6 border-b border-slate-200', style: { backgroundColor: '#243186' } },
                    e('div', { className: 'flex items-center justify-between' },
                      e('h2', { className: 'text-2xl font-bold text-white flex items-center gap-3' },
                        e(Share2, { size: 28 }),
                        getText('Selbstreflexion teilen', 'Condividi autovalutazione', 'Share Self-Assessment')
                      ),
                      e('button', { 
                        onClick: () => setShowShareModal(false),
                        className: 'text-white hover:text-slate-200 transition-colors'
                      }, e(X, { size: 24 }))
                    )
                  ),
                  
                  // Content
                  e('div', { className: 'p-6 space-y-6' },
                    // Success Message
                    e('div', { className: 'bg-green-50 border border-green-200 rounded-xl p-4 flex items-start gap-3' },
                      e(CheckCircle2, { size: 24, className: 'text-green-600 flex-shrink-0 mt-0.5' }),
                      e('div', null,
                        e('p', { className: 'font-semibold text-green-800' }, 
                          getText('Ihre Selbstreflexion wurde gespeichert!', 'La tua autovalutazione √® stata salvata!', 'Your self-assessment has been saved!')
                        ),
                        e('p', { className: 'text-sm text-green-700 mt-1' },
                          getText(
                            'Jetzt k√∂nnen Sie sie mit Ihrer F√ºhrungskraft teilen.',
                            'Ora puoi condividerla con il tuo responsabile.',
                            'Now you can share it with your manager.'
                          )
                        )
                      )
                    ),
                    
                    // Step by Step Instructions
                    e('div', { className: 'bg-slate-50 rounded-xl p-5' },
                      e('h3', { className: 'font-bold text-slate-800 mb-4 flex items-center gap-2' },
                        e(ClipboardList, { size: 20, style: { color: '#243186' } }),
                        getText('So funktioniert\'s:', 'Come funziona:', 'How it works:')
                      ),
                      e('div', { className: 'space-y-4' },
                        // Step 1
                        e('div', { className: 'flex gap-4' },
                          e('div', { className: 'w-8 h-8 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0', style: { backgroundColor: '#243186' } }, '1'),
                          e('div', null,
                            e('p', { className: 'font-semibold text-slate-800' }, 
                              getText('Link kopieren', 'Copia il link', 'Copy the link')
                            ),
                            e('p', { className: 'text-sm text-slate-600' },
                              getText(
                                'Klicken Sie auf den Button unten, um den Link zu kopieren.',
                                'Clicca sul pulsante qui sotto per copiare il link.',
                                'Click the button below to copy the link.'
                              )
                            )
                          )
                        ),
                        // Step 2
                        e('div', { className: 'flex gap-4' },
                          e('div', { className: 'w-8 h-8 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0', style: { backgroundColor: '#243186' } }, '2'),
                          e('div', null,
                            e('p', { className: 'font-semibold text-slate-800' }, 
                              getText('Link an F√ºhrungskraft senden', 'Invia il link al responsabile', 'Send link to your manager')
                            ),
                            e('p', { className: 'text-sm text-slate-600' },
                              getText(
                                'Senden Sie den kopierten Link per E-Mail oder Teams an Ihre F√ºhrungskraft.',
                                'Invia il link copiato via e-mail o Teams al tuo responsabile.',
                                'Send the copied link via email or Teams to your manager.'
                              )
                            )
                          )
                        ),
                        // Step 3
                        e('div', { className: 'flex gap-4' },
                          e('div', { className: 'w-8 h-8 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0', style: { backgroundColor: '#6EBD84' } }, '3'),
                          e('div', null,
                            e('p', { className: 'font-semibold text-slate-800' }, 
                              getText('Fertig!', 'Fatto!', 'Done!')
                            ),
                            e('p', { className: 'text-sm text-slate-600' },
                              getText(
                                'Ihre F√ºhrungskraft √∂ffnet den Link und Ihre Selbstreflexion wird automatisch importiert.',
                                'Il tuo responsabile apre il link e la tua autovalutazione viene importata automaticamente.',
                                'Your manager opens the link and your self-assessment is automatically imported.'
                              )
                            )
                          )
                        )
                      )
                    ),
                    
                    // Link Box
                    e('div', { className: 'border border-slate-300 rounded-xl overflow-hidden' },
                      e('div', { className: 'bg-slate-100 px-4 py-2 border-b border-slate-300' },
                        e('span', { className: 'text-sm font-medium text-slate-600' }, 
                          getText('Ihr pers√∂nlicher Share-Link:', 'Il tuo link di condivisione:', 'Your personal share link:')
                        )
                      ),
                      e('div', { className: 'p-4 bg-white' },
                        e('div', { className: 'bg-slate-50 p-3 rounded-lg font-mono text-xs text-slate-600 break-all max-h-20 overflow-y-auto' },
                          shareLink
                        )
                      )
                    ),
                    
                    // Copy Button
                    e('button', {
                      onClick: copyShareLink,
                      className: 'w-full py-4 rounded-xl font-bold text-white flex items-center justify-center gap-3 transition-all transform hover:scale-[1.02]',
                      style: { backgroundColor: linkCopied ? '#6EBD84' : '#243186' }
                    },
                      linkCopied ? e(CheckCircle2, { size: 24 }) : e(Copy, { size: 24 }),
                      linkCopied 
                        ? getText('‚úì Link kopiert!', '‚úì Link copiato!', '‚úì Link copied!')
                        : getText('Link in Zwischenablage kopieren', 'Copia link negli appunti', 'Copy link to clipboard')
                    ),
                    
                    // Per E-Mail senden Button
                    e('button', {
                      onClick: () => {
                        const subject = encodeURIComponent(
                          getText(
                            `Meine Selbstreflexion - ${formData.employee || 'Mitarbeiter'}`,
                            `La mia autovalutazione - ${formData.employee || 'Collaboratore'}`,
                            `My Self-Assessment - ${formData.employee || 'Employee'}`
                          )
                        );
                        const body = encodeURIComponent(
                          getText(
                            `Hallo,\n\nanbei meine Selbstreflexion f√ºr das Jahresgespr√§ch.\n\nBitte √∂ffnen Sie folgenden Link, um meine Eingaben zu importieren:\n\n${shareLink}\n\nMit freundlichen Gr√º√üen\n${formData.employee || 'Ihr Mitarbeiter'}`,
                            `Salve,\n\nin allegato la mia autovalutazione per il colloquio annuale.\n\nApra il seguente link per importare i miei dati:\n\n${shareLink}\n\nCordiali saluti\n${formData.employee || 'Il tuo collaboratore'}`,
                            `Hello,\n\nplease find my self-assessment for the annual review.\n\nPlease open the following link to import my data:\n\n${shareLink}\n\nBest regards\n${formData.employee || 'Your employee'}`
                          )
                        );
                        window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
                      },
                      className: 'w-full py-4 rounded-xl font-bold text-white flex items-center justify-center gap-3 transition-all transform hover:scale-[1.02]',
                      style: { backgroundColor: '#6EBD84' }
                    },
                      e(Mail, { size: 24 }),
                      getText('Per E-Mail an F√ºhrungskraft senden', 'Invia via e-mail al responsabile', 'Send via email to manager')
                    ),
                    
                    // Email Template
                    e('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4' },
                      e('h4', { className: 'font-semibold text-blue-800 mb-2 flex items-center gap-2' },
                        e(Mail, { size: 18 }),
                        getText('Vorlage f√ºr Ihre E-Mail:', 'Modello per la tua e-mail:', 'Template for your email:')
                      ),
                      e('div', { className: 'bg-white p-3 rounded-lg text-sm text-slate-700 border border-blue-100' },
                        e('p', { className: 'mb-2' },
                          getText(
                            `Betreff: Meine Selbstreflexion - ${formData.employee || 'Name'}`,
                            `Oggetto: La mia autovalutazione - ${formData.employee || 'Nome'}`,
                            `Subject: My Self-Assessment - ${formData.employee || 'Name'}`
                          )
                        ),
                        e('p', { className: 'text-slate-600' },
                          getText(
                            `Hallo,\n\nanbei meine Selbstreflexion f√ºr das Jahresgespr√§ch.\n\nBitte √∂ffnen Sie folgenden Link, um meine Eingaben zu importieren:\n[Link einf√ºgen]\n\nMit freundlichen Gr√º√üen\n${formData.employee || 'Ihr Name'}`,
                            `Salve,\n\nin allegato la mia autovalutazione per il colloquio annuale.\n\nApra il seguente link per importare i miei dati:\n[Inserire link]\n\nCordiali saluti\n${formData.employee || 'Il tuo nome'}`,
                            `Hello,\n\nplease find my self-assessment for the annual review.\n\nPlease open the following link to import my data:\n[Insert link]\n\nBest regards\n${formData.employee || 'Your name'}`
                          )
                        )
                      )
                    ),
                    
                    // Warning
                    e('div', { className: 'flex items-start gap-3 text-sm text-slate-600' },
                      e(Info, { size: 18, className: 'flex-shrink-0 mt-0.5 text-slate-400' }),
                      e('p', null,
                        getText(
                          'Wichtig: Der Link enth√§lt Ihre Selbstreflexion. Teilen Sie ihn nur mit Ihrer F√ºhrungskraft.',
                          'Importante: Il link contiene la tua autovalutazione. Condividilo solo con il tuo responsabile.',
                          'Important: The link contains your self-assessment. Only share it with your manager.'
                        )
                      )
                    )
                  ),
                  
                  // Footer
                  e('div', { className: 'p-6 border-t border-slate-200 bg-slate-50' },
                    e('button', {
                      onClick: () => setShowShareModal(false),
                      className: 'w-full py-3 rounded-xl font-medium text-slate-600 bg-white border border-slate-300 hover:bg-slate-100 transition-colors'
                    },
                      getText('Schlie√üen', 'Chiudi', 'Close')
                    )
                  )
                )
              );
            };
            
            const handlePrint = () => { setIsGenerating(true); setTimeout(() => { window.print(); setIsGenerating(false); }, 100); };
            
            // Item-Management
            const addItem = (list, setList, template) => {
              const newId = Math.max(...list.map(i => i.id || 0), 0) + 1;
              setList([...list, { ...template, id: newId }]);
            };
            const removeItem = (list, setList, id) => setList(list.filter(i => i.id !== id));
            const updateItem = (list, setList, id, field, value) => setList(list.map(i => i.id === id ? { ...i, [field]: value } : i));
            
            // Ziel-Zeile
            const renderGoalRow = (goal) => e('tr', { key: goal.id },
              e('td', { className: 'p-2 border' }, e('input', { type: 'text', value: goal.name, onChange: (ev) => updateItem(goals, setGoals, goal.id, 'name', ev.target.value), className: 'w-full outline-none', placeholder: t.goalName })),
              e('td', { className: 'p-2 border w-20' }, e('input', { type: 'number', value: goal.weight, onChange: (ev) => updateItem(goals, setGoals, goal.id, 'weight', parseInt(ev.target.value) || 0), className: 'w-full outline-none text-center', min: 0, max: 100 })),
              e('td', { className: 'p-2 border w-24' }, e('input', { type: 'number', value: goal.achievement, onChange: (ev) => updateItem(goals, setGoals, goal.id, 'achievement', parseInt(ev.target.value) || 0), className: 'w-full outline-none text-center', min: 0, max: 150 })),
              e('td', { className: 'p-2 border w-20 text-center' }, e('span', { className: 'text-sm font-medium' }, getBarsScore(goal.achievement || 0))),
              e('td', { className: 'p-2 border w-10 no-print' }, e('button', { onClick: () => removeItem(goals, setGoals, goal.id), className: 'text-red-500 hover:text-red-700' }, e(Trash2, { size: 16 })))
            );
            
            // Kompetenz-Zeile
            const renderCompRow = (comp, list, setList) => e('tr', { key: comp.id },
              e('td', { className: 'p-2 border font-medium' }, comp.name),
              e('td', { className: 'p-2 border w-24' }, e('select', { value: comp.rating, onChange: (ev) => updateItem(list, setList, comp.id, 'rating', parseInt(ev.target.value)), className: 'w-full outline-none bg-white' }, [1,2,3,4,5].map(n => e('option', { key: n, value: n }, n)))),
              e('td', { className: 'p-2 border' }, e('input', { type: 'text', value: comp.comment || '', onChange: (ev) => updateItem(list, setList, comp.id, 'comment', ev.target.value), className: 'w-full outline-none', placeholder: t.comment }))
            );
            
            // Entwicklungsplan-Zeile
            const renderDevRow = (dev) => e('tr', { key: dev.id },
              e('td', { className: 'p-2 border' }, e('input', { type: 'text', value: dev.measure, onChange: (ev) => updateItem(devPlan, setDevPlan, dev.id, 'measure', ev.target.value), className: 'w-full outline-none', placeholder: t.devMeasure })),
              e('td', { className: 'p-2 border w-32' }, e('input', { type: 'text', value: dev.responsible, onChange: (ev) => updateItem(devPlan, setDevPlan, dev.id, 'responsible', ev.target.value), className: 'w-full outline-none' })),
              e('td', { className: 'p-2 border w-28' }, e('input', { type: 'date', value: dev.deadline, onChange: (ev) => updateItem(devPlan, setDevPlan, dev.id, 'deadline', ev.target.value), className: 'w-full outline-none' })),
              e('td', { className: 'p-2 border w-10 no-print' }, e('button', { onClick: () => removeItem(devPlan, setDevPlan, dev.id), className: 'text-red-500 hover:text-red-700' }, e(Trash2, { size: 16 })))
            );
            
            // === RENDER ===
            // Lade-Anzeige w√§hrend Firestore l√§dt
            if (loadingFirestore) {
              return e('div', { className: 'flex flex-col items-center justify-center py-20' },
                e(Loader2, { className: 'animate-spin text-blue-600', size: 48 }),
                e('p', { className: 'mt-4 text-slate-600' }, lang === 'de' ? 'Lade Selbstreflexion...' : 'Caricamento autovalutazione...')
              );
            }
            
            return e('div', { className: 'space-y-6 max-w-4xl mx-auto print:max-w-none' },
              
              // === SHARE MODAL ===
              e(ShareModal, null),
              
              // === HEADER ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100' },
                e('div', { className: 'flex justify-between items-start mb-6' },
                  e('div', null,
                    e('h1', { className: 'text-3xl font-bold', style: { color: '#243186' } }, 'nƒ±ederwƒ±eser'),
                    e('span', { className: 'text-sm tracking-wider font-medium', style: { color: '#6EBD84' } }, 'FLEXIBLE FOOD PACKAGING')
                  ),
                  e('button', { onClick: handlePrint, disabled: isGenerating, className: 'no-print flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-2xl hover:bg-blue-700 disabled:opacity-50' },
                    isGenerating ? e(Loader2, { className: 'animate-spin', size: 18 }) : e(Download, { size: 18 }), isGenerating ? t.generating : t.print)
                ),
                e('div', { className: 'border-b-2 border-slate-100 mb-4' }),
                
                // Speicher-Buttons
                e('div', { className: 'mb-6 p-5 bg-gradient-to-r from-[#243186] to-[#1a2564] rounded-xl no-print' },
                  e('div', { className: 'flex flex-col gap-4' },
                    e('div', { className: 'text-white' },
                      e('h2', { className: 'text-2xl font-bold', style: { color: '#6EBD84' } }, lang === 'de' ? 'Selbstreflexionsbogen' : 'Autovalutazione'),
                      e('p', { className: 'text-blue-200 text-sm' }, t.headerSubtitle)
                    ),
                    
                    // Buttons: Im Guest-Modus nur "Entwurf" und "Abschlie√üen", sonst mit Share
                    e('div', { className: isGuestMode ? 'grid grid-cols-2 gap-4' : 'grid grid-cols-3 gap-4' },
                      // Entwurf-Button
                      e('button', { 
                        onClick: () => handleSave('draft'), 
                        disabled: isSaving, 
                        className: 'bg-slate-200 hover:bg-slate-300 text-slate-900 py-4 px-5 rounded-xl font-bold flex items-center justify-center gap-2' 
                      }, 
                        e(Save, { size: 18 }),
                        (lang === 'de' ? 'Entwurf speichern' : lang === 'it' ? 'Salva bozza' : 'Save Draft')
                      ),
                      
                      // Abschlie√üen-Button (unterschiedlich f√ºr Guest vs. Normal)
                      e('button', { 
                        onClick: async () => { 
                          await handleSave('completed'); 
                          // Im Guest-Modus: onComplete aufrufen f√ºr Erfolgsseite
                          if (isGuestMode && onComplete) {
                            // Kurze Verz√∂gerung f√ºr Feedback
                            setTimeout(() => onComplete(), 1000);
                          } else if (formData.employee?.trim()) {
                            // Normal-Modus: Share-Link generieren
                            generateShareLink();
                          }
                        }, 
                        disabled: isSaving, 
                        className: 'bg-[#6EBD84] hover:bg-[#5da872] text-white py-4 px-5 rounded-xl font-bold flex items-center justify-center gap-2' 
                      }, 
                        e(isGuestMode ? CheckCircle2 : Share2, { size: 18 }),
                        isGuestMode 
                          ? (lang === 'de' ? 'Abschlie√üen & Senden' : lang === 'it' ? 'Completa & Invia' : 'Complete & Submit')
                          : (lang === 'de' ? 'Abschlie√üen & Teilen' : lang === 'it' ? 'Completa & Condividi' : 'Complete & Share')
                      ),
                      
                      // PDF-Button (nur im Normal-Modus)
                      !isGuestMode && e('button', { 
                        onClick: handlePrint, 
                        className: 'border-2 border-white/40 text-white py-4 px-5 rounded-xl font-bold hover:bg-white/20' 
                      }, 'PDF')
                    ),
                    
                    // Status-Anzeige
                    saveStatus && e('div', { className: 'text-center font-medium ' + (saveStatus.includes('firebase') ? 'text-green-300' : 'text-yellow-300') }, 
                      saveStatus === 'firebase_completed' 
                        ? (isGuestMode 
                            ? (lang === 'de' ? '‚úÖ Erfolgreich an Ihre F√ºhrungskraft gesendet!' : '‚úÖ Inviato con successo al tuo responsabile!')
                            : '‚úÖ In Cloud gespeichert & abgeschlossen!')
                        : saveStatus === 'firebase_draft' ? '‚òÅÔ∏è In Cloud als Entwurf gespeichert' 
                        : saveStatus === 'local_fallback' ? 'üíæ Lokal gespeichert (offline)' 
                        : '‚úì Gespeichert!'
                    ),
                    
                    // Loading-Indikator
                    isSaving && e('div', { className: 'text-center text-blue-200' },
                      e('span', { className: 'animate-pulse' }, 
                        lang === 'de' ? '‚è≥ Wird gespeichert...' : '‚è≥ Salvataggio in corso...'
                      )
                    )
                  )
                ),
                
                // Anleitung: UNTERSCHIEDLICH f√ºr Guest-Modus vs. Normal-Modus
                isGuestMode 
                  // === GUEST-MODUS: Einfache Info, keine Link-Teilung n√∂tig ===
                  ? e('div', { className: 'bg-green-50 border-2 border-green-200 rounded-xl p-5 mb-4 no-print' },
                      e('div', { className: 'flex items-start gap-4' },
                        e('div', { className: 'w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0', style: { backgroundColor: '#6EBD84' } },
                          e(CheckCircle2, { size: 24, className: 'text-white' })
                        ),
                        e('div', null,
                          e('h4', { className: 'font-bold text-green-900 mb-2' }, 
                            lang === 'de' ? '‚úÖ Ihre Selbstreflexion wird automatisch √ºbermittelt' 
                            : lang === 'it' ? '‚úÖ La tua autovalutazione verr√† inviata automaticamente'
                            : '‚úÖ Your self-assessment will be submitted automatically'
                          ),
                          e('p', { className: 'text-sm text-green-800' },
                            lang === 'de' 
                              ? 'F√ºllen Sie das Formular aus und klicken Sie am Ende auf "Abschlie√üen & Senden". Ihre Eingaben werden direkt an Ihre F√ºhrungskraft √ºbermittelt - kein Link-Versand erforderlich!'
                              : lang === 'it'
                              ? 'Compila il modulo e clicca su "Completa & Invia". Le tue risposte verranno inviate direttamente al tuo responsabile - nessun invio di link necessario!'
                              : 'Fill out the form and click "Complete & Submit". Your input will be sent directly to your manager - no link sharing required!'
                          )
                        )
                      )
                    )
                  // === NORMAL-MODUS: Vollst√§ndige Anleitung mit Link-Teilung ===
                  : e('div', { className: 'bg-blue-50 border-2 border-blue-200 rounded-xl p-5 mb-4 no-print' },
                      e('div', { className: 'flex items-start gap-4' },
                        e('div', { className: 'w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0', style: { backgroundColor: '#243186' } },
                          e(Info, { size: 24, className: 'text-white' })
                        ),
                        e('div', null,
                          e('h4', { className: 'font-bold text-blue-900 mb-2' }, 
                            lang === 'de' ? 'üìã So teilen Sie Ihre Selbstreflexion mit Ihrer F√ºhrungskraft:' 
                            : lang === 'it' ? 'üìã Come condividere la tua autovalutazione con il tuo responsabile:'
                            : 'üìã How to share your self-assessment with your manager:'
                          ),
                          e('ol', { className: 'text-sm text-blue-800 space-y-2' },
                            e('li', { className: 'flex items-start gap-2' },
                              e('span', { className: 'font-bold text-blue-600' }, '1.'),
                              lang === 'de' 
                                ? 'F√ºllen Sie alle Felder aus (mindestens Ihren Namen und die E-Mail Ihrer F√ºhrungskraft)' 
                                : lang === 'it'
                                ? 'Compila tutti i campi (almeno il tuo nome e l\'e-mail del tuo responsabile)'
                                : 'Fill in all fields (at least your name and your manager\'s email)'
                            ),
                            e('li', { className: 'flex items-start gap-2' },
                              e('span', { className: 'font-bold text-blue-600' }, '2.'),
                              lang === 'de' 
                                ? 'Klicken Sie auf "Abschlie√üen & Teilen"' 
                                : lang === 'it'
                                ? 'Clicca su "Completa & Condividi"'
                                : 'Click "Complete & Share"'
                            ),
                            e('li', { className: 'flex items-start gap-2' },
                              e('span', { className: 'font-bold text-blue-600' }, '3.'),
                              lang === 'de' 
                                ? 'Kopieren Sie den Link und senden Sie ihn per E-Mail an Ihre F√ºhrungskraft' 
                                : lang === 'it'
                                ? 'Copia il link e invialo via e-mail al tuo responsabile'
                                : 'Copy the link and send it to your manager via email'
                            )
                          ),
                          e('div', { className: 'mt-3 p-3 bg-green-50 border border-green-200 rounded-lg' },
                            e('p', { className: 'text-green-800 text-xs flex items-center gap-2' },
                              e(CheckCircle2, { size: 14 }),
                              lang === 'de' 
                                ? 'Tipp: Wenn Sie die E-Mail-Adresse Ihrer F√ºhrungskraft eingeben, wird Ihre Selbstreflexion automatisch bereitgestellt, sobald sich Ihre FK registriert.'
                                : lang === 'it'
                                ? 'Suggerimento: Se inserisci l\'e-mail del tuo responsabile, la tua autovalutazione sar√† disponibile automaticamente quando il responsabile si registra.'
                                : 'Tip: If you enter your manager\'s email, your self-assessment will be automatically available once your manager registers.'
                            )
                          )
                        )
                      )
                    ),
                
                // Hinweis
                e('div', { className: 'bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4 no-print' },
                  e('p', { className: 'text-amber-800 text-sm' }, 'üí° ' + (lang === 'de' ? 'Hinweis: Alle Felder sind freiwillig!' : 'Nota: Tutti i campi sono facoltativi!'))
                ),
                
                e('h2', { className: 'text-2xl font-bold', style: { color: '#243186' } }, lang === 'de' ? 'Selbstreflexionsbogen' : 'Autovalutazione'),
                e('p', { className: 'font-medium', style: { color: '#6EBD84' } }, t.headerSubtitle)
              ),
              
              // === TEIL A: STAMMDATEN ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('h3', { className: 'text-lg font-bold text-slate-700 mb-4 border-b pb-2' }, t.partA),
                
                // === PROFIL-AUSWAHL (Mitarbeiter/F√ºhrungskraft) ===
                e('div', { className: 'no-print mb-6 bg-[#F4FAF7] p-3 rounded flex gap-6 items-center' },
                  e('span', { className: 'font-bold text-sm text-[#4D9360]' }, t.profile + ':'),
                  e('label', { className: 'flex items-center gap-2 text-sm cursor-pointer' }, e('input', { type: 'radio', checked: !isManager, onChange: () => setIsManager(false) }), t.roleEmp),
                  e('label', { className: 'flex items-center gap-2 text-sm cursor-pointer' }, e('input', { type: 'radio', checked: isManager, onChange: () => setIsManager(true) }), t.roleMgr)
                ),
                e('div', { className: 'hidden print:block mb-4 font-bold' }, t.profile + ': ' + (isManager ? t.roleMgr : t.roleEmp)),
                
                e('div', { className: 'grid grid-cols-2 gap-6' },
                  e('div', null, e('label', { className: 'text-xs text-slate-500 block' }, t.employee), e('input', { type: 'text', value: formData.employee, onChange: (ev) => handleFormChange('employee', ev.target.value), className: 'w-full border-b border-slate-300 py-1 outline-none' })),
                  e('div', null, e('label', { className: 'text-xs text-slate-500 block' }, t.manager), e('input', { type: 'text', value: formData.manager, onChange: (ev) => handleFormChange('manager', ev.target.value), className: 'w-full border-b border-slate-300 py-1 outline-none' })),
                  e('div', null, e('label', { className: 'text-xs text-slate-500 block' }, t.position), e('input', { type: 'text', value: formData.position, onChange: (ev) => handleFormChange('position', ev.target.value), className: 'w-full border-b border-slate-300 py-1 outline-none' })),
                  e('div', null, e('label', { className: 'text-xs text-slate-500 block' }, t.date), e('input', { type: 'date', value: formData.date, onChange: (ev) => handleFormChange('date', ev.target.value), className: 'w-full border-b border-slate-300 py-1 outline-none' }))
                ),
                // NEU: FK-Email Feld f√ºr Vorhalten-Feature
                e('div', { className: 'mt-4 p-4 bg-gradient-to-r from-green-50 to-teal-50 border border-green-200 rounded-xl no-print' },
                  e('label', { className: 'text-sm font-medium text-green-800 block mb-2 flex items-center gap-2' }, 
                    e(Mail, { size: 16 }),
                    lang === 'de' ? 'E-Mail-Adresse Ihrer F√ºhrungskraft (optional, aber empfohlen):' 
                    : lang === 'it' ? 'Indirizzo e-mail del tuo responsabile (facoltativo, ma consigliato):'
                    : 'Your manager\'s email address (optional, but recommended):'
                  ),
                  e('input', { 
                    type: 'email', 
                    value: formData.managerEmail || '', 
                    onChange: (ev) => handleFormChange('managerEmail', ev.target.value), 
                    placeholder: lang === 'de' ? 'vorname.nachname@niederwieser.com' : 'nome.cognome@niederwieser.com',
                    className: 'w-full border border-green-300 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-green-400 focus:border-green-400' 
                  }),
                  e('p', { className: 'text-xs text-green-600 mt-2' }, 
                    lang === 'de' 
                      ? 'üí° Wenn Sie die E-Mail eingeben, wird Ihre Selbstreflexion automatisch f√ºr Ihre FK bereitgestellt, sobald diese sich registriert.'
                      : lang === 'it'
                      ? 'üí° Se inserisci l\'e-mail, la tua autovalutazione sar√† automaticamente disponibile per il tuo responsabile una volta registrato.'
                      : 'üí° If you enter the email, your self-assessment will be automatically available to your manager once they register.'
                  )
                )
              ),
              
              // === TEIL B: ZIELERREICHUNG (WAS) ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('div', { className: 'flex justify-between items-center mb-4 border-b pb-2' },
                  e('h3', { className: 'text-lg font-bold text-slate-700' }, t.partB),
                  e('span', { className: 'bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-bold' }, goals.length > 0 ? 'Score: ' + wasScore.toFixed(2) : (lang === 'de' ? 'Keine Ziele' : 'Nessun obiettivo'))
                ),
                
                // "Keine Ziele" Checkbox
                e('div', { className: 'mb-4 p-4 bg-amber-50 border border-amber-200 rounded-xl no-print' },
                  e('label', { className: 'flex items-center gap-3 cursor-pointer' },
                    e('input', { 
                      type: 'checkbox', 
                      checked: noGoalsMode,
                      onChange: (ev) => handleNoGoalsToggle(ev.target.checked),
                      className: 'w-5 h-5 rounded border-amber-400 text-amber-600 focus:ring-amber-500'
                    }),
                    e('div', null,
                      e('span', { className: 'font-medium text-amber-800' }, 
                        lang === 'de' ? 'Keine Ziele vereinbart' : lang === 'it' ? 'Nessun obiettivo concordato' : 'No goals agreed'
                      ),
                      e('p', { className: 'text-xs text-amber-600 mt-0.5' },
                        lang === 'de' 
                          ? 'Aktivieren Sie diese Option, falls f√ºr Sie keine Ziele festgelegt wurden. Der GPS wird dann nur aus den Kompetenzen (100%) berechnet.'
                          : lang === 'it'
                          ? 'Attiva questa opzione se non sono stati definiti obiettivi per te. Il GPS sar√† calcolato solo dalle competenze (100%).'
                          : 'Enable this option if no goals were set for you. GPS will be calculated from competencies only (100%).'
                      )
                    )
                  )
                ),
                
                // Ziele-Tabelle (nur wenn noGoalsMode = false)
                !noGoalsMode && e('table', { className: 'w-full text-sm' },
                  e('thead', { className: 'bg-slate-50 text-left' }, e('tr', null, e('th', { className: 'p-2 border' }, t.goalName), e('th', { className: 'p-2 border w-20' }, t.weight), e('th', { className: 'p-2 border w-24' }, t.achievement), e('th', { className: 'p-2 border w-20' }, 'BARS'), e('th', { className: 'p-2 border w-10 no-print' }, ''))),
                  e('tbody', null, goals.map(g => renderGoalRow(g)))
                ),
                !noGoalsMode && e('button', { onClick: () => addItem(goals, setGoals, { name: '', weight: 0, achievement: 0 }), className: 'no-print mt-3 text-xs flex items-center gap-1 text-blue-600' }, e(PlusCircle, { size: 14 }), ' ', t.addGoal),
                !noGoalsMode && totalGoalWeight !== 100 && goals.length > 0 && e('div', { className: 'mt-3 text-sm p-3 rounded-lg bg-yellow-50 text-yellow-700 border border-yellow-200 no-print' }, t.totalWeight + ': ' + totalGoalWeight + '% (' + t.shouldBe100 + ')'),
                
                // Info wenn keine Ziele
                noGoalsMode && e('div', { className: 'text-center py-8 text-slate-400' },
                  e('p', { className: 'text-sm' }, 
                    lang === 'de' 
                      ? 'üìä Der GPS wird nur aus Teil C (Kompetenzen = 100%) berechnet.'
                      : lang === 'it'
                      ? 'üìä Il GPS sar√† calcolato solo dalla Parte C (Competenze = 100%).'
                      : 'üìä GPS will be calculated from Part C only (Competencies = 100%).'
                  )
                ),
                
                // Bonus (nur wenn Ziele vorhanden)
                !noGoalsMode && e('div', { className: 'mt-6 pt-4 border-t border-slate-200' },
                  e('div', { className: 'flex items-center gap-4 mb-4' },
                    e('label', { className: 'text-sm font-semibold text-slate-700' }, lang === 'de' ? 'Geplanter Bonus (100%):' : 'Bonus pianificato:'),
                    e('div', { className: 'flex items-center gap-1' }, e('span', { className: 'text-slate-500' }, '‚Ç¨'), e('input', { type: 'text', value: formData.plannedBonus, onChange: (ev) => handleFormChange('plannedBonus', ev.target.value.replace(/[^\d]/g, '')), className: 'w-32 border-b border-slate-300 py-1 outline-none text-right', placeholder: '0' }))
                  ),
                  plannedBonusNum > 0 && e('div', { className: 'bg-emerald-50 border border-emerald-200 rounded-lg p-4' },
                    e('div', { className: 'flex justify-between items-center' },
                      e('div', { className: 'text-sm text-emerald-800' }, e('span', { className: 'font-medium' }, lang === 'de' ? 'Geplant: ' : 'Previsto: '), e('span', { className: 'font-bold' }, plannedBonusNum.toLocaleString('de-DE') + ' ‚Ç¨')),
                      e('div', { className: 'text-right' },
                        e('div', { className: 'text-xs text-emerald-600 mb-1' }, lang === 'de' ? 'Auszahlung:' : 'Pagamento:'),
                        e('div', { className: 'text-2xl font-black text-emerald-700' }, Math.round(totalBonusPayout).toLocaleString('de-DE') + ' ‚Ç¨'),
                        e('div', { className: 'text-xs font-medium ' + (bonusPayoutPercentage >= 100 ? 'text-green-600' : bonusPayoutPercentage >= 70 ? 'text-yellow-600' : 'text-red-600') }, '(' + bonusPayoutPercentage.toFixed(1) + '%)')
                      )
                    )
                  )
                )
              ),
              
              // === TEIL C: KERN-KOMPETENZEN ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('div', { className: 'flex justify-between items-center mb-4 border-b pb-2' },
                  e('h3', { className: 'text-lg font-bold text-slate-700' }, t.partC),
                  e('span', { className: 'bg-[#E8F5ED] text-[#4D9360] px-2 py-1 rounded text-xs font-bold' }, 'Score: ' + wieCoreScore.toFixed(2))
                ),
                e('table', { className: 'w-full text-sm' },
                  e('thead', { className: 'bg-slate-50 text-left' }, e('tr', null, e('th', { className: 'p-2 border' }, t.compName), e('th', { className: 'p-2 border w-24' }, t.rating), e('th', { className: 'p-2 border' }, t.comment))),
                  e('tbody', null, coreList.map(c => renderCompRow(c, coreList, setCoreList)))
                )
              ),
              
              // === TEIL C.2: LEADERSHIP-KOMPETENZEN (nur wenn isManager) ===
              isManager && e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('div', { className: 'flex justify-between items-center mb-4 border-b pb-2' },
                  e('h3', { className: 'text-lg font-bold text-[#5CA872]' }, t.partCLead),
                  e('span', { className: 'bg-[#E8F5ED] text-[#4D9360] px-2 py-1 rounded text-xs font-bold' }, 'Score: ' + wieLeadScore.toFixed(2))
                ),
                e('table', { className: 'w-full text-sm' },
                  e('thead', { className: 'bg-slate-50 text-left' }, e('tr', null, e('th', { className: 'p-2 border' }, t.compName), e('th', { className: 'p-2 border w-24' }, t.rating), e('th', { className: 'p-2 border' }, t.comment))),
                  e('tbody', null, leadList.map(c => renderCompRow(c, leadList, setLeadList)))
                )
              ),
              
              // === HALO-EFFEKT WARNUNG ===
              haloEffectWarning && e('div', { className: 'bg-amber-50 border-2 border-amber-400 rounded-xl p-4 no-print' },
                e('div', { className: 'flex items-start gap-3' },
                  e('div', { className: 'text-2xl' }, 'üé≠'),
                  e('div', null,
                    e('div', { className: 'font-bold text-amber-800 mb-1' }, lang === 'de' ? 'M√∂glicher Halo-Effekt' : 'Possibile Effetto Halo'),
                    e('p', { className: 'text-sm text-amber-700' }, lang === 'de' ? 'Alle Kompetenzen haben die gleiche Bewertung.' : 'Tutte le competenze hanno la stessa valutazione.')
                  )
                )
              ),
              
              // === TEIL C.3: GPS ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('h3', { className: 'text-lg font-bold text-slate-700 mb-4 border-b pb-2' }, t.partC3),
                e('div', { className: 'bg-slate-50 p-6 rounded-xl text-center border border-slate-200' },
                  e('div', { className: 'text-sm text-slate-500 uppercase tracking-widest mb-2' }, 'Final GPS'),
                  e('div', { className: 'text-5xl font-black text-slate-800' }, finalGPS.toFixed(2)),
                  e('div', { className: 'mt-2 font-medium text-[#6EBD84]' },
                    goals.length === 0 || totalGoalWeight === 0
                      ? (isManager ? '(100% WIE: 50% Core + 50% Leadership)' : '(100% WIE: Kern-Kompetenzen)')
                      : (isManager ? '(WAS 50% + WIE Core 25% + WIE Lead 25%)' : '(WAS 50% + WIE Core 50%)')
                  ),
                  goals.length === 0 && e('div', { className: 'mt-3 text-xs text-amber-600 bg-amber-50 px-3 py-1 rounded-full inline-block' }, lang === 'de' ? '‚ö†Ô∏è Ohne Zielvereinbarung' : '‚ö†Ô∏è Senza accordo obiettivi')
                )
              ),
              
              // === TEIL D: ST√ÑRKEN & ENTWICKLUNG ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('h3', { className: 'text-lg font-bold text-slate-700 mb-4 border-b pb-2' }, t.partD),
                e('div', { className: 'mb-6' }, e('label', { className: 'block text-sm font-bold mb-1 text-slate-700' }, t.strengthsProfessional), e('textarea', { value: formData.strengths1, onChange: (ev) => handleFormChange('strengths1', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 3 })),
                e('div', { className: 'mb-6' }, e('label', { className: 'block text-sm font-bold mb-1 text-slate-700' }, t.strengthsPersonal), e('textarea', { value: formData.strengths2, onChange: (ev) => handleFormChange('strengths2', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 3 })),
                e('div', null,
                  e('label', { className: 'block text-sm font-bold mb-2 text-slate-700' }, t.devPlanTitle),
                  e('table', { className: 'w-full text-sm' },
                    e('thead', { className: 'bg-slate-50 text-left' }, e('tr', null, e('th', { className: 'p-2 border' }, t.devMeasure), e('th', { className: 'p-2 border w-32' }, t.devResponsible), e('th', { className: 'p-2 border w-28' }, t.devDeadline), e('th', { className: 'p-2 border w-10 no-print' }, ''))),
                    e('tbody', null, devPlan.map(d => renderDevRow(d)))
                  ),
                  e('button', { onClick: () => addItem(devPlan, setDevPlan, { measure: '', responsible: '', deadline: '' }), className: 'no-print mt-3 text-xs flex items-center gap-1 text-[#6EBD84]' }, e(PlusCircle, { size: 14 }), ' ', t.addDev)
                )
              ),
              
              // === TEIL E: KARRIEREPERSPEKTIVE ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('h3', { className: 'text-lg font-bold text-slate-700 mb-4 border-b pb-2' }, t.partE),
                e('div', { className: 'space-y-3' },
                  [lang === 'de' ? 'Ich bin zufrieden mit meiner aktuellen Position' : 'Sono soddisfatto/a della mia posizione attuale',
                   lang === 'de' ? 'Ich strebe eine Fachkarriere an' : 'Aspiro a una carriera tecnica',
                   lang === 'de' ? 'Ich strebe eine F√ºhrungskarriere an' : 'Aspiro a una carriera manageriale',
                   lang === 'de' ? 'Ich bin offen f√ºr einen Abteilungswechsel' : 'Sono aperto/a a un cambio di reparto',
                   lang === 'de' ? 'Ich bin offen f√ºr einen Standortwechsel' : 'Sono aperto/a a un cambio di sede'
                  ].map((label, idx) => e('label', { key: idx, className: 'flex items-center gap-3 cursor-pointer' },
                    e('input', { type: 'checkbox', checked: careerChecks[idx], onChange: (ev) => { const n = [...careerChecks]; n[idx] = ev.target.checked; setCareerChecks(n); }, className: 'w-4 h-4 accent-[#6EBD84]' }),
                    e('span', { className: 'text-sm text-slate-700' }, label)
                  ))
                ),
                e('div', { className: 'mt-4' }, e('label', { className: 'block text-sm font-bold mb-1 text-slate-700' }, t.careerComment), e('textarea', { value: formData.careerComment, onChange: (ev) => handleFormChange('careerComment', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 3 }))
              ),
              
              // === TEIL F: FEEDBACK ===
              e('div', { className: 'bg-white p-8 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 break-inside-avoid' },
                e('h3', { className: 'text-lg font-bold text-slate-700 mb-4 border-b pb-2' }, t.partF),
                e('div', { className: 'space-y-4' },
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ1), e('textarea', { value: formData.feedbackQ1, onChange: (ev) => handleFormChange('feedbackQ1', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ2), e('textarea', { value: formData.feedbackQ2, onChange: (ev) => handleFormChange('feedbackQ2', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ3), e('textarea', { value: formData.feedbackQ3, onChange: (ev) => handleFormChange('feedbackQ3', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ4), e('textarea', { value: formData.feedbackQ4, onChange: (ev) => handleFormChange('feedbackQ4', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ5), e('textarea', { value: formData.feedbackQ5, onChange: (ev) => handleFormChange('feedbackQ5', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ6), e('textarea', { value: formData.feedbackQ6, onChange: (ev) => handleFormChange('feedbackQ6', ev.target.value), className: 'w-full border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none', rows: 2 })),
                  e('div', null, e('label', { className: 'block text-sm font-medium text-slate-600 mb-1' }, t.feedbackQ7),
                    e('div', { className: 'flex items-center gap-4' },
                      e('input', { type: 'range', min: 1, max: 5, value: formData.feedbackQ7 || 3, onChange: (ev) => handleFormChange('feedbackQ7', parseInt(ev.target.value)), className: 'flex-1 accent-[#6EBD84]' }),
                      e('span', { className: 'text-lg font-bold text-slate-700 w-8 text-center' }, formData.feedbackQ7 || 3)
                    )
                  )
                )
              )
            );
          };

          const renderGuestWelcome = () => {
            if (!guestEmployee) return null;
            
            // Wenn Formular erfolgreich abgeschlossen wurde: Erfolgsseite anzeigen
            if (guestFormSubmitted) {
              return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4' },
                React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-lg w-full text-center' },
                  // Erfolgs-Icon
                  React.createElement('div', { className: 'w-24 h-24 rounded-full bg-[#E8F5ED] flex items-center justify-center mx-auto mb-6' },
                    React.createElement(CheckCircle2, { size: 48, className: 'text-[#6EBD84]' })
                  ),
                  
                  // Erfolgs-Titel
                  React.createElement('h2', { className: 'text-3xl font-bold text-slate-800 mb-3' },
                    lang === 'de' ? 'Vielen Dank!' : lang === 'it' ? 'Grazie!' : 'Thank you!'
                  ),
                  
                  // Erfolgs-Text
                  React.createElement('p', { className: 'text-lg text-slate-600 mb-6' },
                    lang === 'de' 
                      ? 'Ihre Selbstreflexion wurde erfolgreich an Ihre F√ºhrungskraft √ºbermittelt.'
                      : lang === 'it'
                      ? 'La tua autovalutazione √® stata inviata con successo al tuo responsabile.'
                      : 'Your self-reflection has been successfully submitted to your manager.'
                  ),
                  
                  // Info-Box
                  React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 text-left' },
                    React.createElement('div', { className: 'flex items-start gap-3' },
                      React.createElement(Info, { size: 20, className: 'text-blue-600 flex-shrink-0 mt-0.5' }),
                      React.createElement('div', { className: 'text-sm text-blue-800' },
                        React.createElement('p', { className: 'font-medium mb-1' },
                          lang === 'de' ? 'N√§chste Schritte:' : lang === 'it' ? 'Prossimi passi:' : 'Next steps:'
                        ),
                        React.createElement('p', null,
                          lang === 'de' 
                            ? 'Ihre F√ºhrungskraft wird Ihre Eingaben als Grundlage f√ºr das Jahresgespr√§ch verwenden. Sie werden zur Terminvereinbarung kontaktiert.'
                            : lang === 'it'
                            ? 'Il tuo responsabile utilizzer√† le tue risposte come base per il colloquio annuale. Sarai contattato/a per fissare un appuntamento.'
                            : 'Your manager will use your input as a basis for the annual review. You will be contacted to schedule a meeting.'
                        )
                      )
                    )
                  ),
                  
                  // Schlie√üen-Button
                  React.createElement('p', { className: 'text-sm text-slate-400' },
                    lang === 'de' 
                      ? 'Sie k√∂nnen dieses Fenster jetzt schlie√üen.'
                      : lang === 'it'
                      ? 'Puoi chiudere questa finestra.'
                      : 'You can close this window now.'
                  )
                )
              );
            }
            
            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4' },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-2xl w-full' },
                // Header mit Logo
                React.createElement('div', { className: 'text-center mb-8' },
                  React.createElement('h1', { className: 'text-2xl font-bold tracking-tight', style: { color: '#243186' } }, 'nƒ±ederwƒ±eser'),
                  React.createElement('p', { className: 'text-xs uppercase tracking-widest', style: { color: '#6EBD84' } }, 'Performance Manager')
                ),
                
                // Willkommens-Icon
                React.createElement('div', { className: 'w-24 h-24 rounded-full bg-[#E8F5ED] flex items-center justify-center mx-auto mb-6' },
                  React.createElement(Users, { size: 48, className: 'text-[#6EBD84]' })
                ),
                
                // Begr√º√üung
                React.createElement('div', { className: 'text-center mb-8' },
                  React.createElement('h2', { className: 'text-3xl font-bold text-slate-800 mb-3' },
                    lang === 'de' ? 'Willkommen, ' : 'Benvenuto/a, ',
                    guestEmployee.name, '!'
                  ),
                  
                  // Position Badge
                  React.createElement('div', { className: 'inline-flex items-center gap-2 bg-slate-100 px-4 py-2 rounded-full text-sm text-slate-600' },
                    React.createElement(Briefcase, { size: 16 }),
                    guestEmployee.position,
                    guestEmployee.department && React.createElement('span', { className: 'text-slate-400' }, ' ‚Ä¢ ', guestEmployee.department)
                  )
                ),
                
                // Haupttext mit Zeitangabe
                React.createElement('div', { className: 'bg-slate-50 rounded-xl p-6 mb-6 text-center' },
                  React.createElement('div', { className: 'flex items-center justify-center gap-2 text-slate-500 mb-3' },
                    React.createElement(Clock, { size: 20 }),
                    React.createElement('span', { className: 'font-medium' }, 
                      lang === 'de' ? 'ca. 15-20 Minuten' : 'ca. 15-20 minuti'
                    )
                  ),
                  React.createElement('p', { className: 'text-slate-700 text-lg' },
                    lang === 'de'
                      ? 'Bitte nehmen Sie sich Zeit f√ºr Ihre Selbstreflexion zur Vorbereitung auf das Jahresgespr√§ch mit Ihrer F√ºhrungskraft.'
                      : 'Per favore, prenditi del tempo per la tua autovalutazione in preparazione al colloquio annuale con il tuo responsabile.'
                  )
                ),
                
                // Info-Box: Was erwartet Sie?
                React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-5 mb-6' },
                  React.createElement('h4', { className: 'font-semibold text-blue-900 mb-3 flex items-center gap-2' },
                    React.createElement(Info, { size: 20 }),
                    lang === 'de' ? 'Was erwartet Sie?' : 'Cosa ti aspetta?'
                  ),
                  React.createElement('div', { className: 'grid md:grid-cols-2 gap-3' },
                    // Punkt 1
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '1')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Selbsteinsch√§tzung Ihrer 5 Kernkompetenzen' : 'Autovalutazione delle tue 5 competenze chiave'
                      )
                    ),
                    // Punkt 2
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '2')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Reflexion zu St√§rken & Entwicklungsfeldern' : 'Riflessione su punti di forza e aree di sviluppo'
                      )
                    ),
                    // Punkt 3
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '3')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Ihre W√ºnsche f√ºr das kommende Jahr' : 'I tuoi desideri per l\'anno prossimo'
                      )
                    ),
                    // Punkt 4
                    React.createElement('div', { className: 'flex items-start gap-3 text-sm text-blue-800' },
                      React.createElement('div', { className: 'w-6 h-6 rounded-full bg-blue-200 flex items-center justify-center flex-shrink-0 mt-0.5' },
                        React.createElement('span', { className: 'text-blue-700 font-bold text-xs' }, '4')
                      ),
                      React.createElement('span', null, 
                        lang === 'de' ? 'Feedback zur Zusammenarbeit' : 'Feedback sulla collaborazione'
                      )
                    )
                  )
                ),
                
                // Sprachauswahl
                React.createElement('div', { className: 'flex justify-center gap-2 mb-6' },
                  React.createElement('button', {
                    onClick: () => setLang('de'),
                    className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${lang === 'de' ? 'bg-[#243186] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`
                  }, 'üá©üá™ DE'),
                  React.createElement('button', {
                    onClick: () => setLang('it'),
                    className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${lang === 'it' ? 'bg-[#243186] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`
                  }, 'üáÆüáπ IT'),
                  React.createElement('button', {
                    onClick: () => setLang('en'),
                    className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${lang === 'en' ? 'bg-[#243186] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`
                  }, 'üá¨üáß EN')
                ),
                
                // Start Button ‚Üí navigiert zu guestForm
                React.createElement('button', {
                  onClick: () => setActiveView('guestForm'),
                  className: 'w-full bg-[#6EBD84] text-white py-4 rounded-xl font-semibold text-lg hover:bg-[#5da872] transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-3'
                },
                  React.createElement(Play, { size: 24 }),
                  lang === 'de' ? 'Selbstreflexion starten' : lang === 'it' ? 'Inizia autovalutazione' : 'Start Self-Reflection'
                ),
                
                // "Zur√ºck zur App" Button - NUR f√ºr eingeloggte User (nicht anonym)
                user && !user.isAnonymous && React.createElement('button', {
                  onClick: () => {
                    // Gast-Modus beenden und zur normalen App zur√ºckkehren
                    setGuestMode(false);
                    setGuestEmployee(null);
                    setGuestManagerId(null);
                    setActiveView('dashboard');
                    // URL bereinigen
                    window.history.replaceState({}, document.title, window.location.pathname);
                  },
                  className: 'w-full mt-3 bg-slate-100 text-slate-700 py-3 rounded-xl font-medium hover:bg-slate-200 transition-all flex items-center justify-center gap-2'
                },
                  React.createElement(ArrowLeft, { size: 18 }),
                  lang === 'de' ? 'Zur√ºck zur App' : lang === 'it' ? 'Torna all\'app' : 'Back to App'
                ),
                
                // Footer Hinweis
                React.createElement('p', { className: 'text-xs text-slate-400 mt-6 text-center' },
                  lang === 'de'
                    ? 'üîí Ihre Eingaben werden vertraulich behandelt und dienen der Vorbereitung auf das Gespr√§ch mit Ihrer F√ºhrungskraft.'
                    : 'üîí I tuoi dati saranno trattati in modo confidenziale e serviranno a preparare il colloquio con il tuo responsabile.'
                )
              )
            );
          };
          
          // === GUEST FORM RENDER FUNCTION (Vollst√§ndiges Selbstreflexions-Formular) ===
          const renderGuestForm = () => {
            if (!guestEmployee) return null;
            
            // States kommen jetzt von der Komponenten-Ebene (oben definiert):
            // guestFormData, setGuestFormData
            // guestCoreScores, setGuestCoreScores  
            // guestCoreComments, setGuestCoreComments
            // guestFormStep, setGuestFormStep
            // guestFormSaving, setGuestFormSaving
            // guestFormSubmitted, setGuestFormSubmitted
            // guestLastAutoSave, setGuestLastAutoSave
            // guestShowDraftRecovery, setGuestShowDraftRecovery
            // guestExistingAssessment, setGuestExistingAssessment
            // guestShowDuplicateWarning, setGuestShowDuplicateWarning
            
            // Aliase f√ºr Kompatibilit√§t mit bestehendem Code
            const selfCoreScores = guestCoreScores;
            const setSelfCoreScores = setGuestCoreScores;
            const selfCoreComments = guestCoreComments;
            const setSelfCoreComments = setGuestCoreComments;
            const currentStep = guestFormStep;
            const setCurrentStep = setGuestFormStep;
            const isSaving = guestFormSaving;
            const setIsSaving = setGuestFormSaving;
            const isSubmitted = guestFormSubmitted;
            const setIsSubmitted = setGuestFormSubmitted;
            const lastAutoSave = guestLastAutoSave;
            const setLastAutoSave = setGuestLastAutoSave;
            const showDraftRecovery = guestShowDraftRecovery;
            const setShowDraftRecovery = setGuestShowDraftRecovery;
            const existingAssessment = guestExistingAssessment;
            const setExistingAssessment = setGuestExistingAssessment;
            const showDuplicateWarning = guestShowDuplicateWarning;
            const setShowDuplicateWarning = setGuestShowDuplicateWarning;
            
            // Draft-ID f√ºr diesen Mitarbeiter
            const draftId = `guest_${guestEmployee.id}_${new Date().getFullYear()}`;
            
            // === Draft Recovery und Auto-Save wurden auf Komponenten-Ebene verschoben ===
            // Die useEffects sind jetzt au√üerhalb von renderGuestForm definiert
            
            // === Draft wiederherstellen Handler ===
            const handleRecoverDraft = () => {
              const draft = window._tempDraft;
              if (draft) {
                if (draft.guestFormData) setGuestFormData(draft.guestFormData);
                if (draft.selfCoreScores) setGuestCoreScores(draft.selfCoreScores);
                if (draft.selfCoreComments) setGuestCoreComments(draft.selfCoreComments);
                if (draft.currentStep) setGuestFormStep(draft.currentStep);
                console.log('‚úì Entwurf wiederhergestellt');
              }
              setShowDraftRecovery(false);
              delete window._tempDraft;
            };
            
            // === Draft verwerfen Handler ===
            const handleDiscardDraft = () => {
              DraftManager.deleteDraft(draftId);
              setShowDraftRecovery(false);
              delete window._tempDraft;
            };
            
            // Kompetenz-Daten aus APP_DATA
            const competencyData = APP_DATA[lang]?.competencies?.filter(c => c.category === 'core') || [];
            
            // BARS Labels
            const barsLabels = {
              de: {
                1: 'Erf√ºllt nicht',
                2: 'Verbesserungsbedarf', 
                3: 'Baseline',
                4: '√úbertrifft',
                5: 'Herausragend'
              },
              it: {
                1: 'Non soddisfa',
                2: 'Da migliorare',
                3: 'Baseline',
                4: 'Supera',
                5: 'Eccellente'
              },
              en: {
                1: 'Does Not Meet',
                2: 'Needs Improvement',
                3: 'Baseline',
                4: 'Exceeds',
                5: 'Outstanding'
              }
            };
            
            // Speichern-Handler MIT Duplikations-Pr√ºfung
            const handleGuestSave = async () => {
              if (!db || !guestEmployee) {
                alert(lang === 'de' ? 'Fehler: Keine Verbindung zur Datenbank.' : 'Errore: Nessuna connessione al database.');
                return;
              }
              
              setIsSaving(true);
              
              try {
                // === NEU: Duplikations-Pr√ºfung ===
                const currentPeriod = new Date().getFullYear().toString();
                const existingCheck = await checkExistingSelfAssessment(db, guestEmployee.id, currentPeriod);
                
                if (existingCheck.exists) {
                  const confirmOverwrite = confirm(
                    lang === 'de' 
                      ? `‚ö†Ô∏è Es existiert bereits eine Selbstreflexion f√ºr ${currentPeriod}.\n\nEingereicht am: ${new Date(existingCheck.data.submittedAt || existingCheck.data.createdAt).toLocaleDateString('de-DE')}\n\nM√∂chten Sie diese √ºberschreiben?`
                      : lang === 'it'
                      ? `‚ö†Ô∏è Esiste gi√† un'autovalutazione per ${currentPeriod}.\n\nInviata il: ${new Date(existingCheck.data.submittedAt || existingCheck.data.createdAt).toLocaleDateString('it-IT')}\n\nVuoi sovrascriverla?`
                      : `‚ö†Ô∏è A self-reflection already exists for ${currentPeriod}.\n\nSubmitted on: ${new Date(existingCheck.data.submittedAt || existingCheck.data.createdAt).toLocaleDateString('en-GB')}\n\nDo you want to overwrite it?`
                  );
                  
                  if (!confirmOverwrite) {
                    setIsSaving(false);
                    return;
                  }
                  
                  // L√∂sche alte Selbstreflexion
                  await db.collection('teamAppraisals').doc(existingCheck.docId).delete();
                  console.log('üóëÔ∏è Alte Selbstreflexion gel√∂scht:', existingCheck.docId);
                }
                
                const selfAssessmentId = 'self_' + guestEmployee.id + '_' + Date.now();
                
                const selfAssessmentData = {
                  id: selfAssessmentId,
                  type: 'self_assessment',
                  employeeId: guestEmployee.id,
                  employeeName: guestEmployee.name,
                  position: guestEmployee.position,
                  department: guestEmployee.department || '',
                  userId: guestEmployee.userId, // Manager's userId f√ºr Zugriff
                  period: new Date().getFullYear().toString(),
                  status: 'submitted_self',
                  isSelfAssessment: true,
                  
                  // Kompetenz-Selbsteinsch√§tzungen
                  selfCoreScores: selfCoreScores,
                  selfCoreComments: selfCoreComments,
                  
                  // Freitext-Felder
                  formData: {
                    strengths1: guestFormData.strengths1,
                    strengths2: guestFormData.strengths2,
                    wishesNextYear: guestFormData.wishesNextYear,
                    feedbackManager: guestFormData.feedbackManager,
                    additionalComments: guestFormData.additionalComments
                  },
                  
                  // Timestamps
                  createdAt: new Date().toISOString(),
                  submittedAt: new Date().toISOString()
                };
                
                // In Firestore speichern
                await db.collection('teamAppraisals').doc(selfAssessmentId).set(selfAssessmentData);
                
                console.log('‚úì Selbstreflexion gespeichert:', selfAssessmentId);
                
                // === NEU: Draft l√∂schen nach erfolgreichem Speichern ===
                DraftManager.deleteDraft(draftId);
                
                setIsSubmitted(true);
                
              } catch (error) {
                console.error('‚ùå Fehler beim Speichern:', error);
                alert(lang === 'de' 
                  ? 'Fehler beim Speichern. Bitte versuchen Sie es erneut.' 
                  : 'Errore durante il salvataggio. Riprova.');
              } finally {
                setIsSaving(false);
              }
            };
            
            // Success Screen nach dem Absenden
            if (isSubmitted) {
              return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4' },
                React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-lg w-full text-center' },
                  // Success Icon
                  React.createElement('div', { className: 'w-24 h-24 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-6' },
                    React.createElement(CheckCircle2, { size: 48, className: 'text-green-600' })
                  ),
                  
                  React.createElement('h2', { className: 'text-3xl font-bold text-slate-800 mb-4' },
                    lang === 'de' ? 'Vielen Dank!' : lang === 'it' ? 'Grazie mille!' : 'Thank you!'
                  ),
                  
                  React.createElement('p', { className: 'text-slate-600 text-lg mb-6' },
                    lang === 'de'
                      ? 'Ihre Selbstreflexion wurde erfolgreich √ºbermittelt.'
                      : lang === 'it'
                      ? 'La tua autovalutazione √® stata inviata con successo.'
                      : 'Your self-reflection has been submitted successfully.'
                  ),
                  
                  React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 text-left' },
                    React.createElement('h4', { className: 'font-semibold text-blue-900 mb-2 flex items-center gap-2' },
                      React.createElement(Info, { size: 18 }),
                      lang === 'de' ? 'N√§chste Schritte' : lang === 'it' ? 'Prossimi passi' : 'Next Steps'
                    ),
                    React.createElement('p', { className: 'text-sm text-blue-800' },
                      lang === 'de'
                        ? 'Ihre F√ºhrungskraft wird Ihre Eingaben sehen und diese als Grundlage f√ºr das gemeinsame Jahresgespr√§ch nutzen. Sie werden zeitnah kontaktiert, um einen Termin zu vereinbaren.'
                        : lang === 'it'
                        ? 'Il tuo responsabile vedr√† le tue risposte e le utilizzer√† come base per il colloquio annuale. Sarai contattato a breve per fissare un appuntamento.'
                        : 'Your manager will see your responses and use them as a basis for the annual review. You will be contacted shortly to schedule a meeting.'
                    )
                  ),
                  
                  // "Zur√ºck zur App" Button - NUR f√ºr eingeloggte User (nicht anonym)
                  user && !user.isAnonymous 
                    ? React.createElement('button', {
                        onClick: () => {
                          // Gast-Modus beenden und zur normalen App zur√ºckkehren
                          setGuestMode(false);
                          setGuestEmployee(null);
                          setGuestManagerId(null);
                          setActiveView('dashboard');
                          // URL bereinigen
                          window.history.replaceState({}, document.title, window.location.pathname);
                        },
                        className: 'w-full bg-[#6EBD84] text-white py-3 rounded-xl font-semibold hover:bg-[#5da872] transition-all flex items-center justify-center gap-2'
                      },
                        React.createElement(ArrowLeft, { size: 18 }),
                        lang === 'de' ? 'Zur√ºck zur App' : lang === 'it' ? 'Torna all\'app' : 'Back to App'
                      )
                    : React.createElement('p', { className: 'text-sm text-slate-500' },
                        lang === 'de'
                          ? 'Sie k√∂nnen dieses Fenster jetzt schlie√üen.'
                          : lang === 'it'
                          ? 'Puoi chiudere questa finestra.'
                          : 'You can close this window now.'
                      )
                )
              );
            }
            
            // Wizard Navigation
            const totalSteps = 4;
            const stepTitles = {
              de: ['Kompetenzen', 'St√§rken & Entwicklung', 'W√ºnsche & Feedback', 'Zusammenfassung'],
              it: ['Competenze', 'Punti di forza', 'Desideri & Feedback', 'Riepilogo'],
              en: ['Competencies', 'Strengths & Development', 'Wishes & Feedback', 'Summary']
            };
            
            // Kompetenz-Bewertungs-Komponente
            const renderCompetencyCard = (comp, index) => {
              const compId = `c${index + 1}`;
              const currentScore = selfCoreScores[compId] || 3;
              const currentComment = selfCoreComments[compId] || '';
              
              return React.createElement('div', { 
                key: compId,
                className: 'bg-white rounded-xl border border-slate-200 p-5 mb-4'
              },
                // Header
                React.createElement('div', { className: 'flex items-start gap-3 mb-4' },
                  React.createElement('div', { className: 'w-10 h-10 rounded-lg bg-[#E8F5ED] flex items-center justify-center flex-shrink-0' },
                    React.createElement(comp.icon || Briefcase, { size: 20, className: 'text-[#6EBD84]' })
                  ),
                  React.createElement('div', null,
                    React.createElement('h4', { className: 'font-bold text-slate-800' }, comp.title),
                    React.createElement('p', { className: 'text-sm text-slate-500 mt-1' }, comp.definition?.substring(0, 100) + '...')
                  )
                ),
                
                // BARS Score Auswahl
                React.createElement('div', { className: 'mb-4' },
                  React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-2' },
                    lang === 'de' ? 'Ihre Selbsteinsch√§tzung:' : lang === 'it' ? 'La tua autovalutazione:' : 'Your Self-Assessment:'
                  ),
                  React.createElement('div', { className: 'flex gap-2' },
                    [1, 2, 3, 4, 5].map(score => 
                      React.createElement('button', {
                        key: score,
                        onClick: () => setSelfCoreScores(prev => ({...prev, [compId]: score})),
                        className: `flex-1 py-3 px-2 rounded-lg border-2 transition-all text-center ${
                          currentScore === score 
                            ? score <= 2 ? 'border-red-500 bg-red-50 text-red-700' :
                              score === 3 ? 'border-green-500 bg-green-50 text-green-700' :
                              'border-blue-500 bg-blue-50 text-blue-700'
                            : 'border-slate-200 hover:border-slate-300 text-slate-600'
                        }`
                      },
                        React.createElement('div', { className: 'text-xl font-bold' }, score),
                        React.createElement('div', { className: 'text-xs mt-1 hidden sm:block' }, barsLabels[lang][score])
                      )
                    )
                  )
                ),
                
                // Kommentar-Feld
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-2' },
                    lang === 'de' ? 'Begr√ºndung / Beispiele (optional):' : lang === 'it' ? 'Motivazione / Esempi (opzionale):' : 'Reasoning / Examples (optional):'
                  ),
                  React.createElement('textarea', {
                    value: currentComment,
                    onChange: (e) => setSelfCoreComments(prev => ({...prev, [compId]: e.target.value})),
                    placeholder: lang === 'de' 
                      ? 'Beschreiben Sie konkrete Situationen, die Ihre Einsch√§tzung belegen...'
                      : 'Descrivi situazioni concrete che supportano la tua valutazione...',
                    className: 'w-full border border-slate-300 rounded-lg px-4 py-3 text-sm resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                    rows: 3
                  })
                )
              );
            };
            
            // Step 1: Kompetenzen
            const renderStep1 = () => React.createElement('div', { className: 'space-y-4' },
              React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6' },
                React.createElement('p', { className: 'text-sm text-blue-800' },
                  lang === 'de'
                    ? 'Bitte sch√§tzen Sie sich selbst in den folgenden 5 Kernkompetenzen ein. Nutzen Sie die Skala von 1 (Erf√ºllt nicht) bis 5 (Herausragend). Level 3 entspricht der erwarteten Baseline.'
                    : 'Per favore, valuta te stesso nelle seguenti 5 competenze chiave. Usa la scala da 1 (Non soddisfa) a 5 (Eccellente). Il livello 3 corrisponde alla baseline attesa.'
                )
              ),
              competencyData.map((comp, idx) => renderCompetencyCard(comp, idx))
            );
            
            // Step 2: St√§rken & Entwicklung
            const renderStep2 = () => React.createElement('div', { className: 'space-y-6' },
              // St√§rken
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(Award, { size: 20, className: 'text-[#6EBD84]' }),
                  lang === 'de' ? 'Meine gr√∂√üten St√§rken' : lang === 'it' ? 'I miei punti di forza' : 'My Greatest Strengths'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Was k√∂nnen Sie besonders gut? Worauf sind Sie stolz?'
                    : 'In cosa sei particolarmente bravo? Di cosa sei orgoglioso?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.strengths1,
                  onChange: (e) => setGuestFormData(prev => ({...prev, strengths1: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Beschreiben Sie 2-3 St√§rken mit konkreten Beispielen...'
                    : 'Descrivi 2-3 punti di forza con esempi concreti...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 5
                })
              ),
              
              // Entwicklungsfelder
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(TrendingUp, { size: 20, className: 'text-amber-500' }),
                  lang === 'de' ? 'Meine Entwicklungsfelder' : lang === 'it' ? 'Le mie aree di sviluppo' : 'My Development Areas'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Wo sehen Sie Verbesserungspotenzial? Was m√∂chten Sie lernen?'
                    : 'Dove vedi potenziale di miglioramento? Cosa vorresti imparare?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.strengths2,
                  onChange: (e) => setGuestFormData(prev => ({...prev, strengths2: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Beschreiben Sie 1-2 Bereiche, in denen Sie sich entwickeln m√∂chten...'
                    : 'Descrivi 1-2 aree in cui vorresti svilupparti...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 5
                })
              )
            );
            
            // Step 3: W√ºnsche & Feedback
            const renderStep3 = () => React.createElement('div', { className: 'space-y-6' },
              // W√ºnsche f√ºr das kommende Jahr
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(Target, { size: 20, className: 'text-purple-500' }),
                  lang === 'de' ? 'Meine W√ºnsche f√ºr das kommende Jahr' : lang === 'it' ? 'I miei desideri per l\'anno prossimo' : 'My wishes for the coming year'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Welche Projekte, Aufgaben oder Entwicklungsm√∂glichkeiten w√ºnschen Sie sich?'
                    : 'Quali progetti, compiti o opportunit√† di sviluppo desideri?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.wishesNextYear,
                  onChange: (e) => setGuestFormData(prev => ({...prev, wishesNextYear: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'z.B. neue Verantwortungsbereiche, Weiterbildungen, Projektteilnahme...'
                    : 'es. nuove responsabilit√†, formazione, partecipazione a progetti...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 4
                })
              ),
              
              // Feedback an die FK
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(MessageCircle, { size: 20, className: 'text-blue-500' }),
                  lang === 'de' ? 'Feedback an meine F√ºhrungskraft' : lang === 'it' ? 'Feedback al mio responsabile' : 'Feedback to My Manager'
                ),
                React.createElement('p', { className: 'text-sm text-slate-500 mb-3' },
                  lang === 'de'
                    ? 'Was l√§uft gut in der Zusammenarbeit? Was k√∂nnte verbessert werden?'
                    : 'Cosa funziona bene nella collaborazione? Cosa potrebbe essere migliorato?'
                ),
                React.createElement('textarea', {
                  value: guestFormData.feedbackManager,
                  onChange: (e) => setGuestFormData(prev => ({...prev, feedbackManager: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Konstruktives Feedback zur Zusammenarbeit...'
                    : 'Feedback costruttivo sulla collaborazione...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 4
                })
              ),
              
              // Sonstige Anmerkungen
              React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                React.createElement('label', { className: 'block font-semibold text-slate-800 mb-2 flex items-center gap-2' },
                  React.createElement(FileText, { size: 20, className: 'text-slate-500' }),
                  lang === 'de' ? 'Sonstige Anmerkungen (optional)' : lang === 'it' ? 'Altre osservazioni (opzionale)' : 'Additional Comments (optional)'
                ),
                React.createElement('textarea', {
                  value: guestFormData.additionalComments,
                  onChange: (e) => setGuestFormData(prev => ({...prev, additionalComments: e.target.value})),
                  placeholder: lang === 'de' 
                    ? 'Weitere Themen, die Sie besprechen m√∂chten...'
                    : 'Altri argomenti che vorresti discutere...',
                  className: 'w-full border border-slate-300 rounded-lg px-4 py-3 resize-none focus:ring-2 focus:ring-[#6EBD84] focus:border-[#6EBD84] outline-none',
                  rows: 3
                })
              )
            );
            
            // Step 4: Zusammenfassung
            const renderStep4 = () => {
              // Durchschnittliche Selbsteinsch√§tzung berechnen
              const avgScore = Object.values(selfCoreScores).reduce((a, b) => a + b, 0) / 5;
              
              return React.createElement('div', { className: 'space-y-6' },
                // Info-Box
                React.createElement('div', { className: 'bg-amber-50 border border-amber-200 rounded-xl p-4' },
                  React.createElement('p', { className: 'text-sm text-amber-800 flex items-start gap-2' },
                    React.createElement(AlertCircle, { size: 18, className: 'flex-shrink-0 mt-0.5' }),
                    lang === 'de'
                      ? 'Bitte pr√ºfen Sie Ihre Angaben. Nach dem Absenden k√∂nnen Sie diese nicht mehr √§ndern.'
                      : 'Per favore, controlla i tuoi dati. Dopo l\'invio non potrai pi√π modificarli.'
                  )
                ),
                
                // Kompetenz-Zusammenfassung
                React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                  React.createElement('h4', { className: 'font-semibold text-slate-800 mb-4 flex items-center gap-2' },
                    React.createElement(Award, { size: 20, className: 'text-[#6EBD84]' }),
                    lang === 'de' ? 'Kompetenz-Selbsteinsch√§tzung' : lang === 'it' ? 'Autovalutazione competenze' : 'Competency Self-Assessment'
                  ),
                  React.createElement('div', { className: 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 mb-4' },
                    competencyData.map((comp, idx) => {
                      const compId = `c${idx + 1}`;
                      const score = selfCoreScores[compId];
                      return React.createElement('div', { 
                        key: compId,
                        className: 'text-center p-3 bg-slate-50 rounded-lg'
                      },
                        React.createElement('div', { 
                          className: `text-2xl font-bold ${
                            score <= 2 ? 'text-red-600' : score === 3 ? 'text-green-600' : 'text-blue-600'
                          }`
                        }, score),
                        React.createElement('div', { className: 'text-xs text-slate-500 mt-1 truncate' }, comp.title?.split(' ')[0])
                      );
                    })
                  ),
                  React.createElement('div', { className: 'flex items-center justify-between bg-slate-100 rounded-lg p-3' },
                    React.createElement('span', { className: 'text-sm text-slate-600' },
                      lang === 'de' ? 'Durchschnitt:' : lang === 'it' ? 'Media:' : 'Average:'
                    ),
                    React.createElement('span', { className: 'text-xl font-bold text-[#243186]' }, avgScore.toFixed(2))
                  )
                ),
                
                // Freitext-Zusammenfassung
                React.createElement('div', { className: 'bg-white rounded-xl border border-slate-200 p-5' },
                  React.createElement('h4', { className: 'font-semibold text-slate-800 mb-4' },
                    lang === 'de' ? 'Ihre Eingaben' : lang === 'it' ? 'Le tue risposte' : 'Your Responses'
                  ),
                  React.createElement('div', { className: 'space-y-4 text-sm' },
                    guestFormData.strengths1 && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'St√§rken:' : lang === 'it' ? 'Punti di forza:' : 'Strengths:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.strengths1)
                    ),
                    guestFormData.strengths2 && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'Entwicklungsfelder:' : lang === 'it' ? 'Aree di sviluppo:' : 'Development Areas:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.strengths2)
                    ),
                    guestFormData.wishesNextYear && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'W√ºnsche:' : lang === 'it' ? 'Desideri:' : 'Wishes:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.wishesNextYear)
                    ),
                    guestFormData.feedbackManager && React.createElement('div', null,
                      React.createElement('p', { className: 'font-medium text-slate-700' }, lang === 'de' ? 'Feedback an FK:' : lang === 'it' ? 'Feedback al responsabile:' : 'Feedback to Manager:'),
                      React.createElement('p', { className: 'text-slate-600 mt-1 bg-slate-50 p-2 rounded' }, guestFormData.feedbackManager)
                    )
                  )
                )
              );
            };
            
            // Haupt-Render
            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4 pb-24' },
              React.createElement('div', { className: 'max-w-2xl mx-auto' },
              
                // === NEU: Draft Recovery Banner ===
                showDraftRecovery && React.createElement('div', { 
                  className: 'bg-blue-50 border-2 border-blue-300 rounded-xl p-4 mb-4 animate-in'
                },
                  React.createElement('div', { className: 'flex items-start justify-between' },
                    React.createElement('div', { className: 'flex items-center gap-3' },
                      React.createElement('div', { className: 'text-2xl' }, 'üíæ'),
                      React.createElement('div', null,
                        React.createElement('p', { className: 'font-bold text-blue-800' },
                          lang === 'de' ? 'Ungespeicherter Entwurf gefunden!' : lang === 'it' ? 'Bozza non salvata trovata!' : 'Unsaved draft found!'
                        ),
                        React.createElement('p', { className: 'text-sm text-blue-600' },
                          lang === 'de' 
                            ? 'Sie haben einen nicht abgeschlossenen Entwurf. M√∂chten Sie fortfahren?' 
                            : lang === 'it'
                            ? 'Hai una bozza non completata. Vuoi continuare?'
                            : 'You have an incomplete draft. Do you want to continue?'
                        )
                      )
                    ),
                    React.createElement('button', {
                      onClick: handleDiscardDraft,
                      className: 'text-blue-400 hover:text-blue-600'
                    }, React.createElement(X, { size: 18 }))
                  ),
                  React.createElement('div', { className: 'flex gap-2 mt-3' },
                    React.createElement('button', {
                      onClick: handleRecoverDraft,
                      className: 'flex-1 bg-blue-600 text-white py-2 rounded-2xl font-semibold hover:bg-blue-700 transition-colors'
                    }, lang === 'de' ? '‚úì Wiederherstellen' : lang === 'it' ? '‚úì Ripristina' : '‚úì Recover'),
                    React.createElement('button', {
                      onClick: handleDiscardDraft,
                      className: 'flex-1 bg-slate-200 text-slate-700 py-2 rounded-2xl font-semibold hover:bg-slate-300 transition-colors'
                    }, lang === 'de' ? 'Neu starten' : lang === 'it' ? 'Ricomincia' : 'Start fresh')
                  )
                ),
                
                // === NEU: Duplicate Warning Banner ===
                showDuplicateWarning && existingAssessment && React.createElement('div', { 
                  className: 'bg-amber-50 border-2 border-amber-300 rounded-xl p-4 mb-4'
                },
                  React.createElement('div', { className: 'flex items-start gap-3' },
                    React.createElement('div', { className: 'text-2xl' }, '‚ö†Ô∏è'),
                    React.createElement('div', { className: 'flex-1' },
                      React.createElement('p', { className: 'font-bold text-amber-800' },
                        lang === 'de' ? 'Bereits eingereicht!' : lang === 'it' ? 'Gi√† inviata!' : 'Already submitted!'
                      ),
                      React.createElement('p', { className: 'text-sm text-amber-700' },
                        lang === 'de' 
                          ? `Sie haben bereits am ${new Date(existingAssessment.data?.submittedAt || existingAssessment.data?.createdAt).toLocaleDateString('de-DE')} eine Selbstreflexion eingereicht.` 
                          : lang === 'it'
                          ? `Hai gi√† inviato un'autovalutazione il ${new Date(existingAssessment.data?.submittedAt || existingAssessment.data?.createdAt).toLocaleDateString('it-IT')}.`
                          : `You already submitted a self-reflection on ${new Date(existingAssessment.data?.submittedAt || existingAssessment.data?.createdAt).toLocaleDateString('en-GB')}.`
                      ),
                      React.createElement('p', { className: 'text-xs text-amber-600 mt-1' },
                        lang === 'de' 
                          ? 'Eine neue Eingabe wird die vorherige √ºberschreiben.' 
                          : lang === 'it'
                          ? 'Un nuovo invio sovrascriver√† il precedente.'
                          : 'A new submission will overwrite the previous one.'
                      )
                    ),
                    React.createElement('button', {
                      onClick: () => setShowDuplicateWarning(false),
                      className: 'text-amber-400 hover:text-amber-600'
                    }, React.createElement(X, { size: 18 }))
                  )
                ),
              
                // Header (sticky)
                React.createElement('div', { className: 'bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 p-4 mb-6 sticky top-4 z-10' },
                  // Obere Zeile: Logo, Skip-Button, User-Info
                  React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                    // Links: Logo
                    React.createElement('div', null,
                      React.createElement('h1', { className: 'text-xl font-bold', style: { color: '#243186' } }, 'nƒ±ederwƒ±eser'),
                      React.createElement('p', { className: 'text-xs uppercase tracking-widest', style: { color: '#6EBD84' } }, 
                        lang === 'de' ? 'Selbstreflexion' : lang === 'it' ? 'Autovalutazione' : 'Self-Reflection'
                      ),
                      // === NEU: Auto-Save Indikator ===
                      lastAutoSave && React.createElement('p', { className: 'text-xs text-slate-400 mt-1' },
                        'üíæ ', DraftManager.formatSavedTime(lastAutoSave, lang)
                      )
                    ),
                    
                    // Mitte: Skip-Button MIT VALIDIERUNG (nur wenn nicht auf Schritt 4)
                    currentStep < 4 && React.createElement('button', {
                      onClick: () => {
                        // === NEU: Validierungs-Warnung beim Skip ===
                        const hasContent = Object.values(selfCoreScores).some(v => v !== 3) || 
                                          guestFormData.strengths1 || guestFormData.strengths2;
                        if (!hasContent) {
                          const proceed = confirm(
                            lang === 'de' 
                              ? 'Sie haben noch keine Kompetenzen bewertet oder St√§rken/Entwicklungsfelder eingetragen. Trotzdem zum Absenden springen?'
                              : lang === 'it'
                              ? 'Non hai ancora valutato le competenze o inserito punti di forza/aree di sviluppo. Procedere comunque all\'invio?'
                              : 'You have not yet rated competencies or entered strengths/development areas. Skip to submit anyway?'
                          );
                          if (!proceed) return;
                        }
                        setCurrentStep(4);
                      },
                      className: 'hidden sm:flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors'
                    },
                      React.createElement(ChevronRight, { size: 16 }),
                      lang === 'de' ? 'Zum Absenden' : lang === 'it' ? 'Vai all\'invio' : 'Skip to Submit'
                    ),
                    
                    // Rechts: User-Info
                    React.createElement('div', { className: 'text-right' },
                      React.createElement('p', { className: 'font-medium text-slate-800' }, guestEmployee.name),
                      React.createElement('p', { className: 'text-sm text-slate-500' }, guestEmployee.position)
                    )
                  ),
                  
                  // Mobile: Skip-Button unter der Kopfzeile (nur wenn nicht auf Schritt 4)
                  currentStep < 4 && React.createElement('div', { className: 'sm:hidden mb-4' },
                    React.createElement('button', {
                      onClick: () => setCurrentStep(4),
                      className: 'w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors'
                    },
                      React.createElement(ChevronRight, { size: 16 }),
                      lang === 'de' ? 'Direkt zum Absenden springen' : lang === 'it' ? 'Vai direttamente all\'invio' : 'Skip to Submit'
                    )
                  ),
                  
                  // Progress Bar
                  React.createElement('div', { className: 'flex items-center gap-2' },
                    [1, 2, 3, 4].map(step => 
                      React.createElement('div', { 
                        key: step,
                        className: 'flex-1'
                      },
                        React.createElement('div', { 
                          className: `h-2 rounded-full transition-all ${
                            step < currentStep ? 'bg-[#6EBD84]' :
                            step === currentStep ? 'bg-[#243186]' : 'bg-slate-200'
                          }`
                        }),
                        React.createElement('p', { className: `text-xs mt-1 text-center ${step === currentStep ? 'text-[#243186] font-medium' : 'text-slate-400'}` },
                          stepTitles[lang][step - 1]
                        )
                      )
                    )
                  )
                ),
                
                // Step Content
                React.createElement('div', { className: 'mb-6' },
                  currentStep === 1 && renderStep1(),
                  currentStep === 2 && renderStep2(),
                  currentStep === 3 && renderStep3(),
                  currentStep === 4 && renderStep4()
                ),
                
                // Navigation Buttons (Fixed am unteren Rand)
                React.createElement('div', { className: 'fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-4' },
                  React.createElement('div', { className: 'max-w-2xl mx-auto flex gap-3' },
                    // Zur√ºck Button
                    currentStep > 1 && React.createElement('button', {
                      onClick: () => setCurrentStep(prev => prev - 1),
                      className: 'flex-1 py-3 px-6 border border-slate-300 text-slate-700 rounded-xl font-medium hover:bg-slate-50 transition-colors'
                    }, lang === 'de' ? '‚Üê Zur√ºck' : lang === 'it' ? '‚Üê Indietro' : '‚Üê Back'),
                    
                    // Weiter / Absenden Button
                    currentStep < totalSteps 
                      ? React.createElement('button', {
                          onClick: () => setCurrentStep(prev => prev + 1),
                          className: 'flex-1 py-3 px-6 bg-[#6EBD84] text-white rounded-xl font-medium hover:bg-[#5da872] transition-colors'
                        }, lang === 'de' ? 'Weiter ‚Üí' : lang === 'it' ? 'Avanti ‚Üí' : 'Next ‚Üí')
                      : React.createElement('button', {
                          onClick: handleGuestSave,
                          disabled: isSaving,
                          className: 'flex-1 py-3 px-6 bg-[#243186] text-white rounded-xl font-medium hover:bg-[#1a2563] transition-colors disabled:opacity-50 flex items-center justify-center gap-2'
                        }, 
                          isSaving && React.createElement(Loader2, { size: 20, className: 'animate-spin' }),
                          isSaving 
                            ? (lang === 'de' ? 'Wird gesendet...' : lang === 'it' ? 'Invio in corso...' : 'Sending...')
                            : (lang === 'de' ? '‚úì Absenden' : lang === 'it' ? '‚úì Invia' : '‚úì Submit')
                        )
                  )
                )
              )
            );
          };

          // === VIEW SELF ASSESSMENT (Manager sieht eingereichte Selbstreflexion) ===
          const renderViewSelfAssessment = () => {
            // Lade Daten aus localStorage (mit sicherem Zugriff)
            const selfData = safeLocalStorage.getItem('nw_view_self_assessment', null);
            if (!selfData) {
              return React.createElement('div', { className: 'text-center py-12' },
                React.createElement('p', { className: 'text-slate-500' }, 
                  lang === 'de' ? 'Keine Selbstreflexion ausgew√§hlt.' : lang === 'it' ? 'Nessuna autovalutazione selezionata.' : 'No self-reflection selected.'
                ),
                React.createElement('button', {
                  onClick: () => setActiveView('teamoverview'),
                  className: 'mt-4 px-4 py-2 bg-slate-100 rounded-2xl hover:bg-slate-200'
                }, lang === 'de' ? '‚Üê Zur√ºck' : lang === 'it' ? '‚Üê Indietro' : '‚Üê Back')
              );
            }
            
            const e = React.createElement;
            
            // BARS Labels
            const barsLabels = {
              de: { 1: 'Erf√ºllt nicht', 2: 'Verbesserungsbedarf', 3: 'Baseline', 4: '√úbertrifft', 5: 'Herausragend' },
              it: { 1: 'Non soddisfa', 2: 'Da migliorare', 3: 'Baseline', 4: 'Supera', 5: 'Eccellente' },
              en: { 1: 'Does Not Meet', 2: 'Needs Improvement', 3: 'Baseline', 4: 'Exceeds', 5: 'Outstanding' }
            };
            
            // Kompetenz-Namen aus DEFAULTS holen
            const defs = DEFAULTS[lang] || DEFAULTS['de'];
            
            // Scores extrahieren
            const coreScores = selfData.selfCoreScores || {};
            const coreComments = selfData.selfCoreComments || {};
            const leaderScores = selfData.selfLeaderScores || {};
            const leaderComments = selfData.selfLeaderComments || {};
            const goals = selfData.goals || [];
            const formData = selfData.formData || {};
            const careerChecks = selfData.careerChecks || [false, false, false, false, false];
            const isManager = selfData.isManager || false;
            const noGoalsMode = selfData.noGoalsMode || goals.length === 0;
            
            // Score-Farbe
            const getScoreColor = (score) => {
              if (score <= 1) return { bg: 'bg-red-500', text: 'text-red-700', light: 'bg-red-100' };
              if (score <= 2) return { bg: 'bg-orange-500', text: 'text-orange-700', light: 'bg-orange-100' };
              if (score <= 3) return { bg: 'bg-[#243186]', text: 'text-[#243186]', light: 'bg-blue-100' };
              if (score <= 4) return { bg: 'bg-[#6EBD84]', text: 'text-green-700', light: 'bg-green-100' };
              return { bg: 'bg-[#6EBD84]', text: 'text-green-700', light: 'bg-green-100' };
            };
            
            // GPS berechnen
            // BARS-Umrechnung: Zielerreichung % ‚Üí BARS-Stufe (1-5)
            const percentToBARS = (percent) => {
              if (percent >= 130) return 5;  // Herausragend (>130%)
              if (percent >= 111) return 4;  // √úbertroffen (111-130%)
              if (percent >= 90) return 3;   // Baseline (90-110%)
              if (percent >= 70) return 2;   // Teilweise (70-89%)
              return 1;                       // Nicht erreicht (<70%)
            };
            
            const calcGPS = () => {
              // WAS (Ziele) - achievement kann Prozent (0-100+) oder 1-5 Skala sein
              let wasScore = 0;
              let wasScorePercent = 0; // F√ºr Anzeige
              if (!noGoalsMode && goals.length > 0) {
                const totalWeight = goals.reduce((sum, g) => sum + (g.weight || 0), 0);
                if (totalWeight > 0) {
                  // Pr√ºfe ob achievement in Prozent oder 1-5 Skala ist
                  const firstAchievement = goals[0]?.achievement || 0;
                  const isPercent = firstAchievement > 5;
                  
                  if (isPercent) {
                    // Achievement ist in Prozent (0-100+)
                    // Erst gewichteten Durchschnitt der Prozente berechnen
                    wasScorePercent = goals.reduce((sum, g) => sum + ((g.achievement || 0) * (g.weight || 0)), 0) / totalWeight;
                    // Dann mit BARS-Tabelle in 1-5 Skala umrechnen
                    wasScore = percentToBARS(wasScorePercent);
                  } else {
                    // Achievement ist bereits auf 1-5 Skala
                    wasScore = goals.reduce((sum, g) => sum + ((g.achievement || 0) * (g.weight || 0)), 0) / totalWeight;
                    wasScorePercent = wasScore / 5 * 100;
                  }
                }
              }
              
              // WIE Core
              const coreValues = Object.values(coreScores).filter(v => v > 0);
              const wieCoreScore = coreValues.length > 0 ? coreValues.reduce((a, b) => a + b, 0) / coreValues.length : 0;
              
              // WIE Leader
              const leaderValues = Object.values(leaderScores).filter(v => v > 0);
              const wieLeadScore = leaderValues.length > 0 ? leaderValues.reduce((a, b) => a + b, 0) / leaderValues.length : 0;
              
              // Final GPS (alle Werte auf 5er-Skala)
              let finalGPS;
              if (noGoalsMode || goals.length === 0) {
                if (isManager && leaderValues.length > 0) {
                  finalGPS = (wieCoreScore * 0.5) + (wieLeadScore * 0.5);
                } else {
                  finalGPS = wieCoreScore;
                }
              } else {
                if (isManager && leaderValues.length > 0) {
                  finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.25) + (wieLeadScore * 0.25);
                } else {
                  finalGPS = (wasScore * 0.5) + (wieCoreScore * 0.5);
                }
              }
              
              return { wasScore, wasScorePercent, wieCoreScore, wieLeadScore, finalGPS };
            };
            
            const gps = calcGPS();
            
            // Karriere-Labels
            const careerLabels = {
              de: ['Zufrieden mit aktueller Position', 'Strebe Fachkarriere an', 'Strebe F√ºhrungskarriere an', 'Offen f√ºr Abteilungswechsel', 'Offen f√ºr Standortwechsel'],
              it: ['Soddisfatto/a della posizione attuale', 'Aspiro a carriera tecnica', 'Aspiro a carriera manageriale', 'Aperto/a a cambio reparto', 'Aperto/a a cambio sede'],
              en: ['Satisfied with current position', 'Seeking technical career', 'Seeking management career', 'Open to department change', 'Open to location change']
            };
            
            return e('div', { className: 'space-y-6 pb-10 max-w-5xl mx-auto' },
              // === HEADER ===
              e('div', { className: 'bg-gradient-to-r from-teal-500 to-teal-600 rounded-2xl p-6 text-white shadow-lg' },
                e('div', { className: 'flex items-center justify-between flex-wrap gap-4' },
                  e('div', null,
                    e('div', { className: 'flex items-center gap-3 mb-2' },
                      e('div', { className: 'bg-white/20 p-3 rounded-full' },
                        e(Users, { size: 28 })
                      ),
                      e('div', null,
                        e('p', { className: 'text-teal-100 text-sm' },
                          lang === 'de' ? 'Selbstreflexion von' : lang === 'it' ? 'Autovalutazione di' : 'Self-Reflection from'
                        ),
                        e('h1', { className: 'text-2xl md:text-3xl font-bold' },
                          selfData.employeeName || selfData.formData?.employee || 'Mitarbeiter'
                        )
                      )
                    ),
                    e('div', { className: 'flex items-center gap-4 mt-3 text-sm text-teal-100 flex-wrap' },
                      e('span', { className: 'flex items-center gap-1' },
                        e(Briefcase, { size: 14 }),
                        selfData.position || selfData.formData?.position || '‚Äì'
                      ),
                      selfData.department && e('span', { className: 'flex items-center gap-1' },
                        e(Building2, { size: 14 }),
                        selfData.department
                      ),
                      isManager && e('span', { className: 'bg-white/20 px-2 py-0.5 rounded text-xs' }, 'üëî ' + (lang === 'de' ? 'F√ºhrungskraft' : 'Manager')),
                      e('span', { className: 'flex items-center gap-1' },
                        e(Calendar, { size: 14 }),
                        selfData.period || new Date().getFullYear()
                      )
                    )
                  ),
                  // Pr√ºfe ob R√ºckkehr-Kontext existiert (kam vom AppraisalForm)
                  (() => {
                    const returnContext = safeLocalStorage.getItem('nw_return_to_appraisal', null);
                    const hasReturnContext = returnContext && (Date.now() - returnContext.timestamp) < 3600000; // Max 1 Stunde
                    
                    if (hasReturnContext) {
                      return e('div', { className: 'flex gap-2' },
                        // Zur√ºck zur Beurteilung (prominent)
                        e('button', {
                          onClick: () => {
                            localStorage.removeItem('nw_view_self_assessment');
                            // Starte AppraisalForm mit dem gespeicherten Mitarbeiter
                            const employeeId = returnContext.employeeId;
                            const period = returnContext.period;
                            
                            // Finde den Mitarbeiter und starte das Formular
                            const member = teamMembers.find(m => m.id === employeeId);
                            if (member) {
                              const existingReview = teamAppraisals.find(a => 
                                a.employeeId === employeeId && 
                                a.period === period && 
                                (a.type === 'review' || !a.type)
                              );
                              startTeamAppraisal(employeeId, period, existingReview);
                            }
                            localStorage.removeItem('nw_return_to_appraisal');
                          },
                          className: 'px-4 py-2 bg-[#6EBD84] hover:bg-[#5da872] rounded-lg text-sm font-bold flex items-center gap-2 transition-colors text-white'
                        }, 
                          e(ArrowLeft, { size: 16 }),
                          lang === 'de' ? '‚Üê Zur√ºck zur Beurteilung' : lang === 'it' ? '‚Üê Torna alla valutazione' : '‚Üê Back to Appraisal'
                        ),
                        // Zur √úbersicht (sekund√§r)
                        e('button', {
                          onClick: () => {
                            localStorage.removeItem('nw_view_self_assessment');
                            localStorage.removeItem('nw_return_to_appraisal');
                            setActiveView('teamoverview');
                          },
                          className: 'px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors'
                        }, 
                          lang === 'de' ? 'Zur √úbersicht' : lang === 'it' ? 'Alla panoramica' : 'To Overview'
                        )
                      );
                    } else {
                      // Normaler Zur√ºck-Button
                      return e('button', {
                        onClick: () => {
                          localStorage.removeItem('nw_view_self_assessment');
                          localStorage.removeItem('nw_return_to_appraisal');
                          setActiveView('teamoverview');
                        },
                        className: 'px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors'
                      }, 
                        e(ArrowLeft, { size: 16 }),
                        lang === 'de' ? 'Zur√ºck' : lang === 'it' ? 'Indietro' : 'Back'
                      );
                    }
                  })()
                )
              ),
              
              // === GPS √úBERSICHT ===
              e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(Calculator, { size: 20, className: 'text-[#243186]' }),
                  lang === 'de' ? 'GPS-Vorschau (Selbsteinsch√§tzung)' : 'GPS Preview (Self-Assessment)'
                ),
                e('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
                  // WAS - zeige Prozent UND 5er-Skala
                  !noGoalsMode && e('div', { className: 'bg-blue-50 rounded-xl p-4 text-center' },
                    e('p', { className: 'text-xs text-blue-600 mb-1' }, 'WAS (50%)'),
                    e('p', { className: 'text-2xl font-bold text-[#243186]' }, gps.wasScore.toFixed(2)),
                    e('p', { className: 'text-xs text-blue-400' }, '(' + gps.wasScorePercent.toFixed(0) + '%)')
                  ),
                  // WIE Core
                  e('div', { className: 'bg-green-50 rounded-xl p-4 text-center' },
                    e('p', { className: 'text-xs text-green-600 mb-1' }, noGoalsMode ? 'WIE Kern (100%)' : isManager ? 'WIE Kern (25%)' : 'WIE Kern (50%)'),
                    e('p', { className: 'text-2xl font-bold text-green-700' }, gps.wieCoreScore.toFixed(2))
                  ),
                  // WIE Lead (nur wenn Manager)
                  isManager && e('div', { className: 'bg-purple-50 rounded-xl p-4 text-center' },
                    e('p', { className: 'text-xs text-purple-600 mb-1' }, noGoalsMode ? 'WIE F√ºhrung (50%)' : 'WIE F√ºhrung (25%)'),
                    e('p', { className: 'text-2xl font-bold text-purple-700' }, gps.wieLeadScore.toFixed(2))
                  ),
                  // Final GPS
                  e('div', { className: 'bg-[#243186] rounded-xl p-4 text-center text-white' },
                    e('p', { className: 'text-xs opacity-80 mb-1' }, 'GPS'),
                    e('p', { className: 'text-3xl font-bold' }, gps.finalGPS.toFixed(2))
                  )
                )
              ),
              
              // === ZIELE (Teil B) ===
              !noGoalsMode && goals.length > 0 && e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(Target, { size: 20, className: 'text-[#6EBD84]' }),
                  lang === 'de' ? 'Teil B: Zielvereinbarungen' : 'Part B: Goals'
                ),
                e('div', { className: 'space-y-3' },
                  goals.map((g, idx) => {
                    // achievement kann entweder Prozent (0-100+) oder 1-5 Skala sein
                    // Wenn > 5, ist es Prozent
                    const isPercent = g.achievement > 5;
                    // BARS-Stufe berechnen wenn Prozent
                    const barsScore = isPercent ? percentToBARS(g.achievement) : g.achievement;
                    const displayValue = isPercent ? g.achievement + '% ‚Üí ' + barsScore : g.achievement + '/5';
                    const barWidth = isPercent ? Math.min(g.achievement, 130) / 1.3 : (g.achievement / 5) * 100;
                    
                    return e('div', { key: idx, className: 'border border-slate-200 rounded-lg p-4' },
                      e('div', { className: 'flex justify-between items-start mb-2' },
                        e('div', { className: 'flex-1' },
                          e('p', { className: 'font-medium text-slate-800' }, g.name || `Ziel ${idx + 1}`),
                          e('p', { className: 'text-xs text-slate-500' }, `${lang === 'de' ? 'Gewichtung' : 'Peso'}: ${g.weight}%`)
                        ),
                        e('div', { className: `px-3 py-1 rounded-full text-sm font-bold ${getScoreColor(barsScore).light} ${getScoreColor(barsScore).text}` },
                          displayValue
                        )
                      ),
                      // Visueller Balken
                      e('div', { className: 'h-2 bg-slate-100 rounded-full overflow-hidden' },
                        e('div', { 
                          className: `h-full ${getScoreColor(barsScore).bg} rounded-full`,
                          style: { width: `${barWidth}%` }
                        })
                      )
                    );
                  })
                )
              ),
              
              // Info wenn keine Ziele
              noGoalsMode && e('div', { className: 'bg-amber-50 border border-amber-200 rounded-xl p-4' },
                e('p', { className: 'text-amber-800 text-sm flex items-center gap-2' },
                  e(AlertCircle, { size: 16 }),
                  lang === 'de' ? 'Keine Ziele vereinbart - GPS wird nur aus Kompetenzen berechnet.' : 'No goals - GPS is calculated from competencies only.'
                )
              ),
              
              // === KERNKOMPETENZEN (Teil C.1) ===
              e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(Award, { size: 20, className: 'text-[#6EBD84]' }),
                  lang === 'de' ? 'Teil C.1: Kernkompetenzen' : 'Part C.1: Core Competencies'
                ),
                e('div', { className: 'space-y-4' },
                  defs.core.map(comp => {
                    const score = coreScores[comp.id] || 0;
                    const comment = coreComments[comp.id] || '';
                    const colors = getScoreColor(score);
                    
                    return e('div', { key: comp.id, className: 'border border-slate-200 rounded-lg p-4' },
                      e('div', { className: 'flex items-center justify-between mb-2' },
                        e('span', { className: 'font-medium text-slate-800' }, comp.name),
                        e('span', { className: `px-3 py-1 rounded-full text-sm font-bold ${colors.light} ${colors.text}` },
                          score, ' ‚Äì ', barsLabels[lang]?.[score] || '‚Äì'
                        )
                      ),
                      e('div', { className: 'flex items-center gap-2 mb-2' },
                        e('div', { className: 'flex-1 h-2 bg-slate-100 rounded-full overflow-hidden' },
                          e('div', { className: `h-full ${colors.bg} rounded-full`, style: { width: `${(score / 5) * 100}%` } })
                        ),
                        e('span', { className: 'text-xs text-slate-400 w-8' }, `${score}/5`)
                      ),
                      comment && e('div', { className: 'mt-2 bg-slate-50 rounded p-2 text-sm text-slate-600 italic' },
                        '"', comment, '"'
                      )
                    );
                  })
                )
              ),
              
              // === F√úHRUNGSKOMPETENZEN (Teil C.2) - nur wenn Manager ===
              isManager && Object.keys(leaderScores).length > 0 && e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(Users, { size: 20, className: 'text-purple-600' }),
                  lang === 'de' ? 'Teil C.2: F√ºhrungskompetenzen' : 'Part C.2: Leadership Competencies'
                ),
                e('div', { className: 'space-y-4' },
                  defs.lead.map(comp => {
                    const score = leaderScores[comp.id] || 0;
                    const comment = leaderComments[comp.id] || '';
                    const colors = getScoreColor(score);
                    
                    return e('div', { key: comp.id, className: 'border border-purple-200 rounded-lg p-4 bg-purple-50/30' },
                      e('div', { className: 'flex items-center justify-between mb-2' },
                        e('span', { className: 'font-medium text-slate-800' }, comp.name),
                        e('span', { className: `px-3 py-1 rounded-full text-sm font-bold ${colors.light} ${colors.text}` },
                          score, ' ‚Äì ', barsLabels[lang]?.[score] || '‚Äì'
                        )
                      ),
                      e('div', { className: 'flex items-center gap-2 mb-2' },
                        e('div', { className: 'flex-1 h-2 bg-slate-100 rounded-full overflow-hidden' },
                          e('div', { className: `h-full ${colors.bg} rounded-full`, style: { width: `${(score / 5) * 100}%` } })
                        ),
                        e('span', { className: 'text-xs text-slate-400 w-8' }, `${score}/5`)
                      ),
                      comment && e('div', { className: 'mt-2 bg-white rounded p-2 text-sm text-slate-600 italic border border-purple-100' },
                        '"', comment, '"'
                      )
                    );
                  })
                )
              ),
              
              // === TEIL D: ST√ÑRKEN & ENTWICKLUNG ===
              e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(FileText, { size: 20, className: 'text-slate-500' }),
                  lang === 'de' ? 'Teil D: St√§rken & Entwicklung' : 'Part D: Strengths & Development'
                ),
                e('div', { className: 'grid md:grid-cols-2 gap-4' },
                  // St√§rken
                  e('div', { className: 'space-y-3' },
                    e('h4', { className: 'font-medium text-green-700 flex items-center gap-2' },
                      e(Award, { size: 16 }),
                      lang === 'de' ? 'Meine St√§rken' : 'My Strengths'
                    ),
                    formData.strengths1 && e('div', { className: 'bg-green-50 rounded-lg p-3 text-sm text-slate-700' }, formData.strengths1),
                    formData.strengths2 && e('div', { className: 'bg-green-50 rounded-lg p-3 text-sm text-slate-700' }, formData.strengths2),
                    formData.strengths3 && e('div', { className: 'bg-green-50 rounded-lg p-3 text-sm text-slate-700' }, formData.strengths3),
                    !formData.strengths1 && !formData.strengths2 && !formData.strengths3 && 
                      e('p', { className: 'text-slate-400 text-sm italic' }, lang === 'de' ? 'Keine Angabe' : 'No data')
                  ),
                  // Entwicklung
                  e('div', { className: 'space-y-3' },
                    e('h4', { className: 'font-medium text-amber-700 flex items-center gap-2' },
                      e(TrendingUp, { size: 16 }),
                      lang === 'de' ? 'Entwicklungsfelder' : 'Development Areas'
                    ),
                    formData.development1 && e('div', { className: 'bg-amber-50 rounded-lg p-3 text-sm text-slate-700' }, formData.development1),
                    formData.development2 && e('div', { className: 'bg-amber-50 rounded-lg p-3 text-sm text-slate-700' }, formData.development2),
                    formData.development3 && e('div', { className: 'bg-amber-50 rounded-lg p-3 text-sm text-slate-700' }, formData.development3),
                    !formData.development1 && !formData.development2 && !formData.development3 && 
                      e('p', { className: 'text-slate-400 text-sm italic' }, lang === 'de' ? 'Keine Angabe' : 'No data')
                  )
                )
              ),
              
              // === TEIL E: KARRIEREW√úNSCHE ===
              e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(TrendingUp, { size: 20, className: 'text-purple-600' }),
                  lang === 'de' ? 'Teil E: Karrierew√ºnsche' : 'Part E: Career Aspirations'
                ),
                e('div', { className: 'flex flex-wrap gap-2 mb-4' },
                  careerLabels[lang].map((label, idx) => 
                    careerChecks[idx] && e('span', { key: idx, className: 'bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm' },
                      '‚úì ', label
                    )
                  )
                ),
                !careerChecks.some(c => c) && e('p', { className: 'text-slate-400 text-sm italic' }, 
                  lang === 'de' ? 'Keine Auswahl getroffen' : 'No selection made'
                ),
                formData.careerComment && e('div', { className: 'mt-4 bg-purple-50 rounded-lg p-4' },
                  e('p', { className: 'text-sm font-medium text-purple-700 mb-1' }, lang === 'de' ? 'Kommentar:' : 'Comment:'),
                  e('p', { className: 'text-slate-700' }, formData.careerComment)
                )
              ),
              
              // === TEIL F: FEEDBACK ===
              (formData.feedbackQ1 || formData.feedbackQ2 || formData.feedbackQ3 || formData.feedbackQ4 || formData.feedbackQ5 || formData.feedbackQ6) && 
              e('div', { className: 'bg-white rounded-3xl shadow-lg border border-slate-100 p-6' },
                e('h3', { className: 'font-bold text-lg text-slate-800 mb-4 flex items-center gap-2' },
                  e(MessageCircle, { size: 20, className: 'text-blue-600' }),
                  lang === 'de' ? 'Teil F: Feedback' : 'Part F: Feedback'
                ),
                e('div', { className: 'space-y-4' },
                  formData.feedbackQ1 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Was l√§uft gut in der Zusammenarbeit mit der FK?' : 'What works well with your manager?'),
                    e('p', { className: 'text-slate-700' }, formData.feedbackQ1)
                  ),
                  formData.feedbackQ2 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Was k√∂nnte verbessert werden?' : 'What could be improved?'),
                    e('p', { className: 'text-slate-700' }, formData.feedbackQ2)
                  ),
                  formData.feedbackQ3 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Wie zufrieden mit Informationsfluss?' : 'Information flow satisfaction?'),
                    e('p', { className: 'text-slate-700' }, formData.feedbackQ3)
                  ),
                  formData.feedbackQ4 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Wie zufrieden mit Unterst√ºtzung bei Weiterentwicklung?' : 'Development support satisfaction?'),
                    e('p', { className: 'text-slate-700' }, formData.feedbackQ4)
                  ),
                  formData.feedbackQ5 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Was w√ºnschen Sie sich von Ihrer FK?' : 'What do you expect from your manager?'),
                    e('p', { className: 'text-slate-700' }, formData.feedbackQ5)
                  ),
                  formData.feedbackQ6 && e('div', { className: 'border-l-4 border-blue-400 pl-4' },
                    e('p', { className: 'text-xs font-medium text-blue-600 mb-1' }, lang === 'de' ? 'Sonstige Anmerkungen' : 'Other comments'),
                    e('p', { className: 'text-slate-700' }, formData.feedbackQ6)
                  ),
                  formData.feedbackQ7 && e('div', { className: 'bg-blue-50 rounded-lg p-4 text-center' },
                    e('p', { className: 'text-xs text-blue-600 mb-2' }, lang === 'de' ? 'Work-Life-Balance' : lang === 'it' ? 'Equilibrio vita-lavoro' : 'Work-Life Balance'),
                    e('p', { className: 'text-3xl font-bold text-[#243186]' }, formData.feedbackQ7, '/5')
                  )
                )
              ),
              
              // === ZUR√úCK BUTTON ===
              e('div', { className: 'flex justify-center gap-3 pt-4' },
                // Pr√ºfe ob R√ºckkehr-Kontext existiert
                (() => {
                  const returnContext = safeLocalStorage.getItem('nw_return_to_appraisal', null);
                  const hasReturnContext = returnContext && (Date.now() - returnContext.timestamp) < 3600000;
                  
                  if (hasReturnContext) {
                    return e(React.Fragment, null,
                      // Zur√ºck zur Beurteilung (prominent)
                      e('button', {
                        onClick: () => {
                          localStorage.removeItem('nw_view_self_assessment');
                          const employeeId = returnContext.employeeId;
                          const period = returnContext.period;
                          const member = teamMembers.find(m => m.id === employeeId);
                          if (member) {
                            const existingReview = teamAppraisals.find(a => 
                              a.employeeId === employeeId && 
                              a.period === period && 
                              (a.type === 'review' || !a.type)
                            );
                            startTeamAppraisal(employeeId, period, existingReview);
                          }
                          localStorage.removeItem('nw_return_to_appraisal');
                        },
                        className: 'px-6 py-3 bg-[#6EBD84] hover:bg-[#5da872] rounded-2xl font-bold text-white flex items-center gap-2 transition-colors shadow-lg'
                      }, 
                        e(ArrowLeft, { size: 18 }),
                        lang === 'de' ? 'Zur√ºck zur Beurteilung' : lang === 'it' ? 'Torna alla valutazione' : 'Back to Appraisal'
                      ),
                      // Zur √úbersicht (sekund√§r)
                      e('button', {
                        onClick: () => {
                          localStorage.removeItem('nw_view_self_assessment');
                          localStorage.removeItem('nw_return_to_appraisal');
                          setActiveView('teamoverview');
                        },
                        className: 'px-6 py-3 bg-slate-100 hover:bg-slate-200 rounded-2xl font-semibold text-slate-700 flex items-center gap-2 transition-colors'
                      }, 
                        lang === 'de' ? 'Zur √úbersicht' : lang === 'it' ? 'Alla panoramica' : 'To Overview'
                      )
                    );
                  } else {
                    return e('button', {
                      onClick: () => {
                        localStorage.removeItem('nw_view_self_assessment');
                        localStorage.removeItem('nw_return_to_appraisal');
                        setActiveView('teamoverview');
                      },
                      className: 'px-6 py-3 bg-slate-100 hover:bg-slate-200 rounded-2xl font-semibold text-slate-700 flex items-center gap-2 transition-colors'
                    }, 
                      e(ArrowLeft, { size: 18 }),
                      lang === 'de' ? 'Zur√ºck zum Team' : lang === 'it' ? 'Torna al team' : 'Back to Team'
                    );
                  }
                })()
              )
            );
          };

          // === MAIN RENDER ===
          
          // Migrations-Ladebildschirm (zeigt an w√§hrend Daten importiert werden)
          if (migrationStatus === 'pending') {
            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center' },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl border border-slate-200 p-8 max-w-md text-center' },
                React.createElement('div', { className: 'w-16 h-16 rounded-full bg-[#E8F5ED] flex items-center justify-center mx-auto mb-6' },
                  React.createElement(Loader2, { className: 'w-8 h-8 animate-spin text-[#6EBD84]' })
                ),
                React.createElement('h2', { className: 'text-xl font-bold text-slate-800 mb-2' },
                  getText(lang, 'Daten werden importiert...', 'Importazione dati in corso...', 'Importing data...')
                ),
                React.createElement('p', { className: 'text-slate-500 text-sm' },
                  getText(lang, 
                    'Wir √ºbertragen Ihre lokalen Daten sicher in die Cloud. Dies dauert nur einen Moment.',
                    'Stiamo trasferendo i tuoi dati locali nel cloud in modo sicuro. Ci vorr√† solo un momento.',
                    'We are securely transferring your local data to the cloud. This will only take a moment.')
                ),
                React.createElement('div', { className: 'mt-6 flex items-center justify-center gap-2 text-xs text-slate-400' },
                  React.createElement('div', { className: 'w-2 h-2 rounded-full bg-[#6EBD84] animate-pulse' }),
                  React.createElement('span', null, getText(lang, 'Bitte warten...', 'Attendere prego...', 'Please wait...'))
                )
              )
            );
          }
          
          // Wenn Gast-Modus aktiv: Zeige nur die Gast-Ansicht (ohne Sidebar, ohne Login)
          if (guestMode) {
            // Loading State
            if (authLoading) {
              return React.createElement('div', { className: 'min-h-screen bg-slate-100 flex items-center justify-center' },
                React.createElement('div', { className: 'text-center' },
                  React.createElement(Loader2, { className: 'w-12 h-12 animate-spin text-[#6EBD84] mx-auto mb-4' }),
                  React.createElement('p', { className: 'text-slate-500' }, getText(lang, 'Laden...', 'Caricamento...', 'Loading...'))
                )
              );
            }
            
            // Gast-Willkommensseite
            if (activeView === 'guestWelcome') {
              return renderGuestWelcome();
            }
            
            // Gast-Formular (Selbstreflexion) - Verwendet MySelfReflectionComponent
            // mit einem "virtuellen User" basierend auf guestEmployee
            if (activeView === 'guestForm') {
              // Erstelle einen virtuellen User-Kontext f√ºr das Formular
              const virtualUser = {
                uid: `guest_${guestEmployee.id}`,
                email: guestEmployee.email || '',
                displayName: guestEmployee.name,
                isGuest: true,
                guestEmployeeId: guestEmployee.id,
                guestManagerId: guestEmployee.userId // userId der FK
              };
              
              return React.createElement('div', { className: 'min-h-screen bg-slate-100' },
                // Header mit Zur√ºck-Button
                React.createElement('div', { 
                  className: 'bg-white border-b border-slate-200 px-4 py-3 flex items-center justify-between sticky top-0 z-40 no-print'
                },
                  React.createElement('button', {
                    onClick: () => setActiveView('guestWelcome'),
                    className: 'flex items-center gap-2 text-slate-600 hover:text-slate-800 transition-colors'
                  },
                    React.createElement(ArrowLeft, { size: 20 }),
                    lang === 'de' ? 'Zur√ºck' : lang === 'it' ? 'Indietro' : 'Back'
                  ),
                  React.createElement('div', { className: 'text-center' },
                    React.createElement('span', { className: 'font-semibold text-[#243186]' }, guestEmployee.name),
                    React.createElement('span', { className: 'text-slate-400 mx-2' }, '‚Ä¢'),
                    React.createElement('span', { className: 'text-slate-500 text-sm' }, 
                      lang === 'de' ? 'Selbstreflexion' : lang === 'it' ? 'Autovalutazione' : 'Self-Reflection'
                    )
                  ),
                  React.createElement('div', { className: 'w-20' }) // Spacer f√ºr Zentrierung
                ),
                // Das vollst√§ndige Selbstreflexions-Formular
                React.createElement(MySelfReflectionComponent, { 
                  lang: lang, 
                  user: virtualUser,
                  guestEmployee: guestEmployee,
                  isGuestMode: true,
                  onComplete: () => {
                    // Nach Abschluss: Erfolgsanzeige und Reset
                    setGuestFormSubmitted(true);
                    setActiveView('guestWelcome');
                  }
                })
              );
            }
            
            // Fallback f√ºr unbekannte Gast-Views
            return React.createElement('div', { className: 'min-h-screen bg-slate-100 flex items-center justify-center p-4' },
              React.createElement('div', { className: 'bg-white rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 p-8 text-center max-w-md' },
                React.createElement(AlertCircle, { size: 48, className: 'text-amber-500 mx-auto mb-4' }),
                React.createElement('h2', { className: 'text-xl font-bold text-slate-800 mb-2' },
                  lang === 'de' ? 'Seite nicht gefunden' : lang === 'it' ? 'Pagina non trovata' : 'Page Not Found'
                ),
                React.createElement('button', {
                  onClick: () => setActiveView('guestWelcome'),
                  className: 'mt-4 px-6 py-2 bg-[#6EBD84] text-white rounded-2xl hover:bg-[#5da872] transition-colors'
                }, lang === 'de' ? 'Zur√ºck zum Start' : lang === 'it' ? 'Torna all\'inizio' : 'Back to Start')
              )
            );
          }

          // === LOADING SCREEN (w√§hrend Auth oder AccessCode-Check l√§uft) - APPLE STYLE ===
          if (authLoading || accessCodeChecking) {
            return React.createElement('div', { 
              className: 'min-h-screen bg-white flex items-center justify-center'
            },
              React.createElement('div', { className: 'text-center' },
                // Pulsierendes Logo
                React.createElement('div', { 
                  className: 'w-20 h-20 mx-auto mb-8 rounded-3xl bg-gradient-to-br from-[#243186] to-[#1a2460] flex items-center justify-center shadow-2xl shadow-[#243186]/30 animate-pulse'
                },
                  React.createElement('span', { className: 'text-white font-bold text-2xl' }, 'N')
                ),
                React.createElement('h1', { className: "text-[#243186] font-semibold text-xl tracking-tight mb-1" }, "nƒ±ederwƒ±eser"),
                React.createElement('p', { className: "text-xs uppercase tracking-[0.2em] text-[#6EBD84] font-medium" }, "Performance Manager"),
                // Minimale Lade-Punkte
                React.createElement('div', { className: 'flex items-center justify-center gap-1.5 mt-8' },
                  [0, 1, 2].map(i => React.createElement('div', {
                    key: i,
                    className: 'w-2 h-2 rounded-full bg-slate-300 animate-bounce',
                    style: { animationDelay: `${i * 0.15}s` }
                  }))
                )
              )
            );
          }

          return React.createElement('div', { className: "min-h-screen bg-slate-100 font-sans text-slate-900 flex flex-col md:flex-row" },
            
            // === IMPORT SELF-ASSESSMENT MODAL ===
            showImportModal && importData && React.createElement('div', { 
              className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4',
              onClick: (ev) => ev.target === ev.currentTarget && !importStatus && setShowImportModal(false)
            },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden' },
                // Header
                React.createElement('div', { className: 'p-6 border-b border-slate-200', style: { backgroundColor: '#243186' } },
                  React.createElement('h2', { className: 'text-2xl font-bold text-white flex items-center gap-3' },
                    React.createElement(Upload, { size: 28 }),
                    lang === 'de' ? 'Selbstreflexion importieren' : lang === 'it' ? 'Importa autovalutazione' : 'Import Self-Assessment'
                  )
                ),
                
                // Content
                importStatus === 'success' 
                  ? React.createElement('div', { className: 'p-8 text-center' },
                      React.createElement('div', { className: 'w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center', style: { backgroundColor: '#6EBD84' } },
                        React.createElement(CheckCircle2, { size: 40, className: 'text-white' })
                      ),
                      React.createElement('h3', { className: 'text-xl font-bold text-slate-800 mb-2' },
                        lang === 'de' ? 'Import erfolgreich!' : lang === 'it' ? 'Importazione riuscita!' : 'Import successful!'
                      ),
                      React.createElement('p', { className: 'text-slate-600' },
                        lang === 'de' 
                          ? `${importData.n} wurde zu Ihrem Team hinzugef√ºgt.`
                          : lang === 'it'
                          ? `${importData.n} √® stato aggiunto al tuo team.`
                          : `${importData.n} has been added to your team.`
                      )
                    )
                  : importStatus === 'error'
                  ? React.createElement('div', { className: 'p-8 text-center' },
                      React.createElement('div', { className: 'w-20 h-20 rounded-full bg-red-100 mx-auto mb-4 flex items-center justify-center' },
                        React.createElement(AlertCircle, { size: 40, className: 'text-red-600' })
                      ),
                      React.createElement('h3', { className: 'text-xl font-bold text-slate-800 mb-2' },
                        lang === 'de' ? 'Fehler beim Import' : lang === 'it' ? 'Errore durante l\'importazione' : 'Import error'
                      ),
                      React.createElement('p', { className: 'text-slate-600 mb-4' },
                        lang === 'de' 
                          ? 'Bitte versuchen Sie es erneut oder wenden Sie sich an den Support.'
                          : lang === 'it'
                          ? 'Riprova o contatta il supporto.'
                          : 'Please try again or contact support.'
                      ),
                      React.createElement('button', {
                        onClick: () => { setImportStatus(null); },
                        className: 'px-6 py-2 rounded-xl font-medium text-white', 
                        style: { backgroundColor: '#243186' }
                      }, lang === 'de' ? 'Erneut versuchen' : lang === 'it' ? 'Riprova' : 'Try again')
                    )
                  : React.createElement('div', { className: 'p-6 space-y-5' },
                      // Preview der Daten
                      React.createElement('div', { className: 'bg-slate-50 rounded-xl p-5' },
                        React.createElement('h4', { className: 'font-bold text-slate-800 mb-3 flex items-center gap-2' },
                          React.createElement(User, { size: 18 }),
                          lang === 'de' ? 'Mitarbeiterdaten:' : lang === 'it' ? 'Dati del dipendente:' : 'Employee data:'
                        ),
                        React.createElement('div', { className: 'space-y-2' },
                          React.createElement('div', { className: 'flex justify-between' },
                            React.createElement('span', { className: 'text-slate-500' }, lang === 'de' ? 'Name:' : lang === 'it' ? 'Nome:' : 'Name:'),
                            React.createElement('span', { className: 'font-semibold text-slate-800' }, importData.n || '‚Äì')
                          ),
                          React.createElement('div', { className: 'flex justify-between' },
                            React.createElement('span', { className: 'text-slate-500' }, lang === 'de' ? 'Position:' : lang === 'it' ? 'Posizione:' : 'Position:'),
                            React.createElement('span', { className: 'font-medium text-slate-700' }, importData.p || '‚Äì')
                          ),
                          importData.e && React.createElement('div', { className: 'flex justify-between' },
                            React.createElement('span', { className: 'text-slate-500' }, 'Email:'),
                            React.createElement('span', { className: 'font-medium text-slate-700' }, importData.e)
                          ),
                          React.createElement('div', { className: 'flex justify-between' },
                            React.createElement('span', { className: 'text-slate-500' }, lang === 'de' ? 'Ziele:' : lang === 'it' ? 'Obiettivi:' : 'Goals:'),
                            React.createElement('span', { className: 'font-medium text-slate-700' }, (importData.g?.length || 0) + ' ' + (lang === 'de' ? 'definiert' : lang === 'it' ? 'definiti' : 'defined'))
                          ),
                          React.createElement('div', { className: 'flex justify-between' },
                            React.createElement('span', { className: 'text-slate-500' }, lang === 'de' ? 'F√ºhrungskraft:' : lang === 'it' ? 'Manager:' : 'Manager:'),
                            React.createElement('span', { className: 'font-medium text-slate-700' }, importData.im ? '‚úì' : '‚Äì')
                          )
                        )
                      ),
                      
                      // Info
                      React.createElement('div', { className: 'flex items-start gap-3 text-sm' },
                        React.createElement(Info, { size: 18, className: 'flex-shrink-0 mt-0.5 text-blue-500' }),
                        React.createElement('p', { className: 'text-slate-600' },
                          lang === 'de' 
                            ? 'Beim Import wird der Mitarbeiter automatisch zu Ihrem Team hinzugef√ºgt und die Selbstreflexion wird mit dessen Profil verkn√ºpft.'
                            : lang === 'it'
                            ? 'Durante l\'importazione, il dipendente viene aggiunto automaticamente al tuo team e l\'autovalutazione viene collegata al suo profilo.'
                            : 'During import, the employee will be automatically added to your team and the self-assessment will be linked to their profile.'
                        )
                      ),
                      
                      // Hinweis falls nicht eingeloggt
                      !user && React.createElement('div', { className: 'bg-amber-50 border border-amber-200 rounded-xl p-4' },
                        React.createElement('p', { className: 'text-amber-800 text-sm font-medium' },
                          '‚ö†Ô∏è ' + (lang === 'de' 
                            ? 'Bitte melden Sie sich zuerst an, um die Selbstreflexion zu importieren.'
                            : lang === 'it'
                            ? 'Accedi prima per importare l\'autovalutazione.'
                            : 'Please log in first to import the self-assessment.')
                        )
                      )
                    ),
                
                // Footer
                !importStatus && React.createElement('div', { className: 'p-6 border-t border-slate-200 bg-slate-50 flex gap-3' },
                  React.createElement('button', {
                    onClick: () => { setShowImportModal(false); setImportData(null); },
                    className: 'flex-1 py-3 rounded-xl font-medium text-slate-600 bg-white border border-slate-300 hover:bg-slate-100 transition-colors'
                  }, lang === 'de' ? 'Abbrechen' : lang === 'it' ? 'Annulla' : 'Cancel'),
                  React.createElement('button', {
                    onClick: importSelfAssessment,
                    disabled: !user,
                    className: 'flex-1 py-3 rounded-xl font-bold text-white transition-colors flex items-center justify-center gap-2 disabled:opacity-50',
                    style: { backgroundColor: '#6EBD84' }
                  }, 
                    React.createElement(CheckCircle2, { size: 18 }),
                    lang === 'de' ? 'Importieren' : lang === 'it' ? 'Importa' : 'Import'
                  )
                )
              )
            ),
            
            // === PENDING SELF-ASSESSMENTS MODAL (beim Login der FK) ===
            showPendingModal && pendingSelfAssessments.length > 0 && React.createElement('div', { 
              className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4'
            },
              React.createElement('div', { className: 'bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden' },
                // Header
                React.createElement('div', { className: 'p-6 border-b border-slate-200', style: { backgroundColor: '#6EBD84' } },
                  React.createElement('h2', { className: 'text-2xl font-bold text-white flex items-center gap-3' },
                    React.createElement(Sparkles, { size: 28 }),
                    lang === 'de' ? 'Neue Selbstreflexionen!' : lang === 'it' ? 'Nuove autovalutazioni!' : 'New Self-Assessments!'
                  )
                ),
                
                // Content
                React.createElement('div', { className: 'p-6 space-y-5' },
                  // Info
                  React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4 flex items-start gap-3' },
                    React.createElement(Info, { size: 24, className: 'text-blue-600 flex-shrink-0 mt-0.5' }),
                    React.createElement('div', null,
                      React.createElement('p', { className: 'font-semibold text-blue-800' }, 
                        lang === 'de' 
                          ? `${pendingSelfAssessments.length} Mitarbeiter ${pendingSelfAssessments.length === 1 ? 'hat' : 'haben'} eine Selbstreflexion f√ºr Sie eingereicht!`
                          : lang === 'it'
                          ? `${pendingSelfAssessments.length} collaborator${pendingSelfAssessments.length === 1 ? 'e ha' : 'i hanno'} inviato un'autovalutazione per Lei!`
                          : `${pendingSelfAssessments.length} employee${pendingSelfAssessments.length === 1 ? ' has' : 's have'} submitted a self-assessment for you!`
                      ),
                      React.createElement('p', { className: 'text-sm text-blue-700 mt-1' },
                        lang === 'de' 
                          ? 'Diese Mitarbeiter haben Ihre E-Mail-Adresse angegeben.'
                          : lang === 'it'
                          ? 'Questi collaboratori hanno indicato il tuo indirizzo e-mail.'
                          : 'These employees have provided your email address.'
                      )
                    )
                  ),
                  
                  // Liste der wartenden Selbstreflexionen
                  React.createElement('div', { className: 'space-y-3 max-h-60 overflow-y-auto' },
                    pendingSelfAssessments.map((pending, index) => 
                      React.createElement('div', { 
                        key: pending.id || index, 
                        className: 'bg-slate-50 rounded-xl p-4 flex items-center justify-between'
                      },
                        React.createElement('div', null,
                          React.createElement('p', { className: 'font-semibold text-slate-800' }, 
                            pending.employeeName || pending.formData?.employee || 'Unbekannt'
                          ),
                          React.createElement('p', { className: 'text-sm text-slate-500' }, 
                            pending.formData?.position || '‚Äì'
                          )
                        ),
                        React.createElement('div', { className: 'text-right' },
                          React.createElement('span', { className: 'px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium' },
                            pending.period || new Date().getFullYear()
                          )
                        )
                      )
                    )
                  ),
                  
                  // Erkl√§rung
                  React.createElement('p', { className: 'text-sm text-slate-600' },
                    lang === 'de' 
                      ? 'Beim √úbernehmen werden die Mitarbeiter automatisch zu Ihrem Team hinzugef√ºgt und die Selbstreflexionen verkn√ºpft.'
                      : lang === 'it'
                      ? 'Durante l\'importazione, i collaboratori vengono aggiunti automaticamente al tuo team e le autovalutazioni collegate.'
                      : 'When claiming, the employees will be automatically added to your team and the self-assessments linked.'
                  )
                ),
                
                // Footer
                React.createElement('div', { className: 'p-6 border-t border-slate-200 bg-slate-50 flex gap-3' },
                  React.createElement('button', {
                    onClick: () => { setShowPendingModal(false); setPendingSelfAssessments([]); },
                    className: 'flex-1 py-3 rounded-xl font-medium text-slate-600 bg-white border border-slate-300 hover:bg-slate-100 transition-colors'
                  }, lang === 'de' ? 'Sp√§ter' : lang === 'it' ? 'Pi√π tardi' : 'Later'),
                  React.createElement('button', {
                    onClick: claimPendingSelfAssessments,
                    disabled: claimingPending,
                    className: 'flex-1 py-3 rounded-xl font-bold text-white transition-colors flex items-center justify-center gap-2 disabled:opacity-50',
                    style: { backgroundColor: '#6EBD84' }
                  }, 
                    claimingPending ? React.createElement(Loader2, { size: 18, className: 'animate-spin' }) : React.createElement(CheckCircle2, { size: 18 }),
                    claimingPending 
                      ? (lang === 'de' ? 'Wird √ºbernommen...' : lang === 'it' ? 'Importazione...' : 'Claiming...')
                      : (lang === 'de' ? 'Alle √ºbernehmen' : lang === 'it' ? 'Importa tutti' : 'Claim All')
                  )
                )
              )
            ),
            
            React.createElement('aside', { className: "bg-[#243186] text-slate-300 w-full md:w-64 flex-shrink-0 flex flex-col" }, // Sidebar background
              React.createElement('div', { className: "p-6 border-b border-slate-800" },
                React.createElement('h1', { className: "text-white font-bold text-xl tracking-tight" }, "nƒ±ederwƒ±eser"),
                // Akzentfarbe ge√§ndert auf #6EBD84
                React.createElement('p', { className: "text-xs mt-1 uppercase tracking-widest", style: { color: "#6EBD84" } }, t.title)
              ),
              React.createElement('nav', { className: "flex-1 p-4 space-y-2" },
                React.createElement('div', { className: "mb-6 px-2" },
                    // Sprachauswahl modern
                    React.createElement('div', { className: "bg-slate-800/50 backdrop-blur rounded-xl p-1.5 border border-slate-700/50" },
                        React.createElement('div', { className: "flex gap-1" },
                            React.createElement('button', {
                                onClick: () => setLang('de'),
                                className: `flex-1 py-2.5 rounded-lg text-xs font-semibold tracking-wide transition-all duration-300 ${lang === 'de' ? 'bg-gradient-to-r from-[#6EBD84] to-[#5da872] text-white shadow-lg shadow-[#6EBD84]/30' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`
                            }, "DE"),
                            React.createElement('button', {
                                onClick: () => setLang('it'),
                                className: `flex-1 py-2.5 rounded-lg text-xs font-semibold tracking-wide transition-all duration-300 ${lang === 'it' ? 'bg-gradient-to-r from-[#6EBD84] to-[#5da872] text-white shadow-lg shadow-[#6EBD84]/30' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`
                            }, "IT"),
                            React.createElement('button', {
                                onClick: () => setLang('en'),
                                className: `flex-1 py-2.5 rounded-lg text-xs font-semibold tracking-wide transition-all duration-300 ${lang === 'en' ? 'bg-gradient-to-r from-[#6EBD84] to-[#5da872] text-white shadow-lg shadow-[#6EBD84]/30' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`
                            }, "EN")
                        )
                    ),
                    React.createElement('p', { className: "text-[10px] mt-2 text-center uppercase tracking-widest", style: { color: '#6EBD84' } },
                        'Select Language'
                    )
                ),
                // Navigations-Buttons mit Akzentfarbe - OHNE Icons, wei√üe Schrift
                React.createElement('button', {
                  onClick: () => { setActiveView('dashboard'); setActiveScore(3); },
                  className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'dashboard' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                }, t.dashboard),
                React.createElement('button', {
                  onClick: () => { setActiveView('guide'); },
                  className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'guide' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                }, lang === 'de' ? 'Anleitung' : lang === 'it' ? 'Guida' : 'Guide'),
                React.createElement('button', {
                  onClick: () => { setActiveView('list'); setActiveScore(3); },
                  className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'list' || activeView === 'detail' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                }, t.competencies),
                React.createElement('button', {
                  onClick: () => { setActiveView('gpsexplainer'); setActiveScore(3); },
                  className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'gpsexplainer' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                }, t.gpsExplainer),
                
                // === SECTION: F√úR MICH ===
                React.createElement('div', { className: 'mt-4 pt-4 border-t border-slate-700' },
                  React.createElement('p', { className: 'text-xs px-4 mb-2 uppercase tracking-wider text-slate-400' }, 
                    getText(lang, 'F√ºr mich', 'Per me', 'For me')
                  ),
                  React.createElement('button', {
                    onClick: () => { setActiveView('mySelfReflection'); },
                    className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'mySelfReflection' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                  }, getText(lang, 'Meine Selbstreflexion', 'La mia autovalutazione', 'My Self-Reflection'))
                ),
                
                // === SECTION: TEAM ===
                React.createElement('div', { className: 'mt-4 pt-4 border-t border-slate-700' },
                  React.createElement('p', { className: 'text-xs px-4 mb-2 uppercase tracking-wider text-slate-400' }, 
                    getText(lang, 'Team', 'Team', 'Team')
                  ),
                  React.createElement('button', {
                    onClick: () => { setActiveView('teamoverview'); setActiveScore(3); },
                    className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'teamoverview' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                  }, getText(lang, 'Team-√úbersicht', 'Panoramica team', 'Team Overview')),
                  // Team-Kalibrierung (nur wenn Team vorhanden)
                  teamMembers.length > 0 && React.createElement('button', {
                    onClick: () => { setActiveView('teamcalibration'); setActiveScore(3); },
                    className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'teamcalibration' ? 'bg-[#6EBD84] text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                  }, getText(lang, 'Kalibrierung', 'Calibrazione', 'Calibration'))
                ),
                
                // HR ADMIN Men√ºpunkt (nur f√ºr HR-Admins sichtbar)
                isHRAdmin && React.createElement('div', { className: 'mt-4 pt-4 border-t border-slate-700' },
                  React.createElement('p', { className: 'text-xs px-4 mb-2 uppercase tracking-wider', style: { color: '#6EBD84' } }, 'HR Admin'),
                  React.createElement('button', {
                    onClick: () => { setActiveView('hrdashboard'); },
                    className: `w-full text-left px-4 py-3 rounded-lg transition-colors ${activeView === 'hrdashboard' ? 'bg-purple-600 text-white font-semibold' : 'text-white hover:bg-slate-800'}`
                  }, 'HR Dashboard')
                )
              )
            ),
            React.createElement('main', { className: "flex-1 overflow-y-auto h-screen p-4 md:p-8 md:pb-20" },
              React.createElement('div', { className: "max-w-4xl mx-auto" },
                activeView === 'dashboard' && renderDashboard(),
                activeView === 'guide' && renderGuide(),
                activeView === 'list' && renderCompetencyList(),
                activeView === 'detail' && renderDetailView(),
                activeView === 'gpsexplainer' && renderGPSExplainer(),
                activeView === 'mySelfReflection' && React.createElement(MySelfReflectionComponent, { lang: lang, user: user }),
                activeView === 'zielvereinbarung' && React.createElement(Zielvereinbarung, { key: safeLocalStorage.getItem('nw_current_employee', 'default'), lang: lang, onSaveTeam: saveTeamAppraisal, onCancel: () => setActiveView('teamoverview') }),
                activeView === 'teamoverview' && renderTeamOverview(),
                activeView === 'viewSelfAssessment' && renderViewSelfAssessment(),
                activeView === 'formular' && React.createElement(AppraisalForm, { key: safeLocalStorage.getItem('nw_current_employee', 'default'), lang: lang, onSaveTeam: saveTeamAppraisal, onCancel: () => setActiveView('teamoverview'), db: db, setActiveView: setActiveView }),
                activeView === 'teamcalibration' && renderTeamCalibration(),
                activeView === 'hrdashboard' && isHRAdmin && renderHRDashboard()
              )
            ),
            // HelpChat - Smart HR Assistant (nur f√ºr eingeloggte User)
            React.createElement(HelpChat, { 
              lang: lang, 
              setActiveView: setActiveView, 
              activeView: activeView,
              setSelectedCompetencyId: setSelectedCompetencyId 
            })
          );
        }

        // --- RENDER APP ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(PerformanceApp));
    </script>
</body>
</html>
